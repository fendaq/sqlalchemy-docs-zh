<h1><span class="yiyi-st" id="yiyi-45">&#x4E8B;&#x4EF6;<a class="headerlink" href="#events" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h1><p><span class="yiyi-st" id="yiyi-46">SQLAlchemy&#x5305;&#x542B;&#x4E00;&#x4E2A;&#x4E8B;&#x4EF6;API&#xFF0C;&#x5B83;&#x5C06;&#x5404;&#x79CD;&#x5404;&#x6837;&#x7684;&#x94A9;&#x5B50;&#x53D1;&#x5E03;&#x5230;SQLAlchemy Core&#x548C;ORM&#x7684;&#x5185;&#x90E8;&#x3002;</span></p><div class="versionadded"><p><span class="yiyi-st" id="yiyi-47"><span class="versionmodified">New in version 0.7: </span>The system supersedes the previous system of &#x201C;extension&#x201D;, &#x201C;proxy&#x201D;, and &#x201C;listener&#x201D; classes.</span></p></div><div class="section" id="event-registration"><h2><span class="yiyi-st" id="yiyi-48">&#x4E8B;&#x4EF6;&#x6CE8;&#x518C;<a class="headerlink" href="#event-registration" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-49">&#x901A;&#x8FC7;&#x4E00;&#x4E2A;API&#x70B9;&#xFF0C;<a class="reference internal" href="#sqlalchemy.event.listen" title="sqlalchemy.event.listen"><code class="xref py py-func docutils literal"><span class="pre">listen()</span></code></a>&#x51FD;&#x6570;&#x6216;<a class="reference internal" href="#sqlalchemy.event.listens_for" title="sqlalchemy.event.listens_for"><code class="xref py py-func docutils literal"><span class="pre">listens_for()</span></code></a>&#x88C5;&#x9970;&#x5668;&#x6765;&#x8BA2;&#x9605;&#x4E8B;&#x4EF6;&#x3002;</span><span class="yiyi-st" id="yiyi-50">&#x8FD9;&#x4E9B;&#x51FD;&#x6570;&#x63A5;&#x53D7;&#x4E00;&#x4E2A;&#x76EE;&#x6807;&#xFF0C;&#x6807;&#x8BC6;&#x8981;&#x62E6;&#x622A;&#x4E8B;&#x4EF6;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x6807;&#x8BC6;&#x7B26;&#x4EE5;&#x53CA;&#x7528;&#x6237;&#x5B9A;&#x4E49;&#x7684;&#x76D1;&#x542C;&#x51FD;&#x6570;&#x3002;</span><span class="yiyi-st" id="yiyi-51">&#x8FD9;&#x4E24;&#x4E2A;&#x51FD;&#x6570;&#x7684;&#x9644;&#x52A0;&#x4F4D;&#x7F6E;&#x548C;&#x5173;&#x952E;&#x5B57;&#x53C2;&#x6570;&#x53EF;&#x4EE5;&#x7531;&#x7279;&#x5B9A;&#x7C7B;&#x578B;&#x7684;&#x4E8B;&#x4EF6;&#x652F;&#x6301;&#xFF0C;&#x8FD9;&#x4E9B;&#x7C7B;&#x578B;&#x7684;&#x4E8B;&#x4EF6;&#x53EF;&#x4EE5;&#x4E3A;&#x7ED9;&#x5B9A;&#x7684;&#x4E8B;&#x4EF6;&#x51FD;&#x6570;&#x6307;&#x5B9A;&#x5907;&#x7528;&#x63A5;&#x53E3;&#xFF0C;&#x6216;&#x8005;&#x57FA;&#x4E8E;&#x7ED9;&#x5B9A;&#x7684;&#x76EE;&#x6807;&#x63D0;&#x4F9B;&#x5173;&#x4E8E;&#x8F85;&#x52A9;&#x4E8B;&#x4EF6;&#x76EE;&#x6807;&#x7684;&#x6307;&#x4EE4;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-52">&#x4E8B;&#x4EF6;&#x7684;&#x540D;&#x79F0;&#x548C;&#x76F8;&#x5E94;&#x4FA6;&#x542C;&#x5668;&#x51FD;&#x6570;&#x7684;&#x53C2;&#x6570;&#x7B7E;&#x540D;&#x662F;&#x4ECE;&#x7C7B;&#x7ED1;&#x5B9A;&#x89C4;&#x8303;&#x65B9;&#x6CD5;&#x6D3E;&#x751F;&#x7684;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x7ED1;&#x5B9A;&#x5230;&#x6587;&#x6863;&#x4E2D;&#x63CF;&#x8FF0;&#x7684;&#x6807;&#x8BB0;&#x7C7B;&#x3002;</span><span class="yiyi-st" id="yiyi-53">&#x4F8B;&#x5982;&#xFF0C;<a class="reference internal" href="events.html#sqlalchemy.events.PoolEvents.connect" title="sqlalchemy.events.PoolEvents.connect"><code class="xref py py-meth docutils literal"><span class="pre">PoolEvents.connect()</span></code></a>&#x7684;&#x6587;&#x6863;&#x6307;&#x51FA;&#x4E8B;&#x4EF6;&#x540D;&#x79F0;&#x4E3A;<code class="docutils literal"><span class="pre">&quot;connect&quot;</span></code>&#xFF0C;&#x5E76;&#x4E14;&#x7528;&#x6237;&#x5B9A;&#x4E49;&#x7684;&#x4FA6;&#x542C;&#x5668;&#x51FD;&#x6570;&#x5E94;&#x8BE5;&#x63A5;&#x6536;&#x4E24;&#x4E2A;&#x4F4D;&#x7F6E;&#x53C2;&#x6570;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.event</span> <span class="kn">import</span> <span class="n">listen</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.pool</span> <span class="kn">import</span> <span class="n">Pool</span>

<span class="k">def</span> <span class="nf">my_on_connect</span><span class="p">(</span><span class="n">dbapi_con</span><span class="p">,</span> <span class="n">connection_record</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;New DBAPI connection:&quot;</span><span class="p">,</span> <span class="n">dbapi_con</span><span class="p">)</span>

<span class="n">listen</span><span class="p">(</span><span class="n">Pool</span><span class="p">,</span> <span class="s1">&apos;connect&apos;</span><span class="p">,</span> <span class="n">my_on_connect</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-54">&#x4F7F;&#x7528;<a class="reference internal" href="#sqlalchemy.event.listens_for" title="sqlalchemy.event.listens_for"><code class="xref py py-func docutils literal"><span class="pre">listens_for()</span></code></a>&#x88C5;&#x9970;&#x5668;&#x6765;&#x6536;&#x542C;&#x770B;&#x8D77;&#x6765;&#x50CF;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.event</span> <span class="kn">import</span> <span class="n">listens_for</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.pool</span> <span class="kn">import</span> <span class="n">Pool</span>

<span class="nd">@listens_for</span><span class="p">(</span><span class="n">Pool</span><span class="p">,</span> <span class="s2">&quot;connect&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_on_connect</span><span class="p">(</span><span class="n">dbapi_con</span><span class="p">,</span> <span class="n">connection_record</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;New DBAPI connection:&quot;</span><span class="p">,</span> <span class="n">dbapi_con</span><span class="p">)</span></pre></div></div></div><div class="section" id="named-argument-styles"><h2><span class="yiyi-st" id="yiyi-55">&#x547D;&#x540D;&#x53C2;&#x6570;&#x6837;&#x5F0F;<a class="headerlink" href="#named-argument-styles" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-56">&#x542C;&#x4F17;&#x529F;&#x80FD;&#x53EF;&#x4EE5;&#x63A5;&#x53D7;&#x4E00;&#x4E9B;&#x4E0D;&#x540C;&#x7684;&#x53C2;&#x6570;&#x98CE;&#x683C;&#x3002;</span><span class="yiyi-st" id="yiyi-57">&#x4EE5;<a class="reference internal" href="events.html#sqlalchemy.events.PoolEvents.connect" title="sqlalchemy.events.PoolEvents.connect"><code class="xref py py-meth docutils literal"><span class="pre">PoolEvents.connect()</span></code></a>&#x4E3A;&#x4F8B;&#xFF0C;&#x8BE5;&#x51FD;&#x6570;&#x88AB;&#x8BB0;&#x5F55;&#x4E3A;&#x63A5;&#x6536;<code class="docutils literal"><span class="pre">dbapi_connection</span></code>&#x548C;<code class="docutils literal"><span class="pre">connection_record</span></code>&#x53C2;&#x6570;&#x3002;</span><span class="yiyi-st" id="yiyi-58">We can opt to receive these arguments by name, by establishing a listener function that accepts <code class="docutils literal"><span class="pre">**keyword</span></code> arguments, by passing <code class="docutils literal"><span class="pre">named=True</span></code> to either <a class="reference internal" href="#sqlalchemy.event.listen" title="sqlalchemy.event.listen"><code class="xref py py-func docutils literal"><span class="pre">listen()</span></code></a> or <a class="reference internal" href="#sqlalchemy.event.listens_for" title="sqlalchemy.event.listens_for"><code class="xref py py-func docutils literal"><span class="pre">listens_for()</span></code></a>:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.event</span> <span class="kn">import</span> <span class="n">listens_for</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.pool</span> <span class="kn">import</span> <span class="n">Pool</span>

<span class="nd">@listens_for</span><span class="p">(</span><span class="n">Pool</span><span class="p">,</span> <span class="s2">&quot;connect&quot;</span><span class="p">,</span> <span class="n">named</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_on_connect</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;New DBAPI connection:&quot;</span><span class="p">,</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&apos;dbapi_connection&apos;</span><span class="p">])</span></pre></div></div><p><span class="yiyi-st" id="yiyi-59">&#x4F7F;&#x7528;&#x547D;&#x540D;&#x53C2;&#x6570;&#x4F20;&#x9012;&#x65F6;&#xFF0C;&#x51FD;&#x6570;&#x53C2;&#x6570;&#x89C4;&#x8303;&#x4E2D;&#x5217;&#x51FA;&#x7684;&#x540D;&#x79F0;&#x5C06;&#x7528;&#x4F5C;&#x5B57;&#x5178;&#x4E2D;&#x7684;&#x952E;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-60">&#x547D;&#x540D;&#x6837;&#x5F0F;&#x6309;&#x540D;&#x79F0;&#x4F20;&#x9012;&#x6240;&#x6709;&#x53C2;&#x6570;&#xFF0C;&#x800C;&#x4E0D;&#x7BA1;&#x51FD;&#x6570;&#x7B7E;&#x540D;&#x5982;&#x4F55;&#xFF0C;&#x56E0;&#x6B64;&#x53EA;&#x8981;&#x540D;&#x79F0;&#x5339;&#x914D;&#xFF0C;&#x53EF;&#x4EE5;&#x4EE5;&#x4EFB;&#x610F;&#x987A;&#x5E8F;&#x5217;&#x51FA;&#x5177;&#x4F53;&#x53C2;&#x6570;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.event</span> <span class="kn">import</span> <span class="n">listens_for</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.pool</span> <span class="kn">import</span> <span class="n">Pool</span>

<span class="nd">@listens_for</span><span class="p">(</span><span class="n">Pool</span><span class="p">,</span> <span class="s2">&quot;connect&quot;</span><span class="p">,</span> <span class="n">named</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_on_connect</span><span class="p">(</span><span class="n">dbapi_connection</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;New DBAPI connection:&quot;</span><span class="p">,</span> <span class="n">dbapi_connection</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Connection record:&quot;</span><span class="p">,</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&apos;connection_record&apos;</span><span class="p">])</span></pre></div></div><p><span class="yiyi-st" id="yiyi-61">&#x5728;&#x4E0A;&#x9762;&#xFF0C;<code class="docutils literal"><span class="pre">**kw</span></code>&#x7684;&#x5B58;&#x5728;&#x544A;&#x8BC9;<a class="reference internal" href="#sqlalchemy.event.listens_for" title="sqlalchemy.event.listens_for"><code class="xref py py-func docutils literal"><span class="pre">listens_for()</span></code></a>&#x53C2;&#x6570;&#x5E94;&#x8BE5;&#x901A;&#x8FC7;&#x540D;&#x79F0;&#x800C;&#x4E0D;&#x662F;&#x4F4D;&#x7F6E;&#x4F20;&#x9012;&#x7ED9;&#x51FD;&#x6570;&#x3002;</span></p><div class="versionadded"><p><span class="yiyi-st" id="yiyi-62"><span class="versionmodified">&#x7248;&#x672C;0.9.0&#x65B0;&#x589E;&#xFF1A;</span>&#x6DFB;&#x52A0;&#x53EF;&#x9009;&#x7684;<code class="docutils literal"><span class="pre">named</span></code>&#x53C2;&#x6570;&#x8C03;&#x5EA6;&#x5230;&#x4E8B;&#x4EF6;&#x8C03;&#x7528;&#x3002;</span></p></div></div><div class="section" id="targets"><h2><span class="yiyi-st" id="yiyi-63">&#x76EE;&#x6807;<a class="headerlink" href="#targets" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h2><p><span class="yiyi-st" id="yiyi-64">&#x5173;&#x4E8E;&#x76EE;&#x6807;&#xFF0C;<a class="reference internal" href="#sqlalchemy.event.listen" title="sqlalchemy.event.listen"><code class="xref py py-func docutils literal"><span class="pre">listen()</span></code></a>&#x51FD;&#x6570;&#x975E;&#x5E38;&#x7075;&#x6D3B;&#x3002;</span><span class="yiyi-st" id="yiyi-65">&#x5B83;&#x901A;&#x5E38;&#x63A5;&#x53D7;&#x7C7B;&#xFF0C;&#x8FD9;&#x4E9B;&#x7C7B;&#x7684;&#x5B9E;&#x4F8B;&#x4EE5;&#x53CA;&#x4ECE;&#x4E2D;&#x6D3E;&#x751F;&#x51FA;&#x9002;&#x5F53;&#x76EE;&#x6807;&#x7684;&#x76F8;&#x5173;&#x7C7B;&#x6216;&#x5BF9;&#x8C61;&#x3002;</span><span class="yiyi-st" id="yiyi-66">&#x4F8B;&#x5982;&#xFF0C;&#x4E0A;&#x9762;&#x63D0;&#x5230;&#x7684;<code class="docutils literal"><span class="pre">&quot;connect&quot;</span></code>&#x4E8B;&#x4EF6;&#x63A5;&#x53D7;<a class="reference internal" href="connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal"><span class="pre">Engine</span></code></a>&#x7C7B;&#x548C;&#x5BF9;&#x8C61;&#x4EE5;&#x53CA;<a class="reference internal" href="pooling.html#sqlalchemy.pool.Pool" title="sqlalchemy.pool.Pool"><code class="xref py py-class docutils literal"><span class="pre">Pool</span></code></a>&#x7C7B;&#x548C;&#x5BF9;&#x8C61;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.event</span> <span class="kn">import</span> <span class="n">listen</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.pool</span> <span class="kn">import</span> <span class="n">Pool</span><span class="p">,</span> <span class="n">QueuePool</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.engine</span> <span class="kn">import</span> <span class="n">Engine</span>
<span class="kn">import</span> <span class="nn">psycopg2</span>

<span class="k">def</span> <span class="nf">connect</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s1">&apos;ed&apos;</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">&apos;127.0.0.1&apos;</span><span class="p">,</span> <span class="n">dbname</span><span class="o">=</span><span class="s1">&apos;test&apos;</span><span class="p">)</span>

<span class="n">my_pool</span> <span class="o">=</span> <span class="n">QueuePool</span><span class="p">(</span><span class="n">connect</span><span class="p">)</span>
<span class="n">my_engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&apos;postgresql://ed@localhost/test&apos;</span><span class="p">)</span>

<span class="c1"># associate listener with all instances of Pool</span>
<span class="n">listen</span><span class="p">(</span><span class="n">Pool</span><span class="p">,</span> <span class="s1">&apos;connect&apos;</span><span class="p">,</span> <span class="n">my_on_connect</span><span class="p">)</span>

<span class="c1"># associate listener with all instances of Pool</span>
<span class="c1"># via the Engine class</span>
<span class="n">listen</span><span class="p">(</span><span class="n">Engine</span><span class="p">,</span> <span class="s1">&apos;connect&apos;</span><span class="p">,</span> <span class="n">my_on_connect</span><span class="p">)</span>

<span class="c1"># associate listener with my_pool</span>
<span class="n">listen</span><span class="p">(</span><span class="n">my_pool</span><span class="p">,</span> <span class="s1">&apos;connect&apos;</span><span class="p">,</span> <span class="n">my_on_connect</span><span class="p">)</span>

<span class="c1"># associate listener with my_engine.pool</span>
<span class="n">listen</span><span class="p">(</span><span class="n">my_engine</span><span class="p">,</span> <span class="s1">&apos;connect&apos;</span><span class="p">,</span> <span class="n">my_on_connect</span><span class="p">)</span></pre></div></div></div><div class="section" id="modifiers"><h2><span class="yiyi-st" id="yiyi-67">&#x6539;&#x6027;&#x5242;<a class="headerlink" href="#modifiers" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h2><p><span class="yiyi-st" id="yiyi-68">&#x6709;&#x4E9B;&#x4FA6;&#x542C;&#x5668;&#x5141;&#x8BB8;&#x5C06;&#x4FEE;&#x9970;&#x7B26;&#x4F20;&#x9012;&#x7ED9;<a class="reference internal" href="#sqlalchemy.event.listen" title="sqlalchemy.event.listen"><code class="xref py py-func docutils literal"><span class="pre">listen()</span></code></a>&#x3002;</span><span class="yiyi-st" id="yiyi-69">&#x8FD9;&#x4E9B;&#x4FEE;&#x9970;&#x7B26;&#x6709;&#x65F6;&#x4F1A;&#x4E3A;&#x4FA6;&#x542C;&#x5668;&#x63D0;&#x4F9B;&#x66FF;&#x4EE3;&#x8C03;&#x7528;&#x7B7E;&#x540D;&#x3002;</span><span class="yiyi-st" id="yiyi-70">&#x6BD4;&#x5982;&#x5BF9;&#x4E8E;ORM&#x4E8B;&#x4EF6;&#xFF0C;&#x4E00;&#x4E9B;&#x4E8B;&#x4EF6;&#x76D1;&#x542C;&#x5668;&#x53EF;&#x4EE5;&#x6709;&#x4E00;&#x4E2A;&#x8FD4;&#x56DE;&#x503C;&#x6765;&#x4FEE;&#x6539;&#x540E;&#x7EED;&#x7684;&#x5904;&#x7406;&#x3002;</span><span class="yiyi-st" id="yiyi-71">&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6CA1;&#x6709;&#x4FA6;&#x542C;&#x5668;&#x9700;&#x8981;&#x8FD4;&#x56DE;&#x503C;&#xFF0C;&#x4F46;&#x901A;&#x8FC7;&#x4F20;&#x9012;<code class="docutils literal"><span class="pre">retval=True</span></code>&#x53EF;&#x4EE5;&#x652F;&#x6301;&#x6B64;&#x503C;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">validate_phone</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">oldvalue</span><span class="p">,</span> <span class="n">initiator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Strip non-numeric characters from a phone number&quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">r&apos;(?![0-9])&apos;</span><span class="p">,</span> <span class="s1">&apos;&apos;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

<span class="c1"># setup listener on UserContact.phone attribute, instructing</span>
<span class="c1"># it to use the return value</span>
<span class="n">listen</span><span class="p">(</span><span class="n">UserContact</span><span class="o">.</span><span class="n">phone</span><span class="p">,</span> <span class="s1">&apos;set&apos;</span><span class="p">,</span> <span class="n">validate_phone</span><span class="p">,</span> <span class="n">retval</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div></div></div><div class="section" id="event-reference"><h2><span class="yiyi-st" id="yiyi-72">&#x4E8B;&#x4EF6;&#x53C2;&#x8003;<a class="headerlink" href="#event-reference" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-73">SQLAlchemy Core&#x548C;SQLAlchemy ORM&#x90FD;&#x5177;&#x6709;&#x5404;&#x79CD;&#x5404;&#x6837;&#x7684;&#x4E8B;&#x4EF6;&#x94A9;&#x5B50;&#xFF1A;</span></p><ul class="simple"><li><span class="yiyi-st" id="yiyi-74"><strong>&#x6838;&#x5FC3;&#x4E8B;&#x4EF6;</strong>  - &#x8FD9;&#x4E9B;&#x5185;&#x5BB9;&#x5728;<a class="reference internal" href="events.html"><span>Core Events</span></a>&#x4E2D;&#x8FDB;&#x884C;&#x4E86;&#x63CF;&#x8FF0;&#xFF0C;&#x5E76;&#x5305;&#x542B;&#x7279;&#x5B9A;&#x4E8E;&#x8FDE;&#x63A5;&#x6C60;&#x751F;&#x547D;&#x5468;&#x671F;&#xFF0C;SQL&#x8BED;&#x53E5;&#x6267;&#x884C;&#xFF0C;&#x4E8B;&#x52A1;&#x751F;&#x547D;&#x5468;&#x671F;&#x4EE5;&#x53CA;&#x6A21;&#x5F0F;&#x521B;&#x5EFA;&#x548C;&#x62C6;&#x5378;&#x7684;&#x4E8B;&#x4EF6;&#x6302;&#x94A9;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-75"><strong>ORM Events</strong> - these are described in <a class="reference internal" href="orm_events.html"><span>ORM Events</span></a>, and include event hooks specific to class and attribute instrumentation, object initialization hooks, attribute on-change hooks, session state, flush, and commit hooks, mapper initialization, object/result population, and per-instance persistence hooks.</span></li></ul></div><div class="section" id="api-reference"><h2><span class="yiyi-st" id="yiyi-76">API&#x53C2;&#x8003;<a class="headerlink" href="#api-reference" title="Permalink to this headline">&#xB6;</a></span></h2><dl class="function"><dt id="sqlalchemy.event.listen"><span class="yiyi-st" id="yiyi-77"> <code class="descclassname">sqlalchemy.event.</code><code class="descname">listen</code><span class="sig-paren">(</span><em>target</em>, <em>identifier</em>, <em>fn</em>, <em>*args</em>, <em>**kw</em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.event.listen" title="Permalink to this definition">&#xB6;</a></span></dt><dd><p><span class="yiyi-st" id="yiyi-78">&#x4E3A;&#x7ED9;&#x5B9A;&#x76EE;&#x6807;&#x6CE8;&#x518C;&#x4FA6;&#x542C;&#x5668;&#x51FD;&#x6570;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-79">&#x4F8B;&#x5982;&#x3002;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">event</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.schema</span> <span class="kn">import</span> <span class="n">UniqueConstraint</span>

<span class="k">def</span> <span class="nf">unique_constraint_name</span><span class="p">(</span><span class="n">const</span><span class="p">,</span> <span class="n">table</span><span class="p">):</span>
    <span class="n">const</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;uq_</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
        <span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="nb">list</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">columns</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
    <span class="p">)</span>
<span class="n">event</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span>
        <span class="n">UniqueConstraint</span><span class="p">,</span>
        <span class="s2">&quot;after_parent_attach&quot;</span><span class="p">,</span>
        <span class="n">unique_constraint_name</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-80">&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">once</span></code>&#x53C2;&#x6570;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4EC5;&#x4E3A;&#x7B2C;&#x4E00;&#x6B21;&#x8C03;&#x7528;&#x4E8B;&#x4EF6;&#x8C03;&#x7528;&#x7ED9;&#x5B9A;&#x7684;&#x51FD;&#x6570;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">on_config</span><span class="p">():</span>
    <span class="n">do_config</span><span class="p">()</span>

<span class="n">event</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="n">Mapper</span><span class="p">,</span> <span class="s2">&quot;before_configure&quot;</span><span class="p">,</span> <span class="n">on_config</span><span class="p">,</span> <span class="n">once</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div></div><div class="versionadded"><p><span class="yiyi-st" id="yiyi-81"><span class="versionmodified">&#x7248;&#x672C;0.9.4&#x65B0;&#x589E;&#xFF1A;</span>&#x6DFB;&#x52A0;<code class="docutils literal"><span class="pre">once=True</span></code>&#x81F3;<a class="reference internal" href="#sqlalchemy.event.listen" title="sqlalchemy.event.listen"><code class="xref py py-func docutils literal"><span class="pre">event.listen()</span></code></a>&#x548C;<a class="reference internal" href="#sqlalchemy.event.listens_for" title="sqlalchemy.event.listens_for"><code class="xref py py-func docutils literal"><span class="pre">event.listens_for()</span></code></a></span></p></div><div class="admonition note"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-82">&#x6CE8;&#x610F;</span></p><p><span class="yiyi-st" id="yiyi-83">&#x4E0D;&#x80FD;&#x5728;&#x8FD0;&#x884C;&#x76EE;&#x6807;&#x4E8B;&#x4EF6;&#x7684;&#x540C;&#x65F6;&#x8C03;&#x7528;<a class="reference internal" href="#sqlalchemy.event.listen" title="sqlalchemy.event.listen"><code class="xref py py-func docutils literal"><span class="pre">listen()</span></code></a>&#x51FD;&#x6570;&#x3002;</span><span class="yiyi-st" id="yiyi-84">&#x8FD9;&#x5BF9;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x6027;&#x6709;&#x5F71;&#x54CD;&#xFF0C;&#x4E5F;&#x610F;&#x5473;&#x7740;&#x4E8B;&#x4EF6;&#x4E0D;&#x80FD;&#x4ECE;&#x4FA6;&#x542C;&#x5668;&#x51FD;&#x6570;&#x5185;&#x90E8;&#x6DFB;&#x52A0;&#x3002;</span><span class="yiyi-st" id="yiyi-85">&#x8981;&#x8FD0;&#x884C;&#x7684;&#x4E8B;&#x4EF6;&#x5217;&#x8868;&#x5B58;&#x5728;&#x4E8E;&#x53EF;&#x8FED;&#x4EE3;&#x96C6;&#x5408;&#x4E2D;&#xFF0C;&#x4E0D;&#x80FD;&#x5728;&#x8FED;&#x4EE3;&#x8FC7;&#x7A0B;&#x4E2D;&#x8FDB;&#x884C;&#x66F4;&#x6539;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-86">&#x4E8B;&#x4EF6;&#x6CE8;&#x518C;&#x548C;&#x5220;&#x9664;&#x4E0D;&#x662F;&#x201C;&#x9AD8;&#x901F;&#x201D;&#x64CD;&#x4F5C;&#xFF1B;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x914D;&#x7F6E;&#x64CD;&#x4F5C;&#x3002;</span><span class="yiyi-st" id="yiyi-87">&#x5BF9;&#x4E8E;&#x9700;&#x8981;&#x5FEB;&#x901F;&#x5173;&#x8054;&#x548C;&#x53D6;&#x6D88;&#x9AD8;&#x7EA7;&#x4E8B;&#x4EF6;&#x7684;&#x7CFB;&#x7EDF;&#xFF0C;&#x8BF7;&#x4F7F;&#x7528;&#x4ECE;&#x5355;&#x4E2A;&#x4FA6;&#x542C;&#x5668;&#x5185;&#x90E8;&#x5904;&#x7406;&#x7684;&#x53EF;&#x53D8;&#x7ED3;&#x6784;&#x3002;</span></p><div class="last versionchanged"><p><span class="yiyi-st" id="yiyi-88"><span class="versionmodified">&#x5728;&#x7248;&#x672C;1.0.0&#x4E2D;&#x66F4;&#x6539;&#xFF1A;</span>  - &#x73B0;&#x5728;&#x5C06;<code class="docutils literal"><span class="pre">collections.deque()</span></code>&#x5BF9;&#x8C61;&#x7528;&#x4F5C;&#x4E8B;&#x4EF6;&#x5217;&#x8868;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x8FD9;&#x4E9B;&#x5BB9;&#x5668;&#x663E;&#x5F0F;&#x7981;&#x6B62;&#x96C6;&#x5408;&#x7A81;&#x53D8;&#x88AB;&#x8FED;&#x4EE3;&#x3002;</span></p></div></div><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-89">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p><span class="yiyi-st" id="yiyi-90"><a class="reference internal" href="#sqlalchemy.event.listens_for" title="sqlalchemy.event.listens_for"><code class="xref py py-func docutils literal"><span class="pre">listens_for()</span></code></a></span></p><p class="last"><span class="yiyi-st" id="yiyi-91"><a class="reference internal" href="#sqlalchemy.event.remove" title="sqlalchemy.event.remove"><code class="xref py py-func docutils literal"><span class="pre">remove()</span></code></a></span></p></div></dd></dl><dl class="function"><dt id="sqlalchemy.event.listens_for"><span class="yiyi-st" id="yiyi-92"> <code class="descclassname">sqlalchemy.event.</code><code class="descname">listens_for</code><span class="sig-paren">(</span><em>target</em>, <em>identifier</em>, <em>*args</em>, <em>**kw</em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.event.listens_for" title="Permalink to this definition">&#xB6;</a></span></dt><dd><p><span class="yiyi-st" id="yiyi-93">&#x88C5;&#x9970;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x4F5C;&#x4E3A;&#x7ED9;&#x5B9A;&#x76EE;&#x6807;+&#x6807;&#x8BC6;&#x7B26;&#x7684;&#x4FA6;&#x542C;&#x5668;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-94">&#x4F8B;&#x5982;&#x3002;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">event</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.schema</span> <span class="kn">import</span> <span class="n">UniqueConstraint</span>

<span class="nd">@event.listens_for</span><span class="p">(</span><span class="n">UniqueConstraint</span><span class="p">,</span> <span class="s2">&quot;after_parent_attach&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">unique_constraint_name</span><span class="p">(</span><span class="n">const</span><span class="p">,</span> <span class="n">table</span><span class="p">):</span>
    <span class="n">const</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;uq_</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
        <span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="nb">list</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">columns</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
    <span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-95">&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">once</span></code>&#x53C2;&#x6570;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4EC5;&#x4E3A;&#x7B2C;&#x4E00;&#x6B21;&#x8C03;&#x7528;&#x4E8B;&#x4EF6;&#x8C03;&#x7528;&#x7ED9;&#x5B9A;&#x7684;&#x51FD;&#x6570;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@event.listens_for</span><span class="p">(</span><span class="n">Mapper</span><span class="p">,</span> <span class="s2">&quot;before_configure&quot;</span><span class="p">,</span> <span class="n">once</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">on_config</span><span class="p">():</span>
    <span class="n">do_config</span><span class="p">()</span></pre></div></div><div class="versionadded"><p><span class="yiyi-st" id="yiyi-96"><span class="versionmodified">&#x7248;&#x672C;0.9.4&#x65B0;&#x589E;&#xFF1A;</span>&#x6DFB;&#x52A0;<code class="docutils literal"><span class="pre">once=True</span></code>&#x81F3;<a class="reference internal" href="#sqlalchemy.event.listen" title="sqlalchemy.event.listen"><code class="xref py py-func docutils literal"><span class="pre">event.listen()</span></code></a>&#x548C;<a class="reference internal" href="#sqlalchemy.event.listens_for" title="sqlalchemy.event.listens_for"><code class="xref py py-func docutils literal"><span class="pre">event.listens_for()</span></code></a></span></p></div><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-97">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-98"><a class="reference internal" href="#sqlalchemy.event.listen" title="sqlalchemy.event.listen"><code class="xref py py-func docutils literal"><span class="pre">listen()</span></code></a>  - &#x4E8B;&#x4EF6;&#x76D1;&#x542C;&#x7684;&#x4E00;&#x822C;&#x63CF;&#x8FF0;</span></p></div></dd></dl><dl class="function"><dt id="sqlalchemy.event.remove"><span class="yiyi-st" id="yiyi-99"> <code class="descclassname">sqlalchemy.event.</code><code class="descname">remove</code><span class="sig-paren">(</span><em>target</em>, <em>identifier</em>, <em>fn</em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.event.remove" title="Permalink to this definition">&#xB6;</a></span></dt><dd><p><span class="yiyi-st" id="yiyi-100">&#x5220;&#x9664;&#x4E00;&#x4E2A;&#x4E8B;&#x4EF6;&#x76D1;&#x542C;&#x5668;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-101">&#x8FD9;&#x91CC;&#x7684;&#x53C2;&#x6570;&#x5E94;&#x8BE5;&#x4E0E;&#x53D1;&#x9001;&#x5230;<a class="reference internal" href="#sqlalchemy.event.listen" title="sqlalchemy.event.listen"><code class="xref py py-func docutils literal"><span class="pre">listen()</span></code></a>&#x7684;&#x53C2;&#x6570;&#x5B8C;&#x5168;&#x5339;&#x914D;&#x3002;&#x6240;&#x6709;&#x901A;&#x8FC7;&#x6B64;&#x8C03;&#x7528;&#x8FDB;&#x884C;&#x7684;&#x4E8B;&#x4EF6;&#x6CE8;&#x518C;&#x5C06;&#x901A;&#x8FC7;&#x4F7F;&#x7528;&#x76F8;&#x540C;&#x53C2;&#x6570;&#x8C03;&#x7528;<a class="reference internal" href="#sqlalchemy.event.remove" title="sqlalchemy.event.remove"><code class="xref py py-func docutils literal"><span class="pre">remove()</span></code></a>&#x8FDB;&#x884C;&#x6062;&#x590D;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-102">&#x4F8B;&#x5982;&#x3002;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># if a function was registered like this...</span>
<span class="nd">@event.listens_for</span><span class="p">(</span><span class="n">SomeMappedClass</span><span class="p">,</span> <span class="s2">&quot;before_insert&quot;</span><span class="p">,</span> <span class="n">propagate</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_listener_function</span><span class="p">(</span><span class="o">*</span><span class="n">arg</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="c1"># ... it&apos;s removed like this</span>
<span class="n">event</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">SomeMappedClass</span><span class="p">,</span> <span class="s2">&quot;before_insert&quot;</span><span class="p">,</span> <span class="n">my_listener_function</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-103">&#x5728;&#x4E0A;&#x9762;&#xFF0C;&#x4E0E;<code class="docutils literal"><span class="pre">SomeMappedClass</span></code>&#x5173;&#x8054;&#x7684;&#x4FA6;&#x542C;&#x5668;&#x51FD;&#x6570;&#x4E5F;&#x88AB;&#x4F20;&#x64AD;&#x7ED9;<code class="docutils literal"><span class="pre">SomeMappedClass</span></code>&#x7684;&#x5B50;&#x7C7B;&#x3002; <a class="reference internal" href="#sqlalchemy.event.remove" title="sqlalchemy.event.remove"><code class="xref py py-func docutils literal"><span class="pre">remove()</span></code></a>&#x51FD;&#x6570;&#x5C06;&#x6062;&#x590D;&#x6240;&#x6709;&#x8FD9;&#x4E9B;&#x64CD;&#x4F5C;&#x3002;</span></p><div class="versionadded"><p><span class="yiyi-st" id="yiyi-104"><span class="versionmodified">&#x7248;&#x672C;0.9.0&#x4E2D;&#x7684;&#x65B0;&#x529F;&#x80FD;</span></span></p></div><div class="admonition note"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-105">&#x6CE8;&#x610F;</span></p><p><span class="yiyi-st" id="yiyi-106"><a class="reference internal" href="#sqlalchemy.event.remove" title="sqlalchemy.event.remove"><code class="xref py py-func docutils literal"><span class="pre">remove()</span></code></a>&#x51FD;&#x6570;&#x4E0D;&#x80FD;&#x5728;&#x76EE;&#x6807;&#x4E8B;&#x4EF6;&#x8FD0;&#x884C;&#x7684;&#x540C;&#x65F6;&#x88AB;&#x8C03;&#x7528;&#x3002;</span><span class="yiyi-st" id="yiyi-107">&#x8FD9;&#x5BF9;&#x7EBF;&#x7A0B;&#x7684;&#x5B89;&#x5168;&#x6027;&#x6709;&#x5F71;&#x54CD;&#xFF0C;&#x4E5F;&#x610F;&#x5473;&#x7740;&#x4E00;&#x4E2A;&#x4E8B;&#x4EF6;&#x4E0D;&#x80FD;&#x4ECE;listener&#x51FD;&#x6570;&#x5185;&#x90E8;&#x79FB;&#x9664;&#x3002;</span><span class="yiyi-st" id="yiyi-108">&#x8981;&#x8FD0;&#x884C;&#x7684;&#x4E8B;&#x4EF6;&#x5217;&#x8868;&#x5B58;&#x5728;&#x4E8E;&#x53EF;&#x8FED;&#x4EE3;&#x96C6;&#x5408;&#x4E2D;&#xFF0C;&#x4E0D;&#x80FD;&#x5728;&#x8FED;&#x4EE3;&#x8FC7;&#x7A0B;&#x4E2D;&#x8FDB;&#x884C;&#x66F4;&#x6539;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-109">&#x4E8B;&#x4EF6;&#x6CE8;&#x518C;&#x548C;&#x5220;&#x9664;&#x4E0D;&#x662F;&#x201C;&#x9AD8;&#x901F;&#x201D;&#x64CD;&#x4F5C;&#xFF1B;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x914D;&#x7F6E;&#x64CD;&#x4F5C;&#x3002;</span><span class="yiyi-st" id="yiyi-110">&#x5BF9;&#x4E8E;&#x9700;&#x8981;&#x5FEB;&#x901F;&#x5173;&#x8054;&#x548C;&#x53D6;&#x6D88;&#x9AD8;&#x7EA7;&#x4E8B;&#x4EF6;&#x7684;&#x7CFB;&#x7EDF;&#xFF0C;&#x8BF7;&#x4F7F;&#x7528;&#x4ECE;&#x5355;&#x4E2A;&#x4FA6;&#x542C;&#x5668;&#x5185;&#x90E8;&#x5904;&#x7406;&#x7684;&#x53EF;&#x53D8;&#x7ED3;&#x6784;&#x3002;</span></p><div class="last versionchanged"><p><span class="yiyi-st" id="yiyi-111"><span class="versionmodified">&#x5728;&#x7248;&#x672C;1.0.0&#x4E2D;&#x66F4;&#x6539;&#xFF1A;</span>  - &#x73B0;&#x5728;&#x5C06;<code class="docutils literal"><span class="pre">collections.deque()</span></code>&#x5BF9;&#x8C61;&#x7528;&#x4F5C;&#x4E8B;&#x4EF6;&#x5217;&#x8868;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x8FD9;&#x4E9B;&#x5BB9;&#x5668;&#x663E;&#x5F0F;&#x7981;&#x6B62;&#x96C6;&#x5408;&#x7A81;&#x53D8;&#x88AB;&#x8FED;&#x4EE3;&#x3002;</span></p></div></div><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-112">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-113"><a class="reference internal" href="#sqlalchemy.event.listen" title="sqlalchemy.event.listen"><code class="xref py py-func docutils literal"><span class="pre">listen()</span></code></a></span></p></div></dd></dl><dl class="function"><dt id="sqlalchemy.event.contains"><span class="yiyi-st" id="yiyi-114"> <code class="descclassname">sqlalchemy.event.</code><code class="descname">contains</code><span class="sig-paren">(</span><em>target</em>, <em>identifier</em>, <em>fn</em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.event.contains" title="Permalink to this definition">&#xB6;</a></span></dt><dd><p><span class="yiyi-st" id="yiyi-115">&#x5982;&#x679C;&#x7ED9;&#x5B9A;&#x7684;target / ident / fn&#x8BBE;&#x7F6E;&#x4E3A;&#x4FA6;&#x542C;&#xFF0C;&#x5219;&#x8FD4;&#x56DE;True&#x3002;</span></p><div class="versionadded"><p><span class="yiyi-st" id="yiyi-116"><span class="versionmodified">&#x7248;&#x672C;0.9.0&#x4E2D;&#x7684;&#x65B0;&#x529F;&#x80FD;</span></span></p></div></dd></dl></div>