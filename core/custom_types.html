<h1><span class="yiyi-st" id="yiyi-48">&#x81EA;&#x5B9A;&#x4E49;&#x7C7B;&#x578B;<a class="headerlink" href="#custom-types" title="Permalink to this headline">&#xB6;</a></span></h1><p><span class="yiyi-st" id="yiyi-49">&#x5B58;&#x5728;&#x591A;&#x79CD;&#x65B9;&#x6CD5;&#x6765;&#x91CD;&#x65B0;&#x5B9A;&#x4E49;&#x73B0;&#x6709;&#x7C7B;&#x578B;&#x7684;&#x884C;&#x4E3A;&#x5E76;&#x63D0;&#x4F9B;&#x65B0;&#x7684;&#x7C7B;&#x578B;&#x3002;</span></p><div class="section" id="overriding-type-compilation"><h2><span class="yiyi-st" id="yiyi-50">&#x91CD;&#x5199;&#x7C7B;&#x578B;&#x7F16;&#x8BD1;<a class="headerlink" href="#overriding-type-compilation" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-51">&#x7ECF;&#x5E38;&#x9700;&#x8981;&#x5F3A;&#x5236;&#x66F4;&#x6539;&#x7C7B;&#x578B;&#x7684;&#x201C;&#x5B57;&#x7B26;&#x4E32;&#x201D;&#x7248;&#x672C;&#xFF0C;&#x5373;&#x5728;CREATE TABLE&#x8BED;&#x53E5;&#x6216;&#x5176;&#x4ED6;SQL&#x51FD;&#x6570;&#xFF08;&#x5982;CAST&#xFF09;&#x4E2D;&#x5448;&#x73B0;&#x7684;&#x7C7B;&#x578B;&#x3002;</span><span class="yiyi-st" id="yiyi-52">&#x4F8B;&#x5982;&#xFF0C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x53EF;&#x80FD;&#x5E0C;&#x671B;&#x5F3A;&#x5236;&#x4E3A;&#x6240;&#x6709;&#x5E73;&#x53F0;&#x5448;&#x73B0;<code class="docutils literal"><span class="pre">BINARY</span></code>&#xFF0C;&#x9664;&#x4E86;&#x8981;&#x5448;&#x73B0;&#x5176;&#x4E2D;&#x7684;<code class="docutils literal"><span class="pre">BLOB</span></code>&#x4E4B;&#x5916;&#x7684;&#x6240;&#x6709;&#x5E73;&#x53F0;&#x3002;</span><span class="yiyi-st" id="yiyi-53">&#x5BF9;&#x4E8E;&#x5927;&#x591A;&#x6570;&#x4F7F;&#x7528;&#x60C5;&#x51B5;&#xFF0C;&#x73B0;&#x6709;&#x6CDB;&#x578B;&#x7C7B;&#x578B;&#xFF08;&#x5728;&#x672C;&#x4F8B;&#x4E2D;&#x4E3A;<a class="reference internal" href="type_basics.html#sqlalchemy.types.LargeBinary" title="sqlalchemy.types.LargeBinary"><code class="xref py py-class docutils literal"><span class="pre">LargeBinary</span></code></a>&#xFF09;&#x7684;&#x4F7F;&#x7528;&#x662F;&#x9996;&#x9009;&#x3002;</span><span class="yiyi-st" id="yiyi-54">&#x4F46;&#x4E3A;&#x4E86;&#x66F4;&#x51C6;&#x786E;&#x5730;&#x63A7;&#x5236;&#x7C7B;&#x578B;&#xFF0C;&#x6BCF;&#x4E2A;&#x65B9;&#x8A00;&#x7684;&#x7F16;&#x8BD1;&#x6307;&#x4EE4;&#x53EF;&#x4EE5;&#x4E0E;&#x4EFB;&#x4F55;&#x7C7B;&#x578B;&#x76F8;&#x5173;&#x8054;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.ext.compiler</span> <span class="kn">import</span> <span class="n">compiles</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.types</span> <span class="kn">import</span> <span class="n">BINARY</span>

<span class="nd">@compiles</span><span class="p">(</span><span class="n">BINARY</span><span class="p">,</span> <span class="s2">&quot;sqlite&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">compile_binary_sqlite</span><span class="p">(</span><span class="n">type_</span><span class="p">,</span> <span class="n">compiler</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;BLOB&quot;</span></pre></div></div><p><span class="yiyi-st" id="yiyi-55">&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x5141;&#x8BB8;&#x4F7F;&#x7528;<a class="reference internal" href="type_basics.html#sqlalchemy.types.BINARY" title="sqlalchemy.types.BINARY"><code class="xref py py-class docutils literal"><span class="pre">types.BINARY</span></code></a>&#xFF0C;&#x5B83;&#x5C06;&#x9488;&#x5BF9;&#x9664;SQLite&#x4EE5;&#x5916;&#x7684;&#x6240;&#x6709;&#x540E;&#x7AEF;&#x751F;&#x6210;&#x5B57;&#x7B26;&#x4E32;<code class="docutils literal"><span class="pre">BINARY</span></code>&#xFF0C;&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5B83;&#x5C06;&#x751F;&#x6210;<code class="docutils literal"><span class="pre">BLOB</span></code></span></p><p><span class="yiyi-st" id="yiyi-56">&#x6709;&#x5173;&#x5176;&#x4ED6;&#x793A;&#x4F8B;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a class="reference internal" href="compiler.html#type-compilation-extension"><span>Changing Compilation of Types</span></a>&#x4E00;&#x8282;&#xFF08;<a class="reference internal" href="compiler.html"><span>Custom SQL Constructs and Compilation Extension</span></a>&#x7684;&#x5C0F;&#x8282;&#xFF09;&#x3002;</span></p></div><div class="section" id="augmenting-existing-types"><h2><span class="yiyi-st" id="yiyi-57">&#x589E;&#x52A0;&#x73B0;&#x6709;&#x7C7B;&#x578B;<a class="headerlink" href="#augmenting-existing-types" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-58"><a class="reference internal" href="#sqlalchemy.types.TypeDecorator" title="sqlalchemy.types.TypeDecorator"><code class="xref py py-class docutils literal"><span class="pre">TypeDecorator</span></code></a>&#x5141;&#x8BB8;&#x521B;&#x5EFA;&#x81EA;&#x5B9A;&#x4E49;&#x7C7B;&#x578B;&#xFF0C;&#x5C06;&#x7ED1;&#x5B9A;&#x53C2;&#x6570;&#x548C;&#x7ED3;&#x679C;&#x5904;&#x7406;&#x884C;&#x4E3A;&#x6DFB;&#x52A0;&#x5230;&#x73B0;&#x6709;&#x7684;&#x7C7B;&#x578B;&#x5BF9;&#x8C61;&#x3002;</span><span class="yiyi-st" id="yiyi-59">&#x5F53;&#x9700;&#x8981;&#x5BF9;&#x6570;&#x636E;&#x5E93;&#x8FDB;&#x884C;&#x989D;&#x5916;&#x7684;Python&#x6570;&#x636E;&#x5C01;&#x9001;&#x5904;&#x7406;&#x65F6;&#x4F7F;&#x7528;&#x5B83;&#x3002;</span></p><div class="admonition note"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-60">&#x6CE8;&#x610F;</span></p><p class="last"><span class="yiyi-st" id="yiyi-61">The bind- and result-processing of <a class="reference internal" href="#sqlalchemy.types.TypeDecorator" title="sqlalchemy.types.TypeDecorator"><code class="xref py py-class docutils literal"><span class="pre">TypeDecorator</span></code></a> is <em>in addition</em> to the processing already performed by the hosted type, which is customized by SQLAlchemy on a per-DBAPI basis to perform processing specific to that DBAPI. </span><span class="yiyi-st" id="yiyi-62">&#x8981;&#x66F4;&#x6539;&#x73B0;&#x6709;&#x7C7B;&#x578B;&#x7684;DBAPI&#x7EA7;&#x5904;&#x7406;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a class="reference internal" href="#replacing-processors"><span>Replacing the Bind/Result Processing of Existing Types</span></a>&#x90E8;&#x5206;&#x3002;</span></p></div><dl class="class"><dt id="sqlalchemy.types.TypeDecorator"><span class="yiyi-st" id="yiyi-63"> <em class="property">class </em><code class="descclassname">sqlalchemy.types.</code><code class="descname">TypeDecorator</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.types.TypeDecorator" title="Permalink to this definition">&#xB6;</a></span></dt><dd><p><span class="yiyi-st" id="yiyi-64">&#x57FA;&#x7840;&#xFF1A;<code class="xref py py-class docutils literal"><span class="pre">sqlalchemy.sql.expression.SchemaEventTarget</span></code>&#xFF0C;<a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal"><span class="pre">sqlalchemy.types.TypeEngine</span></code></a></span></p><p><span class="yiyi-st" id="yiyi-65">&#x5141;&#x8BB8;&#x521B;&#x5EFA;&#x5411;&#x73B0;&#x6709;&#x7C7B;&#x578B;&#x6DFB;&#x52A0;&#x9644;&#x52A0;&#x529F;&#x80FD;&#x7684;&#x7C7B;&#x578B;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-66">&#x6B64;&#x65B9;&#x6CD5;&#x4F18;&#x5148;&#x4E8E;&#x6307;&#x5B9A;SQLAlchemy&#x5185;&#x7F6E;&#x7C7B;&#x578B;&#x7684;&#x5B50;&#x7C7B;&#x5316;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x786E;&#x4FDD;&#x6240;&#x6709;&#x5FC5;&#x9700;&#x7684;&#x57FA;&#x7840;&#x7C7B;&#x578B;&#x529F;&#x80FD;&#x90FD;&#x4FDD;&#x7559;&#x5728;&#x539F;&#x4F4D;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-67">&#x5178;&#x578B;&#x7528;&#x6CD5;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlalchemy.types</span> <span class="kn">as</span> <span class="nn">types</span>

<span class="k">class</span> <span class="nc">MyType</span><span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">TypeDecorator</span><span class="p">):</span>
    <span class="sd">&apos;&apos;&apos;Prefixes Unicode values with &quot;PREFIX:&quot; on the way in and</span>
<span class="sd">    strips it off on the way out.</span>
<span class="sd">    &apos;&apos;&apos;</span>

    <span class="n">impl</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">Unicode</span>

    <span class="k">def</span> <span class="nf">process_bind_param</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">dialect</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;PREFIX:&quot;</span> <span class="o">+</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">process_result_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">dialect</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span><span class="p">[</span><span class="mi">7</span><span class="p">:]</span>

    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">MyType</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">impl</span><span class="o">.</span><span class="n">length</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-68">&#x7C7B;&#x7EA7;&#x522B;&#x7684;&#x201C;impl&#x201D;&#x5C5E;&#x6027;&#x662F;&#x5FC5;&#x9700;&#x7684;&#xFF0C;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x5F15;&#x7528;&#x4EFB;&#x4F55;TypeEngine&#x7C7B;&#x3002;</span><span class="yiyi-st" id="yiyi-69">&#x6216;&#x8005;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;load_dialect_impl()&#x65B9;&#x6CD5;&#x6839;&#x636E;&#x7ED9;&#x5B9A;&#x7684;&#x65B9;&#x8A00;&#x63D0;&#x4F9B;&#x4E0D;&#x540C;&#x7684;&#x7C7B;&#x578B;&#x7C7B;&#xFF1B;&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x201C;impl&#x201D;&#x53D8;&#x91CF;&#x53EF;&#x4EE5;&#x5F15;&#x7528;<code class="docutils literal"><span class="pre">TypeEngine</span></code>&#x4F5C;&#x4E3A;&#x5360;&#x4F4D;&#x7B26;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-70">&#x63A5;&#x6536;&#x4E0E;&#x6240;&#x4F7F;&#x7528;&#x7684;&#x6700;&#x7EC8;&#x7C7B;&#x578B;&#x4E0D;&#x76F8;&#x4F3C;&#x7684;Python&#x7C7B;&#x578B;&#x7684;&#x7C7B;&#x578B;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x5B9A;&#x4E49;<a class="reference internal" href="#sqlalchemy.types.TypeDecorator.coerce_compared_value" title="sqlalchemy.types.TypeDecorator.coerce_compared_value"><code class="xref py py-meth docutils literal"><span class="pre">TypeDecorator.coerce_compared_value()</span></code></a>&#x65B9;&#x6CD5;&#x3002;</span><span class="yiyi-st" id="yiyi-71">&#x8FD9;&#x7528;&#x4E8E;&#x5728;&#x5C06;&#x8868;&#x8FBE;&#x5F0F;&#x4E2D;&#x7684;Python&#x5BF9;&#x8C61;&#x5F3A;&#x5236;&#x4E3A;&#x7ED1;&#x5B9A;&#x53C2;&#x6570;&#x65F6;&#x4E3A;&#x8868;&#x8FBE;&#x5F0F;&#x7CFB;&#x7EDF;&#x63D0;&#x4F9B;&#x63D0;&#x793A;&#x3002;</span><span class="yiyi-st" id="yiyi-72">&#x8003;&#x8651;&#x8FD9;&#x4E2A;&#x8868;&#x8FBE;&#x5F0F;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">mytable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">somecol</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-73">&#x5728;&#x4E0A;&#x9762;&#xFF0C;&#x5982;&#x679C;&#x201C;somecol&#x201D;&#x662F;&#x4E00;&#x4E2A;<code class="docutils literal"><span class="pre">Integer</span></code>&#x53D8;&#x4F53;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x5728;&#x505A;&#x65E5;&#x671F;&#x7B97;&#x672F;&#x662F;&#x6709;&#x610F;&#x4E49;&#x7684;&#xFF0C;&#x4E0A;&#x9762;&#x7684;&#x6570;&#x636E;&#x901A;&#x5E38;&#x88AB;&#x6570;&#x636E;&#x5E93;&#x89E3;&#x91CA;&#x4E3A;&#x7ED9;&#x7ED9;&#x5B9A;&#x65E5;&#x671F;&#x6DFB;&#x52A0;&#x4E86;&#x51E0;&#x5929;&#x3002;</span><span class="yiyi-st" id="yiyi-74">&#x8868;&#x8FBE;&#x5F0F;&#x7CFB;&#x7EDF;&#x901A;&#x8FC7;&#x4E0D;&#x5C1D;&#x8BD5;&#x5C06;&#x201C;date()&#x201D;&#x503C;&#x5F3A;&#x5236;&#x4E3A;&#x9762;&#x5411;&#x6574;&#x6570;&#x7684;&#x7ED1;&#x5B9A;&#x53C2;&#x6570;&#x6765;&#x505A;&#x6B63;&#x786E;&#x7684;&#x4E8B;&#x60C5;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-75">&#x4F46;&#x662F;&#xFF0C;&#x5728;<code class="docutils literal"><span class="pre">TypeDecorator</span></code>&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x5E38;&#x5C06;&#x4F20;&#x5165;&#x7684;Python&#x7C7B;&#x578B;&#x66F4;&#x6539;&#x4E3A;&#x65B0;&#x7684; -  <code class="docutils literal"><span class="pre">TypeDecorator</span></code>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#x4F1A;&#x201C;&#x5F3A;&#x5236;&#x201D;&#x975E;&#x7C7B;&#x578B;&#x4FA7;&#x662F;&#x76F8;&#x540C;&#x7684;&#x952E;&#x5165;&#x672C;&#x8EAB;&#x3002;</span><span class="yiyi-st" id="yiyi-76">&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF0C;&#x6211;&#x4EEC;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x201C;&#x7EAA;&#x5143;&#x201D;&#x7C7B;&#x578B;&#xFF0C;&#x5B83;&#x5C06;&#x65E5;&#x671F;&#x503C;&#x5B58;&#x50A8;&#x4E3A;&#x6574;&#x6570;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyEpochType</span><span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">TypeDecorator</span><span class="p">):</span>
    <span class="n">impl</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">Integer</span>

    <span class="n">epoch</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">1970</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">process_bind_param</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">dialect</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">epoch</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>

    <span class="k">def</span> <span class="nf">process_result_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">dialect</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">epoch</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">value</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-77">Our expression of <code class="docutils literal"><span class="pre">somecol</span> <span class="pre">+</span> <span class="pre">date</span></code> with the above type will coerce the &#x201C;date&#x201D; on the right side to also be treated as <code class="docutils literal"><span class="pre">MyEpochType</span></code>.</span></p><p><span class="yiyi-st" id="yiyi-78">&#x6B64;&#x884C;&#x4E3A;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<a class="reference internal" href="#sqlalchemy.types.TypeDecorator.coerce_compared_value" title="sqlalchemy.types.TypeDecorator.coerce_compared_value"><code class="xref py py-meth docutils literal"><span class="pre">coerce_compared_value()</span></code></a>&#x65B9;&#x6CD5;&#x8986;&#x76D6;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#x5E94;&#x8BE5;&#x7528;&#x4E8E;&#x8868;&#x8FBE;&#x5F0F;&#x503C;&#x7684;&#x7C7B;&#x578B;&#x3002;</span><span class="yiyi-st" id="yiyi-79">&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x5C06;&#x5B83;&#x8BBE;&#x7F6E;&#x4E3A;&#x6574;&#x6570;&#x503C;&#x5C06;&#x88AB;&#x89C6;&#x4E3A;&#x4E00;&#x4E2A;<code class="docutils literal"><span class="pre">Integer</span></code>&#xFF0C;&#x5E76;&#x4E14;&#x4EFB;&#x4F55;&#x5176;&#x4ED6;&#x503C;&#x88AB;&#x5047;&#x5B9A;&#x4E3A;&#x65E5;&#x671F;&#x5E76;&#x4E14;&#x5C06;&#x88AB;&#x89C6;&#x4E3A;<code class="docutils literal"><span class="pre">MyEpochType</span></code>&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">coerce_compared_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Integer</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span></pre></div></div><div class="admonition warning"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-80">&#x8B66;&#x544A;</span></p><p><span class="yiyi-st" id="yiyi-81">&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;coerce_compared_value&#x7684;<strong>&#x884C;&#x4E3A;&#x9ED8;&#x8BA4;&#x4E0D;&#x4F1A;&#x4ECE;&#x57FA;&#x7C7B;&#x578B;</strong>&#x7684;&#x884C;&#x4E3A;&#x7EE7;&#x627F;&#x3002;</span><span class="yiyi-st" id="yiyi-82">&#x5982;&#x679C;<a class="reference internal" href="#sqlalchemy.types.TypeDecorator" title="sqlalchemy.types.TypeDecorator"><code class="xref py py-class docutils literal"><span class="pre">TypeDecorator</span></code></a>&#x589E;&#x52A0;&#x4E86;&#x67D0;&#x79CD;&#x7C7B;&#x578B;&#x7684;&#x64CD;&#x4F5C;&#x7B26;&#x9700;&#x8981;&#x7279;&#x6B8A;&#x903B;&#x8F91;&#x7684;&#x7C7B;&#x578B;&#xFF0C;&#x5219;&#x5FC5;&#x987B;&#x91CD;&#x5199;&#x6B64;&#x65B9;&#x6CD5;<strong></strong>&#x3002;</span><span class="yiyi-st" id="yiyi-83">&#x4E00;&#x4E2A;&#x5173;&#x952E;&#x7684;&#x4F8B;&#x5B50;&#x662F;&#x88C5;&#x9970;<a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.JSON" title="sqlalchemy.dialects.postgresql.JSON"><code class="xref py py-class docutils literal"><span class="pre">postgresql.JSON</span></code></a>&#x548C;<a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.JSONB" title="sqlalchemy.dialects.postgresql.JSONB"><code class="xref py py-class docutils literal"><span class="pre">postgresql.JSONB</span></code></a>&#x7C7B;&#x578B;&#xFF1B;&#x5E94;&#x8BE5;&#x4F7F;&#x7528;<a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine.coerce_compared_value" title="sqlalchemy.types.TypeEngine.coerce_compared_value"><code class="xref py py-meth docutils literal"><span class="pre">TypeEngine.coerce_compared_value()</span></code></a>&#x7684;&#x9ED8;&#x8BA4;&#x89C4;&#x5219;&#x6765;&#x5904;&#x7406;&#x50CF;&#x7D22;&#x5F15;&#x64CD;&#x4F5C;&#x8FD9;&#x6837;&#x7684;&#x64CD;&#x4F5C;&#x7B26;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyJsonType</span><span class="p">(</span><span class="n">TypeDecorator</span><span class="p">):</span>
    <span class="n">impl</span> <span class="o">=</span> <span class="n">postgresql</span><span class="o">.</span><span class="n">JSON</span>

    <span class="k">def</span> <span class="nf">coerce_compared_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">impl</span><span class="o">.</span><span class="n">coerce_compared_value</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></pre></div></div><p class="last"><span class="yiyi-st" id="yiyi-84">&#x5982;&#x679C;&#x6CA1;&#x6709;&#x4E0A;&#x8FF0;&#x6B65;&#x9AA4;&#xFF0C;&#x50CF;<code class="docutils literal"><span class="pre">mycol[&apos;foo&apos;]</span></code>&#x8FD9;&#x6837;&#x7684;&#x7D22;&#x5F15;&#x64CD;&#x4F5C;&#x5C06;&#x5BFC;&#x81F4;&#x7D22;&#x5F15;&#x503C;<code class="docutils literal"><span class="pre">&apos;foo&apos;</span></code>&#x8FDB;&#x884C;JSON&#x7F16;&#x7801;&#x3002;</span></p></div><dl class="method"><dt id="sqlalchemy.types.TypeDecorator.__init__"><span class="yiyi-st" id="yiyi-85"><code class="descname">__ init __</code> <span class="sig-paren">&#xFF08;</span> <em>* args</em>&#xFF0C;<em>** kwargs</em> <span class="sig-paren">&#xFF09;</span> <a class="headerlink" href="#sqlalchemy.types.TypeDecorator.__init__" title="Permalink to this definition">T5&gt;</a></span></dt><dd><p><span class="yiyi-st" id="yiyi-86">&#x6784;&#x5EFA;&#x4E00;&#x4E2A;<a class="reference internal" href="#sqlalchemy.types.TypeDecorator" title="sqlalchemy.types.TypeDecorator"><code class="xref py py-class docutils literal"><span class="pre">TypeDecorator</span></code></a>&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-87">Arguments sent here are passed to the constructor of the class assigned to the <code class="docutils literal"><span class="pre">impl</span></code> class level attribute, assuming the <code class="docutils literal"><span class="pre">impl</span></code> is a callable, and the resulting object is assigned to the <code class="docutils literal"><span class="pre">self.impl</span></code> instance attribute (thus overriding the class attribute of the same name).</span></p><p><span class="yiyi-st" id="yiyi-88">&#x5982;&#x679C;&#x7C7B;&#x7EA7;&#x522B;<code class="docutils literal"><span class="pre">impl</span></code>&#x4E0D;&#x662F;&#x53EF;&#x8C03;&#x7528;&#x7684;&#xFF08;&#x4E0D;&#x5BFB;&#x5E38;&#x7684;&#x60C5;&#x51B5;&#xFF09;&#xFF0C;&#x5B83;&#x5C06;&#x88AB;&#x5206;&#x914D;&#x7ED9;&#x540C;&#x6837;&#x7684;&#x5B9E;&#x4F8B;&#x5C5E;&#x6027;&apos;as-is&apos;&#xFF0C;&#x5FFD;&#x7565;&#x4F20;&#x9012;&#x7ED9;&#x6784;&#x9020;&#x51FD;&#x6570;&#x7684;&#x90A3;&#x4E9B;&#x53C2;&#x6570;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-89">&#x5B50;&#x7C7B;&#x53EF;&#x4EE5;&#x8986;&#x76D6;&#x5B83;&#x6765;&#x5B8C;&#x5168;&#x81EA;&#x5B9A;&#x4E49;<code class="docutils literal"><span class="pre">self.impl</span></code>&#x7684;&#x751F;&#x6210;&#x3002;</span></p></dd></dl><dl class="method"><dt id="sqlalchemy.types.TypeDecorator.adapt"><span class="yiyi-st" id="yiyi-90"> <code class="descname">adapt</code><span class="sig-paren">(</span><em>cls</em>, <em>**kw</em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.types.TypeDecorator.adapt" title="Permalink to this definition">&#xB6;</a></span></dt><dd><div class="inherited-member container"><span class="yiyi-st" id="yiyi-91"> <em>inherited from the</em> <a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine.adapt" title="sqlalchemy.types.TypeEngine.adapt"><code class="xref py py-meth docutils literal"><span class="pre">adapt()</span></code></a> <em>method of</em> <a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal"><span class="pre">TypeEngine</span></code></a></span></div><p><span class="yiyi-st" id="yiyi-92">&#x4EA7;&#x751F;&#x8FD9;&#x79CD;&#x7C7B;&#x578B;&#x7684;&#x201C;&#x9002;&#x5E94;&#x201D;&#x5F62;&#x5F0F;&#xFF0C;&#x7ED9;&#x4E88;&#x4E00;&#x4E2A;&#x201C;impl&#x201D;&#x7C7B;&#x6765;&#x5904;&#x7406;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-93">&#x6B64;&#x65B9;&#x6CD5;&#x5728;&#x5185;&#x90E8;&#x7528;&#x4E8E;&#x5C06;&#x6CDB;&#x578B;&#x4E0E;&#x7279;&#x5B9A;&#x4E8E;&#x7279;&#x5B9A;&#x65B9;&#x8A00;&#x7684;&#x201C;&#x5B9E;&#x73B0;&#x201D;&#x7C7B;&#x578B;&#x76F8;&#x5173;&#x8054;&#x3002;</span></p></dd></dl><dl class="method"><dt id="sqlalchemy.types.TypeDecorator.bind_expression"><span class="yiyi-st" id="yiyi-94"><code class="descname"> bind_expression  T0&gt; <span class="sig-paren">&#xFF08; T1&gt; <em> bindvalue  T2&gt; <span class="sig-paren">&#xFF09; T3&gt; <a class="headerlink" href="#sqlalchemy.types.TypeDecorator.bind_expression" title="Permalink to this definition">&#xB6; T4&gt;</a></span></em></span></code></span></dt><dd><div class="inherited-member container"><span class="yiyi-st" id="yiyi-95"> <em>inherited from the</em> <a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine.bind_expression" title="sqlalchemy.types.TypeEngine.bind_expression"><code class="xref py py-meth docutils literal"><span class="pre">bind_expression()</span></code></a> <em>method of</em> <a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal"><span class="pre">TypeEngine</span></code></a></span></div><p><span class="yiyi-st" id="yiyi-96">&#x201C;&#x7ED9;&#x5B9A;&#x4E00;&#x4E2A;&#x7ED1;&#x5B9A;&#x503C;&#xFF08;&#x5373;&#x4E00;&#x4E2A;<a class="reference internal" href="sqlelement.html#sqlalchemy.sql.expression.BindParameter" title="sqlalchemy.sql.expression.BindParameter"><code class="xref py py-class docutils literal"><span class="pre">BindParameter</span></code></a>&#x5B9E;&#x4F8B;&#xFF09;&#xFF0C;&#x5728;&#x5B83;&#x7684;&#x4F4D;&#x7F6E;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;SQL&#x8868;&#x8FBE;&#x5F0F;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-97">&#x8FD9;&#x901A;&#x5E38;&#x662F;&#x4E00;&#x4E2A;&#x5305;&#x542B;&#x8BED;&#x53E5;&#x4E2D;&#x73B0;&#x6709;&#x7ED1;&#x5B9A;&#x53C2;&#x6570;&#x7684;SQL&#x51FD;&#x6570;&#x3002;</span><span class="yiyi-st" id="yiyi-98">&#x5B83;&#x7528;&#x4E8E;&#x7279;&#x6B8A;&#x6570;&#x636E;&#x7C7B;&#x578B;&#xFF0C;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x9700;&#x8981;&#x6587;&#x5B57;&#x88AB;&#x5C01;&#x88C5;&#x5728;&#x67D0;&#x4E9B;&#x7279;&#x6B8A;&#x7684;&#x6570;&#x636E;&#x5E93;&#x51FD;&#x6570;&#x4E2D;&#xFF0C;&#x4EE5;&#x4FBF;&#x5C06;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7EA7;&#x522B;&#x7684;&#x503C;&#x5F3A;&#x5236;&#x8F6C;&#x6362;&#x4E3A;&#x6570;&#x636E;&#x5E93;&#x7279;&#x5B9A;&#x7684;&#x683C;&#x5F0F;&#x3002;</span><span class="yiyi-st" id="yiyi-99">&#x5B83;&#x662F;<a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine.bind_processor" title="sqlalchemy.types.TypeEngine.bind_processor"><code class="xref py py-meth docutils literal"><span class="pre">TypeEngine.bind_processor()</span></code></a>&#x65B9;&#x6CD5;&#x7684;SQL&#x6A21;&#x62DF;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-100">&#x8BE5;&#x65B9;&#x6CD5;&#x5728;&#x8BED;&#x53E5;&#x7F16;&#x8BD1;&#x65F6;&#x8FDB;&#x884C;&#x8BC4;&#x4F30;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x8BED;&#x53E5;&#x6784;&#x5EFA;&#x65F6;&#x95F4;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-101">&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x6B64;&#x65B9;&#x6CD5;&#x5728;&#x5B9E;&#x73B0;&#x65F6;&#x5E94;&#x59CB;&#x7EC8;&#x8FD4;&#x56DE;&#x5B8C;&#x5168;&#x76F8;&#x540C;&#x7684;&#x7ED3;&#x6784;&#xFF0C;&#x800C;&#x4E0D;&#x4F7F;&#x7528;&#x4EFB;&#x4F55;&#x6761;&#x4EF6;&#x903B;&#x8F91;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x53EF;&#x7528;&#x4E8E;&#x9488;&#x5BF9;&#x4EFB;&#x610F;&#x6570;&#x91CF;&#x7684;&#x7ED1;&#x5B9A;&#x53C2;&#x6570;&#x96C6;&#x7684;executemany()&#x8C03;&#x7528;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-102">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;&#xFF1A;</span></p><p><span class="yiyi-st" id="yiyi-103"><a class="reference internal" href="#types-sql-value-processing"><span>Applying SQL-level Bind/Result Processing</span></a></span></p></dd></dl><dl class="method"><dt id="sqlalchemy.types.TypeDecorator.bind_processor"><span class="yiyi-st" id="yiyi-104"><code class="descname"> bind_processor  T0&gt; <span class="sig-paren">&#xFF08; T1&gt; <em>&#x65B9;&#x8A00; T2&gt; <span class="sig-paren">&#xFF09; T3&gt; <a class="headerlink" href="#sqlalchemy.types.TypeDecorator.bind_processor" title="Permalink to this definition">&#xB6; T4&gt;</a></span></em></span></code></span></dt><dd><p><span class="yiyi-st" id="yiyi-105">&#x4E3A;&#x7ED9;&#x5B9A;&#x7684;<a class="reference internal" href="internals.html#sqlalchemy.engine.interfaces.Dialect" title="sqlalchemy.engine.interfaces.Dialect"><code class="xref py py-class docutils literal"><span class="pre">Dialect</span></code></a>&#x63D0;&#x4F9B;&#x7ED1;&#x5B9A;&#x503C;&#x5904;&#x7406;&#x529F;&#x80FD;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-106">&#x8FD9;&#x662F;&#x5B9E;&#x73B0;&#x7528;&#x4E8E;&#x7ED1;&#x5B9A;&#x503C;&#x8F6C;&#x6362;&#x7684;<a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal"><span class="pre">TypeEngine</span></code></a>&#x5408;&#x540C;&#x7684;&#x65B9;&#x6CD5;&#x3002;</span><span class="yiyi-st" id="yiyi-107"><a class="reference internal" href="#sqlalchemy.types.TypeDecorator" title="sqlalchemy.types.TypeDecorator"><code class="xref py py-class docutils literal"><span class="pre">TypeDecorator</span></code></a> will wrap a user-defined implementation of <a class="reference internal" href="#sqlalchemy.types.TypeDecorator.process_bind_param" title="sqlalchemy.types.TypeDecorator.process_bind_param"><code class="xref py py-meth docutils literal"><span class="pre">process_bind_param()</span></code></a> here.</span></p><p><span class="yiyi-st" id="yiyi-108">&#x7528;&#x6237;&#x5B9A;&#x4E49;&#x7684;&#x4EE3;&#x7801;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8986;&#x76D6;&#x6B64;&#x65B9;&#x6CD5;&#xFF0C;&#x5C3D;&#x7BA1;&#x5B83;&#x6700;&#x597D;&#x4F7F;&#x7528;<a class="reference internal" href="#sqlalchemy.types.TypeDecorator.process_bind_param" title="sqlalchemy.types.TypeDecorator.process_bind_param"><code class="xref py py-meth docutils literal"><span class="pre">process_bind_param()</span></code></a>&#xFF0C;&#x4EE5;&#x4FDD;&#x6301;&#x7531;<code class="docutils literal"><span class="pre">self.impl</span></code>&#x63D0;&#x4F9B;&#x7684;&#x5904;&#x7406;&#x3002;</span></p><table class="docutils field-list" frame="void" rules="none"><tbody valign="top"><tr class="field-odd field"><th class="field-name"><span class="yiyi-st" id="yiyi-109">&#x53C2;&#x6570;&#xFF1A;</span></th><td class="field-body"><span class="yiyi-st" id="yiyi-110"><span class="target" id="sqlalchemy.types.TypeDecorator.bind_processor.params.dialect"></span> <strong>dialect</strong> <a class="paramlink headerlink reference internal" href="#sqlalchemy.types.TypeDecorator.bind_processor.params.dialect">&#xB6;</a>  -  Dialect&#x5B9E;&#x4F8B;&#x6B63;&#x5728;&#x4F7F;&#x7528;&#x4E2D;&#x3002;</span></td></tr></tbody></table><p><span class="yiyi-st" id="yiyi-111">&#x6B64;&#x65B9;&#x6CD5;&#x4E0E;&#x6B64;&#x7C7B;&#x7684;<a class="reference internal" href="#sqlalchemy.types.TypeDecorator.result_processor" title="sqlalchemy.types.TypeDecorator.result_processor"><code class="xref py py-meth docutils literal"><span class="pre">result_processor()</span></code></a>&#x65B9;&#x6CD5;&#x76F8;&#x53CD;&#x3002;</span></p></dd></dl><dl class="method"><dt id="sqlalchemy.types.TypeDecorator.coerce_compared_value"><span class="yiyi-st" id="yiyi-112"><code class="descname">coerce_compared_value</code> <span class="sig-paren">&#xFF08;</span> <em>op</em>&#xFF0C;<em>&#x503C;</em> <span class="sig-paren">&#xFF09;</span> <a class="headerlink" href="#sqlalchemy.types.TypeDecorator.coerce_compared_value" title="Permalink to this definition"></a></span></dt><dd><p><span class="yiyi-st" id="yiyi-113">&#x4E3A;&#x8868;&#x8FBE;&#x5F0F;&#x4E2D;&#x7684;&apos;&#x5F3A;&#x5236;&apos;Python&#x503C;&#x5EFA;&#x8BAE;&#x7C7B;&#x578B;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-114">&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8FD4;&#x56DE;self&#x3002;</span><span class="yiyi-st" id="yiyi-115">&#x5982;&#x679C;&#x4F7F;&#x7528;&#x6B64;&#x7C7B;&#x578B;&#x7684;&#x5BF9;&#x8C61;&#x4F4D;&#x4E8E;&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x5DE6;&#x4FA7;&#x6216;&#x53F3;&#x4FA7;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x6307;&#x5B9A;&#x4E86;SQLAlchemy&#x7C7B;&#x578B;&#x7684;&#x666E;&#x901A;Python&#x5BF9;&#x8C61;&#xFF0C;&#x5219;&#x8868;&#x8FBE;&#x5F0F;&#x7CFB;&#x7EDF;&#x5C06;&#x8C03;&#x7528;&#x6B64;&#x65B9;&#x6CD5;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">expr</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">somecolumn</span> <span class="o">+</span> <span class="mi">35</span></pre></div></div><p><span class="yiyi-st" id="yiyi-116">Where above, if <code class="docutils literal"><span class="pre">somecolumn</span></code> uses this type, this method will be called with the value <code class="docutils literal"><span class="pre">operator.add</span></code> and <code class="docutils literal"><span class="pre">35</span></code>. </span><span class="yiyi-st" id="yiyi-117">&#x8FD4;&#x56DE;&#x503C;&#x662F;&#x4EFB;&#x4F55;SQLAlchemy&#x7C7B;&#x578B;&#x5E94;&#x8BE5;&#x7528;&#x4E8E;&#x6B64;&#x7279;&#x5B9A;&#x64CD;&#x4F5C;&#x7684;<code class="docutils literal"><span class="pre">35</span></code>&#x3002;</span></p></dd></dl><dl class="attribute"><dt id="sqlalchemy.types.TypeDecorator.coerce_to_is_types"><span class="yiyi-st" id="yiyi-118"><code class="descname">coerce_to_is_types</code> <em class="property">=&#xFF08;&#xFF06;lt&#xFF1B; type&apos;NoneType&#xFF06;gt&#xFF1B;&#xFF0C;&#xFF09;</em> <a class="headerlink" href="#sqlalchemy.types.TypeDecorator.coerce_to_is_types" title="Permalink to this definition">&#xB6;</a></span></dt><dd><p><span class="yiyi-st" id="yiyi-119">&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">==</span></code>&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#x65F6;&#x6307;&#x5B9A;&#x5E94;&#x8BE5;&#x5728;&#x8868;&#x8FBE;&#x5F0F;&#x7EA7;&#x522B;&#x8F6C;&#x6362;&#x4E3A;&#x201C;IS <constant>&#x201D;&#x7684;Python&#x7C7B;&#x578B;&#xFF08;&#x5BF9;&#x4E8E;<code class="docutils literal"><span class="pre">IS</span> <span class="pre">NOT </span>&#x4E0E;<code class="docutils literal"><span class="pre">!=</span></code>&#x7ED3;&#x5408;</code></constant>&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-120">&#x5BF9;&#x4E8E;&#x5927;&#x591A;&#x6570;SQLAlchemy&#x7C7B;&#x578B;&#xFF0C;&#x8FD9;&#x5305;&#x62EC;<code class="docutils literal"><span class="pre">NoneType</span></code>&#x4EE5;&#x53CA;<code class="docutils literal"><span class="pre">bool</span></code>&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-121"><a class="reference internal" href="#sqlalchemy.types.TypeDecorator" title="sqlalchemy.types.TypeDecorator"><code class="xref py py-class docutils literal"><span class="pre">TypeDecorator</span></code></a> modifies this list to only include <code class="docutils literal"><span class="pre">NoneType</span></code>, as typedecorator implementations that deal with boolean types are common.</span></p><p><span class="yiyi-st" id="yiyi-122">Custom <a class="reference internal" href="#sqlalchemy.types.TypeDecorator" title="sqlalchemy.types.TypeDecorator"><code class="xref py py-class docutils literal"><span class="pre">TypeDecorator</span></code></a>&#x7C7B;&#x53EF;&#x4EE5;&#x8986;&#x76D6;&#x6B64;&#x5C5E;&#x6027;&#x4EE5;&#x8FD4;&#x56DE;&#x7A7A;&#x5143;&#x7EC4;&#xFF0C;&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4E0D;&#x4F1A;&#x5C06;&#x503C;&#x5F3A;&#x5236;&#x4E3A;&#x5E38;&#x91CF;&#x3002;</span></p><dl class="docutils"><dt><span class="yiyi-st" id="yiyi-123">..versionadded :: 0.8.2</span></dt><dd><span class="yiyi-st" id="yiyi-124">&#x6DFB;&#x52A0;<a class="reference internal" href="#sqlalchemy.types.TypeDecorator.coerce_to_is_types" title="sqlalchemy.types.TypeDecorator.coerce_to_is_types"><code class="xref py py-attr docutils literal"><span class="pre">TypeDecorator.coerce_to_is_types</span></code></a>&#x4EE5;&#x4FBF;&#x66F4;&#x5BB9;&#x6613;&#x5730;&#x63A7;&#x5236;<code class="docutils literal"><span class="pre">__eq__()</span></code> <code class="docutils literal"><span class="pre">__ne__()</span></code>&#x64CD;&#x4F5C;&#x3002;</span></dd></dl></dd></dl><dl class="method"><dt id="sqlalchemy.types.TypeDecorator.column_expression"><span class="yiyi-st" id="yiyi-125"><code class="descname"> column_expression  T0&gt; <span class="sig-paren">&#xFF08; T1&gt; <em> colexpr  T2&gt; <span class="sig-paren">&#xFF09; T3&gt; <a class="headerlink" href="#sqlalchemy.types.TypeDecorator.column_expression" title="Permalink to this definition">&#xB6; T4&gt;</a></span></em></span></code></span></dt><dd><div class="inherited-member container"><span class="yiyi-st" id="yiyi-126"> <em>inherited from the</em> <a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine.column_expression" title="sqlalchemy.types.TypeEngine.column_expression"><code class="xref py py-meth docutils literal"><span class="pre">column_expression()</span></code></a> <em>method of</em> <a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal"><span class="pre">TypeEngine</span></code></a></span></div><p><span class="yiyi-st" id="yiyi-127">&#x7ED9;&#x5B9A;&#x4E00;&#x4E2A;SELECT&#x5217;&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x5305;&#x88C5;SQL&#x8868;&#x8FBE;&#x5F0F;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-128">&#x8FD9;&#x901A;&#x5E38;&#x662F;&#x4E00;&#x4E2A;SQL&#x51FD;&#x6570;&#xFF0C;&#x5B83;&#x5305;&#x88C5;&#x5217;&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x5E76;&#x5C06;&#x5176;&#x5448;&#x73B0;&#x5728;SELECT&#x8BED;&#x53E5;&#x7684;columns&#x5B50;&#x53E5;&#x4E2D;&#x3002;</span><span class="yiyi-st" id="yiyi-129">&#x5B83;&#x7528;&#x4E8E;&#x7279;&#x6B8A;&#x6570;&#x636E;&#x7C7B;&#x578B;&#xFF0C;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x9700;&#x8981;&#x5C06;&#x5217;&#x5305;&#x88C5;&#x5728;&#x67D0;&#x4E9B;&#x7279;&#x6B8A;&#x7684;&#x6570;&#x636E;&#x5E93;&#x51FD;&#x6570;&#x4E2D;&#xFF0C;&#x4EE5;&#x4FBF;&#x5728;&#x5C06;&#x503C;&#x8FD4;&#x56DE;&#x7ED9;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E4B;&#x524D;&#x5F3A;&#x5236;&#x503C;&#x3002;</span><span class="yiyi-st" id="yiyi-130">&#x5B83;&#x662F;<a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine.result_processor" title="sqlalchemy.types.TypeEngine.result_processor"><code class="xref py py-meth docutils literal"><span class="pre">TypeEngine.result_processor()</span></code></a>&#x65B9;&#x6CD5;&#x7684;SQL&#x6A21;&#x62DF;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-131">&#x8BE5;&#x65B9;&#x6CD5;&#x5728;&#x8BED;&#x53E5;&#x7F16;&#x8BD1;&#x65F6;&#x8FDB;&#x884C;&#x8BC4;&#x4F30;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x8BED;&#x53E5;&#x6784;&#x5EFA;&#x65F6;&#x95F4;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-132">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;&#xFF1A;</span></p><p><span class="yiyi-st" id="yiyi-133"><a class="reference internal" href="#types-sql-value-processing"><span>Applying SQL-level Bind/Result Processing</span></a></span></p></dd></dl><dl class="method"><dt id="sqlalchemy.types.TypeDecorator.compare_against_backend"><span class="yiyi-st" id="yiyi-134"><code class="descname">compare_against_backend</code> <span class="sig-paren">&#xFF08;</span> <em>dialect</em>&#xFF0C;<em>conn_type</em> <span class="sig-paren">&#xFF09;</span> <a class="headerlink" href="#sqlalchemy.types.TypeDecorator.compare_against_backend" title="Permalink to this definition">&#xB6;</a></span></dt><dd><div class="inherited-member container"><span class="yiyi-st" id="yiyi-135"> <em>inherited from the</em> <a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine.compare_against_backend" title="sqlalchemy.types.TypeEngine.compare_against_backend"><code class="xref py py-meth docutils literal"><span class="pre">compare_against_backend()</span></code></a> <em>method of</em> <a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal"><span class="pre">TypeEngine</span></code></a></span></div><p><span class="yiyi-st" id="yiyi-136">&#x5C06;&#x6B64;&#x7C7B;&#x578B;&#x4E0E;&#x7ED9;&#x5B9A;&#x7684;&#x540E;&#x7AEF;&#x7C7B;&#x578B;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-137">&#x6B64;&#x51FD;&#x6570;&#x76EE;&#x524D;&#x5C1A;&#x672A;&#x9488;&#x5BF9;SQLAlchemy&#x7C7B;&#x578B;&#x5B9E;&#x73B0;&#xFF0C;&#x5BF9;&#x4E8E;&#x6240;&#x6709;&#x5185;&#x7F6E;&#x7C7B;&#x578B;&#xFF0C;&#x6B64;&#x51FD;&#x6570;&#x5C06;&#x8FD4;&#x56DE;<code class="docutils literal"><span class="pre">None</span></code>&#x3002;</span><span class="yiyi-st" id="yiyi-138">&#x4F46;&#x662F;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x7528;&#x6237;&#x5B9A;&#x4E49;&#x7684;&#x7C7B;&#x578B;&#x5B9E;&#x73B0;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6A21;&#x5F0F;&#x6BD4;&#x8F83;&#x5DE5;&#x5177;&#xFF08;&#x5982;Alembic autogenerate&#xFF09;&#x4F7F;&#x7528;&#x5B83;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-139">&#x672A;&#x6765;&#x7684;SQLAlchemy&#x7248;&#x672C;&#x4E5F;&#x53EF;&#x80FD;&#x4F1A;&#x5BF9;&#x8FD9;&#x79CD;&#x5185;&#x7F6E;&#x7C7B;&#x578B;&#x7684;&#x65B9;&#x6CD5;&#x4EA7;&#x751F;&#x5F71;&#x54CD;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-140">&#x5982;&#x679C;&#x6B64;&#x7C7B;&#x578B;&#x4E0E;&#x7ED9;&#x5B9A;&#x7C7B;&#x578B;&#x76F8;&#x540C;&#xFF0C;&#x5219;&#x8BE5;&#x51FD;&#x6570;&#x5E94;&#x8FD4;&#x56DE;True&#xFF1B;&#x8BE5;&#x7C7B;&#x578B;&#x901A;&#x5E38;&#x53CD;&#x6620;&#x5728;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#xFF0C;&#x56E0;&#x6B64;&#x5E94;&#x8BE5;&#x662F;&#x6570;&#x636E;&#x5E93;&#x7279;&#x5B9A;&#x7684;&#x3002;</span><span class="yiyi-st" id="yiyi-141">&#x4F7F;&#x7528;&#x7684;&#x65B9;&#x8A00;&#x4E5F;&#x901A;&#x8FC7;&#x4E86;&#x3002;</span><span class="yiyi-st" id="yiyi-142">&#x5B83;&#x4E5F;&#x53EF;&#x4EE5;&#x8FD4;&#x56DE;False&#x6765;&#x58F0;&#x660E;&#x8BE5;&#x7C7B;&#x578B;&#x4E0D;&#x76F8;&#x540C;&#x3002;</span></p><table class="docutils field-list" frame="void" rules="none"><tbody valign="top"><tr class="field-odd field"><th class="field-name"><span class="yiyi-st" id="yiyi-143">&#x53C2;&#x6570;&#xFF1A;</span></th><td class="field-body"><ul class="first last simple"><li><span class="yiyi-st" id="yiyi-144"><span class="target" id="sqlalchemy.types.TypeDecorator.compare_against_backend.params.dialect"></span><strong>dialect</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.types.TypeDecorator.compare_against_backend.params.dialect">&#xB6;</a> &#x2013; a <a class="reference internal" href="internals.html#sqlalchemy.engine.interfaces.Dialect" title="sqlalchemy.engine.interfaces.Dialect"><code class="xref py py-class docutils literal"><span class="pre">Dialect</span></code></a> that is involved in the comparison.</span></li><li><span class="yiyi-st" id="yiyi-145"><span class="target" id="sqlalchemy.types.TypeDecorator.compare_against_backend.params.conn_type"></span> <strong>conn_type</strong> <a class="paramlink headerlink reference internal" href="#sqlalchemy.types.TypeDecorator.compare_against_backend.params.conn_type">&#xB6;</a>  - &#x4ECE;&#x540E;&#x7AEF;&#x53CD;&#x5C04;&#x7684;&#x7C7B;&#x578B;&#x5BF9;&#x8C61;&#x3002;</span></li></ul></td></tr></tbody></table><div class="versionadded"><p><span class="yiyi-st" id="yiyi-146"><span class="versionmodified">&#x7248;&#x672C;1.0.3&#x4E2D;&#x7684;&#x65B0;&#x529F;&#x80FD;</span></span></p></div></dd></dl><dl class="method"><dt id="sqlalchemy.types.TypeDecorator.compare_values"><span class="yiyi-st" id="yiyi-147"><code class="descname">&#x6BD4;&#x8F83;&#x503C;</code> <span class="sig-paren">&#xFF08;</span> <em>x</em>&#xFF0C;<em>y</em> <span class="sig-paren">&#xFF09;</span> <a class="headerlink" href="#sqlalchemy.types.TypeDecorator.compare_values" title="Permalink to this definition">&#xB6;</a></span></dt><dd><p><span class="yiyi-st" id="yiyi-148">&#x7ED9;&#x5B9A;&#x4E24;&#x4E2A;&#x503C;&#xFF0C;&#x6BD4;&#x8F83;&#x4ED6;&#x4EEC;&#x7684;&#x5E73;&#x7B49;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-149">&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8FD9;&#x4F1A;&#x8C03;&#x7528;&#x57FA;&#x7840;&#x201C;impl&#x201D;&#x7684;<a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine.compare_values" title="sqlalchemy.types.TypeEngine.compare_values"><code class="xref py py-meth docutils literal"><span class="pre">TypeEngine.compare_values()</span></code></a>&#xFF0C;&#x540E;&#x8005;&#x901A;&#x5E38;&#x4F7F;&#x7528;Python&#x7B49;&#x53F7;&#x8FD0;&#x7B97;&#x7B26;<code class="docutils literal"><span class="pre">==</span></code>&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-150">ORM&#x4F7F;&#x7528;&#x8BE5;&#x51FD;&#x6570;&#x5C06;&#x539F;&#x59CB;&#x52A0;&#x8F7D;&#x7684;&#x503C;&#x4E0E;&#x622A;&#x83B7;&#x7684;&#x201C;&#x5DF2;&#x66F4;&#x6539;&#x201D;&#x503C;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#xFF0C;&#x4EE5;&#x786E;&#x5B9A;&#x662F;&#x5426;&#x53D1;&#x751F;&#x4E86;&#x51C0;&#x66F4;&#x6539;&#x3002;</span></p></dd></dl><dl class="method"><dt id="sqlalchemy.types.TypeDecorator.compile"><span class="yiyi-st" id="yiyi-151"><code class="descname">&#x7F16;&#x8BD1; T0&gt; <span class="sig-paren">&#xFF08; T1&gt; <em>&#x65B9;&#x8A00;=&#x65E0; T2&gt; <span class="sig-paren">&#xFF09; T3&gt; <a class="headerlink" href="#sqlalchemy.types.TypeDecorator.compile" title="Permalink to this definition">&#xB6; T4&gt;</a></span></em></span></code></span></dt><dd><div class="inherited-member container"><span class="yiyi-st" id="yiyi-152"> <em>inherited from the</em> <a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine.compile" title="sqlalchemy.types.TypeEngine.compile"><code class="xref py py-meth docutils literal"><span class="pre">compile()</span></code></a> <em>method of</em> <a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal"><span class="pre">TypeEngine</span></code></a></span></div><p><span class="yiyi-st" id="yiyi-153">&#x751F;&#x6210;&#x6B64;<a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal"><span class="pre">TypeEngine</span></code></a>&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x7F16;&#x8BD1;&#x5F62;&#x5F0F;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-154">&#x5F53;&#x4E0D;&#x5E26;&#x53C2;&#x6570;&#x8C03;&#x7528;&#x65F6;&#xFF0C;&#x4F7F;&#x7528;&#x201C;&#x9ED8;&#x8BA4;&#x201D;&#x65B9;&#x8A00;&#x4EA7;&#x751F;&#x5B57;&#x7B26;&#x4E32;&#x7ED3;&#x679C;&#x3002;</span></p><table class="docutils field-list" frame="void" rules="none"><tbody valign="top"><tr class="field-odd field"><th class="field-name"><span class="yiyi-st" id="yiyi-155">&#x53C2;&#x6570;&#xFF1A;</span></th><td class="field-body"><span class="yiyi-st" id="yiyi-156"><span class="target" id="sqlalchemy.types.TypeDecorator.compile.params.dialect"></span> <strong>dialect</strong> <a class="paramlink headerlink reference internal" href="#sqlalchemy.types.TypeDecorator.compile.params.dialect">&#xB6;</a>  -  a <a class="reference internal" href="internals.html#sqlalchemy.engine.interfaces.Dialect" title="sqlalchemy.engine.interfaces.Dialect"><code class="xref py py-class docutils literal"><span class="pre">Dialect</span></code></a>&#x5B9E;&#x4F8B;&#x3002;</span></td></tr></tbody></table></dd></dl><dl class="method"><dt id="sqlalchemy.types.TypeDecorator.copy"><span class="yiyi-st" id="yiyi-157"><code class="descname">&#x590D;&#x5236; T0&gt; <span class="sig-paren">&#xFF08; T1&gt; <em> **&#x5343;&#x74E6; T2&gt; <span class="sig-paren">&#xFF09; T3&gt; <a class="headerlink" href="#sqlalchemy.types.TypeDecorator.copy" title="Permalink to this definition">&#xB6; T4&gt;</a></span></em></span></code></span></dt><dd><p><span class="yiyi-st" id="yiyi-158">&#x751F;&#x6210;&#x6B64;<a class="reference internal" href="#sqlalchemy.types.TypeDecorator" title="sqlalchemy.types.TypeDecorator"><code class="xref py py-class docutils literal"><span class="pre">TypeDecorator</span></code></a>&#x5B9E;&#x4F8B;&#x7684;&#x526F;&#x672C;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-159">&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x6D45;&#x5C42;&#x526F;&#x672C;&#xFF0C;&#x7528;&#x4E8E;&#x5C65;&#x884C;<a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal"><span class="pre">TypeEngine</span></code></a>&#x5408;&#x7EA6;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x3002;</span><span class="yiyi-st" id="yiyi-160">&#x901A;&#x5E38;&#x4E0D;&#x9700;&#x8981;&#x91CD;&#x5199;&#xFF0C;&#x9664;&#x975E;&#x7528;&#x6237;&#x5B9A;&#x4E49;&#x7684;<a class="reference internal" href="#sqlalchemy.types.TypeDecorator" title="sqlalchemy.types.TypeDecorator"><code class="xref py py-class docutils literal"><span class="pre">TypeDecorator</span></code></a>&#x5177;&#x6709;&#x5E94;&#x8BE5;&#x88AB;&#x6DF1;&#x5EA6;&#x590D;&#x5236;&#x7684;&#x672C;&#x5730;&#x72B6;&#x6001;&#x3002;</span></p></dd></dl><dl class="method"><dt id="sqlalchemy.types.TypeDecorator.dialect_impl"><span class="yiyi-st" id="yiyi-161"><code class="descname"> dialect_impl  T0&gt; <span class="sig-paren">&#xFF08; T1&gt; <em>&#x65B9;&#x8A00; T2&gt; <span class="sig-paren">&#xFF09; T3&gt; <a class="headerlink" href="#sqlalchemy.types.TypeDecorator.dialect_impl" title="Permalink to this definition">&#xB6; T4&gt;</a></span></em></span></code></span></dt><dd><div class="inherited-member container"><span class="yiyi-st" id="yiyi-162"><em>&#x7EE7;&#x627F;&#x81EA;</em> <a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine.dialect_impl" title="sqlalchemy.types.TypeEngine.dialect_impl"><code class="xref py py-meth docutils literal"><span class="pre">dialect_impl()</span></code></a> <em><a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal"><span class="pre">TypeEngine</span></code></a></em></span></div><p><span class="yiyi-st" id="yiyi-163">&#x8FD4;&#x56DE;&#x8BE5;<a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal"><span class="pre">TypeEngine</span></code></a>&#x7684;&#x7279;&#x5B9A;&#x4E8E;&#x65B9;&#x8A00;&#x7684;&#x5B9E;&#x73B0;&#x3002;</span></p></dd></dl><dl class="method"><dt id="sqlalchemy.types.TypeDecorator.evaluates_none"><span class="yiyi-st" id="yiyi-164"><code class="descname"> evaluates_none  T0&gt; <span class="sig-paren">&#xFF08; T1&gt; <span class="sig-paren">&#xFF09; T2&gt; <a class="headerlink" href="#sqlalchemy.types.TypeDecorator.evaluates_none" title="Permalink to this definition">&#xB6; T3&gt;</a></span></span></code></span></dt><dd><div class="inherited-member container"><span class="yiyi-st" id="yiyi-165"> <em>inherited from the</em> <a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine.evaluates_none" title="sqlalchemy.types.TypeEngine.evaluates_none"><code class="xref py py-meth docutils literal"><span class="pre">evaluates_none()</span></code></a> <em>method of</em> <a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal"><span class="pre">TypeEngine</span></code></a></span></div><p><span class="yiyi-st" id="yiyi-166">&#x8FD4;&#x56DE;&#x5C06;<a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine.should_evaluate_none" title="sqlalchemy.types.TypeEngine.should_evaluate_none"><code class="xref py py-attr docutils literal"><span class="pre">should_evaluate_none</span></code></a>&#x6807;&#x5FD7;&#x8BBE;&#x7F6E;&#x4E3A;True&#x7684;&#x6B64;&#x7C7B;&#x578B;&#x7684;&#x526F;&#x672C;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-167">&#x4F8B;&#x5982;&#x3002;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">Table</span><span class="p">(</span>
    <span class="s1">&apos;some_table&apos;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span>
        <span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="o">.</span><span class="n">evaluates_none</span><span class="p">(),</span>
        <span class="n">nullable</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">server_default</span><span class="o">=</span><span class="s1">&apos;no value&apos;</span><span class="p">)</span>
<span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-168">ORM&#x4F7F;&#x7528;&#x6B64;&#x6807;&#x5FD7;&#x6765;&#x6307;&#x793A;&#x5728;INSERT&#x8BED;&#x53E5;&#x4E2D;&#x5C06;<code class="docutils literal"><span class="pre">None</span></code>&#x7684;&#x6B63;&#x503C;&#x4F20;&#x9012;&#x5230;&#x5217;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x4ECE;INSERT&#x8BED;&#x53E5;&#x4E2D;&#x7701;&#x7565;&#x5217;&#xFF0C;&#x8BE5;&#x5217;&#x5177;&#x6709;&#x89E6;&#x53D1;&#x5217;&#x7EA7;&#x7F3A;&#x7701;&#x503C;&#x7684;&#x6548;&#x679C;&#x3002;</span><span class="yiyi-st" id="yiyi-169">&#x5B83;&#x8FD8;&#x5141;&#x8BB8;&#x5177;&#x6709;&#x4E0E;Python None&#x503C;&#x5173;&#x8054;&#x7684;&#x7279;&#x6B8A;&#x884C;&#x4E3A;&#x7684;&#x7C7B;&#x578B;&#x6307;&#x793A;&#x8BE5;&#x503C;&#x4E0D;&#x4E00;&#x5B9A;&#x4F1A;&#x8F6C;&#x6362;&#x4E3A;SQL NULL&#xFF1B;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;JSON&#x7C7B;&#x578B;&#x7684;&#x4E3B;&#x8981;&#x4F8B;&#x5B50;&#xFF0C;&#x5B83;&#x53EF;&#x80FD;&#x5E0C;&#x671B;&#x4FDD;&#x5B58;JSON&#x503C;<code class="docutils literal"><span class="pre">&apos;null&apos;</span></code>&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-170">&#x5728;&#x6240;&#x6709;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x901A;&#x8FC7;&#x5728;INSERT&#x8BED;&#x53E5;&#x4E2D;&#x4F7F;&#x7528;<a class="reference internal" href="sqlelement.html#sqlalchemy.sql.expression.null" title="sqlalchemy.sql.expression.null"><code class="xref py py-obj docutils literal"><span class="pre">null</span></code></a> SQL&#x6784;&#x9020;&#x6216;&#x4E0E;ORM&#x6620;&#x5C04;&#x5C5E;&#x6027;&#x5173;&#x8054;&#xFF0C;&#x5B9E;&#x9645;&#x7684;NULL SQL&#x503C;&#x53EF;&#x59CB;&#x7EC8;&#x4FDD;&#x7559;&#x5728;&#x4EFB;&#x4F55;&#x5217;&#x4E2D;&#x3002;</span></p><div class="versionadded"><p><span class="yiyi-st" id="yiyi-171"><span class="versionmodified">&#x7248;&#x672C;1.1&#x4E2D;&#x7684;&#x65B0;&#x529F;&#x80FD;</span></span></p></div><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-172">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p><span class="yiyi-st" id="yiyi-173"><a class="reference internal" href="orm_persistence_techniques.html#session-forcing-null"><span>Forcing NULL on a column with a default</span></a> - in the ORM documentation</span></p><p><span class="yiyi-st" id="yiyi-174"><a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.JSON.params.none_as_null" title="sqlalchemy.dialects.postgresql.JSON"><code class="xref py py-paramref docutils literal"><span class="pre">postgresql.JSON.none_as_null</span></code></a>  -  Postgresql&#x4E0E;&#x6B64;&#x6807;&#x5FD7;&#x7684;JSON&#x4EA4;&#x4E92;&#x3002;</span></p><p class="last"><span class="yiyi-st" id="yiyi-175"><a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine.should_evaluate_none" title="sqlalchemy.types.TypeEngine.should_evaluate_none"><code class="xref py py-attr docutils literal"><span class="pre">TypeEngine.should_evaluate_none</span></code></a> - class-level flag</span></p></div></dd></dl><dl class="method"><dt id="sqlalchemy.types.TypeDecorator.get_dbapi_type"><span class="yiyi-st" id="yiyi-176"><code class="descname"> get_dbapi_type  T0&gt; <span class="sig-paren">&#xFF08; T1&gt; <em> DBAPI  T2&gt; <span class="sig-paren">&#xFF09; T3&gt; <a class="headerlink" href="#sqlalchemy.types.TypeDecorator.get_dbapi_type" title="Permalink to this definition">&#xB6; T4&gt;</a></span></em></span></code></span></dt><dd><p><span class="yiyi-st" id="yiyi-177">&#x8FD4;&#x56DE;&#x7531;<a class="reference internal" href="#sqlalchemy.types.TypeDecorator" title="sqlalchemy.types.TypeDecorator"><code class="xref py py-class docutils literal"><span class="pre">TypeDecorator</span></code></a>&#x8868;&#x793A;&#x7684;DBAPI&#x7C7B;&#x578B;&#x5BF9;&#x8C61;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-178">&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8FD9;&#x4F1A;&#x8C03;&#x7528;&#x57FA;&#x7840;&#x201C;impl&#x201D;&#x7684;<a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine.get_dbapi_type" title="sqlalchemy.types.TypeEngine.get_dbapi_type"><code class="xref py py-meth docutils literal"><span class="pre">TypeEngine.get_dbapi_type()</span></code></a>&#x3002;</span></p></dd></dl><dl class="method"><dt id="sqlalchemy.types.TypeDecorator.literal_processor"><span class="yiyi-st" id="yiyi-179"><code class="descname"> literal_processor  T0&gt; <span class="sig-paren">&#xFF08; T1&gt; <em>&#x65B9;&#x8A00; T2&gt; <span class="sig-paren">&#xFF09; T3&gt; <a class="headerlink" href="#sqlalchemy.types.TypeDecorator.literal_processor" title="Permalink to this definition">&#xB6; T4&gt;</a></span></em></span></code></span></dt><dd><p><span class="yiyi-st" id="yiyi-180">&#x4E3A;&#x7ED9;&#x5B9A;&#x7684;<a class="reference internal" href="internals.html#sqlalchemy.engine.interfaces.Dialect" title="sqlalchemy.engine.interfaces.Dialect"><code class="xref py py-class docutils literal"><span class="pre">Dialect</span></code></a>&#x63D0;&#x4F9B;&#x6587;&#x5B57;&#x5904;&#x7406;&#x529F;&#x80FD;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-181">&#x6B64;&#x5904;&#x7684;&#x5B50;&#x7C7B;&#x901A;&#x5E38;&#x4F1A;&#x8986;&#x76D6;<a class="reference internal" href="#sqlalchemy.types.TypeDecorator.process_literal_param" title="sqlalchemy.types.TypeDecorator.process_literal_param"><code class="xref py py-meth docutils literal"><span class="pre">TypeDecorator.process_literal_param()</span></code></a>&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x6B64;&#x65B9;&#x6CD5;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-182">&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5982;&#x679C;&#x5B9E;&#x73B0;&#x4E86;&#x8BE5;&#x65B9;&#x6CD5;&#xFF0C;&#x5219;&#x6B64;&#x65B9;&#x6CD5;&#x4F7F;&#x7528;<a class="reference internal" href="#sqlalchemy.types.TypeDecorator.process_bind_param" title="sqlalchemy.types.TypeDecorator.process_bind_param"><code class="xref py py-meth docutils literal"><span class="pre">TypeDecorator.process_bind_param()</span></code></a>&#xFF0C;&#x5176;&#x4E2D;<a class="reference internal" href="#sqlalchemy.types.TypeDecorator.process_literal_param" title="sqlalchemy.types.TypeDecorator.process_literal_param"><code class="xref py py-meth docutils literal"><span class="pre">TypeDecorator.process_literal_param()</span></code></a>&#x4E0D;&#x662F;&#x3002;</span><span class="yiyi-st" id="yiyi-183">The rationale here is that <a class="reference internal" href="#sqlalchemy.types.TypeDecorator" title="sqlalchemy.types.TypeDecorator"><code class="xref py py-class docutils literal"><span class="pre">TypeDecorator</span></code></a> typically deals with Python conversions of data that are above the layer of database presentation. </span><span class="yiyi-st" id="yiyi-184">With the value converted by <a class="reference internal" href="#sqlalchemy.types.TypeDecorator.process_bind_param" title="sqlalchemy.types.TypeDecorator.process_bind_param"><code class="xref py py-meth docutils literal"><span class="pre">TypeDecorator.process_bind_param()</span></code></a>, the underlying type will then handle whether it needs to be presented to the DBAPI as a bound parameter or to the database as an inline SQL value.</span></p><div class="versionadded"><p><span class="yiyi-st" id="yiyi-185"><span class="versionmodified">&#x7248;&#x672C;0.9.0&#x4E2D;&#x7684;&#x65B0;&#x529F;&#x80FD;</span></span></p></div></dd></dl><dl class="method"><dt id="sqlalchemy.types.TypeDecorator.load_dialect_impl"><span class="yiyi-st" id="yiyi-186"><code class="descname"> load_dialect_impl  T0&gt; <span class="sig-paren">&#xFF08; T1&gt; <em>&#x65B9;&#x8A00; T2&gt; <span class="sig-paren">&#xFF09; T3&gt; <a class="headerlink" href="#sqlalchemy.types.TypeDecorator.load_dialect_impl" title="Permalink to this definition">&#xB6; T4&gt;</a></span></em></span></code></span></dt><dd><p><span class="yiyi-st" id="yiyi-187">&#x8FD4;&#x56DE;&#x4E0E;&#x65B9;&#x8A00;&#x5BF9;&#x5E94;&#x7684;<a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal"><span class="pre">TypeEngine</span></code></a>&#x5BF9;&#x8C61;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-188">&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x6700;&#x7EC8;&#x7528;&#x6237;&#x8986;&#x76D6;&#x6302;&#x94A9;&#xFF0C;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x7ED9;&#x5B9A;&#x7684;&#x65B9;&#x8A00;&#x7528;&#x4E8E;&#x63D0;&#x4F9B;&#x4E0D;&#x540C;&#x7684;&#x7C7B;&#x578B;&#x3002;</span><span class="yiyi-st" id="yiyi-189">&#x5B83;&#x7531;<a class="reference internal" href="#sqlalchemy.types.TypeDecorator.type_engine" title="sqlalchemy.types.TypeDecorator.type_engine"><code class="xref py py-meth docutils literal"><span class="pre">type_engine()</span></code></a>&#x7684;<a class="reference internal" href="#sqlalchemy.types.TypeDecorator" title="sqlalchemy.types.TypeDecorator"><code class="xref py py-class docutils literal"><span class="pre">TypeDecorator</span></code></a>&#x5B9E;&#x73B0;&#x4F7F;&#x7528;&#xFF0C;&#x4EE5;&#x5E2E;&#x52A9;&#x786E;&#x5B9A;&#x6700;&#x7EC8;&#x8FD4;&#x56DE;&#x7ED9;&#x5B9A;<a class="reference internal" href="#sqlalchemy.types.TypeDecorator" title="sqlalchemy.types.TypeDecorator"><code class="xref py py-class docutils literal"><span class="pre">TypeDecorator</span></code></a>&#x7684;&#x7C7B;&#x578B;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-190">&#x9ED8;&#x8BA4;&#x8FD4;&#x56DE;<code class="docutils literal"><span class="pre">self.impl</span></code>&#x3002;</span></p></dd></dl><dl class="method"><dt id="sqlalchemy.types.TypeDecorator.process_bind_param"><span class="yiyi-st" id="yiyi-191"> <code class="descname">process_bind_param</code><span class="sig-paren">(</span><em>value</em>, <em>dialect</em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.types.TypeDecorator.process_bind_param" title="Permalink to this definition">&#xB6;</a></span></dt><dd><p><span class="yiyi-st" id="yiyi-192">&#x63A5;&#x6536;&#x8981;&#x8F6C;&#x6362;&#x7684;&#x7ED1;&#x5B9A;&#x53C2;&#x6570;&#x503C;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-193">&#x5B50;&#x7C7B;&#x91CD;&#x5199;&#x6B64;&#x65B9;&#x6CD5;&#x4EE5;&#x8FD4;&#x56DE;&#x5E94;&#x4F20;&#x9012;&#x7ED9;&#x5E95;&#x5C42;<a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal"><span class="pre">TypeEngine</span></code></a>&#x5BF9;&#x8C61;&#x7684;&#x503C;&#xFF0C;&#x5E76;&#x4ECE;&#x90A3;&#x91CC;&#x8FD4;&#x56DE;&#x5230;DBAPI <code class="docutils literal"><span class="pre">execute()</span></code>&#x65B9;&#x6CD5;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-194">&#x8BE5;&#x64CD;&#x4F5C;&#x53EF;&#x4EE5;&#x662F;&#x6267;&#x884C;&#x81EA;&#x5B9A;&#x4E49;&#x884C;&#x4E3A;&#x6240;&#x9700;&#x7684;&#x4EFB;&#x4F55;&#x64CD;&#x4F5C;&#xFF0C;&#x4F8B;&#x5982;&#x8F6C;&#x6362;&#x6216;&#x5E8F;&#x5217;&#x5316;&#x6570;&#x636E;&#x3002;</span><span class="yiyi-st" id="yiyi-195">&#x8FD9;&#x4E5F;&#x53EF;&#x4EE5;&#x7528;&#x4F5C;&#x9A8C;&#x8BC1;&#x903B;&#x8F91;&#x7684;&#x94A9;&#x5B50;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-196">&#x8FD9;&#x4E2A;&#x64CD;&#x4F5C;&#x7684;&#x8BBE;&#x8BA1;&#x5E94;&#x8003;&#x8651;&#x5230;&#x76F8;&#x53CD;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x8FD9;&#x5C06;&#x662F;&#x8BE5;&#x7C7B;&#x7684;process_result_value&#x65B9;&#x6CD5;&#x3002;</span></p><table class="docutils field-list" frame="void" rules="none"><tbody valign="top"><tr class="field-odd field"><th class="field-name"><span class="yiyi-st" id="yiyi-197">&#x53C2;&#x6570;&#xFF1A;</span></th><td class="field-body"><ul class="first last simple"><li><span class="yiyi-st" id="yiyi-198"><span class="target" id="sqlalchemy.types.TypeDecorator.process_bind_param.params.value"></span><strong>value</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.types.TypeDecorator.process_bind_param.params.value">&#xB6;</a> &#x2013; Data to operate upon, of any type expected by this method in the subclass. </span><span class="yiyi-st" id="yiyi-199">&#x53EF;&#x4EE5;&#x662F;<code class="docutils literal"><span class="pre">None</span></code>&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-200"><span class="target" id="sqlalchemy.types.TypeDecorator.process_bind_param.params.dialect"></span><strong>dialect</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.types.TypeDecorator.process_bind_param.params.dialect">&#xB6;</a> &#x2013; the <a class="reference internal" href="internals.html#sqlalchemy.engine.interfaces.Dialect" title="sqlalchemy.engine.interfaces.Dialect"><code class="xref py py-class docutils literal"><span class="pre">Dialect</span></code></a> in use.</span></li></ul></td></tr></tbody></table></dd></dl><dl class="method"><dt id="sqlalchemy.types.TypeDecorator.process_literal_param"><span class="yiyi-st" id="yiyi-201"> <code class="descname">process_literal_param</code><span class="sig-paren">(</span><em>value</em>, <em>dialect</em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.types.TypeDecorator.process_literal_param" title="Permalink to this definition">&#xB6;</a></span></dt><dd><p><span class="yiyi-st" id="yiyi-202">&#x63A5;&#x6536;&#x8981;&#x5728;&#x8BED;&#x53E5;&#x4E2D;&#x5185;&#x8054;&#x5448;&#x73B0;&#x7684;&#x6587;&#x5B57;&#x53C2;&#x6570;&#x503C;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-203">&#x7F16;&#x8BD1;&#x5668;&#x5728;&#x4E0D;&#x4F7F;&#x7528;&#x7ED1;&#x5B9A;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x5448;&#x73B0;&#x6587;&#x5B57;&#x503C;&#x65F6;&#xFF0C;&#x4F7F;&#x7528;&#x6B64;&#x65B9;&#x6CD5;&#xFF0C;&#x901A;&#x5E38;&#x4F4D;&#x4E8E;DDL&#x4E2D;&#xFF0C;&#x4F8B;&#x5982;&#x5217;&#x7684;&#x201C;&#x670D;&#x52A1;&#x5668;&#x9ED8;&#x8BA4;&#x503C;&#x201D;&#x6216;CHECK&#x7EA6;&#x675F;&#x5185;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-204">&#x8FD4;&#x56DE;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x5C06;&#x88AB;&#x6E32;&#x67D3;&#x5230;&#x8F93;&#x51FA;&#x5B57;&#x7B26;&#x4E32;&#x4E2D;&#x3002;</span></p><div class="versionadded"><p><span class="yiyi-st" id="yiyi-205"><span class="versionmodified">&#x7248;&#x672C;0.9.0&#x4E2D;&#x7684;&#x65B0;&#x529F;&#x80FD;</span></span></p></div></dd></dl><dl class="method"><dt id="sqlalchemy.types.TypeDecorator.process_result_value"><span class="yiyi-st" id="yiyi-206"> <code class="descname">process_result_value</code><span class="sig-paren">(</span><em>value</em>, <em>dialect</em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.types.TypeDecorator.process_result_value" title="Permalink to this definition">&#xB6;</a></span></dt><dd><p><span class="yiyi-st" id="yiyi-207">&#x63A5;&#x6536;&#x8981;&#x8F6C;&#x6362;&#x7684;&#x7ED3;&#x679C;&#x884C;&#x5217;&#x503C;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-208">&#x5B50;&#x7C7B;&#x5E94;&#x5B9E;&#x73B0;&#x6B64;&#x65B9;&#x6CD5;&#x4EE5;&#x5BF9;&#x4ECE;&#x6570;&#x636E;&#x5E93;&#x83B7;&#x53D6;&#x7684;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-209">&#x7ED9;&#x5B9A;&#x4E00;&#x4E2A;&#x5DF2;&#x7531;&#x5E95;&#x5C42;<a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal"><span class="pre">TypeEngine</span></code></a>&#x5BF9;&#x8C61;&#x5904;&#x7406;&#x7684;&#x503C;&#xFF0C;&#x6700;&#x521D;&#x6765;&#x81EA;DBAPI&#x6E38;&#x6807;&#x65B9;&#x6CD5;<code class="docutils literal"><span class="pre">fetchone()</span></code></span></p><p><span class="yiyi-st" id="yiyi-210">&#x8BE5;&#x64CD;&#x4F5C;&#x53EF;&#x4EE5;&#x662F;&#x6267;&#x884C;&#x81EA;&#x5B9A;&#x4E49;&#x884C;&#x4E3A;&#x6240;&#x9700;&#x7684;&#x4EFB;&#x4F55;&#x64CD;&#x4F5C;&#xFF0C;&#x4F8B;&#x5982;&#x8F6C;&#x6362;&#x6216;&#x5E8F;&#x5217;&#x5316;&#x6570;&#x636E;&#x3002;</span><span class="yiyi-st" id="yiyi-211">&#x8FD9;&#x4E5F;&#x53EF;&#x4EE5;&#x7528;&#x4F5C;&#x9A8C;&#x8BC1;&#x903B;&#x8F91;&#x7684;&#x94A9;&#x5B50;&#x3002;</span></p><table class="docutils field-list" frame="void" rules="none"><tbody valign="top"><tr class="field-odd field"><th class="field-name"><span class="yiyi-st" id="yiyi-212">&#x53C2;&#x6570;&#xFF1A;</span></th><td class="field-body"><ul class="first last simple"><li><span class="yiyi-st" id="yiyi-213"><span class="target" id="sqlalchemy.types.TypeDecorator.process_result_value.params.value"></span><strong>value</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.types.TypeDecorator.process_result_value.params.value">&#xB6;</a> &#x2013; Data to operate upon, of any type expected by this method in the subclass. </span><span class="yiyi-st" id="yiyi-214">&#x53EF;&#x4EE5;&#x662F;<code class="docutils literal"><span class="pre">None</span></code>&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-215"><span class="target" id="sqlalchemy.types.TypeDecorator.process_result_value.params.dialect"></span><strong>dialect</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.types.TypeDecorator.process_result_value.params.dialect">&#xB6;</a> &#x2013; the <a class="reference internal" href="internals.html#sqlalchemy.engine.interfaces.Dialect" title="sqlalchemy.engine.interfaces.Dialect"><code class="xref py py-class docutils literal"><span class="pre">Dialect</span></code></a> in use.</span></li></ul></td></tr></tbody></table><p><span class="yiyi-st" id="yiyi-216">&#x8FD9;&#x4E2A;&#x64CD;&#x4F5C;&#x5E94;&#x8BE5;&#x88AB;&#x8BBE;&#x8BA1;&#x6210;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8FD9;&#x4E2A;&#x7C7B;&#x7684;&#x201C;process_bind_param&#x201D;&#x65B9;&#x6CD5;&#x6765;&#x53CD;&#x8F6C;&#x3002;</span></p></dd></dl><dl class="attribute"><dt id="sqlalchemy.types.TypeDecorator.python_type"><span class="yiyi-st" id="yiyi-217"><code class="descname"> python_type  T0&gt; <a class="headerlink" href="#sqlalchemy.types.TypeDecorator.python_type" title="Permalink to this definition">&#xB6; T1&gt;</a></code></span></dt><dd><div class="inherited-member container"><span class="yiyi-st" id="yiyi-218"> <em>inherited from the</em> <a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine.python_type" title="sqlalchemy.types.TypeEngine.python_type"><code class="xref py py-attr docutils literal"><span class="pre">python_type</span></code></a> <em>attribute of</em> <a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal"><span class="pre">TypeEngine</span></code></a></span></div><p><span class="yiyi-st" id="yiyi-219">&#x5982;&#x679C;&#x5DF2;&#x77E5;&#xFF0C;&#x5219;&#x8FD4;&#x56DE;&#x9884;&#x671F;&#x7531;&#x6B64;&#x7C7B;&#x578B;&#x7684;&#x5B9E;&#x4F8B;&#x8FD4;&#x56DE;&#x7684;Python&#x7C7B;&#x578B;&#x5BF9;&#x8C61;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-220">&#x57FA;&#x672C;&#x4E0A;&#xFF0C;&#x5BF9;&#x4E8E;&#x90A3;&#x4E9B;&#x5F3A;&#x5236;&#x6267;&#x884C;&#x8FD4;&#x56DE;&#x7C7B;&#x578B;&#x7684;&#x7C7B;&#x578B;&#xFF0C;&#x6216;&#x8005;&#x5728;&#x6240;&#x6709;&#x5E38;&#x89C1;DBAPI&#xFF08;&#x4F8B;&#x5982;<code class="docutils literal"><span class="pre">int</span></code>&#xFF09;&#x4E2D;&#x90FD;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x505A;&#x7684;&#x7C7B;&#x578B;&#xFF0C;&#x5C06;&#x8FD4;&#x56DE;&#x8BE5;&#x7C7B;&#x578B;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-221">&#x5982;&#x679C;&#x672A;&#x5B9A;&#x4E49;&#x8FD4;&#x56DE;&#x7C7B;&#x578B;&#xFF0C;&#x5219;&#x5F15;&#x53D1;<code class="docutils literal"><span class="pre">NotImplementedError</span></code>&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-222">&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x4EFB;&#x4F55;&#x7C7B;&#x578B;&#x4E5F;&#x53EF;&#x4EE5;&#x5728;SQL&#x4E2D;&#x5BB9;&#x7EB3;NULL&#xFF0C;&#x8FD9;&#x610F;&#x5473;&#x7740;&#x60A8;&#x5728;&#x5B9E;&#x8DF5;&#x4E2D;&#x4E5F;&#x53EF;&#x4EE5;&#x4ECE;&#x4EFB;&#x4F55;&#x7C7B;&#x578B;&#x83B7;&#x53D6;<code class="docutils literal"><span class="pre">None</span></code>&#x3002;</span></p></dd></dl><dl class="method"><dt id="sqlalchemy.types.TypeDecorator.result_processor"><span class="yiyi-st" id="yiyi-223"><code class="descname">result_processor</code> <span class="sig-paren">&#xFF08;</span> <em>dialect</em>&#xFF0C;<em>coltype</em> <span class="sig-paren">&#xFF09;</span> <a class="headerlink" href="#sqlalchemy.types.TypeDecorator.result_processor" title="Permalink to this definition">&#xB6;</a></span></dt><dd><p><span class="yiyi-st" id="yiyi-224">&#x4E3A;&#x7ED9;&#x5B9A;&#x7684;<a class="reference internal" href="internals.html#sqlalchemy.engine.interfaces.Dialect" title="sqlalchemy.engine.interfaces.Dialect"><code class="xref py py-class docutils literal"><span class="pre">Dialect</span></code></a>&#x63D0;&#x4F9B;&#x7ED3;&#x679C;&#x503C;&#x5904;&#x7406;&#x529F;&#x80FD;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-225">&#x8FD9;&#x662F;&#x5B9E;&#x73B0;&#x7ED3;&#x679C;&#x503C;&#x8F6C;&#x6362;&#x7684;<a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal"><span class="pre">TypeEngine</span></code></a>&#x5408;&#x540C;&#x7684;&#x65B9;&#x6CD5;&#x3002;</span><span class="yiyi-st" id="yiyi-226"><a class="reference internal" href="#sqlalchemy.types.TypeDecorator" title="sqlalchemy.types.TypeDecorator"><code class="xref py py-class docutils literal"><span class="pre">TypeDecorator</span></code></a> will wrap a user-defined implementation of <a class="reference internal" href="#sqlalchemy.types.TypeDecorator.process_result_value" title="sqlalchemy.types.TypeDecorator.process_result_value"><code class="xref py py-meth docutils literal"><span class="pre">process_result_value()</span></code></a> here.</span></p><p><span class="yiyi-st" id="yiyi-227">&#x7528;&#x6237;&#x5B9A;&#x4E49;&#x7684;&#x4EE3;&#x7801;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8986;&#x76D6;&#x6B64;&#x65B9;&#x6CD5;&#xFF0C;&#x5C3D;&#x7BA1;&#x5B83;&#x6700;&#x597D;&#x4F7F;&#x7528;<a class="reference internal" href="#sqlalchemy.types.TypeDecorator.process_result_value" title="sqlalchemy.types.TypeDecorator.process_result_value"><code class="xref py py-meth docutils literal"><span class="pre">process_result_value()</span></code></a>&#xFF0C;&#x4EE5;&#x4FDD;&#x6301;&#x7531;<code class="docutils literal"><span class="pre">self.impl</span></code>&#x63D0;&#x4F9B;&#x7684;&#x5904;&#x7406;&#x3002;</span></p><table class="docutils field-list" frame="void" rules="none"><tbody valign="top"><tr class="field-odd field"><th class="field-name"><span class="yiyi-st" id="yiyi-228">&#x53C2;&#x6570;&#xFF1A;</span></th><td class="field-body"><ul class="first last simple"><li><span class="yiyi-st" id="yiyi-229"><span class="target" id="sqlalchemy.types.TypeDecorator.result_processor.params.dialect"></span> <strong>dialect</strong> <a class="paramlink headerlink reference internal" href="#sqlalchemy.types.TypeDecorator.result_processor.params.dialect">&#xB6;</a>  -  Dialect&#x5B9E;&#x4F8B;&#x6B63;&#x5728;&#x4F7F;&#x7528;&#x4E2D;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-230"><span class="target" id="sqlalchemy.types.TypeDecorator.result_processor.params.coltype"></span> <strong>coltype</strong> <a class="paramlink headerlink reference internal" href="#sqlalchemy.types.TypeDecorator.result_processor.params.coltype">&#xB6;</a>  -  SQLAlchemy&#x6570;&#x636E;&#x7C7B;&#x578B;</span></li></ul></td></tr></tbody></table><p><span class="yiyi-st" id="yiyi-231">&#x6B64;&#x65B9;&#x6CD5;&#x4E0E;&#x6B64;&#x7C7B;&#x7684;<a class="reference internal" href="#sqlalchemy.types.TypeDecorator.bind_processor" title="sqlalchemy.types.TypeDecorator.bind_processor"><code class="xref py py-meth docutils literal"><span class="pre">bind_processor()</span></code></a>&#x65B9;&#x6CD5;&#x76F8;&#x53CD;&#x3002;</span></p></dd></dl><dl class="method"><dt id="sqlalchemy.types.TypeDecorator.type_engine"><span class="yiyi-st" id="yiyi-232"> <code class="descname">type_engine</code><span class="sig-paren">(</span><em>dialect</em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.types.TypeDecorator.type_engine" title="Permalink to this definition">&#xB6;</a></span></dt><dd><p><span class="yiyi-st" id="yiyi-233">&#x4E3A;<a class="reference internal" href="#sqlalchemy.types.TypeDecorator" title="sqlalchemy.types.TypeDecorator"><code class="xref py py-class docutils literal"><span class="pre">TypeDecorator</span></code></a>&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x7279;&#x5B9A;&#x4E8E;&#x65B9;&#x8A00;&#x7684;<a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal"><span class="pre">TypeEngine</span></code></a>&#x5B9E;&#x4F8B;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-234">&#x5728;&#x5927;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8FD9;&#x8FD4;&#x56DE;&#x7531;<code class="docutils literal"><span class="pre">self.impl</span></code>&#x8868;&#x793A;&#x7684;<a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal"><span class="pre">TypeEngine</span></code></a>&#x7C7B;&#x578B;&#x7684;&#x65B9;&#x8A00;&#x9002;&#x5E94;&#x5F62;&#x5F0F;&#x3002;</span><span class="yiyi-st" id="yiyi-235">&#x4F7F;&#x7528;<a class="reference internal" href="#sqlalchemy.types.TypeDecorator.dialect_impl" title="sqlalchemy.types.TypeDecorator.dialect_impl"><code class="xref py py-meth docutils literal"><span class="pre">dialect_impl()</span></code></a>&#xFF0C;&#x4F46;&#x4E5F;&#x904D;&#x5386;&#x5305;&#x88C5;&#x7684;<a class="reference internal" href="#sqlalchemy.types.TypeDecorator" title="sqlalchemy.types.TypeDecorator"><code class="xref py py-class docutils literal"><span class="pre">TypeDecorator</span></code></a>&#x5B9E;&#x4F8B;&#x3002;</span><span class="yiyi-st" id="yiyi-236">&#x884C;&#x4E3A;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8986;&#x76D6;<a class="reference internal" href="#sqlalchemy.types.TypeDecorator.load_dialect_impl" title="sqlalchemy.types.TypeDecorator.load_dialect_impl"><code class="xref py py-meth docutils literal"><span class="pre">load_dialect_impl()</span></code></a>&#x6765;&#x5B9A;&#x5236;&#x3002;</span></p></dd></dl><dl class="method"><dt id="sqlalchemy.types.TypeDecorator.with_variant"><span class="yiyi-st" id="yiyi-237"><code class="descname">with_variant</code> <span class="sig-paren">&#xFF08;</span> <em>type_</em>&#xFF0C;<em>dialect_name</em> <span class="sig-paren">&#xFF09;</span> <a class="headerlink" href="#sqlalchemy.types.TypeDecorator.with_variant" title="Permalink to this definition"></a></span></dt><dd><div class="inherited-member container"><span class="yiyi-st" id="yiyi-238"> <em>inherited from the</em> <a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine.with_variant" title="sqlalchemy.types.TypeEngine.with_variant"><code class="xref py py-meth docutils literal"><span class="pre">with_variant()</span></code></a> <em>method of</em> <a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal"><span class="pre">TypeEngine</span></code></a></span></div><p><span class="yiyi-st" id="yiyi-239">&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x7C7B;&#x578B;&#x5BF9;&#x8C61;&#xFF0C;&#x5C06;&#x5176;&#x5E94;&#x7528;&#x4E8E;&#x7ED9;&#x5B9A;&#x540D;&#x79F0;&#x7684;&#x65B9;&#x8A00;&#x65F6;&#x4F7F;&#x7528;&#x7ED9;&#x5B9A;&#x7684;&#x7C7B;&#x578B;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-240">&#x4F8B;&#x5982;&#x3002;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.types</span> <span class="kn">import</span> <span class="n">String</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.dialects</span> <span class="kn">import</span> <span class="n">mysql</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">String</span><span class="p">()</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">with_variant</span><span class="p">(</span><span class="n">mysql</span><span class="o">.</span><span class="n">VARCHAR</span><span class="p">(</span><span class="n">collation</span><span class="o">=</span><span class="s1">&apos;foo&apos;</span><span class="p">),</span> <span class="s1">&apos;mysql&apos;</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-241"><a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine.with_variant" title="sqlalchemy.types.TypeEngine.with_variant"><code class="xref py py-meth docutils literal"><span class="pre">TypeEngine.with_variant()</span></code></a>&#x7684;&#x6784;&#x9020;&#x59CB;&#x7EC8;&#x662F;&#x4ECE;&#x201C;fallback&#x201D;&#x7C7B;&#x578B;&#x5230;&#x7279;&#x5B9A;&#x4E8E;&#x65B9;&#x8A00;&#x7684;&#x3002;</span><span class="yiyi-st" id="yiyi-242">&#x8FD4;&#x56DE;&#x7684;&#x7C7B;&#x578B;&#x662F;<a class="reference internal" href="type_api.html#sqlalchemy.types.Variant" title="sqlalchemy.types.Variant"><code class="xref py py-class docutils literal"><span class="pre">Variant</span></code></a>&#x7684;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;&#xFF0C;&#x5B83;&#x672C;&#x8EAB;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x53EF;&#x91CD;&#x590D;&#x8C03;&#x7528;&#x7684;<code class="xref py py-meth docutils literal"><span class="pre">Variant.with_variant()</span></code>&#x3002;</span></p><table class="docutils field-list" frame="void" rules="none"><tbody valign="top"><tr class="field-odd field"><th class="field-name"><span class="yiyi-st" id="yiyi-243">&#x53C2;&#x6570;&#xFF1A;</span></th><td class="field-body"><ul class="first last simple"><li><span class="yiyi-st" id="yiyi-244"><span class="target" id="sqlalchemy.types.TypeDecorator.with_variant.params.type_"></span><strong>type_</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.types.TypeDecorator.with_variant.params.type_">&#xB6;</a> &#x2013; a <a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal"><span class="pre">TypeEngine</span></code></a> that will be selected as a variant from the originating type, when a dialect of the given name is in use.</span></li><li><span class="yiyi-st" id="yiyi-245"><span class="target" id="sqlalchemy.types.TypeDecorator.with_variant.params.dialect_name"></span><strong>dialect_name</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.types.TypeDecorator.with_variant.params.dialect_name">&#xB6;</a> &#x2013; base name of the dialect which uses this type. </span><span class="yiyi-st" id="yiyi-246">&#xFF08;&#x5373;<code class="docutils literal"><span class="pre">&apos;postgresql&apos;</span></code>&#xFF0C;<code class="docutils literal"><span class="pre">&apos;mysql&apos;</span></code>&#x7B49;&#xFF09;</span></li></ul></td></tr></tbody></table><div class="versionadded"><p><span class="yiyi-st" id="yiyi-247"><span class="versionmodified">New in version 0.7.2.</span></span></p></div></dd></dl></dd></dl></div><div class="section" id="typedecorator-recipes"><h2><span class="yiyi-st" id="yiyi-248">TypeDecorator Recipes <a class="headerlink" href="#typedecorator-recipes" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-249">&#x63A5;&#x4E0B;&#x6765;&#x51E0;&#x4E2A;&#x5173;&#x952E;&#x7684;<a class="reference internal" href="#sqlalchemy.types.TypeDecorator" title="sqlalchemy.types.TypeDecorator"><code class="xref py py-class docutils literal"><span class="pre">TypeDecorator</span></code></a>&#x98DF;&#x8C31;&#x3002;</span></p><div class="section" id="coercing-encoded-strings-to-unicode"><h3><span class="yiyi-st" id="yiyi-250">&#x5C06;&#x7F16;&#x7801;&#x5B57;&#x7B26;&#x4E32;&#x5F3A;&#x5236;&#x4E3A;Unicode <a class="headerlink" href="#coercing-encoded-strings-to-unicode" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-251">A common source of confusion regarding the <a class="reference internal" href="type_basics.html#sqlalchemy.types.Unicode" title="sqlalchemy.types.Unicode"><code class="xref py py-class docutils literal"><span class="pre">Unicode</span></code></a> type is that it is intended to deal <em>only</em> with Python <code class="docutils literal"><span class="pre">unicode</span></code> objects on the Python side, meaning values passed to it as bind parameters must be of the form <code class="docutils literal"><span class="pre">u&apos;some</span> <span class="pre">string&apos;</span></code> if using Python 2 and not 3. </span><span class="yiyi-st" id="yiyi-252">&#x5B83;&#x6267;&#x884C;&#x7684;&#x7F16;&#x7801;/&#x89E3;&#x7801;&#x529F;&#x80FD;&#x4EC5;&#x9002;&#x7528;&#x4E8E;&#x6B63;&#x5728;&#x4F7F;&#x7528;&#x7684;DBAPI&#xFF0C;&#x5E76;&#x4E14;&#x4E3B;&#x8981;&#x662F;&#x79C1;&#x6709;&#x5B9E;&#x73B0;&#x7EC6;&#x8282;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-253">The use case of a type that can safely receive Python bytestrings, that is strings that contain non-ASCII characters and are not <code class="docutils literal"><span class="pre">u&apos;&apos;</span></code> objects in Python 2, can be achieved using a <a class="reference internal" href="#sqlalchemy.types.TypeDecorator" title="sqlalchemy.types.TypeDecorator"><code class="xref py py-class docutils literal"><span class="pre">TypeDecorator</span></code></a> which coerces as needed:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.types</span> <span class="kn">import</span> <span class="n">TypeDecorator</span><span class="p">,</span> <span class="n">Unicode</span>

<span class="k">class</span> <span class="nc">CoerceUTF8</span><span class="p">(</span><span class="n">TypeDecorator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Safely coerce Python bytestrings to Unicode</span>
<span class="sd">    before passing off to the database.&quot;&quot;&quot;</span>

    <span class="n">impl</span> <span class="o">=</span> <span class="n">Unicode</span>

    <span class="k">def</span> <span class="nf">process_bind_param</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">dialect</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&apos;utf-8&apos;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span></pre></div></div></div><div class="section" id="rounding-numerics"><h3><span class="yiyi-st" id="yiyi-254">&#x820D;&#x5165;&#x6570;&#x5B57;<a class="headerlink" href="#rounding-numerics" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-255">&#x67D0;&#x4E9B;&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;&#x5668;&#xFF08;&#x5982;SQL Server&#x7684;&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;&#x5668;&#xFF09;&#x4F1A;&#x5728;&#x5C0F;&#x6570;&#x4F4D;&#x6570;&#x8FC7;&#x591A;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x4F20;&#x9012;Decimal&#x3002;</span><span class="yiyi-st" id="yiyi-256">&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x8BA9;&#x4ED6;&#x4EEC;&#x6EE1;&#x610F;&#x7684;&#x98DF;&#x8C31;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.types</span> <span class="kn">import</span> <span class="n">TypeDecorator</span><span class="p">,</span> <span class="n">Numeric</span>
<span class="kn">from</span> <span class="nn">decimal</span> <span class="kn">import</span> <span class="n">Decimal</span>

<span class="k">class</span> <span class="nc">SafeNumeric</span><span class="p">(</span><span class="n">TypeDecorator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Adds quantization to Numeric.&quot;&quot;&quot;</span>

    <span class="n">impl</span> <span class="o">=</span> <span class="n">Numeric</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">TypeDecorator</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quantize_int</span> <span class="o">=</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">impl</span><span class="o">.</span><span class="n">scale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quantize</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantize_int</span>

    <span class="k">def</span> <span class="nf">process_bind_param</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">dialect</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">)</span> <span class="ow">and</span> \
            <span class="n">value</span><span class="o">.</span><span class="n">as_tuple</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantize_int</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quantize</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span></pre></div></div></div><div class="section" id="backend-agnostic-guid-type"><h3><span class="yiyi-st" id="yiyi-257">&#x540E;&#x7AEF;&#x4E0D;&#x53EF;&#x77E5;&#x7684;GUID&#x7C7B;&#x578B;<a class="headerlink" href="#backend-agnostic-guid-type" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-258">&#x63A5;&#x6536;&#x5E76;&#x8FD4;&#x56DE;Python uuid()&#x5BF9;&#x8C61;&#x3002;</span><span class="yiyi-st" id="yiyi-259">&#x5728;&#x5176;&#x4ED6;&#x540E;&#x7AEF;&#x4F7F;&#x7528;Postgresql&#xFF0C;CHAR&#xFF08;32&#xFF09;&#x65F6;&#x4F7F;&#x7528;PG UUID&#x7C7B;&#x578B;&#xFF0C;&#x5E76;&#x4EE5;&#x5B57;&#x7B26;&#x4E32;&#x5316;&#x7684;&#x5341;&#x516D;&#x8FDB;&#x5236;&#x683C;&#x5F0F;&#x5B58;&#x50A8;&#x5B83;&#x4EEC;&#x3002;</span><span class="yiyi-st" id="yiyi-260">&#x5982;&#x679C;&#x9700;&#x8981;&#xFF0C;&#x53EF;&#x4EE5;&#x4FEE;&#x6539;&#x4EE5;&#x5728;CHAR&#xFF08;16&#xFF09;&#x4E2D;&#x5B58;&#x50A8;&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.types</span> <span class="kn">import</span> <span class="n">TypeDecorator</span><span class="p">,</span> <span class="n">CHAR</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.dialects.postgresql</span> <span class="kn">import</span> <span class="n">UUID</span>
<span class="kn">import</span> <span class="nn">uuid</span>

<span class="k">class</span> <span class="nc">GUID</span><span class="p">(</span><span class="n">TypeDecorator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Platform-independent GUID type.</span>

<span class="sd">    Uses Postgresql&apos;s UUID type, otherwise uses</span>
<span class="sd">    CHAR(32), storing as stringified hex values.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">impl</span> <span class="o">=</span> <span class="n">CHAR</span>

    <span class="k">def</span> <span class="nf">load_dialect_impl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dialect</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">dialect</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&apos;postgresql&apos;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dialect</span><span class="o">.</span><span class="n">type_descriptor</span><span class="p">(</span><span class="n">UUID</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dialect</span><span class="o">.</span><span class="n">type_descriptor</span><span class="p">(</span><span class="n">CHAR</span><span class="p">(</span><span class="mi">32</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">process_bind_param</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">dialect</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="n">dialect</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&apos;postgresql&apos;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">):</span>
                <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%.32x</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">int</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># hexstring</span>
                <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%.32x</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">value</span><span class="o">.</span><span class="n">int</span>

    <span class="k">def</span> <span class="nf">process_result_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">dialect</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></pre></div></div></div><div class="section" id="marshal-json-strings"><h3><span class="yiyi-st" id="yiyi-261">Marshal JSON&#x5B57;&#x7B26;&#x4E32;<a class="headerlink" href="#marshal-json-strings" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-262">&#x8FD9;&#x79CD;&#x7C7B;&#x578B;&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">simplejson</span></code>&#x5C06;Python&#x6570;&#x636E;&#x7ED3;&#x6784;&#x5C01;&#x9001;&#x5230;/&#x6765;&#x81EA;JSON&#x3002;</span><span class="yiyi-st" id="yiyi-263">&#x53EF;&#x4EE5;&#x4FEE;&#x6539;&#x4E3A;&#x4F7F;&#x7528;Python&#x7684;&#x5185;&#x7F6E;json&#x7F16;&#x7801;&#x5668;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.types</span> <span class="kn">import</span> <span class="n">TypeDecorator</span><span class="p">,</span> <span class="n">VARCHAR</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="k">class</span> <span class="nc">JSONEncodedDict</span><span class="p">(</span><span class="n">TypeDecorator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Represents an immutable structure as a json-encoded string.</span>

<span class="sd">    Usage::</span>

<span class="sd">        JSONEncodedDict(255)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">impl</span> <span class="o">=</span> <span class="n">VARCHAR</span>

    <span class="k">def</span> <span class="nf">process_bind_param</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">dialect</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">process_result_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">dialect</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span></pre></div></div><p><span class="yiyi-st" id="yiyi-264">&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;ORM&#x4E0D;&#x4F1A;&#x68C0;&#x6D4B;&#x5230;&#x8FD9;&#x79CD;&#x7C7B;&#x578B;&#x7684;&#x201C;&#x53EF;&#x53D8;&#x6027;&#x201D; - &#x8FD9;&#x610F;&#x5473;&#x7740;&#xFF0C;&#x5C31;&#x5730;&#x66F4;&#x6539;&#x503C;&#x4E0D;&#x4F1A;&#x88AB;&#x68C0;&#x6D4B;&#x5230;&#xFF0C;&#x4E5F;&#x4E0D;&#x4F1A;&#x88AB;&#x5237;&#x65B0;&#x3002;</span><span class="yiyi-st" id="yiyi-265">&#x5982;&#x679C;&#x6CA1;&#x6709;&#x8FDB;&#x4E00;&#x6B65;&#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x60A8;&#x9700;&#x8981;&#x7528;&#x6BCF;&#x4E2A;&#x7236;&#x5BF9;&#x8C61;&#x4E0A;&#x7684;&#x65B0;&#x503C;&#x66FF;&#x6362;&#x73B0;&#x6709;&#x503C;&#x4EE5;&#x68C0;&#x6D4B;&#x66F4;&#x6539;&#x3002;</span><span class="yiyi-st" id="yiyi-266">&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x8FD9;&#x6CA1;&#x6709;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#xFF0C;&#x56E0;&#x4E3A;&#x8BB8;&#x591A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x53EF;&#x80FD;&#x4E0D;&#x9700;&#x8981;&#x4E00;&#x65E6;&#x521B;&#x5EFA;&#x503C;&#x5C31;&#x4F1A;&#x53D1;&#x751F;&#x53D8;&#x5316;&#x3002;</span><span class="yiyi-st" id="yiyi-267">&#x5BF9;&#x4E8E;&#x90A3;&#x4E9B;&#x786E;&#x5B9E;&#x6709;&#x6B64;&#x8981;&#x6C42;&#x7684;&#x7528;&#x6237;&#xFF0C;&#x6700;&#x597D;&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">sqlalchemy.ext.mutable</span></code>&#x6269;&#x5C55;&#x540D;&#x5E94;&#x7528;&#x5BF9;&#x53EF;&#x53D8;&#x6027;&#x7684;&#x652F;&#x6301; - &#x8BF7;&#x53C2;&#x9605;<a class="reference internal" href="orm_extensions_mutable.html"><span>Mutation Tracking</span></a>&#x4E2D;&#x7684;&#x793A;&#x4F8B;&#x3002;</span></p></div></div><div class="section" id="replacing-the-bind-result-processing-of-existing-types"><h2><span class="yiyi-st" id="yiyi-268">&#x66FF;&#x6362;&#x73B0;&#x6709;&#x7C7B;&#x578B;&#x7684;&#x7ED1;&#x5B9A;/&#x7ED3;&#x679C;&#x5904;&#x7406;<a class="headerlink" href="#replacing-the-bind-result-processing-of-existing-types" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-269">&#x4F7F;&#x7528;<a class="reference internal" href="#sqlalchemy.types.TypeDecorator" title="sqlalchemy.types.TypeDecorator"><code class="xref py py-class docutils literal"><span class="pre">TypeDecorator</span></code></a>&#x5B9E;&#x73B0;&#x7ED1;&#x5B9A;/&#x7ED3;&#x679C;&#x7EA7;&#x522B;&#x7684;&#x5927;&#x90E8;&#x5206;&#x7C7B;&#x578B;&#x884C;&#x4E3A;&#x589E;&#x5F3A;&#x3002;</span><span class="yiyi-st" id="yiyi-270">&#x5BF9;&#x4E8E;&#x9700;&#x8981;&#x66FF;&#x6362;&#x7531;SQLAlchemy&#x5728;DBAPI&#x7EA7;&#x522B;&#x5E94;&#x7528;&#x7684;&#x7279;&#x5B9A;&#x5904;&#x7406;&#x7684;&#x7F55;&#x89C1;&#x573A;&#x666F;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5BF9;SQLAlchemy&#x7C7B;&#x578B;&#x8FDB;&#x884C;&#x5B50;&#x7C7B;&#x5316;&#xFF0C;&#x5E76;&#x4E14;<code class="docutils literal"><span class="pre">bind_processor()</span></code>&#x6216;<code class="docutils literal"><span class="pre">result_processor()</span></code></span><span class="yiyi-st" id="yiyi-271">&#x8FD9;&#x6837;&#x505A;&#x9700;&#x8981;&#x91CD;&#x5199;<code class="docutils literal"><span class="pre">adapt()</span></code>&#x65B9;&#x6CD5;&#x3002;</span><span class="yiyi-st" id="yiyi-272">&#x6B64;&#x65B9;&#x6CD5;&#x662F;SQLAlchemy&#x5728;&#x6267;&#x884C;&#x8BED;&#x53E5;&#x671F;&#x95F4;&#x751F;&#x6210;&#x7279;&#x5B9A;&#x4E8E;DBAPI&#x7684;&#x7C7B;&#x578B;&#x884C;&#x4E3A;&#x7684;&#x673A;&#x5236;&#x3002;</span><span class="yiyi-st" id="yiyi-273">&#x8986;&#x76D6;&#x5B83;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x81EA;&#x5B9A;&#x4E49;&#x7C7B;&#x578B;&#x7684;&#x526F;&#x672C;&#x6765;&#x4EE3;&#x66FF;DBAPI&#x7279;&#x5B9A;&#x7684;&#x7C7B;&#x578B;&#x3002;</span><span class="yiyi-st" id="yiyi-274">&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x5C06;<a class="reference internal" href="type_basics.html#sqlalchemy.types.TIME" title="sqlalchemy.types.TIME"><code class="xref py py-class docutils literal"><span class="pre">types.TIME</span></code></a>&#x7C7B;&#x578B;&#x8FDB;&#x884C;&#x5B50;&#x7C7B;&#x5316;&#x4EE5;&#x5177;&#x6709;&#x81EA;&#x5B9A;&#x4E49;&#x7ED3;&#x679C;&#x5904;&#x7406;&#x884C;&#x4E3A;&#x3002;</span><span class="yiyi-st" id="yiyi-275"><code class="docutils literal"><span class="pre">process()</span></code>&#x51FD;&#x6570;&#x5C06;&#x76F4;&#x63A5;&#x4ECE;DBAPI&#x6E38;&#x6807;&#x63A5;&#x6536;<code class="docutils literal"><span class="pre">value</span></code>&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MySpecialTime</span><span class="p">(</span><span class="n">TIME</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">special_argument</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MySpecialTime</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">special_argument</span> <span class="o">=</span> <span class="n">special_argument</span>

    <span class="k">def</span> <span class="nf">result_processor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dialect</span><span class="p">,</span> <span class="n">coltype</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">datetime</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">time</span>
        <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">microseconds</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">microseconds</span>
                <span class="n">seconds</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">seconds</span>
                <span class="n">minutes</span> <span class="o">=</span> <span class="n">seconds</span> <span class="o">/</span> <span class="mi">60</span>
                <span class="k">return</span> <span class="n">time</span><span class="p">(</span>
                          <span class="n">minutes</span> <span class="o">/</span> <span class="mi">60</span><span class="p">,</span>
                          <span class="n">minutes</span> <span class="o">%</span> <span class="mi">60</span><span class="p">,</span>
                          <span class="n">seconds</span> <span class="o">-</span> <span class="n">minutes</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span>
                          <span class="n">microseconds</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="n">process</span>

    <span class="k">def</span> <span class="nf">adapt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">impltype</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">MySpecialTime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">special_argument</span><span class="p">)</span></pre></div></div></div><div class="section" id="applying-sql-level-bind-result-processing"><h2><span class="yiyi-st" id="yiyi-276">&#x5E94;&#x7528;SQL&#x7EA7;&#x7ED1;&#x5B9A;/&#x7ED3;&#x679C;&#x5904;&#x7406;<a class="headerlink" href="#applying-sql-level-bind-result-processing" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-277">&#x5982;&#x5728;<a class="reference internal" href="#types-typedecorator"><span>Augmenting Existing Types</span></a>&#x548C;<a class="reference internal" href="#replacing-processors"><span>Replacing the Bind/Result Processing of Existing Types</span></a>&#x90E8;&#x5206;&#x6240;&#x89C1;&#xFF0C;SQLAlchemy&#x5141;&#x8BB8;&#x5728;&#x5C06;&#x53C2;&#x6570;&#x53D1;&#x9001;&#x5230;&#x8BED;&#x53E5;&#x65F6;&#x8C03;&#x7528;Python&#x51FD;&#x6570;&#xFF0C;&#x5982;&#x4EE5;&#x53CA;&#x4ECE;&#x6570;&#x636E;&#x5E93;&#x52A0;&#x8F7D;&#x7ED3;&#x679C;&#x884C;&#x65F6;&#xFF0C;&#x4EE5;&#x53CA;&#x5728;&#x5C06;&#x6570;&#x636E;&#x53D1;&#x9001;&#x5230;&#x6570;&#x636E;&#x5E93;&#x6216;&#x4ECE;&#x6570;&#x636E;&#x5E93;&#x53D1;&#x9001;&#x65F6;&#x5BF9;&#x5176;&#x5E94;&#x7528;&#x8F6C;&#x6362;&#x3002;</span><span class="yiyi-st" id="yiyi-278">&#x4E5F;&#x53EF;&#x4EE5;&#x5B9A;&#x4E49;SQL&#x7EA7;&#x522B;&#x7684;&#x8F6C;&#x6362;&#x3002;</span><span class="yiyi-st" id="yiyi-279">&#x8FD9;&#x91CC;&#x7684;&#x57FA;&#x672C;&#x539F;&#x7406;&#x662F;&#xFF0C;&#x53EA;&#x6709;&#x5173;&#x7CFB;&#x6570;&#x636E;&#x5E93;&#x5305;&#x542B;&#x4E00;&#x7CFB;&#x5217;&#x5FC5;&#x8981;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x624D;&#x80FD;&#x5728;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x548C;&#x6301;&#x4E45;&#x6027;&#x683C;&#x5F0F;&#x4E4B;&#x95F4;&#x5F3A;&#x5236;&#x4F20;&#x5165;&#x548C;&#x4F20;&#x51FA;&#x6570;&#x636E;&#x3002;</span><span class="yiyi-st" id="yiyi-280">&#x4F8B;&#x5B50;&#x5305;&#x62EC;&#x4F7F;&#x7528;&#x6570;&#x636E;&#x5E93;&#x5B9A;&#x4E49;&#x7684;&#x52A0;&#x5BC6;/&#x89E3;&#x5BC6;&#x51FD;&#x6570;&#xFF0C;&#x4EE5;&#x53CA;&#x5904;&#x7406;&#x5730;&#x7406;&#x6570;&#x636E;&#x7684;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#x3002;</span><span class="yiyi-st" id="yiyi-281">Postgis&#x5BF9;Postgresql&#x7684;&#x6269;&#x5C55;&#x5305;&#x62EC;&#x4E00;&#x7CFB;&#x5217;SQL&#x51FD;&#x6570;&#xFF0C;&#x8FD9;&#x4E9B;&#x51FD;&#x6570;&#x662F;&#x5C06;&#x6570;&#x636E;&#x5F3A;&#x5236;&#x8F6C;&#x6362;&#x4E3A;&#x7279;&#x5B9A;&#x683C;&#x5F0F;&#x6240;&#x5FC5;&#x9700;&#x7684;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-282">&#x4EFB;&#x4F55;<a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal"><span class="pre">TypeEngine</span></code></a>&#xFF0C;<a class="reference internal" href="#sqlalchemy.types.UserDefinedType" title="sqlalchemy.types.UserDefinedType"><code class="xref py py-class docutils literal"><span class="pre">UserDefinedType</span></code></a>&#x6216;<a class="reference internal" href="#sqlalchemy.types.TypeDecorator" title="sqlalchemy.types.TypeDecorator"><code class="xref py py-class docutils literal"><span class="pre">TypeDecorator</span></code></a>&#x5B50;&#x7C7B;&#x90FD;&#x53EF;&#x4EE5;&#x5305;&#x542B;<a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine.bind_expression" title="sqlalchemy.types.TypeEngine.bind_expression"><code class="xref py py-meth docutils literal"><span class="pre">TypeEngine.bind_expression()</span></code></a>&#x548C;/&#x6216;<a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine.column_expression" title="sqlalchemy.types.TypeEngine.column_expression"><code class="xref py py-meth docutils literal"><span class="pre">TypeEngine.column_expression()</span></code></a>&#xFF0C;&#x5F53;&#x5B9A;&#x4E49;&#x4E3A;&#x8FD4;&#x56DE;&#x975E;<code class="docutils literal"><span class="pre">None</span></code>&#x503C;&#x65F6;&#xFF0C;&#x5E94;&#x8FD4;&#x56DE;&#x8981;&#x6CE8;&#x5165;SQL&#x8BED;&#x53E5;&#x7684;<a class="reference internal" href="sqlelement.html#sqlalchemy.sql.expression.ColumnElement" title="sqlalchemy.sql.expression.ColumnElement"><code class="xref py py-class docutils literal"><span class="pre">ColumnElement</span></code></a>&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x53C2;&#x6570;&#x6216;&#x5217;&#x8868;&#x8FBE;&#x5F0F;&#x3002;</span><span class="yiyi-st" id="yiyi-283">&#x4F8B;&#x5982;&#xFF0C;&#x8981;&#x6784;&#x5EFA;&#x5C06;&#x6240;&#x6709;&#x4F20;&#x5165;&#x6570;&#x636E;&#x5E94;&#x7528;&#x4E8E;Postgis&#x51FD;&#x6570;<code class="docutils literal"><span class="pre">ST_GeomFromText</span></code>&#x7684;&#x6240;&#x6709;&#x4F20;&#x51FA;&#x503C;&#x548C;&#x51FD;&#x6570;<code class="docutils literal"><span class="pre">ST_AsText</span></code>&#x7684;<code class="docutils literal"><span class="pre">Geometry</span></code>&#x7C7B;&#x578B;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x521B;&#x5EFA;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x7684;<a class="reference internal" href="#sqlalchemy.types.UserDefinedType" title="sqlalchemy.types.UserDefinedType"><code class="xref py py-class docutils literal"><span class="pre">UserDefinedType</span></code></a>&#x7684;&#x5B50;&#x7C7B;&#xFF0C;&#x5B83;&#x63D0;&#x4F9B;&#x8FD9;&#x4E9B;&#x65B9;&#x6CD5;&#x4E0E;<a class="reference internal" href="sqlelement.html#sqlalchemy.sql.expression.func" title="sqlalchemy.sql.expression.func"><code class="xref py py-data docutils literal"><span class="pre">func</span></code></a>&#x7ED3;&#x5408;&#x4F7F;&#x7528;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">func</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.types</span> <span class="kn">import</span> <span class="n">UserDefinedType</span>

<span class="k">class</span> <span class="nc">Geometry</span><span class="p">(</span><span class="n">UserDefinedType</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_col_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;GEOMETRY&quot;</span>

    <span class="k">def</span> <span class="nf">bind_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bindvalue</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">func</span><span class="o">.</span><span class="n">ST_GeomFromText</span><span class="p">(</span><span class="n">bindvalue</span><span class="p">,</span> <span class="n">type_</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">column_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">func</span><span class="o">.</span><span class="n">ST_AsText</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">type_</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-284">&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5C06;<code class="docutils literal"><span class="pre">Geometry</span></code>&#x7C7B;&#x578B;&#x5E94;&#x7528;&#x5230;<a class="reference internal" href="metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal"><span class="pre">Table</span></code></a>&#x5143;&#x6570;&#x636E;&#x4E2D;&#xFF0C;&#x5E76;&#x5C06;&#x5176;&#x7528;&#x4E8E;<a class="reference internal" href="selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal"><span class="pre">select()</span></code></a>&#x7ED3;&#x6784;&#x4E2D;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">geometry</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&apos;geometry&apos;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
              <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;geom_id&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
              <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;geom_data&apos;</span><span class="p">,</span> <span class="n">Geometry</span><span class="p">)</span>
            <span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">select</span><span class="p">([</span><span class="n">geometry</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
  <span class="n">geometry</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">geom_data</span> <span class="o">==</span> <span class="s1">&apos;LINESTRING(189412 252431,189631 259122)&apos;</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-285">&#x7ED3;&#x679C;SQL&#x6839;&#x636E;&#x9700;&#x8981;&#x5D4C;&#x5165;&#x4E24;&#x4E2A;&#x51FD;&#x6570;&#x3002;</span><span class="yiyi-st" id="yiyi-286"><code class="docutils literal"><span class="pre">ST_AsText</span></code> is applied to the columns clause so that the return value is run through the function before passing into a result set, and <code class="docutils literal"><span class="pre">ST_GeomFromText</span></code> is run on the bound parameter so that the passed-in value is converted:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT geometry.geom_id, ST_AsText(geometry.geom_data) AS geom_data_1
FROM geometry
WHERE geometry.geom_data = ST_GeomFromText(:geom_data_2)</pre></div></div><p><span class="yiyi-st" id="yiyi-287">The <a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine.column_expression" title="sqlalchemy.types.TypeEngine.column_expression"><code class="xref py py-meth docutils literal"><span class="pre">TypeEngine.column_expression()</span></code></a> method interacts with the mechanics of the compiler such that the SQL expression does not interfere with the labeling of the wrapped expression. </span><span class="yiyi-st" id="yiyi-288">&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x9488;&#x5BF9;&#x8868;&#x8FBE;&#x5F0F;&#x7684;<a class="reference internal" href="sqlelement.html#sqlalchemy.sql.expression.label" title="sqlalchemy.sql.expression.label"><code class="xref py py-func docutils literal"><span class="pre">label()</span></code></a>&#x5448;&#x73B0;<a class="reference internal" href="selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal"><span class="pre">select()</span></code></a>&#xFF0C;&#x5219;&#x5C06;&#x5B57;&#x7B26;&#x4E32;&#x6807;&#x7B7E;&#x79FB;&#x52A8;&#x5230;&#x5305;&#x88C5;&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x5916;&#x90E8;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">select</span><span class="p">([</span><span class="n">geometry</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">geom_data</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="s1">&apos;my_data&apos;</span><span class="p">)]))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-289">&#x8F93;&#x51FA;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT ST_AsText(geometry.geom_data) AS my_data
FROM geometry</pre></div></div><p><span class="yiyi-st" id="yiyi-290">&#x5BF9;&#x4E8E;&#x76F4;&#x63A5;&#x5BF9;&#x5185;&#x7F6E;&#x7C7B;&#x578B;&#x8FDB;&#x884C;&#x5B50;&#x7C7B;&#x5316;&#x7684;&#x793A;&#x4F8B;&#xFF0C;&#x6211;&#x4EEC;&#x7EE7;&#x627F;<a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.BYTEA" title="sqlalchemy.dialects.postgresql.BYTEA"><code class="xref py py-class docutils literal"><span class="pre">postgresql.BYTEA</span></code></a>&#x4EE5;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;<code class="docutils literal"><span class="pre">PGPString</span></code>&#xFF0C;&#x5B83;&#x5C06;&#x5229;&#x7528;Postgresql <code class="docutils literal"><span class="pre">pgcrypto</span></code>&#x900F;&#x660E;&#x5730;&#x6269;&#x5C55;&#x5230;encrpyt /&#x89E3;&#x5BC6;&#x503C;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">select</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> \
        <span class="n">MetaData</span><span class="p">,</span> <span class="n">Table</span><span class="p">,</span> <span class="n">Column</span><span class="p">,</span> <span class="n">type_coerce</span>

<span class="kn">from</span> <span class="nn">sqlalchemy.dialects.postgresql</span> <span class="kn">import</span> <span class="n">BYTEA</span>

<span class="k">class</span> <span class="nc">PGPString</span><span class="p">(</span><span class="n">BYTEA</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">passphrase</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PGPString</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">passphrase</span> <span class="o">=</span> <span class="n">passphrase</span>

    <span class="k">def</span> <span class="nf">bind_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bindvalue</span><span class="p">):</span>
        <span class="c1"># convert the bind&apos;s type from PGPString to</span>
        <span class="c1"># String, so that it&apos;s passed to psycopg2 as is without</span>
        <span class="c1"># a dbapi.Binary wrapper</span>
        <span class="n">bindvalue</span> <span class="o">=</span> <span class="n">type_coerce</span><span class="p">(</span><span class="n">bindvalue</span><span class="p">,</span> <span class="n">String</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">func</span><span class="o">.</span><span class="n">pgp_sym_encrypt</span><span class="p">(</span><span class="n">bindvalue</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">passphrase</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">column_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">func</span><span class="o">.</span><span class="n">pgp_sym_decrypt</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">passphrase</span><span class="p">)</span>

<span class="n">metadata</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">()</span>
<span class="n">message</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&apos;message&apos;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
                <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;username&apos;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">)),</span>
                <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;message&apos;</span><span class="p">,</span>
                    <span class="n">PGPString</span><span class="p">(</span><span class="s2">&quot;this is my passphrase&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">1000</span><span class="p">)),</span>
            <span class="p">)</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;postgresql://scott:tiger@localhost/test&quot;</span><span class="p">,</span> <span class="n">echo</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>

    <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">insert</span><span class="p">(),</span> <span class="n">username</span><span class="o">=</span><span class="s2">&quot;some user&quot;</span><span class="p">,</span>
                                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;this is my message&quot;</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="n">conn</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span>
            <span class="n">select</span><span class="p">([</span><span class="n">message</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">message</span><span class="p">])</span><span class="o">.</span>\
                <span class="n">where</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">username</span> <span class="o">==</span> <span class="s2">&quot;some user&quot;</span><span class="p">)</span>
        <span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-291"><code class="docutils literal"><span class="pre">pgp_sym_encrypt</span></code>&#x548C;<code class="docutils literal"><span class="pre">pgp_sym_decrypt</span></code>&#x51FD;&#x6570;&#x5E94;&#x7528;&#x4E8E;INSERT&#x548C;SELECT&#x8BED;&#x53E5;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>INSERT INTO message (username, message)
  VALUES (%(username)s, pgp_sym_encrypt(%(message)s, %(pgp_sym_encrypt_1)s))
  {&apos;username&apos;: &apos;some user&apos;, &apos;message&apos;: &apos;this is my message&apos;,
    &apos;pgp_sym_encrypt_1&apos;: &apos;this is my passphrase&apos;}

SELECT pgp_sym_decrypt(message.message, %(pgp_sym_decrypt_1)s) AS message_1
  FROM message
  WHERE message.username = %(username_1)s
  {&apos;pgp_sym_decrypt_1&apos;: &apos;this is my passphrase&apos;, &apos;username_1&apos;: &apos;some user&apos;}</pre></div></div><div class="versionadded"><p><span class="yiyi-st" id="yiyi-292"><span class="versionmodified">0.8&#x7248;&#x65B0;&#x589E;&#xFF1A;</span>&#x6DFB;&#x52A0;&#x4E86;<a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine.bind_expression" title="sqlalchemy.types.TypeEngine.bind_expression"><code class="xref py py-meth docutils literal"><span class="pre">TypeEngine.bind_expression()</span></code></a>&#x548C;<a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine.column_expression" title="sqlalchemy.types.TypeEngine.column_expression"><code class="xref py py-meth docutils literal"><span class="pre">TypeEngine.column_expression()</span></code></a>&#x65B9;&#x6CD5;&#x3002;</span></p></div><p><span class="yiyi-st" id="yiyi-293">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;&#xFF1A;</span></p><p><span class="yiyi-st" id="yiyi-294"><a class="reference internal" href="orm_examples.html#examples-postgis"><span>PostGIS Integration</span></a></span></p></div><div class="section" id="redefining-and-creating-new-operators"><h2><span class="yiyi-st" id="yiyi-295">&#x91CD;&#x65B0;&#x5B9A;&#x4E49;&#x548C;&#x521B;&#x5EFA;&#x65B0;&#x64CD;&#x4F5C;&#x7B26;<a class="headerlink" href="#redefining-and-creating-new-operators" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-296">SQLAlchemy Core&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x7EC4;&#x53EF;&#x7528;&#x4E8E;&#x6240;&#x6709;&#x5217;&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#x8FD0;&#x7B97;&#x7B26;&#x3002;</span><span class="yiyi-st" id="yiyi-297">Some of these operations have the effect of overloading Python&#x2019;s built in operators; examples of such operators include <a class="reference internal" href="sqlelement.html#sqlalchemy.sql.operators.ColumnOperators.__eq__" title="sqlalchemy.sql.operators.ColumnOperators.__eq__"><code class="xref py py-meth docutils literal"><span class="pre">ColumnOperators.__eq__()</span></code></a> (<code class="docutils literal"><span class="pre">table.c.somecolumn</span> <span class="pre">==</span> <span class="pre">&apos;foo&apos;</span></code>), <a class="reference internal" href="sqlelement.html#sqlalchemy.sql.operators.ColumnOperators.__invert__" title="sqlalchemy.sql.operators.ColumnOperators.__invert__"><code class="xref py py-meth docutils literal"><span class="pre">ColumnOperators.__invert__()</span></code></a> (<code class="docutils literal"><span class="pre">~table.c.flag</span></code>), and <a class="reference internal" href="sqlelement.html#sqlalchemy.sql.operators.ColumnOperators.__add__" title="sqlalchemy.sql.operators.ColumnOperators.__add__"><code class="xref py py-meth docutils literal"><span class="pre">ColumnOperators.__add__()</span></code></a> (<code class="docutils literal"><span class="pre">table.c.x</span> <span class="pre">+</span> <span class="pre">table.c.y</span></code>). </span><span class="yiyi-st" id="yiyi-298">Other operators are exposed as explicit methods on column expressions, such as <a class="reference internal" href="sqlelement.html#sqlalchemy.sql.operators.ColumnOperators.in_" title="sqlalchemy.sql.operators.ColumnOperators.in_"><code class="xref py py-meth docutils literal"><span class="pre">ColumnOperators.in_()</span></code></a> (<code class="docutils literal"><span class="pre">table.c.value.in_([&apos;x&apos;,</span> <span class="pre">&apos;y&apos;])</span></code>) and <a class="reference internal" href="sqlelement.html#sqlalchemy.sql.operators.ColumnOperators.like" title="sqlalchemy.sql.operators.ColumnOperators.like"><code class="xref py py-meth docutils literal"><span class="pre">ColumnOperators.like()</span></code></a> (<code class="docutils literal"><span class="pre">table.c.value.like(&apos;%ed%&apos;)</span></code>).</span></p><p><span class="yiyi-st" id="yiyi-299">&#x5728;&#x6240;&#x6709;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;Core&#x8868;&#x8FBE;&#x5F0F;&#x7ED3;&#x6784;&#x90FD;&#x4F1A;&#x67E5;&#x8BE2;&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x7C7B;&#x578B;&#xFF0C;&#x4EE5;&#x786E;&#x5B9A;&#x73B0;&#x6709;&#x8FD0;&#x7B97;&#x7B26;&#x7684;&#x884C;&#x4E3A;&#xFF0C;&#x5E76;&#x627E;&#x51FA;&#x4E0D;&#x5C5E;&#x4E8E;&#x5185;&#x7F6E;&#x96C6;&#x5408;&#x7684;&#x5176;&#x4ED6;&#x8FD0;&#x7B97;&#x7B26;&#x3002;</span><span class="yiyi-st" id="yiyi-300">The <a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal"><span class="pre">TypeEngine</span></code></a> base class defines a root &#x201C;comparison&#x201D; implementation <a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine.Comparator" title="sqlalchemy.types.TypeEngine.Comparator"><code class="xref py py-class docutils literal"><span class="pre">TypeEngine.Comparator</span></code></a>, and many specific types provide their own sub-implementations of this class. </span><span class="yiyi-st" id="yiyi-301">&#x7528;&#x6237;&#x5B9A;&#x4E49;&#x7684;<a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine.Comparator" title="sqlalchemy.types.TypeEngine.Comparator"><code class="xref py py-class docutils literal"><span class="pre">TypeEngine.Comparator</span></code></a>&#x5B9E;&#x73B0;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x6784;&#x5EFA;&#x5230;&#x7279;&#x5B9A;&#x7C7B;&#x578B;&#x7684;&#x7B80;&#x5355;&#x5B50;&#x7C7B;&#x4E2D;&#xFF0C;&#x4EE5;&#x8986;&#x76D6;&#x6216;&#x5B9A;&#x4E49;&#x65B0;&#x7684;&#x64CD;&#x4F5C;&#x3002;</span><span class="yiyi-st" id="yiyi-302">&#x4E0B;&#x9762;&#xFF0C;&#x6211;&#x4EEC;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x8986;&#x76D6;<a class="reference internal" href="sqlelement.html#sqlalchemy.sql.operators.ColumnOperators.__add__" title="sqlalchemy.sql.operators.ColumnOperators.__add__"><code class="xref py py-meth docutils literal"><span class="pre">ColumnOperators.__add__()</span></code></a>&#x8FD0;&#x7B97;&#x7B26;&#x7684;<a class="reference internal" href="type_basics.html#sqlalchemy.types.Integer" title="sqlalchemy.types.Integer"><code class="xref py py-class docutils literal"><span class="pre">Integer</span></code></a>&#x5B50;&#x7C7B;&#x3002;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Integer</span>

<span class="k">class</span> <span class="nc">MyInt</span><span class="p">(</span><span class="n">Integer</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">comparator_factory</span><span class="p">(</span><span class="n">Integer</span><span class="o">.</span><span class="n">Comparator</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="p">(</span><span class="s2">&quot;goofy&quot;</span><span class="p">)(</span><span class="n">other</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-303">&#x4E0A;&#x9762;&#x7684;&#x914D;&#x7F6E;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x7C7B;<code class="docutils literal"><span class="pre">MyInt</span></code>&#xFF0C;&#x5B83;&#x5C06;<a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine.comparator_factory" title="sqlalchemy.types.TypeEngine.comparator_factory"><code class="xref py py-attr docutils literal"><span class="pre">TypeEngine.comparator_factory</span></code></a>&#x5C5E;&#x6027;&#x5EFA;&#x7ACB;&#x4E3A;&#x5F15;&#x7528;&#x65B0;&#x7684;&#x7C7B;&#xFF0C;&#x7EE7;&#x627F;<a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine.Comparator" title="sqlalchemy.types.TypeEngine.Comparator"><code class="xref py py-class docutils literal"><span class="pre">TypeEngine.Comparator</span></code></a>&#x7C7B;&#x7684;&#x5B50;&#x7C7B;&#x4E0E;<a class="reference internal" href="type_basics.html#sqlalchemy.types.Integer" title="sqlalchemy.types.Integer"><code class="xref py py-class docutils literal"><span class="pre">Integer</span></code></a>&#x7C7B;&#x578B;&#x76F8;&#x5173;&#x8054;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-304">&#x7528;&#x6CD5;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sometable</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s2">&quot;sometable&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">MyInt</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">sometable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span>
<span class="go">sometable.data goofy :data_1</span></pre></div></div><p><span class="yiyi-st" id="yiyi-305">&#x901A;&#x8FC7;&#x5C06;<a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine.Comparator" title="sqlalchemy.types.TypeEngine.Comparator"><code class="xref py py-class docutils literal"><span class="pre">TypeEngine.Comparator</span></code></a>&#x81EA;&#x8EAB;&#x5B9E;&#x4F8B;&#x5316;&#x4E3A;<code class="docutils literal"><span class="pre">expr</span></code>&#x5C5E;&#x6027;&#xFF0C;&#x901A;&#x8FC7;&#x62E5;&#x6709;&#x7684;SQL&#x8868;&#x8FBE;&#x5F0F;&#x67E5;&#x9605;<a class="reference internal" href="sqlelement.html#sqlalchemy.sql.operators.ColumnOperators.__add__" title="sqlalchemy.sql.operators.ColumnOperators.__add__"><code class="xref py py-meth docutils literal"><span class="pre">ColumnOperators.__add__()</span></code></a>&#x7684;&#x5B9E;&#x73B0;&#x3002;</span><span class="yiyi-st" id="yiyi-306">&#x8868;&#x8FBE;&#x5F0F;&#x7CFB;&#x7EDF;&#x7684;&#x673A;&#x5236;&#x662F;&#x8FD9;&#x6837;&#x7684;&#xFF0C;&#x5373;&#x64CD;&#x4F5C;&#x7EE7;&#x7EED;&#x9012;&#x5F52;&#x76F4;&#x5230;&#x8868;&#x8FBE;&#x5F0F;&#x5BF9;&#x8C61;&#x4EA7;&#x751F;&#x4E00;&#x4E2A;&#x65B0;&#x7684;SQL&#x8868;&#x8FBE;&#x5F0F;&#x7ED3;&#x6784;&#x3002;</span><span class="yiyi-st" id="yiyi-307">Above, we could just as well have said <code class="docutils literal"><span class="pre">self.expr.op(&quot;goofy&quot;)(other)</span></code> instead of <code class="docutils literal"><span class="pre">self.op(&quot;goofy&quot;)(other)</span></code>.</span></p><p><span class="yiyi-st" id="yiyi-308">New methods added to a <a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine.Comparator" title="sqlalchemy.types.TypeEngine.Comparator"><code class="xref py py-class docutils literal"><span class="pre">TypeEngine.Comparator</span></code></a> are exposed on an owning SQL expression using a <code class="docutils literal"><span class="pre">__getattr__</span></code> scheme, which exposes methods added to <a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine.Comparator" title="sqlalchemy.types.TypeEngine.Comparator"><code class="xref py py-class docutils literal"><span class="pre">TypeEngine.Comparator</span></code></a> onto the owning <a class="reference internal" href="sqlelement.html#sqlalchemy.sql.expression.ColumnElement" title="sqlalchemy.sql.expression.ColumnElement"><code class="xref py py-class docutils literal"><span class="pre">ColumnElement</span></code></a>. </span><span class="yiyi-st" id="yiyi-309">&#x4F8B;&#x5982;&#xFF0C;&#x8981;&#x5C06;<code class="docutils literal"><span class="pre">log()</span></code>&#x51FD;&#x6570;&#x6DFB;&#x52A0;&#x5230;&#x6574;&#x6570;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">func</span>

<span class="k">class</span> <span class="nc">MyInt</span><span class="p">(</span><span class="n">Integer</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">comparator_factory</span><span class="p">(</span><span class="n">Integer</span><span class="o">.</span><span class="n">Comparator</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">func</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-310">&#x4F7F;&#x7528;&#x4EE5;&#x4E0A;&#x7C7B;&#x578B;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">sometable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="go">log(:log_1, :log_2)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-311">&#x4E00;&#x5143;&#x64CD;&#x4F5C;&#x4E5F;&#x662F;&#x53EF;&#x80FD;&#x7684;&#x3002;</span><span class="yiyi-st" id="yiyi-312">&#x4F8B;&#x5982;&#xFF0C;&#x8981;&#x6DFB;&#x52A0;Postgresql&#x9636;&#x4E58;&#x8FD0;&#x7B97;&#x7B26;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;<a class="reference internal" href="sqlelement.html#sqlalchemy.sql.expression.UnaryExpression" title="sqlalchemy.sql.expression.UnaryExpression"><code class="xref py py-class docutils literal"><span class="pre">UnaryExpression</span></code></a>&#x7ED3;&#x6784;&#x4E0E;<a class="reference internal" href="sqlelement.html#sqlalchemy.sql.operators.custom_op" title="sqlalchemy.sql.operators.custom_op"><code class="xref py py-class docutils literal"><span class="pre">custom_op</span></code></a>&#x7ED3;&#x5408;&#x8D77;&#x6765;&#x4EE5;&#x4EA7;&#x751F;&#x9636;&#x4E58;&#x8868;&#x8FBE;&#x5F0F;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Integer</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.sql.expression</span> <span class="kn">import</span> <span class="n">UnaryExpression</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.sql</span> <span class="kn">import</span> <span class="n">operators</span>

<span class="k">class</span> <span class="nc">MyInteger</span><span class="p">(</span><span class="n">Integer</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">comparator_factory</span><span class="p">(</span><span class="n">Integer</span><span class="o">.</span><span class="n">Comparator</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">factorial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">UnaryExpression</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="p">,</span>
                        <span class="n">modifier</span><span class="o">=</span><span class="n">operators</span><span class="o">.</span><span class="n">custom_op</span><span class="p">(</span><span class="s2">&quot;!&quot;</span><span class="p">),</span>
                        <span class="n">type_</span><span class="o">=</span><span class="n">MyInteger</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-313">&#x4F7F;&#x7528;&#x4EE5;&#x4E0A;&#x7C7B;&#x578B;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy.sql</span> <span class="kn">import</span> <span class="n">column</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">column</span><span class="p">(</span><span class="s1">&apos;x&apos;</span><span class="p">,</span> <span class="n">MyInteger</span><span class="p">)</span><span class="o">.</span><span class="n">factorial</span><span class="p">())</span>
<span class="go">x !</span></pre></div></div><p><span class="yiyi-st" id="yiyi-314">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;&#xFF1A;</span></p><p><span class="yiyi-st" id="yiyi-315"><a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine.comparator_factory" title="sqlalchemy.types.TypeEngine.comparator_factory"><code class="xref py py-attr docutils literal"><span class="pre">TypeEngine.comparator_factory</span></code></a></span></p><div class="versionadded"><p><span class="yiyi-st" id="yiyi-316"><span class="versionmodified">0.8&#x7248;&#x65B0;&#x589E;&#x529F;&#x80FD;&#xFF1A;</span>&#x589E;&#x5F3A;&#x4E86;&#x8868;&#x8FBE;&#x5F0F;&#x7CFB;&#x7EDF;&#xFF0C;&#x652F;&#x6301;&#x6309;&#x7C7B;&#x578B;&#x7EA7;&#x522B;&#x5B9A;&#x5236;&#x8FD0;&#x7B97;&#x7B26;&#x3002;</span></p></div></div><div class="section" id="creating-new-types"><h2><span class="yiyi-st" id="yiyi-317">&#x521B;&#x5EFA;&#x65B0;&#x7C7B;&#x578B;<a class="headerlink" href="#creating-new-types" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-318">The <a class="reference internal" href="#sqlalchemy.types.UserDefinedType" title="sqlalchemy.types.UserDefinedType"><code class="xref py py-class docutils literal"><span class="pre">UserDefinedType</span></code></a> class is provided as a simple base class for defining entirely new database types. </span><span class="yiyi-st" id="yiyi-319">&#x7528;&#x5B83;&#x6765;&#x8868;&#x793A;SQLAlchemy&#x4E0D;&#x77E5;&#x9053;&#x7684;&#x672C;&#x5730;&#x6570;&#x636E;&#x5E93;&#x7C7B;&#x578B;&#x3002;</span><span class="yiyi-st" id="yiyi-320">&#x5982;&#x679C;&#x53EA;&#x9700;&#x8981;Python&#x7FFB;&#x8BD1;&#x884C;&#x4E3A;&#xFF0C;&#x8BF7;&#x6539;&#x7528;<a class="reference internal" href="#sqlalchemy.types.TypeDecorator" title="sqlalchemy.types.TypeDecorator"><code class="xref py py-class docutils literal"><span class="pre">TypeDecorator</span></code></a>&#x3002;</span></p><dl class="class"><dt id="sqlalchemy.types.UserDefinedType"><span class="yiyi-st" id="yiyi-321"><em class="property">class</em> <code class="descclassname">sqlalchemy.types&#x3002;</code> <code class="descname">UserDefinedType</code> <a class="headerlink" href="#sqlalchemy.types.UserDefinedType" title="Permalink to this definition">&#xB6;</a></span></dt><dd><p><span class="yiyi-st" id="yiyi-322">&#x57FA;&#x7840;&#xFF1A;<a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal"><span class="pre">sqlalchemy.types.TypeEngine</span></code></a></span></p><p><span class="yiyi-st" id="yiyi-323">&#x7528;&#x6237;&#x5B9A;&#x4E49;&#x7C7B;&#x578B;&#x7684;&#x57FA;&#x7840;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-324">&#x8FD9;&#x5E94;&#x8BE5;&#x662F;&#x65B0;&#x7C7B;&#x578B;&#x7684;&#x57FA;&#x7840;&#x3002;</span><span class="yiyi-st" id="yiyi-325">&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x5BF9;&#x4E8E;&#x5927;&#x591A;&#x6570;&#x60C5;&#x51B5;&#xFF0C;<a class="reference internal" href="#sqlalchemy.types.TypeDecorator" title="sqlalchemy.types.TypeDecorator"><code class="xref py py-class docutils literal"><span class="pre">TypeDecorator</span></code></a>&#x53EF;&#x80FD;&#x66F4;&#x5408;&#x9002;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlalchemy.types</span> <span class="kn">as</span> <span class="nn">types</span>

<span class="k">class</span> <span class="nc">MyType</span><span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">UserDefinedType</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">precision</span> <span class="o">=</span> <span class="mi">8</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">precision</span> <span class="o">=</span> <span class="n">precision</span>

    <span class="k">def</span> <span class="nf">get_col_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;MYTYPE(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span>

    <span class="k">def</span> <span class="nf">bind_processor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dialect</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">return</span> <span class="n">process</span>

    <span class="k">def</span> <span class="nf">result_processor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dialect</span><span class="p">,</span> <span class="n">coltype</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">return</span> <span class="n">process</span></pre></div></div><p><span class="yiyi-st" id="yiyi-326">&#x4E00;&#x65E6;&#x8FD9;&#x4E2A;&#x7C7B;&#x578B;&#x88AB;&#x521B;&#x5EFA;&#xFF0C;&#x5B83;&#x5C31;&#x53EF;&#x4EE5;&#x7ACB;&#x5373;&#x4F7F;&#x7528;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&apos;foo&apos;</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;id&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;data&apos;</span><span class="p">,</span> <span class="n">MyType</span><span class="p">(</span><span class="mi">16</span><span class="p">))</span>
    <span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-327">The <code class="docutils literal"><span class="pre">get_col_spec()</span></code> method will in most cases receive a keyword argument <code class="docutils literal"><span class="pre">type_expression</span></code> which refers to the owning expression of the type as being compiled, such as a <a class="reference internal" href="metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a> or <a class="reference internal" href="sqlelement.html#sqlalchemy.sql.expression.cast" title="sqlalchemy.sql.expression.cast"><code class="xref py py-func docutils literal"><span class="pre">cast()</span></code></a> construct. </span><span class="yiyi-st" id="yiyi-328">&#x53EA;&#x6709;&#x5F53;&#x65B9;&#x6CD5;&#x63A5;&#x53D7;&#x5176;&#x53C2;&#x6570;&#x7B7E;&#x540D;&#x4E2D;&#x7684;&#x5173;&#x952E;&#x5B57;&#x53C2;&#x6570;&#xFF08;&#x4F8B;&#x5982;<code class="docutils literal"><span class="pre">**kw</span></code>&#xFF09;&#x65F6;&#x624D;&#x4F1A;&#x53D1;&#x9001;&#x6B64;&#x5173;&#x952E;&#x5B57;&#xFF1B;&#x5185;&#x7701;&#x662F;&#x7528;&#x6765;&#x68C0;&#x67E5;&#x8FD9;&#x4E2A;&#x4EE5;&#x652F;&#x6301;&#x8FD9;&#x4E2A;&#x529F;&#x80FD;&#x7684;&#x9057;&#x7559;&#x5F62;&#x5F0F;&#x3002;</span></p><div class="versionadded"><p><span class="yiyi-st" id="yiyi-329"><span class="versionmodified">&#x7248;&#x672C;1.0.0&#x65B0;&#x589E;&#xFF1A;</span>&#x62E5;&#x6709;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#x901A;&#x8FC7;&#x5173;&#x952E;&#x5B57;&#x53C2;&#x6570;<code class="docutils literal"><span class="pre">type_expression</span></code>&#x4F20;&#x9012;&#x7ED9;<code class="docutils literal"><span class="pre">get_col_spec()</span></code>&#x65B9;&#x6CD5;&#xFF0C;&#x5982;&#x679C;&#x5B83;&#x63A5;&#x6536;&#x5230;<code class="docutils literal"><span class="pre">**kw</span></code>&#x7B7E;&#x540D;&#x3002;</span></p></div><dl class="method"><dt id="sqlalchemy.types.UserDefinedType.coerce_compared_value"><span class="yiyi-st" id="yiyi-330"><code class="descname">coerce_compared_value</code> <span class="sig-paren">&#xFF08;</span> <em>op</em>&#xFF0C;<em>&#x503C;</em> <span class="sig-paren">&#xFF09;</span> <a class="headerlink" href="#sqlalchemy.types.UserDefinedType.coerce_compared_value" title="Permalink to this definition"></a></span></dt><dd><p><span class="yiyi-st" id="yiyi-331">&#x4E3A;&#x8868;&#x8FBE;&#x5F0F;&#x4E2D;&#x7684;&apos;&#x5F3A;&#x5236;&apos;Python&#x503C;&#x5EFA;&#x8BAE;&#x7C7B;&#x578B;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-332"><a class="reference internal" href="#sqlalchemy.types.UserDefinedType" title="sqlalchemy.types.UserDefinedType"><code class="xref py py-class docutils literal"><span class="pre">UserDefinedType</span></code></a>&#x7684;&#x9ED8;&#x8BA4;&#x884C;&#x4E3A;&#x4E0E;<a class="reference internal" href="#sqlalchemy.types.TypeDecorator" title="sqlalchemy.types.TypeDecorator"><code class="xref py py-class docutils literal"><span class="pre">TypeDecorator</span></code></a>&#x7684;&#x9ED8;&#x8BA4;&#x884C;&#x4E3A;&#x76F8;&#x540C;&#x3002;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#x5B83;&#x4F1A;&#x8FD4;&#x56DE;<code class="docutils literal"><span class="pre">self</span></code>&#xFF0C;&#x5047;&#x8BBE;&#x6BD4;&#x8F83;&#x503C;&#x5E94;&#x8BE5;&#x5F3A;&#x5236;&#x4E3A;&#x4E0E;&#x6B64;&#x7C7B;&#x578B;&#x76F8;&#x540C;&#x7684;&#x7C7B;&#x578B;&#x3002;</span><span class="yiyi-st" id="yiyi-333">&#x6709;&#x5173;&#x66F4;&#x591A;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a class="reference internal" href="#sqlalchemy.types.TypeDecorator.coerce_compared_value" title="sqlalchemy.types.TypeDecorator.coerce_compared_value"><code class="xref py py-meth docutils literal"><span class="pre">TypeDecorator.coerce_compared_value()</span></code></a>&#x3002;</span></p><div class="versionchanged"><p><span class="yiyi-st" id="yiyi-334"><span class="versionmodified">&#x5728;&#x7248;&#x672C;0.8&#x4E2D;&#x6539;&#x53D8;&#xFF1A;</span> <a class="reference internal" href="#sqlalchemy.types.UserDefinedType.coerce_compared_value" title="sqlalchemy.types.UserDefinedType.coerce_compared_value"><code class="xref py py-meth docutils literal"><span class="pre">UserDefinedType.coerce_compared_value()</span></code></a>&#x73B0;&#x5728;&#x9ED8;&#x8BA4;&#x8FD4;&#x56DE;<code class="docutils literal"><span class="pre">self</span></code>&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x843D;&#x5728;<a class="reference internal" href="type_api.html#sqlalchemy.types.TypeEngine.coerce_compared_value" title="sqlalchemy.types.TypeEngine.coerce_compared_value"><code class="xref py py-meth docutils literal"><span class="pre">TypeEngine.coerce_compared_value()</span></code></a></span></p></div></dd></dl></dd></dl></div>