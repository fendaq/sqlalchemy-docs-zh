<h1><span class="yiyi-st" id="yiyi-55">&#x5176;&#x4ED6;&#x6301;&#x4E45;&#x6027;&#x6280;&#x672F;<a class="headerlink" href="#additional-persistence-techniques" title="Permalink to this headline">&#xB6;</a></span></h1><div class="section" id="embedding-sql-insert-update-expressions-into-a-flush"><h2><span class="yiyi-st" id="yiyi-56">&#x5C06;SQL&#x63D2;&#x5165;/&#x66F4;&#x65B0;&#x8868;&#x8FBE;&#x5F0F;&#x5D4C;&#x5165;&#x5230;<a class="headerlink" href="#embedding-sql-insert-update-expressions-into-a-flush" title="Permalink to this headline">&#xB6;</a>&#x4E2D;</span></h2><p><span class="yiyi-st" id="yiyi-57">&#x6B64;&#x529F;&#x80FD;&#x5141;&#x8BB8;&#x5C06;&#x6570;&#x636E;&#x5E93;&#x5217;&#x7684;&#x503C;&#x8BBE;&#x7F6E;&#x4E3A;SQL&#x8868;&#x8FBE;&#x5F0F;&#x800C;&#x4E0D;&#x662F;&#x6587;&#x5B57;&#x503C;&#x3002;</span><span class="yiyi-st" id="yiyi-58">&#x5B83;&#x5BF9;&#x539F;&#x5B50;&#x66F4;&#x65B0;&#xFF0C;&#x8C03;&#x7528;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#x7B49;&#x7B49;&#x7279;&#x522B;&#x6709;&#x7528;&#x3002;</span><span class="yiyi-st" id="yiyi-59">&#x4F60;&#x6240;&#x505A;&#x7684;&#x5C31;&#x662F;&#x5C06;&#x4E00;&#x4E2A;&#x8868;&#x8FBE;&#x5F0F;&#x5206;&#x914D;&#x7ED9;&#x4E00;&#x4E2A;&#x5C5E;&#x6027;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SomeClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">pass</span>
<span class="n">mapper</span><span class="p">(</span><span class="n">SomeClass</span><span class="p">,</span> <span class="n">some_table</span><span class="p">)</span>

<span class="n">someobject</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">SomeClass</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># set &apos;value&apos; attribute to a SQL expression adding one</span>
<span class="n">someobject</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">some_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="mi">1</span>

<span class="c1"># issues &quot;UPDATE some_table SET value=value+1&quot;</span>
<span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></pre></div></div><p><span class="yiyi-st" id="yiyi-60">&#x8FD9;&#x79CD;&#x6280;&#x672F;&#x9002;&#x7528;&#x4E8E;INSERT&#x548C;UPDATE&#x8BED;&#x53E5;&#x3002;</span><span class="yiyi-st" id="yiyi-61">&#x5728;flush / commit&#x64CD;&#x4F5C;&#x4E4B;&#x540E;&#xFF0C;&#x4E0A;&#x9762;<code class="docutils literal"><span class="pre">someobject</span></code>&#x4E2D;&#x7684;<code class="docutils literal"><span class="pre">value</span></code>&#x5C5E;&#x6027;&#x5DF2;&#x8FC7;&#x671F;&#xFF0C;&#x4EE5;&#x4FBF;&#x4E0B;&#x6B21;&#x8BBF;&#x95EE;&#x65F6;&#xFF0C;&#x65B0;&#x751F;&#x6210;&#x7684;&#x503C;&#x5C06;&#x4ECE;&#x6570;&#x636E;&#x5E93;&#x52A0;&#x8F7D;&#x3002;</span></p></div><div class="section" id="using-sql-expressions-with-sessions"><h2><span class="yiyi-st" id="yiyi-62">&#x5728;&#x4F1A;&#x8BDD;&#x4E2D;&#x4F7F;&#x7528;SQL&#x8868;&#x8FBE;&#x5F0F;<a class="headerlink" href="#using-sql-expressions-with-sessions" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-63">SQL&#x8868;&#x8FBE;&#x5F0F;&#x548C;&#x5B57;&#x7B26;&#x4E32;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E8B;&#x52A1;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x7684;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x6267;&#x884C;&#x3002;</span><span class="yiyi-st" id="yiyi-64">This is most easily accomplished using the <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.execute" title="sqlalchemy.orm.session.Session.execute"><code class="xref py py-meth docutils literal"><span class="pre">execute()</span></code></a> method, which returns a <a class="reference internal" href="core_connections.html#sqlalchemy.engine.ResultProxy" title="sqlalchemy.engine.ResultProxy"><code class="xref py py-class docutils literal"><span class="pre">ResultProxy</span></code></a> in the same manner as an <a class="reference internal" href="core_connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal"><span class="pre">Engine</span></code></a> or <a class="reference internal" href="core_connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal"><span class="pre">Connection</span></code></a>:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">Session</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>

<span class="c1"># execute a string statement</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;select * from table where id=:id&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&apos;id&apos;</span><span class="p">:</span><span class="mi">7</span><span class="p">})</span>

<span class="c1"># execute a SQL expression construct</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">select</span><span class="p">([</span><span class="n">mytable</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mytable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="mi">7</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-65">&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.connection" title="sqlalchemy.orm.session.Session.connection"><code class="xref py py-meth docutils literal"><span class="pre">connection()</span></code></a>&#x65B9;&#x6CD5;&#x8BBF;&#x95EE;&#x7531;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x4FDD;&#x5B58;&#x7684;&#x5F53;&#x524D;<a class="reference internal" href="core_connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal"><span class="pre">Connection</span></code></a></span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">connection</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">connection</span><span class="p">()</span></pre></div></div><p><span class="yiyi-st" id="yiyi-66">&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x5904;&#x7406;&#x4E86;&#x7ED1;&#x5B9A;&#x5230;&#x5355;&#x4E2A;<a class="reference internal" href="core_connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal"><span class="pre">Engine</span></code></a>&#x6216;<a class="reference internal" href="core_connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal"><span class="pre">Connection</span></code></a>&#x7684;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x3002;</span><span class="yiyi-st" id="yiyi-67">To execute statements using a <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a> which is bound either to multiple engines, or none at all (i.e. relies upon bound metadata), both <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.execute" title="sqlalchemy.orm.session.Session.execute"><code class="xref py py-meth docutils literal"><span class="pre">execute()</span></code></a> and <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.connection" title="sqlalchemy.orm.session.Session.connection"><code class="xref py py-meth docutils literal"><span class="pre">connection()</span></code></a> accept a <code class="docutils literal"><span class="pre">mapper</span></code> keyword argument, which is passed a mapped class or <a class="reference internal" href="mapping_api.html#sqlalchemy.orm.mapper.Mapper" title="sqlalchemy.orm.mapper.Mapper"><code class="xref py py-class docutils literal"><span class="pre">Mapper</span></code></a> instance, which is used to locate the proper context for the desired engine:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">Session</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">()</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>

<span class="c1"># need to specify mapper or class when executing</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;select * from table where id=:id&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&apos;id&apos;</span><span class="p">:</span><span class="mi">7</span><span class="p">},</span> <span class="n">mapper</span><span class="o">=</span><span class="n">MyMappedClass</span><span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">select</span><span class="p">([</span><span class="n">mytable</span><span class="p">],</span> <span class="n">mytable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="mi">7</span><span class="p">),</span> <span class="n">mapper</span><span class="o">=</span><span class="n">MyMappedClass</span><span class="p">)</span>

<span class="n">connection</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">connection</span><span class="p">(</span><span class="n">MyMappedClass</span><span class="p">)</span></pre></div></div></div><div class="section" id="forcing-null-on-a-column-with-a-default"><h2><span class="yiyi-st" id="yiyi-68">&#x5728;&#x5177;&#x6709;&#x9ED8;&#x8BA4;<a class="headerlink" href="#forcing-null-on-a-column-with-a-default" title="Permalink to this headline">&#xB6;</a>&#x7684;&#x5217;&#x4E0A;&#x5F3A;&#x5236;NULL</span></h2><p><span class="yiyi-st" id="yiyi-69">ORM&#x5C06;&#x4EFB;&#x4F55;&#x4ECE;&#x672A;&#x5728;&#x5BF9;&#x8C61;&#x4E0A;&#x8BBE;&#x7F6E;&#x7684;&#x5C5E;&#x6027;&#x89C6;&#x4E3A;&#x201C;&#x9ED8;&#x8BA4;&#x201D;&#x60C5;&#x51B5;&#xFF1B;&#x8BE5;&#x5C5E;&#x6027;&#x5C06;&#x4ECE;INSERT&#x8BED;&#x53E5;&#x4E2D;&#x7701;&#x7565;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyObject</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;my_table&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">obj</span> <span class="o">=</span> <span class="n">MyObject</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>  <span class="c1"># INSERT with the &apos;data&apos; column omitted; the database</span>
                  <span class="c1"># itself will persist this as the NULL value</span></pre></div></div><p><span class="yiyi-st" id="yiyi-70">Omitting a column from the INSERT means that the column will have the NULL value set, <em>unless</em> the column has a default set up, in which case the default value will be persisted. </span><span class="yiyi-st" id="yiyi-71">&#x8FD9;&#x65E2;&#x9002;&#x7528;&#x4E8E;&#x4ECE;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x9ED8;&#x8BA4;&#x7684;&#x7EAF;SQL&#x900F;&#x89C6;&#x89D2;&#x5EA6;&#xFF0C;&#x4E5F;&#x9002;&#x7528;&#x4E8E;SQLAlchemy&#x63D2;&#x5165;&#x884C;&#x4E3A;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x9ED8;&#x8BA4;&#x884C;&#x4E3A;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyObject</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;my_table&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">server_default</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">)</span>

<span class="n">obj</span> <span class="o">=</span> <span class="n">MyObject</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>  <span class="c1"># INSERT with the &apos;data&apos; column omitted; the database</span>
                  <span class="c1"># itself will persist this as the value &apos;default&apos;</span></pre></div></div><p><span class="yiyi-st" id="yiyi-72">&#x4F46;&#x662F;&#xFF0C;&#x5728;ORM&#x4E2D;&#xFF0C;&#x5373;&#x4F7F;&#x5C06;Python&#x503C;<code class="docutils literal"><span class="pre">None</span></code>&#x663E;&#x5F0F;&#x6307;&#x5B9A;&#x7ED9;&#x5BF9;&#x8C61;&#xFF0C;&#x4E5F;&#x4F1A;&#x5C06;&#x8BE5;&#x503C;&#x89C6;&#x4E3A;<strong>&#x76F8;&#x540C;</strong>&#xFF0C;&#x5C31;&#x597D;&#x50CF;&#x8BE5;&#x503C;&#x4ECE;&#x672A;&#x5206;&#x914D;&#x8FC7;&#x4E00;&#x6837;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyObject</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;my_table&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">server_default</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">)</span>

<span class="n">obj</span> <span class="o">=</span> <span class="n">MyObject</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>  <span class="c1"># INSERT with the &apos;data&apos; column explicitly set to None;</span>
                  <span class="c1"># the ORM still omits it from the statement and the</span>
                  <span class="c1"># database will still persist this as the value &apos;default&apos;</span></pre></div></div><p><span class="yiyi-st" id="yiyi-73">&#x5373;&#x4F7F;&#x4F20;&#x9012;&#x4E86;<code class="docutils literal"><span class="pre">None</span></code>&#xFF0C;&#x4E0A;&#x9762;&#x7684;&#x64CD;&#x4F5C;&#x4ECD;&#x4F1A;&#x4FDD;&#x7559;&#x5728;<code class="docutils literal"><span class="pre">data</span></code>&#x5217;&#x7684;<code class="docutils literal"><span class="pre">&quot;default&quot;</span></code>&#x7684;&#x670D;&#x52A1;&#x5668;&#x9ED8;&#x8BA4;&#x503C;&#x4E2D;&#xFF0C;&#x800C;&#x4E0D;&#x662F;SQL NULL&#x3002;&#x8FD9;&#x662F;ORM&#x7684;&#x4E00;&#x4E2A;&#x957F;&#x671F;&#x5B58;&#x5728;&#x7684;&#x884C;&#x4E3A;&#xFF0C;&#x8BB8;&#x591A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x90FD;&#x5C06;&#x5176;&#x4F5C;&#x4E3A;&#x5047;&#x8BBE;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-74">&#x90A3;&#x4E48;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x60F3;&#x5B9E;&#x9645;&#x4E0A;&#x5C06;NULL&#x653E;&#x5165;&#x6B64;&#x5217;&#xFF0C;&#x5373;&#x4F7F;&#x8BE5;&#x5217;&#x5177;&#x6709;&#x9ED8;&#x8BA4;&#x503C;&#xFF0C;&#x8BE5;&#x600E;&#x4E48;&#x529E;&#x5462;&#xFF1F;</span><span class="yiyi-st" id="yiyi-75">&#x6709;&#x4E24;&#x79CD;&#x65B9;&#x6CD5;&#x3002;</span><span class="yiyi-st" id="yiyi-76">&#x4E00;&#x4E2A;&#x662F;&#x5728;&#x6BCF;&#x4E2A;&#x5B9E;&#x4F8B;&#x7EA7;&#x522B;&#x4E0A;&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.null" title="sqlalchemy.sql.expression.null"><code class="xref py py-obj docutils literal"><span class="pre">null</span></code></a> SQL&#x7ED3;&#x6784;&#x5206;&#x914D;&#x5C5E;&#x6027;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">null</span>

<span class="n">obj</span> <span class="o">=</span> <span class="n">MyObject</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">null</span><span class="p">())</span>
<span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>  <span class="c1"># INSERT with the &apos;data&apos; column explicitly set as null();</span>
                  <span class="c1"># the ORM uses this directly, bypassing all client-</span>
                  <span class="c1"># and server-side defaults, and the database will</span>
                  <span class="c1"># persist this as the NULL value</span></pre></div></div><p><span class="yiyi-st" id="yiyi-77"><a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.null" title="sqlalchemy.sql.expression.null"><code class="xref py py-obj docutils literal"><span class="pre">null</span></code></a> SQL&#x6784;&#x9020;&#x59CB;&#x7EC8;&#x8F6C;&#x6362;&#x4E3A;&#x76F4;&#x63A5;&#x5B58;&#x5728;&#x4E8E;&#x76EE;&#x6807;INSERT&#x8BED;&#x53E5;&#x4E2D;&#x7684;SQL NULL&#x503C;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-78">If we&#x2019;d like to be able to use the Python value <code class="docutils literal"><span class="pre">None</span></code> and have this also be persisted as NULL despite the presence of column defaults, we can configure this for the ORM using a Core-level modifier <a class="reference internal" href="core_type_api.html#sqlalchemy.types.TypeEngine.evaluates_none" title="sqlalchemy.types.TypeEngine.evaluates_none"><code class="xref py py-meth docutils literal"><span class="pre">TypeEngine.evaluates_none()</span></code></a>, which indicates a type where the ORM should treat the value <code class="docutils literal"><span class="pre">None</span></code> the same as any other value and pass it through, rather than omitting it as a &#x201C;missing&#x201D; value:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyObject</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;my_table&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span>
      <span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="o">.</span><span class="n">evaluates_none</span><span class="p">(),</span>  <span class="c1"># indicate that None should always be passed</span>
      <span class="n">nullable</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">server_default</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">)</span>

<span class="n">obj</span> <span class="o">=</span> <span class="n">MyObject</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>  <span class="c1"># INSERT with the &apos;data&apos; column explicitly set to None;</span>
                  <span class="c1"># the ORM uses this directly, bypassing all client-</span>
                  <span class="c1"># and server-side defaults, and the database will</span>
                  <span class="c1"># persist this as the NULL value</span></pre></div></div><div class="topic"><p class="topic-title first"><span class="yiyi-st" id="yiyi-79">&#x8BC4;&#x4F30;&#x65E0;</span></p><p><span class="yiyi-st" id="yiyi-80"><a class="reference internal" href="core_type_api.html#sqlalchemy.types.TypeEngine.evaluates_none" title="sqlalchemy.types.TypeEngine.evaluates_none"><code class="xref py py-meth docutils literal"><span class="pre">TypeEngine.evaluates_none()</span></code></a>&#x4FEE;&#x9970;&#x7B26;&#x4E3B;&#x8981;&#x7528;&#x4E8E;&#x6307;&#x793A;Python&#x503C;&#x201C;&#x65E0;&#x201D;&#x663E;&#x7740;&#x7684;&#x7C7B;&#x578B;&#xFF0C;&#x4E3B;&#x8981;&#x793A;&#x4F8B;&#x662F;&#x53EF;&#x80FD;&#x8981;&#x4FDD;&#x7559;JSON&#x7684;JSON&#x7C7B;&#x578B;<code class="docutils literal"><span class="pre">null</span></code></span><span class="yiyi-st" id="yiyi-81">&#x6211;&#x4EEC;&#x5728;&#x8FD9;&#x91CC;&#x7565;&#x5FAE;&#x91CD;&#x65B0;&#x8C03;&#x6574;&#x5B83;&#xFF0C;&#x4EE5;&#x4FBF;&#x5411;ORM&#x53D1;&#x51FA;&#x4FE1;&#x53F7;&#xFF0C;&#x5373;&#x4F7F;&#x6CA1;&#x6709;&#x4E3A;&#x5176;&#x5206;&#x914D;&#x7279;&#x6B8A;&#x7684;&#x7C7B;&#x578B;&#x7EA7;&#x522B;&#x7684;&#x884C;&#x4E3A;&#xFF0C;&#x6211;&#x4EEC;&#x4ECD;&#x7136;&#x5E0C;&#x671B;&#x5C06;<code class="docutils literal"><span class="pre">None</span></code>&#x4F20;&#x9012;&#x5230;&#x7C7B;&#x578B;&#x4E2D;&#x3002;</span></p></div><div class="versionadded"><p><span class="yiyi-st" id="yiyi-82"><span class="versionmodified">&#x7248;&#x672C;1.1&#x4E2D;&#x7684;&#x65B0;&#x589E;&#x529F;&#x80FD;&#xFF1A;</span>&#x6DFB;&#x52A0;&#x4E86;<a class="reference internal" href="core_type_api.html#sqlalchemy.types.TypeEngine.evaluates_none" title="sqlalchemy.types.TypeEngine.evaluates_none"><code class="xref py py-meth docutils literal"><span class="pre">TypeEngine.evaluates_none()</span></code></a>&#x65B9;&#x6CD5;&#xFF0C;&#x4EE5;&#x8868;&#x660E;&#x5E94;&#x5C06;&#x201C;&#x65E0;&#x201D;&#x503C;&#x89C6;&#x4E3A;&#x91CD;&#x8981;&#x3002;</span></p></div></div><div class="section" id="partitioning-strategies"><h2><span class="yiyi-st" id="yiyi-83">&#x5206;&#x533A;&#x7B56;&#x7565;<a class="headerlink" href="#partitioning-strategies" title="Permalink to this headline">&#xB6;</a></span></h2><div class="section" id="simple-vertical-partitioning"><h3><span class="yiyi-st" id="yiyi-84">&#x7B80;&#x5355;&#x5782;&#x76F4;&#x5206;&#x533A;<a class="headerlink" href="#simple-vertical-partitioning" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-85">&#x5782;&#x76F4;&#x5206;&#x533A;&#x5728;&#x591A;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x653E;&#x7F6E;&#x4E0D;&#x540C;&#x79CD;&#x7C7B;&#x7684;&#x5BF9;&#x8C61;&#x6216;&#x4E0D;&#x540C;&#x7684;&#x8868;&#x683C;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">engine1</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&apos;postgresql://db1&apos;</span><span class="p">)</span>
<span class="n">engine2</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&apos;postgresql://db2&apos;</span><span class="p">)</span>

<span class="n">Session</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">twophase</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># bind User operations to engine 1, Account operations to engine 2</span>
<span class="n">Session</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">binds</span><span class="o">=</span><span class="p">{</span><span class="n">User</span><span class="p">:</span><span class="n">engine1</span><span class="p">,</span> <span class="n">Account</span><span class="p">:</span><span class="n">engine2</span><span class="p">})</span>

<span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span></pre></div></div><p><span class="yiyi-st" id="yiyi-86">&#x4EE5;&#x4E0A;&#xFF0C;&#x9488;&#x5BF9;&#x4EFB;&#x4F55;&#x4E00;&#x7C7B;&#x7684;&#x64CD;&#x4F5C;&#x90FD;&#x4F1A;&#x4F7F;&#x7528;&#x94FE;&#x63A5;&#x5230;&#x8BE5;&#x7C7B;&#x7684;<a class="reference internal" href="core_connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal"><span class="pre">Engine</span></code></a>&#x3002;</span><span class="yiyi-st" id="yiyi-87">&#x5728;&#x5237;&#x65B0;&#x64CD;&#x4F5C;&#x540E;&#xFF0C;&#x5C06;&#x6267;&#x884C;&#x7C7B;&#x4F3C;&#x7684;&#x89C4;&#x5219;&#x4EE5;&#x786E;&#x4FDD;&#x5C06;&#x6BCF;&#x4E2A;&#x7C7B;&#x5199;&#x5165;&#x6B63;&#x786E;&#x7684;&#x6570;&#x636E;&#x5E93;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-88">&#x5982;&#x679C;&#x5E95;&#x5C42;&#x540E;&#x7AEF;&#x652F;&#x6301;&#x5B83;&#xFF0C;&#x5219;&#x591A;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#x4E4B;&#x95F4;&#x7684;&#x4E8B;&#x52A1;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E24;&#x9636;&#x6BB5;&#x63D0;&#x4EA4;&#x8FDB;&#x884C;&#x534F;&#x8C03;&#x3002;</span><span class="yiyi-st" id="yiyi-89">&#x4E3E;&#x4F8B;&#x6765;&#x8BF4;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a class="reference internal" href="session_transaction.html#session-twophase"><span>Enabling Two-Phase Commit</span></a>&#x3002;</span></p></div><div class="section" id="custom-vertical-partitioning"><h3><span class="yiyi-st" id="yiyi-90">&#x81EA;&#x5B9A;&#x4E49;&#x5782;&#x76F4;&#x5206;&#x533A;<a class="headerlink" href="#custom-vertical-partitioning" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-91">&#x901A;&#x8FC7;&#x8986;&#x76D6;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.get_bind" title="sqlalchemy.orm.session.Session.get_bind"><code class="xref py py-meth docutils literal"><span class="pre">Session.get_bind()</span></code></a>&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x6784;&#x5EFA;&#x66F4;&#x5168;&#x9762;&#x7684;&#x57FA;&#x4E8E;&#x89C4;&#x5219;&#x7684;&#x7C7B;&#x7EA7;&#x522B;&#x5206;&#x533A;&#x3002;</span><span class="yiyi-st" id="yiyi-92">&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x4E3E;&#x4F8B;&#x8BF4;&#x660E;&#x4E00;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49;&#x7684;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#xFF0C;&#x5B83;&#x63D0;&#x4F9B;&#x4E86;&#x4EE5;&#x4E0B;&#x89C4;&#x5219;&#xFF1A;</span></p><ol class="arabic simple"><li><span class="yiyi-st" id="yiyi-93">&#x5237;&#x65B0;&#x64CD;&#x4F5C;&#x4EA4;&#x4ED8;&#x7ED9;&#x540D;&#x4E3A;<code class="docutils literal"><span class="pre">master</span></code>&#x7684;&#x5F15;&#x64CE;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-94">&#x5BF9;<code class="docutils literal"><span class="pre">MyOtherClass</span></code>&#x5B50;&#x7C7B;&#x7684;&#x5BF9;&#x8C61;&#x7684;&#x64CD;&#x4F5C;&#x90FD;&#x53D1;&#x751F;&#x5728;<code class="docutils literal"><span class="pre">other</span></code>&#x5F15;&#x64CE;&#x4E0A;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-95">Read operations for all other classes occur on a random choice of the <code class="docutils literal"><span class="pre">slave1</span></code> or <code class="docutils literal"><span class="pre">slave2</span></code> database.</span></li></ol><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">engines</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&apos;master&apos;</span><span class="p">:</span><span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;sqlite:///master.db&quot;</span><span class="p">),</span>
    <span class="s1">&apos;other&apos;</span><span class="p">:</span><span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;sqlite:///other.db&quot;</span><span class="p">),</span>
    <span class="s1">&apos;slave1&apos;</span><span class="p">:</span><span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;sqlite:///slave1.db&quot;</span><span class="p">),</span>
    <span class="s1">&apos;slave2&apos;</span><span class="p">:</span><span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;sqlite:///slave2.db&quot;</span><span class="p">),</span>
<span class="p">}</span>

<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">Session</span><span class="p">,</span> <span class="n">sessionmaker</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="k">class</span> <span class="nc">RoutingSession</span><span class="p">(</span><span class="n">Session</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapper</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">clause</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">mapper</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">mapper</span><span class="o">.</span><span class="n">class_</span><span class="p">,</span> <span class="n">MyOtherClass</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">engines</span><span class="p">[</span><span class="s1">&apos;other&apos;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flushing</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">engines</span><span class="p">[</span><span class="s1">&apos;master&apos;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">engines</span><span class="p">[</span>
                <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&apos;slave1&apos;</span><span class="p">,</span><span class="s1">&apos;slave2&apos;</span><span class="p">])</span>
            <span class="p">]</span></pre></div></div><p><span class="yiyi-st" id="yiyi-96">&#x4E0A;&#x9762;&#x7684;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x7C7B;&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">class_</span></code>&#x53C2;&#x6570;&#x63D2;&#x5165;&#x5230;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.sessionmaker" title="sqlalchemy.orm.session.sessionmaker"><code class="xref py py-class docutils literal"><span class="pre">sessionmaker</span></code></a>&#x4E2D;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">Session</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">class_</span><span class="o">=</span><span class="n">RoutingSession</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-97">&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x4E0E;&#x591A;&#x4E2A;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.MetaData" title="sqlalchemy.schema.MetaData"><code class="xref py py-class docutils literal"><span class="pre">MetaData</span></code></a>&#x5BF9;&#x8C61;&#x7ED3;&#x5408;&#x4F7F;&#x7528;&#xFF0C;&#x4F8B;&#x5982;&#x4F7F;&#x7528;<a class="reference internal" href="extensions_declarative_api.html#declarative-abstract"><span>__abstract__</span></a>&#x4E2D;&#x63CF;&#x8FF0;&#x7684;&#x58F0;&#x660E;&#x6027;<code class="docutils literal"><span class="pre">__abstract__</span></code>&#x5173;&#x952E;&#x5B57;&#x7684;&#x65B9;&#x6CD5;&#x3002;</span></p></div><div class="section" id="horizontal-partitioning"><h3><span class="yiyi-st" id="yiyi-98">&#x6C34;&#x5E73;&#x5206;&#x533A;<a class="headerlink" href="#horizontal-partitioning" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-99">&#x6C34;&#x5E73;&#x5206;&#x533A;&#x8DE8;&#x591A;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#x5206;&#x5272;&#x5355;&#x4E2A;&#x8868;&#xFF08;&#x6216;&#x4E00;&#x7EC4;&#x8868;&#xFF09;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-100">&#x8BF7;&#x53C2;&#x9605;&#x201C;&#x5206;&#x7247;&#x201D;&#x793A;&#x4F8B;&#xFF1A;<a class="reference internal" href="examples.html#examples-sharding"><span>Horizontal Sharding</span></a>&#x3002;</span></p></div></div><div class="section" id="bulk-operations"><h2><span class="yiyi-st" id="yiyi-101">&#x6279;&#x91CF;&#x64CD;&#x4F5C;<a class="headerlink" href="#bulk-operations" title="Permalink to this headline">&#xB6;</a></span></h2><div class="admonition note"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-102">&#x6CE8;&#x610F;</span></p><p class="last"><span class="yiyi-st" id="yiyi-103">&#x6279;&#x91CF;&#x64CD;&#x4F5C;&#x6A21;&#x5F0F;&#x662F;&#x5728;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x5BF9;&#x8C61;&#x4E0A;&#x63D0;&#x4F9B;&#x7684;&#x4E00;&#x7CFB;&#x5217;&#x65B0;&#x64CD;&#x4F5C;&#xFF0C;&#x7528;&#x4E8E;&#x8C03;&#x7528;INSERT&#x548C;UPDATE&#x8BED;&#x53E5;&#xFF0C;&#x5927;&#x5927;&#x51CF;&#x5C11;&#x4E86;Python&#x7684;&#x5F00;&#x9500;&#xFF0C;&#x4EE3;&#x4EF7;&#x662F;&#x529F;&#x80FD;&#x5C11;&#xFF0C;&#x81EA;&#x52A8;&#x5316;&#x548C;&#x9519;&#x8BEF;&#x68C0;&#x67E5;&#x3002;</span><span class="yiyi-st" id="yiyi-104">&#x4ECE;SQLAlchemy 1.0&#x5F00;&#x59CB;&#xFF0C;&#x8FD9;&#x4E9B;&#x529F;&#x80FD;&#x5E94;&#x8BE5;&#x88AB;&#x89C6;&#x4E3A;&#x201C;&#x6D4B;&#x8BD5;&#x7248;&#x201D;&#xFF0C;&#x53E6;&#x5916;&#x8FD8;&#x9002;&#x7528;&#x4E8E;&#x9AD8;&#x7EA7;&#x7528;&#x6237;&#x3002;</span></p></div><div class="versionadded"><p><span class="yiyi-st" id="yiyi-105"><span class="versionmodified">&#x7248;&#x672C;1.0.0&#x4E2D;&#x7684;&#x65B0;&#x529F;&#x80FD;</span></span></p></div><p><span class="yiyi-st" id="yiyi-106">&#x5BF9;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x7684;&#x6279;&#x91CF;&#x64CD;&#x4F5C;&#x5305;&#x62EC;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.bulk_save_objects" title="sqlalchemy.orm.session.Session.bulk_save_objects"><code class="xref py py-meth docutils literal"><span class="pre">Session.bulk_save_objects()</span></code></a>&#xFF0C;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.bulk_insert_mappings" title="sqlalchemy.orm.session.Session.bulk_insert_mappings"><code class="xref py py-meth docutils literal"><span class="pre">Session.bulk_insert_mappings()</span></code></a>&#x548C;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.bulk_update_mappings" title="sqlalchemy.orm.session.Session.bulk_update_mappings"><code class="xref py py-meth docutils literal"><span class="pre">Session.bulk_update_mappings()</span></code></a></span><span class="yiyi-st" id="yiyi-107">&#x8FD9;&#x4E9B;&#x65B9;&#x6CD5;&#x7684;&#x76EE;&#x7684;&#x662F;&#x76F4;&#x63A5;&#x66B4;&#x9732;&#x5DE5;&#x4F5C;&#x5355;&#x4F4D;&#x7CFB;&#x7EDF;&#x7684;&#x5185;&#x90E8;&#x5143;&#x7D20;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x5355;&#x72EC;&#x5229;&#x7528;&#x53D1;&#x51FA;&#x7ED9;&#x4E88;&#x5B57;&#x5178;&#x6216;&#x5BF9;&#x8C61;&#x72B6;&#x6001;&#x7684;INSERT&#x548C;UPDATE&#x8BED;&#x53E5;&#x7684;&#x8BBE;&#x65BD;&#xFF0C;&#x7ED5;&#x8FC7;&#x6B63;&#x5E38;&#x7684;&#x5DE5;&#x4F5C;&#x72B6;&#x6001;&#x673A;&#x5236;&#xFF0C;&#x5173;&#x7CFB;&#x548C;&#x5C5E;&#x6027;&#x7BA1;&#x7406;&#x3002;</span><span class="yiyi-st" id="yiyi-108">&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x7684;&#x4F18;&#x70B9;&#x4E25;&#x683C;&#x9650;&#x5236;&#x4E86;Python&#x7684;&#x5F00;&#x9500;&#x4E4B;&#x4E00;&#xFF1A;</span></p><ul class="simple"><li><span class="yiyi-st" id="yiyi-109">flush()&#x8FC7;&#x7A0B;&#x5305;&#x62EC;&#x6240;&#x6709;&#x5BF9;&#x8C61;&#x7684;&#x8C03;&#x67E5;&#xFF0C;&#x72B6;&#x6001;&#xFF0C;&#x7EA7;&#x8054;&#x72B6;&#x6001;&#xFF0C;&#x901A;&#x8FC7;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#x5173;&#x8054;&#x7684;&#x6240;&#x6709;&#x5BF9;&#x8C61;&#x7684;&#x72B6;&#x6001;&#xFF0C;&#x4EE5;&#x53CA;&#x8981;&#x6267;&#x884C;&#x7684;&#x6240;&#x6709;&#x64CD;&#x4F5C;&#x7684;&#x62D3;&#x6251;&#x6392;&#x5E8F;&#x5B8C;&#x5168;&#x88AB;&#x7ED5;&#x8FC7;&#x3002;</span><span class="yiyi-st" id="yiyi-110">&#x8FD9;&#x51CF;&#x5C11;&#x4E86;&#x5927;&#x91CF;&#x7684;Python&#x5F00;&#x9500;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-111">&#x5373;&#x4F7F;&#x64CD;&#x4F5C;&#x5B8C;&#x6210;&#xFF0C;&#x7ED9;&#x5B9A;&#x7684;&#x5BF9;&#x8C61;&#x4E0E;&#x76EE;&#x6807;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x4E4B;&#x95F4;&#x4E5F;&#x6CA1;&#x6709;&#x5B9A;&#x4E49;&#x5173;&#x7CFB;&#xFF0C;&#x8FD9;&#x610F;&#x5473;&#x7740;&#x6839;&#x636E;&#x6807;&#x8BC6;&#x6620;&#x5C04;&#x6216;&#x4F1A;&#x8BDD;&#x5728;&#x8FDE;&#x63A5;&#x5B83;&#x4EEC;&#x6216;&#x7BA1;&#x7406;&#x5B83;&#x4EEC;&#x7684;&#x72B6;&#x6001;&#x65F6;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x5F00;&#x9500;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-112"><a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.bulk_insert_mappings" title="sqlalchemy.orm.session.Session.bulk_insert_mappings"><code class="xref py py-meth docutils literal"><span class="pre">Session.bulk_insert_mappings()</span></code></a>&#x548C;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.bulk_update_mappings" title="sqlalchemy.orm.session.Session.bulk_update_mappings"><code class="xref py py-meth docutils literal"><span class="pre">Session.bulk_update_mappings()</span></code></a>&#x65B9;&#x6CD5;&#x63A5;&#x53D7;&#x666E;&#x901A;Python&#x5B57;&#x5178;&#x7684;&#x5217;&#x8868;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5BF9;&#x8C61;&#xFF1B;&#x8FD9;&#x8FDB;&#x4E00;&#x6B65;&#x51CF;&#x5C11;&#x4E86;&#x4E0E;&#x5B9E;&#x4F8B;&#x5316;&#x6620;&#x5C04;&#x5BF9;&#x8C61;&#x4EE5;&#x53CA;&#x4E3A;&#x5B83;&#x4EEC;&#x5206;&#x914D;&#x72B6;&#x6001;&#x76F8;&#x5173;&#x7684;&#x5927;&#x91CF;&#x5F00;&#x9500;&#xFF0C;&#x8FD9;&#x901A;&#x5E38;&#x8FD8;&#x8981;&#x4EE5;&#x6BCF;&#x4E2A;&#x5C5E;&#x6027;&#x4E3A;&#x57FA;&#x7840;&#x5BF9;&#x5386;&#x53F2;&#x8FDB;&#x884C;&#x6602;&#x8D35;&#x7684;&#x8DDF;&#x8E2A;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-113">&#x5728;INSERT&#x4E4B;&#x540E;&#x83B7;&#x53D6;&#x4E3B;&#x952E;&#x7684;&#x8FC7;&#x7A0B;&#x4E5F;&#x88AB;&#x9ED8;&#x8BA4;&#x7981;&#x7528;&#x3002;</span><span class="yiyi-st" id="yiyi-114">&#x5F53;&#x6B63;&#x786E;&#x6267;&#x884C;&#x65F6;&#xFF0C;INSERT&#x8BED;&#x53E5;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x66F4;&#x5BB9;&#x6613;&#x5730;&#x88AB;&#x5DE5;&#x4F5C;&#x5355;&#x5143;&#x6279;&#x5904;&#x7406;&#x6210;<code class="docutils literal"><span class="pre">executemany()</span></code>&#x5757;&#xFF0C;&#x5B83;&#x6BD4;&#x5355;&#x72EC;&#x7684;&#x8BED;&#x53E5;&#x8C03;&#x7528;&#x6267;&#x884C;&#x5F97;&#x66F4;&#x597D;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-115">UPDATE&#x8BED;&#x53E5;&#x53EF;&#x4EE5;&#x7C7B;&#x4F3C;&#x5730;&#x8FDB;&#x884C;&#x5B9A;&#x5236;&#xFF0C;&#x4F7F;&#x6240;&#x6709;&#x5C5E;&#x6027;&#x65E0;&#x6761;&#x4EF6;&#x5730;&#x670D;&#x4ECE;SET&#x8BED;&#x53E5;&#xFF0C;&#x540C;&#x6837;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">executemany()</span></code>&#x5757;&#x3002;</span></li></ul><p><span class="yiyi-st" id="yiyi-116">&#x5E94;&#x8BE5;&#x4F7F;&#x7528;<a class="reference internal" href="examples.html#examples-performance"><span>Performance</span></a>&#x793A;&#x4F8B;&#x5957;&#x4EF6;&#x7814;&#x7A76;&#x6279;&#x91CF;&#x4F8B;&#x7A0B;&#x7684;&#x6027;&#x80FD;&#x884C;&#x4E3A;&#x3002;</span><span class="yiyi-st" id="yiyi-117">&#x8FD9;&#x662F;&#x4E00;&#x7CFB;&#x5217;&#x793A;&#x4F8B;&#x811A;&#x672C;&#xFF0C;&#x5B83;&#x4EEC;&#x6F14;&#x793A;&#x4E86;&#x5404;&#x79CD;&#x573A;&#x666F;&#x4E0B;&#x7684;Python&#x8C03;&#x7528;&#x8BA1;&#x6570;&#xFF0C;&#x5305;&#x62EC;&#x6279;&#x91CF;&#x63D2;&#x5165;&#x548C;&#x66F4;&#x65B0;&#x573A;&#x666F;&#x3002;</span></p><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-118">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-119"><a class="reference internal" href="examples.html#examples-performance"><span>Performance</span></a> - includes detailed examples of bulk operations contrasted against traditional Core and ORM methods, including performance metrics.</span></p></div><div class="section" id="usage"><h3><span class="yiyi-st" id="yiyi-120">&#x7528;&#x6CD5;<a class="headerlink" href="#usage" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h3><p><span class="yiyi-st" id="yiyi-121">&#x6BCF;&#x4E2A;&#x65B9;&#x6CD5;&#x90FD;&#x5728;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x5BF9;&#x8C61;&#x4E8B;&#x52A1;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x5DE5;&#x4F5C;&#xFF0C;&#x5C31;&#x50CF;&#x4EFB;&#x4F55;&#x5176;&#x4ED6;&#x65B9;&#x6CD5;&#x4E00;&#x6837;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>
<span class="n">objects</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">User</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;u1&quot;</span><span class="p">),</span>
    <span class="n">User</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;u2&quot;</span><span class="p">),</span>
    <span class="n">User</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;u3&quot;</span><span class="p">)</span>
<span class="p">]</span>
<span class="n">s</span><span class="o">.</span><span class="n">bulk_save_objects</span><span class="p">(</span><span class="n">objects</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-122">&#x5BF9;&#x4E8E;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.bulk_insert_mappings" title="sqlalchemy.orm.session.Session.bulk_insert_mappings"><code class="xref py py-meth docutils literal"><span class="pre">Session.bulk_insert_mappings()</span></code></a>&#x548C;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.bulk_update_mappings" title="sqlalchemy.orm.session.Session.bulk_update_mappings"><code class="xref py py-meth docutils literal"><span class="pre">Session.bulk_update_mappings()</span></code></a>&#xFF0C;&#x4F20;&#x9012;&#x5B57;&#x5178;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">bulk_insert_mappings</span><span class="p">(</span><span class="n">User</span><span class="p">,</span>
  <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;u1&quot;</span><span class="p">),</span> <span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;u2&quot;</span><span class="p">),</span> <span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;u3&quot;</span><span class="p">)]</span>
<span class="p">)</span></pre></div></div><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-123">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p><span class="yiyi-st" id="yiyi-124"><a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.bulk_save_objects" title="sqlalchemy.orm.session.Session.bulk_save_objects"><code class="xref py py-meth docutils literal"><span class="pre">Session.bulk_save_objects()</span></code></a></span></p><p><span class="yiyi-st" id="yiyi-125"><a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.bulk_insert_mappings" title="sqlalchemy.orm.session.Session.bulk_insert_mappings"><code class="xref py py-meth docutils literal"><span class="pre">Session.bulk_insert_mappings()</span></code></a></span></p><p class="last"><span class="yiyi-st" id="yiyi-126"><a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.bulk_update_mappings" title="sqlalchemy.orm.session.Session.bulk_update_mappings"><code class="xref py py-meth docutils literal"><span class="pre">Session.bulk_update_mappings()</span></code></a></span></p></div></div><div class="section" id="comparison-to-core-insert-update-constructs"><h3><span class="yiyi-st" id="yiyi-127">&#x4E0E;&#x6838;&#x5FC3;&#x63D2;&#x5165;/&#x66F4;&#x65B0;&#x6784;&#x9020;&#x6BD4;&#x8F83;<a class="headerlink" href="#comparison-to-core-insert-update-constructs" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-128">&#x6279;&#x91CF;&#x65B9;&#x6CD5;&#x63D0;&#x4F9B;&#x7684;&#x6027;&#x80FD;&#x5728;&#x7279;&#x5B9A;&#x60C5;&#x51B5;&#x4E0B;&#x53EF;&#x4EE5;&#x63A5;&#x8FD1;&#x5728;&#x201C;executemany&#x201D;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x4F7F;&#x7528;&#x6838;&#x5FC3;<a class="reference internal" href="core_dml.html#sqlalchemy.sql.expression.Insert" title="sqlalchemy.sql.expression.Insert"><code class="xref py py-class docutils literal"><span class="pre">Insert</span></code></a>&#x548C;<a class="reference internal" href="core_dml.html#sqlalchemy.sql.expression.Update" title="sqlalchemy.sql.expression.Update"><code class="xref py py-class docutils literal"><span class="pre">Update</span></code></a>&#x7ED3;&#x6784;&#x7684;&#x6027;&#x80FD;&#xFF08;&#x6709;&#x5173;&#x201C;executemany&#x201D; &#xFF0C;&#x8BF7;&#x53C2;&#x9605;Core&#x6559;&#x7A0B;&#x4E2D;&#x7684;<a class="reference internal" href="core_tutorial.html#execute-multiple"><span>Executing Multiple Statements</span></a>&#xFF09;&#x3002;</span><span class="yiyi-st" id="yiyi-129">&#x4E3A;&#x4E86;&#x5B9E;&#x73B0;&#x8FD9;&#x4E00;&#x70B9;&#xFF0C;&#x5E94;&#x7981;&#x7528;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.bulk_insert_mappings.params.return_defaults" title="sqlalchemy.orm.session.Session.bulk_insert_mappings"><code class="xref py py-paramref docutils literal"><span class="pre">Session.bulk_insert_mappings.return_defaults</span></code></a>&#x6807;&#x5FD7;&#xFF0C;&#x4EE5;&#x4FBF;&#x53EF;&#x4EE5;&#x5C06;&#x884C;&#x7EC4;&#x5408;&#x5728;&#x4E00;&#x8D77;&#x3002;</span><span class="yiyi-st" id="yiyi-130">&#x5E94;&#x4ED4;&#x7EC6;&#x7814;&#x7A76;<a class="reference internal" href="examples.html#examples-performance"><span>Performance</span></a>&#x4E2D;&#x7684;&#x793A;&#x4F8B;&#x5957;&#x4EF6;&#xFF0C;&#x4EE5;&#x4FBF;&#x719F;&#x6089;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x6279;&#x91CF;&#x6027;&#x80FD;&#x7684;&#x5FEB;&#x901F;&#x7A0B;&#x5EA6;&#x3002;</span></p></div><div class="section" id="orm-compatibility"><h3><span class="yiyi-st" id="yiyi-131">ORM&#x517C;&#x5BB9;&#x6027;<a class="headerlink" href="#orm-compatibility" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-132">&#x4E0E;&#x4F20;&#x7EDF;&#x7684;ORM&#x4F7F;&#x7528;&#x76F8;&#x6BD4;&#xFF0C;&#x6279;&#x91CF;&#x63D2;&#x5165;/&#x66F4;&#x65B0;&#x65B9;&#x6CD5;&#x5931;&#x53BB;&#x4E86;&#x5927;&#x91CF;&#x7684;&#x529F;&#x80FD;&#x3002;</span><span class="yiyi-st" id="yiyi-133">&#x4EE5;&#x4E0B;&#x662F;&#x4F7F;&#x7528;&#x8FD9;&#x4E9B;&#x65B9;&#x6CD5;&#x65F6;<strong>&#x4E0D;&#x53EF;&#x7528;</strong>&#x7684;&#x529F;&#x80FD;&#x5217;&#x8868;&#xFF1A;</span></p><ul class="simple"><li><span class="yiyi-st" id="yiyi-134">&#x6CBF;&#x7740;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#x94FE;&#x63A5;&#x6301;&#x4E45;&#x5316;</span></li><li><span class="yiyi-st" id="yiyi-135">&#x4F9D;&#x8D56;&#x6027;&#x987A;&#x5E8F;&#x6392;&#x5E8F;&#x884C;&#xFF1B;&#x884C;&#x5C06;&#x6309;&#x7167;&#x5B83;&#x4EEC;&#x4F20;&#x9012;&#x7ED9;&#x65B9;&#x6CD5;&#x7684;&#x987A;&#x5E8F;&#x76F4;&#x63A5;&#x63D2;&#x5165;&#x6216;&#x66F4;&#x65B0;</span></li><li><span class="yiyi-st" id="yiyi-136">&#x5BF9;&#x7ED9;&#x5B9A;&#x5BF9;&#x8C61;&#x7684;&#x4F1A;&#x8BDD;&#x7BA1;&#x7406;&#xFF0C;&#x5305;&#x62EC;&#x5BF9;&#x4F1A;&#x8BDD;&#x7684;&#x9644;&#x4EF6;&#xFF0C;&#x8EAB;&#x4EFD;&#x6620;&#x5C04;&#x7BA1;&#x7406;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-137">&#x4E0E;&#x4E3B;&#x952E;&#x7A81;&#x53D8;&#xFF0C;ON UPDATE&#x7EA7;&#x8054;&#x6709;&#x5173;&#x7684;&#x529F;&#x80FD;</span></li><li><span class="yiyi-st" id="yiyi-138">SQL&#x8868;&#x8FBE;&#x5F0F;&#x63D2;&#x5165;/&#x66F4;&#x65B0;&#xFF08;&#x4F8B;&#x5982;<a class="reference internal" href="#flush-embedded-sql-expressions"><span>Embedding SQL Insert/Update Expressions into a Flush</span></a>&#x4E2D;&#xFF09;</span></li><li><span class="yiyi-st" id="yiyi-139">ORM&#x4E8B;&#x4EF6;&#xFF0C;&#x5982;<a class="reference internal" href="events.html#sqlalchemy.orm.events.MapperEvents.before_insert" title="sqlalchemy.orm.events.MapperEvents.before_insert"><code class="xref py py-meth docutils literal"><span class="pre">MapperEvents.before_insert()</span></code></a>&#x7B49;&#x3002;</span><span class="yiyi-st" id="yiyi-140">&#x6279;&#x91CF;&#x4F1A;&#x8BDD;&#x65B9;&#x6CD5;&#x6CA1;&#x6709;&#x4E8B;&#x4EF6;&#x652F;&#x6301;&#x3002;</span></li></ul><p><span class="yiyi-st" id="yiyi-141"><strong>&#x53EF;&#x7528;&#x7684;&#x529F;&#x80FD;</strong>&#x5305;&#x62EC;&#xFF1A;</span></p><ul class="simple"><li><span class="yiyi-st" id="yiyi-142">&#x6620;&#x5C04;&#x5BF9;&#x8C61;&#x7684;INSERT&#x548C;UPDATE</span></li><li><span class="yiyi-st" id="yiyi-143">&#x7248;&#x672C;&#x6807;&#x8BC6;&#x7B26;&#x652F;&#x6301;</span></li><li><span class="yiyi-st" id="yiyi-144">&#x591A;&#x8868;&#x6620;&#x5C04;&#xFF08;&#x5982;&#x8FDE;&#x63A5;&#x7EE7;&#x627F;&#xFF09; - &#x4F46;&#x662F;&#xFF0C;&#x8981;&#x63D2;&#x5165;&#x591A;&#x4E2A;&#x8868;&#x7684;&#x5BF9;&#x8C61;&#x8981;&#x4E48;&#x63D0;&#x524D;&#x5B8C;&#x5168;&#x586B;&#x5145;&#x4E3B;&#x952E;&#x6807;&#x8BC6;&#x7B26;&#xFF0C;&#x5426;&#x5219;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.bulk_save_objects.params.return_defaults" title="sqlalchemy.orm.session.Session.bulk_save_objects"><code class="xref py py-paramref docutils literal"><span class="pre">Session.bulk_save_objects.return_defaults</span></code></a>&#x6807;&#x5FD7;&#x5FC5;&#x987B;&#x88AB;&#x4F7F;&#x7528;&#xFF0C;&#x8FD9;&#x5C06;&#x5927;&#x5927;&#x964D;&#x4F4E;&#x6027;&#x80FD;&#x7684;&#x597D;&#x5904;</span></li></ul></div></div>