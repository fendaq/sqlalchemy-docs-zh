<h1><span class="yiyi-st" id="yiyi-46">&#x90BB;&#x63A5;&#x5217;&#x8868;&#x5173;&#x7CFB;<a class="headerlink" href="#adjacency-list-relationships" title="Permalink to this headline">&#xB6;</a></span></h1><p><span class="yiyi-st" id="yiyi-47"><strong>&#x90BB;&#x63A5;&#x5217;&#x8868;</strong>&#x6A21;&#x5F0F;&#x662F;&#x4E00;&#x79CD;&#x5E38;&#x89C1;&#x7684;&#x5173;&#x7CFB;&#x6A21;&#x5F0F;&#xFF0C;&#x8868;&#x4E2D;&#x5305;&#x542B;&#x5BF9;&#x5176;&#x81EA;&#x8EAB;&#x7684;&#x5916;&#x952E;&#x5F15;&#x7528;&#x3002;</span><span class="yiyi-st" id="yiyi-48">&#x8FD9;&#x662F;&#x5728;&#x5E73;&#x5766;&#x8868;&#x683C;&#x4E2D;&#x8868;&#x793A;&#x5206;&#x5C42;&#x6570;&#x636E;&#x7684;&#x6700;&#x5E38;&#x89C1;&#x65B9;&#x5F0F;&#x3002;</span><span class="yiyi-st" id="yiyi-49">&#x5176;&#x4ED6;&#x65B9;&#x6CD5;&#x5305;&#x62EC;<strong>&#x5D4C;&#x5957;&#x96C6;&#x5408;</strong>&#xFF0C;&#x6709;&#x65F6;&#x79F0;&#x4E3A;&#x201C;&#x4FEE;&#x6539;&#x524D;&#x5E8F;&#x201D;&#xFF0C;&#x4EE5;&#x53CA;<strong>&#x7269;&#x5316;&#x8DEF;&#x5F84;</strong>&#x3002;</span><span class="yiyi-st" id="yiyi-50">&#x5C3D;&#x7BA1;&#x4FEE;&#x6539;&#x524D;&#x5E8F;&#x5728;SQL&#x67E5;&#x8BE2;&#x4E2D;&#x5BF9;&#x5176;&#x6D41;&#x7545;&#x6027;&#x8FDB;&#x884C;&#x8BC4;&#x4F30;&#x65F6;&#x5177;&#x6709;&#x5438;&#x5F15;&#x529B;&#xFF0C;&#x4F46;&#x7531;&#x4E8E;&#x5E76;&#x53D1;&#x6027;&#xFF0C;&#x590D;&#x6742;&#x6027;&#x4EE5;&#x53CA;&#x4FEE;&#x6539;&#x540E;&#x7684;&#x524D;&#x5E8F;&#x51E0;&#x4E4E;&#x6CA1;&#x6709;&#x4F18;&#x52BF;&#xFF0C;&#x6240;&#x4EE5;&#x90BB;&#x63A5;&#x5217;&#x8868;&#x6A21;&#x578B;&#x53EF;&#x80FD;&#x662F;&#x5927;&#x591A;&#x6570;&#x5206;&#x5C42;&#x5B58;&#x50A8;&#x9700;&#x6C42;&#x6700;&#x5408;&#x9002;&#x7684;&#x6A21;&#x5F0F;&#x901A;&#x8FC7;&#x53EF;&#x4EE5;&#x5C06;&#x5B50;&#x6811;&#x5B8C;&#x5168;&#x52A0;&#x8F7D;&#x5230;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7A7A;&#x95F4;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-51">&#x5728;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x540D;&#x4E3A;<code class="docutils literal"><span class="pre">Node</span></code>&#x7684;&#x6620;&#x5C04;&#x7C7B;&#x6765;&#x8868;&#x793A;&#x4E00;&#x4E2A;&#x6811;&#x7ED3;&#x6784;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Node</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;node&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">parent_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;node.id&apos;</span><span class="p">))</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">children</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Node&quot;</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-52">&#x6709;&#x4E86;&#x8FD9;&#x4E2A;&#x7ED3;&#x6784;&#xFF0C;&#x4E00;&#x4E2A;&#x56FE;&#x5F62;&#x5982;&#x4E0B;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>root --+---&gt; child1
       +---&gt; child2 --+--&gt; subchild1
       |              +--&gt; subchild2
       +---&gt; child3</pre></div></div><p><span class="yiyi-st" id="yiyi-53">&#x5C06;&#x7528;&#x4EE5;&#x4E0B;&#x6570;&#x636E;&#x8868;&#x793A;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>id       parent_id     data
---      -------       ----
1        NULL          root
2        1             child1
3        1             child2
4        3             subchild1
5        3             subchild2
6        1             child3</pre></div></div><p><span class="yiyi-st" id="yiyi-54">&#x8FD9;&#x91CC;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#x914D;&#x7F6E;&#x4E0E;&#x201C;&#x6B63;&#x5E38;&#x201D;&#x4E00;&#x5BF9;&#x591A;&#x5173;&#x7CFB;&#x7684;&#x5DE5;&#x4F5C;&#x65B9;&#x5F0F;&#x76F8;&#x540C;&#xFF0C;&#x9664;&#x4E86;&#x201C;&#x65B9;&#x5411;&#x201D;&#xFF0C;&#x5373;&#x5173;&#x7CFB;&#x662F;&#x4E00;&#x5BF9;&#x591A;&#x8FD8;&#x662F;&#x4E00;&#x5BF9;&#x591A;&#x591A;&#x5BF9;&#x4E00;&#xFF0C;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#x5047;&#x5B9A;&#x4E3A;&#x4E00;&#x5BF9;&#x591A;&#x3002;</span><span class="yiyi-st" id="yiyi-55">&#x4E3A;&#x4E86;&#x5EFA;&#x7ACB;&#x591A;&#x5BF9;&#x4E00;&#x7684;&#x5173;&#x7CFB;&#xFF0C;&#x989D;&#x5916;&#x7684;&#x6307;&#x4EE4;&#x88AB;&#x79F0;&#x4E3A;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.remote_side" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">remote_side</span></code></a>&#xFF0C;&#x5B83;&#x662F;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a>&#x6216;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a>&#x5BF9;&#x8C61;&#x7684;&#x96C6;&#x5408;&#x8868;&#x660E;&#x90A3;&#x4E9B;&#x5E94;&#x8BE5;&#x88AB;&#x8BA4;&#x4E3A;&#x662F;&#x201C;&#x9065;&#x8FDC;&#x201D;&#x7684;&#x90A3;&#x4E9B;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Node</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;node&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">parent_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;node.id&apos;</span><span class="p">))</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">parent</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Node&quot;</span><span class="p">,</span> <span class="n">remote_side</span><span class="o">=</span><span class="p">[</span><span class="nb">id</span><span class="p">])</span></pre></div></div><p><span class="yiyi-st" id="yiyi-56">&#x5728;&#x4E0A;&#x9762;&#x7684;&#x60C5;&#x51B5;&#x4E2D;&#xFF0C;<code class="docutils literal"><span class="pre">id</span></code>&#x5217;&#x4F5C;&#x4E3A;<code class="docutils literal"><span class="pre">parent</span></code> <a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#x7684;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.remote_side" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">remote_side</span></code></a>&#x5E94;&#x7528;&#xFF0C;&#x4ECE;&#x800C;&#x5EFA;&#x7ACB;<code class="docutils literal"><span class="pre">parent_id</span></code>&#x4F5C;&#x4E3A;&#x201C;&#x672C;&#x5730;&#x201D;&#x4E00;&#x65B9;&#xFF0C;&#x7136;&#x540E;&#x8BE5;&#x5173;&#x7CFB;&#x8868;&#x73B0;&#x4E3A;&#x591A;&#x5BF9;&#x4E00;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-57">&#x4E0E;&#x5F80;&#x5E38;&#x4E00;&#x6837;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.backref" title="sqlalchemy.orm.backref"><code class="xref py py-func docutils literal"><span class="pre">backref()</span></code></a>&#x51FD;&#x6570;&#x5C06;&#x4E24;&#x4E2A;&#x65B9;&#x5411;&#x7EC4;&#x5408;&#x4E3A;&#x53CC;&#x5411;&#x5173;&#x7CFB;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Node</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;node&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">parent_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;node.id&apos;</span><span class="p">))</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">children</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Node&quot;</span><span class="p">,</span>
                <span class="n">backref</span><span class="o">=</span><span class="n">backref</span><span class="p">(</span><span class="s1">&apos;parent&apos;</span><span class="p">,</span> <span class="n">remote_side</span><span class="o">=</span><span class="p">[</span><span class="nb">id</span><span class="p">])</span>
            <span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-58">SQLAlchemy&#x4E2D;&#x5305;&#x542B;&#x51E0;&#x4E2A;&#x4F8B;&#x5B50;&#x6765;&#x8BF4;&#x660E;&#x81EA;&#x6211;&#x6307;&#x6D89;&#x7B56;&#x7565;&#xFF1B;&#x8FD9;&#x4E9B;&#x5305;&#x62EC;<a class="reference internal" href="examples.html#examples-adjacencylist"><span>Adjacency List</span></a>&#x548C;<a class="reference internal" href="examples.html#examples-xmlpersistence"><span>XML Persistence</span></a>&#x3002;</span></p><div class="section" id="composite-adjacency-lists"><h2><span class="yiyi-st" id="yiyi-59">&#x590D;&#x5408;&#x90BB;&#x63A5;&#x8868;<a class="headerlink" href="#composite-adjacency-lists" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-60">&#x90BB;&#x63A5;&#x5217;&#x8868;&#x5173;&#x7CFB;&#x7684;&#x5B50;&#x7C7B;&#x522B;&#x662F;&#x8FDE;&#x63A5;&#x6761;&#x4EF6;&#x7684;&#x201C;&#x672C;&#x5730;&#x201D;&#x548C;&#x201C;&#x8FDC;&#x7A0B;&#x201D;&#x4E24;&#x4FA7;&#x90FD;&#x5B58;&#x5728;&#x7279;&#x5B9A;&#x5217;&#x7684;&#x7F55;&#x89C1;&#x60C5;&#x51B5;&#x3002;</span><span class="yiyi-st" id="yiyi-61">&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#x662F;&#x4E0B;&#x9762;&#x7684;<code class="docutils literal"><span class="pre">Folder</span></code>&#x7C7B;&#xFF1B;&#x4F7F;&#x7528;&#x590D;&#x5408;&#x4E3B;&#x952E;&#xFF0C;<code class="docutils literal"><span class="pre">account_id</span></code>&#x5217;&#x5F15;&#x7528;&#x81EA;&#x8EAB;&#xFF0C;&#x4EE5;&#x6307;&#x793A;&#x4E0E;&#x7236;&#x6587;&#x4EF6;&#x4F4D;&#x4E8E;&#x540C;&#x4E00;&#x5E10;&#x6237;&#x5185;&#x7684;&#x5B50;&#x6587;&#x4EF6;&#x5939;&#xFF1B;&#x800C;<code class="docutils literal"><span class="pre">folder_id</span></code>&#x6307;&#x7684;&#x662F;&#x8BE5;&#x5E10;&#x6237;&#x4E2D;&#x7684;&#x7279;&#x5B9A;&#x6587;&#x4EF6;&#x5939;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Folder</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;folder&apos;</span>
    <span class="n">__table_args__</span> <span class="o">=</span> <span class="p">(</span>
      <span class="n">ForeignKeyConstraint</span><span class="p">(</span>
          <span class="p">[</span><span class="s1">&apos;account_id&apos;</span><span class="p">,</span> <span class="s1">&apos;parent_id&apos;</span><span class="p">],</span>
          <span class="p">[</span><span class="s1">&apos;folder.account_id&apos;</span><span class="p">,</span> <span class="s1">&apos;folder.folder_id&apos;</span><span class="p">]),</span>
    <span class="p">)</span>

    <span class="n">account_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">folder_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">parent_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>

    <span class="n">parent_folder</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Folder&quot;</span><span class="p">,</span>
                        <span class="n">backref</span><span class="o">=</span><span class="s2">&quot;child_folders&quot;</span><span class="p">,</span>
                        <span class="n">remote_side</span><span class="o">=</span><span class="p">[</span><span class="n">account_id</span><span class="p">,</span> <span class="n">folder_id</span><span class="p">]</span>
                  <span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-62">&#x4E0A;&#x9762;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;<code class="docutils literal"><span class="pre">account_id</span></code>&#x4F20;&#x9012;&#x5230;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.remote_side" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">remote_side</span></code></a>&#x5217;&#x8868;&#x4E2D;&#x3002;</span><span class="yiyi-st" id="yiyi-63"><a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#x8BC6;&#x522B;&#x8FD9;&#x91CC;&#x7684;<code class="docutils literal"><span class="pre">account_id</span></code>&#x5217;&#x4F4D;&#x4E8E;&#x4E24;&#x4FA7;&#xFF0C;&#x5E76;&#x5C06;&#x201C;remote&#x201D;&#x5217;&#x4E0E;<code class="docutils literal"><span class="pre">folder_id</span></code>&#x5217;&#x5BF9;&#x9F50;&#xFF0C;&#x627F;&#x8BA4;&#x5728;&#x201C;&#x8FDC;&#x7A0B;&#x201D;&#x65B9;&#x9762;&#x662F;&#x552F;&#x4E00;&#x5B58;&#x5728;&#x7684;&#x3002;</span></p><div class="versionadded"><p><span class="yiyi-st" id="yiyi-64"><span class="versionmodified">0.8&#x7248;&#x65B0;&#x589E;&#x529F;&#x80FD;&#xFF1A;</span>&#x652F;&#x6301;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#x4E2D;&#x7684;&#x81EA;&#x5F15;&#x7528;&#x7EC4;&#x5408;&#x952E;&#xFF0C;&#x5176;&#x4E2D;&#x5217;&#x6307;&#x5411;&#x81EA;&#x8EAB;&#x3002;</span></p></div></div><div class="section" id="self-referential-query-strategies"><h2><span class="yiyi-st" id="yiyi-65">&#x81EA;&#x5F15;&#x7528;&#x67E5;&#x8BE2;&#x7B56;&#x7565;<a class="headerlink" href="#self-referential-query-strategies" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-66">&#x67E5;&#x8BE2;&#x81EA;&#x5F15;&#x7528;&#x7ED3;&#x6784;&#x7684;&#x5DE5;&#x4F5C;&#x65B9;&#x5F0F;&#x4E0E;&#x5176;&#x4ED6;&#x67E5;&#x8BE2;&#x7C7B;&#x4F3C;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># get all nodes named &apos;child2&apos;</span>
<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Node</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Node</span><span class="o">.</span><span class="n">data</span><span class="o">==</span><span class="s1">&apos;child2&apos;</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-67">&#x4F46;&#x662F;&#xFF0C;&#x5F53;&#x8BD5;&#x56FE;&#x6CBF;&#x7740;&#x5916;&#x952E;&#x4ECE;&#x6811;&#x7684;&#x4E00;&#x7EA7;&#x8FDE;&#x63A5;&#x5230;&#x4E0B;&#x4E00;&#x7EA7;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x683C;&#x5916;&#x5C0F;&#x5FC3;&#x3002;</span><span class="yiyi-st" id="yiyi-68">&#x5728;SQL&#x4E2D;&#xFF0C;&#x4ECE;&#x8868;&#x5230;&#x5B83;&#x81EA;&#x8EAB;&#x7684;&#x8FDE;&#x63A5;&#x8981;&#x6C42;&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x81F3;&#x5C11;&#x4E00;&#x4FA7;&#x662F;&#x201C;&#x522B;&#x540D;&#x201D;&#xFF0C;&#x4EE5;&#x4FBF;&#x53EF;&#x4EE5;&#x6BEB;&#x4E0D;&#x542B;&#x7CCA;&#x5730;&#x5F15;&#x7528;&#x5B83;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-69">&#x56DE;&#x987E;ORM&#x6559;&#x7A0B;&#x4E2D;&#x7684;<a class="reference internal" href="tutorial.html#ormtutorial-aliases"><span>Using Aliases</span></a>&#xFF0C;<a class="reference internal" href="query.html#sqlalchemy.orm.aliased" title="sqlalchemy.orm.aliased"><code class="xref py py-func docutils literal"><span class="pre">orm.aliased()</span></code></a>&#x6784;&#x9020;&#x901A;&#x5E38;&#x7528;&#x4E8E;&#x63D0;&#x4F9B;ORM&#x5B9E;&#x4F53;&#x7684;&#x201C;&#x522B;&#x540D;&#x201D;&#x3002;</span><span class="yiyi-st" id="yiyi-70">&#x4F7F;&#x7528;&#x8FD9;&#x79CD;&#x6280;&#x672F;&#x4ECE;<code class="docutils literal"><span class="pre">Node</span></code>&#x52A0;&#x5165;&#x81EA;&#x5DF1;&#x7684;&#x8FC7;&#x7A0B;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</span></p><div class="highlight-python+sql"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">aliased</span>

<span class="n">nodealias</span> <span class="o">=</span> <span class="n">aliased</span><span class="p">(</span><span class="n">Node</span><span class="p">)</span>
<a class="sql_link" href="#">sql</a><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Node</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Node</span><span class="o">.</span><span class="n">data</span><span class="o">==</span><span class="s1">&apos;subchild1&apos;</span><span class="p">)</span><span class="o">.</span>\
                <span class="n">join</span><span class="p">(</span><span class="n">nodealias</span><span class="p">,</span> <span class="n">Node</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">.</span>\
                <span class="nb">filter</span><span class="p">(</span><span class="n">nodealias</span><span class="o">.</span><span class="n">data</span><span class="o">==</span><span class="s2">&quot;child2&quot;</span><span class="p">)</span><span class="o">.</span>\
                <span class="nb">all</span><span class="p">()</span>
<div class="popup_sql">SELECT node.id AS node_id,
        node.parent_id AS node_parent_id,
        node.data AS node_data
FROM node JOIN node AS node_1
    ON node.parent_id = node_1.id
WHERE node.data = ?
    AND node_1.data = ?
[&apos;subchild1&apos;, &apos;child2&apos;]</div></pre></div></div><p><span class="yiyi-st" id="yiyi-71"><a class="reference internal" href="query.html#sqlalchemy.orm.query.Query.join" title="sqlalchemy.orm.query.Query.join"><code class="xref py py-meth docutils literal"><span class="pre">Query.join()</span></code></a> also includes a feature known as <a class="reference internal" href="query.html#sqlalchemy.orm.query.Query.join.params.aliased" title="sqlalchemy.orm.query.Query.join"><code class="xref py py-paramref docutils literal"><span class="pre">Query.join.aliased</span></code></a> that can shorten the verbosity self- referential joins, at the expense of query flexibility. </span><span class="yiyi-st" id="yiyi-72">&#x6B64;&#x529F;&#x80FD;&#x6267;&#x884C;&#x4E0E;&#x4E0A;&#x8FF0;&#x76F8;&#x4F3C;&#x7684;&#x201C;&#x522B;&#x540D;&#x201D;&#x6B65;&#x9AA4;&#xFF0C;&#x800C;&#x4E0D;&#x9700;&#x8981;&#x660E;&#x786E;&#x7684;&#x5B9E;&#x4F53;&#x3002;</span><span class="yiyi-st" id="yiyi-73">&#x8C03;&#x7528;<a class="reference internal" href="query.html#sqlalchemy.orm.query.Query.filter" title="sqlalchemy.orm.query.Query.filter"><code class="xref py py-meth docutils literal"><span class="pre">Query.filter()</span></code></a>&#x4EE5;&#x53CA;&#x5728;&#x522B;&#x540D;&#x8FDE;&#x63A5;&#x4E4B;&#x540E;&#x7684;&#x7C7B;&#x4F3C;&#x64CD;&#x4F5C;&#x5C06;<strong>&#x5C06;<code class="docutils literal"><span class="pre">Node</span></code>&#x5B9E;&#x4F53;&#x4FEE;&#x6539;&#x4E3A;&#x522B;&#x540D;&#x7684;&#x5B9E;&#x4F53;&#xFF1A;</strong></span></p><div class="highlight-python+sql"><div class="highlight"><pre><span></span><a class="sql_link" href="#">sql</a><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Node</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Node</span><span class="o">.</span><span class="n">data</span><span class="o">==</span><span class="s1">&apos;subchild1&apos;</span><span class="p">)</span><span class="o">.</span>\
        <span class="n">join</span><span class="p">(</span><span class="n">Node</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">aliased</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span>\
        <span class="nb">filter</span><span class="p">(</span><span class="n">Node</span><span class="o">.</span><span class="n">data</span><span class="o">==</span><span class="s1">&apos;child2&apos;</span><span class="p">)</span><span class="o">.</span>\
        <span class="nb">all</span><span class="p">()</span>
<div class="popup_sql">SELECT node.id AS node_id,
        node.parent_id AS node_parent_id,
        node.data AS node_data
FROM node
    JOIN node AS node_1 ON node_1.id = node.parent_id
WHERE node.data = ? AND node_1.data = ?
[&apos;subchild1&apos;, &apos;child2&apos;]</div></pre></div></div><p><span class="yiyi-st" id="yiyi-74">&#x8981;&#x5C06;&#x6807;&#x51C6;&#x6DFB;&#x52A0;&#x5230;&#x66F4;&#x957F;&#x8FDE;&#x63A5;&#x7684;&#x591A;&#x4E2A;&#x70B9;&#xFF0C;&#x8BF7;&#x5C06;<a class="reference internal" href="query.html#sqlalchemy.orm.query.Query.join.params.from_joinpoint" title="sqlalchemy.orm.query.Query.join"><code class="xref py py-paramref docutils literal"><span class="pre">Query.join.from_joinpoint</span></code></a>&#x6DFB;&#x52A0;&#x5230;&#x5176;&#x4ED6;<a class="reference internal" href="query.html#sqlalchemy.orm.query.Query.join" title="sqlalchemy.orm.query.Query.join"><code class="xref py py-meth docutils literal"><span class="pre">join()</span></code></a>&#x8C03;&#x7528;&#x4E2D;&#xFF1A;</span></p><div class="highlight-python+sql"><div class="highlight"><pre><span></span><span class="c1"># get all nodes named &apos;subchild1&apos; with a</span>
<span class="c1"># parent named &apos;child2&apos; and a grandparent &apos;root&apos;</span>
<a class="sql_link" href="#">sql</a><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Node</span><span class="p">)</span><span class="o">.</span>\
        <span class="nb">filter</span><span class="p">(</span><span class="n">Node</span><span class="o">.</span><span class="n">data</span><span class="o">==</span><span class="s1">&apos;subchild1&apos;</span><span class="p">)</span><span class="o">.</span>\
        <span class="n">join</span><span class="p">(</span><span class="n">Node</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">aliased</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span>\
        <span class="nb">filter</span><span class="p">(</span><span class="n">Node</span><span class="o">.</span><span class="n">data</span><span class="o">==</span><span class="s1">&apos;child2&apos;</span><span class="p">)</span><span class="o">.</span>\
        <span class="n">join</span><span class="p">(</span><span class="n">Node</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">aliased</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">from_joinpoint</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span>\
        <span class="nb">filter</span><span class="p">(</span><span class="n">Node</span><span class="o">.</span><span class="n">data</span><span class="o">==</span><span class="s1">&apos;root&apos;</span><span class="p">)</span><span class="o">.</span>\
        <span class="nb">all</span><span class="p">()</span>
<div class="popup_sql">SELECT node.id AS node_id,
        node.parent_id AS node_parent_id,
        node.data AS node_data
FROM node
    JOIN node AS node_1 ON node_1.id = node.parent_id
    JOIN node AS node_2 ON node_2.id = node_1.parent_id
WHERE node.data = ?
    AND node_1.data = ?
    AND node_2.data = ?
[&apos;subchild1&apos;, &apos;child2&apos;, &apos;root&apos;]</div></pre></div></div><p><span class="yiyi-st" id="yiyi-75"><a class="reference internal" href="query.html#sqlalchemy.orm.query.Query.reset_joinpoint" title="sqlalchemy.orm.query.Query.reset_joinpoint"><code class="xref py py-meth docutils literal"><span class="pre">Query.reset_joinpoint()</span></code></a>&#x4E5F;&#x4F1A;&#x4ECE;&#x8FC7;&#x6EE4;&#x8C03;&#x7528;&#x4E2D;&#x79FB;&#x9664;&#x201C;&#x522B;&#x540D;&#x201D;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Node</span><span class="p">)</span><span class="o">.</span>\
        <span class="n">join</span><span class="p">(</span><span class="n">Node</span><span class="o">.</span><span class="n">children</span><span class="p">,</span> <span class="n">aliased</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span>\
        <span class="nb">filter</span><span class="p">(</span><span class="n">Node</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s1">&apos;foo&apos;</span><span class="p">)</span><span class="o">.</span>\
        <span class="n">reset_joinpoint</span><span class="p">()</span><span class="o">.</span>\
        <span class="nb">filter</span><span class="p">(</span><span class="n">Node</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s1">&apos;bar&apos;</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-76">&#x6709;&#x5173;&#x4F7F;&#x7528;<a class="reference internal" href="query.html#sqlalchemy.orm.query.Query.join.params.aliased" title="sqlalchemy.orm.query.Query.join"><code class="xref py py-paramref docutils literal"><span class="pre">Query.join.aliased</span></code></a>&#x6CBF;&#x81EA;&#x8FDE;&#x53C2;&#x8003;&#x8282;&#x70B9;&#x94FE;&#x4EFB;&#x610F;&#x8FDE;&#x63A5;&#x7684;&#x793A;&#x4F8B;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a class="reference internal" href="examples.html#examples-xmlpersistence"><span>XML Persistence</span></a>&#x3002;</span></p></div><div class="section" id="configuring-self-referential-eager-loading"><h2><span class="yiyi-st" id="yiyi-77">&#x914D;&#x7F6E;&#x81EA;&#x5F15;&#x7528;&#x9884;&#x52A0;&#x8F7D;<a class="headerlink" href="#configuring-self-referential-eager-loading" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-78">&#x5728;&#x6B63;&#x5E38;&#x7684;&#x67E5;&#x8BE2;&#x64CD;&#x4F5C;&#x671F;&#x95F4;&#xFF0C;&#x4F7F;&#x7528;&#x4ECE;&#x7236;&#x8868;&#x5230;&#x5B50;&#x8868;&#x7684;&#x8FDE;&#x63A5;&#x6216;&#x5916;&#x8FDE;&#x63A5;&#x8FDB;&#x884C;&#x9884;&#x5148;&#x52A0;&#x8F7D;&#x5173;&#x7CFB;&#xFF0C;&#x4ECE;&#x800C;&#x53EF;&#x4EE5;&#x4ECE;&#x5355;&#x4E2A;SQL&#x8BED;&#x53E5;&#x586B;&#x5145;&#x7236;&#x4EE3;&#x53CA;&#x5176;&#x76F4;&#x63A5;&#x5B50;&#x96C6;&#x5408;&#x6216;&#x5F15;&#x7528;&#xFF0C;&#x6216;&#x8005;&#x53EF;&#x4EE5;&#x4E3A;&#x6240;&#x6709;&#x76F4;&#x63A5;&#x5B50;&#x96C6;&#x5408;&#x586B;&#x5145;&#x7B2C;&#x4E8C;&#x4E2A;&#x8BED;&#x53E5;&#x3002;</span><span class="yiyi-st" id="yiyi-79">&#x5728;&#x52A0;&#x5165;&#x76F8;&#x5173;&#x9879;&#x76EE;&#x65F6;&#xFF0C;SQLAlchemy&#x7684;&#x8054;&#x63A5;&#x548C;&#x5B50;&#x67E5;&#x8BE2;&#x9884;&#x52A0;&#x8F7D;&#x5728;&#x6240;&#x6709;&#x60C5;&#x51B5;&#x4E0B;&#x4F7F;&#x7528;&#x522B;&#x540D;&#x8868;&#xFF0C;&#x56E0;&#x6B64;&#x4E0E;&#x81EA;&#x5F15;&#x7528;&#x52A0;&#x5165;&#x517C;&#x5BB9;&#x3002;</span><span class="yiyi-st" id="yiyi-80">&#x4F46;&#x662F;&#xFF0C;&#x4E3A;&#x4E86;&#x4F7F;&#x7528;&#x81EA;&#x5F15;&#x7528;&#x5173;&#x7CFB;&#x8FDB;&#x884C;&#x52A0;&#x8F7D;&#xFF0C;&#x9700;&#x8981;&#x544A;&#x8BC9;SQLAlchemy&#x5E94;&#x8BE5;&#x52A0;&#x5165;&#x548C;/&#x6216;&#x67E5;&#x8BE2;&#x591A;&#x5C11;&#x5C42;&#xFF1B;&#x5426;&#x5219;&#x6025;&#x5207;&#x7684;&#x8D1F;&#x8F7D;&#x5C06;&#x4E0D;&#x4F1A;&#x53D1;&#x751F;&#x3002;</span><span class="yiyi-st" id="yiyi-81">&#x8BE5;&#x6DF1;&#x5EA6;&#x8BBE;&#x7F6E;&#x901A;&#x8FC7;<a class="reference internal" href="mapping_api.html#sqlalchemy.orm.mapper.Mapper.relationships.params.join_depth" title="sqlalchemy.orm.mapper.Mapper.relationships"><code class="xref py py-paramref docutils literal"><span class="pre">join_depth</span></code></a>&#x8FDB;&#x884C;&#x914D;&#x7F6E;&#xFF1A;</span></p><div class="highlight-python+sql"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Node</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;node&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">parent_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;node.id&apos;</span><span class="p">))</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">children</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Node&quot;</span><span class="p">,</span>
                    <span class="n">lazy</span><span class="o">=</span><span class="s2">&quot;joined&quot;</span><span class="p">,</span>
                    <span class="n">join_depth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<a class="sql_link" href="#">sql</a><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Node</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<div class="popup_sql">SELECT node_1.id AS node_1_id,
        node_1.parent_id AS node_1_parent_id,
        node_1.data AS node_1_data,
        node_2.id AS node_2_id,
        node_2.parent_id AS node_2_parent_id,
        node_2.data AS node_2_data,
        node.id AS node_id,
        node.parent_id AS node_parent_id,
        node.data AS node_data
FROM node
    LEFT OUTER JOIN node AS node_2
        ON node.id = node_2.parent_id
    LEFT OUTER JOIN node AS node_1
        ON node_2.id = node_1.parent_id
[]</div></pre></div></div></div>