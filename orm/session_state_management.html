<h1><span class="yiyi-st" id="yiyi-54">&#x72B6;&#x6001;&#x7BA1;&#x7406;<a class="headerlink" href="#state-management" title="Permalink to this headline">&#xB6;</a></span></h1><div class="section" id="quickie-intro-to-object-states"><h2><span class="yiyi-st" id="yiyi-55">Quickie&#x4ECB;&#x7ECD;&#x5BF9;&#x8C61;&#x72B6;&#x6001;<a class="headerlink" href="#quickie-intro-to-object-states" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-56">&#x4E86;&#x89E3;&#x5B9E;&#x4F8B;&#x5728;&#x4F1A;&#x8BDD;&#x4E2D;&#x53EF;&#x4EE5;&#x5177;&#x6709;&#x7684;&#x72B6;&#x6001;&#x5F88;&#x6709;&#x5E2E;&#x52A9;&#xFF1A;</span></p><ul><li><p class="first"><span class="yiyi-st" id="yiyi-57"><strong>Transient</strong>  - &#x4E00;&#x4E2A;&#x4E0D;&#x5728;&#x4F1A;&#x8BDD;&#x4E2D;&#x7684;&#x5B9E;&#x4F8B;&#xFF0C;&#x4E0D;&#x4F1A;&#x4FDD;&#x5B58;&#x5230;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#xFF1B;&#x5373;&#x5B83;&#x6CA1;&#x6709;&#x6570;&#x636E;&#x5E93;&#x8EAB;&#x4EFD;&#x3002;</span><span class="yiyi-st" id="yiyi-58">&#x8FD9;&#x79CD;&#x5BF9;&#x8C61;&#x4E0E;ORM&#x552F;&#x4E00;&#x7684;&#x5173;&#x7CFB;&#x662F;&#x5B83;&#x7684;&#x7C7B;&#x6709;&#x4E00;&#x4E2A;&#x4E0E;&#x5B83;&#x5173;&#x8054;&#x7684;<code class="docutils literal"><span class="pre">mapper()</span></code>&#x3002;</span></p></li><li><p class="first"><span class="yiyi-st" id="yiyi-59"><strong>Pending</strong> - when you <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.add" title="sqlalchemy.orm.session.Session.add"><code class="xref py py-meth docutils literal"><span class="pre">add()</span></code></a> a transient instance, it becomes pending. </span><span class="yiyi-st" id="yiyi-60">&#x5B83;&#x4ECD;&#x7136;&#x6CA1;&#x6709;&#x88AB;&#x5B9E;&#x9645;&#x5237;&#x65B0;&#x5230;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x4F46;&#x5B83;&#x4F1A;&#x5728;&#x4E0B;&#x4E00;&#x6B21;&#x5237;&#x65B0;&#x65F6;&#x53D1;&#x751F;&#x3002;</span></p></li><li><p class="first"><span class="yiyi-st" id="yiyi-61"><strong>&#x6301;&#x4E45;</strong>  - &#x5B58;&#x5728;&#x4E8E;&#x4F1A;&#x8BDD;&#x4E2D;&#x4E14;&#x5728;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x5177;&#x6709;&#x8BB0;&#x5F55;&#x7684;&#x5B9E;&#x4F8B;&#x3002;</span><span class="yiyi-st" id="yiyi-62">&#x901A;&#x8FC7;&#x5237;&#x65B0;&#x6765;&#x83B7;&#x5F97;&#x6301;&#x4E45;&#x6027;&#x5B9E;&#x4F8B;&#xFF0C;&#x4EE5;&#x4FBF;&#x6302;&#x8D77;&#x7684;&#x5B9E;&#x4F8B;&#x53D8;&#x4E3A;&#x6301;&#x4E45;&#x6027;&#xFF0C;&#x6216;&#x901A;&#x8FC7;&#x67E5;&#x8BE2;&#x6570;&#x636E;&#x5E93;&#x67E5;&#x627E;&#x73B0;&#x6709;&#x5B9E;&#x4F8B;&#xFF08;&#x6216;&#x5C06;&#x5176;&#x4ED6;&#x4F1A;&#x8BDD;&#x7684;&#x6301;&#x4E45;&#x5B9E;&#x4F8B;&#x79FB;&#x52A8;&#x5230;&#x672C;&#x5730;&#x4F1A;&#x8BDD;&#x4E2D;&#xFF09;&#x3002;</span></p></li><li><p class="first"><span class="yiyi-st" id="yiyi-63"><strong>&#x5DF2;&#x5220;&#x9664;</strong>  - &#x5728;&#x5237;&#x65B0;&#x4E2D;&#x5DF2;&#x5220;&#x9664;&#x7684;&#x5B9E;&#x4F8B;&#xFF0C;&#x4F46;&#x4E8B;&#x52A1;&#x5C1A;&#x672A;&#x5B8C;&#x6210;&#x3002;</span><span class="yiyi-st" id="yiyi-64">&#x5904;&#x4E8E;&#x8FD9;&#x79CD;&#x72B6;&#x6001;&#x7684;&#x5BF9;&#x8C61;&#x672C;&#x8D28;&#x4E0A;&#x4E0E;&#x201C;&#x6302;&#x8D77;&#x201D;&#x72B6;&#x6001;&#x76F8;&#x53CD;&#xFF1B;&#x5F53;&#x4F1A;&#x8BDD;&#x7684;&#x4E8B;&#x52A1;&#x63D0;&#x4EA4;&#x65F6;&#xFF0C;&#x5BF9;&#x8C61;&#x5C06;&#x79FB;&#x81F3;&#x5206;&#x79BB;&#x72B6;&#x6001;&#x3002;</span><span class="yiyi-st" id="yiyi-65">&#x6216;&#x8005;&#xFF0C;&#x5F53;&#x4F1A;&#x8BDD;&#x7684;&#x4E8B;&#x52A1;&#x56DE;&#x6EDA;&#x65F6;&#xFF0C;&#x88AB;&#x5220;&#x9664;&#x7684;&#x5BF9;&#x8C61;&#x5C06;<em>&#x8FD4;&#x56DE;</em>&#x4E3A;&#x6301;&#x4E45;&#x72B6;&#x6001;&#x3002;</span></p><div class="versionchanged"><p><span class="yiyi-st" id="yiyi-66"><span class="versionmodified">&#x7248;&#x672C;1.1&#x4E2D;&#x5DF2;&#x66F4;&#x6539;&#xFF1A;</span>&#x201C;&#x5DF2;&#x5220;&#x9664;&#x201D;&#x72B6;&#x6001;&#x662F;&#x4E0E;&#x201C;&#x6301;&#x4E45;&#x201D;&#x72B6;&#x6001;&#x4E0D;&#x540C;&#x7684;&#x65B0;&#x6DFB;&#x52A0;&#x7684;&#x4F1A;&#x8BDD;&#x5BF9;&#x8C61;&#x72B6;&#x6001;&#x3002;</span></p></div></li><li><p class="first"><span class="yiyi-st" id="yiyi-67"><strong>Detached</strong>  - &#x4E0E;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x7684;&#x8BB0;&#x5F55;&#x76F8;&#x5BF9;&#x5E94;&#x6216;&#x5148;&#x524D;&#x5BF9;&#x5E94;&#x7684;&#x5B9E;&#x4F8B;&#xFF0C;&#x4F46;&#x5F53;&#x524D;&#x4E0D;&#x5728;&#x4EFB;&#x4F55;&#x4F1A;&#x8BDD;&#x4E2D;&#x3002;</span><span class="yiyi-st" id="yiyi-68">&#x5206;&#x79BB;&#x7684;&#x5BF9;&#x8C61;&#x5C06;&#x5305;&#x542B;&#x6570;&#x636E;&#x5E93;&#x6807;&#x8BC6;&#x6807;&#x8BB0;&#xFF0C;&#x4F46;&#x662F;&#x56E0;&#x4E3A;&#x5B83;&#x4E0E;&#x4F1A;&#x8BDD;&#x6CA1;&#x6709;&#x5173;&#x8054;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x77E5;&#x9053;&#x8BE5;&#x6570;&#x636E;&#x5E93;&#x6807;&#x8BC6;&#x662F;&#x5426;&#x5B9E;&#x9645;&#x5B58;&#x5728;&#x4E8E;&#x76EE;&#x6807;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x3002;</span><span class="yiyi-st" id="yiyi-69">&#x5206;&#x79BB;&#x7684;&#x5BF9;&#x8C61;&#x53EF;&#x4EE5;&#x6B63;&#x5E38;&#x4F7F;&#x7528;&#xFF0C;&#x9664;&#x975E;&#x5B83;&#x4EEC;&#x65E0;&#x6CD5;&#x52A0;&#x8F7D;&#x5148;&#x524D;&#x6807;&#x8BB0;&#x4E3A;&#x201C;&#x5DF2;&#x8FC7;&#x671F;&#x201D;&#x7684;&#x672A;&#x52A0;&#x8F7D;&#x5C5E;&#x6027;&#x6216;&#x5C5E;&#x6027;&#x3002;</span></p></li></ul><p><span class="yiyi-st" id="yiyi-70">&#x8981;&#x6DF1;&#x5165;&#x4E86;&#x89E3;&#x6240;&#x6709;&#x53EF;&#x80FD;&#x7684;&#x72B6;&#x6001;&#x8F6C;&#x6362;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;&#x63CF;&#x8FF0;&#x6BCF;&#x4E2A;&#x8F6C;&#x6362;&#x7684;<a class="reference internal" href="session_events.html#session-lifecycle-events"><span>Object Lifecycle Events</span></a>&#x90E8;&#x5206;&#xFF0C;&#x4EE5;&#x53CA;&#x5982;&#x4F55;&#x4EE5;&#x7F16;&#x7A0B;&#x65B9;&#x5F0F;&#x8DDF;&#x8E2A;&#x6BCF;&#x4E2A;&#x8F6C;&#x6362;&#x3002;</span></p><div class="section" id="getting-the-current-state-of-an-object"><h3><span class="yiyi-st" id="yiyi-71">&#x83B7;&#x53D6;&#x5BF9;&#x8C61;&#x7684;&#x5F53;&#x524D;&#x72B6;&#x6001;<a class="headerlink" href="#getting-the-current-state-of-an-object" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-72">&#x4EFB;&#x4F55;&#x6620;&#x5C04;&#x5BF9;&#x8C61;&#x7684;&#x5B9E;&#x9645;&#x72B6;&#x6001;&#x90FD;&#x53EF;&#x4EE5;&#x5728;&#x4EFB;&#x4F55;&#x65F6;&#x5019;&#x4F7F;&#x7528;<a class="reference internal" href="core_inspection.html#sqlalchemy.inspection.inspect" title="sqlalchemy.inspection.inspect"><code class="xref py py-func docutils literal"><span class="pre">inspect()</span></code></a>&#x7CFB;&#x7EDF;&#x67E5;&#x770B;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">inspect</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">insp</span> <span class="o">=</span> <span class="n">inspect</span><span class="p">(</span><span class="n">my_object</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">insp</span><span class="o">.</span><span class="n">persistent</span>
<span class="go">True</span></pre></div></div><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-73">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p><span class="yiyi-st" id="yiyi-74"><a class="reference internal" href="internals.html#sqlalchemy.orm.state.InstanceState.transient" title="sqlalchemy.orm.state.InstanceState.transient"><code class="xref py py-attr docutils literal"><span class="pre">InstanceState.transient</span></code></a></span></p><p><span class="yiyi-st" id="yiyi-75"><a class="reference internal" href="internals.html#sqlalchemy.orm.state.InstanceState.pending" title="sqlalchemy.orm.state.InstanceState.pending"><code class="xref py py-attr docutils literal"><span class="pre">InstanceState.pending</span></code></a></span></p><p><span class="yiyi-st" id="yiyi-76"><a class="reference internal" href="internals.html#sqlalchemy.orm.state.InstanceState.persistent" title="sqlalchemy.orm.state.InstanceState.persistent"><code class="xref py py-attr docutils literal"><span class="pre">InstanceState.persistent</span></code></a></span></p><p><span class="yiyi-st" id="yiyi-77"><a class="reference internal" href="internals.html#sqlalchemy.orm.state.InstanceState.deleted" title="sqlalchemy.orm.state.InstanceState.deleted"><code class="xref py py-attr docutils literal"><span class="pre">InstanceState.deleted</span></code></a></span></p><p class="last"><span class="yiyi-st" id="yiyi-78"><a class="reference internal" href="internals.html#sqlalchemy.orm.state.InstanceState.detached" title="sqlalchemy.orm.state.InstanceState.detached"><code class="xref py py-attr docutils literal"><span class="pre">InstanceState.detached</span></code></a></span></p></div></div></div><div class="section" id="session-attributes"><h2><span class="yiyi-st" id="yiyi-79">&#x4F1A;&#x8BDD;&#x5C5E;&#x6027;<a class="headerlink" href="#session-attributes" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-80"><a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x672C;&#x8EAB;&#x7684;&#x884C;&#x4E3A;&#x6709;&#x70B9;&#x50CF;&#x96C6;&#x5408;&#x5F0F;&#x96C6;&#x5408;&#x3002;</span><span class="yiyi-st" id="yiyi-81">&#x6240;&#x6709;&#x5B58;&#x5728;&#x7684;&#x9879;&#x76EE;&#x90FD;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x8FED;&#x4EE3;&#x5668;&#x63A5;&#x53E3;&#x8BBF;&#x95EE;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">session</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-82">&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5E38;&#x89C4;&#x7684;&#x201C;&#x5305;&#x542B;&#x201D;&#x8BED;&#x4E49;&#x6D4B;&#x8BD5;&#x5B58;&#x5728;&#x6027;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">session</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Object is present&quot;</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-83">&#x4F1A;&#x8BDD;&#x8FD8;&#x8DDF;&#x8E2A;&#x6240;&#x6709;&#x65B0;&#x521B;&#x5EFA;&#x7684;&#xFF08;&#x5373;&#x6302;&#x8D77;&#x7684;&#xFF09;&#x5BF9;&#x8C61;&#xFF0C;&#x81EA;&#x4E0A;&#x6B21;&#x52A0;&#x8F7D;&#x6216;&#x4FDD;&#x5B58;&#x4E4B;&#x540E;&#x53D1;&#x751F;&#x66F4;&#x6539;&#x7684;&#x6240;&#x6709;&#x5BF9;&#x8C61;&#xFF08;&#x5373;&#x201C;&#x810F;&#x201D;&#xFF09;&#x4EE5;&#x53CA;&#x6807;&#x8BB0;&#x4E3A;&#x5DF2;&#x5220;&#x9664;&#x7684;&#x6240;&#x6709;&#x5BF9;&#x8C61;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># pending objects recently added to the Session</span>
<span class="n">session</span><span class="o">.</span><span class="n">new</span>

<span class="c1"># persistent objects which currently have changes detected</span>
<span class="c1"># (this collection is now created on the fly each time the property is called)</span>
<span class="n">session</span><span class="o">.</span><span class="n">dirty</span>

<span class="c1"># persistent objects that have been marked as deleted via session.delete(obj)</span>
<span class="n">session</span><span class="o">.</span><span class="n">deleted</span>

<span class="c1"># dictionary of all persistent objects, keyed on their</span>
<span class="c1"># identity key</span>
<span class="n">session</span><span class="o">.</span><span class="n">identity_map</span></pre></div></div><p><span class="yiyi-st" id="yiyi-84">(Documentation: <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.new" title="sqlalchemy.orm.session.Session.new"><code class="xref py py-attr docutils literal"><span class="pre">Session.new</span></code></a>, <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.dirty" title="sqlalchemy.orm.session.Session.dirty"><code class="xref py py-attr docutils literal"><span class="pre">Session.dirty</span></code></a>, <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.deleted" title="sqlalchemy.orm.session.Session.deleted"><code class="xref py py-attr docutils literal"><span class="pre">Session.deleted</span></code></a>, <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.identity_map" title="sqlalchemy.orm.session.Session.identity_map"><code class="xref py py-attr docutils literal"><span class="pre">Session.identity_map</span></code></a>).</span></p></div><div class="section" id="session-referencing-behavior"><h2><span class="yiyi-st" id="yiyi-85">&#x4F1A;&#x8BDD;&#x53C2;&#x7167;&#x884C;&#x4E3A;<a class="headerlink" href="#session-referencing-behavior" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-86">&#x4F1A;&#x8BDD;&#x4E2D;&#x7684;&#x5BF9;&#x8C61;&#x662F;<em>&#x5F31;&#x5F15;&#x7528;&#x7684;</em>&#x3002;</span><span class="yiyi-st" id="yiyi-87">&#x8FD9;&#x610F;&#x5473;&#x7740;&#xFF0C;&#x5F53;&#x5B83;&#x4EEC;&#x5728;&#x5916;&#x90E8;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#x53D6;&#x6D88;&#x5F15;&#x7528;&#x65F6;&#xFF0C;&#x5B83;&#x4EEC;&#x4E5F;&#x4F1A;&#x4ECE;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x4E2D;&#x8D85;&#x51FA;&#x8303;&#x56F4;&#xFF0C;&#x5E76;&#x4E14;&#x4F1A;&#x53D7;&#x5230;Python&#x89E3;&#x91CA;&#x5668;&#x7684;&#x5783;&#x573E;&#x56DE;&#x6536;&#x3002;</span><span class="yiyi-st" id="yiyi-88">&#x4F8B;&#x5916;&#x60C5;&#x51B5;&#x5305;&#x62EC;&#x6302;&#x8D77;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x6807;&#x8BB0;&#x4E3A;&#x5DF2;&#x5220;&#x9664;&#x7684;&#x5BF9;&#x8C61;&#x6216;&#x6302;&#x8D77;&#x66F4;&#x6539;&#x7684;&#x6301;&#x4E45;&#x5BF9;&#x8C61;&#x3002;</span><span class="yiyi-st" id="yiyi-89">&#x5B8C;&#x5168;&#x5237;&#x65B0;&#x540E;&#xFF0C;&#x8FD9;&#x4E9B;&#x96C6;&#x5408;&#x5168;&#x90E8;&#x4E3A;&#x7A7A;&#xFF0C;&#x5E76;&#x4E14;&#x6240;&#x6709;&#x5BF9;&#x8C61;&#x90FD;&#x88AB;&#x5F31;&#x5F15;&#x7528;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-90">&#x8981;&#x4F7F;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x4E2D;&#x7684;&#x5BF9;&#x8C61;&#x4FDD;&#x6301;&#x5F3A;&#x5F15;&#x7528;&#x72B6;&#x6001;&#xFF0C;&#x901A;&#x5E38;&#x53EA;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x65B9;&#x6CD5;&#x3002;</span><span class="yiyi-st" id="yiyi-91">&#x5916;&#x90E8;&#x7BA1;&#x7406;&#x7684;&#x5F3A;&#x5F15;&#x7528;&#x884C;&#x4E3A;&#x7684;&#x793A;&#x4F8B;&#x5305;&#x62EC;&#x5C06;&#x5BF9;&#x8C61;&#x52A0;&#x8F7D;&#x5230;&#x4E0E;&#x5176;&#x4E3B;&#x952E;&#x76F8;&#x5173;&#x7684;&#x672C;&#x5730;&#x5B57;&#x5178;&#x4E2D;&#xFF0C;&#x6216;&#x8005;&#x5C06;&#x5BF9;&#x8C61;&#x52A0;&#x8F7D;&#x5230;&#x5B83;&#x4EEC;&#x9700;&#x8981;&#x4FDD;&#x6301;&#x5F15;&#x7528;&#x7684;&#x65F6;&#x95F4;&#x8303;&#x56F4;&#x5185;&#x7684;&#x5217;&#x8868;&#x6216;&#x96C6;&#x5408;&#x4E2D;&#x3002;</span><span class="yiyi-st" id="yiyi-92">&#x5982;&#x679C;&#x9700;&#x8981;&#xFF0C;&#x53EF;&#x4EE5;&#x5C06;&#x8FD9;&#x4E9B;&#x96C6;&#x5408;&#x4E0E;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x5173;&#x8054;&#xFF0C;&#x65B9;&#x6CD5;&#x662F;&#x5C06;&#x5B83;&#x4EEC;&#x653E;&#x5165;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.info" title="sqlalchemy.orm.session.Session.info"><code class="xref py py-attr docutils literal"><span class="pre">Session.info</span></code></a>&#x5B57;&#x5178;&#x4E2D;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-93">&#x57FA;&#x4E8E;&#x4E8B;&#x4EF6;&#x7684;&#x65B9;&#x6CD5;&#x4E5F;&#x662F;&#x53EF;&#x884C;&#x7684;&#x3002;</span><span class="yiyi-st" id="yiyi-94">&#x5F53;&#x6240;&#x6709;&#x5BF9;&#x8C61;&#x4FDD;&#x6301;&#x5728;<a class="reference internal" href="glossary.html#term-persistent"><span class="xref std std-term">persistent</span></a>&#x72B6;&#x6001;&#x65F6;&#xFF0C;&#x4E3A;&#x6240;&#x6709;&#x5BF9;&#x8C61;&#x63D0;&#x4F9B;&#x201C;&#x5F3A;&#x5F15;&#x7528;&#x201D;&#x884C;&#x4E3A;&#x7684;&#x7B80;&#x5355;&#x914D;&#x65B9;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">event</span>

<span class="k">def</span> <span class="nf">strong_reference_session</span><span class="p">(</span><span class="n">session</span><span class="p">):</span>
    <span class="nd">@event.listens_for</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="s2">&quot;pending_to_persistent&quot;</span><span class="p">)</span>
    <span class="nd">@event.listens_for</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="s2">&quot;deleted_to_persistent&quot;</span><span class="p">)</span>
    <span class="nd">@event.listens_for</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="s2">&quot;detached_to_persistent&quot;</span><span class="p">)</span>
    <span class="nd">@event.listens_for</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="s2">&quot;loaded_as_persistent&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">strong_ref_object</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&apos;refs&apos;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sess</span><span class="o">.</span><span class="n">info</span><span class="p">:</span>
            <span class="n">sess</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&apos;refs&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="n">refs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">refs</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&apos;refs&apos;</span><span class="p">]</span>

        <span class="n">refs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>


    <span class="nd">@event.listens_for</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="s2">&quot;persistent_to_detached&quot;</span><span class="p">)</span>
    <span class="nd">@event.listens_for</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="s2">&quot;persistent_to_deleted&quot;</span><span class="p">)</span>
    <span class="nd">@event.listens_for</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="s2">&quot;persistent_to_transient&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">deref_object</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
        <span class="n">sess</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&apos;refs&apos;</span><span class="p">]</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-95">Above, we intercept the <a class="reference internal" href="events.html#sqlalchemy.orm.events.SessionEvents.pending_to_persistent" title="sqlalchemy.orm.events.SessionEvents.pending_to_persistent"><code class="xref py py-meth docutils literal"><span class="pre">SessionEvents.pending_to_persistent()</span></code></a>, <a class="reference internal" href="events.html#sqlalchemy.orm.events.SessionEvents.detached_to_persistent" title="sqlalchemy.orm.events.SessionEvents.detached_to_persistent"><code class="xref py py-meth docutils literal"><span class="pre">SessionEvents.detached_to_persistent()</span></code></a>, <a class="reference internal" href="events.html#sqlalchemy.orm.events.SessionEvents.deleted_to_persistent" title="sqlalchemy.orm.events.SessionEvents.deleted_to_persistent"><code class="xref py py-meth docutils literal"><span class="pre">SessionEvents.deleted_to_persistent()</span></code></a> and <a class="reference internal" href="events.html#sqlalchemy.orm.events.SessionEvents.loaded_as_persistent" title="sqlalchemy.orm.events.SessionEvents.loaded_as_persistent"><code class="xref py py-meth docutils literal"><span class="pre">SessionEvents.loaded_as_persistent()</span></code></a> event hooks in order to intercept objects as they enter the <a class="reference internal" href="glossary.html#term-persistent"><span class="xref std std-term">persistent</span></a> transition, and the <a class="reference internal" href="events.html#sqlalchemy.orm.events.SessionEvents.persistent_to_detached" title="sqlalchemy.orm.events.SessionEvents.persistent_to_detached"><code class="xref py py-meth docutils literal"><span class="pre">SessionEvents.persistent_to_detached()</span></code></a> and <a class="reference internal" href="events.html#sqlalchemy.orm.events.SessionEvents.persistent_to_deleted" title="sqlalchemy.orm.events.SessionEvents.persistent_to_deleted"><code class="xref py py-meth docutils literal"><span class="pre">SessionEvents.persistent_to_deleted()</span></code></a> hooks to intercept objects as they leave the persistent state.</span></p><p><span class="yiyi-st" id="yiyi-96">&#x5BF9;&#x4E8E;&#x4EFB;&#x4F55;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x53EF;&#x4EE5;&#x8C03;&#x7528;&#x4E0A;&#x9762;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x4EE5;&#x4FBF;&#x5728;&#x6BCF;&#x4E2A;&#x4F1A;&#x8BDD;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a></span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">Session</span>

<span class="n">my_session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>
<span class="n">strong_reference_session</span><span class="p">(</span><span class="n">my_session</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-97">&#x5B83;&#x4E5F;&#x53EF;&#x80FD;&#x88AB;&#x4EFB;&#x4F55;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.sessionmaker" title="sqlalchemy.orm.session.sessionmaker"><code class="xref py py-class docutils literal"><span class="pre">sessionmaker</span></code></a>&#x8C03;&#x7528;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">sessionmaker</span>

<span class="n">maker</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">()</span>
<span class="n">strong_reference_session</span><span class="p">(</span><span class="n">maker</span><span class="p">)</span></pre></div></div></div><div class="section" id="merging"><h2><span class="yiyi-st" id="yiyi-98">&#x5408;&#x5E76;<a class="headerlink" href="#merging" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h2><p><span class="yiyi-st" id="yiyi-99"><a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.merge" title="sqlalchemy.orm.session.Session.merge"><code class="xref py py-meth docutils literal"><span class="pre">merge()</span></code></a>&#x4ECE;&#x5916;&#x90E8;&#x5BF9;&#x8C61;&#x5C06;&#x72B6;&#x6001;&#x8F6C;&#x6362;&#x4E3A;&#x4F1A;&#x8BDD;&#x4E2D;&#x65B0;&#x7684;&#x6216;&#x5DF2;&#x5B58;&#x5728;&#x7684;&#x5B9E;&#x4F8B;&#x3002;</span><span class="yiyi-st" id="yiyi-100">&#x5B83;&#x8FD8;&#x5C06;&#x4F20;&#x5165;&#x7684;&#x6570;&#x636E;&#x4E0E;&#x6570;&#x636E;&#x5E93;&#x72B6;&#x6001;&#x8FDB;&#x884C;&#x534F;&#x8C03;&#xFF0C;&#x4EA7;&#x751F;&#x5C06;&#x7528;&#x4E8E;&#x4E0B;&#x4E00;&#x6B21;&#x5237;&#x65B0;&#x7684;&#x5386;&#x53F2;&#x6D41;&#xFF0C;&#x6216;&#x8005;&#x53EF;&#x4EE5;&#x4F7F;&#x5F97;&#x4EA7;&#x751F;&#x72B6;&#x6001;&#x7684;&#x7B80;&#x5355;&#x201C;&#x8F6C;&#x79FB;&#x201D;&#x800C;&#x4E0D;&#x4EA7;&#x751F;&#x66F4;&#x6539;&#x5386;&#x53F2;&#x6216;&#x8BBF;&#x95EE;&#x6570;&#x636E;&#x5E93;&#x3002;</span><span class="yiyi-st" id="yiyi-101">&#x7528;&#x6CD5;&#x5982;&#x4E0B;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">merged_object</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">existing_object</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-102">&#x7ED9;&#x5B9A;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;&#x65F6;&#xFF0C;&#x5B83;&#x9075;&#x5FAA;&#x4EE5;&#x4E0B;&#x6B65;&#x9AA4;&#xFF1A;</span></p><ul><li><p class="first"><span class="yiyi-st" id="yiyi-103">&#x5B83;&#x68C0;&#x67E5;&#x5B9E;&#x4F8B;&#x7684;&#x4E3B;&#x952E;&#x3002;</span><span class="yiyi-st" id="yiyi-104">&#x5982;&#x679C;&#x5B58;&#x5728;&#xFF0C;&#x5B83;&#x4F1A;&#x5C1D;&#x8BD5;&#x5728;&#x672C;&#x5730;&#x6807;&#x8BC6;&#x6620;&#x5C04;&#x4E2D;&#x627E;&#x5230;&#x8BE5;&#x5B9E;&#x4F8B;&#x3002;</span><span class="yiyi-st" id="yiyi-105">&#x5982;&#x679C;<code class="docutils literal"><span class="pre">load=True</span></code>&#x6807;&#x5FD7;&#x5904;&#x4E8E;&#x9ED8;&#x8BA4;&#x72B6;&#x6001;&#xFF0C;&#x5B83;&#x8FD8;&#x4F1A;&#x68C0;&#x67E5;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x662F;&#x5426;&#x5B58;&#x5728;&#x672C;&#x5730;&#x4E3B;&#x952E;&#x3002;</span></p></li><li><p class="first"><span class="yiyi-st" id="yiyi-106">&#x5982;&#x679C;&#x7ED9;&#x5B9A;&#x5B9E;&#x4F8B;&#x6CA1;&#x6709;&#x4E3B;&#x952E;&#xFF0C;&#x6216;&#x8005;&#x5728;&#x7ED9;&#x5B9A;&#x4E3B;&#x952E;&#x65F6;&#x6CA1;&#x6709;&#x627E;&#x5230;&#x5B9E;&#x4F8B;&#xFF0C;&#x5219;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x5B9E;&#x4F8B;&#x3002;</span></p></li><li><p class="first"><span class="yiyi-st" id="yiyi-107">&#x7136;&#x540E;&#x5C06;&#x7ED9;&#x5B9A;&#x5B9E;&#x4F8B;&#x7684;&#x72B6;&#x6001;&#x590D;&#x5236;&#x5230;&#x4F4D;&#x4E8E;/&#x65B0;&#x521B;&#x5EFA;&#x7684;&#x5B9E;&#x4F8B;&#x4E0A;&#x3002;</span><span class="yiyi-st" id="yiyi-108">&#x5BF9;&#x4E8E;&#x6E90;&#x5B9E;&#x4F8B;&#x4E0A;&#x5B58;&#x5728;&#x7684;&#x5C5E;&#x6027;&#xFF0C;&#x8BE5;&#x503C;&#x5C06;&#x4F20;&#x8F93;&#x5230;&#x76EE;&#x6807;&#x5B9E;&#x4F8B;&#x3002;</span><span class="yiyi-st" id="yiyi-109">&#x5BF9;&#x4E8E;&#x6E90;&#x4E0A;&#x4E0D;&#x5B58;&#x5728;&#x7684;&#x6620;&#x5C04;&#x5C5E;&#x6027;&#xFF0C;&#x5C5E;&#x6027;&#x5728;&#x76EE;&#x6807;&#x5B9E;&#x4F8B;&#x4E0A;&#x8FC7;&#x671F;&#xFF0C;&#x653E;&#x5F03;&#x5176;&#x73B0;&#x6709;&#x503C;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-110">&#x5982;&#x679C;<code class="docutils literal"><span class="pre">load=True</span></code>&#x6807;&#x5FD7;&#x4FDD;&#x7559;&#x4E3A;&#x5176;&#x9ED8;&#x8BA4;&#x503C;&#xFF0C;&#x5219;&#x6B64;&#x590D;&#x5236;&#x8FC7;&#x7A0B;&#x5C06;&#x53D1;&#x51FA;&#x4E8B;&#x4EF6;&#x5E76;&#x4E3A;&#x6E90;&#x5BF9;&#x8C61;&#x4E0A;&#x5B58;&#x5728;&#x7684;&#x6BCF;&#x4E2A;&#x5C5E;&#x6027;&#x52A0;&#x8F7D;&#x76EE;&#x6807;&#x5BF9;&#x8C61;&#x7684;&#x5378;&#x8F7D;&#x96C6;&#x5408;&#xFF0C;&#x4EE5;&#x4FBF;&#x53EF;&#x4EE5;&#x8C03;&#x6574;&#x4F20;&#x5165;&#x72B6;&#x6001;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x5B58;&#x5728;&#x4EC0;&#x4E48;&#x3002;</span><span class="yiyi-st" id="yiyi-111">&#x5982;&#x679C;<code class="docutils literal"><span class="pre">load</span></code>&#x4F5C;&#x4E3A;<code class="docutils literal"><span class="pre">False</span></code>&#x4F20;&#x9012;&#xFF0C;&#x5219;&#x4F20;&#x5165;&#x7684;&#x6570;&#x636E;&#x5C06;&#x76F4;&#x63A5;&#x201C;&#x52A0;&#x76D6;&#x201D;&#x800C;&#x4E0D;&#x4F1A;&#x4EA7;&#x751F;&#x4EFB;&#x4F55;&#x5386;&#x53F2;&#x8BB0;&#x5F55;&#x3002;</span></p></li><li><p class="first"><span class="yiyi-st" id="yiyi-112">&#x5982;<code class="docutils literal"><span class="pre">merge</span></code>&#x7EA7;&#x8054;&#x6240;&#x793A;&#xFF08;&#x8BF7;&#x53C2;&#x9605;<a class="reference internal" href="cascades.html#unitofwork-cascades"><span>Cascades</span></a>&#xFF09;&#xFF0C;&#x64CD;&#x4F5C;&#x7EA7;&#x8054;&#x5230;&#x76F8;&#x5173;&#x7684;&#x5BF9;&#x8C61;&#x548C;&#x96C6;&#x5408;&#x3002;</span></p></li><li><p class="first"><span class="yiyi-st" id="yiyi-113">&#x65B0;&#x5B9E;&#x4F8B;&#x8FD4;&#x56DE;&#x3002;</span></p></li></ul><p><span class="yiyi-st" id="yiyi-114">&#x4F7F;&#x7528;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.merge" title="sqlalchemy.orm.session.Session.merge"><code class="xref py py-meth docutils literal"><span class="pre">merge()</span></code></a>&#x65F6;&#xFF0C;&#x7ED9;&#x5B9A;&#x7684;&#x201C;&#x6E90;&#x201D;&#x5B9E;&#x4F8B;&#x4E0D;&#x4F1A;&#x88AB;&#x4FEE;&#x6539;&#xFF0C;&#x4E5F;&#x4E0D;&#x4F1A;&#x4E0E;&#x76EE;&#x6807;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x5173;&#x8054;&#xFF0C;&#x5E76;&#x4E14;&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x4E0E;&#x4EFB;&#x4F55;&#x6570;&#x91CF;&#x7684;&#x5176;&#x4ED6;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x5BF9;&#x8C61;&#x3002;</span><span class="yiyi-st" id="yiyi-115"><a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.merge" title="sqlalchemy.orm.session.Session.merge"><code class="xref py py-meth docutils literal"><span class="pre">merge()</span></code></a> is useful for taking the state of any kind of object structure without regard for its origins or current session associations and copying its state into a new session. </span><span class="yiyi-st" id="yiyi-116">&#x8FD9;&#x91CC;&#x6709;&#x4E00;&#x4E9B;&#x4F8B;&#x5B50;&#xFF1A;</span></p><ul><li><p class="first"><span class="yiyi-st" id="yiyi-117">&#x4ECE;&#x6587;&#x4EF6;&#x8BFB;&#x53D6;&#x5BF9;&#x8C61;&#x7ED3;&#x6784;&#x5E76;&#x5E0C;&#x671B;&#x5C06;&#x5176;&#x4FDD;&#x5B58;&#x5230;&#x6570;&#x636E;&#x5E93;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x53EF;&#x80FD;&#x89E3;&#x6790;&#x6587;&#x4EF6;&#xFF0C;&#x6784;&#x5EFA;&#x7ED3;&#x6784;&#xFF0C;&#x7136;&#x540E;&#x4F7F;&#x7528;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.merge" title="sqlalchemy.orm.session.Session.merge"><code class="xref py py-meth docutils literal"><span class="pre">merge()</span></code></a>&#x5C06;&#x5176;&#x4FDD;&#x5B58;&#x5230;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#xFF0C;&#x4EE5;&#x786E;&#x4FDD;&#x8BE5;&#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x7528;&#x4E8E;&#x5F62;&#x6210;&#x7ED3;&#x6784;&#x4E2D;&#x6BCF;&#x4E2A;&#x5143;&#x7D20;&#x7684;&#x4E3B;&#x952E;&#x3002;</span><span class="yiyi-st" id="yiyi-118">&#x4E4B;&#x540E;&#xFF0C;&#x5F53;&#x6587;&#x4EF6;&#x53D1;&#x751F;&#x53D8;&#x5316;&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x91CD;&#x65B0;&#x8FD0;&#x884C;&#x76F8;&#x540C;&#x7684;&#x8FDB;&#x7A0B;&#xFF0C;&#x4EA7;&#x751F;&#x7A0D;&#x5FAE;&#x4E0D;&#x540C;&#x7684;&#x5BF9;&#x8C61;&#x7ED3;&#x6784;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x6B21;<code class="docutils literal"><span class="pre">merged</span></code>&#xFF0C;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x5C06;&#x4F1A;&#x81EA;&#x52A8;&#x66F4;&#x65B0;&#x6570;&#x636E;&#x5E93;&#x4EE5;&#x53CD;&#x6620;&#x8FD9;&#x4E9B;&#x66F4;&#x6539;&#xFF0C;&#x4F7F;&#x7528;&#x4E3B;&#x952E;&#x4ECE;&#x6570;&#x636E;&#x5E93;&#x52A0;&#x8F7D;&#x6BCF;&#x4E2A;&#x5BF9;&#x8C61;&#xFF0C;&#x7136;&#x540E;&#x4F7F;&#x7528;&#x7ED9;&#x5B9A;&#x7684;&#x65B0;&#x72B6;&#x6001;&#x66F4;&#x65B0;&#x5176;&#x72B6;&#x6001;&#x3002;</span></p></li><li><p class="first"><span class="yiyi-st" id="yiyi-119">&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6B63;&#x5728;&#x5C06;&#x5BF9;&#x8C61;&#x5B58;&#x50A8;&#x5728;&#x5185;&#x5B58;&#x7F13;&#x5B58;&#x4E2D;&#xFF0C;&#x5E76;&#x540C;&#x65F6;&#x88AB;&#x8BB8;&#x591A;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x5BF9;&#x8C61;&#x5171;&#x4EAB;&#x3002;</span><span class="yiyi-st" id="yiyi-120"><a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.merge" title="sqlalchemy.orm.session.Session.merge"><code class="xref py py-meth docutils literal"><span class="pre">merge()</span></code></a> is used each time an object is retrieved from the cache to create a local copy of it in each <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a> which requests it. </span><span class="yiyi-st" id="yiyi-121">&#x7F13;&#x5B58;&#x7684;&#x5BF9;&#x8C61;&#x4FDD;&#x6301;&#x5206;&#x79BB;&#x72B6;&#x6001;&#xFF1B;&#x53EA;&#x6709;&#x5B83;&#x7684;&#x72B6;&#x6001;&#x88AB;&#x79FB;&#x52A8;&#x5230;&#x672C;&#x8EAB;&#x5BF9;&#x4E2A;&#x4EBA;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x5BF9;&#x8C61;&#x672C;&#x5730;&#x7684;&#x526F;&#x672C;&#x4E2D;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-122">&#x5728;&#x7F13;&#x5B58;&#x7528;&#x4F8B;&#x4E2D;&#xFF0C;&#x901A;&#x5E38;&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">load=False</span></code>&#x6807;&#x5FD7;&#x6765;&#x6D88;&#x9664;&#x534F;&#x8C03;&#x5BF9;&#x8C61;&#x72B6;&#x6001;&#x4E0E;&#x6570;&#x636E;&#x5E93;&#x7684;&#x5F00;&#x9500;&#x3002;</span><span class="yiyi-st" id="yiyi-123">&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x540D;&#x4E3A;<a class="reference internal" href="query.html#sqlalchemy.orm.query.Query.merge_result" title="sqlalchemy.orm.query.Query.merge_result"><code class="xref py py-meth docutils literal"><span class="pre">merge_result()</span></code></a>&#x7684;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.merge" title="sqlalchemy.orm.session.Session.merge"><code class="xref py py-meth docutils literal"><span class="pre">merge()</span></code></a>&#x7684;&#x201C;&#x6279;&#x91CF;&#x201D;&#x7248;&#x672C;&#xFF0C;&#x8BBE;&#x8BA1;&#x7528;&#x4E8E;&#x4E0E;&#x7F13;&#x5B58;&#x6269;&#x5C55;&#x7684;<a class="reference internal" href="query.html#sqlalchemy.orm.query.Query" title="sqlalchemy.orm.query.Query"><code class="xref py py-class docutils literal"><span class="pre">Query</span></code></a>&#x5BF9;&#x8C61;&#x4E00;&#x8D77;&#x4F7F;&#x7528; - &#x8BF7;&#x53C2;&#x9605;section <a class="reference internal" href="examples.html#examples-caching"><span>Dogpile Caching</span></a>&#x3002;</span></p></li><li><p class="first"><span class="yiyi-st" id="yiyi-124">&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x60F3;&#x8981;&#x5C06;&#x4E00;&#x7CFB;&#x5217;&#x5BF9;&#x8C61;&#x7684;&#x72B6;&#x6001;&#x8F6C;&#x6362;&#x4E3A;&#x7531;&#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;&#x6216;&#x5176;&#x4ED6;&#x5E76;&#x53D1;&#x7CFB;&#x7EDF;&#x7EF4;&#x62A4;&#x7684;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x3002;</span><span class="yiyi-st" id="yiyi-125"><a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.merge" title="sqlalchemy.orm.session.Session.merge"><code class="xref py py-meth docutils literal"><span class="pre">merge()</span></code></a> makes a copy of each object to be placed into this new <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>. </span><span class="yiyi-st" id="yiyi-126">&#x5728;&#x64CD;&#x4F5C;&#x7ED3;&#x675F;&#x65F6;&#xFF0C;&#x7236;&#x7EBF;&#x7A0B;/&#x8FDB;&#x7A0B;&#x7EF4;&#x62A4;&#x5B83;&#x6240;&#x542F;&#x52A8;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x5E76;&#x4E14;&#x7EBF;&#x7A0B;/&#x5DE5;&#x4F5C;&#x8005;&#x53EF;&#x4EE5;&#x7EE7;&#x7EED;&#x5904;&#x7406;&#x8FD9;&#x4E9B;&#x5BF9;&#x8C61;&#x7684;&#x672C;&#x5730;&#x526F;&#x672C;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-127">&#x5728;&#x201C;&#x7EBF;&#x7A0B;/&#x8FDB;&#x7A0B;&#x4E4B;&#x95F4;&#x7684;&#x4F20;&#x8F93;&#x201D;&#x7528;&#x4F8B;&#x4E2D;&#xFF0C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x53EF;&#x80FD;&#x4E5F;&#x5E0C;&#x671B;&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">load=False</span></code>&#x6807;&#x5FD7;&#x4EE5;&#x907F;&#x514D;&#x6570;&#x636E;&#x4F20;&#x8F93;&#x65F6;&#x51FA;&#x73B0;&#x5F00;&#x9500;&#x548C;&#x5197;&#x4F59;SQL&#x67E5;&#x8BE2;&#x3002;</span></p></li></ul><div class="section" id="merge-tips"><h3><span class="yiyi-st" id="yiyi-128">&#x5408;&#x5E76;&#x63D0;&#x793A;<a class="headerlink" href="#merge-tips" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-129"><a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.merge" title="sqlalchemy.orm.session.Session.merge"><code class="xref py py-meth docutils literal"><span class="pre">merge()</span></code></a> is an extremely useful method for many purposes. </span><span class="yiyi-st" id="yiyi-130">&#x7136;&#x800C;&#xFF0C;&#x5B83;&#x5904;&#x7406;&#x77AC;&#x6001;/&#x5206;&#x79BB;&#x5BF9;&#x8C61;&#x4E0E;&#x6301;&#x4E45;&#x5BF9;&#x8C61;&#x4E4B;&#x95F4;&#x9519;&#x7EFC;&#x590D;&#x6742;&#x7684;&#x8FB9;&#x754C;&#xFF0C;&#x4EE5;&#x53CA;&#x72B6;&#x6001;&#x7684;&#x81EA;&#x52A8;&#x4F20;&#x8F93;&#x3002;</span><span class="yiyi-st" id="yiyi-131">&#x53EF;&#x4EE5;&#x5728;&#x8FD9;&#x91CC;&#x5448;&#x73B0;&#x7684;&#x5404;&#x79CD;&#x5404;&#x6837;&#x7684;&#x573A;&#x666F;&#x901A;&#x5E38;&#x9700;&#x8981;&#x5BF9;&#x5BF9;&#x8C61;&#x72B6;&#x6001;&#x66F4;&#x8C28;&#x614E;&#x7684;&#x65B9;&#x6CD5;&#x3002;</span><span class="yiyi-st" id="yiyi-132">&#x5408;&#x5E76;&#x7684;&#x5E38;&#x89C1;&#x95EE;&#x9898;&#x901A;&#x5E38;&#x6D89;&#x53CA;&#x6709;&#x5173;&#x4F20;&#x9012;&#x7ED9;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.merge" title="sqlalchemy.orm.session.Session.merge"><code class="xref py py-meth docutils literal"><span class="pre">merge()</span></code></a>&#x7684;&#x5BF9;&#x8C61;&#x7684;&#x4E00;&#x4E9B;&#x610F;&#x60F3;&#x4E0D;&#x5230;&#x7684;&#x72B6;&#x6001;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-133">&#x8BA9;&#x6211;&#x4EEC;&#x4F7F;&#x7528;User&#x548C;Address&#x5BF9;&#x8C61;&#x7684;&#x89C4;&#x8303;&#x4F8B;&#x5B50;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;user&apos;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">addresses</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Address&quot;</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Address</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;address&apos;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">email_address</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;user.id&apos;</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-134">&#x5047;&#x8BBE;<code class="docutils literal"><span class="pre">User</span></code>&#x5BF9;&#x8C61;&#x5177;&#x6709;&#x4E00;&#x4E2A;<code class="docutils literal"><span class="pre">Address</span></code>&#xFF0C;&#x5B83;&#x5DF2;&#x7ECF;&#x662F;&#x6301;&#x4E45;&#x7684;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">u1</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&apos;ed&apos;</span><span class="p">,</span> <span class="n">addresses</span><span class="o">=</span><span class="p">[</span><span class="n">Address</span><span class="p">(</span><span class="n">email_address</span><span class="o">=</span><span class="s1">&apos;ed@ed.com&apos;</span><span class="p">)])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></pre></div></div><p><span class="yiyi-st" id="yiyi-135">&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x521B;&#x5EFA;<code class="docutils literal"><span class="pre">a1</span></code>&#xFF0C;&#x4E00;&#x4E2A;&#x4F1A;&#x8BDD;&#x4E4B;&#x5916;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x6211;&#x4EEC;&#x8981;&#x5728;&#x73B0;&#x6709;&#x7684;<code class="docutils literal"><span class="pre">Address</span></code>&#x4E4B;&#x4E0A;&#x5408;&#x5E76;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">existing_a1</span> <span class="o">=</span> <span class="n">u1</span><span class="o">.</span><span class="n">addresses</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a1</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">existing_a1</span><span class="o">.</span><span class="n">id</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-136">&#x5982;&#x679C;&#x6211;&#x4EEC;&#x8FD9;&#x6837;&#x8BF4;&#xFF0C;&#x4F1A;&#x53D1;&#x751F;&#x4E00;&#x4E2A;&#x60CA;&#x559C;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a1</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">u1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a1</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="go">sqlalchemy.orm.exc.FlushError: New instance &lt;Address at 0x1298f50&gt;</span>
<span class="go">with identity key (&lt;class &apos;__main__.Address&apos;&gt;, (1,)) conflicts with</span>
<span class="go">persistent instance &lt;Address at 0x12a25d0&gt;</span></pre></div></div><p><span class="yiyi-st" id="yiyi-137">&#x8FD9;&#x662F;&#x4E3A;&#x4EC0;&#x4E48; &#xFF1F;</span><span class="yiyi-st" id="yiyi-138">&#x6211;&#x4EEC;&#x6CA1;&#x6709;&#x6CE8;&#x610F;&#x5230;&#x6211;&#x4EEC;&#x7684;&#x7011;&#x5E03;&#x3002;</span><span class="yiyi-st" id="yiyi-139">&#x5C06;<code class="docutils literal"><span class="pre">a1.user</span></code>&#x8D4B;&#x503C;&#x7ED9;&#x7EA7;&#x8054;&#x5230;<code class="docutils literal"><span class="pre">User.addresses</span></code>&#x7684;backref&#x7684;&#x6301;&#x4E45;&#x5BF9;&#x8C61;&#xFF0C;&#x5E76;&#x4F7F;&#x6211;&#x4EEC;&#x7684;<code class="docutils literal"><span class="pre">a1</span></code>&#x5BF9;&#x8C61;&#x5904;&#x4E8E;&#x6302;&#x8D77;&#x72B6;&#x6001;&#xFF0C;&#x5C31;&#x597D;&#x50CF;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x6DFB;&#x52A0;&#x5B83;&#x3002;</span><span class="yiyi-st" id="yiyi-140">&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x5728;&#x4F1A;&#x8BDD;&#x4E2D;&#x6709;<em>&#x4E24;&#x4E2A;</em> <code class="docutils literal"><span class="pre">Address</span></code>&#x5BF9;&#x8C61;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a1</span> <span class="o">=</span> <span class="n">Address</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a1</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">u1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a1</span> <span class="ow">in</span> <span class="n">session</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">existing_a1</span> <span class="ow">in</span> <span class="n">session</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a1</span> <span class="ow">is</span> <span class="n">existing_a1</span>
<span class="go">False</span></pre></div></div><p><span class="yiyi-st" id="yiyi-141">&#x4E0A;&#x9762;&#xFF0C;&#x6211;&#x4EEC;&#x7684;<code class="docutils literal"><span class="pre">a1</span></code>&#x5728;&#x4F1A;&#x8BDD;&#x4E2D;&#x5DF2;&#x7ECF;&#x6302;&#x8D77;&#x3002;</span><span class="yiyi-st" id="yiyi-142">&#x968F;&#x540E;&#x7684;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.merge" title="sqlalchemy.orm.session.Session.merge"><code class="xref py py-meth docutils literal"><span class="pre">merge()</span></code></a>&#x64CD;&#x4F5C;&#x672C;&#x8D28;&#x4E0A;&#x4EC0;&#x4E48;&#x90FD;&#x4E0D;&#x505A;&#x3002;</span><span class="yiyi-st" id="yiyi-143">Cascade can be configured via the <a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.cascade" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">cascade</span></code></a> option on <a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>, although in this case it would mean removing the <code class="docutils literal"><span class="pre">save-update</span></code> cascade from the <code class="docutils literal"><span class="pre">User.addresses</span></code> relationship - and usually, that behavior is extremely convenient. </span><span class="yiyi-st" id="yiyi-144">The solution here would usually be to not assign <code class="docutils literal"><span class="pre">a1.user</span></code> to an object already persistent in the target session.</span></p><p><span class="yiyi-st" id="yiyi-145"><a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#x7684;<code class="docutils literal"><span class="pre">cascade_backrefs=False</span></code>&#x9009;&#x9879;&#x4E5F;&#x5C06;&#x963B;&#x6B62;<code class="docutils literal"><span class="pre">Address</span></code>&#x901A;&#x8FC7;<code class="docutils literal"><span class="pre">a1&#x6DFB;&#x52A0;&#x5230;&#x4F1A;&#x8BDD;&#x4E2D;.user</span> <span class="pre">=</span> <span class="pre">u1</span></code>&#x5206;&#x914D;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-146">&#x5173;&#x4E8E;&#x7EA7;&#x8054;&#x64CD;&#x4F5C;&#x7684;&#x66F4;&#x591A;&#x7EC6;&#x8282;&#x5728;<a class="reference internal" href="cascades.html#unitofwork-cascades"><span>Cascades</span></a>&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-147">&#x610F;&#x5916;&#x72B6;&#x6001;&#x7684;&#x53E6;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a1</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">existing_a1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="n">u1</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">a1</span><span class="o">.</span><span class="n">user</span> <span class="ow">is</span> <span class="bp">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="bp">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a1</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="go">sqlalchemy.exc.IntegrityError: (IntegrityError) address.user_id</span>
<span class="go">may not be NULL</span></pre></div></div><p><span class="yiyi-st" id="yiyi-148">&#x5728;&#x8FD9;&#x91CC;&#xFF0C;&#x6211;&#x4EEC;&#x8BBF;&#x95EE;&#x4E86;a1.user&#xFF0C;&#x5B83;&#x8FD4;&#x56DE;&#x4E86;&#x9ED8;&#x8BA4;&#x503C;<code class="docutils literal"><span class="pre">None</span></code>&#xFF0C;&#x5B83;&#x4F5C;&#x4E3A;&#x8FD9;&#x4E2A;&#x8BBF;&#x95EE;&#x7684;&#x7ED3;&#x679C;&#x653E;&#x5728;&#x6211;&#x4EEC;&#x5BF9;&#x8C61;&#x7684;<code class="docutils literal"><span class="pre">__dict__</span></code>&#x4E2D;<code class="docutils literal"><span class="pre">a1</span></code></span><span class="yiyi-st" id="yiyi-149">&#x901A;&#x5E38;&#xFF0C;&#x6B64;&#x64CD;&#x4F5C;&#x4E0D;&#x4F1A;&#x521B;&#x5EFA;&#x66F4;&#x6539;&#x4E8B;&#x4EF6;&#xFF0C;&#x56E0;&#x6B64;&#x5728;&#x5237;&#x65B0;&#x8FC7;&#x7A0B;&#x4E2D;<code class="docutils literal"><span class="pre">user_id</span></code>&#x5C5E;&#x6027;&#x4F18;&#x5148;&#x3002;</span><span class="yiyi-st" id="yiyi-150">&#x4F46;&#x662F;&#x5F53;&#x6211;&#x4EEC;&#x5C06;<code class="docutils literal"><span class="pre">Address</span></code>&#x5BF9;&#x8C61;&#x5408;&#x5E76;&#x5230;&#x4F1A;&#x8BDD;&#x4E2D;&#x65F6;&#xFF0C;&#x64CD;&#x4F5C;&#x7B49;&#x540C;&#x4E8E;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">existing_a1</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">existing_a1</span><span class="o">.</span><span class="n">id</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">existing_a1</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">u1</span><span class="o">.</span><span class="n">id</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">existing_a1</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="bp">None</span></pre></div></div><p><span class="yiyi-st" id="yiyi-151">Where above, both <code class="docutils literal"><span class="pre">user_id</span></code> and <code class="docutils literal"><span class="pre">user</span></code> are assigned to, and change events are emitted for both. </span><span class="yiyi-st" id="yiyi-152"><code class="docutils literal"><span class="pre">user</span></code>&#x5173;&#x8054;&#x4F18;&#x5148;&#xFF0C;&#x800C;None&#x5E94;&#x7528;&#x4E8E;<code class="docutils literal"><span class="pre">user_id</span></code>&#xFF0C;&#x5BFC;&#x81F4;&#x5931;&#x8D25;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-153">&#x5927;&#x591A;&#x6570;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.merge" title="sqlalchemy.orm.session.Session.merge"><code class="xref py py-meth docutils literal"><span class="pre">merge()</span></code></a>&#x95EE;&#x9898;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x9996;&#x5148;&#x68C0;&#x67E5;&#x6765;&#x68C0;&#x67E5; - &#x4F1A;&#x8BDD;&#x4E2D;&#x7684;&#x5BF9;&#x8C61;&#x662F;&#x5426;&#x8FC7;&#x65E9;&#xFF1F;</span></p><div class="highlight-python+sql"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">a1</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">existing_a1</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">assert</span> <span class="n">a1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">session</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a1</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-154">&#x6216;&#x8005;&#x5728;&#x5BF9;&#x8C61;&#x4E0A;&#x6709;&#x6211;&#x4EEC;&#x4E0D;&#x60F3;&#x8981;&#x7684;&#x72B6;&#x6001;&#xFF1F;</span><span class="yiyi-st" id="yiyi-155">&#x68C0;&#x67E5;<code class="docutils literal"><span class="pre">__dict__</span></code>&#x662F;&#x68C0;&#x67E5;&#x4EE5;&#x4E0B;&#x5185;&#x5BB9;&#x7684;&#x5FEB;&#x901F;&#x65B9;&#x6CD5;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a1</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">existing_a1</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a1</span><span class="o">.</span><span class="n">user</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a1</span><span class="o">.</span><span class="n">__dict__</span>
<span class="go">{&apos;_sa_instance_state&apos;: &lt;sqlalchemy.orm.state.InstanceState object at 0x1298d10&gt;,</span>
<span class="go">    &apos;user_id&apos;: 1,</span>
<span class="go">    &apos;id&apos;: 1,</span>
<span class="go">    &apos;user&apos;: None}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># we don&apos;t want user=None merged, remove it</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">a1</span><span class="o">.</span><span class="n">user</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a1</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># success</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></pre></div></div></div></div><div class="section" id="expunging"><h2><span class="yiyi-st" id="yiyi-156">&#x6E05;&#x9664;&#x65E5;&#x671F;<a class="headerlink" href="#expunging" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h2><p><span class="yiyi-st" id="yiyi-157">&#x6E05;&#x9664;&#x4ECE;&#x4F1A;&#x8BDD;&#x4E2D;&#x5220;&#x9664;&#x5BF9;&#x8C61;&#xFF0C;&#x5C06;&#x6301;&#x4E45;&#x5B9E;&#x4F8B;&#x53D1;&#x9001;&#x5230;&#x5206;&#x79BB;&#x72B6;&#x6001;&#xFF0C;&#x5E76;&#x5C06;&#x5F85;&#x5904;&#x7406;&#x5B9E;&#x4F8B;&#x53D1;&#x9001;&#x5230;&#x77AC;&#x6001;&#xFF1A;</span></p><div class="highlight-python+sql"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">expunge</span><span class="p">(</span><span class="n">obj1</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-158">&#x8981;&#x5220;&#x9664;&#x6240;&#x6709;&#x9879;&#x76EE;&#xFF0C;&#x8BF7;&#x8C03;&#x7528;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.expunge_all" title="sqlalchemy.orm.session.Session.expunge_all"><code class="xref py py-meth docutils literal"><span class="pre">expunge_all()</span></code></a>&#xFF08;&#x6B64;&#x65B9;&#x6CD5;&#x4EE5;&#x524D;&#x79F0;&#x4E3A;<code class="docutils literal"><span class="pre">clear()</span></code>&#xFF09;&#x3002;</span></p></div><div class="section" id="refreshing-expiring"><h2><span class="yiyi-st" id="yiyi-159">&#x5237;&#x65B0;/&#x8FC7;&#x671F;<a class="headerlink" href="#refreshing-expiring" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-160"><a class="reference internal" href="glossary.html#term-expiring"><span class="xref std std-term">Expiring</span></a>&#x610F;&#x5473;&#x7740;&#x4FDD;&#x5B58;&#x5728;&#x4E00;&#x7CFB;&#x5217;&#x5BF9;&#x8C61;&#x5C5E;&#x6027;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x5E93;&#x6301;&#x4E45;&#x6570;&#x636E;&#x88AB;&#x5220;&#x9664;&#xFF0C;&#x8FD9;&#x6837;&#x5F53;&#x4E0B;&#x6B21;&#x8BBF;&#x95EE;&#x8FD9;&#x4E9B;&#x5C5E;&#x6027;&#x65F6;&#xFF0C;&#x5C31;&#x4F1A;&#x53D1;&#x51FA;&#x4E00;&#x4E2A;SQL&#x67E5;&#x8BE2;&#xFF0C;&#x5B83;&#x5C06;&#x5237;&#x65B0;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-161">&#x5F53;&#x6211;&#x4EEC;&#x8C08;&#x8BBA;&#x6570;&#x636E;&#x5230;&#x671F;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x5E38;&#x4F1A;&#x8C08;&#x8BBA;&#x5904;&#x4E8E;<a class="reference internal" href="glossary.html#term-persistent"><span class="xref std std-term">persistent</span></a>&#x72B6;&#x6001;&#x7684;&#x5BF9;&#x8C61;&#x3002;</span><span class="yiyi-st" id="yiyi-162">&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x52A0;&#x8F7D;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x5982;&#x4E0B;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">user</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&apos;user1&apos;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span></pre></div></div><p><span class="yiyi-st" id="yiyi-163">&#x4E0A;&#x9762;&#x7684;<code class="docutils literal"><span class="pre">User</span></code>&#x5BF9;&#x8C61;&#x662F;&#x6301;&#x4E45;&#x7684;&#xFF0C;&#x5E76;&#x4E14;&#x6709;&#x4E00;&#x7CFB;&#x5217;&#x5C5E;&#x6027;&#x5B58;&#x5728;&#xFF1B;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x8981;&#x67E5;&#x770B;&#x5B83;&#x7684;<code class="docutils literal"><span class="pre">__dict__</span></code>&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x770B;&#x5230;&#x52A0;&#x8F7D;&#x72B6;&#x6001;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">__dict__</span>
<span class="go">{</span>
<span class="go">  &apos;id&apos;: 1, &apos;name&apos;: u&apos;user1&apos;,</span>
<span class="go">  &apos;_sa_instance_state&apos;: &lt;...&gt;,</span>
<span class="go">}</span></pre></div></div><p><span class="yiyi-st" id="yiyi-164">&#x5176;&#x4E2D;<code class="docutils literal"><span class="pre">id</span></code>&#x548C;<code class="docutils literal"><span class="pre">name</span></code>&#x6307;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x7684;&#x90A3;&#x4E9B;&#x5217;&#x3002;</span><span class="yiyi-st" id="yiyi-165"><code class="docutils literal"><span class="pre">_sa_instance_state</span></code>&#x662F;SQLAlchemy&#x5185;&#x90E8;&#x4F7F;&#x7528;&#x7684;&#x975E;&#x6570;&#x636E;&#x5E93;&#x6301;&#x4E45;&#x5316;&#x503C;&#xFF08;&#x5B83;&#x6307;&#x5411;&#x5B9E;&#x4F8B;&#x7684;<a class="reference internal" href="internals.html#sqlalchemy.orm.state.InstanceState" title="sqlalchemy.orm.state.InstanceState"><code class="xref py py-class docutils literal"><span class="pre">InstanceState</span></code></a>&#xFF09;&#x3002;</span><span class="yiyi-st" id="yiyi-166">&#x867D;&#x7136;&#x4E0E;&#x672C;&#x8282;&#x4E0D;&#x76F4;&#x63A5;&#x76F8;&#x5173;&#xFF0C;&#x4F46;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x4E86;&#x89E3;&#x5B83;&#xFF0C;&#x6211;&#x4EEC;&#x5E94;&#x8BE5;&#x4F7F;&#x7528;<a class="reference internal" href="core_inspection.html#sqlalchemy.inspection.inspect" title="sqlalchemy.inspection.inspect"><code class="xref py py-func docutils literal"><span class="pre">inspect()</span></code></a>&#x51FD;&#x6570;&#x6765;&#x8BBF;&#x95EE;&#x5B83;&#xFF09;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-167">&#x6B64;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x7684;<code class="docutils literal"><span class="pre">User</span></code>&#x5BF9;&#x8C61;&#x4E2D;&#x7684;&#x72B6;&#x6001;&#x4E0E;&#x52A0;&#x8F7D;&#x7684;&#x6570;&#x636E;&#x5E93;&#x884C;&#x7684;&#x72B6;&#x6001;&#x5339;&#x914D;&#x3002;</span><span class="yiyi-st" id="yiyi-168">&#x4F46;&#x662F;&#x5728;&#x4F7F;&#x7528;&#x8BF8;&#x5982;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.expire" title="sqlalchemy.orm.session.Session.expire"><code class="xref py py-meth docutils literal"><span class="pre">Session.expire()</span></code></a>&#x4E4B;&#x7C7B;&#x7684;&#x65B9;&#x6CD5;&#x4F7F;&#x5BF9;&#x8C61;&#x8FC7;&#x671F;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x770B;&#x5230;&#x72B6;&#x6001;&#x88AB;&#x5220;&#x9664;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">expire</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">__dict__</span>
<span class="go">{&apos;_sa_instance_state&apos;: &lt;...&gt;}</span></pre></div></div><p><span class="yiyi-st" id="yiyi-169">&#x6211;&#x4EEC;&#x770B;&#x5230;&#xFF0C;&#x867D;&#x7136;&#x5185;&#x90E8;&#x201C;&#x72B6;&#x6001;&#x201D;&#x4ECD;&#x7136;&#x5B58;&#x5728;&#xFF0C;&#x4F46;&#x4E0E;<code class="docutils literal"><span class="pre">id</span></code>&#x548C;<code class="docutils literal"><span class="pre">name</span></code>&#x5217;&#x5BF9;&#x5E94;&#x7684;&#x503C;&#x5DF2;&#x6D88;&#x5931;&#x3002;</span><span class="yiyi-st" id="yiyi-170">&#x5982;&#x679C;&#x6211;&#x4EEC;&#x8981;&#x8BBF;&#x95EE;&#x8FD9;&#x4E9B;&#x5217;&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x5E76;&#x4E14;&#x6B63;&#x5728;&#x89C2;&#x5BDF;SQL&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x770B;&#x5230;&#xFF1A;</span></p><div class="highlight-python+sql"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<div class="show_sql">SELECT user.id AS user_id, user.name AS user_name
FROM user
WHERE user.id = ?
(1,)
</div><span class="n">user1</span></pre></div></div><p><span class="yiyi-st" id="yiyi-171">&#x4EE5;&#x4E0A;&#xFF0C;&#x5728;&#x8BBF;&#x95EE;&#x8FC7;&#x671F;&#x5C5E;&#x6027;<code class="docutils literal"><span class="pre">user.name</span></code>&#x65F6;&#xFF0C;ORM&#x901A;&#x8FC7;&#x53D1;&#x51FA;&#x7528;&#x6237;&#x884C;&#x7684;SELECT&#x6765;&#x542F;&#x52A8;<a class="reference internal" href="glossary.html#term-lazy-load"><span class="xref std std-term">lazy load</span></a>&#x4EE5;&#x4ECE;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x68C0;&#x7D22;&#x6700;&#x65B0;&#x72B6;&#x6001;&#x8FD9;&#x4E2A;&#x7528;&#x6237;&#x63D0;&#x5230;&#x7684;&#x3002;</span><span class="yiyi-st" id="yiyi-172">&#x4E4B;&#x540E;&#xFF0C;&#x518D;&#x6B21;&#x586B;&#x5145;<code class="docutils literal"><span class="pre">__dict__</span></code>&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">__dict__</span>
<span class="go">{</span>
<span class="go">  &apos;id&apos;: 1, &apos;name&apos;: u&apos;user1&apos;,</span>
<span class="go">  &apos;_sa_instance_state&apos;: &lt;...&gt;,</span>
<span class="go">}</span></pre></div></div><div class="admonition note"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-173">&#x6CE8;&#x610F;</span></p><p class="last"><span class="yiyi-st" id="yiyi-174">&#x5F53;&#x6211;&#x4EEC;&#x5728;<code class="docutils literal"><span class="pre">__dict__</span></code>&#x91CC;&#x9762;&#x67E5;&#x770B;&#x65F6;&#xFF0C;&#x4E3A;&#x4E86;&#x770B;&#x5230;SQLAlchemy&#x7528;&#x5BF9;&#x8C61;&#x5C5E;&#x6027;&#x505A;&#x4E9B;&#x4EC0;&#x4E48;&#xFF0C;&#x6211;&#x4EEC;<strong>&#x4E0D;&#x5E94;&#x8BE5;&#x4FEE;&#x6539;<code class="docutils literal"><span class="pre">__dict__</span></code>&#x7684;&#x5185;&#x5BB9;&#x3002;&#x76F4;&#x63A5;&#xFF0C;&#x81F3;&#x5C11;&#x5C31;SQLAlchemy ORM&#x6240;&#x7EF4;&#x62A4;&#x7684;&#x5C5E;&#x6027;&#x800C;&#x8A00;&#xFF08;SQLA&#x9886;&#x57DF;&#x4E4B;&#x5916;&#x7684;&#x5176;&#x4ED6;&#x5C5E;&#x6027;&#x90FD;&#x53EF;&#x4EE5;&#xFF09;&#x3002;</strong></span><span class="yiyi-st" id="yiyi-175">&#x8FD9;&#x662F;&#x56E0;&#x4E3A;SQLAlchemy&#x4F7F;&#x7528;<a class="reference internal" href="glossary.html#term-descriptors"><span class="xref std std-term">descriptors</span></a>&#x6765;&#x8DDF;&#x8E2A;&#x6211;&#x4EEC;&#x5BF9;&#x5BF9;&#x8C61;&#x6240;&#x505A;&#x7684;&#x66F4;&#x6539;&#xFF0C;&#x5E76;&#x4E14;&#x5F53;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x4FEE;&#x6539;<code class="docutils literal"><span class="pre">__dict__</span></code>&#x65F6;&#xFF0C;ORM&#x5C06;&#x65E0;&#x6CD5;&#x8DDF;&#x8E2A;&#x6211;&#x4EEC;&#x6539;&#x53D8;&#x4E86;&#x4E00;&#x4E9B;&#x3002;</span></p></div><p><span class="yiyi-st" id="yiyi-176"><a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.expire" title="sqlalchemy.orm.session.Session.expire"><code class="xref py py-meth docutils literal"><span class="pre">expire()</span></code></a>&#x548C;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.refresh" title="sqlalchemy.orm.session.Session.refresh"><code class="xref py py-meth docutils literal"><span class="pre">refresh()</span></code></a>&#x7684;&#x53E6;&#x4E00;&#x4E2A;&#x5173;&#x952E;&#x884C;&#x4E3A;&#x662F;&#x4E22;&#x5F03;&#x5BF9;&#x8C61;&#x4E0A;&#x6240;&#x6709;&#x672A;&#x5237;&#x65B0;&#x7684;&#x66F4;&#x6539;&#x3002;</span><span class="yiyi-st" id="yiyi-177">&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x8981;&#x4FEE;&#x6539;<code class="docutils literal"><span class="pre">User</span></code>&#x4E0A;&#x7684;&#x5C5E;&#x6027;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&apos;user2&apos;</span></pre></div></div><p><span class="yiyi-st" id="yiyi-178">&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x5728;&#x6CA1;&#x6709;&#x5148;&#x8C03;&#x7528;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.flush" title="sqlalchemy.orm.session.Session.flush"><code class="xref py py-meth docutils literal"><span class="pre">flush()</span></code></a>&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x8C03;&#x7528;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.expire" title="sqlalchemy.orm.session.Session.expire"><code class="xref py py-meth docutils literal"><span class="pre">expire()</span></code></a>&#xFF0C;&#x6211;&#x4EEC;&#x7684;<code class="docutils literal"><span class="pre">&apos;user2&apos;</span></code>&#x7684;&#x672A;&#x51B3;&#x503C;&#x5C06;&#x88AB;&#x4E22;&#x5F03;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">expire</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">name</span>
<span class="go">&apos;user1&apos;</span></pre></div></div><p><span class="yiyi-st" id="yiyi-179">&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.expire" title="sqlalchemy.orm.session.Session.expire"><code class="xref py py-meth docutils literal"><span class="pre">expire()</span></code></a>&#x65B9;&#x6CD5;&#x5C06;&#x5B9E;&#x4F8B;&#x7684;&#x6240;&#x6709;ORM&#x6620;&#x5C04;&#x5C5E;&#x6027;&#x6807;&#x8BB0;&#x4E3A;&#x201C;&#x8FC7;&#x671F;&#x201D;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># expire all ORM-mapped attributes on obj1</span>
<span class="n">session</span><span class="o">.</span><span class="n">expire</span><span class="p">(</span><span class="n">obj1</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-180">&#x5B83;&#x4E5F;&#x53EF;&#x4EE5;&#x4F20;&#x9012;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#x5C5E;&#x6027;&#x540D;&#x79F0;&#x5217;&#x8868;&#xFF0C;&#x5F15;&#x7528;&#x7279;&#x5B9A;&#x7684;&#x5C5E;&#x6027;&#x6765;&#x6807;&#x8BB0;&#x4E3A;&#x8FC7;&#x671F;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># expire only attributes obj1.attr1, obj1.attr2</span>
<span class="n">session</span><span class="o">.</span><span class="n">expire</span><span class="p">(</span><span class="n">obj1</span><span class="p">,</span> <span class="p">[</span><span class="s1">&apos;attr1&apos;</span><span class="p">,</span> <span class="s1">&apos;attr2&apos;</span><span class="p">])</span></pre></div></div><p><span class="yiyi-st" id="yiyi-181"><a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.refresh" title="sqlalchemy.orm.session.Session.refresh"><code class="xref py py-meth docutils literal"><span class="pre">refresh()</span></code></a>&#x65B9;&#x6CD5;&#x6709;&#x4E00;&#x4E2A;&#x7C7B;&#x4F3C;&#x7684;&#x63A5;&#x53E3;&#xFF0C;&#x4F46;&#x4E0D;&#x662F;&#x8FC7;&#x671F;&#xFF0C;&#x800C;&#x662F;&#x7ACB;&#x5373;&#x4E3A;&#x5BF9;&#x8C61;&#x7684;&#x884C;&#x53D1;&#x51FA;&#x7ACB;&#x5373;&#x7684;SELECT&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># reload all attributes on obj1</span>
<span class="n">session</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="n">obj1</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-182"><a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.refresh" title="sqlalchemy.orm.session.Session.refresh"><code class="xref py py-meth docutils literal"><span class="pre">refresh()</span></code></a>&#x4E5F;&#x63A5;&#x53D7;&#x5B57;&#x7B26;&#x4E32;&#x5C5E;&#x6027;&#x540D;&#x79F0;&#x5217;&#x8868;&#xFF0C;&#x4F46;&#x4E0E;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.expire" title="sqlalchemy.orm.session.Session.expire"><code class="xref py py-meth docutils literal"><span class="pre">expire()</span></code></a>&#x4E0D;&#x540C;&#xFF0C;&#x671F;&#x671B;&#x81F3;&#x5C11;&#x6709;&#x4E00;&#x4E2A;&#x540D;&#x79F0;&#x662F;&#x5217;&#x6620;&#x5C04;&#x5C5E;&#x6027;&#x7684;&#x540D;&#x79F0;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># reload obj1.attr1, obj1.attr2</span>
<span class="n">session</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="n">obj1</span><span class="p">,</span> <span class="p">[</span><span class="s1">&apos;attr1&apos;</span><span class="p">,</span> <span class="s1">&apos;attr2&apos;</span><span class="p">])</span></pre></div></div><p><span class="yiyi-st" id="yiyi-183"><a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.expire_all" title="sqlalchemy.orm.session.Session.expire_all"><code class="xref py py-meth docutils literal"><span class="pre">Session.expire_all()</span></code></a>&#x65B9;&#x6CD5;&#x5141;&#x8BB8;&#x6211;&#x4EEC;&#x5B9E;&#x65F6;&#x8C03;&#x7528;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x4E2D;&#x5305;&#x542B;&#x7684;&#x6240;&#x6709;&#x5BF9;&#x8C61;&#x7684;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.expire" title="sqlalchemy.orm.session.Session.expire"><code class="xref py py-meth docutils literal"><span class="pre">Session.expire()</span></code></a></span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">expire_all</span><span class="p">()</span></pre></div></div><div class="section" id="what-actually-loads"><h3><span class="yiyi-st" id="yiyi-184">&#x4EC0;&#x4E48;&#x5B9E;&#x9645;&#x4E0A;&#x52A0;&#x8F7D;<a class="headerlink" href="#what-actually-loads" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-185">&#x6807;&#x6709;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.expire" title="sqlalchemy.orm.session.Session.expire"><code class="xref py py-meth docutils literal"><span class="pre">expire()</span></code></a>&#x6216;&#x52A0;&#x8F7D;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.refresh" title="sqlalchemy.orm.session.Session.refresh"><code class="xref py py-meth docutils literal"><span class="pre">refresh()</span></code></a>&#x7684;&#x5BF9;&#x8C61;&#x53D1;&#x51FA;&#x7684;SELECT&#x8BED;&#x53E5;&#x6839;&#x636E;&#x4EE5;&#x4E0B;&#x51E0;&#x4E2A;&#x56E0;&#x7D20;&#x800C;&#x53D8;&#x5316;&#xFF1A;</span></p><ul class="simple"><li><span class="yiyi-st" id="yiyi-186">&#x8FC7;&#x671F;&#x5C5E;&#x6027;&#x7684;&#x8D1F;&#x8F7D;&#x4EC5;&#x7531;<strong>&#x5217;&#x6620;&#x5C04;&#x5C5E;&#x6027;</strong>&#x89E6;&#x53D1;&#x3002;</span><span class="yiyi-st" id="yiyi-187">&#x867D;&#x7136;&#x4EFB;&#x4F55;&#x7C7B;&#x578B;&#x7684;&#x5C5E;&#x6027;&#x90FD;&#x53EF;&#x4EE5;&#x6807;&#x8BB0;&#x4E3A;&#x8FC7;&#x671F;&#xFF0C;&#x5305;&#x62EC;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#x6620;&#x200B;&#x200B;&#x5C04;&#x5C5E;&#x6027;&#xFF0C;&#x4F46;&#x8BBF;&#x95EE;&#x8FC7;&#x671F;&#x7684;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#x5C5E;&#x6027;&#x5C06;&#x4EC5;&#x4E3A;&#x8BE5;&#x5C5E;&#x6027;&#x53D1;&#x51FA;&#x52A0;&#x8F7D;&#xFF0C;&#x4F7F;&#x7528;&#x6807;&#x51C6;&#x7684;&#x9762;&#x5411;&#x5173;&#x7CFB;&#x7684;&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x3002;</span><span class="yiyi-st" id="yiyi-188">&#x9762;&#x5411;&#x5217;&#x7684;&#x5C5E;&#x6027;&#xFF08;&#x5373;&#x4F7F;&#x8FC7;&#x671F;&#xFF09;&#x4E0D;&#x4F1A;&#x4F5C;&#x4E3A;&#x6B64;&#x64CD;&#x4F5C;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x52A0;&#x8F7D;&#xFF0C;&#x800C;&#x662F;&#x5728;&#x8BBF;&#x95EE;&#x4EFB;&#x4F55;&#x9762;&#x5411;&#x5217;&#x7684;&#x5C5E;&#x6027;&#x65F6;&#x52A0;&#x8F7D;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-189"><a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#x6620;&#x200B;&#x200B;&#x5C04;&#x7684;&#x5C5E;&#x6027;&#x4E0D;&#x4F1A;&#x52A0;&#x8F7D;&#xFF0C;&#x4EE5;&#x54CD;&#x5E94;&#x6B63;&#x5728;&#x8BBF;&#x95EE;&#x7684;&#x5230;&#x671F;&#x7684;&#x57FA;&#x4E8E;&#x5217;&#x7684;&#x5C5E;&#x6027;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-190">&#x5173;&#x4E8E;&#x5173;&#x7CFB;&#xFF0C;&#x5BF9;&#x4E8E;&#x672A;&#x7ECF;&#x5217;&#x6620;&#x5C04;&#x7684;&#x5C5E;&#x6027;&#xFF0C;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.refresh" title="sqlalchemy.orm.session.Session.refresh"><code class="xref py py-meth docutils literal"><span class="pre">refresh()</span></code></a>&#x6BD4;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.expire" title="sqlalchemy.orm.session.Session.expire"><code class="xref py py-meth docutils literal"><span class="pre">expire()</span></code></a>&#x66F4;&#x5177;&#x9650;&#x5236;&#x6027;&#x3002;</span><span class="yiyi-st" id="yiyi-191">&#x8C03;&#x7528;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.refresh" title="sqlalchemy.orm.session.Session.refresh"><code class="xref py py-meth docutils literal"><span class="pre">refresh()</span></code></a>&#x5E76;&#x4F20;&#x9012;&#x4EC5;&#x5305;&#x542B;&#x5173;&#x7CFB;&#x6620;&#x5C04;&#x5C5E;&#x6027;&#x7684;&#x540D;&#x79F0;&#x5217;&#x8868;&#x5B9E;&#x9645;&#x4E0A;&#x4F1A;&#x5F15;&#x53D1;&#x9519;&#x8BEF;&#x3002;</span><span class="yiyi-st" id="yiyi-192">&#x65E0;&#x8BBA;&#x5982;&#x4F55;&#xFF0C;&#x975E;&#x6025;&#x5207;&#x52A0;&#x8F7D;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#x5C5E;&#x6027;&#x5C06;&#x4E0D;&#x4F1A;&#x5305;&#x542B;&#x5728;&#x4EFB;&#x4F55;&#x5237;&#x65B0;&#x64CD;&#x4F5C;&#x4E2D;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-193">&#x901A;&#x8FC7;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.lazy" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">lazy</span></code></a>&#x53C2;&#x6570;&#x914D;&#x7F6E;&#x4E3A;&#x201C;&#x6025;&#x5207;&#x52A0;&#x8F7D;&#x201D;&#x7684;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#x5C5E;&#x6027;&#x5C06;&#x5728;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.refresh" title="sqlalchemy.orm.session.Session.refresh"><code class="xref py py-meth docutils literal"><span class="pre">refresh()</span></code></a>&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x52A0;&#x8F7D;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x5C5E;&#x6027;&#x540D;&#x79F0;&#x88AB;&#x6307;&#x5B9A;&#xFF0C;&#x6216;&#x8005;&#x5982;&#x679C;&#x4ED6;&#x4EEC;&#x7684;&#x540D;&#x5B57;&#x88AB;&#x5305;&#x542B;&#x5728;&#x8981;&#x88AB;&#x5237;&#x65B0;&#x7684;&#x5C5E;&#x6027;&#x5217;&#x8868;&#x4E2D;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-194">&#x5728;&#x8FC7;&#x671F;&#x5C5E;&#x6027;&#x52A0;&#x8F7D;&#x671F;&#x95F4;&#x6216;&#x5237;&#x65B0;&#x671F;&#x95F4;&#xFF0C;&#x914D;&#x7F6E;&#x4E3A;<a class="reference internal" href="loading_columns.html#sqlalchemy.orm.deferred" title="sqlalchemy.orm.deferred"><code class="xref py py-func docutils literal"><span class="pre">deferred()</span></code></a>&#x7684;&#x5C5E;&#x6027;&#x901A;&#x5E38;&#x4E0D;&#x4F1A;&#x52A0;&#x8F7D;&#x3002;</span><span class="yiyi-st" id="yiyi-195">&#x76F4;&#x63A5;&#x8BBF;&#x95EE;&#x65F6;&#xFF0C;<a class="reference internal" href="loading_columns.html#sqlalchemy.orm.deferred" title="sqlalchemy.orm.deferred"><code class="xref py py-func docutils literal"><span class="pre">deferred()</span></code></a>&#x7684;&#x5378;&#x8F7D;&#x5C5E;&#x6027;&#x81EA;&#x5DF1;&#x52A0;&#x8F7D;&#xFF0C;&#x6216;&#x8005;&#x5982;&#x679C;&#x8BBF;&#x95EE;&#x8BE5;&#x7EC4;&#x4E2D;&#x7684;&#x672A;&#x52A0;&#x8F7D;&#x5C5E;&#x6027;&#x7684;&#x5EF6;&#x8FDF;&#x5C5E;&#x6027;&#x201C;&#x7EC4;&#x201D;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-196">&#x5BF9;&#x4E8E;&#x5728;&#x8BBF;&#x95EE;&#x65F6;&#x52A0;&#x8F7D;&#x7684;&#x8FC7;&#x671F;&#x5C5E;&#x6027;&#xFF0C;&#x8054;&#x5408;&#x7EE7;&#x627F;&#x8868;&#x6620;&#x5C04;&#x5C06;&#x53D1;&#x51FA;&#x4E00;&#x4E2A;SELECT&#xFF0C;&#x901A;&#x5E38;&#x53EA;&#x5305;&#x542B;&#x90A3;&#x4E9B;&#x5B58;&#x5728;&#x672A;&#x52A0;&#x8F7D;&#x5C5E;&#x6027;&#x7684;&#x8868;&#x3002;</span><span class="yiyi-st" id="yiyi-197">&#x6B64;&#x5904;&#x7684;&#x64CD;&#x4F5C;&#x8DB3;&#x591F;&#x590D;&#x6742;&#xFF0C;&#x53EA;&#x80FD;&#x52A0;&#x8F7D;&#x7236;&#x8868;&#x6216;&#x5B50;&#x8868;&#xFF0C;&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x6700;&#x521D;&#x8FC7;&#x671F;&#x7684;&#x5217;&#x7684;&#x5B50;&#x96C6;&#x4EC5;&#x5305;&#x542B;&#x8FD9;&#x4E9B;&#x8868;&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x6216;&#x53E6;&#x4E00;&#x4E2A;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-198">&#x5F53;&#x5728;&#x5DF2;&#x8FDE;&#x63A5;&#x7684;&#x7EE7;&#x627F;&#x8868;&#x6620;&#x5C04;&#x4E0A;&#x4F7F;&#x7528;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.refresh" title="sqlalchemy.orm.session.Session.refresh"><code class="xref py py-meth docutils literal"><span class="pre">refresh()</span></code></a>&#x65F6;&#xFF0C;&#x53D1;&#x51FA;&#x7684;SELECT&#x7C7B;&#x4F3C;&#x4E8E;&#x5728;&#x76EE;&#x6807;&#x5BF9;&#x8C61;&#x7684;&#x7C7B;&#x4E0A;&#x4F7F;&#x7528;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.query" title="sqlalchemy.orm.session.Session.query"><code class="xref py py-meth docutils literal"><span class="pre">Session.query()</span></code></a>&#x65F6;&#x7684;SELECT&#x3002;</span><span class="yiyi-st" id="yiyi-199">&#x8FD9;&#x901A;&#x5E38;&#x662F;&#x6240;&#x6709;&#x90A3;&#x4E9B;&#x8BBE;&#x7F6E;&#x4E3A;&#x6620;&#x5C04;&#x4E00;&#x90E8;&#x5206;&#x7684;&#x8868;&#x3002;</span></li></ul></div><div class="section" id="when-to-expire-or-refresh"><h3><span class="yiyi-st" id="yiyi-200">&#x4F55;&#x65F6;&#x8FC7;&#x671F;&#x6216;&#x5237;&#x65B0;<a class="headerlink" href="#when-to-expire-or-refresh" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-201">&#x53EA;&#x8981;&#x4F1A;&#x8BDD;&#x5F15;&#x7528;&#x7684;&#x4E8B;&#x52A1;&#x7ED3;&#x675F;&#xFF0C;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x5C31;&#x4F1A;&#x81EA;&#x52A8;&#x4F7F;&#x7528;&#x5230;&#x671F;&#x529F;&#x80FD;&#x3002;</span><span class="yiyi-st" id="yiyi-202">&#x8FD9;&#x610F;&#x5473;&#x7740;&#xFF0C;&#x65E0;&#x8BBA;&#x4F55;&#x65F6;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.commit" title="sqlalchemy.orm.session.Session.commit"><code class="xref py py-meth docutils literal"><span class="pre">Session.commit()</span></code></a>&#x6216;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.rollback" title="sqlalchemy.orm.session.Session.rollback"><code class="xref py py-meth docutils literal"><span class="pre">Session.rollback()</span></code></a>&#x88AB;&#x8C03;&#x7528;&#xFF0C;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x4E2D;&#x7684;&#x6240;&#x6709;&#x5BF9;&#x8C61;&#x90FD;&#x4F1A;&#x8FC7;&#x671F;&#xFF0C;&#x5230;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.expire_all" title="sqlalchemy.orm.session.Session.expire_all"><code class="xref py py-meth docutils literal"><span class="pre">Session.expire_all()</span></code></a>&#x65B9;&#x6CD5;&#x3002;</span><span class="yiyi-st" id="yiyi-203">&#x5176;&#x57FA;&#x672C;&#x539F;&#x7406;&#x662F;&#x4E8B;&#x52A1;&#x7684;&#x7ED3;&#x675F;&#x662F;&#x4E00;&#x4E2A;&#x5212;&#x5206;&#x70B9;&#xFF0C;&#x5728;&#x8FD9;&#x4E2A;&#x70B9;&#x4E0A;&#x6CA1;&#x6709;&#x66F4;&#x591A;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x53EF;&#x7528;&#x6765;&#x4E86;&#x89E3;&#x6570;&#x636E;&#x5E93;&#x7684;&#x5F53;&#x524D;&#x72B6;&#x6001;&#xFF0C;&#x56E0;&#x4E3A;&#x4EFB;&#x4F55;&#x6570;&#x91CF;&#x7684;&#x5176;&#x4ED6;&#x4E8B;&#x52A1;&#x90FD;&#x53EF;&#x80FD;&#x5F71;&#x54CD;&#x5B83;&#x3002;</span><span class="yiyi-st" id="yiyi-204">&#x53EA;&#x6709;&#x5F53;&#x65B0;&#x4E8B;&#x52A1;&#x5F00;&#x59CB;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x624D;&#x80FD;&#x518D;&#x6B21;&#x8BBF;&#x95EE;&#x6570;&#x636E;&#x5E93;&#x7684;&#x5F53;&#x524D;&#x72B6;&#x6001;&#xFF0C;&#x6B64;&#x65F6;&#x53EF;&#x80FD;&#x53D1;&#x751F;&#x4E86;&#x4EFB;&#x4F55;&#x6570;&#x91CF;&#x7684;&#x66F4;&#x6539;&#x3002;</span></p><div class="sidebar"><p class="first sidebar-title"><span class="yiyi-st" id="yiyi-205">&#x4E8B;&#x52A1;&#x9694;&#x79BB;</span></p><p class="last"><span class="yiyi-st" id="yiyi-206">&#x5F53;&#x7136;&#xFF0C;&#x5927;&#x591A;&#x6570;&#x6570;&#x636E;&#x5E93;&#x80FD;&#x591F;&#x4E00;&#x6B21;&#x5904;&#x7406;&#x591A;&#x4E2A;&#x4E8B;&#x52A1;&#xFF0C;&#x751A;&#x81F3;&#x5305;&#x542B;&#x76F8;&#x540C;&#x7684;&#x6570;&#x636E;&#x884C;&#x3002;</span><span class="yiyi-st" id="yiyi-207">&#x5F53;&#x5173;&#x7CFB;&#x6570;&#x636E;&#x5E93;&#x5904;&#x7406;&#x6D89;&#x53CA;&#x76F8;&#x540C;&#x8868;&#x6216;&#x884C;&#x7684;&#x591A;&#x4E2A;&#x4E8B;&#x52A1;&#x65F6;&#xFF0C;&#x8FD9;&#x662F;&#x6570;&#x636E;&#x5E93;&#x7684;<a class="reference internal" href="glossary.html#term-isolation"><span class="xref std std-term">isolation</span></a>&#x65B9;&#x9762;&#x8D77;&#x4F5C;&#x7528;&#x7684;&#x65F6;&#x5019;&#x3002;</span><span class="yiyi-st" id="yiyi-208">&#x4E0D;&#x540C;&#x6570;&#x636E;&#x5E93;&#x7684;&#x9694;&#x79BB;&#x884C;&#x4E3A;&#x5DEE;&#x5F02;&#x5F88;&#x5927;&#xFF0C;&#x751A;&#x81F3;&#x53EF;&#x4EE5;&#x5C06;&#x5355;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#x914D;&#x7F6E;&#x4E3A;&#x4EE5;&#x4E0D;&#x540C;&#x65B9;&#x5F0F;&#x8FD0;&#x884C;&#xFF08;&#x901A;&#x8FC7;&#x6240;&#x8C13;&#x7684;<span class="xref std std-term">&#x9694;&#x79BB;&#x7EA7;&#x522B;</span>&#x8BBE;&#x7F6E;&#xFF09;&#x3002;</span><span class="yiyi-st" id="yiyi-209">&#x4ECE;&#x8FD9;&#x4E2A;&#x610F;&#x4E49;&#x4E0A;&#x8BF4;&#xFF0C;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x4E0D;&#x80FD;&#x5B8C;&#x5168;&#x9884;&#x6D4B;&#x4F55;&#x65F6;&#x7B2C;&#x4E8C;&#x6B21;&#x53D1;&#x51FA;&#x7684;&#x76F8;&#x540C;SELECT&#x8BED;&#x53E5;&#x80AF;&#x5B9A;&#x4F1A;&#x8FD4;&#x56DE;&#x6211;&#x4EEC;&#x5DF2;&#x6709;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x6216;&#x8005;&#x5C06;&#x8FD4;&#x56DE;&#x65B0;&#x6570;&#x636E;&#x3002;</span><span class="yiyi-st" id="yiyi-210">&#x56E0;&#x6B64;&#xFF0C;&#x4F5C;&#x4E3A;&#x6700;&#x4F73;&#x731C;&#x6D4B;&#xFF0C;&#x5B83;&#x5047;&#x8BBE;&#x5728;&#x4E8B;&#x52A1;&#x8303;&#x56F4;&#x5185;&#xFF0C;&#x9664;&#x975E;&#x77E5;&#x9053;&#x5DF2;&#x7ECF;&#x53D1;&#x51FA;SQL&#x8868;&#x8FBE;&#x5F0F;&#x6765;&#x4FEE;&#x6539;&#x7279;&#x5B9A;&#x884C;&#xFF0C;&#x5426;&#x5219;&#x4E0D;&#x9700;&#x8981;&#x5237;&#x65B0;&#x884C;&#xFF0C;&#x9664;&#x975E;&#x660E;&#x786E;&#x544A;&#x77E5;&#x8FD9;&#x6837;&#x505A;&#x3002;</span></p></div><p><span class="yiyi-st" id="yiyi-211">&#x5F53;&#x9700;&#x8981;&#x5F3A;&#x5236;&#x5BF9;&#x8C61;&#x4ECE;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x91CD;&#x65B0;&#x52A0;&#x8F7D;&#x5176;&#x6570;&#x636E;&#x65F6;&#xFF0C;&#x4F1A;&#x4F7F;&#x7528;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.expire" title="sqlalchemy.orm.session.Session.expire"><code class="xref py py-meth docutils literal"><span class="pre">Session.expire()</span></code></a>&#x548C;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.refresh" title="sqlalchemy.orm.session.Session.refresh"><code class="xref py py-meth docutils literal"><span class="pre">Session.refresh()</span></code></a>&#x65B9;&#x6CD5;&#xFF0C;&#x90A3;&#x4E9B;&#x77E5;&#x9053;&#x5F53;&#x524D;&#x6570;&#x636E;&#x72B6;&#x6001;&#x53EF;&#x80FD;&#x5DF2;&#x8FC7;&#x65F6;&#x7684;&#x60C5;&#x51B5;&#x3002;</span><span class="yiyi-st" id="yiyi-212">&#x5176;&#x539F;&#x56E0;&#x53EF;&#x80FD;&#x5305;&#x62EC;&#xFF1A;</span></p><ul class="simple"><li><span class="yiyi-st" id="yiyi-213">some SQL has been emitted within the transaction outside of the scope of the ORM&#x2019;s object handling, such as if a <a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Table.update" title="sqlalchemy.schema.Table.update"><code class="xref py py-meth docutils literal"><span class="pre">Table.update()</span></code></a> construct were emitted using the <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.execute" title="sqlalchemy.orm.session.Session.execute"><code class="xref py py-meth docutils literal"><span class="pre">Session.execute()</span></code></a> method;</span></li><li><span class="yiyi-st" id="yiyi-214">&#x5982;&#x679C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x8BD5;&#x56FE;&#x83B7;&#x53D6;&#x5DF2;&#x77E5;&#x5728;&#x5E76;&#x53D1;&#x4E8B;&#x52A1;&#x4E2D;&#x4FEE;&#x6539;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x5E76;&#x4E14;&#x8FD8;&#x77E5;&#x9053;&#x9694;&#x79BB;&#x89C4;&#x5219;&#x5B9E;&#x9645;&#x4E0A;&#x5141;&#x8BB8;&#x6B64;&#x6570;&#x636E;&#x53EF;&#x89C1;&#x3002;</span></li></ul><p><span class="yiyi-st" id="yiyi-215">&#x7B2C;&#x4E8C;&#x4E2A;&#x8981;&#x70B9;&#x6709;&#x4E00;&#x4E2A;&#x91CD;&#x8981;&#x7684;&#x8B66;&#x544A;&#xFF0C;&#x5373;&#x201C;&#x8FD8;&#x77E5;&#x9053;&#x9694;&#x79BB;&#x89C4;&#x5219;&#x5B9E;&#x9645;&#x4E0A;&#x5141;&#x8BB8;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#x53EF;&#x89C1;&#x201D;&#x3002;&#x8FD9;&#x610F;&#x5473;&#x7740;&#x4E0D;&#x80FD;&#x8BA4;&#x4E3A;&#x53D1;&#x751F;&#x5728;&#x53E6;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;&#x4E0A;&#x7684;UPDATE&#x5728;&#x672C;&#x5730;&#x4ECD;&#x7136;&#x53EF;&#x89C1;&#xFF1B;&#x5728;&#x5F88;&#x591A;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5B83;&#x4E0D;&#x4F1A;&#x3002;</span><span class="yiyi-st" id="yiyi-216">&#x8FD9;&#x5C31;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x5982;&#x679C;&#x5E0C;&#x671B;&#x4F7F;&#x7528;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.expire" title="sqlalchemy.orm.session.Session.expire"><code class="xref py py-meth docutils literal"><span class="pre">expire()</span></code></a>&#x6216;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.refresh" title="sqlalchemy.orm.session.Session.refresh"><code class="xref py py-meth docutils literal"><span class="pre">refresh()</span></code></a>&#x6765;&#x67E5;&#x770B;&#x6B63;&#x5728;&#x8FDB;&#x884C;&#x7684;&#x4E8B;&#x52A1;&#x4E4B;&#x95F4;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x7406;&#x89E3;&#x9694;&#x79BB;&#x884C;&#x4E3A;&#x662F;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x7684;&#x3002;</span></p><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-217">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p><span class="yiyi-st" id="yiyi-218"><a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.expire" title="sqlalchemy.orm.session.Session.expire"><code class="xref py py-meth docutils literal"><span class="pre">Session.expire()</span></code></a></span></p><p><span class="yiyi-st" id="yiyi-219"><a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.expire_all" title="sqlalchemy.orm.session.Session.expire_all"><code class="xref py py-meth docutils literal"><span class="pre">Session.expire_all()</span></code></a></span></p><p><span class="yiyi-st" id="yiyi-220"><a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.refresh" title="sqlalchemy.orm.session.Session.refresh"><code class="xref py py-meth docutils literal"><span class="pre">Session.refresh()</span></code></a></span></p><p><span class="yiyi-st" id="yiyi-221"><a class="reference internal" href="glossary.html#term-isolation"><span class="xref std std-term">isolation</span></a> - glossary explanation of isolation which includes links to Wikipedia.</span></p><p class="last"><span class="yiyi-st" id="yiyi-222"><a class="reference external" href="http://techspot.zzzeek.org/2012/11/14/pycon-canada-the-sqlalchemy-session-in-depth/">The SQLAlchemy Session In-Depth</a> - a video + slides with an in-depth discussion of the object lifecycle including the role of data expiration.</span></p></div></div></div>