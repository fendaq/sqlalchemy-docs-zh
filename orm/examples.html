<h1><span class="yiyi-st" id="yiyi-65">ORM&#x793A;&#x4F8B;<a class="headerlink" href="#orm-examples" title="Permalink to this headline">&#xB6;</a></span></h1><p><span class="yiyi-st" id="yiyi-66">SQLAlchemy&#x53D1;&#x884C;&#x7248;&#x5305;&#x542B;&#x5404;&#x79CD;&#x4EE3;&#x7801;&#x793A;&#x4F8B;&#xFF0C;&#x8BF4;&#x660E;&#x4E00;&#x7EC4;&#x9009;&#x62E9;&#x7684;&#x6A21;&#x5F0F;&#xFF0C;&#x4E00;&#x4E9B;&#x662F;&#x5178;&#x578B;&#x7684;&#xFF0C;&#x4E00;&#x4E9B;&#x4E0D;&#x592A;&#x5178;&#x578B;&#x3002;</span><span class="yiyi-st" id="yiyi-67">&#x6240;&#x6709;&#x90FD;&#x53EF;&#x4EE5;&#x8FD0;&#x884C;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x53D1;&#x884C;&#x7248;&#x7684;<code class="docutils literal"><span class="pre">/examples</span></code>&#x76EE;&#x5F55;&#x4E2D;&#x627E;&#x5230;&#x3002;</span><span class="yiyi-st" id="yiyi-68">&#x6240;&#x6709;&#x7684;&#x63CF;&#x8FF0;&#x548C;&#x6E90;&#x4EE3;&#x7801;&#x53EF;&#x4EE5;&#x5728;&#x8FD9;&#x91CC;&#x627E;&#x5230;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-69">&#x989D;&#x5916;&#x7684;SQLAlchemy&#x793A;&#x4F8B;&#xFF08;&#x67D0;&#x4E9B;&#x7528;&#x6237;&#x8D21;&#x732E;&#xFF09;&#x53EF;&#x5728;&#x7EF4;&#x57FA;&#x4E0A;&#x7684;<a class="reference external" href="http://www.sqlalchemy.org/trac/wiki/UsageRecipes">http://www.sqlalchemy.org/trac/wiki/UsageRecipes</a>&#x4E0A;&#x83B7;&#x5F97;&#x3002;</span></p><div class="section" id="mapping-recipes"><h2><span class="yiyi-st" id="yiyi-70">&#x6620;&#x5C04;&#x98DF;&#x8C31;<a class="headerlink" href="#mapping-recipes" title="Permalink to this headline">&#xB6;</a></span></h2><div class="section" id="module-examples.adjacency_list"><h3><span class="yiyi-st" id="yiyi-71">&#x90BB;&#x63A5;&#x5217;&#x8868;<a class="headerlink" href="#module-examples.adjacency_list" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-72">&#x4F7F;&#x7528;&#x90BB;&#x63A5;&#x5217;&#x8868;&#x6A21;&#x578B;&#x6620;&#x5C04;&#x7684;&#x5B57;&#x5178;&#x8BCD;&#x5178;&#x7ED3;&#x6784;&#x793A;&#x4F8B;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-73">&#x4F8B;&#x5982;&#x3002;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">node</span> <span class="o">=</span> <span class="n">TreeNode</span><span class="p">(</span><span class="s1">&apos;rootnode&apos;</span><span class="p">)</span>
<span class="n">node</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&apos;node1&apos;</span><span class="p">)</span>
<span class="n">node</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&apos;node3&apos;</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<span class="n">dump_tree</span><span class="p">(</span><span class="n">node</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-74">&#x6587;&#x4EF6;&#x6E05;&#x5355;&#xFF1A;</span></p><ul class="simple"><li><span class="yiyi-st" id="yiyi-75"><a class="reference external" href="_modules/examples/adjacency_list/adjacency_list.html"> adjacency_list.py  T0&gt;</a></span></li></ul></div><div class="section" id="module-examples.association"><h3><span class="yiyi-st" id="yiyi-76">&#x534F;&#x4F1A;<a class="headerlink" href="#module-examples.association" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h3><p><span class="yiyi-st" id="yiyi-77">&#x8BF4;&#x660E;&#x201C;&#x5173;&#x8054;&#x5BF9;&#x8C61;&#x201D;&#x6A21;&#x5F0F;&#x7684;&#x7528;&#x6CD5;&#x7684;&#x793A;&#x4F8B;&#xFF0C;&#x5176;&#x4E2D;&#x4E2D;&#x95F4;&#x7C7B;&#x8C03;&#x89E3;&#x4EE5;&#x591A;&#x5BF9;&#x591A;&#x6A21;&#x5F0F;&#x5173;&#x8054;&#x7684;&#x4E24;&#x4E2A;&#x7C7B;&#x4E4B;&#x95F4;&#x7684;&#x5173;&#x7CFB;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-78">&#x6587;&#x4EF6;&#x6E05;&#x5355;&#xFF1A;</span></p><ul class="simple"><li><span class="yiyi-st" id="yiyi-79"><a class="reference external" href="_modules/examples/association/proxied_association.html">proxied_association.py</a>  - &#x4E0E;basic_association&#x76F8;&#x540C;&#x7684;&#x793A;&#x4F8B;&#xFF0C;&#x5728;&#x4F7F;&#x7528;<a class="reference internal" href="extensions_associationproxy.html#module-sqlalchemy.ext.associationproxy" title="sqlalchemy.ext.associationproxy"><code class="xref py py-mod docutils literal"><span class="pre">sqlalchemy.ext.associationproxy</span></code></a>&#x65F6;&#x6DFB;&#x52A0;&#x4EE5;&#x660E;&#x786E;&#x5F15;&#x7528;<code class="docutils literal"><span class="pre">OrderItem</span></code>&#x53EF;&#x9009;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-80"><a class="reference external" href="_modules/examples/association/basic_association.html">basic_association.py</a>  - &#x8BF4;&#x660E;&#x201C;&#x8BA2;&#x5355;&#x201D;&#x548C;&#x201C;&#x5546;&#x54C1;&#x201D;&#x5BF9;&#x8C61;&#x96C6;&#x5408;&#x4E4B;&#x95F4;&#x7684;&#x591A;&#x5BF9;&#x591A;&#x5173;&#x7CFB;&#xFF0C;&#x901A;&#x8FC7;&#x540D;&#x4E3A;&#x201C;OrderItem&#x201D;&#x7684;&#x5173;&#x8054;&#x5BF9;&#x8C61;&#x5C06;&#x8D2D;&#x4E70;&#x4EF7;&#x683C;&#x4E0E;&#x6BCF;&#x4E2A;&#x5BF9;&#x8C61;&#x5173;&#x8054;&#x8D77;&#x6765;</span></li><li><span class="yiyi-st" id="yiyi-81"><a class="reference external" href="_modules/examples/association/dict_of_sets_with_default.html">dict_of_sets_with_default.py</a>  - &#x4E00;&#x4E2A;&#x9AD8;&#x7EA7;&#x5173;&#x8054;&#x4EE3;&#x7406;&#x793A;&#x4F8B;&#xFF0C;&#x5B83;&#x6F14;&#x793A;&#x4E86;&#x5173;&#x8054;&#x4EE3;&#x7406;&#x7684;&#x5D4C;&#x5957;&#x4EE5;&#x751F;&#x6210;&#x591A;&#x7EA7;Python&#x96C6;&#x5408;&#xFF0C;&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5305;&#x542B;&#x5B57;&#x7B26;&#x4E32;&#x952E;&#x548C;&#x6574;&#x6570;&#x96C6;&#x4F5C;&#x4E3A;&#x503C;&#x7684;&#x5B57;&#x5178;&#xFF0C;&#x5B83;&#x9690;&#x85CF;&#x4E86;&#x6620;&#x5C04;&#x7684;&#x5E95;&#x5C42;&#x7C7B;&#x3002;</span></li></ul></div><div class="section" id="module-examples.graphs"><h3><span class="yiyi-st" id="yiyi-82">&#x6709;&#x5411;&#x56FE;<a class="headerlink" href="#module-examples.graphs" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-83">&#x6709;&#x5411;&#x56FE;&#x7ED3;&#x6784;&#x7684;&#x6301;&#x4E45;&#x6027;&#x793A;&#x4F8B;&#x3002;</span><span class="yiyi-st" id="yiyi-84">&#x8BE5;&#x56FE;&#x5B58;&#x50A8;&#x4E3A;&#x4E00;&#x7EC4;&#x8FB9;&#xFF0C;&#x6BCF;&#x4E2A;&#x8282;&#x90FD;&#x5F15;&#x7528;&#x4E00;&#x4E2A;&#x201C;&#x4E0B;&#x201D;&#x8282;&#x70B9;&#x548C;&#x4E00;&#x4E2A;&#x201C;&#x4E0A;&#x201D;&#x8282;&#x70B9;&#x3002;</span><span class="yiyi-st" id="yiyi-85">&#x5BF9;&#x4F4E;&#x5C42;&#x548C;&#x9AD8;&#x5C42;&#x90BB;&#x5C45;&#x7684;&#x57FA;&#x672C;&#x6301;&#x4E45;&#x6027;&#x548C;&#x67E5;&#x8BE2;&#x8FDB;&#x884C;&#x4E86;&#x8BF4;&#x660E;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">n2</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">n5</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">n2</span><span class="o">.</span><span class="n">add_neighbor</span><span class="p">(</span><span class="n">n5</span><span class="p">)</span>
<span class="k">print</span> <span class="n">n2</span><span class="o">.</span><span class="n">higher_neighbors</span><span class="p">()</span></pre></div></div><p><span class="yiyi-st" id="yiyi-86">&#x6587;&#x4EF6;&#x6E05;&#x5355;&#xFF1A;</span></p><ul class="simple"><li><span class="yiyi-st" id="yiyi-87"><a class="reference external" href="_modules/examples/graphs/directed_graph.html">directed_graph.py</a>  - &#x6709;&#x5411;&#x56FE;&#x793A;&#x4F8B;&#x3002;</span></li></ul></div><div class="section" id="module-examples.dynamic_dict"><h3><span class="yiyi-st" id="yiyi-88">&#x4F5C;&#x4E3A;&#x8BCD;&#x5178;&#x7684;&#x52A8;&#x6001;&#x5173;&#x7CFB;<a class="headerlink" href="#module-examples.dynamic_dict" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-89">&#x8BF4;&#x660E;&#x5982;&#x4F55;&#x5728;&#x201C;&#x52A8;&#x6001;&#x201D;&#x5173;&#x7CFB;&#x4E4B;&#x4E0A;&#x653E;&#x7F6E;&#x7C7B;&#x4F3C;&#x5B57;&#x5178;&#x7684;&#x5916;&#x89C2;&#xFF0C;&#x4EE5;&#x4FBF;&#x5B57;&#x5178;&#x64CD;&#x4F5C;&#xFF08;&#x5047;&#x8BBE;&#x7B80;&#x5355;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x952E;&#xFF09;&#x53EF;&#x4EE5;&#x5BF9;&#x5927;&#x96C6;&#x5408;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#xFF0C;&#x800C;&#x65E0;&#x9700;&#x4E00;&#x6B21;&#x52A0;&#x8F7D;&#x5B8C;&#x6574;&#x96C6;&#x5408;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-90">&#x6587;&#x4EF6;&#x6E05;&#x5355;&#xFF1A;</span></p><ul class="simple"><li><span class="yiyi-st" id="yiyi-91"><a class="reference external" href="_modules/examples/dynamic_dict/dynamic_dict.html"> dynamic_dict.py  T0&gt;</a></span></li></ul></div><div class="section" id="module-examples.generic_associations"><h3><span class="yiyi-st" id="yiyi-92">&#x901A;&#x7528;&#x5173;&#x8054;<a class="headerlink" href="#module-examples.generic_associations" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-93">&#x4E3E;&#x4F8B;&#x8BF4;&#x660E;&#x5C06;&#x591A;&#x79CD;&#x7236;&#x6BCD;&#x4E0E;&#x7279;&#x5B9A;&#x5B50;&#x5BF9;&#x8C61;&#x76F8;&#x5173;&#x8054;&#x7684;&#x5404;&#x79CD;&#x65B9;&#x6CD5;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-94">&#x8FD9;&#x4E9B;&#x793A;&#x4F8B;&#x90FD;&#x4F7F;&#x7528;&#x58F0;&#x660E;&#x6027;&#x6269;&#x5C55;&#x548C;&#x58F0;&#x660E;&#x6027;&#x6DF7;&#x5408;&#x3002;</span><span class="yiyi-st" id="yiyi-95">Each one presents the identical use case at the end - two classes, <code class="docutils literal"><span class="pre">Customer</span></code> and <code class="docutils literal"><span class="pre">Supplier</span></code>, both subclassing the <code class="docutils literal"><span class="pre">HasAddresses</span></code> mixin, which ensures that the parent class is provided with an <code class="docutils literal"><span class="pre">addresses</span></code> collection which contains <code class="docutils literal"><span class="pre">Address</span></code> objects.</span></p><p><span class="yiyi-st" id="yiyi-96">&#x8BE5;<a class="reference external" href="_modules/examples/generic_associations/discriminator_on_association.html"> discriminator_on_association.py  T0&gt;&#x548C;<a class="reference external" href="_modules/examples/generic_associations/generic_fk.html"> generic_fk.py  T1&gt;&#x811A;&#x672C;&#x73B0;&#x4EE3;&#x5316;&#x5728;2007&#x5E74;&#x7684;&#x535A;&#x5BA2;&#x6587;&#x7AE0;<a class="reference external" href="http://techspot.zzzeek.org/2007/05/29/polymorphic-associations-with-sqlalchemy/">&#x591A;&#x6001;&#x5173;&#x8054;&#x4E0E;SQLAlchemy&#x7684; T2&gt;&#x63D0;&#x4EA4;&#x98DF;&#x8C31;&#x7248;&#x672C;&#x3002;</a></a></a></span></p><p><span class="yiyi-st" id="yiyi-97">&#x6587;&#x4EF6;&#x6E05;&#x5355;&#xFF1A;</span></p><ul class="simple"><li><span class="yiyi-st" id="yiyi-98"><a class="reference external" href="_modules/examples/generic_associations/generic_fk.html">generic_fk.py</a>  - &#x4EE5;&#x7C7B;&#x4F3C;&#x4E8E;Django&#xFF0C;ROR&#x7B49;&#x6D41;&#x884C;&#x6846;&#x67B6;&#x7684;&#x65B9;&#x5F0F;&#x8BF4;&#x660E;&#x6240;&#x8C13;&#x7684;&#x201C;&#x901A;&#x7528;&#x5916;&#x952E;&#x201D;&#x3002;</span><span class="yiyi-st" id="yiyi-99">&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x7ED5;&#x8FC7;&#x4E86;&#x6807;&#x51C6;&#x7684;&#x53C2;&#x7167;&#x5B8C;&#x6574;&#x6027;&#x5B9E;&#x8DF5;&#xFF0C;&#x56E0;&#x4E3A;&#x201C;&#x5916;&#x952E;&#x201D;&#x5217;&#x5B9E;&#x9645;&#x4E0A;&#x5E76;&#x6CA1;&#x6709;&#x9650;&#x5236;&#x5F15;&#x7528;&#x4EFB;&#x4F55;&#x7279;&#x5B9A;&#x7684;&#x8868;&#xFF1B;&#x76F8;&#x53CD;&#xFF0C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5185;&#x90E8;&#x903B;&#x8F91;&#x7528;&#x4E8E;&#x786E;&#x5B9A;&#x5F15;&#x7528;&#x54EA;&#x4E2A;&#x8868;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-100"><a class="reference external" href="_modules/examples/generic_associations/table_per_association.html">table_per_association.py</a>  - &#x8BF4;&#x660E;&#x4E00;&#x4E2A;&#x6DF7;&#x5408;&#xFF0C;&#x5B83;&#x901A;&#x8FC7;&#x4E3A;&#x6BCF;&#x4E2A;&#x7236;&#x7C7B;&#x5206;&#x522B;&#x751F;&#x6210;&#x7684;&#x5173;&#x8054;&#x8868;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x901A;&#x7528;&#x5173;&#x8054;&#x3002;</span><span class="yiyi-st" id="yiyi-101">&#x5173;&#x8054;&#x7684;&#x5BF9;&#x8C61;&#x672C;&#x8EAB;&#x88AB;&#x4FDD;&#x5B58;&#x5728;&#x6240;&#x6709;&#x7236;&#x6BCD;&#x5171;&#x4EAB;&#x7684;&#x5355;&#x4E2A;&#x8868;&#x4E2D;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-102"><a class="reference external" href="_modules/examples/generic_associations/discriminator_on_association.html">discriminator_on_association.py</a> - Illustrates a mixin which provides a generic association using a single target table and a single association table, referred to by all parent tables. </span><span class="yiyi-st" id="yiyi-103">&#x5173;&#x8054;&#x8868;&#x5305;&#x542B;&#x4E00;&#x4E2A;&#x201C;&#x9274;&#x522B;&#x5668;&#x201D;&#x5217;&#xFF0C;&#x7528;&#x4E8E;&#x786E;&#x5B9A;&#x4E0E;&#x5173;&#x8054;&#x8868;&#x4E2D;&#x6BCF;&#x4E2A;&#x7279;&#x5B9A;&#x884C;&#x5173;&#x8054;&#x7684;&#x7236;&#x5BF9;&#x8C61;&#x7684;&#x7C7B;&#x578B;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-104"><a class="reference external" href="_modules/examples/generic_associations/table_per_related.html">table_per_related.py</a>  - &#x8BF4;&#x660E;&#x4E86;&#x4E00;&#x4E2A;&#x901A;&#x7528;&#x5173;&#x8054;&#xFF0C;&#x5B83;&#x5728;&#x6BCF;&#x4E2A;&#x8868;&#x5185;&#x4FDD;&#x5B58;&#x5173;&#x8054;&#x5BF9;&#x8C61;&#xFF0C;&#x6BCF;&#x4E2A;&#x5173;&#x8054;&#x5BF9;&#x8C61;&#x90FD;&#x4F1A;&#x751F;&#x6210;&#x4EE5;&#x4EE3;&#x8868;&#x7279;&#x5B9A;&#x7236;&#x7C7B;&#x6301;&#x4E45;&#x5316;&#x8FD9;&#x4E9B;&#x5BF9;&#x8C61;&#x3002;</span></li></ul></div><div class="section" id="module-examples.large_collection"><h3><span class="yiyi-st" id="yiyi-105">&#x5927;&#x96C6;&#x5408;<a class="headerlink" href="#module-examples.large_collection" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-106">&#x5927;&#x96C6;&#x5408;&#x7684;&#x4F8B;&#x5B50;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-107">&#x8BF4;&#x660E;&#x5F53;&#x76F8;&#x5173;&#x5BF9;&#x8C61;&#x5217;&#x8868;&#x975E;&#x5E38;&#x5927;&#x65F6;&#xFF0C;&#x4E0E;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#x4E00;&#x8D77;&#x4F7F;&#x7528;&#x7684;&#x9009;&#x9879;&#xFF0C;&#x5176;&#x4E2D;&#x5305;&#x62EC;&#xFF1A;</span></p><ul class="simple"><li><span class="yiyi-st" id="yiyi-108">&#x201C;&#x52A8;&#x6001;&#x201D;&#x5173;&#x7CFB;&#x67E5;&#x8BE2;&#x8BBF;&#x95EE;&#x6570;&#x636E;&#x5207;&#x7247;</span></li><li><span class="yiyi-st" id="yiyi-109">&#x5982;&#x4F55;&#x5C06;ON DELETE CASCADE&#x4E0E;<code class="docutils literal"><span class="pre">passive_deletes=True</span></code>&#x7ED3;&#x5408;&#x4F7F;&#x7528;&#xFF0C;&#x4EE5;&#x5927;&#x5927;&#x63D0;&#x9AD8;&#x76F8;&#x5173;&#x96C6;&#x5408;&#x5220;&#x9664;&#x7684;&#x6027;&#x80FD;&#x3002;</span></li></ul><p><span class="yiyi-st" id="yiyi-110">&#x6587;&#x4EF6;&#x6E05;&#x5355;&#xFF1A;</span></p><ul class="simple"><li><span class="yiyi-st" id="yiyi-111"><a class="reference external" href="_modules/examples/large_collection/large_collection.html"> large_collection.py  T0&gt;</a></span></li></ul></div><div class="section" id="module-examples.materialized_paths"><h3><span class="yiyi-st" id="yiyi-112">&#x7269;&#x5316;&#x8DEF;&#x5F84;<a class="headerlink" href="#module-examples.materialized_paths" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-113">&#x4F7F;&#x7528;SQLAlchemy ORM&#x6F14;&#x793A;&#x5206;&#x5C42;&#x6570;&#x636E;&#x7684;&#x201C;&#x7269;&#x5316;&#x8DEF;&#x5F84;&#x201D;&#x6A21;&#x5F0F;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-114">&#x6587;&#x4EF6;&#x6E05;&#x5355;&#xFF1A;</span></p><ul class="simple"><li><span class="yiyi-st" id="yiyi-115"><a class="reference external" href="_modules/examples/materialized_paths/materialized_paths.html">materialized_pa&#x200B;&#x200B;ths.py</a>  - &#x8BF4;&#x660E;&#x4E86;&#x201C;&#x7269;&#x5316;&#x8DEF;&#x5F84;&#x201D;&#x6A21;&#x5F0F;&#x3002;</span></li></ul></div><div class="section" id="module-examples.nested_sets"><h3><span class="yiyi-st" id="yiyi-116">&#x5D4C;&#x5957;&#x96C6;<a class="headerlink" href="#module-examples.nested_sets" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-117">&#x8BF4;&#x660E;&#x4F7F;&#x7528;SQLAlchemy ORM&#x5B9E;&#x73B0;&#x5206;&#x5C42;&#x6570;&#x636E;&#x7684;&#x201C;&#x5D4C;&#x5957;&#x96C6;&#x201D;&#x6A21;&#x5F0F;&#x7684;&#x57FA;&#x672C;&#x65B9;&#x6CD5;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-118">&#x6587;&#x4EF6;&#x6E05;&#x5355;&#xFF1A;</span></p><ul class="simple"><li><span class="yiyi-st" id="yiyi-119"><a class="reference external" href="_modules/examples/nested_sets/nested_sets.html">nested_sets.py</a>  -  Celko&#x7684;&#x201C;&#x5D4C;&#x5957;&#x96C6;&#x201D;&#x6811;&#x7ED3;&#x6784;&#x3002;</span></li></ul></div><div class="section" id="module-examples.performance"><h3><span class="yiyi-st" id="yiyi-120">&#x6027;&#x80FD;<a class="headerlink" href="#module-examples.performance" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h3><p><span class="yiyi-st" id="yiyi-121">&#x6027;&#x80FD;&#x5206;&#x6790;&#x5957;&#x4EF6;&#xFF0C;&#x9002;&#x7528;&#x4E8E;&#x5404;&#x79CD;SQLAlchemy&#x7528;&#x4F8B;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-122">&#x6BCF;&#x4E2A;&#x5957;&#x4EF6;&#x90FD;&#x4E13;&#x6CE8;&#x4E8E;&#x5177;&#x6709;&#x7279;&#x5B9A;&#x6027;&#x80FD;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x548C;&#x76F8;&#x5173;&#x542B;&#x4E49;&#x7684;&#x7279;&#x5B9A;&#x7528;&#x4F8B;&#xFF1A;</span></p><ul class="simple"><li><span class="yiyi-st" id="yiyi-123">&#x6279;&#x91CF;&#x63D2;&#x5165;</span></li><li><span class="yiyi-st" id="yiyi-124">&#x4E2A;&#x4EBA;&#x63D2;&#x5165;&#xFF0C;&#x6709;&#x6216;&#x6CA1;&#x6709;&#x4EA4;&#x6613;</span></li><li><span class="yiyi-st" id="yiyi-125">&#x83B7;&#x53D6;&#x5927;&#x91CF;&#x7684;&#x884C;</span></li><li><span class="yiyi-st" id="yiyi-126">&#x8FD0;&#x884C;&#x5F88;&#x591A;&#x7B80;&#x77ED;&#x7684;&#x67E5;&#x8BE2;</span></li></ul><p><span class="yiyi-st" id="yiyi-127">&#x6240;&#x6709;&#x5957;&#x4EF6;&#x90FD;&#x5305;&#x542B;&#x4E86;&#x8BF4;&#x660E;Core&#x548C;ORM&#x4F7F;&#x7528;&#x7684;&#x5404;&#x79CD;&#x4F7F;&#x7528;&#x6A21;&#x5F0F;&#xFF0C;&#x5E76;&#x4E14;&#x901A;&#x5E38;&#x6309;&#x7167;&#x6027;&#x80FD;&#x4ECE;&#x6700;&#x5DEE;&#x5230;&#x6700;&#x5927;&#x7684;&#x987A;&#x5E8F;&#x8FDB;&#x884C;&#x6392;&#x5E8F;&#xFF0C;&#x4E0E;SQLAlchemy&#x63D0;&#x4F9B;&#x7684;&#x529F;&#x80FD;&#x6570;&#x91CF;&#x76F8;&#x53CD;&#xFF0C;&#x6700;&#x5927;&#x6700;&#x5C0F;&#xFF08;&#x8FD9;&#x4E24;&#x79CD;&#x60C5;&#x51B5;&#x901A;&#x5E38;&#x5B8C;&#x5168;&#x4E00;&#x81F4;&#xFF09;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-128">&#x5728;&#x5305;&#x7EA7;&#x522B;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x547D;&#x4EE4;&#x884C;&#x5DE5;&#x5177;&#xFF0C;&#x53EF;&#x4EE5;&#x8FD0;&#x884C;&#x5404;&#x4E2A;&#x5957;&#x4EF6;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>$ python -m examples.performance --help
usage: python -m examples.performance [-h] [--test TEST] [--dburl DBURL]
                                      [--num NUM] [--profile] [--dump]
                                      [--runsnake] [--echo]

                                      {bulk_inserts,large_resultsets,single_inserts}

positional arguments:
  {bulk_inserts,large_resultsets,single_inserts}
                        suite to run

optional arguments:
  -h, --help            show this help message and exit
  --test TEST           run specific test name
  --dburl DBURL         database URL, default sqlite:///profile.db
  --num NUM             Number of iterations/items/etc for tests; default is 0
                        module-specific
  --profile             run profiling and dump call counts
  --dump                dump full call profile (implies --profile)
  --runsnake            invoke runsnakerun (implies --profile)
  --echo                Echo SQL output</pre></div></div><p><span class="yiyi-st" id="yiyi-129">&#x793A;&#x4F8B;&#x8FD0;&#x884C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>$ python -m examples.performance bulk_inserts</pre></div></div><p><span class="yiyi-st" id="yiyi-130">&#x6216;&#x8005;&#x9009;&#x62E9;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>$ python -m examples.performance bulk_inserts \
    --dburl mysql+mysqldb://scott:tiger@localhost/test \
    --profile --num 1000</pre></div></div><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-131">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-132"><a class="reference internal" href="faq_performance.html#faq-how-to-profile"><span>How can I profile a SQLAlchemy powered application?</span></a></span></p></div><div class="section" id="file-listing"><h4><span class="yiyi-st" id="yiyi-133">&#x6863;&#x6848;&#x6E05;&#x5355;<a class="headerlink" href="#file-listing" title="Permalink to this headline">&#xB6;</a></span></h4><p><span class="yiyi-st" id="yiyi-134">&#x6587;&#x4EF6;&#x6E05;&#x5355;&#xFF1A;</span></p><ul class="simple"><li><span class="yiyi-st" id="yiyi-135"><a class="reference external" href="_modules/examples/performance/single_inserts.html">single_inserts.py</a>  - &#x5728;&#x8FD9;&#x4E00;&#x7CFB;&#x5217;&#x6D4B;&#x8BD5;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x6B63;&#x5728;&#x7814;&#x7A76;&#x4E00;&#x79CD;&#x5728;&#x72EC;&#x7ACB;&#x4E8B;&#x52A1;&#x4E2D;&#x63D2;&#x5165;&#x4E00;&#x884C;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x7136;&#x540E;&#x8FD4;&#x56DE;&#x5230;&#x57FA;&#x672C;&#x4E0A;&#x201C;&#x5173;&#x95ED;&#x201D;&#x72B6;&#x6001;&#x3002;</span><span class="yiyi-st" id="yiyi-136">&#x8FD9;&#x5C06;&#x7C7B;&#x4F3C;&#x4E8E;&#x542F;&#x52A8;&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;&#xFF0C;&#x63D2;&#x5165;&#x884C;&#xFF0C;&#x63D0;&#x4EA4;&#x548C;&#x5173;&#x95ED;&#x7684;API&#x8C03;&#x7528;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-137"><a class="reference external" href="_modules/examples/performance/short_selects.html">short_selects.py</a>  - &#x8FD9;&#x4E00;&#x7CFB;&#x5217;&#x6D4B;&#x8BD5;&#x8BF4;&#x660E;&#x4E86;&#x901A;&#x8FC7;&#x4E3B;&#x952E;&#x9009;&#x62E9;&#x5355;&#x4E2A;&#x8BB0;&#x5F55;&#x7684;&#x4E0D;&#x540C;&#x65B9;&#x5F0F;</span></li><li><span class="yiyi-st" id="yiyi-138"><a class="reference external" href="_modules/examples/performance/bulk_updates.html">bulk_updates.py</a>  - &#x8FD9;&#x4E00;&#x7CFB;&#x5217;&#x6D4B;&#x8BD5;&#x8BF4;&#x660E;&#x4E86;&#x6279;&#x91CF;&#x66F4;&#x65B0;&#x5927;&#x91CF;&#x884C;&#x7684;&#x4E0D;&#x540C;&#x65B9;&#x6CD5;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-139"><a class="reference external" href="_modules/examples/performance/bulk_inserts.html">bulk_inserts.py</a>  - &#x8FD9;&#x4E00;&#x7CFB;&#x5217;&#x6D4B;&#x8BD5;&#x8BF4;&#x660E;&#x4E86;&#x6279;&#x91CF;&#x63D2;&#x5165;&#x5927;&#x91CF;&#x884C;&#x7684;&#x4E0D;&#x540C;&#x65B9;&#x6CD5;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-140"><a class="reference external" href="_modules/examples/performance/large_resultsets.html">large_resultsets.py</a>  - &#x5728;&#x8FD9;&#x4E00;&#x7CFB;&#x5217;&#x6D4B;&#x8BD5;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x6B63;&#x5728;&#x8003;&#x8651;&#x52A0;&#x8F7D;&#x5927;&#x91CF;&#x975E;&#x5E38;&#x5C0F;&#x4E14;&#x7B80;&#x5355;&#x7684;&#x884C;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-141"><a class="reference external" href="_modules/examples/performance/__main__.html">__ main __&#x3002;py</a>  - &#x5141;&#x8BB8;&#x5C06;&#x793A;&#x4F8B;/&#x6027;&#x80FD;&#x5305;&#x4F5C;&#x4E3A;&#x811A;&#x672C;&#x8FD0;&#x884C;&#x3002;</span></li></ul></div><div class="section" id="running-all-tests-with-time"><h4><span class="yiyi-st" id="yiyi-142">&#x7528;&#x65F6;&#x95F4;&#x8FD0;&#x884C;&#x6240;&#x6709;&#x6D4B;&#x8BD5;<a class="headerlink" href="#running-all-tests-with-time" title="Permalink to this headline">&#xB6;</a></span></h4><p><span class="yiyi-st" id="yiyi-143">&#x8FD9;&#x662F;&#x8FD0;&#x884C;&#x7684;&#x9ED8;&#x8BA4;&#x5F62;&#x5F0F;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>$ python -m examples.performance single_inserts
Tests to run: test_orm_commit, test_bulk_save,
              test_bulk_insert_dictionaries, test_core,
              test_core_query_caching, test_dbapi_raw_w_connect,
              test_dbapi_raw_w_pool

test_orm_commit : Individual INSERT/COMMIT pairs via the
    ORM (10000 iterations); total time 13.690218 sec
test_bulk_save : Individual INSERT/COMMIT pairs using
    the &quot;bulk&quot; API  (10000 iterations); total time 11.290371 sec
test_bulk_insert_dictionaries : Individual INSERT/COMMIT pairs using
    the &quot;bulk&quot; API with dictionaries (10000 iterations);
    total time 10.814626 sec
test_core : Individual INSERT/COMMIT pairs using Core.
    (10000 iterations); total time 9.665620 sec
test_core_query_caching : Individual INSERT/COMMIT pairs using Core
    with query caching (10000 iterations); total time 9.209010 sec
test_dbapi_raw_w_connect : Individual INSERT/COMMIT pairs w/ DBAPI +
    connection each time (10000 iterations); total time 9.551103 sec
test_dbapi_raw_w_pool : Individual INSERT/COMMIT pairs w/ DBAPI +
    connection pool (10000 iterations); total time 8.001813 sec</pre></div></div></div><div class="section" id="dumping-profiles-for-individual-tests"><h4><span class="yiyi-st" id="yiyi-144">&#x4E3A;&#x5355;&#x4E2A;&#x6D4B;&#x8BD5;&#x8F6C;&#x50A8;&#x914D;&#x7F6E;&#x6587;&#x4EF6;<a class="headerlink" href="#dumping-profiles-for-individual-tests" title="Permalink to this headline">&#xB6;</a></span></h4><p><span class="yiyi-st" id="yiyi-145">Python&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x8F93;&#x51FA;&#x53EF;&#x4EE5;&#x8F6C;&#x50A8;&#x6240;&#x6709;&#x6D4B;&#x8BD5;&#xFF0C;&#x6216;&#x66F4;&#x5E38;&#x89C1;&#x7684;&#x5355;&#x4E2A;&#x6D4B;&#x8BD5;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>$ python -m examples.performance single_inserts --test test_core --num 1000 --dump
Tests to run: test_core
test_core : Individual INSERT/COMMIT pairs using Core. (1000 iterations); total fn calls 186109
         186109 function calls (186102 primitive calls) in 1.089 seconds

   Ordered by: internal time, call count

   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
     1000    0.634    0.001    0.634    0.001 {method &apos;commit&apos; of &apos;sqlite3.Connection&apos; objects}
     1000    0.154    0.000    0.154    0.000 {method &apos;execute&apos; of &apos;sqlite3.Cursor&apos; objects}
     1000    0.021    0.000    0.074    0.000 /Users/classic/dev/sqlalchemy/lib/sqlalchemy/sql/compiler.py:1950(_get_colparams)
     1000    0.015    0.000    0.034    0.000 /Users/classic/dev/sqlalchemy/lib/sqlalchemy/engine/default.py:503(_init_compiled)
        1    0.012    0.012    1.091    1.091 examples/performance/single_inserts.py:79(test_core)

    ...</pre></div></div></div><div class="section" id="using-runsnake"><h4><span class="yiyi-st" id="yiyi-146">&#x4F7F;&#x7528;RunSnake <a class="headerlink" href="#using-runsnake" title="Permalink to this headline">&#xB6;</a></span></h4><p><span class="yiyi-st" id="yiyi-147">&#x8BE5;&#x9009;&#x9879;&#x9700;&#x8981;&#x5B89;&#x88C5;<a class="reference external" href="https://pypi.python.org/pypi/RunSnakeRun">RunSnake</a>&#x547D;&#x4EE4;&#x884C;&#x5DE5;&#x5177;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>$ python -m examples.performance single_inserts --test test_core --num 1000 --runsnake</pre></div></div><p><span class="yiyi-st" id="yiyi-148">&#x5C06;&#x663E;&#x793A;&#x56FE;&#x5F62;RunSnake&#x8F93;&#x51FA;&#x3002;</span></p></div><div class="section" id="writing-your-own-suites"><h4><span class="yiyi-st" id="yiyi-149">&#x7F16;&#x5199;&#x81EA;&#x5DF1;&#x7684;&#x5957;&#x623F;<a class="headerlink" href="#writing-your-own-suites" title="Permalink to this headline">&#xB6;</a></span></h4><p><span class="yiyi-st" id="yiyi-150">profiler&#x5957;&#x4EF6;&#x7CFB;&#x7EDF;&#x662F;&#x53EF;&#x6269;&#x5C55;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x5E94;&#x7528;&#x4E8E;&#x60A8;&#x81EA;&#x5DF1;&#x7684;&#x4E00;&#x5957;&#x6D4B;&#x8BD5;&#x3002;</span><span class="yiyi-st" id="yiyi-151">&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x6709;&#x4EF7;&#x503C;&#x7684;&#x6280;&#x672F;&#xFF0C;&#x7528;&#x4E8E;&#x51B3;&#x5B9A;&#x4E00;&#x4E9B;&#x6027;&#x80FD;&#x5173;&#x952E;&#x7684;&#x4F8B;&#x7A0B;&#x7684;&#x6B63;&#x786E;&#x65B9;&#x6CD5;&#x3002;</span><span class="yiyi-st" id="yiyi-152">&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x60F3;&#x5206;&#x6790;&#x51E0;&#x79CD;&#x52A0;&#x8F7D;&#x4E4B;&#x95F4;&#x7684;&#x5DEE;&#x5F02;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;<code class="docutils literal"><span class="pre">test_loads.py</span></code>&#xFF0C;&#x5176;&#x4E2D;&#x5305;&#x542B;&#x4EE5;&#x4E0B;&#x5185;&#x5BB9;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">examples.performance</span> <span class="kn">import</span> <span class="n">Profiler</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">Column</span><span class="p">,</span> <span class="n">create_engine</span><span class="p">,</span> <span class="n">ForeignKey</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">relationship</span><span class="p">,</span> <span class="n">joinedload</span><span class="p">,</span> <span class="n">subqueryload</span><span class="p">,</span> <span class="n">Session</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>

<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>
<span class="n">engine</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">session</span> <span class="o">=</span> <span class="bp">None</span>


<span class="k">class</span> <span class="nc">Parent</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;parent&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">children</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Child&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Child</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;child&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">parent_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;parent.id&apos;</span><span class="p">))</span>


<span class="c1"># Init with name of file, default number of items</span>
<span class="n">Profiler</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="s2">&quot;test_loads&quot;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>


<span class="nd">@Profiler.setup_once</span>
<span class="k">def</span> <span class="nf">setup_once</span><span class="p">(</span><span class="n">dburl</span><span class="p">,</span> <span class="n">echo</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
    <span class="s2">&quot;setup once.  create an engine, insert fixture data&quot;</span>
    <span class="k">global</span> <span class="n">engine</span>
    <span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="n">dburl</span><span class="p">,</span> <span class="n">echo</span><span class="o">=</span><span class="n">echo</span><span class="p">)</span>
    <span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">drop_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
    <span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
    <span class="n">sess</span> <span class="o">=</span> <span class="n">Session</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
    <span class="n">sess</span><span class="o">.</span><span class="n">add_all</span><span class="p">([</span>
        <span class="n">Parent</span><span class="p">(</span><span class="n">children</span><span class="o">=</span><span class="p">[</span><span class="n">Child</span><span class="p">()</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">)])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
    <span class="p">])</span>
    <span class="n">sess</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>


<span class="nd">@Profiler.setup</span>
<span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="n">dburl</span><span class="p">,</span> <span class="n">echo</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
    <span class="s2">&quot;setup per test.  create a new Session.&quot;</span>
    <span class="k">global</span> <span class="n">session</span>
    <span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
    <span class="c1"># pre-connect so this part isn&apos;t profiled (if we choose)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">connection</span><span class="p">()</span>


<span class="nd">@Profiler.profile</span>
<span class="k">def</span> <span class="nf">test_lazyload</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="s2">&quot;load everything, no eager loading.&quot;</span>

    <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Parent</span><span class="p">):</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">children</span>


<span class="nd">@Profiler.profile</span>
<span class="k">def</span> <span class="nf">test_joinedload</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="s2">&quot;load everything, joined eager loading.&quot;</span>

    <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Parent</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">joinedload</span><span class="p">(</span><span class="s2">&quot;children&quot;</span><span class="p">)):</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">children</span>


<span class="nd">@Profiler.profile</span>
<span class="k">def</span> <span class="nf">test_subqueryload</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="s2">&quot;load everything, subquery eager loading.&quot;</span>

    <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Parent</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">subqueryload</span><span class="p">(</span><span class="s2">&quot;children&quot;</span><span class="p">)):</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">children</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&apos;__main__&apos;</span><span class="p">:</span>
    <span class="n">Profiler</span><span class="o">.</span><span class="n">main</span><span class="p">()</span></pre></div></div><p><span class="yiyi-st" id="yiyi-153">&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8FD0;&#x884C;&#x6211;&#x4EEC;&#x7684;&#x65B0;&#x811A;&#x672C;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>$ python test_loads.py  --dburl postgresql+psycopg2://scott:tiger@localhost/test
Running setup once...
Tests to run: test_lazyload, test_joinedload, test_subqueryload
test_lazyload : load everything, no eager loading. (1000 iterations); total time 11.971159 sec
test_joinedload : load everything, joined eager loading. (1000 iterations); total time 2.754592 sec
test_subqueryload : load everything, subquery eager loading. (1000 iterations); total time 2.977696 sec</pre></div></div><p><span class="yiyi-st" id="yiyi-154">&#x4EE5;&#x53CA;RunSnake&#x8F93;&#x51FA;&#x7684;&#x4E2A;&#x4EBA;&#x6D4B;&#x8BD5;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>$ python test_loads.py  --num 100 --runsnake --test test_joinedload</pre></div></div></div></div><div class="section" id="module-examples.join_conditions"><h3><span class="yiyi-st" id="yiyi-155">&#x5173;&#x7CFB;&#x8FDE;&#x63A5;&#x6761;&#x4EF6;<a class="headerlink" href="#module-examples.join_conditions" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-156">&#x5404;&#x79CD;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">orm.relationship()</span></code></a>&#x914D;&#x7F6E;&#x7684;&#x793A;&#x4F8B;&#xFF0C;&#x5B83;&#x4EEC;&#x5229;&#x7528;<code class="docutils literal"><span class="pre">primaryjoin</span></code>&#x53C2;&#x6570;&#x6765;&#x7EC4;&#x5408;&#x7279;&#x6B8A;&#x7C7B;&#x578B;&#x7684;&#x8FDE;&#x63A5;&#x6761;&#x4EF6;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-157">&#x6587;&#x4EF6;&#x6E05;&#x5355;&#xFF1A;</span></p><ul class="simple"><li><span class="yiyi-st" id="yiyi-158"><a class="reference external" href="_modules/examples/join_conditions/cast.html">cast.py</a>  - &#x8BF4;&#x660E;&#x8FDE;&#x63A5;&#x4E24;&#x5217;&#x7684;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#xFF0C;&#x5176;&#x4E2D;&#x8FD9;&#x4E9B;&#x5217;&#x7684;&#x7C7B;&#x578B;&#x4E0D;&#x540C;&#xFF0C;&#x5E76;&#x4E14;&#x5FC5;&#x987B;&#x5728;SQL&#x7AEF;&#x4F7F;&#x7528;CAST&#x4EE5;&#x4FBF;&#x5339;&#x914D;&#x4ED6;&#x4EEC;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-159"><a class="reference external" href="_modules/examples/join_conditions/threeway.html">threeway.py</a> - Illustrate a &#x201C;three way join&#x201D; - where a primary table joins to a remote table via an association table, but then the primary table also needs to refer to some columns in the remote table directly.</span></li></ul></div><div class="section" id="module-examples.elementtree"><h3><span class="yiyi-st" id="yiyi-160">XML&#x6301;&#x4E45;<a class="headerlink" href="#module-examples.elementtree" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-161">&#x4E3E;&#x4F8B;&#x8BF4;&#x660E;&#x4E86;&#x5728;&#x5173;&#x7CFB;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x7528;ElementTree&#x8868;&#x793A;&#x7684;&#x6301;&#x4E45;&#x5316;&#x548C;&#x67E5;&#x8BE2;XML&#x6587;&#x6863;&#x7684;&#x4E09;&#x79CD;&#x7B56;&#x7565;&#x3002;</span><span class="yiyi-st" id="yiyi-162">&#x8FD9;&#x4E9B;&#x6280;&#x672F;&#x4E0D;&#x76F4;&#x63A5;&#x5BF9;ElementTree&#x5BF9;&#x8C61;&#x5E94;&#x7528;&#x4EFB;&#x4F55;&#x6620;&#x5C04;&#xFF0C;&#x56E0;&#x6B64;&#x4E0E;&#x672C;&#x5730;cElementTree&#x4EE5;&#x53CA;lxml&#x517C;&#x5BB9;&#xFF0C;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x9002;&#x5E94;&#x4EFB;&#x4F55;&#x7C7B;&#x578B;&#x7684;DOM&#x8868;&#x793A;&#x7CFB;&#x7EDF;&#x3002;</span><span class="yiyi-st" id="yiyi-163">&#x4E5F;&#x663E;&#x793A;&#x4E86;&#x6CBF;&#x7C7B;&#x4F3C;xpath&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x67E5;&#x8BE2;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-164">&#x4F8B;&#x5982;&#x3002;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># parse an XML file and persist in the database</span>
<span class="n">doc</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;test.xml&quot;</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Document</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="n">doc</span><span class="p">))</span>
<span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<span class="c1"># locate documents with a certain path/attribute structure</span>
<span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="n">find_document</span><span class="p">(</span><span class="s1">&apos;/somefile/header/field2[@attr=foo]&apos;</span><span class="p">):</span>
    <span class="c1"># dump the XML</span>
    <span class="k">print</span> <span class="n">document</span></pre></div></div><p><span class="yiyi-st" id="yiyi-165">&#x6587;&#x4EF6;&#x6E05;&#x5355;&#xFF1A;</span></p><ul class="simple"><li><span class="yiyi-st" id="yiyi-166"><a class="reference external" href="_modules/examples/elementtree/pickle.html">pickle.py</a> - illustrates a quick and dirty way to persist an XML document expressed using ElementTree and pickle.</span></li><li><span class="yiyi-st" id="yiyi-167"><a class="reference external" href="_modules/examples/elementtree/adjacency_list.html">adjacency_list.py</a>  - &#x8BF4;&#x660E;&#x4E86;&#x4F7F;&#x7528;ElementTree&#x4FDD;&#x5B58;&#x8868;&#x793A;&#x7684;XML&#x6587;&#x6863;&#x7684;&#x660E;&#x786E;&#x65B9;&#x5F0F;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-168"><a class="reference external" href="_modules/examples/elementtree/optimized_al.html">optimized_al.py</a>  - &#x4F7F;&#x7528;&#x4E0E;<code class="docutils literal"><span class="pre">adjacency_list.py</span></code>&#x76F8;&#x540C;&#x7684;&#x7B56;&#x7565;&#xFF0C;&#x4F46;&#x5C06;&#x6BCF;&#x4E2A;DOM&#x884C;&#x4E0E;&#x5176;&#x62E5;&#x6709;&#x7684;&#x6587;&#x6863;&#x884C;&#x76F8;&#x5173;&#x8054;&#xFF0C;&#x4EE5;&#x4FBF;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;DOM&#x8282;&#x70B9;&#x7684;&#x5B8C;&#x6574;&#x6587;&#x6863;&#x52A0;&#x8F7D;O&#xFF08;1&#xFF09;&#x67E5;&#x8BE2; - &#x6784;&#x5EFA;&#x201C;&#x5C42;&#x6B21;&#x7ED3;&#x6784;&#x201D;&#x662F;&#x5728;&#x975E;&#x9012;&#x5F52;&#x65B9;&#x5F0F;&#x52A0;&#x8F7D;&#x4E4B;&#x540E;&#x6267;&#x884C;&#x7684;&#xFF0C;&#x5E76;&#x4E14;&#x6548;&#x7387;&#x66F4;&#x9AD8;&#x3002;</span></li></ul></div><div class="section" id="versioning-objects"><h3><span class="yiyi-st" id="yiyi-169">&#x7248;&#x672C;&#x63A7;&#x5236;&#x5BF9;&#x8C61;<a class="headerlink" href="#versioning-objects" title="Permalink to this headline">&#xB6;</a></span></h3><div class="section" id="module-examples.versioned_history"><h4><span class="yiyi-st" id="yiyi-170">&#x4F7F;&#x7528;&#x5386;&#x53F2;&#x8BB0;&#x5F55;&#x8868;&#x8FDB;&#x884C;&#x7248;&#x672C;&#x63A7;&#x5236;<a class="headerlink" href="#module-examples.versioned_history" title="Permalink to this headline">&#xB6;</a></span></h4><p><span class="yiyi-st" id="yiyi-171">&#x8BF4;&#x660E;&#x4E3A;&#x5B9E;&#x4F53;&#x521B;&#x5EFA;&#x7248;&#x672C;&#x8868;&#x7684;&#x6269;&#x5C55;&#xFF0C;&#x5E76;&#x4E3A;&#x6BCF;&#x4E2A;&#x66F4;&#x6539;&#x5B58;&#x50A8;&#x8BB0;&#x5F55;&#x3002;</span><span class="yiyi-st" id="yiyi-172">&#x7ED9;&#x5B9A;&#x7684;&#x6269;&#x5C55;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x533F;&#x540D;&#x7684;&#x201C;&#x5386;&#x53F2;&#x201D;&#x7C7B;&#xFF0C;&#x5B83;&#x8868;&#x793A;&#x76EE;&#x6807;&#x5BF9;&#x8C61;&#x7684;&#x5386;&#x53F2;&#x7248;&#x672C;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-173">&#x7528;&#x6CD5;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x6A21;&#x5757;<code class="docutils literal"><span class="pre">test_versioning.py</span></code>&#x6765;&#x8BF4;&#x660E;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x9F3B;&#x5B50;&#x8FD0;&#x884C;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>cd examples/versioning
nosetests -v</pre></div></div><p><span class="yiyi-st" id="yiyi-174">&#x793A;&#x4F8B;&#x7528;&#x6CD5;&#x7684;&#x7247;&#x6BB5;&#xFF0C;&#x4F7F;&#x7528;&#x58F0;&#x660E;&#x5F0F;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">history_meta</span> <span class="kn">import</span> <span class="n">Versioned</span><span class="p">,</span> <span class="n">versioned_session</span>

<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">SomeClass</span><span class="p">(</span><span class="n">Versioned</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;sometable&apos;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">is</span> <span class="n">SomeClass</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>

<span class="n">Session</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
<span class="n">versioned_session</span><span class="p">(</span><span class="n">Session</span><span class="p">)</span>

<span class="n">sess</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>
<span class="n">sc</span> <span class="o">=</span> <span class="n">SomeClass</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&apos;sc1&apos;</span><span class="p">)</span>
<span class="n">sess</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>
<span class="n">sess</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<span class="n">sc</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&apos;sc1modified&apos;</span>
<span class="n">sess</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<span class="k">assert</span> <span class="n">sc</span><span class="o">.</span><span class="n">version</span> <span class="o">==</span> <span class="mi">2</span>

<span class="n">SomeClassHistory</span> <span class="o">=</span> <span class="n">SomeClass</span><span class="o">.</span><span class="n">__history_mapper__</span><span class="o">.</span><span class="n">class_</span>

<span class="k">assert</span> <span class="n">sess</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">SomeClassHistory</span><span class="p">)</span><span class="o">.</span>\
            <span class="nb">filter</span><span class="p">(</span><span class="n">SomeClassHistory</span><span class="o">.</span><span class="n">version</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span>\
            <span class="nb">all</span><span class="p">()</span> \
            <span class="o">==</span> <span class="p">[</span><span class="n">SomeClassHistory</span><span class="p">(</span><span class="n">version</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&apos;sc1&apos;</span><span class="p">)]</span></pre></div></div><p><span class="yiyi-st" id="yiyi-175"><code class="docutils literal"><span class="pre">Versioned</span></code> mixin&#x8BBE;&#x8BA1;&#x7528;&#x4E8E;&#x58F0;&#x660E;&#x5F0F;&#x3002;</span><span class="yiyi-st" id="yiyi-176">&#x8981;&#x4F7F;&#x7528;&#x7ECF;&#x5178;&#x6620;&#x5C04;&#x5668;&#x7684;&#x6269;&#x5C55;&#xFF0C;&#x53EF;&#x4EE5;&#x5E94;&#x7528;<code class="docutils literal"><span class="pre">_history_mapper</span></code>&#x51FD;&#x6570;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">history_meta</span> <span class="kn">import</span> <span class="n">_history_mapper</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">mapper</span><span class="p">(</span><span class="n">SomeClass</span><span class="p">,</span> <span class="n">sometable</span><span class="p">)</span>
<span class="n">_history_mapper</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="n">SomeHistoryClass</span> <span class="o">=</span> <span class="n">SomeClass</span><span class="o">.</span><span class="n">__history_mapper__</span><span class="o">.</span><span class="n">class_</span></pre></div></div><p><span class="yiyi-st" id="yiyi-177">&#x6587;&#x4EF6;&#x6E05;&#x5355;&#xFF1A;</span></p><ul class="simple"><li><span class="yiyi-st" id="yiyi-178"><a class="reference external" href="_modules/examples/versioned_history/history_meta.html">history_meta.py</a>  - &#x7248;&#x672C;&#x5316;&#x7684;mixin&#x7C7B;&#x548C;&#x5176;&#x4ED6;&#x5B9E;&#x7528;&#x7A0B;&#x5E8F;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-179"><a class="reference external" href="_modules/examples/versioned_history/test_versioning.html">test_versioning.py</a>  - &#x8BF4;&#x660E;&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">history_meta.py</span></code>&#x6A21;&#x5757;&#x51FD;&#x6570;&#x7684;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x3002;</span></li></ul></div><div class="section" id="module-examples.versioned_rows"><h4><span class="yiyi-st" id="yiyi-180">&#x4F7F;&#x7528;&#x65F6;&#x95F4;&#x884C;&#x7684;&#x7248;&#x672C;&#x63A7;&#x5236;<a class="headerlink" href="#module-examples.versioned_rows" title="Permalink to this headline">&#xB6;</a></span></h4><p><span class="yiyi-st" id="yiyi-181">&#x8BF4;&#x660E;&#x901A;&#x8FC7;&#x4E3A;&#x6BCF;&#x4E2A;&#x66F4;&#x6539;&#x5B58;&#x50A8;&#x65B0;&#x884C;&#x6765;&#x5BF9;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x7248;&#x672C;&#x5347;&#x7EA7;&#x7684;&#x6269;&#x5C55;&#xFF1B;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x901A;&#x5E38;UPDATE&#x53D8;&#x6210;INSERT&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-182">&#x6587;&#x4EF6;&#x6E05;&#x5355;&#xFF1A;</span></p><ul class="simple"><li><span class="yiyi-st" id="yiyi-183"><a class="reference external" href="_modules/examples/versioned_rows/versioned_rows.html">versioned_rows.py</a>  - &#x8BF4;&#x660E;&#x62E6;&#x622A;&#x5BF9;&#x8C61;&#x66F4;&#x6539;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5C06;&#x5355;&#x4E2A;&#x884C;&#x4E0A;&#x7684;UPDATE&#x8BED;&#x53E5;&#x8F6C;&#x6362;&#x4E3A;INSERT&#x8BED;&#x53E5;&#xFF0C;&#x4EE5;&#x4FBF;&#x4F7F;&#x7528;&#x65B0;&#x6570;&#x636E;&#x63D2;&#x5165;&#x65B0;&#x884C;&#xFF0C;&#x4F7F;&#x65E7;&#x884C;&#x4FDD;&#x6301;&#x4E0D;&#x53D8;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-184"><a class="reference external" href="_modules/examples/versioned_rows/versioned_map.html">versioned_map.py</a>  -  versioned_rows&#x793A;&#x4F8B;&#x7684;&#x53D8;&#x4F53;&#x3002;</span><span class="yiyi-st" id="yiyi-185">&#x5728;&#x8FD9;&#x91CC;&#xFF0C;&#x6211;&#x4EEC;&#x5B58;&#x50A8;&#x4E00;&#x4E2A;&#x952E;/&#x503C;&#x5BF9;&#x7684;&#x5B57;&#x5178;&#xFF0C;&#x4EE5;&#x201C;&#x5782;&#x76F4;&#x201D;&#x65B9;&#x5F0F;&#x5B58;&#x50A8;k / v&#xFF0C;&#x6BCF;&#x4E2A;&#x952E;&#x83B7;&#x5F97;&#x4E00;&#x884C;&#x3002;</span><span class="yiyi-st" id="yiyi-186">&#x8BE5;&#x503C;&#x88AB;&#x5206;&#x6210;&#x4E24;&#x4E2A;&#x72EC;&#x7ACB;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#xFF0C;&#x5B57;&#x7B26;&#x4E32;&#x548C;&#x6574;&#x6570; - &#x6570;&#x636E;&#x7C7B;&#x578B;&#x5B58;&#x50A8;&#x7684;&#x8303;&#x56F4;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x4E2A;&#x4EBA;&#x9700;&#x6C42;&#x8FDB;&#x884C;&#x8C03;&#x6574;&#x3002;</span></li></ul></div></div><div class="section" id="module-examples.vertical"><h3><span class="yiyi-st" id="yiyi-187">&#x5782;&#x76F4;&#x5C5E;&#x6027;&#x6620;&#x5C04;<a class="headerlink" href="#module-examples.vertical" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-188">&#x8BF4;&#x660E;&#x201C;&#x5782;&#x76F4;&#x8868;&#x201D;&#x6620;&#x5C04;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-189">&#x201C;&#x5782;&#x76F4;&#x8868;&#x201D;&#x662F;&#x6307;&#x5C06;&#x5BF9;&#x8C61;&#x7684;&#x5404;&#x4E2A;&#x5C5E;&#x6027;&#x4F5C;&#x4E3A;&#x4E0D;&#x540C;&#x7684;&#x884C;&#x5B58;&#x50A8;&#x5728;&#x8868;&#x4E2D;&#x7684;&#x6280;&#x672F;&#x3002;</span><span class="yiyi-st" id="yiyi-190">&#x201C;&#x5782;&#x76F4;&#x8868;&#x201D;&#x6280;&#x672F;&#x7528;&#x4E8E;&#x6301;&#x4E45;&#x5316;&#x53EF;&#x80FD;&#x5177;&#x6709;&#x5404;&#x79CD;&#x5C5E;&#x6027;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x4EE3;&#x4EF7;&#x662F;&#x7B80;&#x5355;&#x7684;&#x67E5;&#x8BE2;&#x63A7;&#x5236;&#x548C;&#x7B80;&#x6D01;&#x3002;</span><span class="yiyi-st" id="yiyi-191">&#x5B83;&#x901A;&#x5E38;&#x5B58;&#x5728;&#x4E8E;&#x5185;&#x5BB9;/&#x6587;&#x6863;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;&#x4E2D;&#xFF0C;&#x4EE5;&#x4FBF;&#x7075;&#x6D3B;&#x5730;&#x8868;&#x793A;&#x7528;&#x6237;&#x521B;&#x5EFA;&#x7684;&#x7ED3;&#x6784;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-192">&#x7ED9;&#x51FA;&#x4E86;&#x4E24;&#x79CD;&#x4E0D;&#x540C;&#x7684;&#x65B9;&#x6CD5;&#x3002;</span><span class="yiyi-st" id="yiyi-193">&#x5728;&#x7B2C;&#x4E8C;&#x884C;&#x4E2D;&#xFF0C;&#x6BCF;&#x884C;&#x90FD;&#x5F15;&#x7528;&#x4E00;&#x4E2A;&#x201C;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x201D;&#xFF0C;&#x5176;&#x4E2D;&#x5305;&#x542B;&#x6709;&#x5173;&#x5B58;&#x50A8;&#x5728;&#x5C5E;&#x6027;&#x4E2D;&#x7684;&#x4FE1;&#x606F;&#x7C7B;&#x578B;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x4F8B;&#x5982;&#x6574;&#x6570;&#xFF0C;&#x5B57;&#x7B26;&#x4E32;&#x6216;&#x65E5;&#x671F;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-194">&#x4F8B;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">shrew</span> <span class="o">=</span> <span class="n">Animal</span><span class="p">(</span><span class="s1">u&apos;shrew&apos;</span><span class="p">)</span>
<span class="n">shrew</span><span class="p">[</span><span class="s1">u&apos;cuteness&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">shrew</span><span class="p">[</span><span class="s1">u&apos;weasel-like&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">shrew</span><span class="p">[</span><span class="s1">u&apos;poisonous&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>

<span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">shrew</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

<span class="n">q</span> <span class="o">=</span> <span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Animal</span><span class="p">)</span><span class="o">.</span>
     <span class="nb">filter</span><span class="p">(</span><span class="n">Animal</span><span class="o">.</span><span class="n">facts</span><span class="o">.</span><span class="n">any</span><span class="p">(</span>
       <span class="n">and_</span><span class="p">(</span><span class="n">AnimalFact</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="s1">u&apos;weasel-like&apos;</span><span class="p">,</span>
            <span class="n">AnimalFact</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="bp">True</span><span class="p">))))</span>
<span class="k">print</span> <span class="s1">&apos;weasel-like animals&apos;</span><span class="p">,</span> <span class="n">q</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></pre></div></div><p><span class="yiyi-st" id="yiyi-195">&#x6587;&#x4EF6;&#x6E05;&#x5355;&#xFF1A;</span></p><ul class="simple"><li><span class="yiyi-st" id="yiyi-196"><a class="reference external" href="_modules/examples/vertical/dictlike.html">dictlike.py</a>  - &#x5C06;&#x5782;&#x76F4;&#x8868;&#x6620;&#x5C04;&#x4E3A;&#x5B57;&#x5178;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-197"><a class="reference external" href="_modules/examples/vertical/dictlike-polymorphic.html">dictlike-polymorphic.py</a>  - &#x5C06;&#x591A;&#x6001;&#x503C;&#x5782;&#x76F4;&#x8868;&#x6620;&#x5C04;&#x4E3A;&#x5B57;&#x5178;&#x3002;</span></li></ul></div></div><div class="section" id="inheritance-mapping-recipes"><h2><span class="yiyi-st" id="yiyi-198">&#x7EE7;&#x627F;&#x6620;&#x5C04;&#x98DF;&#x8C31;<a class="headerlink" href="#inheritance-mapping-recipes" title="Permalink to this headline">&#xB6;</a></span></h2><div class="section" id="module-examples.inheritance"><h3><span class="yiyi-st" id="yiyi-199">&#x57FA;&#x672C;&#x7EE7;&#x627F;&#x6620;&#x5C04;<a class="headerlink" href="#module-examples.inheritance" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-200">&#x5982;<span class="xref std std-ref">datamapping_inheritance</span>&#x4E2D;&#x6240;&#x8FF0;&#x7684;&#x5355;&#x8868;&#xFF0C;&#x8FDE;&#x63A5;&#x8868;&#x548C;&#x6DF7;&#x51DD;&#x571F;&#x8868;&#x7EE7;&#x627F;&#x7684;&#x5DE5;&#x4F5C;&#x793A;&#x4F8B;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-201">&#x6587;&#x4EF6;&#x6E05;&#x5355;&#xFF1A;</span></p><ul class="simple"><li><span class="yiyi-st" id="yiyi-202"><a class="reference external" href="_modules/examples/inheritance/concrete.html">concrete.py</a>  -  Concrete&#xFF08;table-per-class&#xFF09;&#x7EE7;&#x627F;&#x7684;&#x4F8B;&#x5B50;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-203"><a class="reference external" href="_modules/examples/inheritance/single.html">single.py</a>  - &#x5355;&#x8868;&#x7EE7;&#x627F;&#x793A;&#x4F8B;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-204"><a class="reference external" href="_modules/examples/inheritance/joined.html">joined.py</a>  - &#x8054;&#x5408;&#x8868;&#xFF08;&#x7EE7;&#x627F;&#x7684;&#x5B50;&#x7C7B;&#xFF09;&#x7EE7;&#x627F;&#x793A;&#x4F8B;&#x3002;</span></li></ul></div></div><div class="section" id="special-apis"><h2><span class="yiyi-st" id="yiyi-205">&#x7279;&#x6B8A;&#x7684;API <a class="headerlink" href="#special-apis" title="Permalink to this headline">&#xB6;</a></span></h2><div class="section" id="module-examples.custom_attributes"><h3><span class="yiyi-st" id="yiyi-206">&#x5C5E;&#x6027;&#x5DE5;&#x5177;<a class="headerlink" href="#module-examples.custom_attributes" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-207">&#x4E3E;&#x4F8B;&#x8BF4;&#x660E;&#x5BF9;SQLAlchemy&#x5C5E;&#x6027;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;&#x7684;&#x4FEE;&#x6539;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-208">&#x6587;&#x4EF6;&#x6E05;&#x5355;&#xFF1A;</span></p><ul class="simple"><li><span class="yiyi-st" id="yiyi-209"><a class="reference external" href="_modules/examples/custom_attributes/custom_management.html">custom_management.py</a>  - &#x4F7F;&#x7528;<a class="reference internal" href="extensions_instrumentation.html#module-sqlalchemy.ext.instrumentation" title="sqlalchemy.ext.instrumentation"><code class="xref py py-mod docutils literal"><span class="pre">sqlalchemy.ext.instrumentation</span></code></a>&#x6269;&#x5C55;&#x5305;&#x8BF4;&#x660E;&#x5B9A;&#x5236;&#x7684;&#x7C7B;&#x5DE5;&#x5177;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-210"><a class="reference external" href="_modules/examples/custom_attributes/listen_for_events.html">listen_for_events.py</a>  - &#x8BF4;&#x660E;&#x5982;&#x4F55;&#x5C06;&#x4E8B;&#x4EF6;&#x9644;&#x52A0;&#x5230;&#x6240;&#x6709;&#x5DF2;&#x68C0;&#x6D4B;&#x7684;&#x5C5E;&#x6027;&#x5E76;&#x4FA6;&#x542C;&#x66F4;&#x6539;&#x4E8B;&#x4EF6;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-211"><a class="reference external" href="_modules/examples/custom_attributes/active_column_defaults.html">active_column_defaults.py</a>  - &#x8BF4;&#x660E;&#x5982;&#x4F55;&#x4F7F;&#x7528;<a class="reference internal" href="events.html#sqlalchemy.orm.events.AttributeEvents.init_scalar" title="sqlalchemy.orm.events.AttributeEvents.init_scalar"><code class="xref py py-meth docutils literal"><span class="pre">AttributeEvents.init_scalar()</span></code></a>&#x4E8B;&#x4EF6;&#x4E0E;Core&#x5217;&#x9ED8;&#x8BA4;&#x503C;&#x4E00;&#x8D77;&#x63D0;&#x4F9B;ORM&#x5BF9;&#x8C61;&#xFF0C;&#x8BE5;&#x5BF9;&#x8C61;&#x5728;&#x672A;&#x8BBE;&#x7F6E;&#x65F6;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x9ED8;&#x8BA4;&#x503C;&#x5C5E;&#x6027;&#x88AB;&#x8BBF;&#x95EE;&#x3002;</span></li></ul></div><div class="section" id="module-examples.sharding"><h3><span class="yiyi-st" id="yiyi-212">&#x6C34;&#x5E73;&#x5206;&#x7247;<a class="headerlink" href="#module-examples.sharding" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-213">&#x4F7F;&#x7528;SQLAlchemy Sharding API&#x7684;&#x57FA;&#x672C;&#x793A;&#x4F8B;&#x3002;</span><span class="yiyi-st" id="yiyi-214">&#x5206;&#x7247;&#x662F;&#x6307;&#x8DE8;&#x591A;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#x6C34;&#x5E73;&#x7F29;&#x653E;&#x6570;&#x636E;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-215">&#x201C;&#x5206;&#x7247;&#x201D;&#x6620;&#x5C04;&#x7684;&#x57FA;&#x672C;&#x7EC4;&#x4EF6;&#x662F;&#xFF1A;</span></p><ul class="simple"><li><span class="yiyi-st" id="yiyi-216">&#x591A;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x6BCF;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#x5206;&#x914D;&#x4E00;&#x4E2A;&apos;&#x5206;&#x7247;ID&apos;</span></li><li><span class="yiyi-st" id="yiyi-217">&#x7ED9;&#x5B9A;&#x8981;&#x4FDD;&#x5B58;&#x7684;&#x5B9E;&#x4F8B;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x8FD4;&#x56DE;&#x5355;&#x4E2A;&#x5206;&#x7247;ID&#xFF1B;&#x8FD9;&#x88AB;&#x79F0;&#x4E3A;&#x201C;shard_chooser&#x201D;</span></li><li><span class="yiyi-st" id="yiyi-218">&#x4E00;&#x4E2A;&#x53EF;&#x4EE5;&#x8FD4;&#x56DE;&#x9002;&#x7528;&#x4E8E;&#x7279;&#x5B9A;&#x5B9E;&#x4F8B;&#x6807;&#x8BC6;&#x7B26;&#x7684;&#x5206;&#x7247;ID&#x5217;&#x8868;&#x7684;&#x51FD;&#x6570;&#xFF1B;&#x8FD9;&#x88AB;&#x79F0;&#x4E3A;&#x201C;id_chooser&#x201D;&#x3002;</span><span class="yiyi-st" id="yiyi-219">&#x5982;&#x679C;&#x5B83;&#x8FD4;&#x56DE;&#x6240;&#x6709;&#x5206;&#x7247;ID&#xFF0C;&#x5219;&#x5C06;&#x641C;&#x7D22;&#x6240;&#x6709;&#x5206;&#x7247;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-220">&#x7ED9;&#x5B9A;&#x4E00;&#x4E2A;&#x7279;&#x5B9A;&#x7684;&#x67E5;&#x8BE2;&#xFF08;&#x201C;query_chooser&#x201D;&#xFF09;&#xFF0C;&#x8BE5;&#x51FD;&#x6570;&#x53EF;&#x4EE5;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x5206;&#x7247;ID&#x5217;&#x8868;&#x6765;&#x5C1D;&#x8BD5;&#x3002;</span><span class="yiyi-st" id="yiyi-221">&#x5982;&#x679C;&#x5B83;&#x8FD4;&#x56DE;&#x6240;&#x6709;&#x5206;&#x7247;ID&#xFF0C;&#x5219;&#x5C06;&#x67E5;&#x8BE2;&#x6240;&#x6709;&#x5206;&#x7247;&#x5E76;&#x5C06;&#x7ED3;&#x679C;&#x8FDE;&#x63A5;&#x5728;&#x4E00;&#x8D77;&#x3002;</span></li></ul><p><span class="yiyi-st" id="yiyi-222">&#x5728;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x56DB;&#x4E2A;sqlite&#x6570;&#x636E;&#x5E93;&#x5C06;&#x4EE5;&#x6BCF;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#x4E3A;&#x57FA;&#x7840;&#x5B58;&#x50A8;&#x5173;&#x4E8E;&#x5929;&#x6C14;&#x6570;&#x636E;&#x7684;&#x4FE1;&#x606F;&#x3002;</span><span class="yiyi-st" id="yiyi-223">&#x6211;&#x4EEC;&#x63D0;&#x4F9B;&#x4E86;&#x793A;&#x4F8B;shard_chooser&#xFF0C;id_chooser&#x548C;query_chooser&#x51FD;&#x6570;&#x3002;</span><span class="yiyi-st" id="yiyi-224">query_chooser&#x8BF4;&#x660E;&#x4E86;&#x5BF9;SQL&#x8868;&#x8FBE;&#x5F0F;&#x5143;&#x7D20;&#x7684;&#x68C0;&#x67E5;&#xFF0C;&#x4EE5;&#x8BD5;&#x56FE;&#x786E;&#x5B9A;&#x88AB;&#x8BF7;&#x6C42;&#x7684;&#x5355;&#x4E2A;&#x5206;&#x7247;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-225">&#x901A;&#x7528;&#x5206;&#x7247;&#x4F8B;&#x7A0B;&#x7684;&#x6784;&#x5EFA;&#x662F;&#x5728;&#x591A;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#x4E4B;&#x95F4;&#x7EC4;&#x7EC7;&#x5B9E;&#x4F8B;&#x7684;&#x95EE;&#x9898;&#x7684;&#x4E00;&#x4E2A;&#x96C4;&#x5FC3;&#x52C3;&#x52C3;&#x7684;&#x65B9;&#x6CD5;&#x3002;</span><span class="yiyi-st" id="yiyi-226">&#x5BF9;&#x4E8E;&#x4E00;&#x4E2A;&#x66F4;&#x4E3A;&#x901A;&#x4FD7;&#x6613;&#x61C2;&#x7684;&#x66FF;&#x4EE3;&#x65B9;&#x6CD5;&#xFF0C;&#x201C;&#x72EC;&#x7ACB;&#x5B9E;&#x4F53;&#x201D;&#x65B9;&#x6CD5;&#x662F;&#x4E00;&#x79CD;&#x4EE5;&#x660E;&#x786E;&#x7684;&#x65B9;&#x5F0F;&#x5C06;&#x5BF9;&#x8C61;&#x5206;&#x914D;&#x7ED9;&#x4E0D;&#x540C;&#x8868;&#xFF08;&#x4EE5;&#x53CA;&#x6F5C;&#x5728;&#x7684;&#x6570;&#x636E;&#x5E93;&#x8282;&#x70B9;&#xFF09;&#x7684;&#x7B80;&#x5355;&#x65B9;&#x6CD5; - &#x5728;&#x7EF4;&#x57FA;&#x4E0A;&#x7684;<a class="reference external" href="http://www.sqlalchemy.org/trac/wiki/UsageRecipes/EntityName">EntityName</a>&#x4E2D;&#x8FDB;&#x884C;&#x4E86;&#x63CF;&#x8FF0;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-227">&#x6587;&#x4EF6;&#x6E05;&#x5355;&#xFF1A;</span></p><ul class="simple"><li><span class="yiyi-st" id="yiyi-228"><a class="reference external" href="_modules/examples/sharding/attribute_shard.html"> attribute_shard.py  T0&gt;</a></span></li></ul></div></div><div class="section" id="extending-the-orm"><h2><span class="yiyi-st" id="yiyi-229">&#x6269;&#x5C55;ORM <a class="headerlink" href="#extending-the-orm" title="Permalink to this headline">&#xB6;</a></span></h2><div class="section" id="module-examples.dogpile_caching"><h3><span class="yiyi-st" id="yiyi-230">Dogpile&#x7F13;&#x5B58;<a class="headerlink" href="#module-examples.dogpile_caching" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-231">&#x6F14;&#x793A;&#x5982;&#x4F55;&#x5728;<a class="reference internal" href="query.html#sqlalchemy.orm.query.Query" title="sqlalchemy.orm.query.Query"><code class="xref py py-class docutils literal"><span class="pre">Query</span></code></a>&#x5BF9;&#x8C61;&#x4E2D;&#x5D4C;&#x5165;<a class="reference external" href="https://dogpilecache.readthedocs.io/">dogpile.cache</a>&#x529F;&#x80FD;&#xFF0C;&#x4EE5;&#x5141;&#x8BB8;&#x5B8C;&#x5168;&#x7F13;&#x5B58;&#x63A7;&#x5236;&#x4EE5;&#x53CA;&#x4ECE;&#x957F;&#x671F;&#x7F13;&#x5B58;&#x4E2D;&#x62C9;&#x53D6;&#x201C;&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x201D;&#x5C5E;&#x6027;&#x7684;&#x529F;&#x80FD;&#x3002;</span></p><div class="versionchanged"><p><span class="yiyi-st" id="yiyi-232"><span class="versionmodified">&#x5728;&#x7248;&#x672C;0.8&#x4E2D;&#x66F4;&#x6539;&#xFF1A;</span>&#x8BE5;&#x793A;&#x4F8B;&#x5DF2;&#x66F4;&#x65B0;&#x4E3A;&#x4F7F;&#x7528;dogpile.cache&#xFF0C;&#x5C06;Beaker&#x66FF;&#x6362;&#x4E3A;&#x6B63;&#x5728;&#x4F7F;&#x7528;&#x7684;&#x7F13;&#x5B58;&#x5E93;&#x3002;</span></p></div><p><span class="yiyi-st" id="yiyi-233">&#x5728;&#x8FD9;&#x4E2A;&#x6F14;&#x793A;&#x4E2D;&#xFF0C;&#x8BF4;&#x660E;&#x4E86;&#x4EE5;&#x4E0B;&#x6280;&#x672F;&#xFF1A;</span></p><ul class="simple"><li><span class="yiyi-st" id="yiyi-234">&#x4F7F;&#x7528;<a class="reference internal" href="query.html#sqlalchemy.orm.query.Query" title="sqlalchemy.orm.query.Query"><code class="xref py py-class docutils literal"><span class="pre">Query</span></code></a>&#x7684;&#x81EA;&#x5B9A;&#x4E49;&#x5B50;&#x7C7B;</span></li><li><span class="yiyi-st" id="yiyi-235">&#x907F;&#x514D;&#x67E5;&#x8BE2;&#x4ECE;&#x81EA;&#x5B9A;&#x4E49;&#x7F13;&#x5B58;&#x6E90;&#x800C;&#x4E0D;&#x662F;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x62BD;&#x53D6;&#x7684;&#x57FA;&#x672C;&#x6280;&#x672F;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-236">&#x4F7F;&#x7528;dogpile.cache&#x8FDB;&#x884C;&#x57FA;&#x672C;&#x7F13;&#x5B58;&#xFF0C;&#x4F7F;&#x7528;&#x5141;&#x8BB8;&#x5168;&#x5C40;&#x63A7;&#x5236;&#x4E00;&#x7EC4;&#x56FA;&#x5B9A;&#x914D;&#x7F6E;&#x7684;&#x201C;&#x533A;&#x57DF;&#x201D;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-237">&#x4F7F;&#x7528;&#x81EA;&#x5B9A;&#x4E49;&#x7684;<code class="xref py py-class docutils literal"><span class="pre">MapperOption</span></code>&#x5BF9;&#x8C61;&#x6765;&#x914D;&#x7F6E;&#x67E5;&#x8BE2;&#x4E0A;&#x7684;&#x9009;&#x9879;&#xFF0C;&#x5305;&#x62EC;&#x5728;&#x53D1;&#x751F;&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x65F6;&#x8C03;&#x7528;&#x5BF9;&#x8C61;&#x56FE;&#x4E2D;&#x6DF1;&#x5C42;&#x9009;&#x9879;&#x7684;&#x529F;&#x80FD;&#x3002;</span></li></ul><p><span class="yiyi-st" id="yiyi-238">&#x4F8B;&#x5982;&#x3002;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># query for Person objects, specifying cache</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">Session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Person</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">FromCache</span><span class="p">(</span><span class="s2">&quot;default&quot;</span><span class="p">))</span>

<span class="c1"># specify that each Person&apos;s &quot;addresses&quot; collection comes from</span>
<span class="c1"># cache too</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">RelationshipCache</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">addresses</span><span class="p">,</span> <span class="s2">&quot;default&quot;</span><span class="p">))</span>

<span class="c1"># query</span>
<span class="k">print</span> <span class="n">q</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></pre></div></div><p><span class="yiyi-st" id="yiyi-239">&#x8981;&#x8FD0;&#x884C;&#xFF0C;&#x5FC5;&#x987B;&#x5B89;&#x88C5;SQLAlchemy&#x548C;dogpile.cache&#xFF0C;&#x6216;&#x8005;&#x5728;&#x5F53;&#x524D;&#x7684;PYTHONPATH&#x4E0A;&#x8FD0;&#x884C;&#x3002;</span><span class="yiyi-st" id="yiyi-240">&#x6F14;&#x793A;&#x4F1A;&#x4E3A;&#x6570;&#x636E;&#x6587;&#x4EF6;&#x521B;&#x5EFA;&#x672C;&#x5730;&#x76EE;&#x5F55;&#xFF0C;&#x63D2;&#x5165;&#x521D;&#x59CB;&#x6570;&#x636E;&#x5E76;&#x8FD0;&#x884C;&#x3002;</span><span class="yiyi-st" id="yiyi-241">&#x7B2C;&#x4E8C;&#x6B21;&#x8FD0;&#x884C;&#x8BE5;&#x6F14;&#x793A;&#x5C06;&#x5229;&#x7528;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x7684;&#x7F13;&#x5B58;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x4E14;&#x6070;&#x597D;&#x4E00;&#x4E2A;&#x9488;&#x5BF9;&#x4E24;&#x4E2A;&#x8868;&#x7684;SQL&#x8BED;&#x53E5;&#x5C06;&#x88AB;&#x53D1;&#x51FA; - &#x7136;&#x800C;&#xFF0C;&#x663E;&#x793A;&#x7684;&#x7ED3;&#x679C;&#x5C06;&#x5229;&#x7528;&#x4ECE;&#x7F13;&#x5B58;&#x4E2D;&#x62C9;&#x51FA;&#x7684;&#x6570;&#x5341;&#x4E2A;lazyload&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-242">&#x6F14;&#x793A;&#x811A;&#x672C;&#x81EA;&#x8EAB;&#xFF0C;&#x6309;&#x7167;&#x590D;&#x6742;&#x6027;&#x987A;&#x5E8F;&#xFF0C;&#x4EE5;Python&#x6A21;&#x5757;&#x7684;&#x5F62;&#x5F0F;&#x8FD0;&#x884C;&#xFF0C;&#x4EE5;&#x4FBF;&#x76F8;&#x5BF9;&#x5BFC;&#x5165;&#x5DE5;&#x4F5C;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>python -m examples.dogpile_caching.helloworld

python -m examples.dogpile_caching.relationship_caching

python -m examples.dogpile_caching.advanced

python -m examples.dogpile_caching.local_session_caching</pre></div></div><p><span class="yiyi-st" id="yiyi-243">&#x6587;&#x4EF6;&#x6E05;&#x5355;&#xFF1A;</span></p><ul class="simple"><li><span class="yiyi-st" id="yiyi-244"><a class="reference external" href="_modules/examples/dogpile_caching/environment.html">environment.py</a>  - &#x6839;&#x636E;&#x9700;&#x8981;&#x5EFA;&#x7ACB;&#x6570;&#x636E;/&#x7F13;&#x5B58;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#x548C;&#x914D;&#x7F6E;&#xFF0C;&#x5F15;&#x5BFC;&#x5939;&#x5177;&#x6570;&#x636E;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-245"><a class="reference external" href="_modules/examples/dogpile_caching/caching_query.html">caching_query.py</a>  - &#x8868;&#x793A;&#x5141;&#x8BB8;&#x5728;SQLAlchemy&#x4E2D;&#x4F7F;&#x7528;Dogpile&#x7F13;&#x5B58;&#x7684;&#x51FD;&#x6570;&#x548C;&#x7C7B;&#x3002;</span><span class="yiyi-st" id="yiyi-246">&#x5F15;&#x5165;&#x4E00;&#x4E2A;&#x540D;&#x4E3A;FromCache&#x7684;&#x67E5;&#x8BE2;&#x9009;&#x9879;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-247"><a class="reference external" href="_modules/examples/dogpile_caching/model.html">model.py</a>  - &#x6570;&#x636E;&#x6A21;&#x578B;&#xFF0C;&#x8868;&#x793A;&#x5177;&#x6709;&#x591A;&#x4E2A;Address&#x5BF9;&#x8C61;&#x7684;Person&#xFF0C;&#x6BCF;&#x4E2A;&#x5BF9;&#x8C61;&#x90FD;&#x6709;PostalCode&#xFF0C;City&#xFF0C;Country&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-248"><a class="reference external" href="_modules/examples/dogpile_caching/fixture_data.html">fixture_data.py</a>  - &#x5B89;&#x88C5;&#x4E00;&#x4E9B;&#x793A;&#x4F8B;&#x6570;&#x636E;&#x3002;</span><span class="yiyi-st" id="yiyi-249">&#x5728;&#x8FD9;&#x91CC;&#xFF0C;&#x6211;&#x4EEC;&#x6709;&#x51E0;&#x4E2A;&#x7F8E;&#x56FD;/&#x52A0;&#x62FF;&#x5927;&#x57CE;&#x5E02;&#x7684;&#x90AE;&#x653F;&#x7F16;&#x7801;&#x3002;</span><span class="yiyi-st" id="yiyi-250">&#x7136;&#x540E;&#xFF0C;&#x5B89;&#x88C5;100&#x4E2A;&#x4EBA;&#x8BB0;&#x5F55;&#xFF0C;&#x6BCF;&#x4E2A;&#x8BB0;&#x5F55;&#x90FD;&#x968F;&#x673A;&#x9009;&#x62E9;&#x4E00;&#x4E2A;&#x90AE;&#x653F;&#x7F16;&#x7801;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-251"><a class="reference external" href="_modules/examples/dogpile_caching/helloworld.html">helloworld.py</a>  - &#x8BF4;&#x660E;&#x5982;&#x4F55;&#x52A0;&#x8F7D;&#x4E00;&#x4E9B;&#x6570;&#x636E;&#x5E76;&#x7F13;&#x5B58;&#x7ED3;&#x679C;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-252"><a class="reference external" href="_modules/examples/dogpile_caching/relationship_caching.html">relationship_caching.py</a>  - &#x8BF4;&#x660E;&#x5982;&#x4F55;&#x5728;&#x5173;&#x7CFB;&#x7AEF;&#x70B9;&#x4E0A;&#x6DFB;&#x52A0;&#x7F13;&#x5B58;&#x9009;&#x9879;&#xFF0C;&#x4EE5;&#x4FBF;&#x5EF6;&#x8FDF;&#x7F13;&#x5B58;&#x4ECE;&#x7F13;&#x5B58;&#x4E2D;&#x52A0;&#x8F7D;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-253"><a class="reference external" href="_modules/examples/dogpile_caching/advanced.html">advanced.py</a>  - &#x8BF4;&#x660E;&#x7ED3;&#x5408;&#x4F7F;&#x7528;FromCache&#x9009;&#x9879;&#x7684;Query&#xFF0C;&#x5305;&#x62EC;&#x524D;&#x7AEF;&#x52A0;&#x8F7D;&#xFF0C;&#x7F13;&#x5B58;&#x5931;&#x6548;&#x548C;&#x96C6;&#x5408;&#x7F13;&#x5B58;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-254"><a class="reference external" href="_modules/examples/dogpile_caching/local_session_caching.html">local_session_caching.py</a>  - &#x5230;&#x76EE;&#x524D;&#x4E3A;&#x6B62;&#x7684;&#x4E00;&#x5207;&#xFF1F;</span><span class="yiyi-st" id="yiyi-255">&#x672C;&#x793A;&#x4F8B;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;dogpile.cache&#x540E;&#x7AEF;&#xFF0C;&#x8BE5;&#x540E;&#x7AEF;&#x5C06;&#x6570;&#x636E;&#x4FDD;&#x5B58;&#x5728;&#x5F53;&#x524D;&#x4F1A;&#x8BDD;&#x672C;&#x5730;&#x7684;&#x5B57;&#x5178;&#x4E2D;&#x3002;</span><span class="yiyi-st" id="yiyi-256">&#x5220;&#x9664;()&#x4F1A;&#x8BDD;&#x5E76;&#x4E14;&#x7F13;&#x5B58;&#x6D88;&#x5931;&#x3002;</span></li></ul></div><div class="section" id="module-examples.postgis"><h3><span class="yiyi-st" id="yiyi-257">PostGIS&#x96C6;&#x6210;<a class="headerlink" href="#module-examples.postgis" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-258">&#x6F14;&#x793A;&#x5E2E;&#x52A9;&#x5D4C;&#x5165;PostGIS&#x529F;&#x80FD;&#x7684;&#x6280;&#x5DE7;&#x7684;&#x5929;&#x771F;&#x793A;&#x4F8B;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-259">&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x6700;&#x521D;&#x662F;&#x4E3A;&#x4E86;&#x5C06;&#x5176;&#x63A8;&#x5E7F;&#x5230;&#x4E00;&#x4E2A;&#x5168;&#x9762;&#x7684;PostGIS&#x96C6;&#x6210;&#x5C42;&#x800C;&#x5F00;&#x53D1;&#x7684;&#x3002;</span><span class="yiyi-st" id="yiyi-260">&#x6211;&#x4EEC;&#x5F88;&#x9AD8;&#x5174;&#x5730;&#x5BA3;&#x5E03;&#xFF0C;&#x8FD9;&#x5DF2;&#x7ECF;&#x6210;&#x4E3A;<a class="reference external" href="http://www.geoalchemy.org/">GeoAlchemy</a>&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-261">&#x8BE5;&#x4F8B;&#x5B50;&#x8BF4;&#x660E;&#xFF1A;</span></p><ul class="simple"><li><span class="yiyi-st" id="yiyi-262">&#x4E00;&#x4E2A;&#x5141;&#x8BB8;CREATE / DROP&#x4E0E;AddGeometryColumn / DropGeometryColumn&#x4E00;&#x8D77;&#x4F7F;&#x7528;&#x7684;DDL&#x6269;&#x5C55;</span></li><li><span class="yiyi-st" id="yiyi-263">&#x51E0;&#x4F55;&#x7C7B;&#x578B;&#x4EE5;&#x53CA;&#x4E00;&#x4E9B;&#x5B50;&#x7C7B;&#x578B;&#xFF0C;&#x5B83;&#x4EEC;&#x5C06;&#x7ED3;&#x679C;&#x884C;&#x503C;&#x8F6C;&#x6362;&#x4E3A;&#x652F;&#x6301;GIS&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x5E76;&#x4E14;&#x8FD8;&#x4E0E;DDL&#x6269;&#x5C55;&#x96C6;&#x6210;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-264">&#x4E00;&#x4E2A;&#x652F;&#x6301;GIS&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x5B83;&#x5B58;&#x50A8;&#x4E00;&#x4E2A;&#x539F;&#x59CB;&#x51E0;&#x4F55;&#x503C;&#x5E76;&#x4E3A;&#x8BF8;&#x5982;AsText()&#x7B49;&#x51FD;&#x6570;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x5DE5;&#x5382;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-265">&#x4E00;&#x4E2A;ORM&#x6BD4;&#x8F83;&#x5668;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x8986;&#x76D6;&#x6620;&#x5C04;&#x5BF9;&#x8C61;&#x4E0A;&#x7684;&#x6807;&#x51C6;&#x5217;&#x65B9;&#x6CD5;&#x4EE5;&#x751F;&#x6210;GIS&#x64CD;&#x4F5C;&#x5458;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-266">&#x4E00;&#x4E2A;&#x5C5E;&#x6027;&#x4E8B;&#x4EF6;&#x4FA6;&#x542C;&#x5668;&#xFF0C;&#x62E6;&#x622A;&#x5B57;&#x7B26;&#x4E32;&#x5E76;&#x8F6C;&#x6362;&#x4E3A;GeomFromText()&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-267">&#x4E00;&#x4E2A;&#x72EC;&#x7ACB;&#x7684;&#x64CD;&#x4F5C;&#x5458;&#x793A;&#x4F8B;&#x3002;</span></li></ul><p><span class="yiyi-st" id="yiyi-268">&#x8BE5;&#x5B9E;&#x65BD;&#x4EC5;&#x9650;&#x4E8E;&#x516C;&#x5F00;&#x7684;&#xFF0C;&#x4F17;&#x6240;&#x5468;&#x77E5;&#x4E14;&#x6613;&#x4E8E;&#x4F7F;&#x7528;&#x7684;&#x6269;&#x5C55;&#x70B9;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-269">&#x4F8B;&#x5982;&#x3002;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">print</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Road</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Road</span><span class="o">.</span><span class="n">road_geom</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">r1</span><span class="o">.</span><span class="n">road_geom</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></pre></div></div><p><span class="yiyi-st" id="yiyi-270">&#x6587;&#x4EF6;&#x6E05;&#x5355;&#xFF1A;</span></p><ul class="simple"><li><span class="yiyi-st" id="yiyi-271"><a class="reference external" href="_modules/examples/postgis/postgis.html"> postgis.py  T0&gt;</a></span></li></ul></div></div>