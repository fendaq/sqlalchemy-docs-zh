<h1><span class="yiyi-st" id="yiyi-64">&#x4F1A;&#x8BDD;&#x57FA;&#x7840;<a class="headerlink" href="#session-basics" title="Permalink to this headline">&#xB6;</a></span></h1><div class="section" id="what-does-the-session-do"><h2><span class="yiyi-st" id="yiyi-65">&#x4F1A;&#x8BDD;&#x662F;&#x505A;&#x4EC0;&#x4E48;&#x7684;&#xFF1F;<a class="headerlink" href="#what-does-the-session-do" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-66">&#x4ECE;&#x4E00;&#x822C;&#x610F;&#x4E49;&#x4E0A;&#x8BF4;&#xFF0C;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x5EFA;&#x7ACB;&#x4E0E;&#x6570;&#x636E;&#x5E93;&#x7684;&#x6240;&#x6709;&#x5BF9;&#x8BDD;&#xFF0C;&#x5E76;&#x4EE3;&#x8868;&#x60A8;&#x5728;&#x5176;&#x751F;&#x547D;&#x5468;&#x671F;&#x4E2D;&#x52A0;&#x8F7D;&#x6216;&#x5173;&#x8054;&#x7684;&#x6240;&#x6709;&#x5BF9;&#x8C61;&#x7684;&#x201C;&#x4FDD;&#x7559;&#x533A;&#x201D;&#x3002;</span><span class="yiyi-st" id="yiyi-67">It provides the entrypoint to acquire a <a class="reference internal" href="query.html#sqlalchemy.orm.query.Query" title="sqlalchemy.orm.query.Query"><code class="xref py py-class docutils literal"><span class="pre">Query</span></code></a> object, which sends queries to the database using the <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a> object&#x2019;s current database connection, populating result rows into objects that are then stored in the <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>, inside a structure called the <a class="reference external" href="http://martinfowler.com/eaaCatalog/identityMap.html">Identity Map</a> - a data structure that maintains unique copies of each object, where &#x201C;unique&#x201D; means &#x201C;only one object with a particular primary key&#x201D;.</span></p><p><span class="yiyi-st" id="yiyi-68"><a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x4EE5;&#x57FA;&#x672C;&#x65E0;&#x72B6;&#x6001;&#x7684;&#x5F62;&#x5F0F;&#x5F00;&#x59CB;&#x3002;</span><span class="yiyi-st" id="yiyi-69">&#x4E00;&#x65E6;&#x67E5;&#x8BE2;&#x88AB;&#x53D1;&#x5E03;&#x6216;&#x5176;&#x4ED6;&#x5BF9;&#x8C61;&#x88AB;&#x6301;&#x4E45;&#x5316;&#xFF0C;&#x5B83;&#x5C31;&#x4F1A;&#x4ECE;<a class="reference internal" href="core_connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal"><span class="pre">Engine</span></code></a>&#x8BF7;&#x6C42;&#x8FDE;&#x63A5;&#x8D44;&#x6E90;&#xFF0C;&#x8BE5;&#x8FDE;&#x63A5;&#x8D44;&#x6E90;&#x4E0E;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x672C;&#x8EAB;&#x6216;&#x6620;&#x5C04;&#x7684;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal"><span class="pre">Table</span></code></a>&#x6B63;&#x5728;&#x64CD;&#x4F5C;&#x7684;&#x5BF9;&#x8C61;&#x3002;</span><span class="yiyi-st" id="yiyi-70">&#x8FD9;&#x4E2A;&#x8FDE;&#x63A5;&#x4EE3;&#x8868;&#x4E00;&#x4E2A;&#x6B63;&#x5728;&#x8FDB;&#x884C;&#x7684;&#x4E8B;&#x52A1;&#xFF0C;&#x5B83;&#x5728;&#x6307;&#x793A;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x63D0;&#x4EA4;&#x6216;&#x56DE;&#x6EDA;&#x5176;&#x6302;&#x8D77;&#x72B6;&#x6001;&#x4E4B;&#x524D;&#x4E00;&#x76F4;&#x6709;&#x6548;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-71">All changes to objects maintained by a <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a> are tracked - before the database is queried again or before the current transaction is committed, it <strong>flushes</strong> all pending changes to the database. </span><span class="yiyi-st" id="yiyi-72">&#x8FD9;&#x88AB;&#x79F0;&#x4E3A;<a class="reference external" href="http://martinfowler.com/eaaCatalog/unitOfWork.html">&#x5DE5;&#x4F5C;&#x5355;&#x5143;</a>&#x6A21;&#x5F0F;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-73">&#x5F53;&#x4F7F;&#x7528;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x65F6;&#xFF0C;&#x91CD;&#x8981;&#x7684;&#x662F;&#x8981;&#x6CE8;&#x610F;&#x4E0E;&#x5B83;&#x5173;&#x8054;&#x7684;&#x5BF9;&#x8C61;&#x662F;&#x7531;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x4FDD;&#x5B58;&#x7684;&#x4E8B;&#x52A1;&#x7684;<strong>&#x4EE3;&#x7406;&#x5BF9;&#x8C61;</strong>&#x6709;&#x5F88;&#x591A;&#x4E8B;&#x4EF6;&#x4F1A;&#x5BFC;&#x81F4;&#x5BF9;&#x8C61;&#x91CD;&#x65B0;&#x8BBF;&#x95EE;&#x6570;&#x636E;&#x5E93;&#x4EE5;&#x4FDD;&#x6301;&#x540C;&#x6B65;&#x3002;</span><span class="yiyi-st" id="yiyi-74">&#x53EF;&#x4EE5;&#x4ECE;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x4E2D;&#x201C;&#x5206;&#x79BB;&#x201D;&#x5BF9;&#x8C61;&#xFF0C;&#x5E76;&#x7EE7;&#x7EED;&#x4F7F;&#x7528;&#x5B83;&#x4EEC;&#xFF0C;&#x867D;&#x7136;&#x8FD9;&#x79CD;&#x505A;&#x6CD5;&#x6709;&#x5176;&#x8B66;&#x544A;&#x3002;</span><span class="yiyi-st" id="yiyi-75">&#x901A;&#x5E38;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5F53;&#x60A8;&#x60F3;&#x518D;&#x6B21;&#x4F7F;&#x7528;&#x5B83;&#x4EEC;&#x65F6;&#xFF0C;&#x60A8;&#x4F1A;&#x5C06;&#x5206;&#x79BB;&#x7684;&#x5BF9;&#x8C61;&#x4E0E;&#x53E6;&#x4E00;&#x4E2A;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x91CD;&#x65B0;&#x5173;&#x8054;&#xFF0C;&#x4EE5;&#x4FBF;&#x5B83;&#x4EEC;&#x53EF;&#x4EE5;&#x6062;&#x590D;&#x8868;&#x793A;&#x6570;&#x636E;&#x5E93;&#x72B6;&#x6001;&#x7684;&#x5E38;&#x89C4;&#x4EFB;&#x52A1;&#x3002;</span></p></div><div class="section" id="getting-a-session"><h2><span class="yiyi-st" id="yiyi-76">&#x83B7;&#x5F97;&#x4F1A;&#x8BDD;<a class="headerlink" href="#getting-a-session" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-77"><a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a> is a regular Python class which can be directly instantiated. </span><span class="yiyi-st" id="yiyi-78">&#x4F46;&#x662F;&#xFF0C;&#x4E3A;&#x4E86;&#x6807;&#x51C6;&#x5316;&#x4F1A;&#x8BDD;&#x914D;&#x7F6E;&#x548C;&#x83B7;&#x53D6;&#x65B9;&#x5F0F;&#xFF0C;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.sessionmaker" title="sqlalchemy.orm.session.sessionmaker"><code class="xref py py-class docutils literal"><span class="pre">sessionmaker</span></code></a>&#x7C7B;&#x901A;&#x5E38;&#x7528;&#x4E8E;&#x521B;&#x5EFA;&#x9876;&#x7EA7;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x914D;&#x7F6E;&#xFF0C;&#x7136;&#x540E;&#x53EF;&#x4EE5;&#x5728;&#x6574;&#x4E2A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#x4F7F;&#x7528;&#xFF0C;&#x800C;&#x4E0D;&#x9700;&#x8981;&#x91CD;&#x590D;&#x914D;&#x7F6E;&#x53C2;&#x6570;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-79"><a class="reference internal" href="session_api.html#sqlalchemy.orm.session.sessionmaker" title="sqlalchemy.orm.session.sessionmaker"><code class="xref py py-class docutils literal"><span class="pre">sessionmaker</span></code></a>&#x7684;&#x7528;&#x6CD5;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</span></p><div class="highlight-python+sql"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">sessionmaker</span>

<span class="c1"># an Engine, which the Session will use for connection</span>
<span class="c1"># resources</span>
<span class="n">some_engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&apos;postgresql://scott:tiger@localhost/&apos;</span><span class="p">)</span>

<span class="c1"># create a configured &quot;Session&quot; class</span>
<span class="n">Session</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">some_engine</span><span class="p">)</span>

<span class="c1"># create a Session</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>

<span class="c1"># work with sess</span>
<span class="n">myobject</span> <span class="o">=</span> <span class="n">MyObject</span><span class="p">(</span><span class="s1">&apos;foo&apos;</span><span class="p">,</span> <span class="s1">&apos;bar&apos;</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">myobject</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></pre></div></div><p><span class="yiyi-st" id="yiyi-80">&#x4EE5;&#x4E0A;&#xFF0C;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.sessionmaker" title="sqlalchemy.orm.session.sessionmaker"><code class="xref py py-class docutils literal"><span class="pre">sessionmaker</span></code></a>&#x8C03;&#x7528;&#x4E3A;&#x6211;&#x4EEC;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x5DE5;&#x5382;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x5176;&#x5206;&#x914D;&#x7ED9;&#x540D;&#x4E3A;<code class="docutils literal"><span class="pre">Session</span></code>&#x7684;&#x540D;&#x79F0;&#x3002;</span><span class="yiyi-st" id="yiyi-81">&#x8FD9;&#x4E2A;&#x5DE5;&#x5382;&#x88AB;&#x8C03;&#x7528;&#x65F6;&#xFF0C;&#x5C06;&#x4F7F;&#x7528;&#x6211;&#x4EEC;&#x7ED9;&#x51FA;&#x7684;&#x914D;&#x7F6E;&#x53C2;&#x6570;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x5BF9;&#x8C61;&#x3002;</span><span class="yiyi-st" id="yiyi-82">&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x901A;&#x5E38;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x914D;&#x7F6E;&#x5DE5;&#x5382;&#x4E3A;&#x8FDE;&#x63A5;&#x8D44;&#x6E90;&#x6307;&#x5B9A;&#x7279;&#x5B9A;&#x7684;<a class="reference internal" href="core_connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal"><span class="pre">Engine</span></code></a>&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-83">A typical setup will associate the <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.sessionmaker" title="sqlalchemy.orm.session.sessionmaker"><code class="xref py py-class docutils literal"><span class="pre">sessionmaker</span></code></a> with an <a class="reference internal" href="core_connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal"><span class="pre">Engine</span></code></a>, so that each <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a> generated will use this <a class="reference internal" href="core_connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal"><span class="pre">Engine</span></code></a> to acquire connection resources. </span><span class="yiyi-st" id="yiyi-84">&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">bind</span></code>&#x53C2;&#x6570;&#x8BBE;&#x7F6E;&#x8BE5;&#x5173;&#x8054;&#xFF0C;&#x5982;&#x4E0A;&#x4F8B;&#x6240;&#x793A;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-85">&#x5728;&#x7F16;&#x5199;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x65F6;&#xFF0C;&#x5C06;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.sessionmaker" title="sqlalchemy.orm.session.sessionmaker"><code class="xref py py-class docutils literal"><span class="pre">sessionmaker</span></code></a>&#x5DE5;&#x5382;&#x653E;&#x5728;&#x5168;&#x5C40;&#x7EA7;&#x522B;&#x3002;</span><span class="yiyi-st" id="yiyi-86">&#x8FD9;&#x4E2A;&#x5DE5;&#x5382;&#x53EF;&#x4EE5;&#x88AB;&#x5176;&#x4F59;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7528;&#x4F5C;&#x65B0;&#x7684;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x5B9E;&#x4F8B;&#x7684;&#x6E90;&#xFF0C;&#x4FDD;&#x6301;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x5BF9;&#x8C61;&#x5728;&#x4E00;&#x4E2A;&#x5730;&#x65B9;&#x88AB;&#x6784;&#x5EFA;&#x7684;&#x914D;&#x7F6E;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-87"><a class="reference internal" href="session_api.html#sqlalchemy.orm.session.sessionmaker" title="sqlalchemy.orm.session.sessionmaker"><code class="xref py py-class docutils literal"><span class="pre">sessionmaker</span></code></a>&#x5DE5;&#x5382;&#x4E5F;&#x53EF;&#x4EE5;&#x4E0E;&#x5176;&#x4ED6;&#x52A9;&#x624B;&#x4E00;&#x8D77;&#x4F7F;&#x7528;&#xFF0C;&#x8FD9;&#x4E9B;&#x52A9;&#x624B;&#x5C06;&#x4F20;&#x9012;&#x7528;&#x6237;&#x5B9A;&#x4E49;&#x7684;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.sessionmaker" title="sqlalchemy.orm.session.sessionmaker"><code class="xref py py-class docutils literal"><span class="pre">sessionmaker</span></code></a>&#xFF0C;&#x7136;&#x540E;&#x7531;&#x52A9;&#x624B;&#x7EF4;&#x62A4;&#x3002;</span><span class="yiyi-st" id="yiyi-88">&#x5176;&#x4E2D;&#x4E00;&#x4E9B;&#x5E2E;&#x52A9;&#x7A0B;&#x5E8F;&#x5728;<a class="reference internal" href="#session-faq-whentocreate"><span>When do I construct a Session, when do I commit it, and when do I close it?</span></a>&#x3002;</span></p><div class="section" id="adding-additional-configuration-to-an-existing-sessionmaker"><h3><span class="yiyi-st" id="yiyi-89">&#x5C06;&#x5176;&#x4ED6;&#x914D;&#x7F6E;&#x6DFB;&#x52A0;&#x5230;&#x73B0;&#x6709;&#x7684;sessionmaker()<a class="headerlink" href="#adding-additional-configuration-to-an-existing-sessionmaker" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-90">&#x4E00;&#x4E2A;&#x5E38;&#x89C1;&#x7684;&#x573A;&#x666F;&#x662F;&#x5728;&#x6A21;&#x5757;&#x5BFC;&#x5165;&#x65F6;&#x8C03;&#x7528;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.sessionmaker" title="sqlalchemy.orm.session.sessionmaker"><code class="xref py py-class docutils literal"><span class="pre">sessionmaker</span></code></a>&#xFF0C;&#x4F46;&#x662F;&#x8981;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x4E0E;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.sessionmaker" title="sqlalchemy.orm.session.sessionmaker"><code class="xref py py-class docutils literal"><span class="pre">sessionmaker</span></code></a>&#x5173;&#x8054;&#x7684;<a class="reference internal" href="core_connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal"><span class="pre">Engine</span></code></a>&#x5C1A;&#x672A;&#x8FDB;&#x884C;&#x3002;</span><span class="yiyi-st" id="yiyi-91">&#x5BF9;&#x4E8E;&#x8FD9;&#x4E2A;&#x7528;&#x4F8B;&#xFF0C;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.sessionmaker" title="sqlalchemy.orm.session.sessionmaker"><code class="xref py py-class docutils literal"><span class="pre">sessionmaker</span></code></a>&#x7ED3;&#x6784;&#x63D0;&#x4F9B;&#x4E86;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.sessionmaker.configure" title="sqlalchemy.orm.session.sessionmaker.configure"><code class="xref py py-meth docutils literal"><span class="pre">sessionmaker.configure()</span></code></a>&#x65B9;&#x6CD5;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x5C06;&#x5176;&#x4ED6;&#x914D;&#x7F6E;&#x6307;&#x4EE4;&#x653E;&#x5165;&#x73B0;&#x6709;&#x7684;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.sessionmaker" title="sqlalchemy.orm.session.sessionmaker"><code class="xref py py-class docutils literal"><span class="pre">sessionmaker</span></code></a>&#x5F53;&#x6784;&#x9020;&#x88AB;&#x8C03;&#x7528;&#x65F6;&#x53D1;&#x751F;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">sessionmaker</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>

<span class="c1"># configure Session class with desired options</span>
<span class="n">Session</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">()</span>

<span class="c1"># later, we create the engine</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&apos;postgresql://...&apos;</span><span class="p">)</span>

<span class="c1"># associate it with our custom Session class</span>
<span class="n">Session</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>

<span class="c1"># work with the session</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span></pre></div></div></div><div class="section" id="creating-ad-hoc-session-objects-with-alternate-arguments"><h3><span class="yiyi-st" id="yiyi-92">&#x7528;&#x66FF;&#x4EE3;&#x53C2;&#x6570;&#x521B;&#x5EFA;&#x7279;&#x522B;&#x4F1A;&#x8BDD;&#x5BF9;&#x8C61;<a class="headerlink" href="#creating-ad-hoc-session-objects-with-alternate-arguments" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-93">For the use case where an application needs to create a new <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a> with special arguments that deviate from what is normally used throughout the application, such as a <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a> that binds to an alternate source of connectivity, or a <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a> that should have other arguments such as <code class="docutils literal"><span class="pre">expire_on_commit</span></code> established differently from what most of the application wants, specific arguments can be passed to the <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.sessionmaker" title="sqlalchemy.orm.session.sessionmaker"><code class="xref py py-class docutils literal"><span class="pre">sessionmaker</span></code></a> factory&#x2019;s <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.sessionmaker.__call__" title="sqlalchemy.orm.session.sessionmaker.__call__"><code class="xref py py-meth docutils literal"><span class="pre">sessionmaker.__call__()</span></code></a> method. </span><span class="yiyi-st" id="yiyi-94">&#x8FD9;&#x4E9B;&#x53C2;&#x6570;&#x5C06;&#x8986;&#x76D6;&#x5DF2;&#x7ECF;&#x653E;&#x7F6E;&#x7684;&#x4EFB;&#x4F55;&#x914D;&#x7F6E;&#xFF0C;&#x6BD4;&#x5982;&#x4E0B;&#x9762;&#x7684;&#xFF0C;&#x5176;&#x4E2D;&#x9488;&#x5BF9;&#x7279;&#x5B9A;<a class="reference internal" href="core_connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal"><span class="pre">Connection</span></code></a>&#x6784;&#x5EFA;&#x65B0;&#x7684;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># at the module level, the global sessionmaker,</span>
<span class="c1"># bound to a specific Engine</span>
<span class="n">Session</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>

<span class="c1"># later, some unit of code wants to create a</span>
<span class="c1"># Session that is bound to a specific Connection</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">conn</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-95">&#x5C06;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x4E0E;&#x7279;&#x5B9A;<a class="reference internal" href="core_connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal"><span class="pre">Connection</span></code></a>&#x5173;&#x8054;&#x7684;&#x5178;&#x578B;&#x57FA;&#x672C;&#x539F;&#x7406;&#x662F;&#x7EF4;&#x62A4;&#x5916;&#x90E8;&#x4E8B;&#x52A1;&#x7684;&#x6D4B;&#x8BD5;&#x5939;&#x5177; - &#x53C2;&#x89C1;<a class="reference internal" href="session_transaction.html#session-external-transaction"><span>Joining a Session into an External Transaction (such as for test suites)</span></a>&#x4E3A;&#x4F8B;&#x3002;</span></p></div></div><div class="section" id="session-frequently-asked-questions"><h2><span class="yiyi-st" id="yiyi-96">&#x4F1A;&#x8BDD;&#x5E38;&#x89C1;&#x95EE;&#x9898;<a class="headerlink" href="#session-frequently-asked-questions" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-97">&#x5230;&#x6B64;&#x4E3A;&#x6B62;&#xFF0C;&#x8BB8;&#x591A;&#x7528;&#x6237;&#x5DF2;&#x7ECF;&#x5BF9;&#x4F1A;&#x8BDD;&#x6709;&#x7591;&#x95EE;&#x3002;</span><span class="yiyi-st" id="yiyi-98">&#x672C;&#x8282;&#x4ECB;&#x7ECD;&#x4F7F;&#x7528;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x65F6;&#x51FA;&#x73B0;&#x7684;&#x6700;&#x57FA;&#x672C;&#x95EE;&#x9898;&#x7684;&#x8FF7;&#x4F60;&#x5E38;&#x89C1;&#x95EE;&#x9898;&#x89E3;&#x7B54;&#xFF08;&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x6709;&#x4E00;&#x4E2A;<a class="reference internal" href="faq_index.html"><em>real FAQ</em></a>&#xFF09;&#x3002;</span></p><div class="section" id="when-do-i-make-a-sessionmaker"><h3><span class="yiyi-st" id="yiyi-99">&#x6211;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x5236;&#x4F5C;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.sessionmaker" title="sqlalchemy.orm.session.sessionmaker"><code class="xref py py-class docutils literal"><span class="pre">sessionmaker</span></code></a>&#xFF1F;<a class="headerlink" href="#when-do-i-make-a-sessionmaker" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-100">&#x53EA;&#x6709;&#x4E00;&#x6B21;&#xFF0C;&#x5728;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x5168;&#x5C40;&#x8303;&#x56F4;&#x5185;&#x3002;</span><span class="yiyi-st" id="yiyi-101">&#x5B83;&#x5E94;&#x8BE5;&#x88AB;&#x770B;&#x4F5C;&#x662F;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x914D;&#x7F6E;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x3002;</span><span class="yiyi-st" id="yiyi-102">&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x60A8;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5728;&#x4E00;&#x4E2A;&#x5305;&#x4E2D;&#x5305;&#x542B;&#x4E09;&#x4E2A;.py&#x6587;&#x4EF6;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x5C06;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.sessionmaker" title="sqlalchemy.orm.session.sessionmaker"><code class="xref py py-class docutils literal"><span class="pre">sessionmaker</span></code></a>&#x884C;&#x653E;&#x5165;<code class="docutils literal"><span class="pre">__init__.py</span></code>&#x6587;&#x4EF6;&#x4E2D;&#xFF1B;&#x4ECE;&#x8FD9;&#x4E00;&#x70B9;&#x4E0A;&#x4F60;&#x7684;&#x5176;&#x4ED6;&#x6A21;&#x5757;&#x8BF4;&#x201C;&#x4ECE;mypackage&#x5BFC;&#x5165;&#x4F1A;&#x8BDD;&#x201D;&#x3002;</span><span class="yiyi-st" id="yiyi-103">That way, everyone else just uses <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session()</span></code></a>, and the configuration of that session is controlled by that central point.</span></p><p><span class="yiyi-st" id="yiyi-104">If your application starts up, does imports, but does not know what database it&#x2019;s going to be connecting to, you can bind the <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a> at the &#x201C;class&#x201D; level to the engine later on, using <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.sessionmaker.configure" title="sqlalchemy.orm.session.sessionmaker.configure"><code class="xref py py-meth docutils literal"><span class="pre">sessionmaker.configure()</span></code></a>.</span></p><p><span class="yiyi-st" id="yiyi-105">&#x5728;&#x672C;&#x8282;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x7ECF;&#x5E38;&#x4F1A;&#x5728;&#x5B9E;&#x9645;&#x8C03;&#x7528;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x7684;&#x884C;&#x7684;&#x4E0A;&#x65B9;&#x521B;&#x5EFA;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.sessionmaker" title="sqlalchemy.orm.session.sessionmaker"><code class="xref py py-class docutils literal"><span class="pre">sessionmaker</span></code></a>&#x3002;</span><span class="yiyi-st" id="yiyi-106">&#x4F46;&#x8FD9;&#x4EC5;&#x4EC5;&#x662F;&#x4E3A;&#x4E86;&#x4F8B;&#x5B50;&#xFF01;</span><span class="yiyi-st" id="yiyi-107">&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.sessionmaker" title="sqlalchemy.orm.session.sessionmaker"><code class="xref py py-class docutils literal"><span class="pre">sessionmaker</span></code></a>&#x53EF;&#x80FD;&#x4F4D;&#x4E8E;&#x6A21;&#x5757;&#x7EA7;&#x522B;&#x7684;&#x67D0;&#x5904;&#x3002;</span><span class="yiyi-st" id="yiyi-108">&#x5B9E;&#x4F8B;&#x5316;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x7684;&#x8C03;&#x7528;&#x5C06;&#x88AB;&#x653E;&#x7F6E;&#x5728;&#x6570;&#x636E;&#x5E93;&#x5BF9;&#x8BDD;&#x5F00;&#x59CB;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#x3002;</span></p></div><div class="section" id="when-do-i-construct-a-session-when-do-i-commit-it-and-when-do-i-close-it"><h3><span class="yiyi-st" id="yiyi-109">&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x6784;&#x5EFA;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#xFF0C;&#x6211;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x63D0;&#x4EA4;&#x5B83;&#xFF0C;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x5173;&#x95ED;&#x5B83;&#xFF1F;<a class="headerlink" href="#when-do-i-construct-a-session-when-do-i-commit-it-and-when-do-i-close-it" title="Permalink to this headline"></a></span></h3><div class="topic"><p class="topic-title first"><span class="yiyi-st" id="yiyi-110">TL&#xFF1B;&#x535A;&#x58EB;&#xFF1B;</span></p><ol class="arabic simple"><li><span class="yiyi-st" id="yiyi-111">As a general rule, keep the lifecycle of the session <strong>separate and external</strong> from functions and objects that access and/or manipulate database data. </span><span class="yiyi-st" id="yiyi-112">&#x8FD9;&#x5C06;&#x5927;&#x5927;&#x6709;&#x52A9;&#x4E8E;&#x5B9E;&#x73B0;&#x53EF;&#x9884;&#x6D4B;&#x548C;&#x4E00;&#x81F4;&#x7684;&#x4EA4;&#x6613;&#x8303;&#x56F4;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-113">&#x786E;&#x4FDD;&#x4F60;&#x6E05;&#x695A;&#x5730;&#x77E5;&#x9053;&#x4EA4;&#x6613;&#x5728;&#x54EA;&#x91CC;&#x5F00;&#x59CB;&#x548C;&#x7ED3;&#x675F;&#xFF0C;&#x5E76;&#x4FDD;&#x6301;&#x4EA4;&#x6613;<strong>&#x77ED;</strong>&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x5B83;&#x4EEC;&#x4EE5;&#x4E00;&#x7CFB;&#x5217;&#x64CD;&#x4F5C;&#x7ED3;&#x675F;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x65E0;&#x9650;&#x671F;&#x5730;&#x5F00;&#x653E;&#x3002;</span></li></ol></div><p><span class="yiyi-st" id="yiyi-114">&#x4E00;&#x4E2A;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x901A;&#x5E38;&#x662F;&#x5728;&#x903B;&#x8F91;&#x64CD;&#x4F5C;&#x5F00;&#x59CB;&#x65F6;&#x5EFA;&#x7ACB;&#x7684;&#xFF0C;&#x5728;&#x8FD9;&#x4E2A;&#x903B;&#x8F91;&#x64CD;&#x4F5C;&#x4E2D;&#x6570;&#x636E;&#x5E93;&#x8BBF;&#x95EE;&#x662F;&#x6F5C;&#x5728;&#x7684;&#x9884;&#x671F;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-115">&#x65E0;&#x8BBA;&#x4F55;&#x65F6;&#x7528;&#x4E8E;&#x4E0E;&#x6570;&#x636E;&#x5E93;&#x4EA4;&#x8C08;&#xFF0C;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x5728;&#x5F00;&#x59CB;&#x901A;&#x4FE1;&#x65F6;&#x90FD;&#x4F1A;&#x7ACB;&#x5373;&#x5F00;&#x59CB;&#x6570;&#x636E;&#x5E93;&#x4E8B;&#x52A1;&#x3002;</span><span class="yiyi-st" id="yiyi-116">&#x5047;&#x8BBE;<code class="docutils literal"><span class="pre">autocommit</span></code>&#x6807;&#x5FD7;&#x4FDD;&#x7559;&#x4E3A;&#x5EFA;&#x8BAE;&#x7684;<code class="docutils literal"><span class="pre">False</span></code>&#x7F3A;&#x7701;&#x503C;&#xFF0C;&#x5219;&#x6B64;&#x4E8B;&#x52A1;&#x5C06;&#x7EE7;&#x7EED;&#x8FDB;&#x884C;&#xFF0C;&#x76F4;&#x81F3;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x88AB;&#x56DE;&#x9000;&#xFF0C;&#x843D;&#x5B9E;&#x6216;&#x5173;&#x95ED;&#x3002;</span><span class="yiyi-st" id="yiyi-117"><a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x5C06;&#x5728;&#x4E0A;&#x4E00;&#x6B21;&#x4EA4;&#x6613;&#x7ED3;&#x675F;&#x540E;&#x518D;&#x6B21;&#x4F7F;&#x7528;&#x65F6;&#x5F00;&#x59CB;&#x65B0;&#x7684;&#x4EA4;&#x6613;&#xFF1B;&#x7531;&#x6B64;&#x53EF;&#x89C1;&#xFF0C;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x80FD;&#x591F;&#x5728;&#x591A;&#x6B21;&#x4EA4;&#x6613;&#x4E2D;&#x83B7;&#x5F97;&#x751F;&#x547D;&#x5468;&#x671F;&#xFF0C;&#x4F46;&#x4E00;&#x6B21;&#x53EA;&#x80FD;&#x6709;&#x4E00;&#x6B21;&#x3002;</span><span class="yiyi-st" id="yiyi-118">&#x6211;&#x4EEC;&#x5C06;&#x8FD9;&#x4E24;&#x4E2A;&#x6982;&#x5FF5;&#x79F0;&#x4E3A;<strong>&#x4E8B;&#x52A1;&#x8303;&#x56F4;</strong>&#x548C;<strong>&#x4F1A;&#x8BDD;&#x8303;&#x56F4;</strong>&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-119">&#x8FD9;&#x91CC;&#x7684;&#x542B;&#x4E49;&#x662F;&#xFF0C;SQLAlchemy ORM&#x9F13;&#x52B1;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x5728;&#x4ED6;&#x4EEC;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#x5EFA;&#x7ACB;&#x8FD9;&#x4E24;&#x4E2A;&#x8303;&#x56F4;&#xFF0C;&#x4E0D;&#x4EC5;&#x5305;&#x62EC;&#x8303;&#x56F4;&#x7684;&#x5F00;&#x59CB;&#x548C;&#x7ED3;&#x675F;&#x65F6;&#x95F4;&#xFF0C;&#x8FD8;&#x5305;&#x62EC;&#x8303;&#x56F4;&#x7684;&#x8303;&#x56F4;&#xFF0C;&#x4F8B;&#x5982;&#x4E00;&#x4E2A;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a></span></p><p><span class="yiyi-st" id="yiyi-120">&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x51B3;&#x5B9A;&#x8FD9;&#x4E2A;&#x8303;&#x56F4;&#x7684;&#x8D1F;&#x62C5;&#x662F;SQLAlchemy ORM&#x5FC5;&#x987B;&#x5BF9;&#x5982;&#x4F55;&#x4F7F;&#x7528;&#x6570;&#x636E;&#x5E93;&#x6709;&#x5F3A;&#x70C8;&#x610F;&#x89C1;&#x7684;&#x4E00;&#x4E2A;&#x9886;&#x57DF;&#x3002;</span><span class="yiyi-st" id="yiyi-121"><a class="reference internal" href="glossary.html#term-unit-of-work"><span class="xref std std-term">unit of work</span></a>&#x6A21;&#x5F0F;&#x5177;&#x4F53;&#x662F;&#x968F;&#x7740;&#x65F6;&#x95F4;&#x7684;&#x63A8;&#x79FB;&#x79EF;&#x7D2F;&#x53D8;&#x5316;&#x5E76;&#x5468;&#x671F;&#x6027;&#x5730;&#x6E05;&#x9664;&#x5B83;&#x4EEC;&#xFF0C;&#x4FDD;&#x6301;&#x5185;&#x5B58;&#x4E2D;&#x72B6;&#x6001;&#x4E0E;&#x5DF2;&#x77E5;&#x5728;&#x672C;&#x5730;&#x4E8B;&#x52A1;&#x4E2D;&#x5B58;&#x5728;&#x7684;&#x72B6;&#x6001;&#x540C;&#x6B65;&#x3002;</span><span class="yiyi-st" id="yiyi-122">&#x8FD9;&#x79CD;&#x6A21;&#x5F0F;&#x53EA;&#x6709;&#x5728;&#x6709;&#x610F;&#x4E49;&#x7684;&#x4E8B;&#x52A1;&#x8303;&#x56F4;&#x5230;&#x4F4D;&#x65F6;&#x624D;&#x6709;&#x6548;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-123">&#x786E;&#x5B9A;&#x5F00;&#x59CB;&#x548C;&#x7ED3;&#x675F;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x8303;&#x56F4;&#x7684;&#x6700;&#x4F73;&#x70B9;&#x901A;&#x5E38;&#x4E0D;&#x662F;&#x5F88;&#x96BE;&#xFF0C;&#x5C3D;&#x7BA1;&#x5404;&#x79CD;&#x5404;&#x6837;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4F53;&#x7CFB;&#x7ED3;&#x6784;&#x53EF;&#x80FD;&#x4F1A;&#x5F15;&#x5165;&#x5177;&#x6709;&#x6311;&#x6218;&#x6027;&#x7684;&#x60C5;&#x51B5;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-124">&#x901A;&#x5E38;&#x7684;&#x9009;&#x62E9;&#x662F;&#x5728;&#x4E8B;&#x52A1;&#x7ED3;&#x675F;&#x7684;&#x540C;&#x65F6;&#x62C6;&#x9664;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#xFF0C;&#x8FD9;&#x610F;&#x5473;&#x7740;&#x4E8B;&#x52A1;&#x548C;&#x4F1A;&#x8BDD;&#x8303;&#x56F4;&#x662F;&#x76F8;&#x540C;&#x7684;&#x3002;</span><span class="yiyi-st" id="yiyi-125">&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5F88;&#x597D;&#x7684;&#x9009;&#x62E9;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x6D88;&#x9664;&#x4E86;&#x5C06;&#x4F1A;&#x8BDD;&#x8303;&#x56F4;&#x89C6;&#x4E3A;&#x4E0E;&#x4E8B;&#x52A1;&#x8303;&#x56F4;&#x5206;&#x5F00;&#x7684;&#x9700;&#x8981;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-126">&#x867D;&#x7136;&#x5173;&#x4E8E;&#x5982;&#x4F55;&#x786E;&#x5B9A;&#x4E8B;&#x52A1;&#x8303;&#x56F4;&#x5E76;&#x6CA1;&#x6709;&#x4E00;&#x6210;&#x4E0D;&#x53D8;&#x7684;&#x5EFA;&#x8BAE;&#xFF0C;&#x4F46;&#x6709;&#x4E00;&#x4E9B;&#x5E38;&#x89C1;&#x6A21;&#x5F0F;&#x3002;</span><span class="yiyi-st" id="yiyi-127">&#x7279;&#x522B;&#x662F;&#x5982;&#x679C;&#x4F60;&#x6B63;&#x5728;&#x7F16;&#x5199;&#x4E00;&#x4E2A;Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x9009;&#x62E9;&#x5DF2;&#x7ECF;&#x975E;&#x5E38;&#x6210;&#x719F;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-128">Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x662F;&#x6700;&#x7B80;&#x5355;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x6837;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5DF2;&#x7ECF;&#x56F4;&#x7ED5;&#x4E00;&#x4E2A;&#x4E00;&#x81F4;&#x7684;&#x8303;&#x56F4;&#x6784;&#x5EFA; - &#x8FD9;&#x662F;<strong>&#x8BF7;&#x6C42;</strong>&#xFF0C;&#x5B83;&#x8868;&#x793A;&#x6765;&#x81EA;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x4F20;&#x5165;&#x8BF7;&#x6C42;&#xFF0C;&#x5904;&#x7406;&#x8BE5;&#x8BF7;&#x6C42;&#x4EE5;&#x5236;&#x5B9A;&#x4E00;&#x4E2A;&#x54CD;&#x5E94;&#xFF0C;&#x6700;&#x540E;&#x5C06;&#x8BE5;&#x54CD;&#x5E94;&#x4EA4;&#x4ED8;&#x7ED9;&#x5BA2;&#x6237;&#x3002;</span><span class="yiyi-st" id="yiyi-129">&#x7136;&#x540E;&#xFF0C;&#x5C06;Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E0E;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x96C6;&#x6210;&#x662F;&#x5C06;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x8303;&#x56F4;&#x4E0E;&#x8BF7;&#x6C42;&#x8303;&#x56F4;&#x5173;&#x8054;&#x7684;&#x7B80;&#x5355;&#x4EFB;&#x52A1;&#x3002;</span><span class="yiyi-st" id="yiyi-130"><a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x53EF;&#x4EE5;&#x5728;&#x8BF7;&#x6C42;&#x5F00;&#x59CB;&#x65F6;&#x5EFA;&#x7ACB;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<span class="xref std std-term">&#x5EF6;&#x8FDF;&#x521D;&#x59CB;&#x5316;</span>&#x6A21;&#x5F0F;&#xFF0C;&#x8BE5;&#x6A21;&#x5F0F;&#x5728;&#x9700;&#x8981;&#x65F6;&#x7ACB;&#x5373;&#x5EFA;&#x7ACB;&#x3002;</span><span class="yiyi-st" id="yiyi-131">&#x7136;&#x540E;&#xFF0C;&#x8BF7;&#x6C42;&#x7EE7;&#x7EED;&#x8FDB;&#x884C;&#xFF0C;&#x5176;&#x4E2D;&#x4E00;&#x4E9B;&#x7CFB;&#x7EDF;&#x5DF2;&#x7ECF;&#x5230;&#x4F4D;&#xFF0C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x903B;&#x8F91;&#x53EF;&#x4EE5;&#x4EE5;&#x4E0E;&#x8BBF;&#x95EE;&#x5B9E;&#x9645;&#x8BF7;&#x6C42;&#x5BF9;&#x8C61;&#x7684;&#x65B9;&#x5F0F;&#x76F8;&#x5173;&#x7684;&#x65B9;&#x5F0F;&#x8BBF;&#x95EE;&#x5F53;&#x524D;&#x7684;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x3002;</span><span class="yiyi-st" id="yiyi-132">&#x5F53;&#x8BF7;&#x6C42;&#x7ED3;&#x675F;&#x65F6;&#xFF0C;&#x901A;&#x5E38;&#x901A;&#x8FC7;&#x4F7F;&#x7528;&#x7531;Web&#x6846;&#x67B6;&#x63D0;&#x4F9B;&#x7684;&#x4E8B;&#x4EF6;&#x6302;&#x94A9;&#xFF0C;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x4E5F;&#x88AB;&#x62C6;&#x9664;&#x3002;</span><span class="yiyi-st" id="yiyi-133">The transaction used by the <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a> may also be committed at this point, or alternatively the application may opt for an explicit commit pattern, only committing for those requests where one is warranted, but still always tearing down the <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a> unconditionally at the end.</span></p><p><span class="yiyi-st" id="yiyi-134">&#x4E00;&#x4E9B;Web&#x6846;&#x67B6;&#x5305;&#x542B;&#x57FA;&#x7840;&#x8BBE;&#x65BD;&#xFF0C;&#x4EE5;&#x534F;&#x52A9;&#x5B8C;&#x6210;&#x5C06;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x4E0E;Web&#x8BF7;&#x6C42;&#x7684;&#x5BFF;&#x547D;&#x5BF9;&#x9F50;&#x7684;&#x4EFB;&#x52A1;&#x3002;</span><span class="yiyi-st" id="yiyi-135">&#x8FD9;&#x5305;&#x62EC;&#x7528;&#x4E8E;&#x4E0E;Flask Web&#x6846;&#x67B6;&#x7ED3;&#x5408;&#x4F7F;&#x7528;&#x7684;<a class="reference external" href="http://packages.python.org/Flask-SQLAlchemy/">Flask-SQLAlchemy</a>&#x7B49;&#x4EA7;&#x54C1;&#xFF0C;&#x4EE5;&#x53CA;&#x901A;&#x5E38;&#x4E0E;Pyramid&#x6846;&#x67B6;&#x4E00;&#x8D77;&#x4F7F;&#x7528;&#x7684;<a class="reference external" href="http://pypi.python.org/pypi/zope.sqlalchemy">Zope-SQLAlchemy</a>&#x3002;</span><span class="yiyi-st" id="yiyi-136">SQLAlchemy&#x5EFA;&#x8BAE;&#x5C06;&#x8FD9;&#x4E9B;&#x4EA7;&#x54C1;&#x7528;&#x4F5C;&#x53EF;&#x7528;&#x7684;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-137">In those situations where the integration libraries are not provided or are insufficient, SQLAlchemy includes its own &#x201C;helper&#x201D; class known as <a class="reference internal" href="contextual.html#sqlalchemy.orm.scoping.scoped_session" title="sqlalchemy.orm.scoping.scoped_session"><code class="xref py py-class docutils literal"><span class="pre">scoped_session</span></code></a>. </span><span class="yiyi-st" id="yiyi-138">&#x6709;&#x5173;&#x8BE5;&#x5BF9;&#x8C61;&#x4F7F;&#x7528;&#x7684;&#x6559;&#x7A0B;&#x4F4D;&#x4E8E;<a class="reference internal" href="contextual.html#unitofwork-contextual"><span>Contextual/Thread-local Sessions</span></a>&#x3002;</span><span class="yiyi-st" id="yiyi-139">&#x5B83;&#x63D0;&#x4F9B;&#x4E86;&#x5C06;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x4E0E;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x5173;&#x8054;&#x7684;&#x5FEB;&#x901F;&#x65B9;&#x6CD5;&#xFF0C;&#x4EE5;&#x53CA;&#x5C06;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x5BF9;&#x8C61;&#x4E0E;&#x5176;&#x4ED6;&#x7C7B;&#x578B;&#x7684;&#x4F5C;&#x7528;&#x57DF;&#x76F8;&#x5173;&#x8054;&#x7684;&#x6A21;&#x5F0F;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-140">&#x5982;&#x524D;&#x6240;&#x8FF0;&#xFF0C;&#x5BF9;&#x4E8E;&#x975E;Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x6CA1;&#x6709;&#x660E;&#x786E;&#x7684;&#x6A21;&#x5F0F;&#xFF0C;&#x56E0;&#x4E3A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x672C;&#x8EAB;&#x5E76;&#x4E0D;&#x53EA;&#x6709;&#x4E00;&#x79CD;&#x67B6;&#x6784;&#x6A21;&#x5F0F;&#x3002;</span><span class="yiyi-st" id="yiyi-141">&#x6700;&#x597D;&#x7684;&#x7B56;&#x7565;&#x662F;&#x5C1D;&#x8BD5;&#x5212;&#x5B9A;&#x201C;&#x64CD;&#x4F5C;&#x201D;&#xFF0C;&#x5373;&#x7279;&#x5B9A;&#x7EBF;&#x7A0B;&#x5F00;&#x59CB;&#x5728;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x5185;&#x6267;&#x884C;&#x4E00;&#x7CFB;&#x5217;&#x64CD;&#x4F5C;&#x7684;&#x70B9;&#xFF0C;&#x8FD9;&#x4E9B;&#x64CD;&#x4F5C;&#x53EF;&#x4EE5;&#x5728;&#x6700;&#x540E;&#x6267;&#x884C;&#x3002;</span><span class="yiyi-st" id="yiyi-142">&#x4E00;&#x4E9B;&#x4F8B;&#x5B50;&#xFF1A;</span></p><ul class="simple"><li><span class="yiyi-st" id="yiyi-143">&#x4EA7;&#x751F;&#x5B50;&#x5206;&#x53C9;&#x7684;&#x540E;&#x53F0;&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x4F1A;&#x5E0C;&#x671B;&#x4E3A;&#x6BCF;&#x4E2A;&#x5B50;&#x8FDB;&#x7A0B;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#xFF0C;&#x5728;&#x8BE5;&#x5206;&#x652F;&#x7684;&#x201C;&#x4F5C;&#x4E1A;&#x201D;&#x751F;&#x547D;&#x5468;&#x671F;&#x4E2D;&#x4F7F;&#x7528;&#x8BE5;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x5904;&#x7406;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x4F5C;&#x4E1A;&#x5B8C;&#x6210;&#x65F6;&#x5C06;&#x5176;&#x6495;&#x4E0B;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-144">&#x5BF9;&#x4E8E;&#x547D;&#x4EE4;&#x884C;&#x811A;&#x672C;&#xFF0C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5C06;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5728;&#x7A0B;&#x5E8F;&#x5F00;&#x59CB;&#x5DE5;&#x4F5C;&#x65F6;&#x5EFA;&#x7ACB;&#x7684;&#x5355;&#x4E2A;&#x5168;&#x5C40;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#xFF0C;&#x5E76;&#x5728;&#x7A0B;&#x5E8F;&#x5B8C;&#x6210;&#x5176;&#x4EFB;&#x52A1;&#x65F6;&#x63D0;&#x4EA4;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-145">&#x5BF9;&#x4E8E;GUI&#x754C;&#x9762;&#x9A71;&#x52A8;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x7684;&#x8303;&#x56F4;&#x53EF;&#x80FD;&#x6700;&#x597D;&#x5728;&#x7528;&#x6237;&#x751F;&#x6210;&#x4E8B;&#x4EF6;&#x7684;&#x8303;&#x56F4;&#x5185;&#xFF0C;&#x4F8B;&#x5982;&#x6309;&#x94AE;&#x6309;&#x94AE;&#x3002;</span><span class="yiyi-st" id="yiyi-146">&#x6216;&#x8005;&#xFF0C;&#x8303;&#x56F4;&#x53EF;&#x4EE5;&#x5BF9;&#x5E94;&#x4E8E;&#x660E;&#x786E;&#x7684;&#x7528;&#x6237;&#x4EA4;&#x4E92;&#xFF0C;&#x8BF8;&#x5982;&#x7528;&#x6237;&#x201C;&#x6253;&#x5F00;&#x201D;&#x4E00;&#x7CFB;&#x5217;&#x8BB0;&#x5F55;&#xFF0C;&#x7136;&#x540E;&#x201C;&#x4FDD;&#x5B58;&#x201D;&#x5B83;&#x4EEC;&#x3002;</span></li></ul><p><span class="yiyi-st" id="yiyi-147">As a general rule, the application should manage the lifecycle of the session <em>externally</em> to functions that deal with specific data. </span><span class="yiyi-st" id="yiyi-148">&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5173;&#x952E;&#x95EE;&#x9898;&#x7684;&#x57FA;&#x672C;&#x5206;&#x79BB;&#xFF0C;&#x5B83;&#x4F7F;&#x5F97;&#x7279;&#x5B9A;&#x4E8E;&#x6570;&#x636E;&#x7684;&#x64CD;&#x4F5C;&#x4E0D;&#x53D7;&#x4ED6;&#x4EEC;&#x8BBF;&#x95EE;&#x548C;&#x64CD;&#x4F5C;&#x6570;&#x636E;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x7684;&#x5F71;&#x54CD;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-149">&#x4F8B;&#x5982;&#x3002; <strong>&#x4E0D;&#x8981;&#x8FD9;&#x6837;&#x505A;</strong>&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1">### this is the **wrong way to do it** ###</span>

<span class="k">class</span> <span class="nc">ThingOne</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">go</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">FooBar</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">})</span>
            <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
            <span class="k">raise</span>

<span class="k">class</span> <span class="nc">ThingTwo</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">go</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Widget</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;q&quot;</span><span class="p">:</span> <span class="mi">18</span><span class="p">})</span>
            <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
            <span class="k">raise</span>

<span class="k">def</span> <span class="nf">run_my_program</span><span class="p">():</span>
    <span class="n">ThingOne</span><span class="p">()</span><span class="o">.</span><span class="n">go</span><span class="p">()</span>
    <span class="n">ThingTwo</span><span class="p">()</span><span class="o">.</span><span class="n">go</span><span class="p">()</span></pre></div></div><p><span class="yiyi-st" id="yiyi-150">&#x4FDD;&#x6301;&#x4F1A;&#x8BDD;&#xFF08;&#x901A;&#x5E38;&#x662F;&#x4EA4;&#x6613;&#xFF09;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;<strong>&#x72EC;&#x7ACB;&#x548C;&#x5916;&#x90E8;</strong>&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1">### this is a **better** (but not the only) way to do it ###</span>

<span class="k">class</span> <span class="nc">ThingOne</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">go</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session</span><span class="p">):</span>
        <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">FooBar</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">})</span>

<span class="k">class</span> <span class="nc">ThingTwo</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">go</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session</span><span class="p">):</span>
        <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Widget</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;q&quot;</span><span class="p">:</span> <span class="mi">18</span><span class="p">})</span>

<span class="k">def</span> <span class="nf">run_my_program</span><span class="p">():</span>
    <span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ThingOne</span><span class="p">()</span><span class="o">.</span><span class="n">go</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>
        <span class="n">ThingTwo</span><span class="p">()</span><span class="o">.</span><span class="n">go</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>

        <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
        <span class="k">raise</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></pre></div></div><p><span class="yiyi-st" id="yiyi-151">&#x9AD8;&#x7EA7;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x5C06;&#x5C3D;&#x91CF;&#x4FDD;&#x6301;&#x4F1A;&#x8BDD;&#xFF0C;&#x4E8B;&#x52A1;&#x548C;&#x5F02;&#x5E38;&#x7BA1;&#x7406;&#x7684;&#x7EC6;&#x8282;&#xFF0C;&#x5C3D;&#x53EF;&#x80FD;&#x907F;&#x514D;&#x7A0B;&#x5E8F;&#x5DE5;&#x4F5C;&#x7684;&#x7EC6;&#x8282;&#x3002;</span><span class="yiyi-st" id="yiyi-152">&#x4F8B;&#x5982;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<a class="reference external" href="http://docs.python.org/3/library/contextlib.html#contextlib.contextmanager">&#x4E0A;&#x4E0B;&#x6587;&#x7BA1;&#x7406;&#x5668;</a>&#x8FDB;&#x4E00;&#x6B65;&#x5206;&#x79BB;&#x5173;&#x6CE8;&#x70B9;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1">### another way (but again *not the only way*) to do it ###</span>

<span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>

<span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">session_scope</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Provide a transactional scope around a series of operations.&quot;&quot;&quot;</span>
    <span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">session</span>
        <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
        <span class="k">raise</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">run_my_program</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">session_scope</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="n">ThingOne</span><span class="p">()</span><span class="o">.</span><span class="n">go</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>
        <span class="n">ThingTwo</span><span class="p">()</span><span class="o">.</span><span class="n">go</span><span class="p">(</span><span class="n">session</span><span class="p">)</span></pre></div></div></div><div class="section" id="is-the-session-a-cache"><h3><span class="yiyi-st" id="yiyi-153">Session&#x662F;&#x7F13;&#x5B58;&#x5417;&#xFF1F;<a class="headerlink" href="#is-the-session-a-cache" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-154">Yeee ...&#x6CA1;&#x6709;&#x3002;</span><span class="yiyi-st" id="yiyi-155">&#x5B83;&#x6709;&#x70B9;&#x7528;&#x4F5C;&#x7F13;&#x5B58;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x5B9E;&#x73B0;&#x4E86;<a class="reference internal" href="glossary.html#term-identity-map"><span class="xref std std-term">identity map</span></a>&#x6A21;&#x5F0F;&#xFF0C;&#x5E76;&#x5B58;&#x50A8;&#x4E86;&#x952E;&#x5165;&#x5176;&#x4E3B;&#x952E;&#x7684;&#x5BF9;&#x8C61;&#x3002;</span><span class="yiyi-st" id="yiyi-156">&#x4F46;&#x662F;&#xFF0C;&#x5B83;&#x4E0D;&#x4F1A;&#x6267;&#x884C;&#x4EFB;&#x4F55;&#x7C7B;&#x578B;&#x7684;&#x67E5;&#x8BE2;&#x7F13;&#x5B58;&#x3002;</span><span class="yiyi-st" id="yiyi-157">&#x8FD9;&#x610F;&#x5473;&#x7740;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x8BF4;<code class="docutils literal"><span class="pre">session.query(Foo).filter_by(name=&apos;bar&apos;)</span></code>&#xFF0C;&#x5373;&#x4F7F;<code class="docutils literal"><span class="pre">Foo(name=&apos;bar&apos;)</span></code>&#x5728;&#x8EAB;&#x4EFD;&#x5730;&#x56FE;&#x4E2D;&#xFF0C;&#x4F1A;&#x8BAE;&#x4E0D;&#x77E5;&#x9053;&#x8FD9;&#x4E00;&#x70B9;&#x3002;</span><span class="yiyi-st" id="yiyi-158">&#x5B83;&#x5FC5;&#x987B;&#x5411;&#x6570;&#x636E;&#x5E93;&#x53D1;&#x51FA;SQL&#xFF0C;&#x53D6;&#x56DE;&#x884C;&#xFF0C;&#x7136;&#x540E;&#x5F53;&#x5B83;&#x770B;&#x5230;&#x884C;&#x4E2D;&#x7684;&#x4E3B;&#x952E;&#x65F6;&#xFF0C;<em>&#x7136;&#x540E;</em>&#x5B83;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x672C;&#x5730;&#x6807;&#x8BC6;&#x6620;&#x5C04;&#x5E76;&#x67E5;&#x770B;&#x8BE5;&#x5BF9;&#x8C61;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x3002;</span><span class="yiyi-st" id="yiyi-159">&#x53EA;&#x6709;&#x5F53;&#x4F60;&#x8BF4;<code class="docutils literal"><span class="pre">query.get&#xFF08;{some</span> <span class="pre">primary</span> <span class="pre">key&#xFF09;&#xFF09;</span></code> <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a></span></p><p><span class="yiyi-st" id="yiyi-160">&#x6B64;&#x5916;&#xFF0C;Session&#x4F1A;&#x9ED8;&#x8BA4;&#x4F7F;&#x7528;&#x5F31;&#x5F15;&#x7528;&#x5B58;&#x50A8;&#x5BF9;&#x8C61;&#x5B9E;&#x4F8B;&#x3002;</span><span class="yiyi-st" id="yiyi-161">&#x8FD9;&#x4E5F;&#x8FDD;&#x80CC;&#x4E86;&#x5C06;&#x4F1A;&#x8BDD;&#x7528;&#x4F5C;&#x7F13;&#x5B58;&#x7684;&#x76EE;&#x7684;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-162"><a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x4E0D;&#x662F;&#x88AB;&#x8BBE;&#x8BA1;&#x6210;&#x4E00;&#x4E2A;&#x5168;&#x5C40;&#x5BF9;&#x8C61;&#xFF0C;&#x6BCF;&#x4E2A;&#x4EBA;&#x90FD;&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;&#x5BF9;&#x8C61;&#x7684;&#x201C;&#x6CE8;&#x518C;&#x8868;&#x201D;&#x8FDB;&#x884C;&#x54A8;&#x8BE2;&#x3002;</span><span class="yiyi-st" id="yiyi-163">&#x8FD9;&#x66F4;&#x50CF;&#x662F;&#x4E00;&#x4E2A;<strong>&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;</strong>&#x7684;&#x5DE5;&#x4F5C;&#x3002;</span><span class="yiyi-st" id="yiyi-164">SQLAlchemy&#x4F7F;&#x7528;<a class="reference external" href="https://dogpilecache.readthedocs.io/">dogpile.cache</a>&#xFF0C;&#x901A;&#x8FC7;<a class="reference internal" href="examples.html#examples-caching"><span>Dogpile Caching</span></a>&#x793A;&#x4F8B;&#x63D0;&#x4F9B;&#x4E86;&#x5B9E;&#x73B0;&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;&#x7684;&#x6A21;&#x5F0F;&#x3002;</span></p></div><div class="section" id="how-can-i-get-the-session-for-a-certain-object"><h3><span class="yiyi-st" id="yiyi-165">&#x6211;&#x5982;&#x4F55;&#x83B7;&#x5F97;&#x67D0;&#x4E2A;&#x5BF9;&#x8C61;&#x7684;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#xFF1F;<a class="headerlink" href="#how-can-i-get-the-session-for-a-certain-object" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-166">&#x4F7F;&#x7528;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x4E0A;&#x7684;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.object_session" title="sqlalchemy.orm.session.Session.object_session"><code class="xref py py-meth docutils literal"><span class="pre">object_session()</span></code></a> classmethod&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="o">.</span><span class="n">object_session</span><span class="p">(</span><span class="n">someobject</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-167">&#x66F4;&#x65B0;&#x7684;<a class="reference internal" href="core_inspection.html"><span>Runtime Inspection API</span></a>&#x7CFB;&#x7EDF;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">inspect</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">inspect</span><span class="p">(</span><span class="n">someobject</span><span class="p">)</span><span class="o">.</span><span class="n">session</span></pre></div></div></div><div class="section" id="is-the-session-thread-safe"><h3><span class="yiyi-st" id="yiyi-168">&#x4F1A;&#x8BDD;&#x662F;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x7684;&#x5417;&#xFF1F;<a class="headerlink" href="#is-the-session-thread-safe" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-169"><a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x975E;&#x5E38;&#x9002;&#x7528;&#x4E8E;<strong>&#x975E;&#x5E76;&#x53D1;</strong>&#x65B9;&#x5F0F;&#xFF0C;&#x8FD9;&#x901A;&#x5E38;&#x610F;&#x5473;&#x7740;&#x4E00;&#x6B21;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-170"><a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x5E94;&#x8BE5;&#x4EE5;&#x8FD9;&#x6837;&#x4E00;&#x79CD;&#x65B9;&#x5F0F;&#x4F7F;&#x7528;&#xFF0C;&#x5373;&#x5355;&#x4E2A;&#x4E8B;&#x52A1;&#x4E2D;&#x7684;&#x4E00;&#x7CFB;&#x5217;&#x64CD;&#x4F5C;&#x5B58;&#x5728;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;&#x3002;</span><span class="yiyi-st" id="yiyi-171">&#x83B7;&#x5F97;&#x8FD9;&#x79CD;&#x6548;&#x679C;&#x7684;&#x4E00;&#x79CD;&#x4FBF;&#x6377;&#x65B9;&#x6CD5;&#x662F;&#x5C06;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x4E0E;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x76F8;&#x5173;&#x8054;&#xFF08;&#x8BF7;&#x53C2;&#x9605;<a class="reference internal" href="contextual.html#unitofwork-contextual"><span>Contextual/Thread-local Sessions</span></a>&#x4EE5;&#x4E86;&#x89E3;&#x6709;&#x5173;&#x80CC;&#x666F;&#x4FE1;&#x606F;&#xFF09;&#x3002;</span><span class="yiyi-st" id="yiyi-172">&#x53E6;&#x4E00;&#x79CD;&#x65B9;&#x6CD5;&#x662F;&#x4F7F;&#x7528;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x5728;&#x51FD;&#x6570;&#x4E4B;&#x95F4;&#x4F20;&#x9012;&#x7684;&#x6A21;&#x5F0F;&#xFF0C;&#x5426;&#x5219;&#x4E0D;&#x4E0E;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x5171;&#x4EAB;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-173">&#x66F4;&#x91CD;&#x8981;&#x7684;&#x4E00;&#x70B9;&#x662F;&#xFF0C;&#x4F60;&#x4E0D;&#x5E94;&#x8BE5;<em>&#x8981;</em>&#x4F7F;&#x7528;&#x591A;&#x4E2A;&#x5E76;&#x53D1;&#x7EBF;&#x7A0B;&#x7684;&#x4F1A;&#x8BDD;&#x3002;</span><span class="yiyi-st" id="yiyi-174">&#x8FD9;&#x5C31;&#x597D;&#x6BD4;&#x8BA9;&#x4E00;&#x5BB6;&#x9910;&#x5385;&#x7684;&#x6BCF;&#x4E2A;&#x4EBA;&#x90FD;&#x4ECE;&#x540C;&#x4E00;&#x4E2A;&#x76D8;&#x5B50;&#x5403;&#x4E1C;&#x897F;&#x3002;</span><span class="yiyi-st" id="yiyi-175">&#x4F1A;&#x8BDD;&#x662F;&#x4E00;&#x4E2A;&#x672C;&#x5730;&#x201C;&#x5DE5;&#x4F5C;&#x7A7A;&#x95F4;&#x201D;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5B83;&#x6765;&#x5B8C;&#x6210;&#x4E00;&#x7EC4;&#x7279;&#x5B9A;&#x7684;&#x4EFB;&#x52A1;&#xFF1B;&#x60A8;&#x4E0D;&#x5E0C;&#x671B;&#x6216;&#x9700;&#x8981;&#x4E0E;&#x5176;&#x4ED6;&#x6B63;&#x5728;&#x6267;&#x884C;&#x5176;&#x4ED6;&#x4EFB;&#x52A1;&#x7684;&#x7EBF;&#x7A0B;&#x5171;&#x4EAB;&#x8BE5;&#x4F1A;&#x8BDD;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-176">&#x786E;&#x4FDD;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x4E00;&#x6B21;&#x53EA;&#x7528;&#x4E8E;&#x5355;&#x4E2A;&#x5E76;&#x53D1;&#x7EBF;&#x7A0B;&#x4E2D;&#x79F0;&#x4E3A;&#x201C;&#x65E0;&#x5171;&#x4EAB;&#x201D;&#x65B9;&#x6CD5;&#x6765;&#x5B9E;&#x73B0;&#x5E76;&#x53D1;&#x3002;</span><span class="yiyi-st" id="yiyi-177">&#x4F46;&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;&#x4E0D;&#x5171;&#x4EAB;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x610F;&#x5473;&#x7740;&#x66F4;&#x91CD;&#x8981;&#x7684;&#x6A21;&#x5F0F;&#xFF1B;&#x5B83;&#x4E0D;&#x4EC5;&#x610F;&#x5473;&#x7740;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x5BF9;&#x8C61;&#x672C;&#x8EAB;&#xFF0C;&#x800C;&#x4E14;<strong>&#x4E0E;&#x8BE5;Session</strong>&#x5173;&#x8054;&#x7684;&#x6240;&#x6709;&#x5BF9;&#x8C61;&#x90FD;&#x5FC5;&#x987B;&#x4FDD;&#x6301;&#x5728;&#x5355;&#x4E2A;&#x5E76;&#x53D1;&#x7EBF;&#x7A0B;&#x7684;&#x8303;&#x56F4;&#x5185;&#x3002;</span><span class="yiyi-st" id="yiyi-178">&#x4E0E;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x5173;&#x8054;&#x7684;&#x4E00;&#x7EC4;&#x6620;&#x5C04;&#x5BF9;&#x8C61;&#x672C;&#x8D28;&#x4E0A;&#x662F;&#x5BF9;&#x901A;&#x8FC7;&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;&#x8BBF;&#x95EE;&#x7684;&#x6570;&#x636E;&#x5E93;&#x884C;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x7684;&#x4EE3;&#x7406;&#xFF0C;&#x6240;&#x4EE5;&#x5C31;&#x50CF;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x672C;&#x8EAB;&#x4E00;&#x6837;&#xFF0C;&#x6574;&#x4E2A;&#x5BF9;&#x8C61;&#x96C6;&#x5B9E;&#x9645;&#x4E0A;&#x53EA;&#x662F;&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;&#xFF08;&#x6216;&#x8FDE;&#x63A5;&#xFF09;&#x7684;&#x5927;&#x89C4;&#x6A21;&#x4EE3;&#x7406;&#x3002;</span><span class="yiyi-st" id="yiyi-179">&#x6700;&#x7EC8;&#xFF0C;&#x5B83;&#x4E3B;&#x8981;&#x662F;&#x6211;&#x4EEC;&#x8FDC;&#x79BB;&#x5E76;&#x53D1;&#x8BBF;&#x95EE;&#x7684;DBAPI&#x8FDE;&#x63A5;&#x672C;&#x8EAB;&#xFF1B;&#x4F46;&#x7531;&#x4E8E;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x53CA;&#x4E0E;&#x5176;&#x5173;&#x8054;&#x7684;&#x6240;&#x6709;&#x5BF9;&#x8C61;&#x90FD;&#x662F;&#x8BE5;DBAPI&#x8FDE;&#x63A5;&#x7684;&#x6240;&#x6709;&#x4EE3;&#x7406;&#xFF0C;&#x56E0;&#x6B64;&#x6574;&#x4E2A;&#x56FE;&#x5BF9;&#x4E8E;&#x5E76;&#x53D1;&#x8BBF;&#x95EE;&#x57FA;&#x672C;&#x4E0A;&#x4E0D;&#x5B89;&#x5168;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-180">If there are in fact multiple threads participating in the same task, then you may consider sharing the session and its objects between those threads; however, in this extremely unusual scenario the application would need to ensure that a proper locking scheme is implemented so that there isn&#x2019;t <em>concurrent</em> access to the <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a> or its state. </span><span class="yiyi-st" id="yiyi-181">&#x5BF9;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x66F4;&#x5E38;&#x89C1;&#x7684;&#x505A;&#x6CD5;&#x662F;&#x6BCF;&#x4E2A;&#x5E76;&#x53D1;&#x7EBF;&#x7A0B;&#x7EF4;&#x62A4;&#x4E00;&#x4E2A;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x4ECE;&#x4E00;&#x4E2A;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x590D;&#x5236;<em>&#x5BF9;&#x8C61;&#x5230;&#x53E6;&#x4E00;&#x4E2A;&#x4F7F;&#x7528;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.merge" title="sqlalchemy.orm.session.Session.merge"><code class="xref py py-meth docutils literal"><span class="pre">Session.merge()</span></code></a>&#x65B9;&#x6CD5;&#x5C06;&#x5BF9;&#x8C61;&#x7684;&#x72B6;&#x6001;&#x590D;&#x5236;&#x5230;&#x4E0D;&#x540C;&#x7684;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x672C;&#x5730;&#x7684;&#x65B0;&#x5BF9;&#x8C61;&#x4E2D;&#x3002;</em></span></p></div></div><div class="section" id="basics-of-using-a-session"><h2><span class="yiyi-st" id="yiyi-182">&#x4F7F;&#x7528;&#x4F1A;&#x8BDD;&#x7684;&#x57FA;&#x7840;<a class="headerlink" href="#basics-of-using-a-session" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-183">&#x8FD9;&#x91CC;&#x4ECB;&#x7ECD;&#x6700;&#x57FA;&#x672C;&#x7684;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x4F7F;&#x7528;&#x6A21;&#x5F0F;&#x3002;</span></p><div class="section" id="querying"><h3><span class="yiyi-st" id="yiyi-184">&#x67E5;&#x8BE2;<a class="headerlink" href="#querying" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h3><p><span class="yiyi-st" id="yiyi-185"><a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.query" title="sqlalchemy.orm.session.Session.query"><code class="xref py py-meth docutils literal"><span class="pre">query()</span></code></a>&#x51FD;&#x6570;&#x63A5;&#x53D7;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;<em>&#x5B9E;&#x4F53;</em>&#x5E76;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x65B0;&#x7684;<a class="reference internal" href="query.html#sqlalchemy.orm.query.Query" title="sqlalchemy.orm.query.Query"><code class="xref py py-class docutils literal"><span class="pre">Query</span></code></a>&#x5BF9;&#x8C61;&#xFF0C;&#x8BE5;&#x5BF9;&#x8C61;&#x5C06;&#x5728;&#x672C;&#x4F1A;&#x8BDD;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x53D1;&#x51FA;&#x6620;&#x5C04;&#x5668;&#x67E5;&#x8BE2;&#x3002;</span><span class="yiyi-st" id="yiyi-186">&#x5B9E;&#x4F53;&#x88AB;&#x5B9A;&#x4E49;&#x4E3A;&#x6620;&#x5C04;&#x7C7B;&#xFF0C;<a class="reference internal" href="mapping_api.html#sqlalchemy.orm.mapper.Mapper" title="sqlalchemy.orm.mapper.Mapper"><code class="xref py py-class docutils literal"><span class="pre">Mapper</span></code></a>&#x5BF9;&#x8C61;&#xFF0C;&#x542F;&#x7528;orm&#x7684;<em>&#x63CF;&#x8FF0;&#x7B26;</em>&#x6216;<code class="docutils literal"><span class="pre">AliasedClass</span></code>&#x5BF9;&#x8C61;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># query from a class</span>
<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&apos;ed&apos;</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

<span class="c1"># query with multiple classes, returns tuples</span>
<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">Address</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&apos;addresses&apos;</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&apos;ed&apos;</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

<span class="c1"># query using orm-enabled descriptors</span>
<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">User</span><span class="o">.</span><span class="n">fullname</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

<span class="c1"># query from a mapper</span>
<span class="n">user_mapper</span> <span class="o">=</span> <span class="n">class_mapper</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">user_mapper</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-187">&#x5F53;<a class="reference internal" href="query.html#sqlalchemy.orm.query.Query" title="sqlalchemy.orm.query.Query"><code class="xref py py-class docutils literal"><span class="pre">Query</span></code></a>&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x65F6;&#xFF0C;&#x5B9E;&#x4F8B;&#x5316;&#x7684;&#x6BCF;&#x4E2A;&#x5BF9;&#x8C61;&#x90FD;&#x5B58;&#x50A8;&#x5728;&#x6807;&#x8BC6;&#x6620;&#x5C04;&#x4E2D;&#x3002;</span><span class="yiyi-st" id="yiyi-188">&#x5F53;&#x4E00;&#x884C;&#x5339;&#x914D;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x7684;&#x5BF9;&#x8C61;&#x65F6;&#xFF0C;&#x8FD4;&#x56DE;&#x76F8;&#x540C;&#x7684;&#x5BF9;&#x8C61;&#x3002;</span><span class="yiyi-st" id="yiyi-189">In the latter case, whether or not the row is populated onto an existing object depends upon whether the attributes of the instance have been <em>expired</em> or not. </span><span class="yiyi-st" id="yiyi-190">&#x9ED8;&#x8BA4;&#x914D;&#x7F6E;&#x7684;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x4F1A;&#x81EA;&#x52A8;&#x5C06;&#x6240;&#x6709;&#x5B9E;&#x4F8B;&#x6CBF;&#x7740;&#x4E8B;&#x52A1;&#x8FB9;&#x754C;&#x8FC7;&#x671F;&#xFF0C;&#x56E0;&#x6B64;&#x5BF9;&#x4E8E;&#x901A;&#x5E38;&#x662F;&#x5B64;&#x7ACB;&#x7684;&#x4E8B;&#x52A1;&#xFF0C;&#x5E94;&#x8BE5;&#x4E0D;&#x5B58;&#x5728;&#x8868;&#x793A;&#x4E0E;&#x5F53;&#x524D;&#x4E8B;&#x52A1;&#x76F8;&#x5173;&#x7684;&#x9648;&#x65E7;&#x6570;&#x636E;&#x7684;&#x5B9E;&#x4F8B;&#x7684;&#x4EFB;&#x4F55;&#x95EE;&#x9898;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-191"><a class="reference internal" href="query.html#sqlalchemy.orm.query.Query" title="sqlalchemy.orm.query.Query"><code class="xref py py-class docutils literal"><span class="pre">Query</span></code></a>&#x5BF9;&#x8C61;&#x5728;<a class="reference internal" href="tutorial.html"><span>Object Relational Tutorial</span></a>&#x4E2D;&#x6709;&#x8BE6;&#x7EC6;&#x4ECB;&#x7ECD;&#xFF0C;&#x5E76;&#x5728;<span class="xref std std-ref">query_api_toplevel</span>&#x4E2D;&#x8FDB;&#x4E00;&#x6B65;&#x4ECB;&#x7ECD;&#x3002;</span></p></div><div class="section" id="adding-new-or-existing-items"><h3><span class="yiyi-st" id="yiyi-192">&#x6DFB;&#x52A0;&#x65B0;&#x7684;&#x6216;&#x73B0;&#x6709;&#x7684;&#x9879;&#x76EE;<a class="headerlink" href="#adding-new-or-existing-items" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-193"><a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.add" title="sqlalchemy.orm.session.Session.add"><code class="xref py py-meth docutils literal"><span class="pre">add()</span></code></a>&#x7528;&#x4E8E;&#x5728;&#x5B9E;&#x4F8B;&#x4E2D;&#x653E;&#x7F6E;&#x5B9E;&#x4F8B;&#x3002;</span><span class="yiyi-st" id="yiyi-194">&#x5BF9;&#x4E8E;<em>transient</em>&#xFF08;&#x5373;&#x5168;&#x65B0;&#x7684;&#xFF09;&#x5B9E;&#x4F8B;&#xFF0C;&#x8FD9;&#x5C06;&#x5728;&#x4E0B;&#x4E00;&#x6B21;&#x5237;&#x65B0;&#x65F6;&#x4EA7;&#x751F;INSERT&#x7684;&#x6548;&#x679C;&#x3002;</span><span class="yiyi-st" id="yiyi-195">&#x5BF9;&#x4E8E;<em>&#x6301;&#x4E45;</em>&#xFF08;&#x5373;&#x7531;&#x6B64;&#x4F1A;&#x8BDD;&#x52A0;&#x8F7D;&#xFF09;&#x7684;&#x5B9E;&#x4F8B;&#xFF0C;&#x5B83;&#x4EEC;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x5E76;&#x4E14;&#x4E0D;&#x9700;&#x8981;&#x88AB;&#x6DFB;&#x52A0;&#x3002;</span><span class="yiyi-st" id="yiyi-196"><em>&#x5DF2;&#x5206;&#x79BB;</em>&#x7684;&#x5B9E;&#x4F8B;&#xFF08;&#x5373;&#x5DF2;&#x4ECE;&#x4F1A;&#x8BDD;&#x4E2D;&#x5220;&#x9664;&#xFF09;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x6B64;&#x65B9;&#x6CD5;&#x91CD;&#x65B0;&#x4E0E;&#x4F1A;&#x8BDD;&#x76F8;&#x5173;&#x8054;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">user1</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&apos;user1&apos;</span><span class="p">)</span>
<span class="n">user2</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&apos;user2&apos;</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">user1</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">user2</span><span class="p">)</span>

<span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>     <span class="c1"># write changes to the database</span></pre></div></div><p><span class="yiyi-st" id="yiyi-197">&#x8981;&#x4E00;&#x6B21;&#x5411;&#x4F1A;&#x8BDD;&#x6DFB;&#x52A0;&#x9879;&#x76EE;&#x5217;&#x8868;&#xFF0C;&#x8BF7;&#x4F7F;&#x7528;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.add_all" title="sqlalchemy.orm.session.Session.add_all"><code class="xref py py-meth docutils literal"><span class="pre">add_all()</span></code></a>&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">add_all</span><span class="p">([</span><span class="n">item1</span><span class="p">,</span> <span class="n">item2</span><span class="p">,</span> <span class="n">item3</span><span class="p">])</span></pre></div></div><p><span class="yiyi-st" id="yiyi-198">&#x6CBF;<code class="docutils literal"><span class="pre">save-update</span></code>&#x7EA7;&#x8054;&#x7684;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.add" title="sqlalchemy.orm.session.Session.add"><code class="xref py py-meth docutils literal"><span class="pre">add()</span></code></a>&#x64CD;&#x4F5C;<strong>&#x7EA7;&#x8054;</strong>&#x3002;</span><span class="yiyi-st" id="yiyi-199">&#x6B32;&#x4E86;&#x89E3;&#x66F4;&#x591A;&#x8BE6;&#x60C5;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a class="reference internal" href="cascades.html#unitofwork-cascades"><span>Cascades</span></a>&#x90E8;&#x5206;&#x3002;</span></p></div><div class="section" id="deleting"><h3><span class="yiyi-st" id="yiyi-200">&#x5220;&#x9664;<a class="headerlink" href="#deleting" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h3><p><span class="yiyi-st" id="yiyi-201"><a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.delete" title="sqlalchemy.orm.session.Session.delete"><code class="xref py py-meth docutils literal"><span class="pre">delete()</span></code></a>&#x65B9;&#x6CD5;&#x5C06;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;&#x653E;&#x5165;&#x8981;&#x6807;&#x8BB0;&#x4E3A;&#x5DF2;&#x5220;&#x9664;&#x7684;Session&#x5BF9;&#x8C61;&#x5217;&#x8868;&#x4E2D;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># mark two objects to be deleted</span>
<span class="n">session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">obj1</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">obj2</span><span class="p">)</span>

<span class="c1"># commit (or flush)</span>
<span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></pre></div></div><div class="section" id="deleting-from-collections"><h4><span class="yiyi-st" id="yiyi-202">&#x4ECE;&#x96C6;&#x5408;&#x4E2D;&#x5220;&#x9664;<a class="headerlink" href="#deleting-from-collections" title="Permalink to this headline">&#xB6;</a></span></h4><p><span class="yiyi-st" id="yiyi-203">&#x5173;&#x4E8E;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.delete" title="sqlalchemy.orm.session.Session.delete"><code class="xref py py-meth docutils literal"><span class="pre">delete()</span></code></a>&#x51FA;&#x73B0;&#x7684;&#x5E38;&#x89C1;&#x6DF7;&#x6DC6;&#x662F;&#x5F53;&#x96C6;&#x5408;&#x7684;&#x6210;&#x5458;&#x5BF9;&#x8C61;&#x88AB;&#x5220;&#x9664;&#x65F6;&#x3002;</span><span class="yiyi-st" id="yiyi-204">&#x96C6;&#x5408;&#x6210;&#x5458;&#x88AB;&#x6807;&#x8BB0;&#x4E3A;&#x4ECE;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x5220;&#x9664;&#x65F6;&#xFF0C;&#x8FD9;&#x4E0D;&#x4F1A;&#x5F71;&#x54CD;&#x96C6;&#x5408;&#x672C;&#x8EAB;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#xFF0C;&#x76F4;&#x5230;&#x96C6;&#x5408;&#x8FC7;&#x671F;&#x3002;</span><span class="yiyi-st" id="yiyi-205">&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x4E3E;&#x4F8B;&#x8BF4;&#x660E;&#x5373;&#x4F7F;&#x5728;<code class="docutils literal"><span class="pre">Address</span></code>&#x5BF9;&#x8C61;&#x88AB;&#x6807;&#x8BB0;&#x4E3A;&#x5220;&#x9664;&#x4E4B;&#x540E;&#xFF0C;&#x5373;&#x4F7F;&#x5728;&#x5237;&#x65B0;&#x4E4B;&#x540E;&#xFF0C;&#x5B83;&#x4ECD;&#x7136;&#x5B58;&#x5728;&#x4E8E;&#x4E0E;&#x7236;<code class="docutils literal"><span class="pre">User</span></code>&#x5173;&#x8054;&#x7684;&#x96C6;&#x5408;&#x4E2D;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">address</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">addresses</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">address</span> <span class="ow">in</span> <span class="n">user</span><span class="o">.</span><span class="n">addresses</span>
<span class="go">True</span></pre></div></div><p><span class="yiyi-st" id="yiyi-206">&#x5F53;&#x4E0A;&#x8FF0;&#x4F1A;&#x8BDD;&#x63D0;&#x4EA4;&#x65F6;&#xFF0C;&#x6240;&#x6709;&#x5C5E;&#x6027;&#x90FD;&#x5DF2;&#x8FC7;&#x671F;&#x3002;</span><span class="yiyi-st" id="yiyi-207"><code class="docutils literal"><span class="pre">user.addresses</span></code>&#x7684;&#x4E0B;&#x4E00;&#x6B21;&#x8BBF;&#x95EE;&#x5C06;&#x91CD;&#x65B0;&#x52A0;&#x8F7D;&#x96C6;&#x5408;&#xFF0C;&#x4ECE;&#x800C;&#x663E;&#x793A;&#x6240;&#x9700;&#x7684;&#x72B6;&#x6001;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">address</span> <span class="ow">in</span> <span class="n">user</span><span class="o">.</span><span class="n">addresses</span>
<span class="go">False</span></pre></div></div><p><span class="yiyi-st" id="yiyi-208">&#x5220;&#x9664;&#x96C6;&#x5408;&#x4E2D;&#x9879;&#x76EE;&#x7684;&#x901A;&#x5E38;&#x505A;&#x6CD5;&#x662F;&#x76F4;&#x63A5;&#x4F7F;&#x7528;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.delete" title="sqlalchemy.orm.session.Session.delete"><code class="xref py py-meth docutils literal"><span class="pre">delete()</span></code></a>&#xFF0C;&#x800C;&#x662F;&#x4F7F;&#x7528;&#x7EA7;&#x8054;&#x884C;&#x4E3A;&#x81EA;&#x4ECE;&#x4ECE;&#x7236;&#x96C6;&#x5408;&#x4E2D;&#x5220;&#x9664;&#x5BF9;&#x8C61;&#x540E;&#x81EA;&#x52A8;&#x8C03;&#x7528;&#x5220;&#x9664;&#x3002;</span><span class="yiyi-st" id="yiyi-209"><code class="docutils literal"><span class="pre">delete-orphan</span></code>&#x7EA7;&#x8054;&#x5B8C;&#x6210;&#x4E86;&#x8FD9;&#x4E00;&#x70B9;&#xFF0C;&#x5982;&#x4E0B;&#x4F8B;&#x6240;&#x793A;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">mapper</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">users_table</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="p">{</span>
    <span class="s1">&apos;addresses&apos;</span><span class="p">:</span><span class="n">relationship</span><span class="p">(</span><span class="n">Address</span><span class="p">,</span> <span class="n">cascade</span><span class="o">=</span><span class="s2">&quot;all, delete, delete-orphan&quot;</span><span class="p">)</span>
<span class="p">})</span>
<span class="k">del</span> <span class="n">user</span><span class="o">.</span><span class="n">addresses</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">session</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span></pre></div></div><p><span class="yiyi-st" id="yiyi-210">Where above, upon removing the <code class="docutils literal"><span class="pre">Address</span></code> object from the <code class="docutils literal"><span class="pre">User.addresses</span></code> collection, the <code class="docutils literal"><span class="pre">delete-orphan</span></code> cascade has the effect of marking the <code class="docutils literal"><span class="pre">Address</span></code> object for deletion in the same way as passing it to <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.delete" title="sqlalchemy.orm.session.Session.delete"><code class="xref py py-meth docutils literal"><span class="pre">delete()</span></code></a>.</span></p><p><span class="yiyi-st" id="yiyi-211">&#x6709;&#x5173;&#x7EA7;&#x8054;&#x7684;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x53E6;&#x8BF7;&#x53C2;&#x9605;<a class="reference internal" href="cascades.html#unitofwork-cascades"><span>Cascades</span></a>&#x3002;</span></p></div><div class="section" id="deleting-based-on-filter-criterion"><h4><span class="yiyi-st" id="yiyi-212">&#x57FA;&#x4E8E;&#x8FC7;&#x6EE4;&#x6761;&#x4EF6;&#x5220;&#x9664;<a class="headerlink" href="#deleting-based-on-filter-criterion" title="Permalink to this headline">&#xB6;</a></span></h4><p><span class="yiyi-st" id="yiyi-213">&#x5BF9;<code class="docutils literal"><span class="pre">Session.delete()</span></code>&#x7684;&#x8B66;&#x544A;&#x662F;&#x4F60;&#x9700;&#x8981;&#x6709;&#x4E00;&#x4E2A;&#x65B9;&#x4FBF;&#x7684;&#x5BF9;&#x8C61;&#x6765;&#x5220;&#x9664;&#x3002;</span><span class="yiyi-st" id="yiyi-214">&#x67E5;&#x8BE2;&#x5305;&#x542B;&#x4E00;&#x4E2A;<a class="reference internal" href="query.html#sqlalchemy.orm.query.Query.delete" title="sqlalchemy.orm.query.Query.delete"><code class="xref py py-func docutils literal"><span class="pre">delete()</span></code></a>&#x65B9;&#x6CD5;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x6839;&#x636E;&#x8FC7;&#x6EE4;&#x6807;&#x51C6;&#x5220;&#x9664;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span></pre></div></div><p><span class="yiyi-st" id="yiyi-215"><code class="docutils literal"><span class="pre">Query.delete()</span></code>&#x65B9;&#x6CD5;&#x5305;&#x542B;&#x5C06;&#x4F1A;&#x8BDD;&#x4E2D;&#x5DF2;&#x5B58;&#x5728;&#x7684;&#x7B26;&#x5408;&#x6761;&#x4EF6;&#x7684;&#x5BF9;&#x8C61;&#x201C;&#x8FC7;&#x671F;&#x201D;&#x7684;&#x529F;&#x80FD;&#x3002;</span><span class="yiyi-st" id="yiyi-216">&#x7136;&#x800C;&#xFF0C;&#x5B83;&#x786E;&#x5B9E;&#x6709;&#x4E00;&#x4E9B;&#x6CE8;&#x610F;&#x4E8B;&#x9879;&#xFF0C;&#x5305;&#x62EC;&#x201C;&#x5220;&#x9664;&#x201D;&#x548C;&#x201C;&#x5220;&#x9664;&#x5B64;&#x7ACB;&#x201D;&#x7EA7;&#x8054;&#x4E0D;&#x80FD;&#x5145;&#x5206;&#x8868;&#x8FBE;&#x5DF2;&#x7ECF;&#x52A0;&#x8F7D;&#x7684;&#x96C6;&#x5408;&#x3002;</span><span class="yiyi-st" id="yiyi-217">&#x6709;&#x5173;&#x66F4;&#x591A;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a class="reference internal" href="query.html#sqlalchemy.orm.query.Query.delete" title="sqlalchemy.orm.query.Query.delete"><code class="xref py py-meth docutils literal"><span class="pre">delete()</span></code></a>&#x7684;API&#x6587;&#x6863;&#x3002;</span></p></div></div><div class="section" id="flushing"><h3><span class="yiyi-st" id="yiyi-218">&#x6F6E;&#x7EA2;<a class="headerlink" href="#flushing" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h3><p><span class="yiyi-st" id="yiyi-219">&#x5F53;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x4E0E;&#x5176;&#x9ED8;&#x8BA4;&#x914D;&#x7F6E;&#x4E00;&#x8D77;&#x4F7F;&#x7528;&#x65F6;&#xFF0C;&#x51B2;&#x6D17;&#x6B65;&#x9AA4;&#x51E0;&#x4E4E;&#x603B;&#x662F;&#x900F;&#x660E;&#x5730;&#x8FDB;&#x884C;&#x3002;</span><span class="yiyi-st" id="yiyi-220">&#x5177;&#x4F53;&#x6765;&#x8BF4;&#xFF0C;&#x5237;&#x65B0;&#x53D1;&#x751F;&#x5728;&#x4EFB;&#x4F55;&#x5355;&#x4E2A;<a class="reference internal" href="query.html#sqlalchemy.orm.query.Query" title="sqlalchemy.orm.query.Query"><code class="xref py py-class docutils literal"><span class="pre">Query</span></code></a>&#x53D1;&#x5E03;&#x4E4B;&#x524D;&#xFF0C;&#x4EE5;&#x53CA;&#x5728;&#x4E8B;&#x52A1;&#x63D0;&#x4EA4;&#x4E4B;&#x524D;&#x7684;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.commit" title="sqlalchemy.orm.session.Session.commit"><code class="xref py py-meth docutils literal"><span class="pre">commit()</span></code></a>&#x8C03;&#x7528;&#x4E2D;&#x3002;</span><span class="yiyi-st" id="yiyi-221">&#x5F53;&#x4F7F;&#x7528;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.begin_nested" title="sqlalchemy.orm.session.Session.begin_nested"><code class="xref py py-meth docutils literal"><span class="pre">begin_nested()</span></code></a>&#x65F6;&#xFF0C;&#x5B83;&#x4E5F;&#x53D1;&#x751F;&#x5728;&#x53D1;&#x51FA;SAVEPOINT&#x4E4B;&#x524D;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-222">&#x65E0;&#x8BBA;&#x81EA;&#x52A8;&#x5237;&#x65B0;&#x8BBE;&#x7F6E;&#x5982;&#x4F55;&#xFF0C;&#x90FD;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x53D1;&#x51FA;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.flush" title="sqlalchemy.orm.session.Session.flush"><code class="xref py py-meth docutils literal"><span class="pre">flush()</span></code></a>&#x6765;&#x5F3A;&#x5236;&#x5237;&#x65B0;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span></pre></div></div><p><span class="yiyi-st" id="yiyi-223">&#x901A;&#x8FC7;&#x4F7F;&#x7528;&#x6807;&#x5FD7;<code class="docutils literal"><span class="pre">autoflush=False</span></code>&#x6784;&#x9020;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.sessionmaker" title="sqlalchemy.orm.session.sessionmaker"><code class="xref py py-class docutils literal"><span class="pre">sessionmaker</span></code></a>&#xFF0C;&#x53EF;&#x4EE5;&#x7981;&#x7528;&#x884C;&#x4E3A;&#x7684;&#x201C;flush-on-Query&#x201D;&#x65B9;&#x9762;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">Session</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">autoflush</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-224">&#x53E6;&#x5916;&#xFF0C;&#x53EF;&#x4EE5;&#x968F;&#x65F6;&#x901A;&#x8FC7;&#x8BBE;&#x7F6E;<code class="docutils literal"><span class="pre">autoflush</span></code>&#x6807;&#x5FD7;&#x6682;&#x65F6;&#x7981;&#x7528;&#x81EA;&#x52A8;&#x5237;&#x65B0;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">mysession</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>
<span class="n">mysession</span><span class="o">.</span><span class="n">autoflush</span> <span class="o">=</span> <span class="bp">False</span></pre></div></div><p><span class="yiyi-st" id="yiyi-225">&#x4E00;&#x4E9B;&#x7981;&#x6B62;&#x81EA;&#x52A8;&#x5237;&#x65B0;&#x7684;&#x914D;&#x65B9;&#x53EF;&#x5728;<a class="reference external" href="http://www.sqlalchemy.org/trac/wiki/UsageRecipes/DisableAutoflush">DisableAutoFlush</a>&#x4E2D;&#x627E;&#x5230;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-226">The flush process <em>always</em> occurs within a transaction, even if the <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a> has been configured with <code class="docutils literal"><span class="pre">autocommit=True</span></code>, a setting that disables the session&#x2019;s persistent transactional state. </span><span class="yiyi-st" id="yiyi-227">&#x5982;&#x679C;&#x6CA1;&#x6709;&#x4E8B;&#x52A1;&#x5B58;&#x5728;&#xFF0C;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.flush" title="sqlalchemy.orm.session.Session.flush"><code class="xref py py-meth docutils literal"><span class="pre">flush()</span></code></a>&#x521B;&#x5EFA;&#x81EA;&#x5DF1;&#x7684;&#x4E8B;&#x52A1;&#x5E76;&#x63D0;&#x4EA4;&#x5B83;&#x3002;</span><span class="yiyi-st" id="yiyi-228">&#x5728;&#x5237;&#x65B0;&#x671F;&#x95F4;&#x4EFB;&#x4F55;&#x5931;&#x8D25;&#x90FD;&#x4F1A;&#x5BFC;&#x81F4;&#x6240;&#x6709;&#x4EA4;&#x6613;&#x7684;&#x56DE;&#x6EDA;&#x3002;</span><span class="yiyi-st" id="yiyi-229">&#x5982;&#x679C;&#x4F1A;&#x8BDD;&#x4E0D;&#x5904;&#x4E8E;<code class="docutils literal"><span class="pre">autocommit=True</span></code>&#x6A21;&#x5F0F;&#xFF0C;&#x5373;&#x4F7F;&#x57FA;&#x672C;&#x4E8B;&#x52A1;&#x5DF2;&#x7ECF;&#x88AB;&#x56DE;&#x6EDA;&#xFF0C;&#x4F46;&#x5728;&#x5237;&#x65B0;&#x5931;&#x8D25;&#x540E;&#x4ECD;&#x9700;&#x8981;&#x5BF9;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.rollback" title="sqlalchemy.orm.session.Session.rollback"><code class="xref py py-meth docutils literal"><span class="pre">rollback()</span></code></a>&#x8FDB;&#x884C;&#x663E;&#x5F0F;&#x8C03;&#x7528; - &#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x4FDD;&#x6301;&#x6240;&#x8C13;&#x7684;&#x201C;&#x5B50;&#x4E8B;&#x52A1;&#x201D;&#x7684;&#x6574;&#x4F53;&#x5D4C;&#x5957;&#x6A21;&#x5F0F;&#x3002;</span></p></div><div class="section" id="committing"><h3><span class="yiyi-st" id="yiyi-230">&#x72AF;<a class="headerlink" href="#committing" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h3><p><span class="yiyi-st" id="yiyi-231"><a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.commit" title="sqlalchemy.orm.session.Session.commit"><code class="xref py py-meth docutils literal"><span class="pre">commit()</span></code></a> is used to commit the current transaction. </span><span class="yiyi-st" id="yiyi-232">&#x5B83;&#x603B;&#x662F;&#x4E8B;&#x5148;&#x53D1;&#x9001;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.flush" title="sqlalchemy.orm.session.Session.flush"><code class="xref py py-meth docutils literal"><span class="pre">flush()</span></code></a>&#x4EE5;&#x5C06;&#x4EFB;&#x4F55;&#x5269;&#x4F59;&#x72B6;&#x6001;&#x6E05;&#x9664;&#x5230;&#x6570;&#x636E;&#x5E93;&#xFF1B;&#x8FD9;&#x4E0E;&#x201C;&#x81EA;&#x52A8;&#x5237;&#x65B0;&#x201D;&#x8BBE;&#x7F6E;&#x65E0;&#x5173;&#x3002;</span><span class="yiyi-st" id="yiyi-233">&#x5982;&#x679C;&#x6CA1;&#x6709;&#x4EA4;&#x6613;&#x5B58;&#x5728;&#xFF0C;&#x5219;&#x4F1A;&#x5F15;&#x53D1;&#x9519;&#x8BEF;&#x3002;</span><span class="yiyi-st" id="yiyi-234">&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x7684;&#x9ED8;&#x8BA4;&#x884C;&#x4E3A;&#x662F;&#x201C;&#x4EA4;&#x6613;&#x201D;&#x59CB;&#x7EC8;&#x5B58;&#x5728;&#xFF1B;&#x8FD9;&#x79CD;&#x884C;&#x4E3A;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8BBE;&#x7F6E;<code class="docutils literal"><span class="pre">autocommit=True</span></code>&#x6765;&#x7981;&#x7528;&#x3002;</span><span class="yiyi-st" id="yiyi-235">&#x5728;&#x81EA;&#x52A8;&#x63D0;&#x4EA4;&#x6A21;&#x5F0F;&#x4E0B;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8C03;&#x7528;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.begin" title="sqlalchemy.orm.session.Session.begin"><code class="xref py py-meth docutils literal"><span class="pre">begin()</span></code></a>&#x65B9;&#x6CD5;&#x542F;&#x52A8;&#x4E8B;&#x52A1;&#x3002;</span></p><div class="admonition note"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-236">&#x6CE8;&#x610F;</span></p><p class="last"><span class="yiyi-st" id="yiyi-237">&#x8FD9;&#x91CC;&#x7684;&#x672F;&#x8BED;&#x201C;&#x4E8B;&#x52A1;&#x201D;&#x662F;&#x6307;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x5185;&#x90E8;&#x7684;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#x6027;&#x6784;&#x9020;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x7EF4;&#x6301;&#x96F6;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x5B9E;&#x9645;&#x6570;&#x636E;&#x5E93;&#xFF08;DBAPI&#xFF09;&#x4E8B;&#x52A1;&#x3002;</span><span class="yiyi-st" id="yiyi-238">&#x4E00;&#x4E2A;&#x5355;&#x72EC;&#x7684;DBAPI&#x8FDE;&#x63A5;&#x5F00;&#x59CB;&#x53C2;&#x4E0E;&#x201C;&#x4E8B;&#x52A1;&#x201D;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x9996;&#x5148;&#x7528;&#x4E8E;&#x6267;&#x884C;SQL&#x8BED;&#x53E5;&#xFF0C;&#x7136;&#x540E;&#x76F4;&#x5230;&#x4F1A;&#x8BDD;&#x7EA7;&#x522B;&#x201C;&#x4E8B;&#x52A1;&#x201D;&#x5B8C;&#x6210;&#x65F6;&#x624D;&#x5B58;&#x5728;&#x3002;</span><span class="yiyi-st" id="yiyi-239">&#x6709;&#x5173;&#x66F4;&#x591A;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a class="reference internal" href="session_transaction.html#unitofwork-transaction"><span>Managing Transactions</span></a>&#x3002;</span></p></div><p><span class="yiyi-st" id="yiyi-240"><a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.commit" title="sqlalchemy.orm.session.Session.commit"><code class="xref py py-meth docutils literal"><span class="pre">commit()</span></code></a>&#x7684;&#x53E6;&#x4E00;&#x4E2A;&#x884C;&#x4E3A;&#x662F;&#xFF0C;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5B83;&#x4F1A;&#x5728;&#x63D0;&#x4EA4;&#x5B8C;&#x6210;&#x540E;&#x8D85;&#x65F6;&#x6240;&#x6709;&#x5B9E;&#x4F8B;&#x7684;&#x72B6;&#x6001;&#x3002;</span><span class="yiyi-st" id="yiyi-241">&#x8FD9;&#x6837;&#x5F53;&#x4E0B;&#x6B21;&#x8BBF;&#x95EE;&#x5B9E;&#x4F8B;&#x65F6;&#xFF0C;&#x65E0;&#x8BBA;&#x662F;&#x901A;&#x8FC7;&#x5C5E;&#x6027;&#x8BBF;&#x95EE;&#x8FD8;&#x662F;&#x901A;&#x8FC7;&#x5B83;&#x4EEC;&#x5B58;&#x5728;&#x4E8E;<a class="reference internal" href="query.html#sqlalchemy.orm.query.Query" title="sqlalchemy.orm.query.Query"><code class="xref py py-class docutils literal"><span class="pre">Query</span></code></a>&#x7ED3;&#x679C;&#x96C6;&#x4E2D;&#xFF0C;&#x5B83;&#x4EEC;&#x90FD;&#x4F1A;&#x6536;&#x5230;&#x6700;&#x8FD1;&#x7684;&#x72B6;&#x6001;&#x3002;</span><span class="yiyi-st" id="yiyi-242">&#x8981;&#x7981;&#x7528;&#x6B64;&#x884C;&#x4E3A;&#xFF0C;&#x8BF7;&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">expire_on_commit=False</span></code>&#x914D;&#x7F6E;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.sessionmaker" title="sqlalchemy.orm.session.sessionmaker"><code class="xref py py-class docutils literal"><span class="pre">sessionmaker</span></code></a>&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-243">&#x901A;&#x5E38;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x52A0;&#x8F7D;&#x5230;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x7684;&#x5B9E;&#x4F8B;&#x4E0D;&#x4F1A;&#x88AB;&#x968F;&#x540E;&#x7684;&#x67E5;&#x8BE2;&#x6539;&#x53D8;&#xFF1B;&#x5047;&#x5B9A;&#x5F53;&#x524D;&#x4E8B;&#x52A1;&#x662F;&#x5B64;&#x7ACB;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x53EA;&#x8981;&#x4E8B;&#x52A1;&#x7EE7;&#x7EED;&#xFF0C;&#x6700;&#x8FD1;&#x52A0;&#x8F7D;&#x7684;&#x72B6;&#x6001;&#x662F;&#x6B63;&#x786E;&#x7684;&#x3002;</span><span class="yiyi-st" id="yiyi-244">&#x7531;&#x4E8E;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x7684;&#x884C;&#x4E3A;&#x4E0E;&#x5C5E;&#x6027;&#x72B6;&#x6001;&#x5B8C;&#x5168;&#x76F8;&#x540C;&#xFF0C;&#x9664;&#x4E86;&#x4E0D;&#x5B58;&#x5728;&#x4E8B;&#x52A1;&#x5916;&#xFF0C;&#x8BBE;&#x7F6E;<code class="docutils literal"><span class="pre">autocommit=True</span></code>&#x5728;&#x67D0;&#x79CD;&#x7A0B;&#x5EA6;&#x4E0A;&#x5BF9;&#x6B64;&#x6A21;&#x578B;&#x8D77;&#x4F5C;&#x7528;&#x3002;</span></p></div><div class="section" id="rolling-back"><h3><span class="yiyi-st" id="yiyi-245">&#x56DE;&#x6EDA;<a class="headerlink" href="#rolling-back" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-246"><a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.rollback" title="sqlalchemy.orm.session.Session.rollback"><code class="xref py py-meth docutils literal"><span class="pre">rollback()</span></code></a>&#x56DE;&#x6EDA;&#x5F53;&#x524D;&#x4E8B;&#x52A1;&#x3002;</span><span class="yiyi-st" id="yiyi-247">&#x4F7F;&#x7528;&#x9ED8;&#x8BA4;&#x914D;&#x7F6E;&#x7684;&#x4F1A;&#x8BDD;&#x65F6;&#xFF0C;&#x4F1A;&#x8BDD;&#x7684;&#x56DE;&#x6EDA;&#x540E;&#x72B6;&#x6001;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</span></p><blockquote><div><ul class="simple"><li><span class="yiyi-st" id="yiyi-248">&#x6240;&#x6709;&#x4E8B;&#x52A1;&#x56DE;&#x6EDA;&#x5E76;&#x4E14;&#x6240;&#x6709;&#x8FDE;&#x63A5;&#x8FD4;&#x56DE;&#x5230;&#x8FDE;&#x63A5;&#x6C60;&#xFF0C;&#x9664;&#x975E;Session&#x76F4;&#x63A5;&#x7ED1;&#x5B9A;&#x5230;Connection&#xFF0C;&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8FDE;&#x63A5;&#x4ECD;&#x7136;&#x4FDD;&#x6301;&#xFF08;&#x4F46;&#x4ECD;&#x7136;&#x56DE;&#x6EDA;&#xFF09;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-249">&#x5F53;&#x5B83;&#x4EEC;&#x88AB;&#x6DFB;&#x52A0;&#x5230;&#x4E8B;&#x52A1;&#x751F;&#x547D;&#x5468;&#x671F;&#x5185;&#x7684;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x65F6;&#xFF0C;&#x6700;&#x521D;&#x5904;&#x4E8E;<em>&#x6302;&#x8D77;</em>&#x72B6;&#x6001;&#x7684;&#x5BF9;&#x8C61;&#x88AB;&#x5220;&#x9664;&#xFF0C;&#x5BF9;&#x5E94;&#x4E8E;&#x5B83;&#x4EEC;&#x7684;INSERT&#x8BED;&#x53E5;&#x88AB;&#x56DE;&#x6EDA;&#x3002;</span><span class="yiyi-st" id="yiyi-250">&#x5B83;&#x4EEC;&#x7684;&#x5C5E;&#x6027;&#x72B6;&#x6001;&#x4FDD;&#x6301;&#x4E0D;&#x53D8;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-251">&#x5728;&#x4E8B;&#x52A1;&#x751F;&#x547D;&#x5468;&#x671F;&#x5185;&#x88AB;&#x6807;&#x8BB0;&#x4E3A;<em>&#x5220;&#x9664;</em>&#x7684;&#x5BF9;&#x8C61;&#x88AB;&#x63D0;&#x5347;&#x56DE;<em>&#x6301;&#x4E45;</em>&#x72B6;&#x6001;&#xFF0C;&#x5BF9;&#x5E94;&#x4E8E;&#x5B83;&#x4EEC;&#x7684;DELETE&#x8BED;&#x53E5;&#x88AB;&#x56DE;&#x6EDA;&#x3002;</span><span class="yiyi-st" id="yiyi-252">&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x5982;&#x679C;&#x8FD9;&#x4E9B;&#x5BF9;&#x8C61;&#x5728;&#x4E8B;&#x52A1;&#x5185;&#x7B2C;&#x4E00;&#x4E2A;<em>&#x6302;&#x8D77;</em>&#xFF0C;&#x5219;&#x8BE5;&#x64CD;&#x4F5C;&#x4F18;&#x5148;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-253">&#x6240;&#x6709;&#x672A;&#x88AB;&#x6E05;&#x9664;&#x7684;&#x5BF9;&#x8C61;&#x5DF2;&#x7ECF;&#x8FC7;&#x671F;&#x3002;</span></li></ul></div></blockquote><p><span class="yiyi-st" id="yiyi-254">&#x5728;&#x4E86;&#x89E3;&#x8BE5;&#x72B6;&#x6001;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x53EF;&#x4EE5;&#x5728;&#x56DE;&#x6EDA;&#x53D1;&#x751F;&#x540E;&#x5B89;&#x5168;&#x5730;&#x7EE7;&#x7EED;&#x4F7F;&#x7528;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-255">&#x5F53;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.flush" title="sqlalchemy.orm.session.Session.flush"><code class="xref py py-meth docutils literal"><span class="pre">flush()</span></code></a>&#x5931;&#x8D25;&#x65F6;&#xFF0C;&#x901A;&#x5E38;&#x7531;&#x4E8E;&#x4E3B;&#x952E;&#xFF0C;&#x5916;&#x952E;&#x6216;&#x201C;&#x4E0D;&#x53EF;&#x7A7A;&#x201D;&#x7EA6;&#x675F;&#x8FDD;&#x53CD;&#x7B49;&#x539F;&#x56E0;&#x800C;&#x81EA;&#x52A8;&#x53D1;&#x51FA;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.rollback" title="sqlalchemy.orm.session.Session.rollback"><code class="xref py py-meth docutils literal"><span class="pre">rollback()</span></code></a>&#x90E8;&#x5206;&#x6545;&#x969C;&#x540E;&#x53EF;&#x80FD;&#x4F1A;&#x7EE7;&#x7EED;&#x51B2;&#x6D17;&#xFF09;&#x3002;</span><span class="yiyi-st" id="yiyi-256">&#x4F46;&#x662F;&#xFF0C;flush&#x8FC7;&#x7A0B;&#x603B;&#x662F;&#x4F7F;&#x7528;&#x81EA;&#x5DF1;&#x7684;&#x4E8B;&#x52A1;&#x5212;&#x5206;&#x5668;&#xFF0C;&#x79F0;&#x4E3A;<em>subsnsaction</em>&#xFF0C;&#x8FD9;&#x5728;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x7684;&#x6587;&#x6863;&#x5B57;&#x7B26;&#x4E32;&#x4E2D;&#x6709;&#x66F4;&#x8BE6;&#x7EC6;&#x7684;&#x63CF;&#x8FF0;&#x3002;</span><span class="yiyi-st" id="yiyi-257">&#x8FD9;&#x610F;&#x5473;&#x7740;&#x5373;&#x4F7F;&#x6570;&#x636E;&#x5E93;&#x4E8B;&#x52A1;&#x5DF2;&#x7ECF;&#x56DE;&#x6EDA;&#xFF0C;&#x6700;&#x7EC8;&#x7528;&#x6237;&#x4ECD;&#x7136;&#x5FC5;&#x987B;&#x53D1;&#x51FA;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.rollback" title="sqlalchemy.orm.session.Session.rollback"><code class="xref py py-meth docutils literal"><span class="pre">rollback()</span></code></a>&#x6765;&#x5B8C;&#x5168;&#x91CD;&#x7F6E;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x7684;&#x72B6;&#x6001;&#x3002;</span></p></div><div class="section" id="closing"><h3><span class="yiyi-st" id="yiyi-258">&#x7ED3;&#x675F;<a class="headerlink" href="#closing" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h3><p><span class="yiyi-st" id="yiyi-259"><a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.close" title="sqlalchemy.orm.session.Session.close"><code class="xref py py-meth docutils literal"><span class="pre">close()</span></code></a>&#x65B9;&#x6CD5;&#x53D1;&#x5E03;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.expunge_all" title="sqlalchemy.orm.session.Session.expunge_all"><code class="xref py py-meth docutils literal"><span class="pre">expunge_all()</span></code></a>&#xFF0C;<a class="reference internal" href="glossary.html#term-releases"><span class="xref std std-term">releases</span></a>&#x4EFB;&#x4F55;&#x4E8B;&#x52A1;/&#x8FDE;&#x63A5;&#x8D44;&#x6E90;&#x3002;</span><span class="yiyi-st" id="yiyi-260">&#x5F53;&#x8FDE;&#x63A5;&#x8FD4;&#x56DE;&#x5230;&#x8FDE;&#x63A5;&#x6C60;&#x65F6;&#xFF0C;&#x4E8B;&#x52A1;&#x72B6;&#x6001;&#x4E5F;&#x4F1A;&#x56DE;&#x6EDA;&#x3002;</span></p></div></div>