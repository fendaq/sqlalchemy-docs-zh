<h1><span class="yiyi-st" id="yiyi-53">&#x914D;&#x7F6E;&#x5173;&#x7CFB;&#x5982;&#x4F55;&#x8FDE;&#x63A5;<a class="headerlink" href="#configuring-how-relationship-joins" title="Permalink to this headline">&#xB6;</a></span></h1><p><span class="yiyi-st" id="yiyi-54"><a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a> will normally create a join between two tables by examining the foreign key relationship between the two tables to determine which columns should be compared. </span><span class="yiyi-st" id="yiyi-55">&#x6709;&#x591A;&#x79CD;&#x60C5;&#x51B5;&#x9700;&#x8981;&#x5B9A;&#x5236;&#x6B64;&#x884C;&#x4E3A;&#x3002;</span></p><div class="section" id="handling-multiple-join-paths"><h2><span class="yiyi-st" id="yiyi-56">&#x5904;&#x7406;&#x591A;&#x4E2A;&#x8FDE;&#x63A5;&#x8DEF;&#x5F84;<a class="headerlink" href="#handling-multiple-join-paths" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-57">&#x5904;&#x7406;&#x7684;&#x6700;&#x5E38;&#x89C1;&#x60C5;&#x51B5;&#x4E4B;&#x4E00;&#x662F;&#x4E24;&#x4E2A;&#x8868;&#x4E4B;&#x95F4;&#x6709;&#x591A;&#x4E2A;&#x5916;&#x952E;&#x8DEF;&#x5F84;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-58">&#x8003;&#x8651;&#x4E00;&#x4E2A;&#x5305;&#x542B;<code class="docutils literal"><span class="pre">Address</span></code>&#x7C7B;&#x7684;&#x4E24;&#x4E2A;&#x5916;&#x952E;&#x7684;<code class="docutils literal"><span class="pre">Customer</span></code>&#x7C7B;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">Column</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">relationship</span>

<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Customer</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;customer&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>

    <span class="n">billing_address_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;address.id&quot;</span><span class="p">))</span>
    <span class="n">shipping_address_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;address.id&quot;</span><span class="p">))</span>

    <span class="n">billing_address</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Address&quot;</span><span class="p">)</span>
    <span class="n">shipping_address</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Address&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Address</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;address&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">street</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>
    <span class="n">city</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>
    <span class="nb">zip</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-59">&#x4E0A;&#x9762;&#x7684;&#x6620;&#x5C04;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x5C1D;&#x8BD5;&#x4F7F;&#x7528;&#x5B83;&#x65F6;&#xFF0C;&#x4F1A;&#x4EA7;&#x751F;&#x9519;&#x8BEF;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>sqlalchemy.exc.AmbiguousForeignKeysError: Could not determine join
condition between parent/child tables on relationship
Customer.billing_address - there are multiple foreign key
paths linking the tables.  Specify the &apos;foreign_keys&apos; argument,
providing a list of those columns which should be
counted as containing a foreign key reference to the parent table.</pre></div></div><p><span class="yiyi-st" id="yiyi-60">&#x4E0A;&#x9762;&#x7684;&#x6D88;&#x606F;&#x5F88;&#x957F;&#x3002;</span><span class="yiyi-st" id="yiyi-61"><a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#x53EF;&#x4EE5;&#x8FD4;&#x56DE;&#x5F88;&#x591A;&#x6F5C;&#x5728;&#x7684;&#x6D88;&#x606F;&#xFF0C;&#x8FD9;&#x4E9B;&#x6D88;&#x606F;&#x7ECF;&#x8FC7;&#x7CBE;&#x5FC3;&#x5B9A;&#x5236;&#x4EE5;&#x68C0;&#x6D4B;&#x5404;&#x79CD;&#x5E38;&#x89C1;&#x914D;&#x7F6E;&#x95EE;&#x9898;&#xFF1B;&#x5927;&#x591A;&#x6570;&#x4EBA;&#x4F1A;&#x5EFA;&#x8BAE;&#x89E3;&#x51B3;&#x6B67;&#x4E49;&#x6216;&#x5176;&#x4ED6;&#x7F3A;&#x5931;&#x4FE1;&#x606F;&#x6240;&#x9700;&#x7684;&#x989D;&#x5916;&#x914D;&#x7F6E;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-62">&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6D88;&#x606F;&#x5E0C;&#x671B;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x6307;&#x793A;&#x6BCF;&#x4E2A;&#x5173;&#x952E;&#x5B57;&#x5217;&#x5E94;&#x8BE5;&#x88AB;&#x8003;&#x8651;&#xFF0C;&#x6765;&#x9650;&#x5B9A;&#x6BCF;&#x4E2A;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#xFF0C;&#x5E76;&#x4E14;&#x9002;&#x5F53;&#x7684;&#x683C;&#x5F0F;&#x5982;&#x4E0B;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Customer</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;customer&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>

    <span class="n">billing_address_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;address.id&quot;</span><span class="p">))</span>
    <span class="n">shipping_address_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;address.id&quot;</span><span class="p">))</span>

    <span class="n">billing_address</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Address&quot;</span><span class="p">,</span> <span class="n">foreign_keys</span><span class="o">=</span><span class="p">[</span><span class="n">billing_address_id</span><span class="p">])</span>
    <span class="n">shipping_address</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Address&quot;</span><span class="p">,</span> <span class="n">foreign_keys</span><span class="o">=</span><span class="p">[</span><span class="n">shipping_address_id</span><span class="p">])</span></pre></div></div><p><span class="yiyi-st" id="yiyi-63">&#x5728;&#x4E0A;&#x9762;&#xFF0C;&#x6211;&#x4EEC;&#x6307;&#x5B9A;&#x4E86;<code class="docutils literal"><span class="pre">foreign_keys</span></code>&#x53C2;&#x6570;&#xFF0C;&#x5B83;&#x662F;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a>&#x6216;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a>&#x5BF9;&#x8C61;&#x7684;&#x5217;&#x8868;&#xFF0C;&#x6307;&#x793A;&#x90A3;&#x4E9B;&#x5217;&#x88AB;&#x89C6;&#x4E3A;&#x201C;&#x5916;&#x90E8;&#x201D;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;&#x5305;&#x542B;&#x5F15;&#x7528;&#x7236;&#x8868;&#x7684;&#x503C;&#x7684;&#x5217;&#x3002;</span><span class="yiyi-st" id="yiyi-64">Loading the <code class="docutils literal"><span class="pre">Customer.billing_address</span></code> relationship from a <code class="docutils literal"><span class="pre">Customer</span></code> object will use the value present in <code class="docutils literal"><span class="pre">billing_address_id</span></code> in order to identify the row in <code class="docutils literal"><span class="pre">Address</span></code> to be loaded; similarly, <code class="docutils literal"><span class="pre">shipping_address_id</span></code> is used for the <code class="docutils literal"><span class="pre">shipping_address</span></code> relationship. </span><span class="yiyi-st" id="yiyi-65">&#x4E24;&#x5217;&#x7684;&#x8054;&#x7CFB;&#x5728;&#x6301;&#x7EED;&#x671F;&#x95F4;&#x4E5F;&#x8D77;&#x7740;&#x4F5C;&#x7528;&#xFF1B;&#x521A;&#x521A;&#x63D2;&#x5165;&#x7684;<code class="docutils literal"><span class="pre">Address</span></code>&#x5BF9;&#x8C61;&#x7684;&#x65B0;&#x751F;&#x6210;&#x7684;&#x4E3B;&#x952E;&#x5C06;&#x5728;&#x5237;&#x65B0;&#x671F;&#x95F4;&#x88AB;&#x590D;&#x5236;&#x5230;&#x5173;&#x8054;<code class="docutils literal"><span class="pre">Customer</span></code>&#x5BF9;&#x8C61;&#x7684;&#x76F8;&#x5E94;&#x5916;&#x952E;&#x5217;&#x4E2D;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-66">&#x4F7F;&#x7528;Declarative&#x6307;&#x5B9A;<code class="docutils literal"><span class="pre">foreign_keys</span></code>&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5B57;&#x7B26;&#x4E32;&#x540D;&#x79F0;&#x6765;&#x6307;&#x5B9A;&#xFF0C;&#x4F46;&#x662F;&#x5982;&#x679C;&#x4F7F;&#x7528;&#x5217;&#x8868;&#xFF0C;&#x5219;<strong>&#x5217;&#x8868;&#x662F;&#x5B57;&#x7B26;&#x4E32;</strong>&#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x8FD9;&#x4E00;&#x70B9;&#x5F88;&#x91CD;&#x8981;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">billing_address</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Address&quot;</span><span class="p">,</span> <span class="n">foreign_keys</span><span class="o">=</span><span class="s2">&quot;[Customer.billing_address_id]&quot;</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-67">&#x5728;&#x8FD9;&#x4E2A;&#x7279;&#x5B9A;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x56E0;&#x4E3A;&#x53EA;&#x6709;&#x4E00;&#x4E2A;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a>&#x6211;&#x4EEC;&#x9700;&#x8981;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">billing_address</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Address&quot;</span><span class="p">,</span> <span class="n">foreign_keys</span><span class="o">=</span><span class="s2">&quot;Customer.billing_address_id&quot;</span><span class="p">)</span></pre></div></div><div class="versionchanged"><p><span class="yiyi-st" id="yiyi-68"><span class="versionmodified">&#x5728;&#x7248;&#x672C;0.8&#x4E2D;&#x66F4;&#x6539;&#xFF1A;</span> <a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#x53EF;&#x4EE5;&#x5355;&#x72EC;&#x6839;&#x636E;<code class="docutils literal"><span class="pre">foreign_keys</span></code>&#x53C2;&#x6570;&#x89E3;&#x51B3;&#x5916;&#x952E;&#x76EE;&#x6807;&#x4E4B;&#x95F4;&#x7684;&#x6B67;&#x4E49;&#xFF1B;&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4E0D;&#x518D;&#x9700;&#x8981;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.primaryjoin" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">primaryjoin</span></code></a>&#x53C2;&#x6570;&#x3002;</span></p></div></div><div class="section" id="specifying-alternate-join-conditions"><h2><span class="yiyi-st" id="yiyi-69">&#x6307;&#x5B9A;&#x4EA4;&#x66FF;&#x8FDE;&#x63A5;&#x6761;&#x4EF6;<a class="headerlink" href="#specifying-alternate-join-conditions" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-70">&#x6784;&#x9020;&#x8FDE;&#x63A5;&#x65F6;&#xFF0C;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#x7684;&#x9ED8;&#x8BA4;&#x884C;&#x4E3A;&#x662F;&#xFF0C;&#x5B83;&#x5C06;&#x4E00;&#x4FA7;&#x7684;&#x4E3B;&#x952E;&#x5217;&#x7684;&#x503C;&#x4E0E;&#x53E6;&#x4E00;&#x4FA7;&#x7684;&#x5916;&#x952E;&#x5F15;&#x7528;&#x5217;&#x7684;&#x503C;&#x76F8;&#x7B49;&#x3002;</span><span class="yiyi-st" id="yiyi-71">&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5C06;&#x6B64;&#x6807;&#x51C6;&#x66F4;&#x6539;&#x4E3A;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x4F7F;&#x7528;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.primaryjoin" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">primaryjoin</span></code></a>&#x53C2;&#x6570;&#x7684;&#x4EFB;&#x4F55;&#x5185;&#x5BB9;&#xFF0C;&#x4EE5;&#x53CA;&#x5728;&#x4F7F;&#x7528;&#x201C;&#x8F85;&#x52A9;&#x201D;&#x8868;&#x683C;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x4F7F;&#x7528;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.secondaryjoin" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">secondaryjoin</span></code></a>&#x53C2;&#x6570;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-72">&#x5728;&#x4E0B;&#x9762;&#x7684;&#x793A;&#x4F8B;&#x4E2D;&#xFF0C;&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">User</span></code>&#x7C7B;&#x4EE5;&#x53CA;&#x5B58;&#x50A8;&#x8857;&#x9053;&#x5730;&#x5740;&#x7684;<code class="docutils literal"><span class="pre">Address</span></code>&#x7C7B;&#xFF0C;&#x6211;&#x4EEC;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5173;&#x7CFB;<code class="docutils literal"><span class="pre">boston_addresses</span></code>&#x52A0;&#x8F7D;&#x6307;&#x5B9A;&#x57CE;&#x5E02;&#x201C;&#x6CE2;&#x58EB;&#x987F;&#x201D;&#x7684;<code class="docutils literal"><span class="pre">Address</span></code>&#x5BF9;&#x8C61;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">Column</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">relationship</span>

<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;user&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>
    <span class="n">boston_addresses</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Address&quot;</span><span class="p">,</span>
                    <span class="n">primaryjoin</span><span class="o">=</span><span class="s2">&quot;and_(User.id==Address.user_id, &quot;</span>
                        <span class="s2">&quot;Address.city==&apos;Boston&apos;)&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Address</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;address&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;user.id&apos;</span><span class="p">))</span>

    <span class="n">street</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>
    <span class="n">city</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>
    <span class="nb">zip</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-73">&#x5728;&#x8FD9;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#x7684;SQL&#x8868;&#x8FBE;&#x5F0F;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.and_" title="sqlalchemy.sql.expression.and_"><code class="xref py py-func docutils literal"><span class="pre">and_()</span></code></a>&#x8FDE;&#x63A5;&#x7ED3;&#x6784;&#x4E3A;&#x8FDE;&#x63A5;&#x6761;&#x4EF6;&#x5EFA;&#x7ACB;&#x4E24;&#x4E2A;&#x4E0D;&#x540C;&#x7684;&#x8C13;&#x8BCD; - &#x8FDE;&#x63A5;<code class="docutils literal"><span class="pre">User.id</span></code>&#x548C;<code class="docutils literal"><span class="pre">Address.user_id</span></code>&#x5217;&#xFF0C;&#x5E76;&#x5C06;<code class="docutils literal"><span class="pre">Address</span></code>&#x4E2D;&#x7684;&#x884C;&#x9650;&#x5236;&#x4E3A;<code class="docutils literal"><span class="pre">city=&apos;Boston&apos;</span></code>&#x3002;</span><span class="yiyi-st" id="yiyi-74">&#x4F7F;&#x7528;&#x58F0;&#x660E;&#x65F6;&#xFF0C;&#x50CF;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.and_" title="sqlalchemy.sql.expression.and_"><code class="xref py py-func docutils literal"><span class="pre">and_()</span></code></a>&#x8FD9;&#x6837;&#x7684;&#x57FA;&#x672C;SQL&#x51FD;&#x6570;&#x53EF;&#x4EE5;&#x5728;&#x5B57;&#x7B26;&#x4E32;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#x53C2;&#x6570;&#x7684;&#x8BA1;&#x7B97;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x4E2D;&#x81EA;&#x52A8;&#x4F7F;&#x7528;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-75">&#x6211;&#x4EEC;&#x5728;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.primaryjoin" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">primaryjoin</span></code></a>&#x4E2D;&#x4F7F;&#x7528;&#x7684;&#x81EA;&#x5B9A;&#x4E49;&#x6807;&#x51C6;&#x901A;&#x5E38;&#x4EC5;&#x5728;SQLAlchemy&#x5448;&#x73B0;SQL&#x4EE5;&#x52A0;&#x8F7D;&#x6216;&#x8868;&#x793A;&#x6B64;&#x5173;&#x7CFB;&#x65F6;&#x624D;&#x6709;&#x610F;&#x4E49;&#x3002;</span><span class="yiyi-st" id="yiyi-76">&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x5B83;&#x88AB;&#x7528;&#x4E8E;&#x4E3A;&#x4E86;&#x6267;&#x884C;&#x6BCF;&#x4E2A;&#x5C5E;&#x6027;&#x7684;&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x800C;&#x53D1;&#x51FA;&#x7684;SQL&#x8BED;&#x53E5;&#x4E2D;&#xFF0C;&#x6216;&#x8005;&#x5728;&#x67E5;&#x8BE2;&#x65F6;&#x6784;&#x5EFA;&#x8FDE;&#x63A5;&#xFF08;&#x4F8B;&#x5982;&#x901A;&#x8FC7;<a class="reference internal" href="query.html#sqlalchemy.orm.query.Query.join" title="sqlalchemy.orm.query.Query.join"><code class="xref py py-meth docutils literal"><span class="pre">Query.join()</span></code></a>&#xFF09;&#x6216;&#x901A;&#x8FC7;&#x6025;&#x5207;&#x7684;&#x201C;&#x52A0;&#x5165;&#x201D;&#x6216;&#x201C;&#x5B50;&#x67E5;&#x8BE2;&#x201D;&#x52A0;&#x8F7D;&#x6837;&#x5F0F;&#x3002;</span><span class="yiyi-st" id="yiyi-77">&#x5F53;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x5BF9;&#x8C61;&#x88AB;&#x64CD;&#x4F5C;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5C06;&#x4EFB;&#x4F55;<code class="docutils literal"><span class="pre">Address</span></code>&#x5BF9;&#x8C61;&#x653E;&#x5165;<code class="docutils literal"><span class="pre">boston_addresses</span></code>&#x96C6;&#x5408;&#x4E2D;&#xFF0C;&#x800C;&#x4E0D;&#x7BA1;<code class="docutils literal"><span class="pre">.city</span></code>&#x5C5E;&#x6027;&#x662F;&#x3002;</span><span class="yiyi-st" id="yiyi-78">&#x5BF9;&#x8C61;&#x5C06;&#x4FDD;&#x7559;&#x5728;&#x96C6;&#x5408;&#x4E2D;&#xFF0C;&#x76F4;&#x5230;&#x5C5E;&#x6027;&#x8FC7;&#x671F;&#x5E76;&#x4ECE;&#x5E94;&#x7528;&#x8BE5;&#x6761;&#x4EF6;&#x7684;&#x6570;&#x636E;&#x5E93;&#x91CD;&#x65B0;&#x52A0;&#x8F7D;&#x3002;</span><span class="yiyi-st" id="yiyi-79">&#x5F53;&#x53D1;&#x751F;&#x5237;&#x65B0;&#x65F6;&#xFF0C;&#x65E0;&#x6761;&#x4EF6;&#x5237;&#x65B0;<code class="docutils literal"><span class="pre">boston_addresses</span></code>&#x5185;&#x90E8;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x5C06;&#x4E3B;&#x952E;<code class="docutils literal"><span class="pre">user.id</span></code>&#x5217;&#x7684;&#x503C;&#x5206;&#x914D;&#x5230;&#x5916;&#x952E;&#x6301;&#x6709;&#x7684;<code class="docutils literal"><span class="pre">address.user_id</span></code>&#x5217;&#x3002;</span><span class="yiyi-st" id="yiyi-80"><code class="docutils literal"><span class="pre">city</span></code>&#x6761;&#x4EF6;&#x5728;&#x8FD9;&#x91CC;&#x6CA1;&#x6709;&#x6548;&#x679C;&#xFF0C;&#x56E0;&#x4E3A;flush&#x8FC7;&#x7A0B;&#x53EA;&#x5173;&#x5FC3;&#x5C06;&#x4E3B;&#x952E;&#x503C;&#x540C;&#x6B65;&#x5230;&#x5F15;&#x7528;&#x5916;&#x952E;&#x503C;&#x4E2D;&#x3002;</span></p></div><div class="section" id="creating-custom-foreign-conditions"><h2><span class="yiyi-st" id="yiyi-81">&#x521B;&#x5EFA;&#x81EA;&#x5B9A;&#x4E49;&#x5916;&#x90E8;&#x6761;&#x4EF6;<a class="headerlink" href="#creating-custom-foreign-conditions" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-82">&#x4E3B;&#x8981;&#x8FDE;&#x63A5;&#x6761;&#x4EF6;&#x7684;&#x53E6;&#x4E00;&#x4E2A;&#x8981;&#x7D20;&#x662F;&#x5982;&#x4F55;&#x786E;&#x5B9A;&#x90A3;&#x4E9B;&#x88AB;&#x8BA4;&#x4E3A;&#x662F;&#x201C;&#x5916;&#x6765;&#x201D;&#x7684;&#x5217;&#x3002;</span><span class="yiyi-st" id="yiyi-83">&#x901A;&#x5E38;&#xFF0C;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a>&#x5BF9;&#x8C61;&#x7684;&#x4E00;&#x4E9B;&#x5B50;&#x96C6;&#x5C06;&#x6307;&#x5B9A;<a class="reference internal" href="core_constraints.html#sqlalchemy.schema.ForeignKey" title="sqlalchemy.schema.ForeignKey"><code class="xref py py-class docutils literal"><span class="pre">ForeignKey</span></code></a>&#xFF0C;&#x6216;&#x8005;&#x4EE5;&#x5176;&#x4ED6;&#x65B9;&#x5F0F;&#x6210;&#x4E3A;&#x4E0E;&#x8054;&#x63A5;&#x6761;&#x4EF6;&#x76F8;&#x5173;&#x7684;<a class="reference internal" href="core_constraints.html#sqlalchemy.schema.ForeignKeyConstraint" title="sqlalchemy.schema.ForeignKeyConstraint"><code class="xref py py-class docutils literal"><span class="pre">ForeignKeyConstraint</span></code></a>&#x7684;&#x4E00;&#x90E8;&#x5206;&#x3002;</span><span class="yiyi-st" id="yiyi-84"><a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#x5728;&#x5B83;&#x51B3;&#x5B9A;&#x5E94;&#x8BE5;&#x5982;&#x4F55;&#x52A0;&#x8F7D;&#x548C;&#x4FDD;&#x5B58;&#x8FD9;&#x79CD;&#x5173;&#x7CFB;&#x7684;&#x6570;&#x636E;&#x65F6;&#xFF0C;&#x4F1A;&#x67E5;&#x770B;&#x8FD9;&#x4E2A;&#x5916;&#x952E;&#x72B6;&#x6001;&#x3002;</span><span class="yiyi-st" id="yiyi-85">&#x4F46;&#x662F;&#xFF0C;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.primaryjoin" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">primaryjoin</span></code></a>&#x53C2;&#x6570;&#x53EF;&#x7528;&#x4E8E;&#x521B;&#x5EFA;&#x4E0D;&#x6D89;&#x53CA;&#x4EFB;&#x4F55;&#x201C;&#x6A21;&#x5F0F;&#x201D;&#x7EA7;&#x5916;&#x952E;&#x7684;&#x8FDE;&#x63A5;&#x6761;&#x4EF6;&#x3002;</span><span class="yiyi-st" id="yiyi-86">&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x660E;&#x786E;&#x5730;&#x5C06;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.primaryjoin" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">primaryjoin</span></code></a>&#x4E0E;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.foreign_keys" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">foreign_keys</span></code></a>&#x548C;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.remote_side" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">remote_side</span></code></a>&#x7ED3;&#x5408;&#x8D77;&#x6765;&#xFF0C;&#x4EE5;&#x5EFA;&#x7ACB;&#x8FD9;&#x6837;&#x7684;&#x8FDE;&#x63A5;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-87">&#x4E0B;&#x9762;&#xFF0C;&#x4E00;&#x4E2A;&#x7C7B;<code class="docutils literal"><span class="pre">HostEntry</span></code>&#x8FDE;&#x63A5;&#x5230;&#x5B83;&#x81EA;&#x5DF1;&#xFF0C;&#x5C06;&#x5B57;&#x7B26;&#x4E32;<code class="docutils literal"><span class="pre">content</span></code>&#x5217;&#x7B49;&#x540C;&#x4E8E;<code class="docutils literal"><span class="pre">ip_address</span></code>&#x5217;&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x540D;&#x4E3A;<code class="docutils literal"><span class="pre">INET</span></code></span><span class="yiyi-st" id="yiyi-88">&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4F7F;&#x7528;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.cast" title="sqlalchemy.sql.expression.cast"><code class="xref py py-func docutils literal"><span class="pre">cast()</span></code></a>&#x6765;&#x5C06;&#x8FDE;&#x63A5;&#x7684;&#x4E00;&#x8FB9;&#x8F6C;&#x6362;&#x4E3A;&#x53E6;&#x4E00;&#x8FB9;&#x7684;&#x7C7B;&#x578B;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">cast</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Integer</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">relationship</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.dialects.postgresql</span> <span class="kn">import</span> <span class="n">INET</span>

<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>

<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">HostEntry</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;host_entry&apos;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">ip_address</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">INET</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>

    <span class="c1"># relationship() using explicit foreign_keys, remote_side</span>
    <span class="n">parent_host</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;HostEntry&quot;</span><span class="p">,</span>
                        <span class="n">primaryjoin</span><span class="o">=</span><span class="n">ip_address</span> <span class="o">==</span> <span class="n">cast</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">INET</span><span class="p">),</span>
                        <span class="n">foreign_keys</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                        <span class="n">remote_side</span><span class="o">=</span><span class="n">ip_address</span>
                    <span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-89">&#x4E0A;&#x9762;&#x7684;&#x5173;&#x7CFB;&#x4F1A;&#x4EA7;&#x751F;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;&#xFF0C;&#x5982;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT host_entry.id, host_entry.ip_address, host_entry.content
FROM host_entry JOIN host_entry AS host_entry_1
ON host_entry_1.ip_address = CAST(host_entry.content AS INET)</pre></div></div><p><span class="yiyi-st" id="yiyi-90">An alternative syntax to the above is to use the <a class="reference internal" href="relationship_api.html#sqlalchemy.orm.foreign" title="sqlalchemy.orm.foreign"><code class="xref py py-func docutils literal"><span class="pre">foreign()</span></code></a> and <a class="reference internal" href="relationship_api.html#sqlalchemy.orm.remote" title="sqlalchemy.orm.remote"><code class="xref py py-func docutils literal"><span class="pre">remote()</span></code></a> <a class="reference internal" href="glossary.html#term-annotations"><span class="xref std std-term">annotations</span></a>, inline within the <a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.primaryjoin" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">primaryjoin</span></code></a> expression. </span><span class="yiyi-st" id="yiyi-91">&#x6B64;&#x8BED;&#x6CD5;&#x8868;&#x793A;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#x901A;&#x5E38;&#x81EA;&#x8EAB;&#x5E94;&#x7528;&#x4E8E;&#x7ED9;&#x5B9A;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.foreign_keys" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">foreign_keys</span></code></a>&#x548C;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.remote_side" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">remote_side</span></code></a>&#x53C2;&#x6570;&#x7684;&#x8FDE;&#x63A5;&#x6761;&#x4EF6;&#x7684;&#x6CE8;&#x91CA;&#x3002;</span><span class="yiyi-st" id="yiyi-92">&#x5F53;&#x663E;&#x5F0F;&#x8FDE;&#x63A5;&#x6761;&#x4EF6;&#x5B58;&#x5728;&#x65F6;&#xFF0C;&#x8FD9;&#x4E9B;&#x51FD;&#x6570;&#x53EF;&#x80FD;&#x66F4;&#x7B80;&#x6D01;&#xFF0C;&#x5E76;&#x4E14;&#x8FD8;&#x7528;&#x4E8E;&#x65E0;&#x8BBA;&#x8BE5;&#x5217;&#x662F;&#x591A;&#x6B21;&#x58F0;&#x660E;&#x8FD8;&#x662F;&#x5728;&#x590D;&#x6742;&#x7684;SQL&#x8868;&#x8FBE;&#x5F0F;&#x4E2D;&#xFF0C;&#x90FD;&#x7CBE;&#x786E;&#x5730;&#x6807;&#x8BB0;&#x201C;&#x5916;&#x6765;&#x201D;&#x6216;&#x201C;&#x8FDC;&#x7A0B;&#x201D;&#x5217;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">foreign</span><span class="p">,</span> <span class="n">remote</span>

<span class="k">class</span> <span class="nc">HostEntry</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;host_entry&apos;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">ip_address</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">INET</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>

    <span class="c1"># relationship() using explicit foreign() and remote() annotations</span>
    <span class="c1"># in lieu of separate arguments</span>
    <span class="n">parent_host</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;HostEntry&quot;</span><span class="p">,</span>
                        <span class="n">primaryjoin</span><span class="o">=</span><span class="n">remote</span><span class="p">(</span><span class="n">ip_address</span><span class="p">)</span> <span class="o">==</span> \
                                <span class="n">cast</span><span class="p">(</span><span class="n">foreign</span><span class="p">(</span><span class="n">content</span><span class="p">),</span> <span class="n">INET</span><span class="p">),</span>
                    <span class="p">)</span></pre></div></div></div><div class="section" id="using-custom-operators-in-join-conditions"><h2><span class="yiyi-st" id="yiyi-93">&#x5728;&#x8FDE;&#x63A5;&#x6761;&#x4EF6;<a class="headerlink" href="#using-custom-operators-in-join-conditions" title="Permalink to this headline">&#xB6;</a>&#x4E2D;&#x4F7F;&#x7528;&#x81EA;&#x5B9A;&#x4E49;&#x8FD0;&#x7B97;&#x7B26;</span></h2><p><span class="yiyi-st" id="yiyi-94">Another use case for relationships is the use of custom operators, such as Postgresql&#x2019;s &#x201C;is contained within&#x201D; <code class="docutils literal"><span class="pre">&lt;&lt;</span></code> operator when joining with types such as <a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.INET" title="sqlalchemy.dialects.postgresql.INET"><code class="xref py py-class docutils literal"><span class="pre">postgresql.INET</span></code></a> and <a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.CIDR" title="sqlalchemy.dialects.postgresql.CIDR"><code class="xref py py-class docutils literal"><span class="pre">postgresql.CIDR</span></code></a>. </span><span class="yiyi-st" id="yiyi-95">&#x5BF9;&#x4E8E;&#x81EA;&#x5B9A;&#x4E49;&#x8FD0;&#x7B97;&#x7B26;&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.operators.Operators.op" title="sqlalchemy.sql.operators.Operators.op"><code class="xref py py-meth docutils literal"><span class="pre">Operators.op()</span></code></a>&#x51FD;&#x6570;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">inet_column</span><span class="o">.</span><span class="n">op</span><span class="p">(</span><span class="s2">&quot;&lt;&lt;&quot;</span><span class="p">)(</span><span class="n">cidr_column</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-96">&#x7136;&#x800C;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x8FD0;&#x7B97;&#x7B26;&#x6765;&#x6784;&#x9020;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.primaryjoin" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">primaryjoin</span></code></a>&#xFF0C;&#x90A3;&#x4E48;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#x4ECD;&#x7136;&#x9700;&#x8981;&#x66F4;&#x591A;&#x7684;&#x4FE1;&#x606F;&#x3002;</span><span class="yiyi-st" id="yiyi-97">This is because when it examines our primaryjoin condition, it specifically looks for operators used for <strong>comparisons</strong>, and this is typically a fixed list containing known comparison operators such as <code class="docutils literal"><span class="pre">==</span></code>, <code class="docutils literal"><span class="pre">&lt;</span></code>, etc. </span><span class="yiyi-st" id="yiyi-98">&#x56E0;&#x6B64;&#xFF0C;&#x5BF9;&#x4E8E;&#x6211;&#x4EEC;&#x7684;&#x81EA;&#x5B9A;&#x4E49;&#x64CD;&#x4F5C;&#x5458;&#x53C2;&#x4E0E;&#x6B64;&#x7CFB;&#x7EDF;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4F7F;&#x7528;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.operators.Operators.op.params.is_comparison" title="sqlalchemy.sql.operators.Operators.op"><code class="xref py py-paramref docutils literal"><span class="pre">is_comparison</span></code></a>&#x53C2;&#x6570;&#x5C06;&#x5176;&#x6CE8;&#x518C;&#x4E3A;&#x6BD4;&#x8F83;&#x8FD0;&#x7B97;&#x7B26;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">inet_column</span><span class="o">.</span><span class="n">op</span><span class="p">(</span><span class="s2">&quot;&lt;&lt;&quot;</span><span class="p">,</span> <span class="n">is_comparison</span><span class="o">=</span><span class="bp">True</span><span class="p">)(</span><span class="n">cidr_column</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-99">&#x4E00;&#x4E2A;&#x5B8C;&#x6574;&#x7684;&#x4F8B;&#x5B50;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">IPA</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;ip_address&apos;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">v4address</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">INET</span><span class="p">)</span>

    <span class="n">network</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Network&quot;</span><span class="p">,</span>
                        <span class="n">primaryjoin</span><span class="o">=</span><span class="s2">&quot;IPA.v4address.op(&apos;&lt;&lt;&apos;, is_comparison=True)&quot;</span>
                            <span class="s2">&quot;(foreign(Network.v4representation))&quot;</span><span class="p">,</span>
                        <span class="n">viewonly</span><span class="o">=</span><span class="bp">True</span>
                    <span class="p">)</span>
<span class="k">class</span> <span class="nc">Network</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;network&apos;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">v4representation</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">CIDR</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-100">&#x4EE5;&#x4E0A;&#xFF0C;&#x4E00;&#x4E2A;&#x67E5;&#x8BE2;&#x5982;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">IPA</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">IPA</span><span class="o">.</span><span class="n">network</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-101">&#x5C06;&#x5448;&#x73B0;&#x4E3A;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT ip_address.id AS ip_address_id, ip_address.v4address AS ip_address_v4address
FROM ip_address JOIN network ON ip_address.v4address &lt;&lt; network.v4representation</pre></div></div><div class="versionadded"><p><span class="yiyi-st" id="yiyi-102"><span class="versionmodified">&#x7248;&#x672C;0.9.2&#x4E2D;&#x7684;&#x65B0;&#x529F;&#x80FD;&#xFF1A;</span>  - &#x6DFB;&#x52A0;&#x4E86;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.operators.Operators.op.params.is_comparison" title="sqlalchemy.sql.operators.Operators.op"><code class="xref py py-paramref docutils literal"><span class="pre">Operators.op.is_comparison</span></code></a>&#x6807;&#x5FD7;&#x6765;&#x5E2E;&#x52A9;&#x4F7F;&#x7528;&#x81EA;&#x5B9A;&#x4E49;&#x8FD0;&#x7B97;&#x7B26;&#x521B;&#x5EFA;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#x7ED3;&#x6784;&#x3002;</span></p></div></div><div class="section" id="overlapping-foreign-keys"><h2><span class="yiyi-st" id="yiyi-103">&#x91CD;&#x53E0;&#x5916;&#x952E;<a class="headerlink" href="#overlapping-foreign-keys" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-104">&#x5728;&#x4F7F;&#x7528;&#x7EC4;&#x5408;&#x5916;&#x952E;&#x65F6;&#x4F1A;&#x51FA;&#x73B0;&#x4E00;&#x79CD;&#x7F55;&#x89C1;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x4F8B;&#x5982;&#xFF0C;&#x4E00;&#x5217;&#x53EF;&#x80FD;&#x662F;&#x901A;&#x8FC7;&#x5916;&#x952E;&#x7EA6;&#x675F;&#x5F15;&#x7528;&#x7684;&#x591A;&#x5217;&#x7684;&#x4E3B;&#x9898;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-105">Consider an (admittedly complex) mapping such as the <code class="docutils literal"><span class="pre">Magazine</span></code> object, referred to both by the <code class="docutils literal"><span class="pre">Writer</span></code> object and the <code class="docutils literal"><span class="pre">Article</span></code> object using a composite primary key scheme that includes <code class="docutils literal"><span class="pre">magazine_id</span></code> for both; then to make <code class="docutils literal"><span class="pre">Article</span></code> refer to <code class="docutils literal"><span class="pre">Writer</span></code> as well, <code class="docutils literal"><span class="pre">Article.magazine_id</span></code> is involved in two separate relationships; <code class="docutils literal"><span class="pre">Article.magazine</span></code> and <code class="docutils literal"><span class="pre">Article.writer</span></code>:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Magazine</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;magazine&apos;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Article</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;article&apos;</span>

    <span class="n">article_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">)</span>
    <span class="n">magazine_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;magazine.id&apos;</span><span class="p">))</span>
    <span class="n">writer_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">()</span>

    <span class="n">magazine</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Magazine&quot;</span><span class="p">)</span>
    <span class="n">writer</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Writer&quot;</span><span class="p">)</span>

    <span class="n">__table_args__</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">PrimaryKeyConstraint</span><span class="p">(</span><span class="s1">&apos;article_id&apos;</span><span class="p">,</span> <span class="s1">&apos;magazine_id&apos;</span><span class="p">),</span>
        <span class="n">ForeignKeyConstraint</span><span class="p">(</span>
            <span class="p">[</span><span class="s1">&apos;writer_id&apos;</span><span class="p">,</span> <span class="s1">&apos;magazine_id&apos;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&apos;writer.id&apos;</span><span class="p">,</span> <span class="s1">&apos;writer.magazine_id&apos;</span><span class="p">]</span>
        <span class="p">),</span>
    <span class="p">)</span>


<span class="k">class</span> <span class="nc">Writer</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;writer&apos;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">magazine_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;magazine.id&apos;</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">magazine</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Magazine&quot;</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-106">&#x5F53;&#x4E0A;&#x9762;&#x7684;&#x6620;&#x5C04;&#x914D;&#x7F6E;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x770B;&#x5230;&#x8FD9;&#x4E2A;&#x8B66;&#x544A;&#x53D1;&#x51FA;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SAWarning: relationship &apos;Article.writer&apos; will copy column
writer.magazine_id to column article.magazine_id,
which conflicts with relationship(s): &apos;Article.magazine&apos;
(copies magazine.id to article.magazine_id). Consider applying
viewonly=True to read-only relationships, or provide a primaryjoin
condition marking writable columns with the foreign() annotation.</pre></div></div><p><span class="yiyi-st" id="yiyi-107">What this refers to originates from the fact that <code class="docutils literal"><span class="pre">Article.magazine_id</span></code> is the subject of two different foreign key constraints; it refers to <code class="docutils literal"><span class="pre">Magazine.id</span></code> directly as a source column, but also refers to <code class="docutils literal"><span class="pre">Writer.magazine_id</span></code> as a source column in the context of the composite key to <code class="docutils literal"><span class="pre">Writer</span></code>. </span><span class="yiyi-st" id="yiyi-108">If we associate an <code class="docutils literal"><span class="pre">Article</span></code> with a particular <code class="docutils literal"><span class="pre">Magazine</span></code>, but then associate the <code class="docutils literal"><span class="pre">Article</span></code> with a <code class="docutils literal"><span class="pre">Writer</span></code> that&#x2019;s associated with a <em>different</em> <code class="docutils literal"><span class="pre">Magazine</span></code>, the ORM will overwrite <code class="docutils literal"><span class="pre">Article.magazine_id</span></code> non-deterministically, silently changing which magazine we refer towards; it may also attempt to place NULL into this columnn if we de-associate a <code class="docutils literal"><span class="pre">Writer</span></code> from an <code class="docutils literal"><span class="pre">Article</span></code>. </span><span class="yiyi-st" id="yiyi-109">&#x8B66;&#x544A;&#x8BA9;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#x8FD9;&#x662F;&#x4E8B;&#x5B9E;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-110">&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x6253;&#x7834;<code class="docutils literal"><span class="pre">Article</span></code>&#x7684;&#x884C;&#x4E3A;&#xFF0C;&#x4EE5;&#x5305;&#x542B;&#x4EE5;&#x4E0B;&#x6240;&#x6709;&#x4E09;&#x4E2A;&#x529F;&#x80FD;&#xFF1A;</span></p><ol class="arabic simple"><li><span class="yiyi-st" id="yiyi-111"><code class="docutils literal"><span class="pre">Article</span></code> first and foremost writes to <code class="docutils literal"><span class="pre">Article.magazine_id</span></code> based on data persisted in the <code class="docutils literal"><span class="pre">Article.magazine</span></code> relationship only, that is a value copied from <code class="docutils literal"><span class="pre">Magazine.id</span></code>.</span></li><li><span class="yiyi-st" id="yiyi-112"><code class="docutils literal"><span class="pre">Article</span></code> can write to <code class="docutils literal"><span class="pre">Article.writer_id</span></code> on behalf of data persisted in the <code class="docutils literal"><span class="pre">Article.writer</span></code> relationship, but only the <code class="docutils literal"><span class="pre">Writer.id</span></code> column; the <code class="docutils literal"><span class="pre">Writer.magazine_id</span></code> column should not be written into <code class="docutils literal"><span class="pre">Article.magazine_id</span></code> as it ultimately is sourced from <code class="docutils literal"><span class="pre">Magazine.id</span></code>.</span></li><li><span class="yiyi-st" id="yiyi-113"><code class="docutils literal"><span class="pre">Article</span></code> takes <code class="docutils literal"><span class="pre">Article.magazine_id</span></code> into account when loading <code class="docutils literal"><span class="pre">Article.writer</span></code>, even though it <em>doesn&#x2019;t</em> write to it on behalf of this relationship.</span></li></ol><p><span class="yiyi-st" id="yiyi-114">To get just #1 and #2, we could specify only <code class="docutils literal"><span class="pre">Article.writer_id</span></code> as the &#x201C;foreign keys&#x201D; for <code class="docutils literal"><span class="pre">Article.writer</span></code>:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Article</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="c1"># ...</span>

    <span class="n">writer</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Writer&quot;</span><span class="p">,</span> <span class="n">foreign_keys</span><span class="o">=</span><span class="s1">&apos;Article.writer_id&apos;</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-115">&#x4F46;&#x662F;&#xFF0C;&#x5F53;&#x67E5;&#x8BE2;<code class="docutils literal"><span class="pre">Writer</span></code>&#x65F6;&#xFF0C;&#x8FD9;&#x4F1A;&#x5F71;&#x54CD;<code class="docutils literal"><span class="pre">Article.writer</span></code>&#x4E0D;&#x8003;&#x8651;<code class="docutils literal"><span class="pre">Article.magazine_id</span></code>&#xFF1A;</span></p><div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">article</span><span class="p">.</span><span class="n">article_id</span> <span class="k">AS</span> <span class="n">article_article_id</span><span class="p">,</span>
    <span class="n">article</span><span class="p">.</span><span class="n">magazine_id</span> <span class="k">AS</span> <span class="n">article_magazine_id</span><span class="p">,</span>
    <span class="n">article</span><span class="p">.</span><span class="n">writer_id</span> <span class="k">AS</span> <span class="n">article_writer_id</span>
<span class="k">FROM</span> <span class="n">article</span>
<span class="k">JOIN</span> <span class="n">writer</span> <span class="k">ON</span> <span class="n">writer</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">article</span><span class="p">.</span><span class="n">writer_id</span></pre></div></div><p><span class="yiyi-st" id="yiyi-116">&#x56E0;&#x6B64;&#xFF0C;&#x4E3A;&#x4E86;&#x5145;&#x5206;&#x5229;&#x7528;&#xFF03;1&#xFF0C;&#xFF03;2&#x548C;&#xFF03;3&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x5C06;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.primaryjoin" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">primaryjoin</span></code></a>&#x5B8C;&#x6574;&#x5730;&#x4E0E;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.foreign_keys" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">foreign_keys</span></code></a>&#x53C2;&#x6570;&#xFF0C;&#x6216;&#x8005;&#x901A;&#x8FC7;&#x4F7F;&#x7528;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.foreign" title="sqlalchemy.orm.foreign"><code class="xref py py-func docutils literal"><span class="pre">foreign()</span></code></a>&#x8FDB;&#x884C;&#x6CE8;&#x91CA;&#x66F4;&#x7B80;&#x6D01;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Article</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="c1"># ...</span>

    <span class="n">writer</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span>
        <span class="s2">&quot;Writer&quot;</span><span class="p">,</span>
        <span class="n">primaryjoin</span><span class="o">=</span><span class="s2">&quot;and_(Writer.id == foreign(Article.writer_id), &quot;</span>
                    <span class="s2">&quot;Writer.magazine_id == Article.magazine_id)&quot;</span><span class="p">)</span></pre></div></div><div class="versionchanged"><p><span class="yiyi-st" id="yiyi-117"><span class="versionmodified">&#x7248;&#x672C;1.0.0&#x4E2D;&#x5DF2;&#x66F4;&#x6539;&#xFF1A;</span> ORM&#x5C06;&#x5C1D;&#x8BD5;&#x8B66;&#x544A;&#x4F55;&#x65F6;&#x5C06;&#x5217;&#x540C;&#x65F6;&#x7528;&#x4F5C;&#x6765;&#x81EA;&#x591A;&#x4E2A;&#x5173;&#x7CFB;&#x7684;&#x540C;&#x6B65;&#x76EE;&#x6807;&#x3002;</span></p></div></div><div class="section" id="non-relational-comparisons-materialized-path"><h2><span class="yiyi-st" id="yiyi-118">&#x975E;&#x5173;&#x7CFB;&#x6BD4;&#x8F83;/&#x7269;&#x5316;&#x8DEF;&#x5F84;<a class="headerlink" href="#non-relational-comparisons-materialized-path" title="Permalink to this headline">&#xB6;</a></span></h2><div class="admonition warning"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-119">&#x8B66;&#x544A;</span></p><p class="last"><span class="yiyi-st" id="yiyi-120">&#x672C;&#x8282;&#x8BE6;&#x7EC6;&#x4ECB;&#x7ECD;&#x4E86;&#x4E00;&#x4E2A;&#x5B9E;&#x9A8C;&#x529F;&#x80FD;&#x3002;</span></p></div><p><span class="yiyi-st" id="yiyi-121">&#x4F7F;&#x7528;&#x81EA;&#x5B9A;&#x4E49;&#x8868;&#x8FBE;&#x5F0F;&#x610F;&#x5473;&#x7740;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4EA7;&#x751F;&#x4E0D;&#x7B26;&#x5408;&#x5E38;&#x89C4;&#x4E3B;/&#x5916;&#x5173;&#x952E;&#x6A21;&#x578B;&#x7684;&#x975E;&#x6B63;&#x7EDF;&#x8FDE;&#x63A5;&#x6761;&#x4EF6;&#x3002;</span><span class="yiyi-st" id="yiyi-122">&#x4E00;&#x4E2A;&#x8FD9;&#x6837;&#x7684;&#x4F8B;&#x5B50;&#x662F;&#x7269;&#x5316;&#x8DEF;&#x5F84;&#x6A21;&#x5F0F;&#xFF0C;&#x5728;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x6BD4;&#x8F83;&#x91CD;&#x53E0;&#x8DEF;&#x5F84;&#x4EE4;&#x724C;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x4EE5;&#x4EA7;&#x751F;&#x6811;&#x7ED3;&#x6784;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-123">&#x901A;&#x8FC7;&#x4ED4;&#x7EC6;&#x4F7F;&#x7528;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.foreign" title="sqlalchemy.orm.foreign"><code class="xref py py-func docutils literal"><span class="pre">foreign()</span></code></a>&#x548C;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.remote" title="sqlalchemy.orm.remote"><code class="xref py py-func docutils literal"><span class="pre">remote()</span></code></a>&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5EFA;&#x7ACB;&#x4E00;&#x79CD;&#x6709;&#x6548;&#x751F;&#x6210;&#x57FA;&#x672C;&#x7269;&#x5316;&#x8DEF;&#x5F84;&#x7CFB;&#x7EDF;&#x7684;&#x5173;&#x7CFB;&#x3002;</span><span class="yiyi-st" id="yiyi-124">&#x57FA;&#x672C;&#x4E0A;&#xFF0C;&#x5F53;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.foreign" title="sqlalchemy.orm.foreign"><code class="xref py py-func docutils literal"><span class="pre">foreign()</span></code></a>&#x548C;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.remote" title="sqlalchemy.orm.remote"><code class="xref py py-func docutils literal"><span class="pre">remote()</span></code></a>&#x4F4D;&#x4E8E;&#x6BD4;&#x8F83;&#x8868;&#x8FBE;&#x5F0F;&#x7684;<em>&#x76F8;&#x540C;</em>&#x4E00;&#x4FA7;&#x65F6;&#xFF0C;&#x8BE5;&#x5173;&#x7CFB;&#x88AB;&#x8BA4;&#x4E3A;&#x662F;&#x201C;one to&#x8BB8;&#x591A;&#x201D;&#xFF1B;&#x5F53;&#x4ED6;&#x4EEC;&#x5728;<em>&#x4E0D;&#x540C;</em>&#x65B9;&#x9762;&#x65F6;&#xFF0C;&#x8FD9;&#x79CD;&#x5173;&#x7CFB;&#x88AB;&#x8BA4;&#x4E3A;&#x662F;&#x201C;&#x591A;&#x5BF9;&#x4E00;&#x201D;&#x3002;</span><span class="yiyi-st" id="yiyi-125">&#x4E3A;&#x4E86;&#x6BD4;&#x8F83;&#x6211;&#x4EEC;&#x5C06;&#x5728;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x5904;&#x7406;&#x96C6;&#x5408;&#xFF0C;&#x4EE5;&#x4FBF;&#x5C06;&#x4E8B;&#x7269;&#x914D;&#x7F6E;&#x4E3A;&#x201C;&#x4E00;&#x5BF9;&#x591A;&#x201D;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Element</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;element&apos;</span>

    <span class="n">path</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">descendants</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&apos;Element&apos;</span><span class="p">,</span>
                           <span class="n">primaryjoin</span><span class="o">=</span>
                                <span class="n">remote</span><span class="p">(</span><span class="n">foreign</span><span class="p">(</span><span class="n">path</span><span class="p">))</span><span class="o">.</span><span class="n">like</span><span class="p">(</span>
                                        <span class="n">path</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="s1">&apos;/%&apos;</span><span class="p">)),</span>
                           <span class="n">viewonly</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                           <span class="n">order_by</span><span class="o">=</span><span class="n">path</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-126">&#x4E0A;&#x9762;&#xFF0C;&#x5982;&#x679C;&#x7ED9;&#x5B9A;&#x4E00;&#x4E2A;<code class="docutils literal"><span class="pre">Element</span></code>&#x5BF9;&#x8C61;&#xFF0C;&#x5176;&#x8DEF;&#x5F84;&#x5C5E;&#x6027;&#x4E3A;<code class="docutils literal"><span class="pre">&quot;/foo/bar2&quot;</span></code>&#xFF0C;&#x6211;&#x4EEC;&#x5BFB;&#x627E;&#x4E00;&#x4E2A;<code class="docutils literal"><span class="pre">Element.descendants</span></code>&#x770B;&#x8D77;&#x6765;&#x50CF;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT element.path AS element_path
FROM element
WHERE element.path LIKE (&apos;/foo/bar2&apos; || &apos;/%&apos;) ORDER BY element.path</pre></div></div><div class="versionadded"><p><span class="yiyi-st" id="yiyi-127"><span class="versionmodified">&#x7248;&#x672C;0.9.5&#x4E2D;&#x7684;&#x65B0;&#x589E;&#x529F;&#x80FD;&#xFF1A;</span>&#x5DF2;&#x6DFB;&#x52A0;&#x652F;&#x6301;&#x4EE5;&#x5141;&#x8BB8;&#x5728;primaryjoin&#x6761;&#x4EF6;&#x4EE5;&#x53CA;&#x4F7F;&#x7528;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.operators.ColumnOperators.like" title="sqlalchemy.sql.operators.ColumnOperators.like"><code class="xref py py-meth docutils literal"><span class="pre">ColumnOperators.like()</span></code></a></span></p></div></div><div class="section" id="self-referential-many-to-many-relationship"><h2><span class="yiyi-st" id="yiyi-128">&#x81EA;&#x6211;&#x53C2;&#x7167;&#x591A;&#x5BF9;&#x591A;&#x5173;&#x7CFB;<a class="headerlink" href="#self-referential-many-to-many-relationship" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-129">&#x591A;&#x5BF9;&#x591A;&#x5173;&#x7CFB;&#x53EF;&#x4EE5;&#x7531;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.primaryjoin" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">primaryjoin</span></code></a>&#x548C;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.secondaryjoin" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">secondaryjoin</span></code></a>&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x6216;&#x4E24;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49; - &#x540E;&#x8005;&#x5BF9;&#x4E8E;&#x6307;&#x5B9A;&#x4F7F;&#x7528;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.secondary" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">secondary</span></code></a>&#x53C2;&#x6570;&#x3002;</span><span class="yiyi-st" id="yiyi-130">&#x6D89;&#x53CA;&#x4F7F;&#x7528;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.primaryjoin" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">primaryjoin</span></code></a>&#x548C;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.secondaryjoin" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">secondaryjoin</span></code></a>&#x7684;&#x5E38;&#x89C1;&#x60C5;&#x51B5;&#x662F;&#x5728;&#x5EFA;&#x7ACB;&#x4ECE;&#x7C7B;&#x5230;&#x81EA;&#x8EAB;&#x7684;&#x591A;&#x5BF9;&#x591A;&#x5173;&#x7CFB;&#x65F6;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Table</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">relationship</span>

<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>

<span class="n">node_to_node</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s2">&quot;node_to_node&quot;</span><span class="p">,</span> <span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;left_node_id&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;node.id&quot;</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;right_node_id&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;node.id&quot;</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="p">)</span>

<span class="k">class</span> <span class="nc">Node</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;node&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>
    <span class="n">right_nodes</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Node&quot;</span><span class="p">,</span>
                        <span class="n">secondary</span><span class="o">=</span><span class="n">node_to_node</span><span class="p">,</span>
                        <span class="n">primaryjoin</span><span class="o">=</span><span class="nb">id</span><span class="o">==</span><span class="n">node_to_node</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">left_node_id</span><span class="p">,</span>
                        <span class="n">secondaryjoin</span><span class="o">=</span><span class="nb">id</span><span class="o">==</span><span class="n">node_to_node</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">right_node_id</span><span class="p">,</span>
                        <span class="n">backref</span><span class="o">=</span><span class="s2">&quot;left_nodes&quot;</span>
    <span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-131">&#x5982;&#x4E0A;&#x6240;&#x8FF0;&#xFF0C;SQLAlchemy&#x65E0;&#x6CD5;&#x81EA;&#x52A8;&#x77E5;&#x9053;&#x54EA;&#x4E9B;&#x5217;&#x5E94;&#x8BE5;&#x8FDE;&#x63A5;&#x5230;<code class="docutils literal"><span class="pre">right_nodes</span></code>&#x548C;<code class="docutils literal"><span class="pre">left_nodes</span></code>&#x5173;&#x7CFB;&#x7684;&#x54EA;&#x4E9B;&#x5217;&#x3002;</span><span class="yiyi-st" id="yiyi-132"><a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.primaryjoin" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">primaryjoin</span></code></a>&#x548C;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.secondaryjoin" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">secondaryjoin</span></code></a>&#x53C2;&#x6570;&#x786E;&#x5B9A;&#x4E86;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x5982;&#x4F55;&#x52A0;&#x5165;&#x5173;&#x8054;&#x8868;&#x3002;</span><span class="yiyi-st" id="yiyi-133">&#x5728;&#x4E0A;&#x9762;&#x7684;&#x58F0;&#x660E;&#x5F0F;&#x8868;&#x683C;&#x4E2D;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x5728;&#x4E0E;<code class="docutils literal"><span class="pre">Node</span></code>&#x7C7B;&#x76F8;&#x5BF9;&#x5E94;&#x7684;Python&#x5757;&#x4E2D;&#x58F0;&#x660E;&#x8FD9;&#x4E9B;&#x6761;&#x4EF6;&#x65F6;&#xFF0C;<code class="docutils literal"><span class="pre">id</span></code>&#x53D8;&#x91CF;&#x53EF;&#x76F4;&#x63A5;&#x4F5C;&#x4E3A;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a></span></p><p><span class="yiyi-st" id="yiyi-134">Alternatively, we can define the <a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.primaryjoin" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">primaryjoin</span></code></a> and <a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.secondaryjoin" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">secondaryjoin</span></code></a> arguments using strings, which is suitable in the case that our configuration does not have either the <code class="docutils literal"><span class="pre">Node.id</span></code> column object available yet or the <code class="docutils literal"><span class="pre">node_to_node</span></code> table perhaps isn&#x2019;t yet available. </span><span class="yiyi-st" id="yiyi-135">&#x5F53;&#x5728;&#x4E00;&#x4E2A;&#x58F0;&#x660E;&#x6027;&#x5B57;&#x7B26;&#x4E32;&#x4E2D;&#x5F15;&#x7528;&#x4E00;&#x4E2A;&#x666E;&#x901A;&#x7684;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal"><span class="pre">Table</span></code></a>&#x5BF9;&#x8C61;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x8BE5;&#x8868;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x540D;&#x79F0;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x5B58;&#x5728;&#x4E8E;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.MetaData" title="sqlalchemy.schema.MetaData"><code class="xref py py-class docutils literal"><span class="pre">MetaData</span></code></a>&#x4E2D;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Node</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;node&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>
    <span class="n">right_nodes</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Node&quot;</span><span class="p">,</span>
                        <span class="n">secondary</span><span class="o">=</span><span class="s2">&quot;node_to_node&quot;</span><span class="p">,</span>
                        <span class="n">primaryjoin</span><span class="o">=</span><span class="s2">&quot;Node.id==node_to_node.c.left_node_id&quot;</span><span class="p">,</span>
                        <span class="n">secondaryjoin</span><span class="o">=</span><span class="s2">&quot;Node.id==node_to_node.c.right_node_id&quot;</span><span class="p">,</span>
                        <span class="n">backref</span><span class="o">=</span><span class="s2">&quot;left_nodes&quot;</span>
    <span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-136">&#x8FD9;&#x91CC;&#x7684;&#x7ECF;&#x5178;&#x6620;&#x5C04;&#x60C5;&#x51B5;&#x662F;&#x7C7B;&#x4F3C;&#x7684;&#xFF0C;&#x5176;&#x4E2D;<code class="docutils literal"><span class="pre">node_to_node</span></code>&#x53EF;&#x4EE5;&#x8FDE;&#x63A5;&#x5230;<code class="docutils literal"><span class="pre">node.c.id</span></code>&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Table</span><span class="p">,</span> <span class="n">MetaData</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">relationship</span><span class="p">,</span> <span class="n">mapper</span>

<span class="n">metadata</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">()</span>

<span class="n">node_to_node</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s2">&quot;node_to_node&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;left_node_id&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;node.id&quot;</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;right_node_id&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;node.id&quot;</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">node</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s2">&quot;node&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;id&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;label&apos;</span><span class="p">,</span> <span class="n">String</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">class</span> <span class="nc">Node</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="n">mapper</span><span class="p">(</span><span class="n">Node</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="p">{</span>
    <span class="s1">&apos;right_nodes&apos;</span><span class="p">:</span><span class="n">relationship</span><span class="p">(</span><span class="n">Node</span><span class="p">,</span>
                        <span class="n">secondary</span><span class="o">=</span><span class="n">node_to_node</span><span class="p">,</span>
                        <span class="n">primaryjoin</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="n">node_to_node</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">left_node_id</span><span class="p">,</span>
                        <span class="n">secondaryjoin</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="n">node_to_node</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">right_node_id</span><span class="p">,</span>
                        <span class="n">backref</span><span class="o">=</span><span class="s2">&quot;left_nodes&quot;</span>
                    <span class="p">)})</span></pre></div></div><p><span class="yiyi-st" id="yiyi-137">&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x5728;&#x8FD9;&#x4E24;&#x4E2A;&#x793A;&#x4F8B;&#x4E2D;&#xFF0C;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.backref" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">backref</span></code></a>&#x5173;&#x952E;&#x5B57;&#x6307;&#x5B9A;&#x4E00;&#x4E2A;<code class="docutils literal"><span class="pre">left_nodes</span></code> backref  - &#x5F53;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#x521B;&#x5EFA;&#x53CD;&#x65B9;&#x5411;&#x7684;&#x7B2C;&#x4E8C;&#x4E2A;&#x5173;&#x7CFB;&#x65F6;&#xFF0C;&#x8DB3;&#x4EE5;&#x53CD;&#x8F6C;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.primaryjoin" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">primaryjoin</span></code></a>&#x548C;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.secondaryjoin" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">secondaryjoin</span></code></a>&#x53C2;&#x6570;&#x3002;</span></p></div><div class="section" id="composite-secondary-joins"><h2><span class="yiyi-st" id="yiyi-138">&#x590D;&#x5408;&#x201C;&#x6B21;&#x8981;&#x201D;&#x52A0;&#x5165;<a class="headerlink" href="#composite-secondary-joins" title="Permalink to this headline">&#xB6;</a></span></h2><div class="admonition note"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-139">&#x6CE8;&#x610F;</span></p><p class="last"><span class="yiyi-st" id="yiyi-140">&#x672C;&#x8282;&#x4ECB;&#x7ECD;SQLAlchemy&#x7684;&#x4E00;&#x4E9B;&#x65B0;&#x589E;&#x529F;&#x80FD;&#x548C;&#x5B9E;&#x9A8C;&#x529F;&#x80FD;&#x3002;</span></p></div><p><span class="yiyi-st" id="yiyi-141">&#x6709;&#x65F6;&#xFF0C;&#x5F53;&#x4EBA;&#x4EEC;&#x8BD5;&#x56FE;&#x5728;&#x4E24;&#x4E2A;&#x8868;&#x4E4B;&#x95F4;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#x65F6;&#xFF0C;&#x4E3A;&#x4E86;&#x52A0;&#x5165;&#x5B83;&#x4EEC;&#xFF0C;&#x9700;&#x8981;&#x591A;&#x4E8E;&#x4E24;&#x4E2A;&#x6216;&#x4E09;&#x4E2A;&#x8868;&#x53C2;&#x4E0E;&#x3002;</span><span class="yiyi-st" id="yiyi-142">&#x8FD9;&#x662F;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#x7684;&#x4E00;&#x4E2A;&#x533A;&#x57DF;&#xFF0C;&#x5B83;&#x8BD5;&#x56FE;&#x63A8;&#x52A8;&#x53EF;&#x80FD;&#x7684;&#x8FB9;&#x754C;&#xFF0C;&#x5E76;&#x4E14;&#x901A;&#x5E38;&#x9700;&#x8981;&#x5728;SQLAlchemy&#x90AE;&#x4EF6;&#x5217;&#x8868;&#x4E0A;&#x6572;&#x5B9A;&#x8FD9;&#x4E9B;&#x7279;&#x6B8A;&#x7528;&#x4F8B;&#x7684;&#x6700;&#x7EC8;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-143">&#x5728;&#x66F4;&#x65B0;&#x7248;&#x672C;&#x7684;SQLAlchemy&#x4E2D;&#xFF0C;&#x4E3A;&#x4E86;&#x63D0;&#x4F9B;&#x7531;&#x591A;&#x4E2A;&#x8868;&#x7EC4;&#x6210;&#x7684;&#x590D;&#x5408;&#x76EE;&#x6807;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x4E00;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#x4F7F;&#x7528;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.secondary" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">secondary</span></code></a>&#x53C2;&#x6570;&#x3002;</span><span class="yiyi-st" id="yiyi-144">&#x4EE5;&#x4E0B;&#x662F;&#x8FD9;&#x79CD;&#x8FDE;&#x63A5;&#x6761;&#x4EF6;&#x7684;&#x793A;&#x4F8B;&#xFF08;&#x8981;&#x6C42;&#x7248;&#x672C;0.9.2&#x81F3;&#x5C11;&#x6309;&#x7167;&#x539F;&#x6837;&#x8FD0;&#x884C;&#xFF09;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;a&apos;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">b_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;b.id&apos;</span><span class="p">))</span>

    <span class="n">d</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;D&quot;</span><span class="p">,</span>
                <span class="n">secondary</span><span class="o">=</span><span class="s2">&quot;join(B, D, B.d_id == D.id).&quot;</span>
                            <span class="s2">&quot;join(C, C.d_id == D.id)&quot;</span><span class="p">,</span>
                <span class="n">primaryjoin</span><span class="o">=</span><span class="s2">&quot;and_(A.b_id == B.id, A.id == C.a_id)&quot;</span><span class="p">,</span>
                <span class="n">secondaryjoin</span><span class="o">=</span><span class="s2">&quot;D.id == B.d_id&quot;</span><span class="p">,</span>
                <span class="n">uselist</span><span class="o">=</span><span class="bp">False</span>
                <span class="p">)</span>

<span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;b&apos;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">d_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;d.id&apos;</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;c&apos;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">a_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;a.id&apos;</span><span class="p">))</span>
    <span class="n">d_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;d.id&apos;</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">D</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;d&apos;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-145">In the above example, we provide all three of <a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.secondary" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">secondary</span></code></a>, <a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.primaryjoin" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">primaryjoin</span></code></a>, and <a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.secondaryjoin" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">secondaryjoin</span></code></a>, in the declarative style referring to the named tables <code class="docutils literal"><span class="pre">a</span></code>, <code class="docutils literal"><span class="pre">b</span></code>, <code class="docutils literal"><span class="pre">c</span></code>, <code class="docutils literal"><span class="pre">d</span></code> directly. </span><span class="yiyi-st" id="yiyi-146">&#x4ECE;<code class="docutils literal"><span class="pre">A</span></code>&#x5230;<code class="docutils literal"><span class="pre">D</span></code>&#x7684;&#x67E5;&#x8BE2;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</span></p><div class="highlight-python+sql"><div class="highlight"><pre><span></span><span class="n">sess</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">d</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

<div class="show_sql">SELECT a.id AS a_id, a.b_id AS a_b_id
FROM a JOIN (
    b AS b_1 JOIN d AS d_1 ON b_1.d_id = d_1.id
        JOIN c AS c_1 ON c_1.d_id = d_1.id)
    ON a.b_id = b_1.id AND a.id = c_1.a_id JOIN d ON d.id = b_1.d_id</div></pre></div></div><p><span class="yiyi-st" id="yiyi-147">&#x5728;&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5229;&#x7528;&#x80FD;&#x591F;&#x5C06;&#x591A;&#x4E2A;&#x8868;&#x586B;&#x5145;&#x5230;&#x201C;&#x8F85;&#x52A9;&#x201D;&#x5BB9;&#x5668;&#x4E2D;&#xFF0C;&#x4EE5;&#x4FBF;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8DE8;&#x591A;&#x4E2A;&#x8868;&#x52A0;&#x5165;&#xFF0C;&#x540C;&#x65F6;&#x4ECD;&#x7136;&#x4FDD;&#x6301;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#x7684;&#x201C;&#x7B80;&#x5355;&#x201D;&#x5728;&#x201C;&#x5DE6;&#x201D;&#x548C;&#x201C;&#x53F3;&#x201D;&#x65B9;&#x9762;&#x90FD;&#x6709;&#x201C;&#x4E00;&#x5F20;&#x201D;&#x8868;&#xFF1B;&#x590D;&#x6742;&#x6027;&#x4FDD;&#x6301;&#x5728;&#x4E2D;&#x95F4;&#x3002;</span></p><div class="versionadded"><p><span class="yiyi-st" id="yiyi-148"><span class="versionmodified">&#x7248;&#x672C;0.9.2&#x4E2D;&#x7684;&#x65B0;&#x529F;&#x80FD;&#xFF1A;</span>&#x652F;&#x6301;&#x5C06;<a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.join" title="sqlalchemy.sql.expression.join"><code class="xref py py-func docutils literal"><span class="pre">join()</span></code></a>&#x7ED3;&#x6784;&#x76F4;&#x63A5;&#x7528;&#x4F5C;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.secondary" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">secondary</span></code></a>&#x53C2;&#x6570;&#x7684;&#x76EE;&#x6807;&#xFF0C;&#x5305;&#x62EC;&#x5BF9;&#x8FDE;&#x63A5;&#xFF0C;&#x6025;&#x5207;&#x8FDE;&#x63A5;&#x548C;&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x7684;&#x652F;&#x6301;&#xFF0C;&#x4EE5;&#x53CA;&#x5728;&#x58F0;&#x660E;&#x5F0F;&#x4E2D;&#x652F;&#x6301;&#x6307;&#x5B9A;&#x590D;&#x6742;&#x6761;&#x4EF6;&#xFF08;&#x5982;&#x5305;&#x542B;&#x7C7B;&#x540D;&#x79F0;&#x4F5C;&#x4E3A;&#x76EE;&#x6807;&#x7684;&#x8FDE;&#x63A5;&#xFF09;&#x7684;&#x652F;&#x6301;&#x3002;</span></p></div></div><div class="section" id="relationship-to-non-primary-mapper"><h2><span class="yiyi-st" id="yiyi-149">&#x4E0E;&#x975E;&#x4E3B;&#x6620;&#x5C04;&#x5668;&#x7684;&#x5173;&#x7CFB;<a class="headerlink" href="#relationship-to-non-primary-mapper" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-150">&#x5728;&#x4E0A;&#x4E00;&#x8282;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x4E3E;&#x4F8B;&#x8BF4;&#x660E;&#x4E86;&#x4E00;&#x79CD;&#x6280;&#x672F;&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.secondary" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">secondary</span></code></a>&#x4E3A;&#x4E86;&#x5728;&#x8FDE;&#x63A5;&#x6761;&#x4EF6;&#x4E2D;&#x653E;&#x7F6E;&#x5176;&#x4ED6;&#x8868;&#x3002;</span><span class="yiyi-st" id="yiyi-151">&#x6709;&#x4E00;&#x4E2A;&#x590D;&#x6742;&#x7684;&#x8FDE;&#x63A5;&#x6848;&#x4F8B;&#xFF0C;&#x5373;&#x4F7F;&#x8FD9;&#x79CD;&#x6280;&#x672F;&#x662F;&#x4E0D;&#x591F;&#x7684;&#xFF1B;&#x5F53;&#x6211;&#x4EEC;&#x8BD5;&#x56FE;&#x4ECE;<code class="docutils literal"><span class="pre">A</span></code>&#x52A0;&#x5165;<code class="docutils literal"><span class="pre">B</span></code>&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4EFB;&#x4F55;&#x6570;&#x91CF;&#x7684;<code class="docutils literal"><span class="pre">C</span></code>&#xFF0C;<code class="docutils literal"><span class="pre">D</span></code>&#x7B49;&#x3002;</span><span class="yiyi-st" id="yiyi-152">&#x5728;&#x8FD9;&#x4E4B;&#x95F4;&#xFF0C;&#x4F46;&#x662F;&#x4E5F;&#x6709;<code class="docutils literal"><span class="pre">A</span></code>&#x548C;<code class="docutils literal"><span class="pre">B</span></code> <em>&#x76F4;&#x63A5;</em>&#x4E4B;&#x95F4;&#x7684;&#x8FDE;&#x63A5;&#x6761;&#x4EF6;&#x3002;</span><span class="yiyi-st" id="yiyi-153">In this case, the join from <code class="docutils literal"><span class="pre">A</span></code> to <code class="docutils literal"><span class="pre">B</span></code> may be difficult to express with just a complex <a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.primaryjoin" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">primaryjoin</span></code></a> condition, as the intermediary tables may need special handling, and it is also not expressable with a <a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.secondary" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">secondary</span></code></a> object, since the <code class="docutils literal"><span class="pre">A-&gt;secondary-&gt;B</span></code> pattern does not support any references between <code class="docutils literal"><span class="pre">A</span></code> and <code class="docutils literal"><span class="pre">B</span></code> directly. </span><span class="yiyi-st" id="yiyi-154">&#x5F53;&#x8FD9;&#x4E2A;<strong>&#x975E;&#x5E38;&#x9AD8;&#x7EA7;&#x7684;</strong>&#x60C5;&#x51B5;&#x51FA;&#x73B0;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6C42;&#x52A9;&#x4E8E;&#x521B;&#x5EFA;&#x7B2C;&#x4E8C;&#x4E2A;&#x6620;&#x5C04;&#x4F5C;&#x4E3A;&#x5173;&#x7CFB;&#x7684;&#x76EE;&#x6807;&#x3002;</span><span class="yiyi-st" id="yiyi-155">&#x8FD9;&#x662F;&#x6211;&#x4EEC;&#x4F7F;&#x7528;<a class="reference internal" href="mapping_api.html#sqlalchemy.orm.mapper" title="sqlalchemy.orm.mapper"><code class="xref py py-func docutils literal"><span class="pre">mapper()</span></code></a>&#x7684;&#x6620;&#x5C04;&#xFF0C;&#x4EE5;&#x4FBF;&#x6620;&#x5C04;&#x5230;&#x5305;&#x542B;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x7684;&#x6240;&#x6709;&#x9644;&#x52A0;&#x8868;&#x7684;&#x7C7B;&#x3002;</span><span class="yiyi-st" id="yiyi-156">&#x4E3A;&#x4E86;&#x751F;&#x6210;&#x8FD9;&#x4E2A;&#x6620;&#x5C04;&#x5668;&#x4F5C;&#x4E3A;&#x6211;&#x4EEC;&#x7C7B;&#x7684;&#x201C;&#x66FF;&#x4EE3;&#x201D;&#x6620;&#x5C04;&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;<a class="reference internal" href="internals.html#sqlalchemy.orm.state.InstanceState.mapper.params.non_primary" title="sqlalchemy.orm.state.InstanceState.mapper"><code class="xref py py-paramref docutils literal"><span class="pre">non_primary</span></code></a>&#x6807;&#x5FD7;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-157">&#x4E0B;&#x9762;&#x901A;&#x8FC7;&#x4ECE;<code class="docutils literal"><span class="pre">A</span></code>&#x5230;<code class="docutils literal"><span class="pre">B</span></code>&#x7684;&#x7B80;&#x5355;&#x8FDE;&#x63A5;&#x793A;&#x51FA;&#x4E86;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#xFF0C;&#x4F46;&#x662F;&#x4E3B;&#x8FDE;&#x63A5;&#x6761;&#x4EF6;&#x589E;&#x52A0;&#x4E86;&#x4E24;&#x4E2A;&#x9644;&#x52A0;&#x5B9E;&#x4F53;<code class="docutils literal"><span class="pre">C</span></code>&#x548C;<code class="docutils literal"><span class="pre">D</span></code>&#xFF0C;&#x5B83;&#x4EEC;&#x4E5F;&#x5FC5;&#x987B;&#x5177;&#x6709;&#x4E0E;<code class="docutils literal"><span class="pre">A</span></code>&#x548C;<code class="docutils literal"><span class="pre">B</span></code>&#x4E2D;&#x7684;&#x884C;&#x540C;&#x65F6;&#x6392;&#x5217;&#x7684;&#x884C;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;a&apos;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">b_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;b.id&apos;</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;b&apos;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;c&apos;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">a_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;a.id&apos;</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">D</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;d&apos;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">c_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;c.id&apos;</span><span class="p">))</span>
    <span class="n">b_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;b.id&apos;</span><span class="p">))</span>

<span class="c1"># 1. set up the join() as a variable, so we can refer</span>
<span class="c1"># to it in the mapping multiple times.</span>
<span class="n">j</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">D</span><span class="o">.</span><span class="n">b_id</span> <span class="o">==</span> <span class="n">B</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">D</span><span class="o">.</span><span class="n">c_id</span><span class="p">)</span>

<span class="c1"># 2. Create a new mapper() to B, with non_primary=True.</span>
<span class="c1"># Columns in the join with the same name must be</span>
<span class="c1"># disambiguated within the mapping, using named properties.</span>
<span class="n">B_viacd</span> <span class="o">=</span> <span class="n">mapper</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">non_primary</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="p">{</span>
    <span class="s2">&quot;b_id&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">j</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">b_id</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">d_b_id</span><span class="p">],</span>
    <span class="s2">&quot;d_id&quot;</span><span class="p">:</span> <span class="n">j</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">d_id</span>
    <span class="p">})</span>

<span class="n">A</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="n">B_viacd</span><span class="p">,</span> <span class="n">primaryjoin</span><span class="o">=</span><span class="n">A</span><span class="o">.</span><span class="n">b_id</span> <span class="o">==</span> <span class="n">B_viacd</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">b_id</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-158">&#x5728;&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x67E5;&#x8BE2;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x7684;<code class="docutils literal"><span class="pre">B</span></code>&#x7684;&#x975E;&#x4E3B;&#x6620;&#x5C04;&#x5668;&#x4F1A;&#x53D1;&#x51FA;&#x989D;&#x5916;&#x7684;&#x5217;&#xFF1B;&#x8FD9;&#x4E9B;&#x53EF;&#x4EE5;&#x88AB;&#x5FFD;&#x7565;&#xFF1A;</span></p><div class="highlight-python+sql"><div class="highlight"><pre><span></span><span class="n">sess</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

<div class="show_sql">SELECT a.id AS a_id, a.b_id AS a_b_id
FROM a JOIN (b JOIN d ON d.b_id = b.id JOIN c ON c.id = d.c_id) ON a.b_id = b.id</div></pre></div></div></div><div class="section" id="building-query-enabled-properties"><h2><span class="yiyi-st" id="yiyi-159">&#x6784;&#x5EFA;&#x542F;&#x7528;&#x67E5;&#x8BE2;&#x7684;&#x5C5E;&#x6027;<a class="headerlink" href="#building-query-enabled-properties" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-160">&#x975E;&#x5E38;&#x96C4;&#x5FC3;&#x52C3;&#x52C3;&#x7684;&#x81EA;&#x5B9A;&#x4E49;&#x8FDE;&#x63A5;&#x6761;&#x4EF6;&#x53EF;&#x80FD;&#x65E0;&#x6CD5;&#x76F4;&#x63A5;&#x6301;&#x4E45;&#x5316;&#xFF0C;&#x5E76;&#x4E14;&#x5728;&#x67D0;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#x751A;&#x81F3;&#x53EF;&#x80FD;&#x65E0;&#x6CD5;&#x6B63;&#x786E;&#x52A0;&#x8F7D;&#x3002;</span><span class="yiyi-st" id="yiyi-161">&#x8981;&#x79FB;&#x9664;&#x7B49;&#x5F0F;&#x7684;&#x6301;&#x4E45;&#x6027;&#x90E8;&#x5206;&#xFF0C;&#x8BF7;&#x5728;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#x4E0A;&#x4F7F;&#x7528;&#x6807;&#x8BB0;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.viewonly" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">viewonly</span></code></a>&#xFF0C;&#x5C06;&#x5176;&#x5EFA;&#x7ACB;&#x4E3A;&#x53EA;&#x8BFB;&#x5C5E;&#x6027;&#xFF08;&#x5199;&#x5165;&#x96C6;&#x5408;&#x7684;&#x6570;&#x636E;&#x5C06;&#x4E3A;&#x5728;flush()&#x4E0A;&#x88AB;&#x5FFD;&#x7565;&#xFF09;&#x3002;</span><span class="yiyi-st" id="yiyi-162">&#x4F46;&#x662F;&#xFF0C;&#x5728;&#x6781;&#x7AEF;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8BF7;&#x8003;&#x8651;&#x5C06;&#x5E38;&#x89C4;Python&#x5C5E;&#x6027;&#x4E0E;<a class="reference internal" href="query.html#sqlalchemy.orm.query.Query" title="sqlalchemy.orm.query.Query"><code class="xref py py-class docutils literal"><span class="pre">Query</span></code></a>&#x7ED3;&#x5408;&#x4F7F;&#x7528;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</span></p><div class="highlight-python+sql"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;user&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_addresses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">object_session</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Address</span><span class="p">)</span><span class="o">.</span><span class="n">with_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="o">...</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">addresses</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_addresses</span><span class="p">)</span></pre></div></div></div>