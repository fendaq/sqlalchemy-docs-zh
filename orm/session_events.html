<h1><span class="yiyi-st" id="yiyi-63">&#x4F7F;&#x7528;&#x4E8B;&#x4EF6;&#x8DDF;&#x8E2A;&#x5BF9;&#x8C61;&#x548C;&#x4F1A;&#x8BDD;&#x66F4;&#x6539;<a class="headerlink" href="#tracking-object-and-session-changes-with-events" title="Permalink to this headline">&#xB6;</a></span></h1><p><span class="yiyi-st" id="yiyi-64">SQLAlchemy&#x5177;&#x6709;&#x5728;&#x6574;&#x4E2A;Core&#x548C;ORM&#x4E2D;&#x4F7F;&#x7528;&#x7684;&#x5E7F;&#x6CDB;&#x7684;<a class="reference internal" href="core_event.html"><span>Event Listening</span></a>&#x7CFB;&#x7EDF;&#x3002;</span><span class="yiyi-st" id="yiyi-65">&#x5728;ORM&#x4E2D;&#xFF0C;&#x6709;&#x5404;&#x79CD;&#x5404;&#x6837;&#x7684;&#x4E8B;&#x4EF6;&#x76D1;&#x542C;&#x5668;&#x94A9;&#x5B50;&#xFF0C;&#x5B83;&#x4EEC;&#x5728;<a class="reference internal" href="events.html"><span>ORM Events</span></a>&#x7684;API&#x7EA7;&#x522B;&#x4E0A;&#x8BB0;&#x5F55;&#x3002;</span><span class="yiyi-st" id="yiyi-66">&#x591A;&#x5E74;&#x6765;&#xFF0C;&#x8FD9;&#x4E00;&#x7CFB;&#x5217;&#x6D3B;&#x52A8;&#x4E0D;&#x65AD;&#x589E;&#x52A0;&#xFF0C;&#x5305;&#x62EC;&#x8BB8;&#x591A;&#x975E;&#x5E38;&#x6709;&#x7528;&#x7684;&#x65B0;&#x6D3B;&#x52A8;&#x4EE5;&#x53CA;&#x4E00;&#x4E9B;&#x4E0E;&#x4EE5;&#x524D;&#x4E0D;&#x76F8;&#x5173;&#x7684;&#x8001;&#x6D3B;&#x52A8;&#x3002;</span><span class="yiyi-st" id="yiyi-67">&#x672C;&#x8282;&#x5C06;&#x5C1D;&#x8BD5;&#x4ECB;&#x7ECD;&#x4E3B;&#x8981;&#x4E8B;&#x4EF6;&#x6302;&#x94A9;&#x4EE5;&#x53CA;&#x4F55;&#x65F6;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5B83;&#x4EEC;&#x3002;</span></p><div class="section" id="persistence-events"><h2><span class="yiyi-st" id="yiyi-68">&#x6301;&#x4E45;&#x6027;&#x4E8B;&#x4EF6;<a class="headerlink" href="#persistence-events" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-69">&#x53EF;&#x80FD;&#x6700;&#x5E7F;&#x6CDB;&#x4F7F;&#x7528;&#x7684;&#x4E00;&#x7CFB;&#x5217;&#x4E8B;&#x4EF6;&#x662F;&#x201C;&#x6301;&#x4E45;&#x6027;&#x201D;&#x4E8B;&#x4EF6;&#xFF0C;&#x5B83;&#x4E0E;<a class="reference internal" href="session_basics.html#session-flushing"><span>flush process</span></a>&#x76F8;&#x5BF9;&#x5E94;&#x3002;</span><span class="yiyi-st" id="yiyi-70">flush&#x662F;&#x6240;&#x6709;&#x5173;&#x4E8E;&#x5BF9;&#x8C61;&#x7684;&#x672A;&#x51B3;&#x4FEE;&#x6539;&#x7684;&#x51B3;&#x5B9A;&#xFF0C;&#x7136;&#x540E;&#x4EE5;INSERT&#xFF0C;UPDATE&#x548C;DELETE&#x7684;&#x5F62;&#x5F0F;&#x53D1;&#x9001;&#x5230;&#x6570;&#x636E;&#x5E93;&#x3002;</span></p><div class="section" id="before-flush"><h3><span class="yiyi-st" id="yiyi-71"><code class="docutils literal"><span class="pre">before_flush()</span></code><a class="headerlink" href="#before-flush" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-72">The <a class="reference internal" href="events.html#sqlalchemy.orm.events.SessionEvents.before_flush" title="sqlalchemy.orm.events.SessionEvents.before_flush"><code class="xref py py-meth docutils literal"><span class="pre">SessionEvents.before_flush()</span></code></a> hook is by far the most generally useful event to use when an application wants to ensure that additional persistence changes to the database are made when a flush proceeds. </span><span class="yiyi-st" id="yiyi-73">&#x4F7F;&#x7528;<a class="reference internal" href="events.html#sqlalchemy.orm.events.SessionEvents.before_flush" title="sqlalchemy.orm.events.SessionEvents.before_flush"><code class="xref py py-meth docutils literal"><span class="pre">SessionEvents.before_flush()</span></code></a>&#x6765;&#x64CD;&#x4F5C;&#x5BF9;&#x8C61;&#x4EE5;&#x9A8C;&#x8BC1;&#x5176;&#x72B6;&#x6001;&#xFF0C;&#x5E76;&#x5728;&#x6301;&#x4E45;&#x5316;&#x4E4B;&#x524D;&#x7F16;&#x5199;&#x5176;&#x4ED6;&#x5BF9;&#x8C61;&#x548C;&#x5F15;&#x7528;&#x3002;</span><span class="yiyi-st" id="yiyi-74">Within this event, it is <strong>safe to manipulate the Session&#x2019;s state</strong>, that is, new objects can be attached to it, objects can be deleted, and indivual attributes on objects can be changed freely, and these changes will be pulled into the flush process when the event hook completes.</span></p><p><span class="yiyi-st" id="yiyi-75">&#x5178;&#x578B;&#x7684;<a class="reference internal" href="events.html#sqlalchemy.orm.events.SessionEvents.before_flush" title="sqlalchemy.orm.events.SessionEvents.before_flush"><code class="xref py py-meth docutils literal"><span class="pre">SessionEvents.before_flush()</span></code></a>&#x94A9;&#x5B50;&#x7684;&#x4EFB;&#x52A1;&#x662F;&#x626B;&#x63CF;&#x96C6;&#x5408;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.new" title="sqlalchemy.orm.session.Session.new"><code class="xref py py-attr docutils literal"><span class="pre">Session.new</span></code></a>&#xFF0C;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.dirty" title="sqlalchemy.orm.session.Session.dirty"><code class="xref py py-attr docutils literal"><span class="pre">Session.dirty</span></code></a>&#x548C;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.deleted" title="sqlalchemy.orm.session.Session.deleted"><code class="xref py py-attr docutils literal"><span class="pre">Session.deleted</span></code></a>&#x4E3A;&#x4E86;&#x5BFB;&#x627E;&#x53D1;&#x751F;&#x4E8B;&#x60C5;&#x7684;&#x5BF9;&#x8C61;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-76">&#x6709;&#x5173;<a class="reference internal" href="events.html#sqlalchemy.orm.events.SessionEvents.before_flush" title="sqlalchemy.orm.events.SessionEvents.before_flush"><code class="xref py py-meth docutils literal"><span class="pre">SessionEvents.before_flush()</span></code></a>&#x7684;&#x8BF4;&#x660E;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a class="reference internal" href="examples.html#examples-versioned-history"><span>Versioning with a History Table</span></a>&#x548C;<a class="reference internal" href="examples.html#examples-versioned-rows"><span>Versioning using Temporal Rows</span></a></span></p></div><div class="section" id="after-flush"><h3><span class="yiyi-st" id="yiyi-77"><code class="docutils literal"><span class="pre">after_flush()</span></code><a class="headerlink" href="#after-flush" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-78">The <a class="reference internal" href="events.html#sqlalchemy.orm.events.SessionEvents.after_flush" title="sqlalchemy.orm.events.SessionEvents.after_flush"><code class="xref py py-meth docutils literal"><span class="pre">SessionEvents.after_flush()</span></code></a> hook is called after the SQL has been emitted for a flush process, but <strong>before</strong> the state of the objects that were flushed has been altered. </span><span class="yiyi-st" id="yiyi-79">&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x60A8;&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x68C0;&#x67E5;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.new" title="sqlalchemy.orm.session.Session.new"><code class="xref py py-attr docutils literal"><span class="pre">Session.new</span></code></a>&#xFF0C;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.dirty" title="sqlalchemy.orm.session.Session.dirty"><code class="xref py py-attr docutils literal"><span class="pre">Session.dirty</span></code></a>&#x548C;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.deleted" title="sqlalchemy.orm.session.Session.deleted"><code class="xref py py-attr docutils literal"><span class="pre">Session.deleted</span></code></a>&#x96C6;&#x5408;&#x4EE5;&#x67E5;&#x770B;&#x521A;&#x521A;&#x5237;&#x65B0;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x800C;&#x60A8;&#x8FD8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x50CF;<a class="reference internal" href="internals.html#sqlalchemy.orm.state.AttributeState" title="sqlalchemy.orm.state.AttributeState"><code class="xref py py-class docutils literal"><span class="pre">AttributeState</span></code></a>&#x63D0;&#x4F9B;&#x7684;&#x5386;&#x53F2;&#x8DDF;&#x8E2A;&#x529F;&#x80FD;&#x6765;&#x67E5;&#x770B;&#x521A;&#x521A;&#x4FDD;&#x5B58;&#x7684;&#x66F4;&#x6539;&#x3002;</span><span class="yiyi-st" id="yiyi-80">&#x5728;<a class="reference internal" href="events.html#sqlalchemy.orm.events.SessionEvents.after_flush" title="sqlalchemy.orm.events.SessionEvents.after_flush"><code class="xref py py-meth docutils literal"><span class="pre">SessionEvents.after_flush()</span></code></a>&#x4E8B;&#x4EF6;&#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x89C2;&#x5BDF;&#x5230;&#x7684;&#x53D8;&#x5316;&#x5C06;&#x9644;&#x52A0;&#x7684;SQL&#x53D1;&#x9001;&#x5230;&#x6570;&#x636E;&#x5E93;&#x3002;</span></p></div><div class="section" id="after-flush-postexec"><h3><span class="yiyi-st" id="yiyi-81"><code class="docutils literal"><span class="pre">after_flush_postexec()</span></code><a class="headerlink" href="#after-flush-postexec" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-82"><a class="reference internal" href="events.html#sqlalchemy.orm.events.SessionEvents.after_flush_postexec" title="sqlalchemy.orm.events.SessionEvents.after_flush_postexec"><code class="xref py py-meth docutils literal"><span class="pre">SessionEvents.after_flush_postexec()</span></code></a> is called soon after <a class="reference internal" href="events.html#sqlalchemy.orm.events.SessionEvents.after_flush" title="sqlalchemy.orm.events.SessionEvents.after_flush"><code class="xref py py-meth docutils literal"><span class="pre">SessionEvents.after_flush()</span></code></a>, but is invoked <strong>after</strong> the state of the objects has been modified to account for the flush that just took place. </span><span class="yiyi-st" id="yiyi-83"><a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.new" title="sqlalchemy.orm.session.Session.new"><code class="xref py py-attr docutils literal"><span class="pre">Session.new</span></code></a>&#xFF0C;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.dirty" title="sqlalchemy.orm.session.Session.dirty"><code class="xref py py-attr docutils literal"><span class="pre">Session.dirty</span></code></a>&#x548C;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.deleted" title="sqlalchemy.orm.session.Session.deleted"><code class="xref py py-attr docutils literal"><span class="pre">Session.deleted</span></code></a>&#x96C6;&#x5408;&#x5728;&#x8FD9;&#x91CC;&#x901A;&#x5E38;&#x662F;&#x5B8C;&#x5168;&#x7A7A;&#x7684;&#x3002;</span><span class="yiyi-st" id="yiyi-84">&#x4F7F;&#x7528;<a class="reference internal" href="events.html#sqlalchemy.orm.events.SessionEvents.after_flush_postexec" title="sqlalchemy.orm.events.SessionEvents.after_flush_postexec"><code class="xref py py-meth docutils literal"><span class="pre">SessionEvents.after_flush_postexec()</span></code></a>&#x68C0;&#x67E5;&#x6700;&#x7EC8;&#x5BF9;&#x8C61;&#x7684;&#x6807;&#x8BC6;&#x6620;&#x5C04;&#xFF0C;&#x5E76;&#x53EF;&#x80FD;&#x53D1;&#x51FA;&#x989D;&#x5916;&#x7684;SQL&#x3002;</span><span class="yiyi-st" id="yiyi-85">In this hook, there is the ability to make new changes on objects, which means the <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a> will again go into a &#x201C;dirty&#x201D; state; the mechanics of the <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a> here will cause it to flush <strong>again</strong> if new changes are detected in this hook if the flush were invoked in the context of <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.commit" title="sqlalchemy.orm.session.Session.commit"><code class="xref py py-meth docutils literal"><span class="pre">Session.commit()</span></code></a>; otherwise, the pending changes will be bundled as part of the next normal flush. </span><span class="yiyi-st" id="yiyi-86">&#x5F53;&#x94A9;&#x5B50;&#x68C0;&#x6D4B;&#x5230;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.commit" title="sqlalchemy.orm.session.Session.commit"><code class="xref py py-meth docutils literal"><span class="pre">Session.commit()</span></code></a>&#x4E2D;&#x7684;&#x65B0;&#x53D8;&#x5316;&#x65F6;&#xFF0C;&#x8BA1;&#x6570;&#x5668;&#x786E;&#x4FDD;&#x5728;100&#x6B21;&#x8FED;&#x4EE3;&#x540E;&#x505C;&#x6B62;&#x8FD9;&#x65B9;&#x9762;&#x7684;&#x65E0;&#x9650;&#x5FAA;&#x73AF;&#xFF0C;&#x5728;<a class="reference internal" href="events.html#sqlalchemy.orm.events.SessionEvents.after_flush_postexec" title="sqlalchemy.orm.events.SessionEvents.after_flush_postexec"><code class="xref py py-meth docutils literal"><span class="pre">SessionEvents.after_flush_postexec()</span></code></a>&#x94A9;&#x5B50;&#x6BCF;&#x6B21;&#x8C03;&#x7528;&#x65F6;&#x4E0D;&#x65AD;&#x6DFB;&#x52A0;&#x65B0;&#x7684;&#x72B6;&#x6001;&#x4EE5;&#x88AB;&#x5237;&#x65B0;&#x3002;</span></p></div><div class="section" id="mapper-level-events"><h3><span class="yiyi-st" id="yiyi-87">&#x6620;&#x5C04;&#x7EA7;&#x4E8B;&#x4EF6;<a class="headerlink" href="#mapper-level-events" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-88">&#x9664;&#x4E86;flush&#x7EA7;&#x522B;&#x7684;&#x94A9;&#x5B50;&#x4E4B;&#x5916;&#xFF0C;&#x8FD8;&#x6709;&#x4E00;&#x4E9B;&#x94A9;&#x5B50;&#x66F4;&#x52A0;&#x7EC6;&#x5316;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x662F;&#x4EE5;&#x6BCF;&#x4E2A;&#x5BF9;&#x8C61;&#x4E3A;&#x57FA;&#x7840;&#x8C03;&#x7528;&#x7684;&#xFF0C;&#x5E76;&#x4E14;&#x57FA;&#x4E8E;INSERT&#xFF0C;UPDATE&#x6216;DELETE&#x5206;&#x89E3;&#x3002;</span><span class="yiyi-st" id="yiyi-89">&#x8FD9;&#x4E9B;&#x662F;&#x6620;&#x5C04;&#x5668;&#x6301;&#x4E45;&#x6027;&#x94A9;&#x5B50;&#xFF0C;&#x5B83;&#x4EEC;&#x4E5F;&#x975E;&#x5E38;&#x53D7;&#x6B22;&#x8FCE;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x4E9B;&#x4E8B;&#x4EF6;&#x9700;&#x8981;&#x66F4;&#x8C28;&#x614E;&#x5730;&#x5904;&#x7406;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x5728;&#x5DF2;&#x7ECF;&#x8FDB;&#x884C;&#x7684;&#x5237;&#x65B0;&#x8FC7;&#x7A0B;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x8FDB;&#x884C;&#xFF1B;&#x8BB8;&#x591A;&#x64CD;&#x4F5C;&#x5728;&#x8FD9;&#x91CC;&#x4E0D;&#x5B89;&#x5168;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-90">&#x8FD9;&#x4E9B;&#x4E8B;&#x4EF6;&#x662F;&#xFF1A;</span></p><ul class="simple"><li><span class="yiyi-st" id="yiyi-91"><a class="reference internal" href="events.html#sqlalchemy.orm.events.MapperEvents.before_insert" title="sqlalchemy.orm.events.MapperEvents.before_insert"><code class="xref py py-meth docutils literal"><span class="pre">MapperEvents.before_insert()</span></code></a></span></li><li><span class="yiyi-st" id="yiyi-92"><a class="reference internal" href="events.html#sqlalchemy.orm.events.MapperEvents.after_insert" title="sqlalchemy.orm.events.MapperEvents.after_insert"><code class="xref py py-meth docutils literal"><span class="pre">MapperEvents.after_insert()</span></code></a></span></li><li><span class="yiyi-st" id="yiyi-93"><a class="reference internal" href="events.html#sqlalchemy.orm.events.MapperEvents.before_update" title="sqlalchemy.orm.events.MapperEvents.before_update"><code class="xref py py-meth docutils literal"><span class="pre">MapperEvents.before_update()</span></code></a></span></li><li><span class="yiyi-st" id="yiyi-94"><a class="reference internal" href="events.html#sqlalchemy.orm.events.MapperEvents.after_update" title="sqlalchemy.orm.events.MapperEvents.after_update"><code class="xref py py-meth docutils literal"><span class="pre">MapperEvents.after_update()</span></code></a></span></li><li><span class="yiyi-st" id="yiyi-95"><a class="reference internal" href="events.html#sqlalchemy.orm.events.MapperEvents.before_delete" title="sqlalchemy.orm.events.MapperEvents.before_delete"><code class="xref py py-meth docutils literal"><span class="pre">MapperEvents.before_delete()</span></code></a></span></li><li><span class="yiyi-st" id="yiyi-96"><a class="reference internal" href="events.html#sqlalchemy.orm.events.MapperEvents.after_delete" title="sqlalchemy.orm.events.MapperEvents.after_delete"><code class="xref py py-meth docutils literal"><span class="pre">MapperEvents.after_delete()</span></code></a></span></li></ul><p><span class="yiyi-st" id="yiyi-97">&#x6BCF;&#x4E2A;&#x4E8B;&#x4EF6;&#x90FD;&#x4F1A;&#x4F20;&#x9012;<a class="reference internal" href="mapping_api.html#sqlalchemy.orm.mapper.Mapper" title="sqlalchemy.orm.mapper.Mapper"><code class="xref py py-class docutils literal"><span class="pre">Mapper</span></code></a>&#xFF0C;&#x6620;&#x5C04;&#x5BF9;&#x8C61;&#x672C;&#x8EAB;&#x4EE5;&#x53CA;&#x7528;&#x4E8E;&#x53D1;&#x51FA;INSERT&#xFF0C;UPDATE&#x6216;DELETE&#x8BED;&#x53E5;&#x7684;<a class="reference internal" href="core_connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal"><span class="pre">Connection</span></code></a>&#x3002;</span><span class="yiyi-st" id="yiyi-98">&#x8FD9;&#x4E9B;&#x4E8B;&#x4EF6;&#x7684;&#x5438;&#x5F15;&#x529B;&#x662F;&#x663E;&#x800C;&#x6613;&#x89C1;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x5982;&#x679C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x60F3;&#x8981;&#x5C06;&#x67D0;&#x4E9B;&#x6D3B;&#x52A8;&#x4E0E;&#x7279;&#x5B9A;&#x7C7B;&#x578B;&#x7684;&#x5BF9;&#x8C61;&#x901A;&#x8FC7;INSERT&#x6301;&#x7EED;&#x7ED1;&#x5B9A;&#x65F6;&#xFF0C;&#x8BE5;&#x94A9;&#x5B50;&#x975E;&#x5E38;&#x5177;&#x4F53;&#xFF1B;&#x4E0E;<a class="reference internal" href="events.html#sqlalchemy.orm.events.SessionEvents.before_flush" title="sqlalchemy.orm.events.SessionEvents.before_flush"><code class="xref py py-meth docutils literal"><span class="pre">SessionEvents.before_flush()</span></code></a>&#x4E8B;&#x4EF6;&#x4E0D;&#x540C;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x50CF;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.new" title="sqlalchemy.orm.session.Session.new"><code class="xref py py-attr docutils literal"><span class="pre">Session.new</span></code></a>&#x90A3;&#x6837;&#x641C;&#x7D22;&#x96C6;&#x5408;&#x4EE5;&#x67E5;&#x627E;&#x76EE;&#x6807;&#x3002;</span><span class="yiyi-st" id="yiyi-99">&#x4F46;&#x662F;&#xFF0C;&#x5F53;&#x8C03;&#x7528;&#x8FD9;&#x4E9B;&#x4E8B;&#x4EF6;&#x65F6;&#xFF0C;&#x8868;&#x793A;&#x8981;&#x53D1;&#x9001;&#x7684;&#x6BCF;&#x4E2A;INSERT&#xFF0C;UPDATE&#xFF0C;DELETE&#x8BED;&#x53E5;&#x7684;&#x5B8C;&#x6574;&#x5217;&#x8868;&#x7684;&#x6E05;&#x7A7A;&#x8BA1;&#x5212;&#x5DF2;&#x7ECF;<em>&#x5DF2;&#x7ECF;&#x51B3;&#x5B9A;</em>&#xFF0C;&#x5E76;&#x4E14;&#x5728;&#x6B64;&#x9636;&#x6BB5;&#x4E0D;&#x80FD;&#x8FDB;&#x884C;&#x66F4;&#x6539;&#x3002;</span><span class="yiyi-st" id="yiyi-100">&#x56E0;&#x6B64;&#x5BF9;&#x7ED9;&#x5B9A;&#x5BF9;&#x8C61;&#x751A;&#x81F3;&#x53EF;&#x80FD;&#x7684;&#x552F;&#x4E00;&#x66F4;&#x6539;&#x662F;&#x5C5E;&#x6027;<strong>local</strong>&#x5230;&#x5BF9;&#x8C61;&#x7684;&#x884C;&#x3002;</span><span class="yiyi-st" id="yiyi-101">&#x5BF9;&#x8C61;&#x6216;&#x5176;&#x4ED6;&#x5BF9;&#x8C61;&#x7684;&#x4EFB;&#x4F55;&#x5176;&#x4ED6;&#x66F4;&#x6539;&#x90FD;&#x4F1A;&#x5F71;&#x54CD;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x7684;&#x72B6;&#x6001;&#xFF0C;&#x8FD9;&#x5C06;&#x65E0;&#x6CD5;&#x6B63;&#x5E38;&#x8FD0;&#x884C;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-102">&#x8FD9;&#x4E9B;&#x6620;&#x5C04;&#x7EA7;&#x6301;&#x4E45;&#x6027;&#x4E8B;&#x4EF6;&#x4E2D;&#x4E0D;&#x652F;&#x6301;&#x7684;&#x64CD;&#x4F5C;&#x5305;&#x62EC;&#xFF1A;</span></p><ul class="simple"><li><span class="yiyi-st" id="yiyi-103"><a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.add" title="sqlalchemy.orm.session.Session.add"><code class="xref py py-meth docutils literal"><span class="pre">Session.add()</span></code></a></span></li><li><span class="yiyi-st" id="yiyi-104"><a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.delete" title="sqlalchemy.orm.session.Session.delete"><code class="xref py py-meth docutils literal"><span class="pre">Session.delete()</span></code></a></span></li><li><span class="yiyi-st" id="yiyi-105">&#x6620;&#x5C04;&#x96C6;&#x5408;&#x8FFD;&#x52A0;&#xFF0C;&#x6DFB;&#x52A0;&#xFF0C;&#x5220;&#x9664;&#xFF0C;&#x5220;&#x9664;&#xFF0C;&#x4E22;&#x5F03;&#x7B49;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-106">&#x6620;&#x5C04;&#x5173;&#x7CFB;&#x5C5E;&#x6027;set / del&#x4E8B;&#x4EF6;&#xFF0C;&#x5373;<code class="docutils literal"><span class="pre">someobject.related</span> <span class="pre">=</span> <span class="pre">someotherobject</span></code></span></li></ul><p><span class="yiyi-st" id="yiyi-107">&#x4F20;&#x9012;<a class="reference internal" href="core_connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal"><span class="pre">Connection</span></code></a>&#x7684;&#x539F;&#x56E0;&#x662F;&#x9F13;&#x52B1;<strong>&#x7B80;&#x5355;&#x7684;SQL&#x64CD;&#x4F5C;&#x76F4;&#x63A5;&#x5728;<a class="reference internal" href="core_connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal"><span class="pre">Connection</span></code></a>&#x4E0A;&#x53D1;&#x751F;&#xFF0C;&#x4F8B;&#x5982;&#x9012;&#x589E;&#x8BA1;&#x6570;&#x5668;&#x6216;&#x5728;&#x65E5;&#x5FD7;&#x8868;&#x4E2D;&#x63D2;&#x5165;&#x989D;&#x5916;&#x7684;&#x884C;&#x3002;</strong></span><span class="yiyi-st" id="yiyi-108">&#x5728;&#x5904;&#x7406;<a class="reference internal" href="core_connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal"><span class="pre">Connection</span></code></a>&#x65F6;&#xFF0C;&#x9884;&#x8BA1;&#x5C06;&#x4F7F;&#x7528;&#x6838;&#x5FC3;&#x7EA7;SQL&#x64CD;&#x4F5C;&#xFF1B;&#x4F8B;&#x5982;&#x90A3;&#x4E9B;&#x5728;<a class="reference internal" href="core_tutorial.html"><span>SQL Expression Language Tutorial</span></a>&#x4E2D;&#x63CF;&#x8FF0;&#x7684;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-109">&#x4E5F;&#x6709;&#x8BB8;&#x591A;&#x6BCF;&#x4E2A;&#x5BF9;&#x8C61;&#x64CD;&#x4F5C;&#x90FD;&#x4E0D;&#x9700;&#x8981;&#x5728;flush&#x4E8B;&#x4EF6;&#x4E2D;&#x5904;&#x7406;&#x3002;</span><span class="yiyi-st" id="yiyi-110">&#x6700;&#x5E38;&#x89C1;&#x7684;&#x66FF;&#x4EE3;&#x65B9;&#x6CD5;&#x662F;&#x5728;<code class="docutils literal"><span class="pre">__init__()</span></code>&#x65B9;&#x6CD5;&#x5185;&#x7B80;&#x5355;&#x5730;&#x5EFA;&#x7ACB;&#x9644;&#x52A0;&#x72B6;&#x6001;&#x4EE5;&#x53CA;&#x5BF9;&#x8C61;&#xFF0C;&#x4F8B;&#x5982;&#x521B;&#x5EFA;&#x8981;&#x4E0E;&#x65B0;&#x5BF9;&#x8C61;&#x5173;&#x8054;&#x7684;&#x5176;&#x4ED6;&#x5BF9;&#x8C61;&#x3002;</span><span class="yiyi-st" id="yiyi-111">&#x4F7F;&#x7528;<a class="reference internal" href="mapped_attributes.html#simple-validators"><span>Simple Validators</span></a>&#x4E2D;&#x63CF;&#x8FF0;&#x7684;&#x9A8C;&#x8BC1;&#x5668;&#x662F;&#x53E6;&#x4E00;&#x79CD;&#x65B9;&#x6CD5;&#xFF1B;&#x8FD9;&#x4E9B;&#x51FD;&#x6570;&#x53EF;&#x4EE5;&#x62E6;&#x622A;&#x5BF9;&#x5C5E;&#x6027;&#x7684;&#x66F4;&#x6539;&#xFF0C;&#x5E76;&#x6839;&#x636E;&#x5C5E;&#x6027;&#x66F4;&#x6539;&#x5728;&#x76EE;&#x6807;&#x5BF9;&#x8C61;&#x4E0A;&#x5EFA;&#x7ACB;&#x66F4;&#x591A;&#x7684;&#x72B6;&#x6001;&#x66F4;&#x6539;&#x3002;</span><span class="yiyi-st" id="yiyi-112">&#x901A;&#x8FC7;&#x8FD9;&#x4E24;&#x79CD;&#x65B9;&#x6CD5;&#xFF0C;&#x7269;&#x4F53;&#x5728;&#x8FDB;&#x5165;&#x51B2;&#x6D17;&#x6B65;&#x9AA4;&#x4E4B;&#x524D;&#x5904;&#x4E8E;&#x6B63;&#x786E;&#x7684;&#x72B6;&#x6001;&#x3002;</span></p></div></div><div class="section" id="object-lifecycle-events"><h2><span class="yiyi-st" id="yiyi-113">&#x5BF9;&#x8C61;&#x751F;&#x547D;&#x5468;&#x671F;&#x4E8B;&#x4EF6;<a class="headerlink" href="#object-lifecycle-events" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-114">&#x4E8B;&#x4EF6;&#x7684;&#x53E6;&#x4E00;&#x4E2A;&#x7528;&#x4F8B;&#x662F;&#x8DDF;&#x8E2A;&#x5BF9;&#x8C61;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x3002;</span><span class="yiyi-st" id="yiyi-115">&#x8FD9;&#x662F;&#x6307;&#x5728;<a class="reference internal" href="session_state_management.html#session-object-states"><span>Quickie Intro to Object States</span></a>&#x4E2D;&#x9996;&#x6B21;&#x5F15;&#x5165;&#x7684;&#x72B6;&#x6001;&#x3002;</span></p><div class="versionadded"><p><span class="yiyi-st" id="yiyi-116"><span class="versionmodified">&#x7248;&#x672C;1.1&#x4E2D;&#x7684;&#x65B0;&#x589E;&#x529F;&#x80FD;</span>&#x6DFB;&#x52A0;&#x4E86;&#x4E00;&#x4E2A;&#x62E6;&#x622A;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x4E2D;&#x5BF9;&#x8C61;&#x7684;&#x6240;&#x6709;&#x53EF;&#x80FD;&#x72B6;&#x6001;&#x8F6C;&#x6362;&#x7684;&#x4E8B;&#x4EF6;&#x7CFB;&#x7EDF;&#x3002;</span></p></div><p><span class="yiyi-st" id="yiyi-117">&#x4EE5;&#x4E0A;&#x6240;&#x6709;&#x72B6;&#x6001;&#x90FD;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E8B;&#x4EF6;&#x5B8C;&#x5168;&#x8DDF;&#x8E2A;&#x3002;</span><span class="yiyi-st" id="yiyi-118">&#x6BCF;&#x4E2A;&#x4E8B;&#x4EF6;&#x4EE3;&#x8868;&#x4E00;&#x4E2A;&#x72EC;&#x7279;&#x7684;&#x72B6;&#x6001;&#x8F6C;&#x6362;&#xFF0C;&#x8FD9;&#x610F;&#x5473;&#x7740;&#xFF0C;&#x8D77;&#x59CB;&#x72B6;&#x6001;&#x548C;&#x76EE;&#x6807;&#x72B6;&#x6001;&#x90FD;&#x662F;&#x8DDF;&#x8E2A;&#x7684;&#x90E8;&#x5206;&#x3002;</span><span class="yiyi-st" id="yiyi-119">&#x9664;&#x4E86;&#x6700;&#x521D;&#x7684;&#x77AC;&#x6001;&#x4E8B;&#x4EF6;&#x4E4B;&#x5916;&#xFF0C;&#x6240;&#x6709;&#x4E8B;&#x4EF6;&#x90FD;&#x662F;&#x4EE5;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x5BF9;&#x8C61;&#x6216;&#x7C7B;&#x7684;&#x5F62;&#x5F0F;&#x51FA;&#x73B0;&#x7684;&#xFF0C;&#x8FD9;&#x610F;&#x5473;&#x7740;&#x5B83;&#x4EEC;&#x53EF;&#x4EE5;&#x4E0E;&#x7279;&#x5B9A;&#x7684;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x5BF9;&#x8C61;&#x5173;&#x8054;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">event</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">Session</span>

<span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>

<span class="nd">@event.listens_for</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="s1">&apos;transient_to_pending&apos;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">object_is_pending</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;new pending: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">obj</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-120">&#x6216;&#x8005;&#x4F7F;&#x7528;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x7C7B;&#x672C;&#x8EAB;&#x4EE5;&#x53CA;&#x7279;&#x5B9A;&#x7684;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.sessionmaker" title="sqlalchemy.orm.session.sessionmaker"><code class="xref py py-class docutils literal"><span class="pre">sessionmaker</span></code></a>&#xFF0C;&#x8FD9;&#x53EF;&#x80FD;&#x662F;&#x6700;&#x6709;&#x7528;&#x7684;&#x5F62;&#x5F0F;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">event</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">sessionmaker</span>

<span class="n">maker</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">()</span>

<span class="nd">@event.listens_for</span><span class="p">(</span><span class="n">maker</span><span class="p">,</span> <span class="s1">&apos;transient_to_pending&apos;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">object_is_pending</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;new pending: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">obj</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-121">&#x542C;&#x4F17;&#x5F53;&#x7136;&#x53EF;&#x4EE5;&#x5806;&#x53E0;&#x5728;&#x4E00;&#x4E2A;&#x529F;&#x80FD;&#x7684;&#x9876;&#x90E8;&#xFF0C;&#x8FD9;&#x5F88;&#x53EF;&#x80FD;&#x662F;&#x5E38;&#x89C1;&#x7684;&#x3002;</span><span class="yiyi-st" id="yiyi-122">&#x4F8B;&#x5982;&#xFF0C;&#x8981;&#x8DDF;&#x8E2A;&#x8FDB;&#x5165;&#x6301;&#x4E45;&#x72B6;&#x6001;&#x7684;&#x6240;&#x6709;&#x5BF9;&#x8C61;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@event.listens_for</span><span class="p">(</span><span class="n">maker</span><span class="p">,</span> <span class="s2">&quot;pending_to_persistent&quot;</span><span class="p">)</span>
<span class="nd">@event.listens_for</span><span class="p">(</span><span class="n">maker</span><span class="p">,</span> <span class="s2">&quot;deleted_to_persistent&quot;</span><span class="p">)</span>
<span class="nd">@event.listens_for</span><span class="p">(</span><span class="n">maker</span><span class="p">,</span> <span class="s2">&quot;detached_to_persistent&quot;</span><span class="p">)</span>
<span class="nd">@event.listens_for</span><span class="p">(</span><span class="n">maker</span><span class="p">,</span> <span class="s2">&quot;loaded_as_persistent&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">detect_all_persistent</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;object is now persistent: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">instance</span><span class="p">)</span></pre></div></div><div class="section" id="transient"><h3><span class="yiyi-st" id="yiyi-123">&#x77AC;&#x6001;<a class="headerlink" href="#transient" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h3><p><span class="yiyi-st" id="yiyi-124">&#x6240;&#x6709;&#x6620;&#x5C04;&#x5BF9;&#x8C61;&#x5728;&#x7B2C;&#x4E00;&#x6B21;&#x6784;&#x5EFA;&#x65F6;&#x90FD;&#x4EE5;<a class="reference internal" href="glossary.html#term-transient"><span class="xref std std-term">transient</span></a>&#x5F00;&#x59CB;&#x3002;</span><span class="yiyi-st" id="yiyi-125">&#x5728;&#x8FD9;&#x79CD;&#x72B6;&#x6001;&#x4E0B;&#xFF0C;&#x5BF9;&#x8C61;&#x5355;&#x72EC;&#x5B58;&#x5728;&#xFF0C;&#x5E76;&#x4E14;&#x4E0E;&#x4EFB;&#x4F55;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x6CA1;&#x6709;&#x5173;&#x8054;&#x3002;</span><span class="yiyi-st" id="yiyi-126">For this initial state, there&#x2019;s no specific &#x201C;transition&#x201D; event since there is no <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>, however if one wanted to intercept when any transient object is created, the <a class="reference internal" href="events.html#sqlalchemy.orm.events.InstanceEvents.init" title="sqlalchemy.orm.events.InstanceEvents.init"><code class="xref py py-meth docutils literal"><span class="pre">InstanceEvents.init()</span></code></a> method is probably the best event. </span><span class="yiyi-st" id="yiyi-127">&#x6B64;&#x4E8B;&#x4EF6;&#x9002;&#x7528;&#x4E8E;&#x7279;&#x5B9A;&#x7684;&#x7C7B;&#x6216;&#x8D85;&#x7C7B;&#x3002;</span><span class="yiyi-st" id="yiyi-128">&#x4F8B;&#x5982;&#xFF0C;&#x8981;&#x62E6;&#x622A;&#x7279;&#x5B9A;&#x58F0;&#x660E;&#x57FA;&#x7684;&#x6240;&#x6709;&#x65B0;&#x5BF9;&#x8C61;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">event</span>

<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>

<span class="nd">@event.listens_for</span><span class="p">(</span><span class="n">Base</span><span class="p">,</span> <span class="s2">&quot;init&quot;</span><span class="p">,</span> <span class="n">propagate</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">intercept_init</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;new transient: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">instance</span><span class="p">)</span></pre></div></div></div><div class="section" id="transient-to-pending"><h3><span class="yiyi-st" id="yiyi-129">&#x77AC;&#x6001;&#x5230;&#x5F85;&#x5B9A;<a class="headerlink" href="#transient-to-pending" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-130">The transient object becomes <a class="reference internal" href="glossary.html#term-pending"><span class="xref std std-term">pending</span></a> when it is first associated with a <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a> via the <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.add" title="sqlalchemy.orm.session.Session.add"><code class="xref py py-meth docutils literal"><span class="pre">Session.add()</span></code></a> or <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.add_all" title="sqlalchemy.orm.session.Session.add_all"><code class="xref py py-meth docutils literal"><span class="pre">Session.add_all()</span></code></a> method. </span><span class="yiyi-st" id="yiyi-131">&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x4E5F;&#x53EF;&#x80FD;&#x6210;&#x4E3A;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x4F5C;&#x4E3A;<a class="reference internal" href="cascades.html#unitofwork-cascades"><span>&#x201C;cascade&#x201D;</span></a>&#x4E2D;&#x663E;&#x5F0F;&#x6DFB;&#x52A0;&#x7684;&#x5F15;&#x7528;&#x5BF9;&#x8C61;&#x7684;&#x7ED3;&#x679C;&#x3002;</span><span class="yiyi-st" id="yiyi-132">&#x4F7F;&#x7528;<a class="reference internal" href="events.html#sqlalchemy.orm.events.SessionEvents.transient_to_pending" title="sqlalchemy.orm.events.SessionEvents.transient_to_pending"><code class="xref py py-meth docutils literal"><span class="pre">SessionEvents.transient_to_pending()</span></code></a>&#x4E8B;&#x4EF6;&#x53EF;&#x68C0;&#x6D4B;&#x5230;&#x6682;&#x6302;&#x8F6C;&#x6362;&#x7684;&#x6682;&#x6001;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@event.listens_for</span><span class="p">(</span><span class="n">sessionmaker</span><span class="p">,</span> <span class="s2">&quot;transient_to_pending&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">intercept_transient_to_pending</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">object_</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;transient to pending: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">object_</span><span class="p">)</span></pre></div></div></div><div class="section" id="pending-to-persistent"><h3><span class="yiyi-st" id="yiyi-133">&#x7B49;&#x5F85;&#x6301;&#x4E45;<a class="headerlink" href="#pending-to-persistent" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-134">&#x5BF9;&#x4E8E;&#x5B9E;&#x4F8B;&#xFF0C;&#x5F53;flush&#x548C;INSERT&#x8BED;&#x53E5;&#x53D1;&#x751F;&#x65F6;&#xFF0C;<a class="reference internal" href="glossary.html#term-pending"><span class="xref std std-term">pending</span></a>&#x5BF9;&#x8C61;&#x53D8;&#x4E3A;<a class="reference internal" href="glossary.html#term-persistent"><span class="xref std std-term">persistent</span></a>&#x3002;</span><span class="yiyi-st" id="yiyi-135">&#x8BE5;&#x5BF9;&#x8C61;&#x73B0;&#x5728;&#x62E5;&#x6709;&#x4E00;&#x4E2A;&#x8EAB;&#x4EFD;&#x5BC6;&#x94A5;&#x3002;</span><span class="yiyi-st" id="yiyi-136">&#x4F7F;&#x7528;<a class="reference internal" href="events.html#sqlalchemy.orm.events.SessionEvents.pending_to_persistent" title="sqlalchemy.orm.events.SessionEvents.pending_to_persistent"><code class="xref py py-meth docutils literal"><span class="pre">SessionEvents.pending_to_persistent()</span></code></a>&#x4E8B;&#x4EF6;&#x8DDF;&#x8E2A;&#x6302;&#x8D77;&#x6301;&#x4E45;&#x5316;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@event.listens_for</span><span class="p">(</span><span class="n">sessionmaker</span><span class="p">,</span> <span class="s2">&quot;pending_to_persistent&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">intercept_pending_to_persistent</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">object_</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;pending to persistent: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">object_</span><span class="p">)</span></pre></div></div></div><div class="section" id="pending-to-transient"><h3><span class="yiyi-st" id="yiyi-137">&#x7B49;&#x5F85;&#x77AC;&#x53D8;<a class="headerlink" href="#pending-to-transient" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-138">The <a class="reference internal" href="glossary.html#term-pending"><span class="xref std std-term">pending</span></a> object can revert back to <a class="reference internal" href="glossary.html#term-transient"><span class="xref std std-term">transient</span></a> if the <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.rollback" title="sqlalchemy.orm.session.Session.rollback"><code class="xref py py-meth docutils literal"><span class="pre">Session.rollback()</span></code></a> method is called before the pending object has been flushed, or if the <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.expunge" title="sqlalchemy.orm.session.Session.expunge"><code class="xref py py-meth docutils literal"><span class="pre">Session.expunge()</span></code></a> method is called for the object before it is flushed. </span><span class="yiyi-st" id="yiyi-139">&#x4F7F;&#x7528;<a class="reference internal" href="events.html#sqlalchemy.orm.events.SessionEvents.pending_to_transient" title="sqlalchemy.orm.events.SessionEvents.pending_to_transient"><code class="xref py py-meth docutils literal"><span class="pre">SessionEvents.pending_to_transient()</span></code></a>&#x4E8B;&#x4EF6;&#x8DDF;&#x8E2A;&#x6302;&#x8D77;&#x5230;&#x77AC;&#x6001;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@event.listens_for</span><span class="p">(</span><span class="n">sessionmaker</span><span class="p">,</span> <span class="s2">&quot;pending_to_transient&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">intercept_pending_to_transient</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">object_</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;transient to pending: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">object_</span><span class="p">)</span></pre></div></div></div><div class="section" id="loaded-as-persistent"><h3><span class="yiyi-st" id="yiyi-140">&#x52A0;&#x8F7D;&#x4E3A;&#x6301;&#x4E45;<a class="headerlink" href="#loaded-as-persistent" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-141">&#x4ECE;&#x6570;&#x636E;&#x5E93;&#x52A0;&#x8F7D;&#x65F6;&#xFF0C;&#x5BF9;&#x8C61;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4EE5;<a class="reference internal" href="glossary.html#term-persistent"><span class="xref std std-term">persistent</span></a>&#x72B6;&#x6001;&#x51FA;&#x73B0;&#x5728;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x4E2D;&#x3002;</span><span class="yiyi-st" id="yiyi-142">Tracking this state transition is synonymous with tracking objects as they are loaded, and is synonomous with using the <a class="reference internal" href="events.html#sqlalchemy.orm.events.InstanceEvents.load" title="sqlalchemy.orm.events.InstanceEvents.load"><code class="xref py py-meth docutils literal"><span class="pre">InstanceEvents.load()</span></code></a> instance-level event. </span><span class="yiyi-st" id="yiyi-143">&#x7136;&#x800C;&#xFF0C;<a class="reference internal" href="events.html#sqlalchemy.orm.events.SessionEvents.loaded_as_persistent" title="sqlalchemy.orm.events.SessionEvents.loaded_as_persistent"><code class="xref py py-meth docutils literal"><span class="pre">SessionEvents.loaded_as_persistent()</span></code></a>&#x4E8B;&#x4EF6;&#x662F;&#x4EE5;&#x4F1A;&#x8BDD;&#x4E3A;&#x4E2D;&#x5FC3;&#x7684;&#x94A9;&#x5B50;&#x63D0;&#x4F9B;&#x7684;&#xFF0C;&#x4EE5;&#x4FBF;&#x5728;&#x901A;&#x8FC7;&#x6B64;&#x7279;&#x5B9A;&#x9014;&#x5F84;&#x8FDB;&#x5165;&#x6301;&#x4E45;&#x72B6;&#x6001;&#x65F6;&#x62E6;&#x622A;&#x5BF9;&#x8C61;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@event.listens_for</span><span class="p">(</span><span class="n">sessionmaker</span><span class="p">,</span> <span class="s2">&quot;loaded_as_persistent&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">intercept_loaded_as_persistent</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">object_</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;object loaded into persistent state: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">object_</span><span class="p">)</span></pre></div></div></div><div class="section" id="persistent-to-transient"><h3><span class="yiyi-st" id="yiyi-144">&#x6301;&#x4E45;&#x5230;&#x77AC;&#x95F4;<a class="headerlink" href="#persistent-to-transient" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-145">&#x5982;&#x679C;&#x4E3A;&#x5BF9;&#x8C61;&#x9996;&#x6B21;&#x6DFB;&#x52A0;&#x4E3A;&#x5F85;&#x5904;&#x7406;&#x7684;&#x4E8B;&#x52A1;&#x8C03;&#x7528;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.rollback" title="sqlalchemy.orm.session.Session.rollback"><code class="xref py py-meth docutils literal"><span class="pre">Session.rollback()</span></code></a>&#x65B9;&#x6CD5;&#xFF0C;&#x6301;&#x4E45;&#x5BF9;&#x8C61;&#x53EF;&#x4EE5;&#x6062;&#x590D;&#x5230;&#x77AC;&#x6001;&#x72B6;&#x6001;&#x3002;</span><span class="yiyi-st" id="yiyi-146">&#x5728;ROLLBACK&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4F7F;&#x8BE5;&#x5BF9;&#x8C61;&#x6301;&#x4E45;&#x5316;&#x7684;INSERT&#x8BED;&#x53E5;&#x88AB;&#x56DE;&#x6EDA;&#xFF0C;&#x5E76;&#x4E14;&#x8BE5;&#x5BF9;&#x8C61;&#x4ECE;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x88AB;&#x9010;&#x51FA;&#x4EE5;&#x518D;&#x6B21;&#x53D8;&#x4E3A;&#x77AC;&#x6001;&#x3002;</span><span class="yiyi-st" id="yiyi-147">&#x4F7F;&#x7528;<a class="reference internal" href="events.html#sqlalchemy.orm.events.SessionEvents.persistent_to_transient" title="sqlalchemy.orm.events.SessionEvents.persistent_to_transient"><code class="xref py py-meth docutils literal"><span class="pre">SessionEvents.persistent_to_transient()</span></code></a>&#x4E8B;&#x4EF6;&#x6302;&#x94A9;&#x8DDF;&#x8E2A;&#x4ECE;&#x6301;&#x4E45;&#x6027;&#x6062;&#x590D;&#x4E3A;&#x77AC;&#x6001;&#x7684;&#x5BF9;&#x8C61;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@event.listens_for</span><span class="p">(</span><span class="n">sessionmaker</span><span class="p">,</span> <span class="s2">&quot;persistent_to_transient&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">intercept_persistent_to_transient</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">object_</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;persistent to transient: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">object_</span><span class="p">)</span></pre></div></div></div><div class="section" id="persistent-to-deleted"><h3><span class="yiyi-st" id="yiyi-148">&#x6301;&#x7EED;&#x5220;&#x9664;<a class="headerlink" href="#persistent-to-deleted" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-149">&#x5F53;&#x6807;&#x8BB0;&#x4E3A;&#x8981;&#x5220;&#x9664;&#x7684;&#x5BF9;&#x8C61;&#x5728;&#x5237;&#x65B0;&#x8FC7;&#x7A0B;&#x4E2D;&#x4ECE;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x5220;&#x9664;&#x65F6;&#xFF0C;&#x6301;&#x4E45;&#x5BF9;&#x8C61;&#x8FDB;&#x5165;<a class="reference internal" href="glossary.html#term-deleted"><span class="xref std std-term">deleted</span></a>&#x72B6;&#x6001;&#x3002;</span><span class="yiyi-st" id="yiyi-150">&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x8FD9;&#x4E0E;&#x4E3A;&#x76EE;&#x6807;&#x5BF9;&#x8C61;&#x8C03;&#x7528;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.delete" title="sqlalchemy.orm.session.Session.delete"><code class="xref py py-meth docutils literal"><span class="pre">Session.delete()</span></code></a>&#x65B9;&#x6CD5;&#x65F6;<strong>&#x4E0D;&#x4E00;&#x6837;</strong>&#x3002;</span><span class="yiyi-st" id="yiyi-151"><a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.delete" title="sqlalchemy.orm.session.Session.delete"><code class="xref py py-meth docutils literal"><span class="pre">Session.delete()</span></code></a>&#x65B9;&#x6CD5;&#x4EC5;<strong>&#x6807;&#x8BB0;</strong>&#x8981;&#x5220;&#x9664;&#x7684;&#x5BF9;&#x8C61;&#xFF1B;&#x76F4;&#x5230;&#x5237;&#x65B0;&#x7ED3;&#x675F;&#x540E;&#x624D;&#x4F1A;&#x53D1;&#x51FA;&#x5B9E;&#x9645;&#x7684;DELETE&#x8BED;&#x53E5;&#x3002;</span><span class="yiyi-st" id="yiyi-152">&#x5728;&#x5237;&#x65B0;&#x4E4B;&#x540E;&#xFF0C;&#x76EE;&#x6807;&#x5BF9;&#x8C61;&#x5B58;&#x5728;&#x201C;&#x5DF2;&#x5220;&#x9664;&#x201D;&#x72B6;&#x6001;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-153">&#x5728;&#x201C;&#x5DF2;&#x5220;&#x9664;&#x201D;&#x72B6;&#x6001;&#x4E0B;&#xFF0C;&#x8BE5;&#x5BF9;&#x8C61;&#x4EC5;&#x4E0E;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x7A0D;&#x6709;&#x5173;&#x8054;&#x3002;</span><span class="yiyi-st" id="yiyi-154">&#x5B83;&#x4E0D;&#x5B58;&#x5728;&#x4E8E;&#x8EAB;&#x4EFD;&#x6620;&#x5C04;&#x4E2D;&#xFF0C;&#x4E5F;&#x4E0D;&#x5B58;&#x5728;&#x4E8E;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.deleted" title="sqlalchemy.orm.session.Session.deleted"><code class="xref py py-attr docutils literal"><span class="pre">Session.deleted</span></code></a>&#x96C6;&#x5408;&#x4E2D;&#xFF0C;&#x8BE5;&#x96C6;&#x5408;&#x6307;&#x5411;&#x5F85;&#x5220;&#x9664;&#x65F6;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-155">&#x4ECE;&#x201C;&#x5DF2;&#x5220;&#x9664;&#x201D;&#x72B6;&#x6001;&#xFF0C;&#x5BF9;&#x8C61;&#x53EF;&#x4EE5;&#x5728;&#x4E8B;&#x52A1;&#x63D0;&#x4EA4;&#x65F6;&#x8F6C;&#x5230;&#x5206;&#x79BB;&#x72B6;&#x6001;&#xFF0C;&#x6216;&#x8005;&#x5982;&#x679C;&#x4E8B;&#x52A1;&#x88AB;&#x56DE;&#x6EDA;&#xFF0C;&#x5219;&#x8FD4;&#x56DE;&#x5230;&#x6301;&#x4E45;&#x72B6;&#x6001;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-156">&#x4F7F;&#x7528;<a class="reference internal" href="events.html#sqlalchemy.orm.events.SessionEvents.persistent_to_deleted" title="sqlalchemy.orm.events.SessionEvents.persistent_to_deleted"><code class="xref py py-meth docutils literal"><span class="pre">SessionEvents.persistent_to_deleted()</span></code></a>&#x8DDF;&#x8E2A;&#x6C38;&#x4E45;&#x5220;&#x9664;&#x7684;&#x8F6C;&#x6362;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@event.listens_for</span><span class="p">(</span><span class="n">sessionmaker</span><span class="p">,</span> <span class="s2">&quot;persistent_to_deleted&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">intercept_persistent_to_deleted</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">object_</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;object was DELETEd, is now in deleted state: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">object_</span><span class="p">)</span></pre></div></div></div><div class="section" id="deleted-to-detached"><h3><span class="yiyi-st" id="yiyi-157">&#x5DF2;&#x5220;&#x9664;&#x5206;&#x79BB;<a class="headerlink" href="#deleted-to-detached" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-158">&#x5F53;&#x4F1A;&#x8BDD;&#x7684;&#x4E8B;&#x52A1;&#x63D0;&#x4EA4;&#x65F6;&#xFF0C;&#x88AB;&#x5220;&#x9664;&#x7684;&#x5BF9;&#x8C61;&#x53D8;&#x4E3A;<a class="reference internal" href="glossary.html#term-detached"><span class="xref std std-term">detached</span></a>&#x3002;</span><span class="yiyi-st" id="yiyi-159">&#x5728;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.commit" title="sqlalchemy.orm.session.Session.commit"><code class="xref py py-meth docutils literal"><span class="pre">Session.commit()</span></code></a>&#x65B9;&#x6CD5;&#x88AB;&#x8C03;&#x7528;&#x540E;&#xFF0C;&#x6570;&#x636E;&#x5E93;&#x4E8B;&#x52A1;&#x662F;&#x6700;&#x7EC8;&#x7684;&#xFF0C;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x73B0;&#x5728;&#x5B8C;&#x5168;&#x4E22;&#x5F03;&#x5DF2;&#x5220;&#x9664;&#x7684;&#x5BF9;&#x8C61;&#x5E76;&#x5220;&#x9664;&#x4E0E;&#x5B83;&#x7684;&#x6240;&#x6709;&#x5173;&#x8054;&#x3002;</span><span class="yiyi-st" id="yiyi-160">&#x4F7F;&#x7528;<a class="reference internal" href="events.html#sqlalchemy.orm.events.SessionEvents.deleted_to_detached" title="sqlalchemy.orm.events.SessionEvents.deleted_to_detached"><code class="xref py py-meth docutils literal"><span class="pre">SessionEvents.deleted_to_detached()</span></code></a>&#x8DDF;&#x8E2A;&#x5DF2;&#x5220;&#x9664;&#x5230;&#x5DF2;&#x5206;&#x79BB;&#x7684;&#x8F6C;&#x6362;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@event.listens_for</span><span class="p">(</span><span class="n">sessionmaker</span><span class="p">,</span> <span class="s2">&quot;deleted_to_detached&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">intercept_deleted_to_detached</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">object_</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;deleted to detached: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">object_</span><span class="p">)</span></pre></div></div><div class="admonition note"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-161">&#x6CE8;&#x610F;</span></p><p class="last"><span class="yiyi-st" id="yiyi-162">&#x5F53;&#x5BF9;&#x8C61;&#x5904;&#x4E8E;&#x5DF2;&#x5220;&#x9664;&#x72B6;&#x6001;&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">inspect(object).deleted</span></code>&#x8BBF;&#x95EE;&#x7684;<a class="reference internal" href="internals.html#sqlalchemy.orm.state.InstanceState.deleted" title="sqlalchemy.orm.state.InstanceState.deleted"><code class="xref py py-attr docutils literal"><span class="pre">InstanceState.deleted</span></code></a>&#x5C5E;&#x6027;&#x8FD4;&#x56DE;True&#x3002;</span><span class="yiyi-st" id="yiyi-163">&#x4F46;&#x662F;&#xFF0C;&#x5F53;&#x5BF9;&#x8C61;&#x88AB;&#x5206;&#x79BB;&#x65F6;&#xFF0C;<a class="reference internal" href="internals.html#sqlalchemy.orm.state.InstanceState.deleted" title="sqlalchemy.orm.state.InstanceState.deleted"><code class="xref py py-attr docutils literal"><span class="pre">InstanceState.deleted</span></code></a>&#x5C06;&#x518D;&#x6B21;&#x8FD4;&#x56DE;False&#x3002;</span><span class="yiyi-st" id="yiyi-164">&#x8981;&#x68C0;&#x6D4B;&#x5BF9;&#x8C61;&#x662F;&#x5426;&#x88AB;&#x5220;&#x9664;&#xFF0C;&#x65E0;&#x8BBA;&#x5B83;&#x662F;&#x5426;&#x88AB;&#x5206;&#x79BB;&#xFF0C;&#x8BF7;&#x4F7F;&#x7528;<a class="reference internal" href="internals.html#sqlalchemy.orm.state.InstanceState.was_deleted" title="sqlalchemy.orm.state.InstanceState.was_deleted"><code class="xref py py-attr docutils literal"><span class="pre">InstanceState.was_deleted</span></code></a>&#x8BBF;&#x95EE;&#x5668;&#x3002;</span></p></div></div><div class="section" id="persistent-to-detached"><h3><span class="yiyi-st" id="yiyi-165">&#x6301;&#x4E45;&#x5206;&#x79BB;<a class="headerlink" href="#persistent-to-detached" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-166">The persistent object becomes <a class="reference internal" href="glossary.html#term-detached"><span class="xref std std-term">detached</span></a> when the object is de-associated with the <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>, via the <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.expunge" title="sqlalchemy.orm.session.Session.expunge"><code class="xref py py-meth docutils literal"><span class="pre">Session.expunge()</span></code></a>, <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.expunge_all" title="sqlalchemy.orm.session.Session.expunge_all"><code class="xref py py-meth docutils literal"><span class="pre">Session.expunge_all()</span></code></a>, or <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.close" title="sqlalchemy.orm.session.Session.close"><code class="xref py py-meth docutils literal"><span class="pre">Session.close()</span></code></a> methods.</span></p><div class="admonition note"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-167">&#x6CE8;&#x610F;</span></p><p class="last"><span class="yiyi-st" id="yiyi-168">&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x62E5;&#x6709;&#x7684;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x88AB;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x53D6;&#x6D88;&#x5F15;&#x7528;&#x5E76;&#x4E14;&#x7531;&#x4E8E;&#x5783;&#x573E;&#x6536;&#x96C6;&#x800C;&#x88AB;&#x629B;&#x5F03;&#xFF0C;&#x5219;&#x8BE5;&#x5BF9;&#x8C61;&#x4E5F;&#x53EF;&#x80FD;&#x6210;&#x4E3A;<strong>&#x9690;&#x5F0F;&#x5206;&#x79BB;&#x7684;</strong>&#x3002;</span><span class="yiyi-st" id="yiyi-169">&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;<strong>&#x6CA1;&#x6709;&#x4E8B;&#x4EF6;&#x88AB;&#x53D1;&#x5C04;</strong>&#x3002;</span></p></div><p><span class="yiyi-st" id="yiyi-170">&#x4F7F;&#x7528;<a class="reference internal" href="events.html#sqlalchemy.orm.events.SessionEvents.persistent_to_detached" title="sqlalchemy.orm.events.SessionEvents.persistent_to_detached"><code class="xref py py-meth docutils literal"><span class="pre">SessionEvents.persistent_to_detached()</span></code></a>&#x4E8B;&#x4EF6;&#x8DDF;&#x8E2A;&#x4ECE;&#x6301;&#x4E45;&#x79FB;&#x52A8;&#x5230;&#x5206;&#x79BB;&#x7684;&#x5BF9;&#x8C61;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@event.listens_for</span><span class="p">(</span><span class="n">sessionmaker</span><span class="p">,</span> <span class="s2">&quot;persistent_to_detached&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">intecept_persistent_to_detached</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">object_</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;object became detached: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">object_</span><span class="p">)</span></pre></div></div></div><div class="section" id="detached-to-persistent"><h3><span class="yiyi-st" id="yiyi-171">&#x5206;&#x79BB;&#x5230;&#x6301;&#x4E45;<a class="headerlink" href="#detached-to-persistent" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-172">&#x4F7F;&#x7528;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.add" title="sqlalchemy.orm.session.Session.add"><code class="xref py py-meth docutils literal"><span class="pre">Session.add()</span></code></a>&#x6216;&#x7B49;&#x6548;&#x65B9;&#x6CD5;&#x5C06;&#x5206;&#x79BB;&#x5BF9;&#x8C61;&#x91CD;&#x65B0;&#x5173;&#x8054;&#x5230;&#x4F1A;&#x8BDD;&#x65F6;&#xFF0C;&#x5206;&#x79BB;&#x7684;&#x5BF9;&#x8C61;&#x5C06;&#x53D8;&#x4E3A;&#x6301;&#x4E45;&#x5BF9;&#x8C61;&#x3002;</span><span class="yiyi-st" id="yiyi-173">&#x4F7F;&#x7528;<a class="reference internal" href="events.html#sqlalchemy.orm.events.SessionEvents.detached_to_persistent" title="sqlalchemy.orm.events.SessionEvents.detached_to_persistent"><code class="xref py py-meth docutils literal"><span class="pre">SessionEvents.detached_to_persistent()</span></code></a>&#x4E8B;&#x4EF6;&#x8DDF;&#x8E2A;&#x4ECE;&#x5206;&#x79BB;&#x72B6;&#x6001;&#x56DE;&#x5230;&#x6301;&#x4E45;&#x6027;&#x72B6;&#x6001;&#x7684;&#x5BF9;&#x8C61;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@event.listens_for</span><span class="p">(</span><span class="n">sessionmaker</span><span class="p">,</span> <span class="s2">&quot;detached_to_persistent&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">intecept_detached_to_persistent</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">object_</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;object became persistent again: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">object_</span><span class="p">)</span></pre></div></div></div><div class="section" id="deleted-to-persistent"><h3><span class="yiyi-st" id="yiyi-174">&#x5DF2;&#x5220;&#x9664;&#x5230;&#x6301;&#x4E45;<a class="headerlink" href="#deleted-to-persistent" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-175">&#x5F53;&#x4F7F;&#x7528;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.rollback" title="sqlalchemy.orm.session.Session.rollback"><code class="xref py py-meth docutils literal"><span class="pre">Session.rollback()</span></code></a>&#x65B9;&#x6CD5;&#x56DE;&#x9000;&#x5DF2;&#x5220;&#x9664;DELETEd&#x7684;&#x4E8B;&#x52A1;&#x65F6;&#xFF0C;<a class="reference internal" href="glossary.html#term-deleted"><span class="xref std std-term">deleted</span></a>&#x5BF9;&#x8C61;&#x53EF;&#x4EE5;&#x6062;&#x590D;&#x4E3A;<a class="reference internal" href="glossary.html#term-persistent"><span class="xref std std-term">persistent</span></a>&#x72B6;&#x6001;&#x3002;</span><span class="yiyi-st" id="yiyi-176">&#x4F7F;&#x7528;<a class="reference internal" href="events.html#sqlalchemy.orm.events.SessionEvents.deleted_to_persistent" title="sqlalchemy.orm.events.SessionEvents.deleted_to_persistent"><code class="xref py py-meth docutils literal"><span class="pre">SessionEvents.deleted_to_persistent()</span></code></a>&#x4E8B;&#x4EF6;&#x8DDF;&#x8E2A;&#x5DF2;&#x79FB;&#x56DE;&#x5230;&#x6301;&#x4E45;&#x72B6;&#x6001;&#x7684;&#x5DF2;&#x5220;&#x9664;&#x5BF9;&#x8C61;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@event.listens_for</span><span class="p">(</span><span class="n">sessionmaker</span><span class="p">,</span> <span class="s2">&quot;transient_to_pending&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">intercept_transient_to_pending</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">object_</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;transient to pending: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">object_</span><span class="p">)</span></pre></div></div></div></div><div class="section" id="transaction-events"><h2><span class="yiyi-st" id="yiyi-177">&#x4EA4;&#x6613;&#x4E8B;&#x4EF6;<a class="headerlink" href="#transaction-events" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-178">&#x4E8B;&#x52A1;&#x4E8B;&#x4EF6;&#x5141;&#x8BB8;&#x5728;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x7EA7;&#x522B;&#x53D1;&#x751F;&#x4E8B;&#x52A1;&#x8FB9;&#x754C;&#x65F6;&#x4EE5;&#x53CA;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x66F4;&#x6539;<a class="reference internal" href="core_connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal"><span class="pre">Connection</span></code></a>&#x5BF9;&#x8C61;&#x4E0A;&#x7684;&#x4E8B;&#x52A1;&#x6027;&#x72B6;&#x6001;&#x65F6;&#x901A;&#x77E5;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;</span></p><ul class="simple"><li><span class="yiyi-st" id="yiyi-179"><a class="reference internal" href="events.html#sqlalchemy.orm.events.SessionEvents.after_transaction_create" title="sqlalchemy.orm.events.SessionEvents.after_transaction_create"><code class="xref py py-meth docutils literal"><span class="pre">SessionEvents.after_transaction_create()</span></code></a>, <a class="reference internal" href="events.html#sqlalchemy.orm.events.SessionEvents.after_transaction_end" title="sqlalchemy.orm.events.SessionEvents.after_transaction_end"><code class="xref py py-meth docutils literal"><span class="pre">SessionEvents.after_transaction_end()</span></code></a> - these events track the logical transaction scopes of the <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a> in a way that is not specific to individual database connections. </span><span class="yiyi-st" id="yiyi-180">&#x8FD9;&#x4E9B;&#x4E8B;&#x4EF6;&#x65E8;&#x5728;&#x5E2E;&#x52A9;&#x96C6;&#x6210;&#x4E8B;&#x52A1;&#x8DDF;&#x8E2A;&#x7CFB;&#x7EDF;&#xFF0C;&#x5982;<code class="docutils literal"><span class="pre">zope.sqlalchemy</span></code>&#x3002;</span><span class="yiyi-st" id="yiyi-181">&#x5F53;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x9700;&#x8981;&#x5C06;&#x67D0;&#x4E2A;&#x5916;&#x90E8;&#x8303;&#x56F4;&#x4E0E;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x7684;&#x4E8B;&#x52A1;&#x8303;&#x56F4;&#x5BF9;&#x9F50;&#x65F6;&#x4F7F;&#x7528;&#x8FD9;&#x4E9B;&#x4E8B;&#x4EF6;&#x3002;</span><span class="yiyi-st" id="yiyi-182">&#x8FD9;&#x4E9B;&#x94A9;&#x5B50;&#x53CD;&#x6620;&#x4E86;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x7684;&#x201C;&#x5D4C;&#x5957;&#x201D;&#x4E8B;&#x52A1;&#x884C;&#x4E3A;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x8DDF;&#x8E2A;&#x903B;&#x8F91;&#x201C;&#x5B50;&#x4E8B;&#x52A1;&#x201D;&#x4EE5;&#x53CA;&#x201C;&#x5D4C;&#x5957;&#x201D;&#xFF08;&#x4F8B;&#x5982;SAVEPOINT&#xFF09;&#x4E8B;&#x52A1;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-183"><a class="reference internal" href="events.html#sqlalchemy.orm.events.SessionEvents.before_commit" title="sqlalchemy.orm.events.SessionEvents.before_commit"><code class="xref py py-meth docutils literal"><span class="pre">SessionEvents.before_commit()</span></code></a>, <a class="reference internal" href="events.html#sqlalchemy.orm.events.SessionEvents.after_commit" title="sqlalchemy.orm.events.SessionEvents.after_commit"><code class="xref py py-meth docutils literal"><span class="pre">SessionEvents.after_commit()</span></code></a>, <a class="reference internal" href="events.html#sqlalchemy.orm.events.SessionEvents.after_begin" title="sqlalchemy.orm.events.SessionEvents.after_begin"><code class="xref py py-meth docutils literal"><span class="pre">SessionEvents.after_begin()</span></code></a>, <a class="reference internal" href="events.html#sqlalchemy.orm.events.SessionEvents.after_rollback" title="sqlalchemy.orm.events.SessionEvents.after_rollback"><code class="xref py py-meth docutils literal"><span class="pre">SessionEvents.after_rollback()</span></code></a>, <a class="reference internal" href="events.html#sqlalchemy.orm.events.SessionEvents.after_soft_rollback" title="sqlalchemy.orm.events.SessionEvents.after_soft_rollback"><code class="xref py py-meth docutils literal"><span class="pre">SessionEvents.after_soft_rollback()</span></code></a> - These events allow tracking of transaction events from the perspective of database connections. </span><span class="yiyi-st" id="yiyi-184"><a class="reference internal" href="events.html#sqlalchemy.orm.events.SessionEvents.after_begin" title="sqlalchemy.orm.events.SessionEvents.after_begin"><code class="xref py py-meth docutils literal"><span class="pre">SessionEvents.after_begin()</span></code></a> in particular is a per-connection event; a <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a> that maintains more than one connection will emit this event for each connection individually as those connections become used within the current transaction. </span><span class="yiyi-st" id="yiyi-185">&#x5F53;DBAPI&#x8FDE;&#x63A5;&#x672C;&#x8EAB;&#x76F4;&#x63A5;&#x63A5;&#x6536;&#x5230;&#x56DE;&#x6EDA;&#x6216;&#x63D0;&#x4EA4;&#x6307;&#x4EE4;&#x65F6;&#xFF0C;&#x56DE;&#x6EDA;&#x548C;&#x63D0;&#x4EA4;&#x4E8B;&#x4EF6;&#x5373;&#x4E3A;&#x5F15;&#x7528;&#x3002;</span></li></ul></div><div class="section" id="attribute-change-events"><h2><span class="yiyi-st" id="yiyi-186">&#x5C5E;&#x6027;&#x66F4;&#x6539;&#x4E8B;&#x4EF6;<a class="headerlink" href="#attribute-change-events" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-187">&#x5C5E;&#x6027;&#x66F4;&#x6539;&#x4E8B;&#x4EF6;&#x5141;&#x8BB8;&#x62E6;&#x622A;&#x5BF9;&#x8C61;&#x7684;&#x7279;&#x5B9A;&#x5C5E;&#x6027;&#x4F55;&#x65F6;&#x88AB;&#x4FEE;&#x6539;&#x3002;</span><span class="yiyi-st" id="yiyi-188">&#x8FD9;&#x4E9B;&#x4E8B;&#x4EF6;&#x5305;&#x62EC;<a class="reference internal" href="events.html#sqlalchemy.orm.events.AttributeEvents.set" title="sqlalchemy.orm.events.AttributeEvents.set"><code class="xref py py-meth docutils literal"><span class="pre">AttributeEvents.set()</span></code></a>&#xFF0C;<a class="reference internal" href="events.html#sqlalchemy.orm.events.AttributeEvents.append" title="sqlalchemy.orm.events.AttributeEvents.append"><code class="xref py py-meth docutils literal"><span class="pre">AttributeEvents.append()</span></code></a>&#x548C;<a class="reference internal" href="events.html#sqlalchemy.orm.events.AttributeEvents.remove" title="sqlalchemy.orm.events.AttributeEvents.remove"><code class="xref py py-meth docutils literal"><span class="pre">AttributeEvents.remove()</span></code></a>&#x3002;</span><span class="yiyi-st" id="yiyi-189">&#x8FD9;&#x4E9B;&#x4E8B;&#x4EF6;&#x975E;&#x5E38;&#x6709;&#x7528;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x5BF9;&#x4E8E;&#x6BCF;&#x4E2A;&#x5BF9;&#x8C61;&#x9A8C;&#x8BC1;&#x64CD;&#x4F5C;&#xFF1B;&#x7136;&#x800C;&#xFF0C;&#x4F7F;&#x7528;&#x201C;&#x9A8C;&#x8BC1;&#x5668;&#x201D;&#x94A9;&#x5B50;&#x901A;&#x5E38;&#x4F1A;&#x66F4;&#x65B9;&#x4FBF;&#xFF0C;&#x8BE5;&#x94A9;&#x5B50;&#x5728;&#x5E55;&#x540E;&#x4F7F;&#x7528;&#x8FD9;&#x4E9B;&#x94A9;&#x5B50;&#xFF1B;&#x8BF7;&#x53C2;&#x9605;<a class="reference internal" href="mapped_attributes.html#simple-validators"><span>Simple Validators</span></a>&#x4EE5;&#x4E86;&#x89E3;&#x5176;&#x80CC;&#x666F;&#x3002;</span><span class="yiyi-st" id="yiyi-190">&#x5C5E;&#x6027;&#x4E8B;&#x4EF6;&#x4E5F;&#x662F;&#x53CD;&#x5411;&#x5F15;&#x7528;&#x673A;&#x5236;&#x7684;&#x540E;&#x9762;&#x3002;</span><span class="yiyi-st" id="yiyi-191">&#x5C5E;&#x6027;&#x4E8B;&#x4EF6;&#x7684;&#x4F7F;&#x7528;&#x793A;&#x4F8B;&#x4F4D;&#x4E8E;<a class="reference internal" href="examples.html#examples-instrumentation"><span>Attribute Instrumentation</span></a>&#x4E2D;&#x3002;</span></p></div>