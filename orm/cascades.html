<h1><span class="yiyi-st" id="yiyi-51">&#x7EA7;&#x8054;<a class="headerlink" href="#cascades" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h1><p><span class="yiyi-st" id="yiyi-52">&#x6620;&#x5C04;&#x5668;&#x652F;&#x6301;&#x5728;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#x7ED3;&#x6784;&#x4E0A;&#x914D;&#x7F6E;<span class="xref std std-term">cascade</span>&#x884C;&#x4E3A;&#x7684;&#x6982;&#x5FF5;&#x3002;</span><span class="yiyi-st" id="yiyi-53">&#x8FD9;&#x6D89;&#x53CA;&#x5982;&#x4F55;&#x5C06;&#x76F8;&#x5BF9;&#x4E8E;&#x7279;&#x5B9A;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x7684;&#x201C;&#x7236;&#x201D;&#x5BF9;&#x8C61;&#x6267;&#x884C;&#x7684;&#x64CD;&#x4F5C;&#x4F20;&#x64AD;&#x5230;&#x7531;&#x8BE5;&#x5173;&#x7CFB;&#x5F15;&#x7528;&#x7684;&#x9879;&#x76EE;&#xFF08;&#x4F8B;&#x5982;&#x201C;&#x5B50;&#x201D;&#x5BF9;&#x8C61;&#xFF09;&#xFF0C;&#x5E76;&#x4E14;&#x53D7;&#x5230;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.cascade" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">relationship.cascade</span></code></a>&#x9009;&#x9879;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-54">&#x7EA7;&#x8054;&#x7684;&#x9ED8;&#x8BA4;&#x884C;&#x4E3A;&#x4EC5;&#x9650;&#x4E8E;&#x6240;&#x8C13;&#x7684;<a class="reference internal" href="#cascade-save-update"><span>save-update</span></a>&#x548C;<a class="reference internal" href="#cascade-merge"><span>merge</span></a>&#x8BBE;&#x7F6E;&#x7684;&#x7EA7;&#x8054;&#x3002;</span><span class="yiyi-st" id="yiyi-55">&#x7EA7;&#x8054;&#x7684;&#x5178;&#x578B;&#x201C;&#x66FF;&#x4EE3;&#x201D;&#x8BBE;&#x7F6E;&#x662F;&#x6DFB;&#x52A0;<a class="reference internal" href="#cascade-delete"><span>delete</span></a>&#x548C;<a class="reference internal" href="#cascade-delete-orphan"><span>delete-orphan</span></a>&#x9009;&#x9879;&#xFF1B;&#x8FD9;&#x4E9B;&#x8BBE;&#x7F6E;&#x9002;&#x7528;&#x4E8E;&#x76F8;&#x5173;&#x5BF9;&#x8C61;&#xFF0C;&#x53EA;&#x8981;&#x5B83;&#x4EEC;&#x8FDE;&#x63A5;&#x5230;&#x5B83;&#x4EEC;&#x7684;&#x7236;&#x7EA7;&#xFF0C;&#x5E76;&#x4E14;&#x4EE5;&#x5176;&#x4ED6;&#x65B9;&#x5F0F;&#x5220;&#x9664;&#xFF0C;&#x5B83;&#x4EEC;&#x5C31;&#x4F1A;&#x5B58;&#x5728;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-56">&#x5728;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#x4E2D;&#x4F7F;&#x7528;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.cascade" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">cascade</span></code></a>&#x9009;&#x9879;&#x914D;&#x7F6E;&#x7EA7;&#x8054;&#x884C;&#x4E3A;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Order</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;order&apos;</span>

    <span class="n">items</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Item&quot;</span><span class="p">,</span> <span class="n">cascade</span><span class="o">=</span><span class="s2">&quot;all, delete-orphan&quot;</span><span class="p">)</span>
    <span class="n">customer</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;User&quot;</span><span class="p">,</span> <span class="n">cascade</span><span class="o">=</span><span class="s2">&quot;save-update&quot;</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-57">&#x8981;&#x8BBE;&#x7F6E;backref&#x4E0A;&#x7684;&#x7EA7;&#x8054;&#xFF0C;&#x540C;&#x4E00;&#x4E2A;&#x6807;&#x5FD7;&#x53EF;&#x4EE5;&#x4E0E;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.backref" title="sqlalchemy.orm.backref"><code class="xref py py-func docutils literal"><span class="pre">backref()</span></code></a>&#x51FD;&#x6570;&#x4E00;&#x8D77;&#x4F7F;&#x7528;&#xFF0C;&#x8BE5;&#x51FD;&#x6570;&#x6700;&#x7EC8;&#x5C06;&#x5176;&#x53C2;&#x6570;&#x8FD4;&#x56DE;&#x7ED9;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Item</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;item&apos;</span>

    <span class="n">order</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Order&quot;</span><span class="p">,</span>
                    <span class="n">backref</span><span class="o">=</span><span class="n">backref</span><span class="p">(</span><span class="s2">&quot;items&quot;</span><span class="p">,</span> <span class="n">cascade</span><span class="o">=</span><span class="s2">&quot;all, delete-orphan&quot;</span><span class="p">)</span>
                <span class="p">)</span></pre></div></div><div class="sidebar"><p class="first sidebar-title"><span class="yiyi-st" id="yiyi-58">&#x7EA7;&#x8054;&#x7684;&#x8D77;&#x6E90;</span></p><p class="last"><span class="yiyi-st" id="yiyi-59">SQLAlchemy&#x5BF9;&#x5173;&#x7CFB;&#x7EA7;&#x8054;&#x884C;&#x4E3A;&#x7684;&#x6982;&#x5FF5;&#x4EE5;&#x53CA;&#x914D;&#x7F6E;&#x5B83;&#x4EEC;&#x7684;&#x9009;&#x9879;&#x4E3B;&#x8981;&#x6765;&#x81EA;Hibernate ORM&#x4E2D;&#x7684;&#x7C7B;&#x4F3C;&#x529F;&#x80FD;&#xFF1B; Hibernate&#x5728;&#x5C11;&#x6570;&#x5730;&#x65B9;&#x5F15;&#x7528;&#x4E86;&#x201C;&#x7EA7;&#x8054;&#x201D;&#xFF0C;&#x5982;<a class="reference external" href="https://docs.jboss.org/hibernate/orm_3.3/reference/en-US/html/example-parentchild.html">&#x793A;&#x4F8B;&#xFF1A;&#x7236;/&#x5B50;</a>&#x3002;</span><span class="yiyi-st" id="yiyi-60">&#x5982;&#x679C;&#x7EA7;&#x8054;&#x4EE4;&#x4EBA;&#x6DF7;&#x6DC6;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x53C2;&#x8003;&#x4ED6;&#x4EEC;&#x7684;&#x7ED3;&#x8BBA;&#xFF0C;&#x6307;&#x51FA;&#x201C;&#x6211;&#x4EEC;&#x521A;&#x624D;&#x4ECB;&#x7ECD;&#x7684;&#x90E8;&#x5206;&#x53EF;&#x80FD;&#x6709;&#x70B9;&#x6DF7;&#x4E71;&#x3002;</span><span class="yiyi-st" id="yiyi-61">&#x4F46;&#x662F;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;&#x8FD9;&#x4E00;&#x5207;&#x90FD;&#x5F88;&#x597D;&#x3002;&#x201C;</span></p></div><p><span class="yiyi-st" id="yiyi-62"><a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.cascade" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">cascade</span></code></a>&#x7684;&#x9ED8;&#x8BA4;&#x503C;&#x662F;<code class="docutils literal"><span class="pre">save-update</span> <span class="pre">merge</span></code>&#x3002;</span><span class="yiyi-st" id="yiyi-63">&#x6B64;&#x53C2;&#x6570;&#x7684;&#x5178;&#x578B;&#x66FF;&#x4EE3;&#x8BBE;&#x7F6E;&#x662F;<code class="docutils literal"><span class="pre">all</span></code>&#x6216;&#x66F4;&#x5E38;&#x89C1;&#x7684;<code class="docutils literal"><span class="pre">all&#xFF0C;</span> <span class="pre">delete-orphan</span></code>&#x3002;</span><span class="yiyi-st" id="yiyi-64">The <code class="docutils literal"><span class="pre">all</span></code> symbol is a synonym for <code class="docutils literal"><span class="pre">save-update,</span> <span class="pre">merge,</span> <span class="pre">refresh-expire,</span> <span class="pre">expunge,</span> <span class="pre">delete</span></code>, and using it in conjunction with <code class="docutils literal"><span class="pre">delete-orphan</span></code> indicates that the child object should follow along with its parent in all cases, and be deleted once it is no longer associated with that parent.</span></p><p><span class="yiyi-st" id="yiyi-65">&#x4EE5;&#x4E0B;&#x5C0F;&#x8282;&#x4ECB;&#x7ECD;&#x4E86;&#x53EF;&#x4EE5;&#x4E3A;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.cascade" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">cascade</span></code></a>&#x53C2;&#x6570;&#x6307;&#x5B9A;&#x7684;&#x53EF;&#x7528;&#x503C;&#x5217;&#x8868;&#x3002;</span></p><div class="section" id="save-update"><h2><span class="yiyi-st" id="yiyi-66">&#x4FDD;&#x5B58;&#x66F4;&#x65B0;<a class="headerlink" href="#save-update" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h2><p><span class="yiyi-st" id="yiyi-67"><code class="docutils literal"><span class="pre">save-update</span></code> cascade indicates that when an object is placed into a <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a> via <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.add" title="sqlalchemy.orm.session.Session.add"><code class="xref py py-meth docutils literal"><span class="pre">Session.add()</span></code></a>, all the objects associated with it via this <a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a> should also be added to that same <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>. </span><span class="yiyi-st" id="yiyi-68">&#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x6709;&#x4E00;&#x4E2A;&#x5305;&#x542B;&#x4E24;&#x4E2A;&#x76F8;&#x5173;&#x5BF9;&#x8C61;<code class="docutils literal"><span class="pre">address1</span></code>&#xFF0C;<code class="docutils literal"><span class="pre">address2</span></code>&#x7684;&#x5BF9;&#x8C61;<code class="docutils literal"><span class="pre">user1</span></code>&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">user1</span> <span class="o">=</span> <span class="n">User</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">address1</span><span class="p">,</span> <span class="n">address2</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(),</span> <span class="n">Address</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user1</span><span class="o">.</span><span class="n">addresses</span> <span class="o">=</span> <span class="p">[</span><span class="n">address1</span><span class="p">,</span> <span class="n">address2</span><span class="p">]</span></pre></div></div><p><span class="yiyi-st" id="yiyi-69">If we add <code class="docutils literal"><span class="pre">user1</span></code> to a <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>, it will also add <code class="docutils literal"><span class="pre">address1</span></code>, <code class="docutils literal"><span class="pre">address2</span></code> implicitly:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sess</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sess</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">user1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">address1</span> <span class="ow">in</span> <span class="n">sess</span>
<span class="go">True</span></pre></div></div><p><span class="yiyi-st" id="yiyi-70"><code class="docutils literal"><span class="pre">save-update</span></code>&#x7EA7;&#x8054;&#x8FD8;&#x5F71;&#x54CD;&#x5DF2;&#x5B58;&#x5728;&#x4E8E;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x4E2D;&#x7684;&#x5BF9;&#x8C61;&#x7684;&#x5C5E;&#x6027;&#x64CD;&#x4F5C;&#x3002;</span><span class="yiyi-st" id="yiyi-71">If we add a third object, <code class="docutils literal"><span class="pre">address3</span></code> to the <code class="docutils literal"><span class="pre">user1.addresses</span></code> collection, it becomes part of the state of that <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">address3</span> <span class="o">=</span> <span class="n">Address</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">address3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">address3</span> <span class="ow">in</span> <span class="n">sess</span>
<span class="gp">&gt;&gt;&gt; </span><span class="bp">True</span></pre></div></div><p><span class="yiyi-st" id="yiyi-72"><code class="docutils literal"><span class="pre">save-update</span></code> has the possibly surprising behavior which is that persistent objects which were <em>removed</em> from a collection or in some cases a scalar attribute may also be pulled into the <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a> of a parent object; this is so that the flush process may handle that related object appropriately. </span><span class="yiyi-st" id="yiyi-73">&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x901A;&#x5E38;&#x53EA;&#x80FD;&#x5728;&#x4ECE;&#x4E00;&#x4E2A;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x4E2D;&#x5220;&#x9664;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x5E76;&#x6DFB;&#x52A0;&#x5230;&#x53E6;&#x4E00;&#x4E2A;&#x65F6;&#x624D;&#x4F1A;&#x51FA;&#x73B0;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">user1</span> <span class="o">=</span> <span class="n">sess1</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">address1</span> <span class="o">=</span> <span class="n">user1</span><span class="o">.</span><span class="n">addresses</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sess1</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>   <span class="c1"># user1, address1 no longer associated with sess1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user1</span><span class="o">.</span><span class="n">addresses</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">address1</span><span class="p">)</span>  <span class="c1"># address1 no longer associated with user1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sess2</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sess2</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">user1</span><span class="p">)</span>   <span class="c1"># ... but it still gets added to the new session,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">address1</span> <span class="ow">in</span> <span class="n">sess2</span>  <span class="c1"># because it&apos;s still &quot;pending&quot; for flush</span>
<span class="go">True</span></pre></div></div><p><span class="yiyi-st" id="yiyi-74"><code class="docutils literal"><span class="pre">save-update</span></code>&#x7EA7;&#x8054;&#x5728;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#x5904;&#x4E8E;&#x542F;&#x7528;&#x72B6;&#x6001;&#xFF0C;&#x901A;&#x5E38;&#x89C6;&#x4E3A;&#x7406;&#x6240;&#x5F53;&#x7136;&#xFF1B;&#x5B83;&#x901A;&#x8FC7;&#x5BF9;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.add" title="sqlalchemy.orm.session.Session.add"><code class="xref py py-meth docutils literal"><span class="pre">Session.add()</span></code></a>&#x7684;&#x5355;&#x4E2A;&#x8C03;&#x7528;&#x4E00;&#x6B21;&#x6027;&#x5728;&#x8BE5;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x5185;&#x6CE8;&#x518C;&#x5BF9;&#x8C61;&#x7684;&#x6574;&#x4E2A;&#x7ED3;&#x6784;&#x6765;&#x7B80;&#x5316;&#x4EE3;&#x7801;&#x3002;</span><span class="yiyi-st" id="yiyi-75">&#x867D;&#x7136;&#x5B83;&#x53EF;&#x4EE5;&#x88AB;&#x7981;&#x7528;&#xFF0C;&#x4F46;&#x901A;&#x5E38;&#x4E0D;&#x9700;&#x8981;&#x8FD9;&#x6837;&#x505A;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-76">One case where <code class="docutils literal"><span class="pre">save-update</span></code> cascade does sometimes get in the way is in that it takes place in both directions for bi-directional relationships, e.g. backrefs, meaning that the association of a child object with a particular parent can have the effect of the parent object being implicitly associated with that child object&#x2019;s <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>; this pattern, as well as how to modify its behavior using the <a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.cascade_backrefs" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">cascade_backrefs</span></code></a> flag, is discussed in the section <a class="reference internal" href="#backref-cascade"><span>Controlling Cascade on Backrefs</span></a>.</span></p></div><div class="section" id="delete"><h2><span class="yiyi-st" id="yiyi-77">&#x5220;&#x9664;<a class="headerlink" href="#delete" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h2><p><span class="yiyi-st" id="yiyi-78"><code class="docutils literal"><span class="pre">delete</span></code>&#x7EA7;&#x8054;&#x6307;&#x793A;&#x5F53;&#x201C;&#x7236;&#x201D;&#x5BF9;&#x8C61;&#x88AB;&#x6807;&#x8BB0;&#x4E3A;&#x5220;&#x9664;&#x65F6;&#xFF0C;&#x5176;&#x76F8;&#x5173;&#x7684;&#x201C;&#x5B50;&#x201D;&#x5BF9;&#x8C61;&#x4E5F;&#x5E94;&#x88AB;&#x6807;&#x8BB0;&#x4E3A;&#x5220;&#x9664;&#x3002;</span><span class="yiyi-st" id="yiyi-79">&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x6709;<code class="docutils literal"><span class="pre">User.addresses</span></code>&#x4E0E;<code class="docutils literal"><span class="pre">delete</span></code>&#x7EA7;&#x8054;&#x5173;&#x7CFB;&#x7684;&#x914D;&#x7F6E;&#x5173;&#x7CFB;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="c1"># ...</span>

    <span class="n">addresses</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Address&quot;</span><span class="p">,</span> <span class="n">cascade</span><span class="o">=</span><span class="s2">&quot;save-update, merge, delete&quot;</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-80">&#x5982;&#x679C;&#x4F7F;&#x7528;&#x4E0A;&#x8FF0;&#x6620;&#x5C04;&#xFF0C;&#x6211;&#x4EEC;&#x6709;&#x4E00;&#x4E2A;<code class="docutils literal"><span class="pre">User</span></code>&#x5BF9;&#x8C61;&#x548C;&#x4E24;&#x4E2A;&#x76F8;&#x5173;&#x7684;<code class="docutils literal"><span class="pre">Address</span></code>&#x5BF9;&#x8C61;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">user1</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">address1</span><span class="p">,</span> <span class="n">address2</span> <span class="o">=</span> <span class="n">user1</span><span class="o">.</span><span class="n">addresses</span></pre></div></div><p><span class="yiyi-st" id="yiyi-81">&#x5982;&#x679C;&#x6211;&#x4EEC;&#x5C06;<code class="docutils literal"><span class="pre">user1</span></code>&#x6807;&#x8BB0;&#x4E3A;&#x5220;&#x9664;&#xFF0C;&#x5728;&#x5237;&#x65B0;&#x64CD;&#x4F5C;&#x7EE7;&#x7EED;&#x4E4B;&#x540E;&#xFF0C;<code class="docutils literal"><span class="pre">address1</span></code>&#x548C;<code class="docutils literal"><span class="pre">address2</span></code>&#x4E5F;&#x5C06;&#x88AB;&#x5220;&#x9664;&#xFF1A;</span></p><div class="highlight-python+sql"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">sess</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">user1</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">sess</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<div class="show_sql">DELETE FROM address WHERE address.id = ?
((1,), (2,))
DELETE FROM user WHERE user.id = ?
(1,)
COMMIT</div></pre></div></div><p><span class="yiyi-st" id="yiyi-82">Alternatively, if our <code class="docutils literal"><span class="pre">User.addresses</span></code> relationship does <em>not</em> have <code class="docutils literal"><span class="pre">delete</span></code> cascade, SQLAlchemy&#x2019;s default behavior is to instead de-associate <code class="docutils literal"><span class="pre">address1</span></code> and <code class="docutils literal"><span class="pre">address2</span></code> from <code class="docutils literal"><span class="pre">user1</span></code> by setting their foreign key reference to <code class="docutils literal"><span class="pre">NULL</span></code>. </span><span class="yiyi-st" id="yiyi-83">&#x4F7F;&#x7528;&#x5982;&#x4E0B;&#x6620;&#x5C04;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="c1"># ...</span>

    <span class="n">addresses</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Address&quot;</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-84">&#x5728;&#x5220;&#x9664;&#x7236;<code class="docutils literal"><span class="pre">User</span></code>&#x5BF9;&#x8C61;&#x65F6;&#xFF0C;<code class="docutils literal"><span class="pre">address</span></code>&#x4E2D;&#x7684;&#x884C;&#x4E0D;&#x4F1A;&#x88AB;&#x5220;&#x9664;&#xFF0C;&#x800C;&#x662F;&#x53D6;&#x6D88;&#x5173;&#x8054;&#xFF1A;</span></p><div class="highlight-python+sql"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">sess</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">user1</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">sess</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<div class="show_sql">UPDATE address SET user_id=? WHERE address.id = ?
(None, 1)
UPDATE address SET user_id=? WHERE address.id = ?
(None, 2)
DELETE FROM user WHERE user.id = ?
(1,)
COMMIT</div></pre></div></div><p><span class="yiyi-st" id="yiyi-85"><code class="docutils literal"><span class="pre">delete</span></code> cascade is more often than not used in conjunction with <a class="reference internal" href="#cascade-delete-orphan"><span>delete-orphan</span></a> cascade, which will emit a DELETE for the related row if the &#x201C;child&#x201D; object is deassociated from the parent. </span><span class="yiyi-st" id="yiyi-86"><code class="docutils literal"><span class="pre">delete</span></code>&#x548C;<code class="docutils literal"><span class="pre">delete-orphan</span></code>&#x7EA7;&#x8054;&#x7684;&#x7EC4;&#x5408;&#x6DB5;&#x76D6;&#x4E86;SQLAlchemy&#x5FC5;&#x987B;&#x51B3;&#x5B9A;&#x5C06;&#x5916;&#x952E;&#x5217;&#x8BBE;&#x7F6E;&#x4E3A;NULL&#x8FD8;&#x662F;&#x5B8C;&#x5168;&#x5220;&#x9664;&#x884C;&#x7684;&#x4E24;&#x79CD;&#x60C5;&#x51B5;&#x3002;</span></p><div class="topic"><p class="topic-title first"><span class="yiyi-st" id="yiyi-87">ORM&#x7EA7;&#x522B;&#x201C;&#x5220;&#x9664;&#x201D;&#x7EA7;&#x8054;&#x4E0E;FOREIGN KEY&#x7EA7;&#x522B;&#x201C;ON DELETE&#x201D;&#x7EA7;&#x8054;</span></p><p><span class="yiyi-st" id="yiyi-88">The behavior of SQLAlchemy&#x2019;s &#x201C;delete&#x201D; cascade has a lot of overlap with the <code class="docutils literal"><span class="pre">ON</span> <span class="pre">DELETE</span> <span class="pre">CASCADE</span></code> feature of a database foreign key, as well as with that of the <code class="docutils literal"><span class="pre">ON</span> <span class="pre">DELETE</span> <span class="pre">SET</span> <span class="pre">NULL</span></code> foreign key setting when &#x201C;delete&#x201D; cascade is not specified. </span><span class="yiyi-st" id="yiyi-89">Database level &#x201C;ON DELETE&#x201D; cascades are specific to the &#x201C;FOREIGN KEY&#x201D; construct of the relational database; SQLAlchemy allows configuration of these schema-level constructs at the <a class="reference internal" href="glossary.html#term-ddl"><span class="xref std std-term">DDL</span></a> level using options on <a class="reference internal" href="core_constraints.html#sqlalchemy.schema.ForeignKeyConstraint" title="sqlalchemy.schema.ForeignKeyConstraint"><code class="xref py py-class docutils literal"><span class="pre">ForeignKeyConstraint</span></code></a> which are described at <a class="reference internal" href="core_constraints.html#on-update-on-delete"><span>ON UPDATE and ON DELETE</span></a>.</span></p><p><span class="yiyi-st" id="yiyi-90">&#x91CD;&#x8981;&#x7684;&#x662F;&#x8981;&#x6CE8;&#x610F;ORM&#x548C;&#x5173;&#x7CFB;&#x6570;&#x636E;&#x5E93;&#x7684;&#x201C;&#x7EA7;&#x8054;&#x201D;&#x6982;&#x5FF5;&#x4E4B;&#x95F4;&#x7684;&#x533A;&#x522B;&#x4EE5;&#x53CA;&#x5B83;&#x4EEC;&#x5982;&#x4F55;&#x6574;&#x5408;&#xFF1A;</span></p><ul><li><p class="first"><span class="yiyi-st" id="yiyi-91">&#x5728;&#x5173;&#x7CFB;&#x7684;<strong>&#x591A;&#x5BF9;&#x4E00;</strong>&#x4E00;&#x4FA7;&#x6709;&#x6548;&#x914D;&#x7F6E;&#x6570;&#x636E;&#x5E93;&#x7EA7;<code class="docutils literal"><span class="pre">ON</span> <span class="pre">DELETE</span></code>&#x7EA7;&#x8054;&#xFF1B;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x5B83;&#x914D;&#x7F6E;&#x4E3A;&#x76F8;&#x5BF9;&#x4E8E;<code class="docutils literal"><span class="pre">FOREIGN</span> <span class="pre">KEY</span></code>&#x7EA6;&#x675F;&#xFF0C;&#x8BE5;&#x7EA6;&#x675F;&#x662F;&#x5173;&#x7CFB;&#x7684;&#x201C;&#x8BB8;&#x591A;&#x201D;&#x65B9;&#x9762;&#x3002;</span><span class="yiyi-st" id="yiyi-92">&#x5728;ORM&#x7EA7;&#x522B;&#xFF0C;<strong>&#x8FD9;&#x4E2A;&#x65B9;&#x5411;&#x662F;&#x98A0;&#x5012;&#x7684;</strong>&#x3002;</span><span class="yiyi-st" id="yiyi-93">SQLAlchemy handles the deletion of &#x201C;child&#x201D; objects relative to a &#x201C;parent&#x201D; from the &#x201C;parent&#x201D; side, which means that <code class="docutils literal"><span class="pre">delete</span></code> and <code class="docutils literal"><span class="pre">delete-orphan</span></code> cascade are configured on the <strong>one-to-many</strong> side.</span></p></li><li><p class="first"><span class="yiyi-st" id="yiyi-94">Database level foreign keys with no <code class="docutils literal"><span class="pre">ON</span> <span class="pre">DELETE</span></code> setting are often used to <strong>prevent</strong> a parent row from being removed, as it would necessarily leave an unhandled related row present. </span><span class="yiyi-st" id="yiyi-95">&#x5982;&#x679C;&#x5728;&#x4E00;&#x5BF9;&#x591A;&#x5173;&#x7CFB;&#x4E2D;&#x9700;&#x8981;&#x6B64;&#x884C;&#x4E3A;&#xFF0C;&#x5219;SQLAlchemy&#x5C06;&#x5916;&#x952E;&#x8BBE;&#x7F6E;&#x4E3A;<code class="docutils literal"><span class="pre">NULL</span></code>&#x7684;&#x9ED8;&#x8BA4;&#x884C;&#x4E3A;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4EE5;&#x4E0B;&#x4E24;&#x79CD;&#x65B9;&#x5F0F;&#x4E4B;&#x4E00;&#x6765;&#x6355;&#x83B7;&#xFF1A;</span></p><blockquote><div><ul class="simple"><li><span class="yiyi-st" id="yiyi-96">&#x6700;&#x7B80;&#x5355;&#x4E5F;&#x662F;&#x6700;&#x5E38;&#x89C1;&#x7684;&#x5C31;&#x662F;&#x5728;&#x6570;&#x636E;&#x5E93;&#x6A21;&#x5F0F;&#x7EA7;&#x522B;&#x5C06;&#x5916;&#x952E;&#x4FDD;&#x5B58;&#x5217;&#x8BBE;&#x7F6E;&#x4E3A;<code class="docutils literal"><span class="pre">NOT</span> <span class="pre">NULL</span></code>&#x3002;</span><span class="yiyi-st" id="yiyi-97">SQLAlchemy&#x5C06;&#x5217;&#x8BBE;&#x7F6E;&#x4E3A;NULL&#x7684;&#x5C1D;&#x8BD5;&#x5C06;&#x5931;&#x8D25;&#x5E76;&#x51FA;&#x73B0;&#x7B80;&#x5355;&#x7684;NOT NULL&#x7EA6;&#x675F;&#x5F02;&#x5E38;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-98">&#x53E6;&#x4E00;&#x79CD;&#x66F4;&#x7279;&#x6B8A;&#x7684;&#x65B9;&#x5F0F;&#x662F;&#x5C06;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.passive_deletes" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">passive_deletes</span></code></a>&#x6807;&#x5FD7;&#x8BBE;&#x7F6E;&#x4E3A;&#x5B57;&#x7B26;&#x4E32;<code class="docutils literal"><span class="pre">&quot;all&quot;</span></code>&#x3002;</span><span class="yiyi-st" id="yiyi-99">&#x8FD9;&#x5177;&#x6709;&#x5B8C;&#x5168;&#x7981;&#x7528;SQLAlchemy&#x5C06;&#x5916;&#x952E;&#x5217;&#x8BBE;&#x7F6E;&#x4E3A;NULL&#x7684;&#x884C;&#x4E3A;&#x7684;&#x6548;&#x679C;&#xFF0C;&#x5E76;&#x4E14;&#x5373;&#x4F7F;&#x5B50;&#x884C;&#x5B58;&#x5728;&#x4E8E;&#x5185;&#x5B58;&#x4E2D;&#xFF0C;&#x4E5F;&#x4F1A;&#x4E3A;&#x7236;&#x884C;&#x53D1;&#x51FA;DELETE&#xFF0C;&#x800C;&#x4E0D;&#x4F1A;&#x5F71;&#x54CD;&#x5B50;&#x884C;&#x3002;</span><span class="yiyi-st" id="yiyi-100">&#x5728;&#x6570;&#x636E;&#x5E93;&#x7EA7;&#x5916;&#x952E;&#x89E6;&#x53D1;&#xFF08;&#x7279;&#x6B8A;&#x7684;<code class="docutils literal"><span class="pre">ON</span> <span class="pre">DELETE</span></code>&#x8BBE;&#x7F6E;&#x6216;&#x5176;&#x4ED6;&#x60C5;&#x51B5;&#xFF09;&#x9700;&#x8981;&#x5168;&#x90E8;&#x6FC0;&#x6D3B;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8FD9;&#x53EF;&#x80FD;&#x662F;&#x9700;&#x8981;&#x7684;&#x7236;&#x884C;&#x88AB;&#x5220;&#x9664;&#x7684;&#x60C5;&#x51B5;&#x3002;</span></li></ul></div></blockquote></li><li><p class="first"><span class="yiyi-st" id="yiyi-101">Database level <code class="docutils literal"><span class="pre">ON</span> <span class="pre">DELETE</span></code> cascade is <strong>vastly more efficient</strong> than that of SQLAlchemy. </span><span class="yiyi-st" id="yiyi-102">&#x6570;&#x636E;&#x5E93;&#x53EF;&#x4EE5;&#x4E00;&#x6B21;&#x8DE8;&#x591A;&#x4E2A;&#x5173;&#x7CFB;&#x94FE;&#x63A5;&#x4E00;&#x7CFB;&#x5217;&#x7EA7;&#x8054;&#x64CD;&#x4F5C;&#xFF1B;&#x4F8B;&#x5982;&#x5982;&#x679C;&#x5220;&#x9664;&#x884C;A&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x5220;&#x9664;&#x8868;B&#x4E2D;&#x7684;&#x6240;&#x6709;&#x76F8;&#x5173;&#x884C;&#xFF0C;&#x5E76;&#x4E14;&#x6240;&#x6709;&#x4E0E;&#x8FD9;&#x4E9B;B&#x884C;&#x4E2D;&#x7684;&#x6BCF;&#x4E00;&#x884C;&#x76F8;&#x5173;&#x7684;C&#x884C;&#x4EE5;&#x53CA;on&#x548C;on&#x90FD;&#x5728;&#x5355;&#x4E2A;DELETE&#x8BED;&#x53E5;&#x7684;&#x8303;&#x56F4;&#x5185;&#x3002;</span><span class="yiyi-st" id="yiyi-103">&#x53E6;&#x4E00;&#x65B9;&#x9762;&#xFF0C;SQLAlchemy&#x4E3A;&#x4E86;&#x5B8C;&#x5168;&#x652F;&#x6301;&#x7EA7;&#x8054;&#x5220;&#x9664;&#x64CD;&#x4F5C;&#xFF0C;&#x5FC5;&#x987B;&#x5355;&#x72EC;&#x52A0;&#x8F7D;&#x6BCF;&#x4E2A;&#x76F8;&#x5173;&#x96C6;&#x5408;&#xFF0C;&#x4EE5;&#x4FBF;&#x5B9A;&#x4F4D;&#x6240;&#x6709;&#x53EF;&#x80FD;&#x5177;&#x6709;&#x66F4;&#x591A;&#x76F8;&#x5173;&#x96C6;&#x5408;&#x7684;&#x884C;&#x3002;</span><span class="yiyi-st" id="yiyi-104">&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;SQLAlchemy&#x4E0D;&#x591F;&#x590D;&#x6742;&#xFF0C;&#x65E0;&#x6CD5;&#x5728;&#x6B64;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x4E00;&#x6B21;&#x4E3A;&#x6240;&#x6709;&#x76F8;&#x5173;&#x884C;&#x53D1;&#x51FA;DELETE&#x3002;</span></p></li><li><p class="first"><span class="yiyi-st" id="yiyi-105">SQLAlchemy doesn&#x2019;t <strong>need</strong> to be this sophisticated, as we instead provide smooth integration with the database&#x2019;s own <code class="docutils literal"><span class="pre">ON</span> <span class="pre">DELETE</span></code> functionality, by using the <a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.passive_deletes" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">passive_deletes</span></code></a> option in conjunction with properly configured foreign key constraints. </span><span class="yiyi-st" id="yiyi-106">&#x5728;&#x8FD9;&#x79CD;&#x884C;&#x4E3A;&#x4E0B;&#xFF0C;SQLAlchemy&#x53EA;&#x4F1A;&#x4E3A;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x4E2D;&#x5DF2;&#x5B58;&#x5728;&#x7684;&#x884C;&#x53D1;&#x51FA;DELETE&#xFF1B;&#x5BF9;&#x4E8E;&#x4EFB;&#x4F55;&#x88AB;&#x5378;&#x8F7D;&#x7684;&#x96C6;&#x5408;&#xFF0C;&#x5B83;&#x5C06;&#x5B83;&#x4EEC;&#x7559;&#x7ED9;&#x6570;&#x636E;&#x5E93;&#x6765;&#x5904;&#x7406;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x4E3A;&#x5B83;&#x4EEC;&#x53D1;&#x51FA;SELECT&#x3002;</span><span class="yiyi-st" id="yiyi-107"><a class="reference internal" href="collections.html#passive-deletes"><span>Using Passive Deletes</span></a>&#x90E8;&#x5206;&#x63D0;&#x4F9B;&#x4E86;&#x6B64;&#x7528;&#x6CD5;&#x7684;&#x793A;&#x4F8B;&#x3002;</span></p></li><li><p class="first"><span class="yiyi-st" id="yiyi-108">&#x867D;&#x7136;&#x6570;&#x636E;&#x5E93;&#x7EA7;<code class="docutils literal"> <span class="pre"> ON  T1&gt; <span class="pre">&#x5220;&#x9664; T2&gt;  T0&gt;&#x529F;&#x80FD;&#x53EA;&#x9002;&#x7528;&#x4E8E;&#x5173;&#x7CFB;&#x7684;&#x201C;&#x591A;&#x201D;&#x65B9;&#xFF0C;SQLAlchemy&#x7684;&#x7684;&#x201C;&#x5220;&#x9664;&#x201D;&#x68AF;&#x7EA7;&#x5177;&#x6709;<strong>&#x6709;&#x9650;&#x8FD8;&#x53EF;&#x4EE5;&#x5728;<em>reverse</em>&#x65B9;&#x5411;&#x4E0A;&#x64CD;&#x4F5C;&#xFF0C;&#x8FD9;&#x610F;&#x5473;&#x7740;&#x5B83;&#x53EF;&#x4EE5;&#x5728;&#x201C;&#x591A;&#x201D;&#x4FA7;&#x914D;&#x7F6E;&#xFF0C;&#x4EE5;&#x5220;&#x9664;&#x201C;&#x4E00;&#x4FA7;&#x201D;&#x4E0A;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x5F53;&#x201C;&#x591A;&#x201D;&#x65B9;&#x88AB;&#x5220;&#x9664;&#x3002;</strong></span></span></code></span><span class="yiyi-st" id="yiyi-109">&#x7136;&#x800C;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x5176;&#x4ED6;&#x5BF9;&#x8C61;&#x4ECE;&#x201C;many&#x201D;&#x5F15;&#x7528;&#x8FD9;&#x4E2A;&#x201C;one&#x201D;&#x4E00;&#x4FA7;&#xFF0C;&#x8FD9;&#x5F88;&#x5BB9;&#x6613;&#x5BFC;&#x81F4;&#x8FDD;&#x53CD;&#x7EA6;&#x675F;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x901A;&#x5E38;&#x53EA;&#x5728;&#x5173;&#x7CFB;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x201C;&#x4E00;&#x5BF9;&#x4E00;&#x201D;&#x65F6;&#x624D;&#x6709;&#x7528;&#x3002;</span><span class="yiyi-st" id="yiyi-110">&#x5E94;&#x8BE5;&#x4F7F;&#x7528;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.single_parent" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">single_parent</span></code></a>&#x6807;&#x5FD7;&#x4E3A;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;Python&#x5185;&#x65AD;&#x8A00;&#x3002;</span></p></li></ul></div><p><span class="yiyi-st" id="yiyi-111">&#x5F53;&#x4F7F;&#x7528;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#x65F6;&#xFF0C;&#x4E5F;&#x4F7F;&#x7528;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.secondary" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">secondary</span></code></a>&#x9009;&#x9879;&#x5305;&#x542B;&#x591A;&#x5BF9;&#x591A;&#x8868;&#xFF0C;SQLAlchemy&#x7684;&#x5220;&#x9664;&#x7EA7;&#x8054;&#x4F1A;&#x81EA;&#x52A8;&#x5904;&#x7406;&#x6B64;&#x591A;&#x5BF9;&#x591A;&#x8868;&#x4E2D;&#x7684;&#x884C;&#x3002;</span><span class="yiyi-st" id="yiyi-112">&#x5C31;&#x50CF;&#x6B63;&#x5982;<a class="reference internal" href="basic_relationships.html#relationships-many-to-many-deletion"><span>Deleting Rows from the Many to Many Table</span></a>&#x4E2D;&#x6240;&#x63CF;&#x8FF0;&#x7684;&#x90A3;&#x6837;&#xFF0C;&#x4ECE;&#x591A;&#x5BF9;&#x591A;&#x96C6;&#x5408;&#x4E2D;&#x6DFB;&#x52A0;&#x6216;&#x5220;&#x9664;&#x5BF9;&#x8C61;&#x4F1A;&#x5BFC;&#x81F4;INSERT&#x6216;DELETE&#x884C;&#x4E2D;&#x7684;many-&#x5F53;&#x7531;&#x4E8E;&#x7236;&#x5BF9;&#x8C61;&#x5220;&#x9664;&#x64CD;&#x4F5C;&#x800C;&#x6FC0;&#x6D3B;&#x65F6;&#xFF0C;<code class="docutils literal"><span class="pre">delete</span></code>&#x7EA7;&#x8054;&#x4F1A;&#x5220;&#x9664;&#x201C;child&#x201D;&#x8868;&#x4E2D;&#x7684;&#x884C;&#xFF0C;&#x4F46;&#x4E5F;&#x4F1A;&#x5220;&#x9664;&#x591A;&#x5BF9;&#x591A;&#x8868;&#x4E2D;&#x7684;&#x884C;&#x3002;</span></p></div><div class="section" id="delete-orphan"><h2><span class="yiyi-st" id="yiyi-113">&#x5220;&#x9664;-&#x5B64;&#x513F;<a class="headerlink" href="#delete-orphan" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h2><p><span class="yiyi-st" id="yiyi-114"><code class="docutils literal"><span class="pre">delete-orphan</span></code>&#x7EA7;&#x8054;&#x4F1A;&#x5C06;&#x884C;&#x4E3A;&#x6DFB;&#x52A0;&#x5230;<code class="docutils literal"><span class="pre">delete</span></code>&#x7EA7;&#x8054;&#x4E2D;&#xFF0C;&#x4EE5;&#x4FBF;&#x5C06;&#x5B50;&#x5BF9;&#x8C61;&#x4ECE;&#x7236;&#x7EA7;&#x4E2D;&#x89E3;&#x9664;&#x5173;&#x8054;&#x65F6;&#x6807;&#x8BB0;&#x4E3A;&#x5220;&#x9664;&#xFF0C;&#x800C;&#x4E0D;&#x4EC5;&#x4EC5;&#x662F;&#x7236;&#x7EA7;&#x88AB;&#x6807;&#x8BB0;&#x4E3A;&#x5220;&#x9664;&#x3002;</span><span class="yiyi-st" id="yiyi-115">&#x5728;&#x5904;&#x7406;&#x7531;&#x5176;&#x7236;&#x4EE3;&#x201C;&#x62E5;&#x6709;&#x201D;&#x7684;&#x76F8;&#x5173;&#x5BF9;&#x8C61;&#x65F6;&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5E38;&#x89C1;&#x529F;&#x80FD;&#xFF0C;&#x4F7F;&#x7528;NOT NULL&#x5916;&#x952E;&#xFF0C;&#x56E0;&#x6B64;&#x4ECE;&#x7236;&#x96C6;&#x5408;&#x4E2D;&#x5220;&#x9664;&#x9879;&#x76EE;&#x4F1A;&#x5BFC;&#x81F4;&#x5176;&#x5220;&#x9664;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-116"><code class="docutils literal"><span class="pre">delete-orphan</span></code> cascade implies that each child object can only have one parent at a time, so is configured in the vast majority of cases on a one-to-many relationship. </span><span class="yiyi-st" id="yiyi-117">&#x5C06;&#x5176;&#x8BBE;&#x7F6E;&#x4E3A;&#x591A;&#x5BF9;&#x4E00;&#x6216;&#x591A;&#x5BF9;&#x591A;&#x7684;&#x5173;&#x7CFB;&#x66F4;&#x4E3A;&#x5C34;&#x5C2C;&#xFF1B;&#x5BF9;&#x4E8E;&#x8FD9;&#x4E2A;&#x7528;&#x4F8B;&#xFF0C;SQLAlchemy&#x8981;&#x6C42;&#x4F7F;&#x7528;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.single_parent" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">single_parent</span></code></a>&#x53C2;&#x6570;&#x914D;&#x7F6E;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#xFF0C;&#x5EFA;&#x7ACB;Python&#x7AEF;&#x9A8C;&#x8BC1;&#xFF0C;&#x786E;&#x4FDD;&#x8BE5;&#x5BF9;&#x8C61;&#x4EC5;&#x4E0E;&#x4E00;&#x4E2A;&#x7236;&#x5BF9;&#x8C61;&#x5173;&#x8054;&#x65F6;&#x95F4;&#x3002;</span></p></div><div class="section" id="merge"><h2><span class="yiyi-st" id="yiyi-118">&#x5408;&#x5E76;<a class="headerlink" href="#merge" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h2><p><span class="yiyi-st" id="yiyi-119"><code class="docutils literal"><span class="pre">merge</span></code> cascade&#x6307;&#x793A;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.merge" title="sqlalchemy.orm.session.Session.merge"><code class="xref py py-meth docutils literal"><span class="pre">Session.merge()</span></code></a>&#x64CD;&#x4F5C;&#x5E94;&#x8BE5;&#x4ECE;&#x4F5C;&#x4E3A;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.merge" title="sqlalchemy.orm.session.Session.merge"><code class="xref py py-meth docutils literal"><span class="pre">Session.merge()</span></code></a>&#x4E3B;&#x9898;&#x7684;&#x7236;&#x7EA7;&#x4F20;&#x64AD;&#x5F15;&#x7528;&#x5BF9;&#x8C61;&#x3002;</span><span class="yiyi-st" id="yiyi-120">&#x8FD9;&#x4E2A;&#x7EA7;&#x8054;&#x4E5F;&#x662F;&#x9ED8;&#x8BA4;&#x7684;&#x3002;</span></p></div><div class="section" id="refresh-expire"><h2><span class="yiyi-st" id="yiyi-121">&#x5237;&#x65B0;-&#x5230;&#x671F;<a class="headerlink" href="#refresh-expire" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h2><p><span class="yiyi-st" id="yiyi-122"><code class="docutils literal"><span class="pre">refresh-expire</span></code>&#x662F;&#x4E00;&#x4E2A;&#x4E0D;&#x5E38;&#x89C1;&#x7684;&#x9009;&#x9879;&#xFF0C;&#x8868;&#x660E;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.expire" title="sqlalchemy.orm.session.Session.expire"><code class="xref py py-meth docutils literal"><span class="pre">Session.expire()</span></code></a>&#x64CD;&#x4F5C;&#x5E94;&#x8BE5;&#x4ECE;&#x7236;&#x7EA7;&#x4F20;&#x64AD;&#x5230;&#x5F15;&#x7528;&#x7684;&#x5BF9;&#x8C61;&#x3002;</span><span class="yiyi-st" id="yiyi-123">&#x5F53;&#x4F7F;&#x7528;<a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.refresh" title="sqlalchemy.orm.session.Session.refresh"><code class="xref py py-meth docutils literal"><span class="pre">Session.refresh()</span></code></a>&#x65F6;&#xFF0C;&#x88AB;&#x5F15;&#x7528;&#x7684;&#x5BF9;&#x8C61;&#x53EA;&#x4F1A;&#x8FC7;&#x671F;&#xFF0C;&#x4F46;&#x4E0D;&#x4F1A;&#x5B9E;&#x9645;&#x5237;&#x65B0;&#x3002;</span></p></div><div class="section" id="expunge"><h2><span class="yiyi-st" id="yiyi-124">&#x62B9;&#x53BB;<a class="headerlink" href="#expunge" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h2><p><span class="yiyi-st" id="yiyi-125"><code class="docutils literal"><span class="pre">expunge</span></code> cascade indicates that when the parent object is removed from the <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a> using <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.expunge" title="sqlalchemy.orm.session.Session.expunge"><code class="xref py py-meth docutils literal"><span class="pre">Session.expunge()</span></code></a>, the operation should be propagated down to referred objects.</span></p></div><div class="section" id="controlling-cascade-on-backrefs"><h2><span class="yiyi-st" id="yiyi-126">&#x63A7;&#x5236;Backrefs&#x4E0A;&#x7684;&#x7EA7;&#x8054;<a class="headerlink" href="#controlling-cascade-on-backrefs" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-127">&#x7F3A;&#x7701;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;<a class="reference internal" href="#cascade-save-update"><span>save-update</span></a>&#x7EA7;&#x8054;&#x53D1;&#x751F;&#x5728;&#x4ECE;backrefs&#x53D1;&#x51FA;&#x7684;&#x5C5E;&#x6027;&#x66F4;&#x6539;&#x4E8B;&#x4EF6;&#x4E0A;&#x3002;</span><span class="yiyi-st" id="yiyi-128">&#x8FD9;&#x53EF;&#x80FD;&#x662F;&#x4E00;&#x4E2A;&#x4EE4;&#x4EBA;&#x56F0;&#x60D1;&#x7684;&#x9648;&#x8FF0;&#xFF0C;&#x901A;&#x8FC7;&#x793A;&#x8303;&#x66F4;&#x5BB9;&#x6613;&#x63CF;&#x8FF0;&#xFF1B;&#x8FD9;&#x610F;&#x5473;&#x7740;&#xFF0C;&#x7ED9;&#x5B9A;&#x4E00;&#x4E2A;&#x8FD9;&#x6837;&#x7684;&#x6620;&#x5C04;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">mapper</span><span class="p">(</span><span class="n">Order</span><span class="p">,</span> <span class="n">order_table</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="p">{</span>
    <span class="s1">&apos;items&apos;</span> <span class="p">:</span> <span class="n">relationship</span><span class="p">(</span><span class="n">Item</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="s1">&apos;order&apos;</span><span class="p">)</span>
<span class="p">})</span></pre></div></div><p><span class="yiyi-st" id="yiyi-129">If an <code class="docutils literal"><span class="pre">Order</span></code> is already in the session, and is assigned to the <code class="docutils literal"><span class="pre">order</span></code> attribute of an <code class="docutils literal"><span class="pre">Item</span></code>, the backref appends the <code class="docutils literal"><span class="pre">Item</span></code> to the <code class="docutils literal"><span class="pre">items</span></code> collection of that <code class="docutils literal"><span class="pre">Order</span></code>, resulting in the <code class="docutils literal"><span class="pre">save-update</span></code> cascade taking place:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">o1</span> <span class="o">=</span> <span class="n">Order</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">o1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">o1</span> <span class="ow">in</span> <span class="n">session</span>
<span class="go">True</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">i1</span> <span class="o">=</span> <span class="n">Item</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">i1</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="n">o1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">i1</span> <span class="ow">in</span> <span class="n">o1</span><span class="o">.</span><span class="n">items</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">i1</span> <span class="ow">in</span> <span class="n">session</span>
<span class="go">True</span></pre></div></div><p><span class="yiyi-st" id="yiyi-130">&#x4F7F;&#x7528;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.cascade_backrefs" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">cascade_backrefs</span></code></a>&#x6807;&#x5FD7;&#x53EF;&#x7981;&#x7528;&#x6B64;&#x884C;&#x4E3A;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">mapper</span><span class="p">(</span><span class="n">Order</span><span class="p">,</span> <span class="n">order_table</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="p">{</span>
    <span class="s1">&apos;items&apos;</span> <span class="p">:</span> <span class="n">relationship</span><span class="p">(</span><span class="n">Item</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="s1">&apos;order&apos;</span><span class="p">,</span>
                                <span class="n">cascade_backrefs</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="p">})</span></pre></div></div><p><span class="yiyi-st" id="yiyi-131">&#x5982;&#x4E0A;&#x6240;&#x8FF0;&#xFF0C;<code class="docutils literal"><span class="pre">i1.order</span> <span class="pre">=</span> <span class="pre">o1</span></code>&#x7684;&#x5206;&#x914D;&#x5C06;&#x4F1A;&#x9644;&#x52A0;<code class="docutils literal"><span class="pre">i1</span></code> <code class="docutils literal"><span class="pre">o1</span></code>&#x7684;<code class="docutils literal"><span class="pre">items</span></code>&#x96C6;&#x5408;&#xFF0C;&#x4F46;&#x4E0D;&#x4F1A;&#x5C06;<code class="docutils literal"><span class="pre">i1</span></code>&#x6DFB;&#x52A0;&#x5230;&#x4F1A;&#x8BDD;&#x4E2D;&#x3002;</span><span class="yiyi-st" id="yiyi-132">You can, of course, <a class="reference internal" href="session_api.html#sqlalchemy.orm.session.Session.add" title="sqlalchemy.orm.session.Session.add"><code class="xref py py-meth docutils literal"><span class="pre">add()</span></code></a> <code class="docutils literal"><span class="pre">i1</span></code> to the session at a later point. </span><span class="yiyi-st" id="yiyi-133">&#x6B64;&#x9009;&#x9879;&#x53EF;&#x80FD;&#x6709;&#x52A9;&#x4E8E;&#x5728;&#x5BF9;&#x8C61;&#x9700;&#x8981;&#x5728;&#x4F1A;&#x8BDD;&#x7ED3;&#x675F;&#x4E4B;&#x524D;&#x4FDD;&#x6301;&#x5728;&#x4F1A;&#x8BDD;&#x4E4B;&#x5916;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x4F46;&#x4ECD;&#x9700;&#x8981;&#x5C06;&#x5BF9;&#x8C61;&#x5173;&#x8054;&#x5230;&#x76EE;&#x6807;&#x4F1A;&#x8BDD;&#x4E2D;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x7684;&#x5BF9;&#x8C61;&#x3002;</span></p></div>