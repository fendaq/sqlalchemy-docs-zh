<h1><span class="yiyi-st" id="yiyi-62">&#x6DF7;&#x5408;&#x3001;&#x81EA;&#x5B9A;&#x4E49;&#x5B9E;&#x4F53;&#x516C;&#x5171;&#x7C7B;<a class="headerlink" href="#mixin-and-custom-base-classes" title="Permalink to this headline">&#xB6;</a></span></h1><p><span class="yiyi-st" id="yiyi-63">&#x4F7F;&#x7528;<a class="reference internal" href="api.html#module-sqlalchemy.ext.declarative" title="sqlalchemy.ext.declarative"><code class="xref py py-mod docutils literal"><span class="pre">declarative</span></code></a>&#x65F6;&#x7684;&#x4E00;&#x4E2A;&#x5E38;&#x89C1;&#x9700;&#x6C42;&#x662F;&#x8DE8;&#x591A;&#x4E2A;&#x7C7B;&#x5171;&#x4EAB;&#x67D0;&#x4E9B;&#x529F;&#x80FD;&#xFF0C;&#x4F8B;&#x5982;&#x4E00;&#x7EC4;&#x516C;&#x5171;&#x5217;&#xFF0C;&#x4E00;&#x4E9B;&#x5E38;&#x7528;&#x8868;&#x9009;&#x9879;&#x6216;&#x5176;&#x4ED6;&#x6620;&#x5C04;&#x5C5E;&#x6027;&#x3002;</span><span class="yiyi-st" id="yiyi-64">&#x6807;&#x51C6;&#x7684;Python&#x6210;&#x8BED;&#x5C31;&#x662F;&#x8BA9;&#x8FD9;&#x4E9B;&#x7C7B;&#x4ECE;&#x5305;&#x542B;&#x8FD9;&#x4E9B;&#x5E38;&#x7528;&#x7279;&#x5F81;&#x7684;&#x57FA;&#x7840;&#x7EE7;&#x627F;&#x800C;&#x6765;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-65">&#x4F7F;&#x7528;<a class="reference internal" href="api.html#module-sqlalchemy.ext.declarative" title="sqlalchemy.ext.declarative"><code class="xref py py-mod docutils literal"><span class="pre">declarative</span></code></a>&#x65F6;&#xFF0C;&#x901A;&#x8FC7;&#x4F7F;&#x7528;&#x81EA;&#x5B9A;&#x4E49;&#x58F0;&#x660E;&#x5F0F;&#x57FA;&#x7C7B;&#x4EE5;&#x53CA;&#x9664;&#x4E3B;&#x57FA;&#x7840;&#x4E4B;&#x5916;&#x8FD8;&#x7EE7;&#x627F;&#x7684;&#x201C;mixin&#x201D;&#x7C7B;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x8BE5;&#x60EF;&#x7528;&#x6CD5;&#x3002;</span><span class="yiyi-st" id="yiyi-66">&#x58F0;&#x660E;&#x5305;&#x62EC;&#x51E0;&#x4E2A;&#x5E2E;&#x52A9;&#x5668;&#x529F;&#x80FD;&#xFF0C;&#x4EE5;&#x4FBF;&#x5982;&#x4F55;&#x58F0;&#x660E;&#x6620;&#x5C04;&#x3002;</span><span class="yiyi-st" id="yiyi-67">&#x4E0B;&#x9762;&#x662F;&#x4E00;&#x4E9B;&#x5E38;&#x7528;&#x7684;&#x6DF7;&#x5408;&#x6210;&#x8BED;&#x7684;&#x4F8B;&#x5B50;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declared_attr</span>

<span class="k">class</span> <span class="nc">MyMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">__tablename__</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">__name__</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="n">__table_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&apos;mysql_engine&apos;</span><span class="p">:</span> <span class="s1">&apos;InnoDB&apos;</span><span class="p">}</span>
    <span class="n">__mapper_args__</span><span class="o">=</span> <span class="p">{</span><span class="s1">&apos;always_refresh&apos;</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>

    <span class="nb">id</span> <span class="o">=</span>  <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">MyMixin</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-68">Where above, the class <code class="docutils literal"><span class="pre">MyModel</span></code> will contain an &#x201C;id&#x201D; column as the primary key, a <code class="docutils literal"><span class="pre">__tablename__</span></code> attribute that derives from the name of the class itself, as well as <code class="docutils literal"><span class="pre">__table_args__</span></code> and <code class="docutils literal"><span class="pre">__mapper_args__</span></code> defined by the <code class="docutils literal"><span class="pre">MyMixin</span></code> mixin class.</span></p><p><span class="yiyi-st" id="yiyi-69">There&#x2019;s no fixed convention over whether <code class="docutils literal"><span class="pre">MyMixin</span></code> precedes <code class="docutils literal"><span class="pre">Base</span></code> or not. </span><span class="yiyi-st" id="yiyi-70">&#x6B63;&#x5E38;&#x7684;Python&#x65B9;&#x6CD5;&#x89E3;&#x51B3;&#x89C4;&#x5219;&#x9002;&#x7528;&#xFF0C;&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x4E5F;&#x9002;&#x7528;&#x4E8E;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">Base</span><span class="p">,</span> <span class="n">MyMixin</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-71">&#x8FD9;&#x662F;&#x6709;&#x6548;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;<code class="docutils literal"><span class="pre">Base</span></code>&#x5728;&#x8FD9;&#x91CC;&#x6CA1;&#x6709;&#x5B9A;&#x4E49;<code class="docutils literal"><span class="pre">MyMixin</span></code>&#x5B9A;&#x4E49;&#x7684;&#x4EFB;&#x4F55;&#x53D8;&#x91CF;&#xFF0C;&#x5373;<code class="docutils literal"><span class="pre">__tablename__</span></code>&#xFF0C;<code class="docutils literal"><span class="pre">__table_args__</span></code> <code class="docutils literal"><span class="pre">id</span></code>&#x7B49;</span><span class="yiyi-st" id="yiyi-72">&#x5982;&#x679C;<code class="docutils literal"><span class="pre">Base</span></code>&#x786E;&#x5B9E;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x4E2A;&#x5177;&#x6709;&#x76F8;&#x540C;&#x540D;&#x79F0;&#x7684;&#x5C5E;&#x6027;&#xFF0C;&#x5219;&#x9996;&#x5148;&#x653E;&#x7F6E;&#x5728;&#x7EE7;&#x627F;&#x5217;&#x8868;&#x4E2D;&#x7684;&#x7C7B;&#x5C06;&#x786E;&#x5B9A;&#x5728;&#x65B0;&#x5B9A;&#x4E49;&#x7684;&#x7C7B;&#x4E0A;&#x4F7F;&#x7528;&#x54EA;&#x4E2A;&#x5C5E;&#x6027;&#x3002;</span></p><div class="section" id="augmenting-the-base"><h2><span class="yiyi-st" id="yiyi-73">&#x901A;&#x8FC7;&#x4F20;&#x53C2;&#x6765;&#x5B9A;&#x5236;&#x5316;Base&#x57FA;&#x7C7B;<a class="headerlink" href="#augmenting-the-base" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-74">&#x9664;&#x4E86;&#x4F7F;&#x7528;MixIn&#x7C7B;&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x5916;&#xFF0C;&#x4E0A;&#x6587;&#x63D0;&#x5230;&#x7684;&#x6280;&#x672F;&#x4E5F;&#x662F;&#x5B8C;&#x5168;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5230;Base&#x57FA;&#x7C7B;&#x672C;&#x8EAB;&#x7684;</span><span class="yiyi-st" id="yiyi-75">&#xFF0C;&#x5B9E;&#x73B0;&#x65B9;&#x6CD5;&#x5C31;&#x662F;&#x901A;&#x8FC7;&#x7ED9;<a class="reference internal" href="api.html#sqlalchemy.ext.declarative.declarative_base" title="sqlalchemy.ext.declarative.declarative_base"><code class="xref py py-func docutils literal"><span class="pre">declarative_base()</span></code></a> &#x53C2;&#x6570;&#x4F20;&#x4E00;&#x4E2A; <code class="docutils literal"><span class="pre">cls</span></code> &#x53C2;&#x6570;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declared_attr</span>

<span class="k">class</span> <span class="nc">Base</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">__tablename__</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">__name__</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="n">__table_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&apos;mysql_engine&apos;</span><span class="p">:</span> <span class="s1">&apos;InnoDB&apos;</span><span class="p">}</span>

    <span class="nb">id</span> <span class="o">=</span>  <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>

<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">(</span><span class="n">cls</span><span class="o">=</span><span class="n">Base</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-76">&#x5982;&#x4E0A;&#xFF0C;<code class="docutils literal"><span class="pre">MyModel</span></code>&#x4EE5;&#x53CA;&#x5176;&#x4ED6;&#x7EE7;&#x627F;&#x81EA;<code class="docutils literal"><span class="pre">Base</span></code>&#x7684;&#x5B9E;&#x4F53;&#x7C7B;&#x5C31;&#x4F1A;&#x62E5;&#x6709;&#x4ECE;&#x7C7B;&#x540D;&#xFF08;<code class="docutils literal"><span class="pre">id</span></code>&#x4E3B;&#x952E;&#x5217;&#xFF09;&#x6D3E;&#x751F;&#x7684;&#x8868;&#x540D;&#xFF0C;&#x201C;&#x5DF4;&#x62C9;&#x5DF4;&#x62C9;&#x201D;&#x7684;</span></p></div><div class="section" id="mixing-in-columns"><h2><span class="yiyi-st" id="yiyi-77">&#x5728;&#x5217;&#x4E2D;&#x6DF7;&#x5408;<a class="headerlink" href="#mixing-in-columns" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-78">&#x5728;mixin&#x4E0A;&#x6307;&#x5B9A;&#x5217;&#x7684;&#x6700;&#x57FA;&#x672C;&#x65B9;&#x6CD5;&#x662F;&#x901A;&#x8FC7;&#x7B80;&#x5355;&#x7684;&#x58F0;&#x660E;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TimestampMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">created_at</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">DateTime</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">func</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>

<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">TimestampMixin</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;test&apos;</span>

    <span class="nb">id</span> <span class="o">=</span>  <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-79">Where above, all declarative classes that include <code class="docutils literal"><span class="pre">TimestampMixin</span></code> will also have a column <code class="docutils literal"><span class="pre">created_at</span></code> that applies a timestamp to all row insertions.</span></p><p><span class="yiyi-st" id="yiyi-80">&#x719F;&#x6089;SQLAlchemy&#x8868;&#x8FBE;&#x5F0F;&#x8BED;&#x8A00;&#x7684;&#x4EBA;&#x77E5;&#x9053;id(object identity)&#x552F;&#x4E00;&#x6807;&#x8BC6;&#x4E86;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x5B9E;&#x4F8B;&#x5728;&#x4E00;&#x5F20;&#x8868;&#xFF08;schema&#xFF09;&#x4E2D;&#x7684;&#x8EAB;&#x4EFD;</span><span class="yiyi-st" id="yiyi-81">&#x4E24;&#x4E2A;<code class="docutils literal"><span class="pre">Table</span></code>&#x5BF9;&#x8C61;<code class="docutils literal"><span class="pre">a</span></code>&#x548C;<code class="docutils literal"><span class="pre">b</span></code>&#x53EF;&#x80FD;&#x90FD;&#x6709;&#x4E00;&#x4E2A;&#x540D;&#x4E3A;<code class="docutils literal"><span class="pre">id</span></code>&#x7684;&#x5217;&#xFF0C;&#x4F46;&#x8FD9;&#x4E9B;&#x533A;&#x522B;&#x7684;&#x65B9;&#x5F0F;&#x662F;<code class="docutils literal"><span class="pre">a.c.id</span></code>&#x548C;<code class="docutils literal"><span class="pre">b.c.id</span></code>&#x662F;&#x4E24;&#x4E2A;&#x4E0D;&#x540C;&#x7684;Python&#x5BF9;&#x8C61;&#xFF0C;&#x5206;&#x522B;&#x5F15;&#x7528;&#x5B83;&#x4EEC;&#x7684;&#x7236;&#x8868;<code class="docutils literal"><span class="pre">a</span></code>&#x548C;<code class="docutils literal"><span class="pre">b</span></code>&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-82">&#x5BF9;&#x4E8E;mixin&#x5217;&#xFF0C;&#x4F3C;&#x4E4E;&#x53EA;&#x6709;&#x4E00;&#x4E2A;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a>&#x5BF9;&#x8C61;&#x88AB;&#x663E;&#x5F0F;&#x521B;&#x5EFA;&#xFF0C;&#x4F46;&#x4E0A;&#x9762;&#x7684;&#x6700;&#x7EC8;<code class="docutils literal"><span class="pre">created_at</span></code>&#x5217;&#x5FC5;&#x987B;&#x4F5C;&#x4E3A;&#x6BCF;&#x4E2A;&#x72EC;&#x7ACB;&#x76EE;&#x6807;&#x7684;&#x72EC;&#x7ACB;Python&#x5BF9;&#x8C61;&#x5B58;&#x5728;&#x7C7B;&#x3002;</span><span class="yiyi-st" id="yiyi-83">&#x4E3A;&#x4E86;&#x8FBE;&#x5230;&#x8FD9;&#x4E2A;&#x76EE;&#x7684;&#xFF0C;&#x58F0;&#x660E;&#x6027;&#x6269;&#x5C55;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x88AB;&#x68C0;&#x6D4B;&#x4E3A;mixin&#x7684;&#x7C7B;&#x4E0A;&#x9047;&#x5230;&#x7684;&#x6BCF;&#x4E2A;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a>&#x5BF9;&#x8C61;&#x7684;<strong>copy</strong>&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-84">&#x6B64;&#x590D;&#x5236;&#x673A;&#x5236;&#x4EC5;&#x9650;&#x4E8E;&#x6CA1;&#x6709;&#x5916;&#x952E;&#x7684;&#x7B80;&#x5355;&#x5217;&#xFF0C;&#x56E0;&#x4E3A;<a class="reference internal" href="core_constraints.html#sqlalchemy.schema.ForeignKey" title="sqlalchemy.schema.ForeignKey"><code class="xref py py-class docutils literal"><span class="pre">ForeignKey</span></code></a>&#x672C;&#x8EAB;&#x5305;&#x542B;&#x5BF9;&#x5728;&#x6B64;&#x7EA7;&#x522B;&#x65E0;&#x6CD5;&#x6B63;&#x786E;&#x91CD;&#x65B0;&#x521B;&#x5EFA;&#x7684;&#x5217;&#x7684;&#x5F15;&#x7528;&#x3002;</span><span class="yiyi-st" id="yiyi-85">&#x5BF9;&#x4E8E;&#x5177;&#x6709;&#x5916;&#x952E;&#x7684;&#x5217;&#x4EE5;&#x53CA;&#x9700;&#x8981;&#x76EE;&#x6807;&#x663E;&#x5F0F;&#x4E0A;&#x4E0B;&#x6587;&#x7684;&#x5404;&#x79CD;&#x6620;&#x5C04;&#x7EA7;&#x6784;&#x9020;&#xFF0C;&#x63D0;&#x4F9B;&#x4E86;<a class="reference internal" href="api.html#sqlalchemy.ext.declarative.declared_attr" title="sqlalchemy.ext.declarative.declared_attr"><code class="xref py py-class docutils literal"><span class="pre">declared_attr</span></code></a>&#x4FEE;&#x9970;&#x7B26;&#xFF0C;&#x4EE5;&#x4FBF;&#x53EF;&#x4EE5;&#x5C06;&#x8BB8;&#x591A;&#x7C7B;&#x901A;&#x7528;&#x7684;&#x6A21;&#x5F0F;&#x5B9A;&#x4E49;&#x4E3A;&#x53EF;&#x8C03;&#x7528;&#x5BF9;&#x8C61;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declared_attr</span>

<span class="k">class</span> <span class="nc">ReferenceAddressMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">address_id</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;address.id&apos;</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">ReferenceAddressMixin</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;user&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-86">&#x5728;&#x4E0A;&#x9762;&#xFF0C;<code class="docutils literal"><span class="pre">address_id</span></code>&#x7C7B;&#x7EA7;&#x53EF;&#x8C03;&#x7528;&#x5728;&#x6784;&#x9020;<code class="docutils literal"><span class="pre">User</span></code>&#x7C7B;&#x7684;&#x4F4D;&#x7F6E;&#x6267;&#x884C;&#xFF0C;&#x5E76;&#x4E14;&#x58F0;&#x660E;&#x6027;&#x6269;&#x5C55;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5F97;&#x5230;&#x7684;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a></span></p><div class="versionchanged"><p><span class="yiyi-st" id="yiyi-87"><span class="versionmodified">&#x5728;&#x7248;&#x672C;0.6.5&#x4E2D;&#x66F4;&#x6539;&#xFF1A;</span>&#x5C06;<code class="docutils literal"><span class="pre">sqlalchemy.util.classproperty</span></code>&#x91CD;&#x547D;&#x540D;&#x4E3A;<a class="reference internal" href="api.html#sqlalchemy.ext.declarative.declared_attr" title="sqlalchemy.ext.declarative.declared_attr"><code class="xref py py-class docutils literal"><span class="pre">declared_attr</span></code></a>&#x3002;</span></p></div><p><span class="yiyi-st" id="yiyi-88">Columns generated by <a class="reference internal" href="api.html#sqlalchemy.ext.declarative.declared_attr" title="sqlalchemy.ext.declarative.declared_attr"><code class="xref py py-class docutils literal"><span class="pre">declared_attr</span></code></a> can also be referenced by <code class="docutils literal"><span class="pre">__mapper_args__</span></code> to a limited degree, currently by <code class="docutils literal"><span class="pre">polymorphic_on</span></code> and <code class="docutils literal"><span class="pre">version_id_col</span></code>; the declarative extension will resolve them at class construction time:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyMixin</span><span class="p">:</span>
    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">type_</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>

    <span class="n">__mapper_args__</span><span class="o">=</span> <span class="p">{</span><span class="s1">&apos;polymorphic_on&apos;</span><span class="p">:</span><span class="n">type_</span><span class="p">}</span>

<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">MyMixin</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span><span class="o">=</span><span class="s1">&apos;test&apos;</span>
    <span class="nb">id</span> <span class="o">=</span>  <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div></div></div><div class="section" id="mixing-in-relationships"><h2><span class="yiyi-st" id="yiyi-89">&#x5728;&#x5173;&#x7CFB;&#x4E2D;&#x6DF7;&#x5408;<a class="headerlink" href="#mixing-in-relationships" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-90">Relationships created by <a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a> are provided with declarative mixin classes exclusively using the <a class="reference internal" href="api.html#sqlalchemy.ext.declarative.declared_attr" title="sqlalchemy.ext.declarative.declared_attr"><code class="xref py py-class docutils literal"><span class="pre">declared_attr</span></code></a> approach, eliminating any ambiguity which could arise when copying a relationship and its possibly column-bound contents. </span><span class="yiyi-st" id="yiyi-91">&#x4E0B;&#x9762;&#x662F;&#x4E00;&#x4E2A;&#x7ED3;&#x5408;&#x5916;&#x952E;&#x5217;&#x548C;&#x5173;&#x7CFB;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x8FD9;&#x6837;&#x4E24;&#x4E2A;&#x7C7B;<code class="docutils literal"><span class="pre">Foo</span></code>&#x548C;<code class="docutils literal"><span class="pre">Bar</span></code>&#x90FD;&#x53EF;&#x4EE5;&#x914D;&#x7F6E;&#x4E3A;&#x901A;&#x8FC7;&#x591A;&#x5BF9;&#x4E00;&#x5F15;&#x7528;&#x5171;&#x540C;&#x7684;&#x76EE;&#x6807;&#x7C7B;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">RefTargetMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">target_id</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;target_id&apos;</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;target.id&apos;</span><span class="p">))</span>

    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">target</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Target&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="n">RefTargetMixin</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;foo&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Bar</span><span class="p">(</span><span class="n">RefTargetMixin</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;bar&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Target</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;target&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div></div><div class="section" id="using-advanced-relationship-arguments-e-g-primaryjoin-etc"><h3><span class="yiyi-st" id="yiyi-92">&#x4F7F;&#x7528;&#x9AD8;&#x7EA7;&#x5173;&#x7CFB;&#x53C2;&#x6570;&#xFF08;&#x4F8B;&#x5982;<code class="docutils literal"><span class="pre">primaryjoin</span></code>&#x7B49;&#xFF09;<a class="headerlink" href="#using-advanced-relationship-arguments-e-g-primaryjoin-etc" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-93"><a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#x5B9A;&#x4E49;&#x9700;&#x8981;&#x663E;&#x5F0F;&#x7684;&#x4E3B;&#x8981;&#x8FDE;&#x63A5;&#xFF0C;order_by&#x7B49;</span><span class="yiyi-st" id="yiyi-94">&#x9664;&#x4E86;&#x6700;&#x7B80;&#x5355;&#x7684;&#x60C5;&#x51B5;&#x5916;&#xFF0C;&#x6240;&#x6709;&#x8868;&#x8FBE;&#x5F0F;&#x90FD;&#x5E94;&#x8BE5;&#x4F7F;&#x7528;<strong>&#x540E;&#x7F00;</strong>&#x5F62;&#x5F0F;&#x8868;&#x793A;&#x8FD9;&#x4E9B;&#x53C2;&#x6570;&#xFF0C;&#x5373;&#x4F7F;&#x7528;&#x5B57;&#x7B26;&#x4E32;&#x5F62;&#x5F0F;&#x6216;lambda&#x8868;&#x8FBE;&#x5F0F;&#x3002;</span><span class="yiyi-st" id="yiyi-95">&#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#x8981;&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">@declared_attr</span></code>&#x914D;&#x7F6E;&#x7684;&#x76F8;&#x5173;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a>&#x5BF9;&#x8C61;&#x4E0D;&#x53EF;&#x7528;&#x4E8E;&#x5176;&#x4ED6;<code class="docutils literal"><span class="pre">@declared_attr</span></code>&#x5C5E;&#x6027;&#xFF1B;&#x867D;&#x7136;&#x8FD9;&#x4E9B;&#x65B9;&#x6CD5;&#x5C06;&#x5DE5;&#x4F5C;&#x5E76;&#x8FD4;&#x56DE;&#x65B0;&#x7684;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a>&#x5BF9;&#x8C61;&#xFF0C;&#x4F46;&#x8FD9;&#x4E9B;&#x5BF9;&#x8C61;&#x5E76;&#x4E0D;&#x662F;Declarative&#x5C06;&#x5728;&#x4F7F;&#x7528;&#x5B83;&#x81EA;&#x5DF1;&#x8C03;&#x7528;&#x65B9;&#x6CD5;&#x65F6;&#x4F7F;&#x7528;&#x7684;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a>&#x5BF9;&#x8C61;&#xFF0C;&#x56E0;&#x6B64;&#x4F7F;&#x7528;<em>&#x4E0D;&#x540C;&#x7684;</em> <a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a>&#x5BF9;&#x8C61;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-96">&#x89C4;&#x8303;&#x7684;&#x4F8B;&#x5B50;&#x662F;&#x4F9D;&#x8D56;&#x4E8E;&#x53E6;&#x4E00;&#x4E2A;&#x6DF7;&#x5408;&#x5217;&#x7684;&#x4E3B;&#x8FDE;&#x63A5;&#x6761;&#x4EF6;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">RefTargetMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">target_id</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;target_id&apos;</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;target.id&apos;</span><span class="p">))</span>

    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">target</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">relationship</span><span class="p">(</span><span class="n">Target</span><span class="p">,</span>
            <span class="n">primaryjoin</span><span class="o">=</span><span class="n">Target</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="n">cls</span><span class="o">.</span><span class="n">target_id</span>   <span class="c1"># this is *incorrect*</span>
        <span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-97">&#x4F7F;&#x7528;&#x4E0A;&#x9762;&#x7684;mixin&#x6620;&#x5C04;&#x4E00;&#x4E2A;&#x7C7B;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x5F97;&#x5230;&#x5982;&#x4E0B;&#x9519;&#x8BEF;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>sqlalchemy.exc.InvalidRequestError: this ForeignKey&apos;s parent column is not
yet associated with a Table.</pre></div></div><p><span class="yiyi-st" id="yiyi-98">&#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x5728;<code class="docutils literal"><span class="pre">target()</span></code>&#x65B9;&#x6CD5;&#x4E2D;&#x8C03;&#x7528;&#x7684;<code class="docutils literal"><span class="pre">target_id</span></code> <a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a>&#x4E0E;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a>&#x8BE5;&#x58F0;&#x660E;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x8981;&#x6620;&#x5C04;&#x5230;&#x6211;&#x4EEC;&#x7684;&#x8868;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-99">&#x4E0A;&#x9762;&#x7684;&#x6761;&#x4EF6;&#x4F7F;&#x7528;lambda&#x6765;&#x89E3;&#x51B3;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">RefTargetMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">target_id</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;target_id&apos;</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;target.id&apos;</span><span class="p">))</span>

    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">target</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">relationship</span><span class="p">(</span><span class="n">Target</span><span class="p">,</span>
            <span class="n">primaryjoin</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">Target</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="n">cls</span><span class="o">.</span><span class="n">target_id</span>
        <span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-100">&#x6216;&#x8005;&#x53EF;&#x9009;&#x5730;&#xFF0C;&#x5B57;&#x7B26;&#x4E32;&#x5F62;&#x5F0F;&#xFF08;&#x5176;&#x6700;&#x7EC8;&#x751F;&#x6210;&#x62C9;&#x59C6;&#x8FBE;&#xFF09;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">RefTargetMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">target_id</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;target_id&apos;</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;target.id&apos;</span><span class="p">))</span>

    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">target</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Target&quot;</span><span class="p">,</span>
            <span class="n">primaryjoin</span><span class="o">=</span><span class="s2">&quot;Target.id==</span><span class="si">%s</span><span class="s2">.target_id&quot;</span> <span class="o">%</span> <span class="n">cls</span><span class="o">.</span><span class="n">__name__</span>
        <span class="p">)</span></pre></div></div></div></div><div class="section" id="mixing-in-deferred-column-property-and-other-mapperproperty-classes"><h2><span class="yiyi-st" id="yiyi-101">&#x5728;deferred()&#xFF0C;column_property()&#x548C;&#x5176;&#x4ED6;MapperProperty&#x7C7B;&#x4E2D;&#x6DF7;&#x5408;<a class="headerlink" href="#mixing-in-deferred-column-property-and-other-mapperproperty-classes" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-102">Like <a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>, all <a class="reference internal" href="internals.html#sqlalchemy.orm.interfaces.MapperProperty" title="sqlalchemy.orm.interfaces.MapperProperty"><code class="xref py py-class docutils literal"><span class="pre">MapperProperty</span></code></a> subclasses such as <a class="reference internal" href="loading_columns.html#sqlalchemy.orm.deferred" title="sqlalchemy.orm.deferred"><code class="xref py py-func docutils literal"><span class="pre">deferred()</span></code></a>, <a class="reference internal" href="mapping_columns.html#sqlalchemy.orm.column_property" title="sqlalchemy.orm.column_property"><code class="xref py py-func docutils literal"><span class="pre">column_property()</span></code></a>, etc. </span><span class="yiyi-st" id="yiyi-103">&#x6700;&#x7EC8;&#x6D89;&#x53CA;&#x5BF9;&#x5217;&#x7684;&#x5F15;&#x7528;&#xFF0C;&#x56E0;&#x6B64;&#x5728;&#x4E0E;&#x58F0;&#x660E;&#x6027;mixin&#x4E00;&#x8D77;&#x4F7F;&#x7528;&#x65F6;&#xFF0C;&#x5FC5;&#x987B;&#x5177;&#x6709;<a class="reference internal" href="api.html#sqlalchemy.ext.declarative.declared_attr" title="sqlalchemy.ext.declarative.declared_attr"><code class="xref py py-class docutils literal"><span class="pre">declared_attr</span></code></a>&#x8981;&#x6C42;&#xFF0C;&#x4EE5;&#x4FBF;&#x4E0D;&#x9700;&#x8981;&#x4F9D;&#x8D56;&#x590D;&#x5236;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SomethingMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">dprop</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">deferred</span><span class="p">(</span><span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">Something</span><span class="p">(</span><span class="n">SomethingMixin</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;something&quot;</span></pre></div></div><p><span class="yiyi-st" id="yiyi-104"><a class="reference internal" href="mapping_columns.html#sqlalchemy.orm.column_property" title="sqlalchemy.orm.column_property"><code class="xref py py-func docutils literal"><span class="pre">column_property()</span></code></a>&#x6216;&#x5176;&#x4ED6;&#x6784;&#x9020;&#x53EF;&#x4EE5;&#x5F15;&#x7528;&#x6765;&#x81EA;mixin&#x7684;&#x5176;&#x4ED6;&#x5217;&#x3002;</span><span class="yiyi-st" id="yiyi-105">&#x5728;<a class="reference internal" href="api.html#sqlalchemy.ext.declarative.declared_attr" title="sqlalchemy.ext.declarative.declared_attr"><code class="xref py py-class docutils literal"><span class="pre">declared_attr</span></code></a>&#x88AB;&#x8C03;&#x7528;&#x4E4B;&#x524D;&#xFF0C;&#x5B83;&#x4EEC;&#x88AB;&#x63D0;&#x524D;&#x590D;&#x5236;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SomethingMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">)</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">)</span>

    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">x_plus_y</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">column_property</span><span class="p">(</span><span class="n">cls</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">cls</span><span class="o">.</span><span class="n">y</span><span class="p">)</span></pre></div></div><div class="versionchanged"><p><span class="yiyi-st" id="yiyi-106"><span class="versionmodified">&#x7248;&#x672C;1.0.0&#x4E2D;&#x5DF2;&#x66F4;&#x6539;&#xFF1A;</span>&#x5C06;mixin&#x5217;&#x590D;&#x5236;&#x5230;&#x6700;&#x7EC8;&#x6620;&#x5C04;&#x7C7B;&#xFF0C;&#x4EE5;&#x4FBF;<a class="reference internal" href="api.html#sqlalchemy.ext.declarative.declared_attr" title="sqlalchemy.ext.declarative.declared_attr"><code class="xref py py-class docutils literal"><span class="pre">declared_attr</span></code></a>&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x5C06;&#x8981;&#x6620;&#x5C04;&#x7684;&#x5B9E;&#x9645;&#x5217;&#x3002;</span></p></div></div><div class="section" id="mixing-in-association-proxy-and-other-attributes"><h2><span class="yiyi-st" id="yiyi-107">&#x5728;&#x5173;&#x8054;&#x4EE3;&#x7406;&#x548C;&#x5176;&#x4ED6;&#x5C5E;&#x6027;&#x4E2D;&#x6DF7;&#x5408;<a class="headerlink" href="#mixing-in-association-proxy-and-other-attributes" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-108">Mixins&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x7528;&#x6237;&#x5B9A;&#x4E49;&#x7684;&#x5C5E;&#x6027;&#x4EE5;&#x53CA;&#x5176;&#x4ED6;&#x6269;&#x5C55;&#x5355;&#x5143;&#xFF0C;&#x5982;<a class="reference internal" href="associationproxy.html#sqlalchemy.ext.associationproxy.association_proxy" title="sqlalchemy.ext.associationproxy.association_proxy"><code class="xref py py-func docutils literal"><span class="pre">association_proxy()</span></code></a>&#x3002;</span><span class="yiyi-st" id="yiyi-109">&#x5728;&#x5C5E;&#x6027;&#x5FC5;&#x987B;&#x4E13;&#x95E8;&#x9488;&#x5BF9;&#x76EE;&#x6807;&#x5B50;&#x7C7B;&#x5B9A;&#x5236;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;<a class="reference internal" href="api.html#sqlalchemy.ext.declarative.declared_attr" title="sqlalchemy.ext.declarative.declared_attr"><code class="xref py py-class docutils literal"><span class="pre">declared_attr</span></code></a>&#x7684;&#x7528;&#x6CD5;&#x662F;&#x5FC5;&#x9700;&#x7684;&#x3002;</span><span class="yiyi-st" id="yiyi-110">&#x4E00;&#x4E2A;&#x793A;&#x4F8B;&#x662F;&#x6784;&#x5EFA;&#x591A;&#x4E2A;<a class="reference internal" href="associationproxy.html#sqlalchemy.ext.associationproxy.association_proxy" title="sqlalchemy.ext.associationproxy.association_proxy"><code class="xref py py-func docutils literal"><span class="pre">association_proxy()</span></code></a>&#x5C5E;&#x6027;&#xFF0C;&#x6BCF;&#x4E2A;&#x5C5E;&#x6027;&#x90FD;&#x9488;&#x5BF9;&#x4E0D;&#x540C;&#x7C7B;&#x578B;&#x7684;&#x5B50;&#x5BF9;&#x8C61;&#x3002;</span><span class="yiyi-st" id="yiyi-111">&#x4E0B;&#x9762;&#x662F;&#x4E00;&#x4E2A;<a class="reference internal" href="associationproxy.html#sqlalchemy.ext.associationproxy.association_proxy" title="sqlalchemy.ext.associationproxy.association_proxy"><code class="xref py py-func docutils literal"><span class="pre">association_proxy()</span></code></a> / mixin&#x793A;&#x4F8B;&#xFF0C;&#x5B83;&#x4E3A;&#x5B9E;&#x73B0;&#x7C7B;&#x63D0;&#x4F9B;&#x4E86;&#x5B57;&#x7B26;&#x4E32;&#x503C;&#x7684;&#x6807;&#x91CF;&#x5217;&#x8868;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">,</span> <span class="n">String</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">relationship</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.associationproxy</span> <span class="kn">import</span> <span class="n">association_proxy</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span><span class="p">,</span> <span class="n">declared_attr</span>

<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">HasStringCollection</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">_strings</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">StringAttribute</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
            <span class="n">__tablename__</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">string_table_name</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">parent_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span>
                            <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;</span><span class="si">%s</span><span class="s1">.id&apos;</span> <span class="o">%</span> <span class="n">cls</span><span class="o">.</span><span class="n">__tablename__</span><span class="p">),</span>
                            <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">return</span> <span class="n">relationship</span><span class="p">(</span><span class="n">StringAttribute</span><span class="p">)</span>

    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">strings</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">association_proxy</span><span class="p">(</span><span class="s1">&apos;_strings&apos;</span><span class="p">,</span> <span class="s1">&apos;value&apos;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">TypeA</span><span class="p">(</span><span class="n">HasStringCollection</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;type_a&apos;</span>
    <span class="n">string_table_name</span> <span class="o">=</span> <span class="s1">&apos;type_a_strings&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">(),</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">TypeB</span><span class="p">(</span><span class="n">HasStringCollection</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;type_b&apos;</span>
    <span class="n">string_table_name</span> <span class="o">=</span> <span class="s1">&apos;type_b_strings&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">(),</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-112">&#x5728;&#x4E0A;&#x9762;&#xFF0C;<code class="docutils literal"><span class="pre">HasStringCollection</span></code> mixin&#x4EA7;&#x751F;&#x4E86;&#x4E00;&#x4E2A;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#xFF0C;&#x5B83;&#x5F15;&#x7528;&#x4E86;&#x4E00;&#x4E2A;&#x65B0;&#x751F;&#x6210;&#x7684;&#x540D;&#x4E3A;<code class="docutils literal"><span class="pre">StringAttribute</span></code>&#x7684;&#x7C7B;&#x3002;</span><span class="yiyi-st" id="yiyi-113"><code class="docutils literal"><span class="pre">StringAttribute</span></code>&#x7C7B;&#x4F7F;&#x7528;&#x81EA;&#x5DF1;&#x7684;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal"><span class="pre">Table</span></code></a>&#x5B9A;&#x4E49;&#x751F;&#x6210;&#xFF0C;&#x8BE5;&#x5B9A;&#x4E49;&#x5BF9;&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">HasStringCollection</span></code> mixin&#x7684;&#x7236;&#x7C7B;&#x662F;&#x672C;&#x5730;&#x7684;&#x3002;</span><span class="yiyi-st" id="yiyi-114">&#x5B83;&#x8FD8;&#x751F;&#x6210;&#x4E00;&#x4E2A;<a class="reference internal" href="associationproxy.html#sqlalchemy.ext.associationproxy.association_proxy" title="sqlalchemy.ext.associationproxy.association_proxy"><code class="xref py py-func docutils literal"><span class="pre">association_proxy()</span></code></a>&#x5BF9;&#x8C61;&#xFF0C;&#x8BE5;&#x5BF9;&#x8C61;&#x5C06;&#x5BF9;<code class="docutils literal"><span class="pre">strings</span></code>&#x5C5E;&#x6027;&#x7684;&#x5F15;&#x7528;&#x4EE3;&#x7406;&#x5230;&#x6BCF;&#x4E2A;<code class="docutils literal"><span class="pre">StringAttribute</span></code>&#x7684;<code class="docutils literal"><span class="pre">value</span></code>&#x5B9E;&#x4F8B;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-115"><code class="docutils literal"><span class="pre">TypeA</span></code> or <code class="docutils literal"><span class="pre">TypeB</span></code> can be instantiated given the constructor argument <code class="docutils literal"><span class="pre">strings</span></code>, a list of strings:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">ta</span> <span class="o">=</span> <span class="n">TypeA</span><span class="p">(</span><span class="n">strings</span><span class="o">=</span><span class="p">[</span><span class="s1">&apos;foo&apos;</span><span class="p">,</span> <span class="s1">&apos;bar&apos;</span><span class="p">])</span>
<span class="n">tb</span> <span class="o">=</span> <span class="n">TypeA</span><span class="p">(</span><span class="n">strings</span><span class="o">=</span><span class="p">[</span><span class="s1">&apos;bat&apos;</span><span class="p">,</span> <span class="s1">&apos;bar&apos;</span><span class="p">])</span></pre></div></div><p><span class="yiyi-st" id="yiyi-116">&#x8BE5;&#x5217;&#x8868;&#x5C06;&#x751F;&#x6210;<code class="docutils literal"><span class="pre">StringAttribute</span></code>&#x5BF9;&#x8C61;&#x7684;&#x96C6;&#x5408;&#xFF0C;&#x8BE5;&#x5BF9;&#x8C61;&#x4FDD;&#x5B58;&#x5230;<code class="docutils literal"><span class="pre">type_a_strings</span></code>&#x6216;<code class="docutils literal"><span class="pre">type_b_strings</span></code>&#x8868;&#x7684;&#x672C;&#x5730;&#x8868;&#x4E2D;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">ta</span><span class="o">.</span><span class="n">_strings</span><span class="p">)</span>
<span class="go">[&lt;__main__.StringAttribute object at 0x10151cd90&gt;,</span>
<span class="go">    &lt;__main__.StringAttribute object at 0x10151ce10&gt;]</span></pre></div></div><p><span class="yiyi-st" id="yiyi-117">When constructing the <a class="reference internal" href="associationproxy.html#sqlalchemy.ext.associationproxy.association_proxy" title="sqlalchemy.ext.associationproxy.association_proxy"><code class="xref py py-func docutils literal"><span class="pre">association_proxy()</span></code></a>, the <a class="reference internal" href="api.html#sqlalchemy.ext.declarative.declared_attr" title="sqlalchemy.ext.declarative.declared_attr"><code class="xref py py-class docutils literal"><span class="pre">declared_attr</span></code></a> decorator must be used so that a distinct <a class="reference internal" href="associationproxy.html#sqlalchemy.ext.associationproxy.association_proxy" title="sqlalchemy.ext.associationproxy.association_proxy"><code class="xref py py-func docutils literal"><span class="pre">association_proxy()</span></code></a> object is created for each of the <code class="docutils literal"><span class="pre">TypeA</span></code> and <code class="docutils literal"><span class="pre">TypeB</span></code> classes.</span></p><div class="versionadded"><p><span class="yiyi-st" id="yiyi-118"><span class="versionmodified">&#x7248;&#x672C;0.8&#x4E2D;&#x7684;&#x65B0;&#x529F;&#x80FD;</span> <a class="reference internal" href="api.html#sqlalchemy.ext.declarative.declared_attr" title="sqlalchemy.ext.declarative.declared_attr"><code class="xref py py-class docutils literal"><span class="pre">declared_attr</span></code></a>&#x53EF;&#x7528;&#x4E8E;&#x975E;&#x6620;&#x5C04;&#x5C5E;&#x6027;&#xFF0C;&#x5305;&#x62EC;&#x7528;&#x6237;&#x5B9A;&#x4E49;&#x7684;&#x5C5E;&#x6027;&#x4EE5;&#x53CA;<a class="reference internal" href="associationproxy.html#sqlalchemy.ext.associationproxy.association_proxy" title="sqlalchemy.ext.associationproxy.association_proxy"><code class="xref py py-func docutils literal"><span class="pre">association_proxy()</span></code></a>&#x3002;</span></p></div></div><div class="section" id="controlling-table-inheritance-with-mixins"><h2><span class="yiyi-st" id="yiyi-119">&#x901A;&#x8FC7;mixins&#x63A7;&#x5236;&#x8868;&#x7EE7;&#x627F;<a class="headerlink" href="#controlling-table-inheritance-with-mixins" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-120"><code class="docutils literal"><span class="pre">__tablename__</span></code>&#x5C5E;&#x6027;&#x53EF;&#x7528;&#x4E8E;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x8BE5;&#x51FD;&#x6570;&#x5C06;&#x786E;&#x5B9A;&#x7EE7;&#x627F;&#x5C42;&#x6B21;&#x7ED3;&#x6784;&#x4E2D;&#x6BCF;&#x4E2A;&#x7C7B;&#x6240;&#x7528;&#x8868;&#x7684;&#x540D;&#x79F0;&#xFF0C;&#x4EE5;&#x53CA;&#x67D0;&#x4E2A;&#x7C7B;&#x662F;&#x5426;&#x5177;&#x6709;&#x5176;&#x81EA;&#x5DF1;&#x7684;&#x4E0D;&#x540C;&#x8868;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-121">&#x8FD9;&#x662F;&#x901A;&#x8FC7;&#x4F7F;&#x7528;<a class="reference internal" href="api.html#sqlalchemy.ext.declarative.declared_attr" title="sqlalchemy.ext.declarative.declared_attr"><code class="xref py py-class docutils literal"><span class="pre">declared_attr</span></code></a>&#x6307;&#x6807;&#x548C;&#x540D;&#x4E3A;<code class="docutils literal"><span class="pre">__tablename__()</span></code>&#x7684;&#x65B9;&#x6CD5;&#x5B9E;&#x73B0;&#x7684;&#x3002;</span><span class="yiyi-st" id="yiyi-122">&#x5BF9;&#x4E8E;&#x6BCF;&#x4E2A;&#x6620;&#x5C04;&#x7684;&#x7C7B;&#xFF0C;&#x58F0;&#x660E;&#x5F0F;&#x5C06;&#x59CB;&#x7EC8;&#x4E3A;&#x7279;&#x6B8A;&#x540D;&#x79F0;<code class="docutils literal"><span class="pre">__tablename__</span></code>&#xFF0C;<code class="docutils literal"><span class="pre">__mapper_args__</span></code>&#x548C;<code class="docutils literal"><span class="pre">__table_args__</span></code>&#x51FD;&#x6570;<strong>&#x8C03;&#x7528;<a class="reference internal" href="api.html#sqlalchemy.ext.declarative.declared_attr" title="sqlalchemy.ext.declarative.declared_attr"><code class="xref py py-class docutils literal"><span class="pre">declared_attr</span></code></a>&#x5728;&#x5C42;&#x6B21;&#x7ED3;&#x6784;</strong>&#x4E2D;&#x3002;</span><span class="yiyi-st" id="yiyi-123">&#x56E0;&#x6B64;&#xFF0C;&#x8BE5;&#x529F;&#x80FD;&#x9700;&#x8981;&#x5355;&#x72EC;&#x63A5;&#x6536;&#x6BCF;&#x4E2A;&#x73ED;&#x7EA7;&#xFF0C;&#x5E76;&#x4E3A;&#x6BCF;&#x4E2A;&#x73ED;&#x7EA7;&#x63D0;&#x4F9B;&#x6B63;&#x786E;&#x7684;&#x7B54;&#x6848;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-124">&#x4F8B;&#x5982;&#xFF0C;&#x8981;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;mixin&#xFF0C;&#x4E3A;&#x6BCF;&#x4E2A;&#x7C7B;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x57FA;&#x4E8E;&#x7C7B;&#x540D;&#x7684;&#x7B80;&#x5355;&#x8868;&#x540D;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declared_attr</span>

<span class="k">class</span> <span class="nc">Tablename</span><span class="p">:</span>
    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">__tablename__</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">__name__</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">Tablename</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">discriminator</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;type&apos;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&apos;polymorphic_on&apos;</span><span class="p">:</span> <span class="n">discriminator</span><span class="p">}</span>

<span class="k">class</span> <span class="nc">Engineer</span><span class="p">(</span><span class="n">Person</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&apos;polymorphic_identity&apos;</span><span class="p">:</span> <span class="s1">&apos;engineer&apos;</span><span class="p">}</span>
    <span class="n">primary_language</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-125">&#x6216;&#x8005;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<a class="reference internal" href="api.html#sqlalchemy.ext.declarative.has_inherited_table" title="sqlalchemy.ext.declarative.has_inherited_table"><code class="xref py py-func docutils literal"><span class="pre">has_inherited_table()</span></code></a>&#x4FEE;&#x6539;&#x6211;&#x4EEC;&#x7684;<code class="docutils literal"><span class="pre">__tablename__</span></code>&#x51FD;&#x6570;&#x4E3A;&#x5B50;&#x7C7B;&#x8FD4;&#x56DE;<code class="docutils literal"><span class="pre">None</span></code>&#x3002;</span><span class="yiyi-st" id="yiyi-126">&#x8FD9;&#x5177;&#x6709;&#x5C06;&#x8FD9;&#x4E9B;&#x5B50;&#x7C7B;&#x6620;&#x5C04;&#x4E3A;&#x7236;&#x8868;&#x5355;&#x7EE7;&#x627F;&#x7684;&#x6548;&#x679C;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declared_attr</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">has_inherited_table</span>

<span class="k">class</span> <span class="nc">Tablename</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">__tablename__</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">has_inherited_table</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">__name__</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">Tablename</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">discriminator</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;type&apos;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&apos;polymorphic_on&apos;</span><span class="p">:</span> <span class="n">discriminator</span><span class="p">}</span>

<span class="k">class</span> <span class="nc">Engineer</span><span class="p">(</span><span class="n">Person</span><span class="p">):</span>
    <span class="n">primary_language</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&apos;polymorphic_identity&apos;</span><span class="p">:</span> <span class="s1">&apos;engineer&apos;</span><span class="p">}</span></pre></div></div></div><div class="section" id="mixing-in-columns-in-inheritance-scenarios"><h2><span class="yiyi-st" id="yiyi-127">&#x5728;&#x7EE7;&#x627F;&#x65B9;&#x6848;&#x4E2D;&#x7684;&#x5217;&#x4E2D;&#x6DF7;&#x5408;<a class="headerlink" href="#mixing-in-columns-in-inheritance-scenarios" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-128">&#x4E0E;<a class="reference internal" href="api.html#sqlalchemy.ext.declarative.declared_attr" title="sqlalchemy.ext.declarative.declared_attr"><code class="xref py py-class docutils literal"><span class="pre">declared_attr</span></code></a>&#x7ED3;&#x5408;&#x4F7F;&#x7528;&#x65F6;&#xFF0C;&#x5982;&#x4F55;&#x5904;&#x7406;<code class="docutils literal"><span class="pre">__tablename__</span></code>&#x548C;&#x5176;&#x4ED6;&#x7279;&#x6B8A;&#x540D;&#x79F0;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x6DF7;&#x5408;&#x4F7F;&#x7528;&#x5217;&#x548C;&#x5C5E;&#x6027;&#x65F6;&#xFF08;&#x4F8B;&#x5982;&#x5173;&#x7CFB;&#xFF0C;&#x5217;&#x5C5E;&#x6027;&#x7B49;&#xFF09;</span><span class="yiyi-st" id="yiyi-129">&#xFF09;&#xFF0C;&#x8BE5;&#x51FD;&#x6570;&#x4EC5;&#x9488;&#x5BF9;&#x5C42;&#x6B21;&#x7ED3;&#x6784;&#x4E2D;&#x7684;<strong>&#x57FA;&#x7C7B;</strong>&#x8C03;&#x7528;&#x3002;</span><span class="yiyi-st" id="yiyi-130">&#x4E0B;&#x9762;&#xFF0C;&#x53EA;&#x6709;<code class="docutils literal"><span class="pre">Person</span></code>&#x7C7B;&#x4F1A;&#x6536;&#x5230;&#x4E00;&#x4E2A;&#x540D;&#x4E3A;<code class="docutils literal"><span class="pre">id</span></code>&#x7684;&#x5217;&#x3002; <code class="docutils literal"><span class="pre">Engineer</span></code>&#x4E2D;&#x7684;&#x6620;&#x5C04;&#x5C06;&#x5931;&#x8D25;&#xFF0C;&#x8BE5;&#x5DE5;&#x7A0B;&#x6CA1;&#x6709;&#x7ED9;&#x51FA;&#x4E3B;&#x952E;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">HasId</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">id</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;id&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">HasId</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;person&apos;</span>
    <span class="n">discriminator</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;type&apos;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&apos;polymorphic_on&apos;</span><span class="p">:</span> <span class="n">discriminator</span><span class="p">}</span>

<span class="k">class</span> <span class="nc">Engineer</span><span class="p">(</span><span class="n">Person</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;engineer&apos;</span>
    <span class="n">primary_language</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&apos;polymorphic_identity&apos;</span><span class="p">:</span> <span class="s1">&apos;engineer&apos;</span><span class="p">}</span></pre></div></div><p><span class="yiyi-st" id="yiyi-131">&#x5728;&#x8FDE;&#x63A5;&#x8868;&#x7EE7;&#x627F;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x5E38;&#x5E0C;&#x671B;&#x6BCF;&#x4E2A;&#x5B50;&#x7C7B;&#x90FD;&#x6709;&#x660E;&#x786E;&#x547D;&#x540D;&#x7684;&#x5217;&#x3002;</span><span class="yiyi-st" id="yiyi-132">&#x4F46;&#x662F;&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x80FD;&#x5E0C;&#x671B;&#x5728;&#x6BCF;&#x4E2A;&#x8868;&#x4E0A;&#x90FD;&#x6709;&#x4E00;&#x4E2A;<code class="docutils literal"><span class="pre">id</span></code>&#x5217;&#xFF0C;&#x5E76;&#x8BA9;&#x5B83;&#x4EEC;&#x901A;&#x8FC7;&#x5916;&#x952E;&#x76F8;&#x4E92;&#x5F15;&#x7528;&#x3002;</span><span class="yiyi-st" id="yiyi-133">We can achieve this as a mixin by using the <a class="reference internal" href="api.html#sqlalchemy.ext.declarative.declared_attr.cascading" title="sqlalchemy.ext.declarative.declared_attr.cascading"><code class="xref py py-attr docutils literal"><span class="pre">declared_attr.cascading</span></code></a> modifier, which indicates that the function should be invoked <strong>for each class in the hierarchy</strong>, just like it does for <code class="docutils literal"><span class="pre">__tablename__</span></code>:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">HasId</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="nd">@declared_attr.cascading</span>
    <span class="k">def</span> <span class="nf">id</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">has_inherited_table</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;id&apos;</span><span class="p">,</span>
                          <span class="n">Integer</span><span class="p">,</span>
                          <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;person.id&apos;</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;id&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">HasId</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;person&apos;</span>
    <span class="n">discriminator</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;type&apos;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&apos;polymorphic_on&apos;</span><span class="p">:</span> <span class="n">discriminator</span><span class="p">}</span>

<span class="k">class</span> <span class="nc">Engineer</span><span class="p">(</span><span class="n">Person</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;engineer&apos;</span>
    <span class="n">primary_language</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&apos;polymorphic_identity&apos;</span><span class="p">:</span> <span class="s1">&apos;engineer&apos;</span><span class="p">}</span></pre></div></div><div class="versionadded"><p><span class="yiyi-st" id="yiyi-134"><span class="versionmodified">&#x7248;&#x672C;1.0.0&#x65B0;&#x589E;&#xFF1A;</span>&#x65B0;&#x589E;<a class="reference internal" href="api.html#sqlalchemy.ext.declarative.declared_attr.cascading" title="sqlalchemy.ext.declarative.declared_attr.cascading"><code class="xref py py-attr docutils literal"><span class="pre">declared_attr.cascading</span></code></a>&#x3002;</span></p></div></div><div class="section" id="combining-table-mapper-arguments-from-multiple-mixins"><h2><span class="yiyi-st" id="yiyi-135">&#x7ED3;&#x5408;&#x6765;&#x81EA;&#x591A;&#x4E2A;Mixin&#x7684;Table / Mapper&#x53C2;&#x6570;<a class="headerlink" href="#combining-table-mapper-arguments-from-multiple-mixins" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-136">&#x5728;&#x58F0;&#x660E;&#x6027;mixin&#x6307;&#x5B9A;&#x7684;<code class="docutils literal"><span class="pre">__table_args__</span></code>&#x6216;<code class="docutils literal"><span class="pre">__mapper_args__</span></code>&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x60A8;&#x53EF;&#x80FD;&#x5E0C;&#x671B;&#x5C06;&#x51E0;&#x4E2A;mixin&#x7684;&#x4E00;&#x4E9B;&#x53C2;&#x6570;&#x4E0E;&#x60A8;&#x5E0C;&#x671B;&#x5728;&#x7C7B;iteself&#x4E0A;&#x5B9A;&#x4E49;&#x7684;&#x53C2;&#x6570;&#x7ED3;&#x5408;&#x8D77;&#x6765;&#x3002;</span><span class="yiyi-st" id="yiyi-137">&#x8FD9;&#x91CC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<a class="reference internal" href="api.html#sqlalchemy.ext.declarative.declared_attr" title="sqlalchemy.ext.declarative.declared_attr"><code class="xref py py-class docutils literal"><span class="pre">declared_attr</span></code></a>&#x88C5;&#x9970;&#x5668;&#x6765;&#x521B;&#x5EFA;&#x4ECE;&#x591A;&#x4E2A;&#x96C6;&#x5408;&#x4E2D;&#x62BD;&#x53D6;&#x7684;&#x7528;&#x6237;&#x5B9A;&#x4E49;&#x7684;&#x6574;&#x7406;&#x4F8B;&#x7A0B;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declared_attr</span>

<span class="k">class</span> <span class="nc">MySQLSettings</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">__table_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&apos;mysql_engine&apos;</span><span class="p">:</span><span class="s1">&apos;InnoDB&apos;</span><span class="p">}</span>

<span class="k">class</span> <span class="nc">MyOtherMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">__table_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&apos;info&apos;</span><span class="p">:</span><span class="s1">&apos;foo&apos;</span><span class="p">}</span>

<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">MySQLSettings</span><span class="p">,</span> <span class="n">MyOtherMixin</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span><span class="o">=</span><span class="s1">&apos;my_model&apos;</span>

    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">__table_args__</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">MySQLSettings</span><span class="o">.</span><span class="n">__table_args__</span><span class="p">)</span>
        <span class="n">args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">MyOtherMixin</span><span class="o">.</span><span class="n">__table_args__</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">args</span>

    <span class="nb">id</span> <span class="o">=</span>  <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div></div></div><div class="section" id="creating-indexes-with-mixins"><h2><span class="yiyi-st" id="yiyi-138">&#x7528;Mixins&#x521B;&#x5EFA;&#x7D22;&#x5F15;<a class="headerlink" href="#creating-indexes-with-mixins" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-139">&#x8981;&#x5B9A;&#x4E49;&#x9002;&#x7528;&#x4E8E;&#x4ECE;mixin&#x6D3E;&#x751F;&#x7684;&#x6240;&#x6709;&#x8868;&#x7684;&#x547D;&#x540D;&#x7684;&#x53EF;&#x80FD;&#x591A;&#x5217;<a class="reference internal" href="core_constraints.html#sqlalchemy.schema.Index" title="sqlalchemy.schema.Index"><code class="xref py py-class docutils literal"><span class="pre">Index</span></code></a>&#xFF0C;&#x8BF7;&#x4F7F;&#x7528;<a class="reference internal" href="core_constraints.html#sqlalchemy.schema.Index" title="sqlalchemy.schema.Index"><code class="xref py py-class docutils literal"><span class="pre">Index</span></code></a>&#x7684;&#x201C;inline&#x201D;&#x5F62;&#x5F0F;&#xFF0C;&#x5E76;&#x5C06;&#x5B83;&#x5EFA;&#x7ACB;&#x4E3A;<code class="docutils literal"><span class="pre">__table_args__</span></code></span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span>  <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span>  <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">)</span>

    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">__table_args__</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">Index</span><span class="p">(</span><span class="s1">&apos;test_idx_</span><span class="si">%s</span><span class="s1">&apos;</span> <span class="o">%</span> <span class="n">cls</span><span class="o">.</span><span class="n">__tablename__</span><span class="p">,</span> <span class="s1">&apos;a&apos;</span><span class="p">,</span> <span class="s1">&apos;b&apos;</span><span class="p">),)</span>

<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">MyMixin</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;atable&apos;</span>
    <span class="n">c</span> <span class="o">=</span>  <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span><span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div></div></div>