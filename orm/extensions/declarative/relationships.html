<h1><span class="yiyi-st" id="yiyi-53">&#x914D;&#x7F6E;&#x5173;&#x7CFB;<a class="headerlink" href="#configuring-relationships" title="Permalink to this headline">&#xB6;</a></span></h1><p><span class="yiyi-st" id="yiyi-54">&#x4E0E;&#x5176;&#x4ED6;&#x7C7B;&#x7684;&#x5173;&#x7CFB;&#x4EE5;&#x901A;&#x5E38;&#x7684;&#x65B9;&#x5F0F;&#x5B8C;&#x6210;&#xFF0C;&#x6DFB;&#x52A0;&#x7684;&#x7279;&#x6027;&#x662F;&#x6307;&#x5B9A;&#x7ED9;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#x7684;&#x7C7B;&#x53EF;&#x4EE5;&#x662F;&#x5B57;&#x7B26;&#x4E32;&#x540D;&#x79F0;&#x3002;</span><span class="yiyi-st" id="yiyi-55">&#x5728;&#x6620;&#x5C04;&#x5668;&#x7F16;&#x8BD1;&#x65F6;&#x4F7F;&#x7528;&#x4E0E;<code class="docutils literal"><span class="pre">Base</span></code>&#x5173;&#x8054;&#x7684;&#x201C;&#x7C7B;&#x6CE8;&#x518C;&#x8868;&#x201D;&#xFF0C;&#x4EE5;&#x5C06;&#x540D;&#x79F0;&#x89E3;&#x6790;&#x4E3A;&#x5B9E;&#x9645;&#x7684;&#x7C7B;&#x5BF9;&#x8C61;&#xFF0C;&#x8BE5;&#x5BF9;&#x8C61;&#x9884;&#x671F;&#x5728;&#x4F7F;&#x7528;&#x6620;&#x5C04;&#x5668;&#x914D;&#x7F6E;&#x540E;&#x5B9A;&#x4E49;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;users&apos;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">addresses</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Address&quot;</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Address</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;addresses&apos;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;users.id&apos;</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-56">&#x5217;&#x7ED3;&#x6784;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x5C31;&#x662F;&#x8FD9;&#x6837;&#xFF0C;&#x53EF;&#x4EE5;&#x7ACB;&#x5373;&#x4F7F;&#x7528;&#xFF0C;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x5B83;&#x4EEC;&#x5B9A;&#x4E49;<code class="docutils literal"><span class="pre">Address</span></code>&#x7C7B;&#x7684;&#x4E3B;&#x8981;&#x8FDE;&#x63A5;&#x6761;&#x4EF6;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Address</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;addresses&apos;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;users.id&apos;</span><span class="p">))</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">primaryjoin</span><span class="o">=</span><span class="n">user_id</span> <span class="o">==</span> <span class="n">User</span><span class="o">.</span><span class="n">id</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-57">&#x9664;&#x4E86;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#x7684;&#x4E3B;&#x8981;&#x53C2;&#x6570;&#x4E4B;&#x5916;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x5C06;&#x5176;&#x4ED6;&#x4F9D;&#x8D56;&#x4E8E;&#x5B58;&#x5728;&#x4E8E;&#x5C1A;&#x672A;&#x5B9A;&#x4E49;&#x7684;&#x7C7B;&#x4E2D;&#x7684;&#x5217;&#x7684;&#x53C2;&#x6570;&#x6307;&#x5B9A;&#x4E3A;&#x5B57;&#x7B26;&#x4E32;&#x3002;</span><span class="yiyi-st" id="yiyi-58">&#x8FD9;&#x4E9B;&#x5B57;&#x7B26;&#x4E32;&#x88AB;&#x8BC4;&#x4F30;&#x4E3A;Python&#x8868;&#x8FBE;&#x5F0F;&#x3002;</span><span class="yiyi-st" id="yiyi-59">&#x6B64;&#x8BC4;&#x4F30;&#x4E2D;&#x53EF;&#x7528;&#x7684;&#x5B8C;&#x6574;&#x540D;&#x79F0;&#x7A7A;&#x95F4;&#x5305;&#x62EC;&#x4E3A;&#x6B64;&#x58F0;&#x660E;&#x6027;&#x57FA;&#x7840;&#x6620;&#x5C04;&#x7684;&#x6240;&#x6709;&#x7C7B;&#x4EE5;&#x53CA;<code class="docutils literal"><span class="pre">sqlalchemy</span></code>&#x5305;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x5305;&#x62EC;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.desc" title="sqlalchemy.sql.expression.desc"><code class="xref py py-func docutils literal"><span class="pre">desc()</span></code></a>&#x548C;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.func" title="sqlalchemy.sql.expression.func"><code class="xref py py-attr docutils literal"><span class="pre">func</span></code></a></span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="c1"># ....</span>
    <span class="n">addresses</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Address&quot;</span><span class="p">,</span>
                         <span class="n">order_by</span><span class="o">=</span><span class="s2">&quot;desc(Address.email)&quot;</span><span class="p">,</span>
                         <span class="n">primaryjoin</span><span class="o">=</span><span class="s2">&quot;Address.user_id==User.id&quot;</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-60">&#x5BF9;&#x4E8E;&#x591A;&#x4E2A;&#x6A21;&#x5757;&#x5305;&#x542B;&#x540C;&#x540D;&#x7C7B;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x5B57;&#x7B26;&#x4E32;&#x7C7B;&#x540D;&#x79F0;&#x4E5F;&#x53EF;&#x4EE5;&#x5728;&#x4EFB;&#x4F55;&#x8FD9;&#x4E9B;&#x5B57;&#x7B26;&#x4E32;&#x8868;&#x8FBE;&#x5F0F;&#x4E2D;&#x6307;&#x5B9A;&#x4E3A;&#x6A21;&#x5757;&#x9650;&#x5B9A;&#x8DEF;&#x5F84;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="c1"># ....</span>
    <span class="n">addresses</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;myapp.model.address.Address&quot;</span><span class="p">,</span>
                         <span class="n">order_by</span><span class="o">=</span><span class="s2">&quot;desc(myapp.model.address.Address.email)&quot;</span><span class="p">,</span>
                         <span class="n">primaryjoin</span><span class="o">=</span><span class="s2">&quot;myapp.model.address.Address.user_id==&quot;</span>
                                        <span class="s2">&quot;myapp.model.user.User.id&quot;</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-61">&#x5408;&#x683C;&#x7684;&#x8DEF;&#x5F84;&#x53EF;&#x4EE5;&#x662F;&#x5220;&#x9664;&#x540D;&#x79F0;&#x4E4B;&#x95F4;&#x7684;&#x6B67;&#x4E49;&#x7684;&#x4EFB;&#x4F55;&#x90E8;&#x5206;&#x8DEF;&#x5F84;&#x3002;</span><span class="yiyi-st" id="yiyi-62">&#x4F8B;&#x5982;&#xFF0C;&#x4E3A;&#x4E86;&#x6D88;&#x9664;<code class="docutils literal"><span class="pre">myapp.model.address.Address</span></code>&#x548C;<code class="docutils literal"><span class="pre">myapp.model.lookup.Address</span></code>&#x4E4B;&#x95F4;&#x7684;&#x6B67;&#x4E49;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;<code class="docutils literal"><span class="pre">address.Address</span></code>&#x6216;<code class="docutils literal"><span class="pre">lookup.Address</span></code></span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="c1"># ....</span>
    <span class="n">addresses</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;address.Address&quot;</span><span class="p">,</span>
                         <span class="n">order_by</span><span class="o">=</span><span class="s2">&quot;desc(address.Address.email)&quot;</span><span class="p">,</span>
                         <span class="n">primaryjoin</span><span class="o">=</span><span class="s2">&quot;address.Address.user_id==&quot;</span>
                                        <span class="s2">&quot;User.id&quot;</span><span class="p">)</span></pre></div></div><div class="versionadded"><p><span class="yiyi-st" id="yiyi-63"><span class="versionmodified">0.8&#x7248;&#x672C;&#x4E2D;&#x7684;&#x65B0;&#x529F;&#x80FD;</span>&#x4F7F;&#x7528;Declarative&#x6307;&#x5B9A;&#x5B57;&#x7B26;&#x4E32;&#x53C2;&#x6570;&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x6A21;&#x5757;&#x9650;&#x5B9A;&#x8DEF;&#x5F84;&#xFF0C;&#x4EE5;&#x6307;&#x5B9A;&#x7279;&#x5B9A;&#x6A21;&#x5757;&#x3002;</span></p></div><p><span class="yiyi-st" id="yiyi-64">&#x4F7F;&#x7528;&#x57FA;&#x4E8E;&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x5C5E;&#x6027;&#x4E5F;&#x6709;&#x4E24;&#x79CD;&#x9009;&#x62E9;&#x3002;</span><span class="yiyi-st" id="yiyi-65">&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;lambda&#xFF0C;&#x8FD9;&#x5C06;&#x5728;&#x6240;&#x6709;&#x6620;&#x5C04;&#x5668;&#x914D;&#x7F6E;&#x5B8C;&#x6210;&#x540E;&#x8FDB;&#x884C;&#x8BC4;&#x4F30;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="c1"># ...</span>
    <span class="n">addresses</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">Address</span><span class="p">,</span>
                         <span class="n">order_by</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">desc</span><span class="p">(</span><span class="n">Address</span><span class="o">.</span><span class="n">email</span><span class="p">),</span>
                         <span class="n">primaryjoin</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">Address</span><span class="o">.</span><span class="n">user_id</span><span class="o">==</span><span class="n">User</span><span class="o">.</span><span class="n">id</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-66">&#x6216;&#x8005;&#xFF0C;&#x5728;&#x7C7B;&#x53EF;&#x7528;&#x4E4B;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x5C06;&#x5173;&#x7CFB;&#x663E;&#x5F0F;&#x6DFB;&#x52A0;&#x5230;&#x7C7B;&#x4E2D;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">User</span><span class="o">.</span><span class="n">addresses</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="n">Address</span><span class="p">,</span>
                          <span class="n">primaryjoin</span><span class="o">=</span><span class="n">Address</span><span class="o">.</span><span class="n">user_id</span><span class="o">==</span><span class="n">User</span><span class="o">.</span><span class="n">id</span><span class="p">)</span></pre></div></div><div class="section" id="configuring-many-to-many-relationships"><h2><span class="yiyi-st" id="yiyi-67">&#x914D;&#x7F6E;&#x591A;&#x5BF9;&#x591A;&#x5173;&#x7CFB;<a class="headerlink" href="#configuring-many-to-many-relationships" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-68">&#x591A;&#x5BF9;&#x591A;&#x5173;&#x7CFB;&#x4E5F;&#x53EF;&#x4EE5;&#x7528;&#x58F0;&#x660E;&#x548C;&#x4F20;&#x7EDF;&#x6620;&#x5C04;&#x76F8;&#x540C;&#x7684;&#x65B9;&#x5F0F;&#x58F0;&#x660E;&#x3002;</span><span class="yiyi-st" id="yiyi-69"><a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#x7684;<code class="docutils literal"><span class="pre">secondary</span></code>&#x53C2;&#x6570;&#x50CF;&#x5F80;&#x5E38;&#x4E00;&#x6837;&#x4F20;&#x9012;&#x4E00;&#x4E2A;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal"><span class="pre">Table</span></code></a>&#x5BF9;&#x8C61;&#xFF0C;&#x8BE5;&#x5BF9;&#x8C61;&#x901A;&#x5E38;&#x4EE5;&#x4F20;&#x7EDF;&#x65B9;&#x5F0F;&#x58F0;&#x660E;&#x3002;</span><span class="yiyi-st" id="yiyi-70"><a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal"><span class="pre">Table</span></code></a>&#x901A;&#x5E38;&#x5171;&#x4EAB;&#x58F0;&#x660E;&#x6027;&#x57FA;&#x7840;&#x4F7F;&#x7528;&#x7684;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.MetaData" title="sqlalchemy.schema.MetaData"><code class="xref py py-class docutils literal"><span class="pre">MetaData</span></code></a>&#x5BF9;&#x8C61;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">keywords</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s1">&apos;keywords&apos;</span><span class="p">,</span> <span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;author_id&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;authors.id&apos;</span><span class="p">)),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;keyword_id&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;keywords.id&apos;</span><span class="p">))</span>
    <span class="p">)</span>

<span class="k">class</span> <span class="nc">Author</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;authors&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">keywords</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Keyword&quot;</span><span class="p">,</span> <span class="n">secondary</span><span class="o">=</span><span class="n">keywords</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-71">&#x50CF;&#x5176;&#x4ED6;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#x53C2;&#x6570;&#x4E00;&#x6837;&#xFF0C;&#x4E5F;&#x4F1A;&#x63A5;&#x53D7;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x5E76;&#x4F20;&#x9012;<code class="docutils literal"><span class="pre">Base.metadata.tables</span></code>&#x96C6;&#x5408;&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x8868;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x540D;&#x79F0;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Author</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;authors&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">keywords</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Keyword&quot;</span><span class="p">,</span> <span class="n">secondary</span><span class="o">=</span><span class="s2">&quot;keywords&quot;</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-72">&#x4E0E;&#x4F20;&#x7EDF;&#x6620;&#x5C04;&#x4E00;&#x6837;&#xFF0C;&#x9664;&#x975E;<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#x88AB;&#x58F0;&#x660E;&#xFF0C;&#x5426;&#x5219;&#x4F7F;&#x7528;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal"><span class="pre">Table</span></code></a>&#x4F5C;&#x4E3A;&#x4E5F;&#x6620;&#x5C04;&#x5230;&#x7C7B;&#x7684;&#x201C;&#x6B21;&#x201D;&#x53C2;&#x6570;&#x901A;&#x5E38;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x597D;&#x4E3B;&#x610F;with <code class="docutils literal"><span class="pre">viewonly=True</span></code>&#x3002;</span><span class="yiyi-st" id="yiyi-73">&#x5426;&#x5219;&#xFF0C;&#x5DE5;&#x4F5C;&#x5355;&#x5143;&#x7CFB;&#x7EDF;&#x53EF;&#x80FD;&#x4F1A;&#x5C1D;&#x8BD5;&#x5BF9;&#x57FA;&#x7840;&#x8868;&#x590D;&#x5236;INSERT&#x548C;DELETE&#x8BED;&#x53E5;&#x3002;</span></p></div>