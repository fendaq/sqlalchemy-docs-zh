<h1><span class="yiyi-st" id="yiyi-57">&#x57FA;&#x672C;&#x4F7F;&#x7528;<a class="headerlink" href="#basic-use" title="Permalink to this headline">&#xB6;</a></span></h1><p><span class="yiyi-st" id="yiyi-58">SQLAlchemy&#x5BF9;&#x8C61;&#x5173;&#x7CFB;&#x914D;&#x7F6E;&#x6D89;&#x53CA;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal"><span class="pre">Table</span></code></a>&#xFF0C;<a class="reference internal" href="mapping_api.html#sqlalchemy.orm.mapper" title="sqlalchemy.orm.mapper"><code class="xref py py-func docutils literal"><span class="pre">mapper()</span></code></a>&#x548C;&#x7C7B;&#x5BF9;&#x8C61;&#x7684;&#x7EC4;&#x5408;&#x4EE5;&#x5B9A;&#x4E49;&#x6620;&#x5C04;&#x7C7B;&#x3002;</span><span class="yiyi-st" id="yiyi-59"><a class="reference internal" href="api.html#module-sqlalchemy.ext.declarative" title="sqlalchemy.ext.declarative"><code class="xref py py-mod docutils literal"><span class="pre">declarative</span></code></a> allows all three to be expressed at once within the class declaration. </span><span class="yiyi-st" id="yiyi-60">&#x5C3D;&#x53EF;&#x80FD;&#x4F7F;&#x7528;&#x5E38;&#x89C4;SQLAlchemy&#x6A21;&#x5F0F;&#x548C;ORM&#x7ED3;&#x6784;&#xFF0C;&#x56E0;&#x6B64;&#x201C;&#x53E4;&#x5178;&#x201D;ORM&#x4F7F;&#x7528;&#x548C;&#x58F0;&#x660E;&#x6027;&#x4E4B;&#x95F4;&#x7684;&#x914D;&#x7F6E;&#x4FDD;&#x6301;&#x9AD8;&#x5EA6;&#x76F8;&#x4F3C;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-61">&#x4E3E;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x4F8B;&#x5B50;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>

<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">SomeClass</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;some_table&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span>  <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-62">&#x5728;&#x4E0A;&#x9762;&#xFF0C;<code class="xref py py-func docutils literal"><span class="pre">declarative_base()</span></code>&#x53EF;&#x8C03;&#x7528;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x57FA;&#x7C7B;&#xFF0C;&#x6240;&#x6709;&#x6620;&#x5C04;&#x7C7B;&#x90FD;&#x5E94;&#x8BE5;&#x7EE7;&#x627F;&#x5B83;&#x3002;</span><span class="yiyi-st" id="yiyi-63">&#x5F53;&#x7C7B;&#x5B9A;&#x4E49;&#x5B8C;&#x6210;&#x65F6;&#xFF0C;&#x5C06;&#x4F1A;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x65B0;&#x7684;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal"><span class="pre">Table</span></code></a>&#x548C;<a class="reference internal" href="mapping_api.html#sqlalchemy.orm.mapper" title="sqlalchemy.orm.mapper"><code class="xref py py-func docutils literal"><span class="pre">mapper()</span></code></a>&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-64">&#x751F;&#x6210;&#x7684;&#x8868;&#x548C;&#x6620;&#x5C04;&#x5668;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<code class="docutils literal"><span class="pre">SomeClass</span></code>&#x7C7B;&#x4E2D;&#x7684;<code class="docutils literal"><span class="pre">__table__</span></code>&#x548C;<code class="docutils literal"><span class="pre">__mapper__</span></code>&#x5C5E;&#x6027;&#x8BBF;&#x95EE;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># access the mapped Table</span>
<span class="n">SomeClass</span><span class="o">.</span><span class="n">__table__</span>

<span class="c1"># access the Mapper</span>
<span class="n">SomeClass</span><span class="o">.</span><span class="n">__mapper__</span></pre></div></div><div class="section" id="defining-attributes"><h2><span class="yiyi-st" id="yiyi-65">&#x5B9A;&#x4E49;&#x5C5E;&#x6027;<a class="headerlink" href="#defining-attributes" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-66">&#x5728;&#x524D;&#x9762;&#x7684;&#x793A;&#x4F8B;&#x4E2D;&#xFF0C;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a>&#x5BF9;&#x8C61;&#x4F1A;&#x81EA;&#x52A8;&#x4F7F;&#x7528;&#x5B83;&#x4EEC;&#x6240;&#x5206;&#x914D;&#x7684;&#x5C5E;&#x6027;&#x7684;&#x540D;&#x79F0;&#x8FDB;&#x884C;&#x547D;&#x540D;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-67">&#x8981;&#x4F7F;&#x7528;&#x4E0E;&#x5176;&#x6620;&#x5C04;&#x5C5E;&#x6027;&#x4E0D;&#x540C;&#x7684;&#x540D;&#x79F0;&#x660E;&#x786E;&#x547D;&#x540D;&#x5217;&#xFF0C;&#x53EA;&#x9700;&#x4E3A;&#x8BE5;&#x5217;&#x547D;&#x540D;&#x5373;&#x53EF;&#x3002;</span><span class="yiyi-st" id="yiyi-68">Below, column &#x201C;some_table_id&#x201D; is mapped to the &#x201C;id&#x201D; attribute of <cite>SomeClass</cite>, but in SQL will be represented as &#x201C;some_table_id&#x201D;:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SomeClass</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;some_table&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;some_table_id&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-69">&#x5C5E;&#x6027;&#x53EF;&#x4EE5;&#x5728;&#x5176;&#x6784;&#x9020;&#x540E;&#x6DFB;&#x52A0;&#x5230;&#x7C7B;&#x4E2D;&#xFF0C;&#x5E76;&#x5C06;&#x5B83;&#x4EEC;&#x6839;&#x636E;&#x9700;&#x8981;&#x6DFB;&#x52A0;&#x5230;&#x57FA;&#x7840;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal"><span class="pre">Table</span></code></a>&#x548C;<a class="reference internal" href="mapping_api.html#sqlalchemy.orm.mapper" title="sqlalchemy.orm.mapper"><code class="xref py py-func docutils literal"><span class="pre">mapper()</span></code></a>&#x5B9A;&#x4E49;&#x4E2D;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">SomeClass</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;data&apos;</span><span class="p">,</span> <span class="n">Unicode</span><span class="p">)</span>
<span class="n">SomeClass</span><span class="o">.</span><span class="n">related</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="n">RelatedInfo</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-70">&#x4F7F;&#x7528;&#x58F0;&#x660E;&#x5F0F;&#x6784;&#x9020;&#x7684;&#x7C7B;&#x53EF;&#x4EE5;&#x4E0E;&#x4F7F;&#x7528;<a class="reference internal" href="mapping_api.html#sqlalchemy.orm.mapper" title="sqlalchemy.orm.mapper"><code class="xref py py-func docutils literal"><span class="pre">mapper()</span></code></a>&#x663E;&#x5F0F;&#x6620;&#x5C04;&#x7684;&#x7C7B;&#x81EA;&#x7531;&#x4EA4;&#x4E92;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-71">&#x5C3D;&#x7BA1;&#x4E0D;&#x662F;&#x5FC5;&#x9700;&#x7684;&#xFF0C;&#x4F46;&#x5EFA;&#x8BAE;&#x6240;&#x6709;&#x8868;&#x5171;&#x4EAB;&#x76F8;&#x540C;&#x7684;&#x5E95;&#x5C42;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.MetaData" title="sqlalchemy.schema.MetaData"><code class="xref py py-class docutils literal"><span class="pre">MetaData</span></code></a>&#x5BF9;&#x8C61;&#xFF0C;&#x4EE5;&#x4FBF;&#x53EF;&#x4EE5;&#x6BEB;&#x65E0;&#x95EE;&#x9898;&#x5730;&#x89E3;&#x51B3;&#x5B57;&#x7B26;&#x4E32;&#x914D;&#x7F6E;&#x7684;<a class="reference internal" href="core_constraints.html#sqlalchemy.schema.ForeignKey" title="sqlalchemy.schema.ForeignKey"><code class="xref py py-class docutils literal"><span class="pre">ForeignKey</span></code></a>&#x5F15;&#x7528;&#x3002;</span></p></div><div class="section" id="accessing-the-metadata"><h2><span class="yiyi-st" id="yiyi-72">&#x8BBF;&#x95EE;MetaData <a class="headerlink" href="#accessing-the-metadata" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-73"><code class="xref py py-func docutils literal"><span class="pre">declarative_base()</span></code>&#x57FA;&#x7C7B;&#x5305;&#x542B;&#x4E00;&#x4E2A;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.MetaData" title="sqlalchemy.schema.MetaData"><code class="xref py py-class docutils literal"><span class="pre">MetaData</span></code></a>&#x5BF9;&#x8C61;&#xFF0C;&#x5176;&#x4E2D;&#x6536;&#x96C6;&#x4E86;&#x65B0;&#x5B9A;&#x4E49;&#x7684;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal"><span class="pre">Table</span></code></a>&#x5BF9;&#x8C61;&#x3002;</span><span class="yiyi-st" id="yiyi-74">&#x6B64;&#x5BF9;&#x8C61;&#x65E8;&#x5728;&#x76F4;&#x63A5;&#x8BBF;&#x95EE;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.MetaData" title="sqlalchemy.schema.MetaData"><code class="xref py py-class docutils literal"><span class="pre">MetaData</span></code></a>&#x7279;&#x5B9A;&#x7684;&#x64CD;&#x4F5C;&#x3002;</span><span class="yiyi-st" id="yiyi-75">&#x4F8B;&#x5982;&#xFF0C;&#x4E3A;&#x6240;&#x6709;&#x8868;&#x53D1;&#x51FA;CREATE&#x8BED;&#x53E5;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&apos;sqlite://&apos;</span><span class="p">)</span>
<span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-76"><code class="xref py py-func docutils literal"><span class="pre">declarative_base()</span></code> can also receive a pre-existing <a class="reference internal" href="core_metadata.html#sqlalchemy.schema.MetaData" title="sqlalchemy.schema.MetaData"><code class="xref py py-class docutils literal"><span class="pre">MetaData</span></code></a> object, which allows a declarative setup to be associated with an already existing traditional collection of <a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal"><span class="pre">Table</span></code></a> objects:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">mymetadata</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">()</span>
<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="n">mymetadata</span><span class="p">)</span></pre></div></div></div><div class="section" id="class-constructor"><h2><span class="yiyi-st" id="yiyi-77">&#x7C7B;&#x6784;&#x9020;&#x51FD;&#x6570;<a class="headerlink" href="#class-constructor" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-78">&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x65B9;&#x4FBF;&#x7684;&#x529F;&#x80FD;&#xFF0C;<code class="xref py py-func docutils literal"><span class="pre">declarative_base()</span></code>&#x5728;&#x63A5;&#x53D7;&#x5173;&#x952E;&#x5B57;&#x53C2;&#x6570;&#x7684;&#x7C7B;&#x4E0A;&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;&#x9ED8;&#x8BA4;&#x6784;&#x9020;&#x51FD;&#x6570;&#xFF0C;&#x5E76;&#x5C06;&#x5B83;&#x4EEC;&#x5206;&#x914D;&#x7ED9;&#x6307;&#x5B9A;&#x7684;&#x5C5E;&#x6027;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">e</span> <span class="o">=</span> <span class="n">Engineer</span><span class="p">(</span><span class="n">primary_language</span><span class="o">=</span><span class="s1">&apos;python&apos;</span><span class="p">)</span></pre></div></div></div><div class="section" id="mapper-configuration"><h2><span class="yiyi-st" id="yiyi-79">&#x6620;&#x5C04;&#x5668;&#x914D;&#x7F6E;<a class="headerlink" href="#mapper-configuration" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-80">&#x58F0;&#x660E;&#x5728;&#x5185;&#x90E8;&#x521B;&#x5EFA;&#x6620;&#x5C04;&#x5230;&#x58F0;&#x660E;&#x8868;&#x65F6;&#x4F7F;&#x7528;<a class="reference internal" href="mapping_api.html#sqlalchemy.orm.mapper" title="sqlalchemy.orm.mapper"><code class="xref py py-func docutils literal"><span class="pre">mapper()</span></code></a>&#x51FD;&#x6570;&#x3002;</span><span class="yiyi-st" id="yiyi-81"><a class="reference internal" href="mapping_api.html#sqlalchemy.orm.mapper" title="sqlalchemy.orm.mapper"><code class="xref py py-func docutils literal"><span class="pre">mapper()</span></code></a>&#x7684;&#x9009;&#x9879;&#x76F4;&#x63A5;&#x901A;&#x8FC7;<code class="docutils literal"><span class="pre">__mapper_args__</span></code>&#x7C7B;&#x5C5E;&#x6027;&#x4F20;&#x9012;&#x3002;</span><span class="yiyi-st" id="yiyi-82">&#x4E0E;&#x5F80;&#x5E38;&#x4E00;&#x6837;&#xFF0C;&#x5F15;&#x7528;&#x5C40;&#x90E8;&#x6620;&#x5C04;&#x5217;&#x7684;&#x53C2;&#x6570;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4ECE;&#x7C7B;&#x58F0;&#x660E;&#x4E2D;&#x5F15;&#x7528;&#x5B83;&#x4EEC;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="k">class</span> <span class="nc">Widget</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;widgets&apos;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">DateTime</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&apos;version_id_col&apos;</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
                    <span class="s1">&apos;version_id_generator&apos;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                <span class="p">}</span></pre></div></div></div><div class="section" id="defining-sql-expressions"><h2><span class="yiyi-st" id="yiyi-83">&#x5B9A;&#x4E49;SQL&#x8868;&#x8FBE;&#x5F0F;<a class="headerlink" href="#defining-sql-expressions" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-84">&#x6709;&#x5173;&#x5C06;&#x5C5E;&#x6027;&#x58F0;&#x660E;&#x6027;&#x6620;&#x5C04;&#x5230;SQL&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x793A;&#x4F8B;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a class="reference internal" href="mapped_sql_expr.html#mapper-sql-expressions"><span>SQL Expressions as Mapped Attributes</span></a>&#x3002;</span></p></div>