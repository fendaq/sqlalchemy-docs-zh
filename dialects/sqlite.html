<h1><span class="yiyi-st" id="yiyi-67">SQLite&#x7684;<a class="headerlink" href="#module-sqlalchemy.dialects.sqlite.base" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h1><div class="section" id="dialect-sqlite"><p><span class="yiyi-st" id="yiyi-68">&#x652F;&#x6301;SQLite&#x6570;&#x636E;&#x5E93;&#x3002;</span></p><h2><span class="yiyi-st" id="yiyi-69">DBAPI&#x652F;&#x6301;<a class="headerlink" href="#dialect-sqlite" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-70">&#x4EE5;&#x4E0B;dialect / DBAPI&#x9009;&#x9879;&#x53EF;&#x7528;&#x3002;</span><span class="yiyi-st" id="yiyi-71">&#x8BF7;&#x53C2;&#x9605;&#x5404;&#x4E2A;DBAPI&#x90E8;&#x5206;&#x7684;&#x8FDE;&#x63A5;&#x4FE1;&#x606F;&#x3002;</span></p><ul class="simple"><li><span class="yiyi-st" id="yiyi-72"><a class="reference external" href="#module-sqlalchemy.dialects.sqlite.pysqlite"> pysqlite  T0&gt;</a></span></li><li><span class="yiyi-st" id="yiyi-73"><a class="reference external" href="#module-sqlalchemy.dialects.sqlite.pysqlcipher"> pysqlcipher  T0&gt;</a></span></li></ul></div><div class="section" id="date-and-time-types"><h2><span class="yiyi-st" id="yiyi-74">&#x65E5;&#x671F;&#x548C;&#x65F6;&#x95F4;&#x7C7B;&#x578B;<a class="headerlink" href="#date-and-time-types" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-75">SQLite&#x6CA1;&#x6709;&#x5185;&#x7F6E;&#x7684;DATE&#xFF0C;TIME&#x6216;DATETIME&#x7C7B;&#x578B;&#xFF0C;&#x5E76;&#x4E14;pysqlite&#x4E0D;&#x63D0;&#x4F9B;&#x7528;&#x4E8E;&#x5728;Python <cite>datetime</cite>&#x5BF9;&#x8C61;&#x548C;SQLite&#x652F;&#x6301;&#x7684;&#x683C;&#x5F0F;&#x4E4B;&#x95F4;&#x8F6C;&#x6362;&#x503C;&#x7684;&#x5F00;&#x7BB1;&#x5373;&#x7528;&#x529F;&#x80FD;&#x3002;</span><span class="yiyi-st" id="yiyi-76">SQLAlchemy&#x81EA;&#x5DF1;&#x7684;<a class="reference internal" href="core_type_basics.html#sqlalchemy.types.DateTime" title="sqlalchemy.types.DateTime"><code class="xref py py-class docutils literal"><span class="pre">DateTime</span></code></a>&#x548C;&#x76F8;&#x5173;&#x7C7B;&#x578B;&#x5728;&#x4F7F;&#x7528;SQlite&#x65F6;&#x63D0;&#x4F9B;&#x65E5;&#x671F;&#x683C;&#x5F0F;&#x548C;&#x5206;&#x6790;&#x529F;&#x80FD;&#x3002;</span><span class="yiyi-st" id="yiyi-77">&#x5B9E;&#x73B0;&#x7C7B;&#x662F;<a class="reference internal" href="#sqlalchemy.dialects.sqlite.DATETIME" title="sqlalchemy.dialects.sqlite.DATETIME"><code class="xref py py-class docutils literal"><span class="pre">DATETIME</span></code></a>&#xFF0C;<a class="reference internal" href="#sqlalchemy.dialects.sqlite.DATE" title="sqlalchemy.dialects.sqlite.DATE"><code class="xref py py-class docutils literal"><span class="pre">DATE</span></code></a>&#x548C;<a class="reference internal" href="#sqlalchemy.dialects.sqlite.TIME" title="sqlalchemy.dialects.sqlite.TIME"><code class="xref py py-class docutils literal"><span class="pre">TIME</span></code></a>&#x3002;</span><span class="yiyi-st" id="yiyi-78">&#x8FD9;&#x4E9B;&#x7C7B;&#x578B;&#x5C06;&#x65E5;&#x671F;&#x548C;&#x65F6;&#x95F4;&#x8868;&#x793A;&#x4E3A;ISO&#x683C;&#x5F0F;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x8FD9;&#x4E5F;&#x5F88;&#x597D;&#x5730;&#x652F;&#x6301;&#x6392;&#x5E8F;&#x3002;</span><span class="yiyi-st" id="yiyi-79">&#x8FD9;&#x4E9B;&#x51FD;&#x6570;&#x4E0D;&#x4F9D;&#x8D56;&#x4E8E;&#x5178;&#x578B;&#x7684;&#x201C;libc&#x201D;&#x5185;&#x90E8;&#x51FD;&#x6570;&#xFF0C;&#x56E0;&#x6B64;&#x5B8C;&#x5168;&#x652F;&#x6301;&#x5386;&#x53F2;&#x65E5;&#x671F;&#x3002;</span></p><div class="section" id="ensuring-text-affinity"><h3><span class="yiyi-st" id="yiyi-80">&#x786E;&#x4FDD;&#x6587;&#x5B57;&#x4EB2;&#x548C;&#x529B;<a class="headerlink" href="#ensuring-text-affinity" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-81">&#x4E3A;&#x8FD9;&#x4E9B;&#x7C7B;&#x578B;&#x63D0;&#x4F9B;&#x7684;DDL&#x662F;&#x6807;&#x51C6;&#x7684;<code class="docutils literal"><span class="pre">DATE</span></code>&#xFF0C;<code class="docutils literal"><span class="pre">TIME</span></code>&#x548C;<code class="docutils literal"><span class="pre">DATETIME</span></code>&#x6307;&#x6807;&#x3002;</span><span class="yiyi-st" id="yiyi-82">&#x4F46;&#x662F;&#xFF0C;&#x81EA;&#x5B9A;&#x4E49;&#x5B58;&#x50A8;&#x683C;&#x5F0F;&#x4E5F;&#x53EF;&#x4EE5;&#x5E94;&#x7528;&#x4E8E;&#x8FD9;&#x4E9B;&#x7C7B;&#x578B;&#x3002;</span><span class="yiyi-st" id="yiyi-83">&#x5F53;&#x68C0;&#x6D4B;&#x5230;&#x5B58;&#x50A8;&#x683C;&#x5F0F;&#x4E0D;&#x5305;&#x542B;&#x5B57;&#x6BCD;&#x5B57;&#x7B26;&#x65F6;&#xFF0C;&#x8FD9;&#x4E9B;&#x7C7B;&#x578B;&#x7684;DDL&#x5C06;&#x5448;&#x73B0;&#x4E3A;<code class="docutils literal"><span class="pre">DATE_CHAR</span></code>&#xFF0C;<code class="docutils literal"><span class="pre">TIME_CHAR</span></code>&#x548C;<code class="docutils literal"><span class="pre">DATETIME_CHAR</span></code>&#xFF0C;&#x4EE5;&#x4FBF;&#x8BE5;&#x5217;&#x7EE7;&#x7EED;&#x5177;&#x6709;&#x6587;&#x672C;&#x4EB2;&#x548C;&#x529B;&#x3002;</span></p><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-84">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-85"><a class="reference external" href="http://www.sqlite.org/datatype3.html#affinity">Type Affinity</a>  - &#x5728;SQLite&#x6587;&#x6863;&#x4E2D;</span></p></div></div></div><div class="section" id="sqlite-auto-incrementing-behavior"><h2><span class="yiyi-st" id="yiyi-86">SQLite&#x81EA;&#x52A8;&#x9012;&#x589E;&#x884C;&#x4E3A;<a class="headerlink" href="#sqlite-auto-incrementing-behavior" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-87">SQLite&#x81EA;&#x52A8;&#x589E;&#x91CF;&#x7684;&#x80CC;&#x666F;&#x662F;&#xFF1A;<a class="reference external" href="http://sqlite.org/autoinc.html">http://sqlite.org/autoinc.html</a></span></p><p><span class="yiyi-st" id="yiyi-88">&#x5173;&#x952E;&#x6982;&#x5FF5;&#xFF1A;</span></p><ul class="simple"><li><span class="yiyi-st" id="yiyi-89">SQLite&#x6709;&#x4E00;&#x4E2A;&#x9690;&#x542B;&#x7684;&#x201C;&#x81EA;&#x52A8;&#x589E;&#x91CF;&#x201D;&#x529F;&#x80FD;&#xFF0C;&#x5BF9;&#x4E8E;&#x4EFB;&#x4F55;&#x4F7F;&#x7528;&#x201C;INTEGER PRIMARY KEY&#x201D;&#x4E13;&#x95E8;&#x4E3A;+&#x4E3B;&#x952E;&#x521B;&#x5EFA;&#x7684;&#x975E;&#x590D;&#x5408;&#x4E3B;&#x952E;&#x5217;&#x8FDB;&#x884C;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-90">SQLite&#x4E5F;&#x6709;&#x4E00;&#x4E2A;&#x660E;&#x786E;&#x7684;&#x201C;AUTOINCREMENT&#x201D;&#x5173;&#x952E;&#x5B57;&#xFF0C;&#x5373;<strong>not</strong>&#x7B49;&#x4EF7;&#x4E8E;&#x9690;&#x5F0F;&#x81EA;&#x52A8;&#x589E;&#x91CF;&#x7279;&#x6027;&#xFF1B;&#x6B64;&#x5173;&#x952E;&#x5B57;&#x4E0D;&#x63A8;&#x8350;&#x7528;&#x4E8E;&#x4E00;&#x822C;&#x7528;&#x9014;&#x3002;</span><span class="yiyi-st" id="yiyi-91">&#x9664;&#x975E;&#x4F7F;&#x7528;&#x7279;&#x6B8A;&#x7684;SQLite&#x7279;&#x5B9A;&#x6307;&#x4EE4;&#xFF0C;&#x5426;&#x5219;SQLAlchemy&#x4E0D;&#x4F1A;&#x5448;&#x73B0;&#x6B64;&#x5173;&#x952E;&#x5B57;&#xFF08;&#x8BF7;&#x53C2;&#x89C1;&#x4E0B;&#x6587;&#xFF09;&#x3002;</span><span class="yiyi-st" id="yiyi-92">&#x4F46;&#x662F;&#xFF0C;&#x5B83;&#x4ECD;&#x7136;&#x8981;&#x6C42;&#x5217;&#x7684;&#x7C7B;&#x578B;&#x88AB;&#x547D;&#x540D;&#x4E3A;&#x201C;INTEGER&#x201D;&#x3002;</span></li></ul><div class="section" id="using-the-autoincrement-keyword"><h3><span class="yiyi-st" id="yiyi-93">&#x4F7F;&#x7528;AUTOINCREMENT&#x5173;&#x952E;&#x5B57;<a class="headerlink" href="#using-the-autoincrement-keyword" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-94">&#x8981;&#x5728;&#x5448;&#x73B0;DDL&#x65F6;&#x5728;&#x4E3B;&#x952E;&#x5217;&#x4E0A;&#x4E13;&#x95E8;&#x5448;&#x73B0;AUTOINCREMENT&#x5173;&#x952E;&#x5B57;&#xFF0C;&#x8BF7;&#x5C06;&#x4EE5;&#x4E0B;&#x6807;&#x8BB0;<code class="docutils literal"><span class="pre">sqlite_autoincrement=True</span></code>&#x6DFB;&#x52A0;&#x5230;Table&#x7ED3;&#x6784;&#x4E2D;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">Table</span><span class="p">(</span><span class="s1">&apos;sometable&apos;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
        <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;id&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">sqlite_autoincrement</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div></div></div><div class="section" id="allowing-autoincrement-behavior-sqlalchemy-types-other-than-integer-integer"><h3><span class="yiyi-st" id="yiyi-95">&#x5141;&#x8BB8;&#x81EA;&#x52A8;&#x589E;&#x91CF;&#x884C;&#x4E3A;SQLAlchemy&#x7C7B;&#x578B;&#x4E0D;&#x662F;Integer / INTEGER <a class="headerlink" href="#allowing-autoincrement-behavior-sqlalchemy-types-other-than-integer-integer" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-96">SQLite&#x7684;&#x952E;&#x5165;&#x6A21;&#x578B;&#x57FA;&#x4E8E;&#x547D;&#x540D;&#x7EA6;&#x5B9A;&#x3002;</span><span class="yiyi-st" id="yiyi-97">&#x9664;&#x6B64;&#x4E4B;&#x5916;&#xFF0C;&#x8FD9;&#x610F;&#x5473;&#x7740;&#x5305;&#x542B;&#x5B50;&#x5B57;&#x7B26;&#x4E32;<code class="docutils literal"><span class="pre">&quot;INT&quot;</span></code>&#x7684;&#x4EFB;&#x4F55;&#x7C7B;&#x578B;&#x540D;&#x79F0;&#x5C06;&#x88AB;&#x786E;&#x5B9A;&#x4E3A;&#x201C;&#x6574;&#x6570;&#x76F8;&#x4F3C;&#x6027;&#x201D;&#x3002;</span><span class="yiyi-st" id="yiyi-98">&#x4E00;&#x4E2A;&#x540D;&#x4E3A;<code class="docutils literal"><span class="pre">&quot;BIGINT&quot;</span></code>&#xFF0C;<code class="docutils literal"><span class="pre">&quot;SPECIAL_INT&quot;</span></code>&#x751A;&#x81F3;<code class="docutils literal"><span class="pre">&quot;XYZINTQPR&quot;</span></code>&#x7684;&#x7C7B;&#x578B;&#x5C06;&#x88AB;SQLite&#x89C6;&#x4E3A;&#x201C;&#x6574;&#x6570;&#x201D;&#x5173;&#x8054;&#x3002;</span><span class="yiyi-st" id="yiyi-99">However, <strong>the SQLite autoincrement feature, whether implicitly or explicitly enabled, requires that the name of the column&#x2019;s type is exactly the string &#x201C;INTEGER&#x201D;</strong>. </span><span class="yiyi-st" id="yiyi-100">Therefore, if an application uses a type like <a class="reference internal" href="core_type_basics.html#sqlalchemy.types.BigInteger" title="sqlalchemy.types.BigInteger"><code class="xref py py-class docutils literal"><span class="pre">BigInteger</span></code></a> for a primary key, on SQLite this type will need to be rendered as the name <code class="docutils literal"><span class="pre">&quot;INTEGER&quot;</span></code> when emitting the initial <code class="docutils literal"><span class="pre">CREATE</span> <span class="pre">TABLE</span></code> statement in order for the autoincrement behavior to be available.</span></p><p><span class="yiyi-st" id="yiyi-101">&#x5B9E;&#x73B0;&#x8FD9;&#x4E00;&#x76EE;&#x6807;&#x7684;&#x4E00;&#x79CD;&#x65B9;&#x6CD5;&#x662F;&#x5728;SQLite&#x4E0A;&#x4EC5;&#x4F7F;&#x7528;<a class="reference internal" href="core_type_api.html#sqlalchemy.types.TypeEngine.with_variant" title="sqlalchemy.types.TypeEngine.with_variant"><code class="xref py py-meth docutils literal"><span class="pre">TypeEngine.with_variant()</span></code></a>&#x4F7F;&#x7528;<a class="reference internal" href="core_type_basics.html#sqlalchemy.types.Integer" title="sqlalchemy.types.Integer"><code class="xref py py-class docutils literal"><span class="pre">Integer</span></code></a>&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s2">&quot;my_table&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">BigInteger</span><span class="p">()</span><span class="o">.</span><span class="n">with_variant</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="s2">&quot;sqlite&quot;</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-102">&#x53E6;&#x4E00;&#x79CD;&#x65B9;&#x6CD5;&#x662F;&#x5728;&#x9488;&#x5BF9;SQLite&#x7F16;&#x8BD1;&#x65F6;&#x4F7F;&#x7528;<a class="reference internal" href="core_type_basics.html#sqlalchemy.types.BigInteger" title="sqlalchemy.types.BigInteger"><code class="xref py py-class docutils literal"><span class="pre">BigInteger</span></code></a>&#x7684;&#x5B50;&#x7C7B;&#x6765;&#x8986;&#x76D6;&#x5176;DDL&#x540D;&#x79F0;&#x4E3A;<code class="docutils literal"><span class="pre">INTEGER</span></code>&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">BigInteger</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.compiler</span> <span class="kn">import</span> <span class="n">compiles</span>

<span class="k">class</span> <span class="nc">SLBigInteger</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="nd">@compiles</span><span class="p">(</span><span class="n">SLBigInteger</span><span class="p">,</span> <span class="s1">&apos;sqlite&apos;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">bi_c</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">compiler</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;INTEGER&quot;</span>

<span class="nd">@compiles</span><span class="p">(</span><span class="n">SLBigInteger</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">bi_c</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">compiler</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">compiler</span><span class="o">.</span><span class="n">visit_BIGINT</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>


<span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s2">&quot;my_table&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">SLBigInteger</span><span class="p">(),</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="p">)</span></pre></div></div><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-103">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p><span class="yiyi-st" id="yiyi-104"><a class="reference internal" href="core_type_api.html#sqlalchemy.types.TypeEngine.with_variant" title="sqlalchemy.types.TypeEngine.with_variant"><code class="xref py py-meth docutils literal"><span class="pre">TypeEngine.with_variant()</span></code></a></span></p><p><span class="yiyi-st" id="yiyi-105"><a class="reference internal" href="core_compiler.html"><span>Custom SQL Constructs and Compilation Extension</span></a></span></p><p class="last"><span class="yiyi-st" id="yiyi-106"><a class="reference external" href="http://sqlite.org/datatype3.html">&#x6570;&#x636E;&#x7C7B;&#x578B;&#x5728;SQLite&#x7248;&#x672C;3&#x4E2D;</a></span></p></div></div></div><div class="section" id="database-locking-behavior-concurrency"><h2><span class="yiyi-st" id="yiyi-107">&#x6570;&#x636E;&#x5E93;&#x9501;&#x5B9A;&#x884C;&#x4E3A;/&#x5E76;&#x53D1;<a class="headerlink" href="#database-locking-behavior-concurrency" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-108">SQLite&#x4E0D;&#x662F;&#x4E13;&#x4E3A;&#x9AD8;&#x7EA7;&#x522B;&#x7684;&#x5199;&#x5165;&#x5E76;&#x53D1;&#x800C;&#x8BBE;&#x8BA1;&#x7684;&#x3002;</span><span class="yiyi-st" id="yiyi-109">&#x4F5C;&#x4E3A;&#x6587;&#x4EF6;&#x7684;&#x6570;&#x636E;&#x5E93;&#x672C;&#x8EAB;&#x5728;&#x4E8B;&#x52A1;&#x5185;&#x7684;&#x5199;&#x64CD;&#x4F5C;&#x671F;&#x95F4;&#x88AB;&#x5B8C;&#x5168;&#x9501;&#x5B9A;&#xFF0C;&#x8FD9;&#x610F;&#x5473;&#x7740;&#x5728;&#x6B64;&#x671F;&#x95F4;&#x6070;&#x597D;&#x6709;&#x4E00;&#x4E2A;&#x201C;&#x8FDE;&#x63A5;&#x201D;&#xFF08;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x6587;&#x4EF6;&#x53E5;&#x67C4;&#xFF09;&#x5BF9;&#x6570;&#x636E;&#x5E93;&#x6709;&#x72EC;&#x5360;&#x8BBF;&#x95EE;&#x6743;&#x9650; - &#x5728;&#x6B64;&#x671F;&#x95F4;&#x6240;&#x6709;&#x5176;&#x4ED6;&#x201C;&#x8FDE;&#x63A5;&#x201D;&#x5C06;&#x88AB;&#x963B;&#x6B62;&#x65F6;&#x95F4;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-110">Python DBAPI&#x89C4;&#x8303;&#x8FD8;&#x8981;&#x6C42;&#x4E00;&#x4E2A;&#x59CB;&#x7EC8;&#x5728;&#x4E8B;&#x52A1;&#x4E2D;&#x7684;&#x8FDE;&#x63A5;&#x6A21;&#x578B;&#xFF1B;&#x6CA1;&#x6709;<code class="docutils literal"><span class="pre">connection.begin()</span></code>&#x65B9;&#x6CD5;&#xFF0C;&#x53EA;&#x6709;<code class="docutils literal"><span class="pre">connection.commit()</span></code>&#x548C;<code class="docutils literal"><span class="pre">connection.rollback()</span></code>&#x7ACB;&#x5373;&#x5F00;&#x59CB;&#x3002;</span><span class="yiyi-st" id="yiyi-111">&#x8FD9;&#x4F3C;&#x4E4E;&#x610F;&#x5473;&#x7740;SQLite&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x7406;&#x8BBA;&#x4E0A;&#x5728;&#x4EFB;&#x4F55;&#x65F6;&#x5019;&#x90FD;&#x53EA;&#x5141;&#x8BB8;&#x5728;&#x4E00;&#x4E2A;&#x7279;&#x5B9A;&#x7684;&#x6570;&#x636E;&#x5E93;&#x6587;&#x4EF6;&#x4E0A;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x53E5;&#x67C4;&#xFF1B;&#x7136;&#x800C;&#xFF0C;SQlite&#x672C;&#x8EAB;&#x4EE5;&#x53CA;pysqlite&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x4E2D;&#x90FD;&#x6709;&#x51E0;&#x4E2A;&#x56E0;&#x7D20;&#xFF0C;&#x8FD9;&#x4E9B;&#x56E0;&#x7D20;&#x663E;&#x7740;&#x5730;&#x653E;&#x5BBD;&#x4E86;&#x8FD9;&#x4E00;&#x9650;&#x5236;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-112">&#x7136;&#x800C;&#xFF0C;&#x65E0;&#x8BBA;&#x4F7F;&#x7528;&#x4EC0;&#x4E48;&#x9501;&#x5B9A;&#x6A21;&#x5F0F;&#xFF0C;&#x4E00;&#x65E6;&#x4E8B;&#x52A1;&#x542F;&#x52A8;&#x5E76;&#x4E14;DML&#xFF08;&#x4F8B;&#x5982;INSERT&#xFF0C;UPDATE&#xFF0C;DELETE&#xFF09;&#x81F3;&#x5C11;&#x88AB;&#x53D1;&#x5C04;&#x51FA;&#x53BB;&#xFF0C;SQLite&#x4ECD;&#x7136;&#x4F1A;&#x59CB;&#x7EC8;&#x9501;&#x5B9A;&#x6570;&#x636E;&#x5E93;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x4E14;&#x8FD9;&#x81F3;&#x5C11;&#x4F1A;&#x5728;&#x8BE5;&#x70B9;&#x5904;&#x963B;&#x6B62;&#x5176;&#x4ED6;&#x4E8B;&#x52A1;&#x4ED6;&#x4EEC;&#x4E5F;&#x8BD5;&#x56FE;&#x53D1;&#x5C04;DML&#x3002;</span><span class="yiyi-st" id="yiyi-113">&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8BE5;&#x5757;&#x7684;&#x65F6;&#x95F4;&#x957F;&#x5EA6;&#x975E;&#x5E38;&#x77ED;&#xFF0C;&#x5E76;&#x4E14;&#x5728;&#x53D1;&#x751F;&#x9519;&#x8BEF;&#x65F6;&#x8D85;&#x65F6;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-114">&#x4E0E;SQLAlchemy ORM&#x4E00;&#x8D77;&#x4F7F;&#x7528;&#x65F6;&#xFF0C;&#x6B64;&#x884C;&#x4E3A;&#x53D8;&#x5F97;&#x66F4;&#x52A0;&#x91CD;&#x8981;&#x3002;</span><span class="yiyi-st" id="yiyi-115">&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;SQLAlchemy&#x7684;<a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x5BF9;&#x8C61;&#x5728;&#x4E8B;&#x52A1;&#x4E2D;&#x8FD0;&#x884C;&#xFF0C;&#x5E76;&#x4E14;&#x4F7F;&#x7528;&#x5176;&#x81EA;&#x52A8;&#x5237;&#x65B0;&#x6A21;&#x578B;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x4EFB;&#x4F55;SELECT&#x8BED;&#x53E5;&#x4E4B;&#x524D;&#x53D1;&#x51FA;DML&#x3002;</span><span class="yiyi-st" id="yiyi-116">&#x8FD9;&#x53EF;&#x80FD;&#x4F1A;&#x5BFC;&#x81F4;SQLite&#x6570;&#x636E;&#x5E93;&#x7684;&#x9501;&#x5B9A;&#x901F;&#x5EA6;&#x8D85;&#x51FA;&#x9884;&#x671F;&#x3002;</span><span class="yiyi-st" id="yiyi-117">SQLite&#x7684;&#x9501;&#x5B9A;&#x6A21;&#x5F0F;&#x548C;pysqlite&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x53EF;&#x4EE5;&#x5728;&#x4E00;&#x5B9A;&#x7A0B;&#x5EA6;&#x4E0A;&#x88AB;&#x64CD;&#x7EB5;&#xFF0C;&#x4F46;&#x662F;&#x5E94;&#x8BE5;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x4F7F;&#x7528;SQLite&#x5B9E;&#x73B0;&#x9AD8;&#x5EA6;&#x7684;&#x5199;&#x5165;&#x5E76;&#x53D1;&#x662F;&#x4E00;&#x573A;&#x5931;&#x8D25;&#x7684;&#x6218;&#x6597;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-118">&#x6709;&#x5173;SQLite&#x7F3A;&#x4E4F;&#x8BBE;&#x8BA1;&#x5199;&#x5165;&#x5E76;&#x53D1;&#x6027;&#x7684;&#x66F4;&#x591A;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a class="reference external" href="http://www.sqlite.org/whentouse.html">&#x53E6;&#x4E00;&#x4E2A;RDBMS&#x53EF;&#x80FD;&#x66F4;&#x597D;&#x5730;&#x5DE5;&#x4F5C;&#x7684;&#x60C5;&#x51B5; - &#x9AD8;&#x5E76;&#x53D1;&#x6027;</a>&#x63A5;&#x8FD1;&#x9875;&#x9762;&#x5E95;&#x90E8;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-119">&#x4EE5;&#x4E0B;&#x5C0F;&#x8282;&#x4ECB;&#x7ECD;&#x4E86;&#x53D7;SQLite&#x7684;&#x57FA;&#x4E8E;&#x6587;&#x4EF6;&#x7684;&#x4F53;&#x7CFB;&#x7ED3;&#x6784;&#x5F71;&#x54CD;&#x7684;&#x533A;&#x57DF;&#xFF0C;&#x5E76;&#x4E14;&#x901A;&#x5E38;&#x8FD8;&#x9700;&#x8981;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#x624D;&#x80FD;&#x5728;&#x4F7F;&#x7528;pysqlite&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x65F6;&#x5DE5;&#x4F5C;&#x3002;</span></p></div><div class="section" id="transaction-isolation-level"><h2><span class="yiyi-st" id="yiyi-120">&#x4E8B;&#x52A1;&#x9694;&#x79BB;&#x7EA7;&#x522B;<a class="headerlink" href="#transaction-isolation-level" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-121">SQLite&#x652F;&#x6301;&#x4EE5;&#x975E;&#x6807;&#x51C6;&#x65B9;&#x5F0F;&#x6CBF;&#x4E24;&#x4E2A;&#x8F74;&#x8FDB;&#x884C;&#x201C;&#x4E8B;&#x52A1;&#x9694;&#x79BB;&#x201D;&#x3002;</span><span class="yiyi-st" id="yiyi-122">One is that of the <a class="reference external" href="http://www.sqlite.org/pragma.html#pragma_read_uncommitted">PRAGMA read_uncommitted</a> instruction. </span><span class="yiyi-st" id="yiyi-123">This setting can essentially switch SQLite between its default mode of <code class="docutils literal"><span class="pre">SERIALIZABLE</span></code> isolation, and a &#x201C;dirty read&#x201D; isolation mode normally referred to as <code class="docutils literal"><span class="pre">READ</span> <span class="pre">UNCOMMITTED</span></code>.</span></p><p><span class="yiyi-st" id="yiyi-124">SQLAlchemy&#x4F7F;&#x7528;<a class="reference internal" href="core_engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal"><span class="pre">create_engine()</span></code></a>&#x7684;<a class="reference internal" href="core_engines.html#sqlalchemy.create_engine.params.isolation_level" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal"><span class="pre">create_engine.isolation_level</span></code></a>&#x53C2;&#x6570;&#x8FDE;&#x63A5;&#x5230;&#x6B64;PRAGMA&#x8BED;&#x53E5;&#x4E2D;&#x3002;</span><span class="yiyi-st" id="yiyi-125">&#x4E0E;SQLite&#x4E00;&#x8D77;&#x4F7F;&#x7528;&#x65F6;&#xFF0C;&#x6B64;&#x53C2;&#x6570;&#x7684;&#x6709;&#x6548;&#x503C;&#x5206;&#x522B;&#x4E3A;<code class="docutils literal"><span class="pre">&quot;SERIALIZABLE&quot;</span></code>&#x548C;<code class="docutils literal"><span class="pre">&#x201C;READ</span> <span class="pre">UNCOMMITTED&#x201D;</span></code>&#x5206;&#x522B;&#x4E3A;0&#x548C;1&#x3002;</span><span class="yiyi-st" id="yiyi-126">SQLite&#x9ED8;&#x8BA4;&#x4E3A;<code class="docutils literal"><span class="pre">SERIALIZABLE</span></code>&#xFF0C;&#x4F46;&#x5176;&#x884C;&#x4E3A;&#x53D7;&#x5230;pysqlite&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x9ED8;&#x8BA4;&#x884C;&#x4E3A;&#x7684;&#x5F71;&#x54CD;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-127">SQLite&#x7684;&#x4E8B;&#x52A1;&#x9501;&#x5B9A;&#x6240;&#x53D7;&#x5F71;&#x54CD;&#x7684;&#x53E6;&#x4E00;&#x4E2A;&#x8F74;&#x662F;&#x901A;&#x8FC7;&#x4F7F;&#x7528;&#x7684;<code class="docutils literal"><span class="pre">BEGIN</span></code>&#x8BED;&#x53E5;&#x7684;&#x6027;&#x8D28;&#x3002;</span><span class="yiyi-st" id="yiyi-128">&#x5982;<a class="reference external" href="http://sqlite.org/lang_transaction.html">BEGIN TRANSACTION</a>&#x6240;&#x8FF0;&#xFF0C;&#x8FD9;&#x4E09;&#x4E2A;&#x54C1;&#x79CD;&#x662F;&#x201C;&#x5EF6;&#x671F;&#x201D;&#xFF0C;&#x201C;&#x5373;&#x65F6;&#x201D;&#x548C;&#x201C;&#x6392;&#x4ED6;&#x201D;&#x3002;</span><span class="yiyi-st" id="yiyi-129">A straight <code class="docutils literal"><span class="pre">BEGIN</span></code> statement uses the &#x201C;deferred&#x201D; mode, where the the database file is not locked until the first read or write operation, and read access remains open to other transactions until the first write operation. </span><span class="yiyi-st" id="yiyi-130">&#x4F46;&#x540C;&#x6837;&#x91CD;&#x8981;&#x7684;&#x662F;&#x8981;&#x6CE8;&#x610F;&#xFF0C;&#x5728;&#x7B2C;&#x4E00;&#x6B21;&#x5199;&#x64CD;&#x4F5C;&#x4E4B;&#x524D;&#xFF0C;pysqlite&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x4F1A;&#x901A;&#x8FC7;<em>&#x5E72;&#x6270;&#x6B64;&#x884C;&#x4E3A;&#xFF0C;&#x751A;&#x81F3;&#x4E0D;&#x4F1A;&#x53D1;&#x51FA;BEGIN</em>&#x3002;</span></p><div class="admonition warning"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-131">&#x8B66;&#x544A;</span></p><p class="last"><span class="yiyi-st" id="yiyi-132">SQLite&#x7684;&#x4E8B;&#x52A1;&#x8303;&#x56F4;&#x53D7;&#x5230;pysqlite&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x4E2D;&#x672A;&#x89E3;&#x51B3;&#x7684;&#x95EE;&#x9898;&#x7684;&#x5F71;&#x54CD;&#xFF0C;&#x8BE5;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x5C06;BEGIN&#x8BED;&#x53E5;&#x63A8;&#x8FDF;&#x5230;&#x6BD4;&#x901A;&#x5E38;&#x53EF;&#x884C;&#x7684;&#x7A0B;&#x5EA6;&#x66F4;&#x5927;&#x7684;&#x7A0B;&#x5EA6;&#x3002;</span><span class="yiyi-st" id="yiyi-133">&#x6709;&#x5173;&#x89E3;&#x51B3;&#x6B64;&#x95EE;&#x9898;&#x7684;&#x6280;&#x672F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a class="reference internal" href="#pysqlite-serializable"><span>Serializable isolation / Savepoints / Transactional DDL</span></a>&#x4E00;&#x8282;&#x3002;</span></p></div></div><div class="section" id="savepoint-support"><h2><span class="yiyi-st" id="yiyi-134">SAVEPOINT&#x652F;&#x6301;<a class="headerlink" href="#savepoint-support" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-135">SQLite&#x652F;&#x6301;SAVEPOINT&#xFF0C;&#x5B83;&#x53EA;&#x5728;&#x4E8B;&#x52A1;&#x5F00;&#x59CB;&#x65F6;&#x624D;&#x8D77;&#x4F5C;&#x7528;&#x3002;</span><span class="yiyi-st" id="yiyi-136">SQLAlchemy&#x7684;SAVEPOINT&#x652F;&#x6301;&#x53EF;&#x4EE5;&#x5728;&#x6838;&#x5FC3;&#x7EA7;&#x522B;&#x4F7F;&#x7528;<a class="reference internal" href="core_connections.html#sqlalchemy.engine.Connection.begin_nested" title="sqlalchemy.engine.Connection.begin_nested"><code class="xref py py-meth docutils literal"><span class="pre">Connection.begin_nested()</span></code></a>&#x65B9;&#x6CD5;&#xFF0C;&#x5728;ORM&#x7EA7;&#x522B;&#x4F7F;&#x7528;<a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session.begin_nested" title="sqlalchemy.orm.session.Session.begin_nested"><code class="xref py py-meth docutils literal"><span class="pre">Session.begin_nested()</span></code></a>&#x3002;</span><span class="yiyi-st" id="yiyi-137">&#x4F46;&#x662F;&#xFF0C;&#x9664;&#x975E;&#x91C7;&#x53D6;&#x4E86;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#xFF0C;&#x5426;&#x5219;SAVEPOINTs&#x6839;&#x672C;&#x65E0;&#x6CD5;&#x4F7F;&#x7528;pysqlite&#x3002;</span></p><div class="admonition warning"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-138">&#x8B66;&#x544A;</span></p><p class="last"><span class="yiyi-st" id="yiyi-139">SQLite&#x7684;SAVEPOINT&#x529F;&#x80FD;&#x53D7;&#x5230;pysqlite&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x4E2D;&#x672A;&#x89E3;&#x51B3;&#x7684;&#x95EE;&#x9898;&#x7684;&#x5F71;&#x54CD;&#xFF0C;&#x8BE5;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x5C06;BEGIN&#x8BED;&#x53E5;&#x7684;&#x63A8;&#x8FDF;&#x7A0B;&#x5EA6;&#x6BD4;&#x5F80;&#x5F80;&#x53EF;&#x884C;&#x3002;</span><span class="yiyi-st" id="yiyi-140">&#x6709;&#x5173;&#x89E3;&#x51B3;&#x6B64;&#x95EE;&#x9898;&#x7684;&#x6280;&#x672F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a class="reference internal" href="#pysqlite-serializable"><span>Serializable isolation / Savepoints / Transactional DDL</span></a>&#x4E00;&#x8282;&#x3002;</span></p></div></div><div class="section" id="transactional-ddl"><h2><span class="yiyi-st" id="yiyi-141">&#x4E8B;&#x52A1;&#x6027;DDL <a class="headerlink" href="#transactional-ddl" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-142">SQLite&#x6570;&#x636E;&#x5E93;&#x4E5F;&#x652F;&#x6301;&#x4E8B;&#x52A1;&#x6027;<a class="reference internal" href="glossary.html#term-ddl"><span class="xref std std-term">DDL</span></a>&#x3002;</span><span class="yiyi-st" id="yiyi-143">&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;pysqlite&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x4E0D;&#x4EC5;&#x65E0;&#x6CD5;&#x542F;&#x52A8;&#x4E8B;&#x52A1;&#xFF0C;&#x8FD8;&#x4F1A;&#x5728;&#x68C0;&#x6D4B;&#x5230;DDL&#x65F6;&#x7ED3;&#x675F;&#x4EFB;&#x4F55;&#x73B0;&#x6709;&#x7684;&#x8F6C;&#x6362;&#xFF0C;&#x56E0;&#x6B64;&#x518D;&#x6B21;&#x9700;&#x8981;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#x3002;</span></p><div class="admonition warning"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-144">&#x8B66;&#x544A;</span></p><p class="last"><span class="yiyi-st" id="yiyi-145">SQLite&#x7684;&#x4E8B;&#x52A1;&#x6027;DDL&#x53D7;&#x5230;pysqlite&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x4E2D;&#x672A;&#x89E3;&#x51B3;&#x7684;&#x95EE;&#x9898;&#x7684;&#x5F71;&#x54CD;&#xFF0C;&#x8BE5;&#x95EE;&#x9898;&#x65E0;&#x6CD5;&#x53D1;&#x51FA;BEGIN&#xFF0C;&#x5E76;&#x4E14;&#x5728;&#x9047;&#x5230;DDL&#x65F6;&#x5F3A;&#x5236;COMMIT&#x53D6;&#x6D88;&#x4EFB;&#x4F55;&#x4E8B;&#x52A1;&#x3002;</span><span class="yiyi-st" id="yiyi-146">&#x6709;&#x5173;&#x89E3;&#x51B3;&#x6B64;&#x95EE;&#x9898;&#x7684;&#x6280;&#x672F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a class="reference internal" href="#pysqlite-serializable"><span>Serializable isolation / Savepoints / Transactional DDL</span></a>&#x4E00;&#x8282;&#x3002;</span></p></div></div><div class="section" id="foreign-key-support"><h2><span class="yiyi-st" id="yiyi-147">&#x5916;&#x952E;&#x652F;&#x6301;<a class="headerlink" href="#foreign-key-support" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-148">SQLite&#x5728;&#x4E3A;&#x8868;&#x53D1;&#x51FA;CREATE&#x8BED;&#x53E5;&#x65F6;&#x652F;&#x6301;FOREIGN KEY&#x8BED;&#x6CD5;&#xFF0C;&#x4F46;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8FD9;&#x4E9B;&#x7EA6;&#x675F;&#x5BF9;&#x8868;&#x7684;&#x64CD;&#x4F5C;&#x6CA1;&#x6709;&#x5F71;&#x54CD;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-149">SQLite&#x4E0A;&#x7684;&#x7EA6;&#x675F;&#x68C0;&#x67E5;&#x6709;&#x4E09;&#x4E2A;&#x5148;&#x51B3;&#x6761;&#x4EF6;&#xFF1A;</span></p><ul class="simple"><li><span class="yiyi-st" id="yiyi-150">&#x81F3;&#x5C11;&#x5FC5;&#x987B;&#x4F7F;&#x7528;SQLite&#x7248;&#x672C;3.6.19</span></li><li><span class="yiyi-st" id="yiyi-151">SQLite&#x5E93;&#x5FC5;&#x987B;&#x5728;&#x6CA1;&#x6709;&#x542F;&#x7528;SQLITE_OMIT_FOREIGN_KEY&#x6216;SQLITE_OMIT_TRIGGER&#x7B26;&#x53F7;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x7F16;&#x8BD1;<em>&#x3002;</em></span></li><li><span class="yiyi-st" id="yiyi-152">&#x5728;&#x4F7F;&#x7528;&#x524D;&#x5FC5;&#x987B;&#x5728;&#x6240;&#x6709;&#x8FDE;&#x63A5;&#x4E0A;&#x53D1;&#x9001;<code class="docutils literal"><span class="pre">PRAGMA</span> <span class="pre">foreign_keys</span> <span class="pre">=</span> <span class="pre">ON</span></code></span></li></ul><p><span class="yiyi-st" id="yiyi-153">SQLAlchemy&#x5141;&#x8BB8;&#x901A;&#x8FC7;&#x4F7F;&#x7528;&#x4E8B;&#x4EF6;&#x81EA;&#x52A8;&#x4E3A;&#x65B0;&#x8FDE;&#x63A5;&#x53D1;&#x5E03;<code class="docutils literal"><span class="pre">PRAGMA</span></code>&#x8BED;&#x53E5;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.engine</span> <span class="kn">import</span> <span class="n">Engine</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">event</span>

<span class="nd">@event.listens_for</span><span class="p">(</span><span class="n">Engine</span><span class="p">,</span> <span class="s2">&quot;connect&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">set_sqlite_pragma</span><span class="p">(</span><span class="n">dbapi_connection</span><span class="p">,</span> <span class="n">connection_record</span><span class="p">):</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">dbapi_connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;PRAGMA foreign_keys=ON&quot;</span><span class="p">)</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></pre></div></div><div class="admonition warning"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-154">&#x8B66;&#x544A;</span></p><p class="last"><span class="yiyi-st" id="yiyi-155">&#x5F53;&#x542F;&#x7528;SQLite&#x5916;&#x952E;&#x65F6;&#xFF0C;<strong>&#x4E0D;&#x53EF;&#x80FD;</strong>&#x4E3A;&#x5305;&#x542B;&#x76F8;&#x4E92;&#x4F9D;&#x8D56;&#x7684;&#x5916;&#x952E;&#x7EA6;&#x675F;&#x7684;&#x8868;&#x53D1;&#x51FA;CREATE&#x6216;DROP&#x8BED;&#x53E5;&#xFF1B;&#x4E3A;&#x8FD9;&#x4E9B;&#x8868;&#x53D1;&#x51FA;DDL&#x9700;&#x8981;&#x4F7F;&#x7528;ALTER TABLE&#x5355;&#x72EC;&#x521B;&#x5EFA;&#x6216;&#x5220;&#x9664;&#x8FD9;&#x4E9B;&#x7EA6;&#x675F;&#xFF0C;SQLite&#x4E0D;&#x652F;&#x6301;&#x8FD9;&#x4E9B;&#x7EA6;&#x675F;&#x3002;</span></p></div><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-156">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p><span class="yiyi-st" id="yiyi-157"><a class="reference external" href="http://www.sqlite.org/foreignkeys.html">SQLite&#x5916;&#x952E;&#x652F;&#x6301;</a>  - &#x5728;SQLite&#x7F51;&#x7AD9;&#x4E0A;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-158"><a class="reference internal" href="core_event.html"><span>Events</span></a>  -  SQLAlchemy&#x4E8B;&#x4EF6;API&#x3002;</span></p><dl class="last docutils"><dt><span class="yiyi-st" id="yiyi-159"><a class="reference internal" href="core_constraints.html#use-alter"><span>Creating/Dropping Foreign Key Constraints via ALTER</span></a>  - &#x5173;&#x4E8E;SQLAlchemy&#x5904;&#x7406;&#x8BBE;&#x65BD;&#x7684;&#x66F4;&#x591A;&#x4FE1;&#x606F;</span></dt><dd><span class="yiyi-st" id="yiyi-160">&#x76F8;&#x4E92;&#x4F9D;&#x8D56;&#x7684;&#x5916;&#x952E;&#x7EA6;&#x675F;&#x3002;</span></dd></dl></div></div><div class="section" id="type-reflection"><h2><span class="yiyi-st" id="yiyi-161">&#x7C7B;&#x578B;&#x53CD;&#x5C04;<a class="headerlink" href="#type-reflection" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-162">SQLite&#x7C7B;&#x578B;&#x4E0E;&#x5927;&#x591A;&#x6570;&#x5176;&#x4ED6;&#x6570;&#x636E;&#x5E93;&#x540E;&#x7AEF;&#x7684;&#x7C7B;&#x578B;&#x4E0D;&#x540C;&#xFF0C;&#x56E0;&#x4E3A;&#x7C7B;&#x578B;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x540D;&#x79F0;&#x901A;&#x5E38;&#x4E0D;&#x4EE5;&#x4E00;&#x5BF9;&#x4E00;&#x7684;&#x65B9;&#x5F0F;&#x4E0E;&#x201C;&#x7C7B;&#x578B;&#x201D;&#x76F8;&#x5BF9;&#x5E94;&#x3002;</span><span class="yiyi-st" id="yiyi-163">&#x76F8;&#x53CD;&#xFF0C;SQLite&#x6839;&#x636E;&#x7C7B;&#x578B;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x5339;&#x914D;&#x6A21;&#x5F0F;&#x5C06;&#x6BCF;&#x5217;&#x7684;&#x8F93;&#x5165;&#x884C;&#x4E3A;&#x94FE;&#x63A5;&#x5230;&#x4E94;&#x4E2A;&#x6240;&#x8C13;&#x7684;&#x201C;&#x7C7B;&#x578B;&#x4EB2;&#x548C;&#x6027;&#x201D;&#x4E4B;&#x4E00;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-164">SQLAlchemy&#x7684;&#x53CD;&#x5C04;&#x8FC7;&#x7A0B;&#x5728;&#x68C0;&#x67E5;&#x7C7B;&#x578B;&#x65F6;&#x4F7F;&#x7528;&#x7B80;&#x5355;&#x7684;&#x67E5;&#x627E;&#x8868;&#x6765;&#x94FE;&#x63A5;&#x8FD4;&#x56DE;&#x7ED9;&#x63D0;&#x4F9B;&#x7684;SQLAlchemy&#x7C7B;&#x578B;&#x7684;&#x5173;&#x952E;&#x5B57;&#x3002;</span><span class="yiyi-st" id="yiyi-165">&#x8FD9;&#x4E2A;&#x67E5;&#x8BE2;&#x8868;&#x5728;SQLite&#x65B9;&#x8A00;&#x4E2D;&#xFF0C;&#x4E0E;&#x6240;&#x6709;&#x5176;&#x4ED6;&#x65B9;&#x8A00;&#x4E00;&#x6837;&#x3002;</span><span class="yiyi-st" id="yiyi-166">&#x4F46;&#x662F;&#xFF0C;&#x5F53;&#x7279;&#x5B9A;&#x7C7B;&#x578B;&#x540D;&#x79F0;&#x4E0D;&#x5728;&#x67E5;&#x627E;&#x6620;&#x5C04;&#x4E2D;&#x65F6;&#xFF0C;SQLite&#x65B9;&#x8A00;&#x5177;&#x6709;&#x4E0D;&#x540C;&#x7684;&#x201C;&#x540E;&#x9000;&#x201D;&#x4F8B;&#x7A0B;&#xFF1B;&#x5B83;&#x5B9E;&#x73B0;&#x4E86;&#x4F4D;&#x4E8E;<a class="reference external" href="http://www.sqlite.org/datatype3.html">http://www.sqlite.org/datatype3.html</a> 2.1&#x8282;&#x7684;SQLite&#x201C;type affinity&#x201D;&#x65B9;&#x6848;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-167">&#x6240;&#x63D0;&#x4F9B;&#x7684;typemap&#x5C06;&#x76F4;&#x63A5;&#x5173;&#x8054;&#x4EE5;&#x4E0B;&#x7C7B;&#x578B;&#x7684;&#x5B8C;&#x5168;&#x5B57;&#x7B26;&#x4E32;&#x540D;&#x79F0;&#x5339;&#x914D;&#xFF1A;</span></p><p><span class="yiyi-st" id="yiyi-168"><a class="reference internal" href="core_type_basics.html#sqlalchemy.types.BIGINT" title="sqlalchemy.types.BIGINT"><code class="xref py py-class docutils literal"><span class="pre">BIGINT</span></code></a>, <a class="reference internal" href="core_type_basics.html#sqlalchemy.types.BLOB" title="sqlalchemy.types.BLOB"><code class="xref py py-class docutils literal"><span class="pre">BLOB</span></code></a>, <a class="reference internal" href="core_type_basics.html#sqlalchemy.types.BOOLEAN" title="sqlalchemy.types.BOOLEAN"><code class="xref py py-class docutils literal"><span class="pre">BOOLEAN</span></code></a>, <a class="reference internal" href="core_type_basics.html#sqlalchemy.types.BOOLEAN" title="sqlalchemy.types.BOOLEAN"><code class="xref py py-class docutils literal"><span class="pre">BOOLEAN</span></code></a>, <a class="reference internal" href="core_type_basics.html#sqlalchemy.types.CHAR" title="sqlalchemy.types.CHAR"><code class="xref py py-class docutils literal"><span class="pre">CHAR</span></code></a>, <a class="reference internal" href="core_type_basics.html#sqlalchemy.types.DATE" title="sqlalchemy.types.DATE"><code class="xref py py-class docutils literal"><span class="pre">DATE</span></code></a>, <a class="reference internal" href="core_type_basics.html#sqlalchemy.types.DATETIME" title="sqlalchemy.types.DATETIME"><code class="xref py py-class docutils literal"><span class="pre">DATETIME</span></code></a>, <a class="reference internal" href="core_type_basics.html#sqlalchemy.types.FLOAT" title="sqlalchemy.types.FLOAT"><code class="xref py py-class docutils literal"><span class="pre">FLOAT</span></code></a>, <a class="reference internal" href="core_type_basics.html#sqlalchemy.types.DECIMAL" title="sqlalchemy.types.DECIMAL"><code class="xref py py-class docutils literal"><span class="pre">DECIMAL</span></code></a>, <a class="reference internal" href="core_type_basics.html#sqlalchemy.types.FLOAT" title="sqlalchemy.types.FLOAT"><code class="xref py py-class docutils literal"><span class="pre">FLOAT</span></code></a>, <a class="reference internal" href="core_type_basics.html#sqlalchemy.types.INTEGER" title="sqlalchemy.types.INTEGER"><code class="xref py py-class docutils literal"><span class="pre">INTEGER</span></code></a>, <a class="reference internal" href="core_type_basics.html#sqlalchemy.types.INTEGER" title="sqlalchemy.types.INTEGER"><code class="xref py py-class docutils literal"><span class="pre">INTEGER</span></code></a>, <a class="reference internal" href="core_type_basics.html#sqlalchemy.types.NUMERIC" title="sqlalchemy.types.NUMERIC"><code class="xref py py-class docutils literal"><span class="pre">NUMERIC</span></code></a>, <a class="reference internal" href="core_type_basics.html#sqlalchemy.types.REAL" title="sqlalchemy.types.REAL"><code class="xref py py-class docutils literal"><span class="pre">REAL</span></code></a>, <a class="reference internal" href="core_type_basics.html#sqlalchemy.types.SMALLINT" title="sqlalchemy.types.SMALLINT"><code class="xref py py-class docutils literal"><span class="pre">SMALLINT</span></code></a>, <a class="reference internal" href="core_type_basics.html#sqlalchemy.types.TEXT" title="sqlalchemy.types.TEXT"><code class="xref py py-class docutils literal"><span class="pre">TEXT</span></code></a>, <a class="reference internal" href="core_type_basics.html#sqlalchemy.types.TIME" title="sqlalchemy.types.TIME"><code class="xref py py-class docutils literal"><span class="pre">TIME</span></code></a>, <a class="reference internal" href="core_type_basics.html#sqlalchemy.types.TIMESTAMP" title="sqlalchemy.types.TIMESTAMP"><code class="xref py py-class docutils literal"><span class="pre">TIMESTAMP</span></code></a>, <a class="reference internal" href="core_type_basics.html#sqlalchemy.types.VARCHAR" title="sqlalchemy.types.VARCHAR"><code class="xref py py-class docutils literal"><span class="pre">VARCHAR</span></code></a>, <a class="reference internal" href="core_type_basics.html#sqlalchemy.types.NVARCHAR" title="sqlalchemy.types.NVARCHAR"><code class="xref py py-class docutils literal"><span class="pre">NVARCHAR</span></code></a>, <a class="reference internal" href="core_type_basics.html#sqlalchemy.types.NCHAR" title="sqlalchemy.types.NCHAR"><code class="xref py py-class docutils literal"><span class="pre">NCHAR</span></code></a></span></p><p><span class="yiyi-st" id="yiyi-169">&#x5F53;&#x7C7B;&#x578B;&#x540D;&#x79F0;&#x4E0E;&#x4EE5;&#x4E0A;&#x7C7B;&#x578B;&#x4E4B;&#x4E00;&#x4E0D;&#x5339;&#x914D;&#x65F6;&#xFF0C;&#x5C06;&#x4F7F;&#x7528;&#x201C;&#x7C7B;&#x578B;&#x5173;&#x8054;&#x201D;&#x67E5;&#x627E;&#xFF1A;</span></p><ul class="simple"><li><span class="yiyi-st" id="yiyi-170">&#x5982;&#x679C;&#x7C7B;&#x578B;&#x540D;&#x79F0;&#x5305;&#x542B;&#x5B57;&#x7B26;&#x4E32;<code class="docutils literal"><span class="pre">INT</span></code>&#xFF0C;&#x5219;&#x8FD4;&#x56DE;<a class="reference internal" href="core_type_basics.html#sqlalchemy.types.INTEGER" title="sqlalchemy.types.INTEGER"><code class="xref py py-class docutils literal"><span class="pre">INTEGER</span></code></a></span></li><li><span class="yiyi-st" id="yiyi-171"><a class="reference internal" href="core_type_basics.html#sqlalchemy.types.TEXT" title="sqlalchemy.types.TEXT"><code class="xref py py-class docutils literal"><span class="pre">TEXT</span></code></a> is returned if the type name includes the string <code class="docutils literal"><span class="pre">CHAR</span></code>, <code class="docutils literal"><span class="pre">CLOB</span></code> or <code class="docutils literal"><span class="pre">TEXT</span></code></span></li><li><span class="yiyi-st" id="yiyi-172"><a class="reference internal" href="core_type_api.html#sqlalchemy.types.NullType" title="sqlalchemy.types.NullType"><code class="xref py py-class docutils literal"><span class="pre">NullType</span></code></a> is returned if the type name includes the string <code class="docutils literal"><span class="pre">BLOB</span></code></span></li><li><span class="yiyi-st" id="yiyi-173">&#x5982;&#x679C;&#x7C7B;&#x578B;&#x540D;&#x79F0;&#x5305;&#x542B;&#x5B57;&#x7B26;&#x4E32;<code class="docutils literal"><span class="pre">REAL</span></code>&#xFF0C;<code class="docutils literal"><span class="pre">FLOA</span></code>&#x6216;<code class="docutils literal"><span class="pre">DOUB</span></code>&#xFF0C;&#x5219;&#x8FD4;&#x56DE;<a class="reference internal" href="core_type_basics.html#sqlalchemy.types.REAL" title="sqlalchemy.types.REAL"><code class="xref py py-class docutils literal"><span class="pre">REAL</span></code></a>&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-174">&#x5426;&#x5219;&#xFF0C;&#x4F7F;&#x7528;<a class="reference internal" href="core_type_basics.html#sqlalchemy.types.NUMERIC" title="sqlalchemy.types.NUMERIC"><code class="xref py py-class docutils literal"><span class="pre">NUMERIC</span></code></a>&#x7C7B;&#x578B;&#x3002;</span></li></ul><div class="versionadded"><p><span class="yiyi-st" id="yiyi-175"><span class="versionmodified">New in version 0.9.3: </span>Support for SQLite type affinity rules when reflecting columns.</span></p></div></div><div class="section" id="partial-indexes"><h2><span class="yiyi-st" id="yiyi-176">&#x90E8;&#x5206;&#x7D22;&#x5F15;<a class="headerlink" href="#partial-indexes" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-177">&#x90E8;&#x5206;&#x7D22;&#x5F15;&#xFF0C;&#x4F8B;&#x5982;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x4F7F;&#x7528;WHERE&#x5B50;&#x53E5;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x53C2;&#x6570;<code class="docutils literal"><span class="pre">sqlite_where</span></code>&#x5728;DDL&#x7CFB;&#x7EDF;&#x4E2D;&#x6307;&#x5B9A;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">tbl</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&apos;testtbl&apos;</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;data&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">))</span>
<span class="n">idx</span> <span class="o">=</span> <span class="n">Index</span><span class="p">(</span><span class="s1">&apos;test_idx1&apos;</span><span class="p">,</span> <span class="n">tbl</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
            <span class="n">sqlite_where</span><span class="o">=</span><span class="n">and_</span><span class="p">(</span><span class="n">tbl</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">,</span> <span class="n">tbl</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-178">&#x7D22;&#x5F15;&#x5C06;&#x5728;&#x521B;&#x5EFA;&#x65F6;&#x5448;&#x73B0;&#x4E3A;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>CREATE INDEX test_idx1 ON testtbl (data)
WHERE data &gt; 5 AND data &lt; 10</pre></div></div><div class="versionadded"><p><span class="yiyi-st" id="yiyi-179"><span class="versionmodified">&#x7248;&#x672C;0.9.9&#x4E2D;&#x7684;&#x65B0;&#x529F;&#x80FD;</span></span></p></div></div><div class="section" id="dotted-column-names"><h2><span class="yiyi-st" id="yiyi-180">&#x865A;&#x7EBF;&#x5217;&#x540D;&#x79F0;<a class="headerlink" href="#dotted-column-names" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-181">&#x4F7F;&#x7528;&#x660E;&#x786E;&#x5177;&#x6709;&#x53E5;&#x70B9;&#x7684;&#x8868;&#x540D;&#x6216;&#x5217;&#x540D;&#x662F;<strong>&#x4E0D;&#x63A8;&#x8350;</strong>&#x3002;</span><span class="yiyi-st" id="yiyi-182">&#x867D;&#x7136;&#x8FD9;&#x5BF9;&#x4E8E;&#x5173;&#x7CFB;&#x6570;&#x636E;&#x5E93;&#x6765;&#x8BF4;&#x901A;&#x5E38;&#x662F;&#x4E00;&#x4E2A;&#x574F;&#x4E3B;&#x610F;&#xFF0C;&#x4F46;&#x7531;&#x4E8E;&#x70B9;&#x662F;&#x4E00;&#x4E2A;&#x8BED;&#x6CD5;&#x4E0A;&#x91CD;&#x8981;&#x7684;&#x7279;&#x5F81;&#xFF0C;SQLite&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x76F4;&#x5230;&#x7248;&#x672C;<strong>3.10.0</strong> SQLite&#x6709;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#xFF0C;&#x5B83;&#x8981;&#x6C42;SQLAlchemy&#x8FC7;&#x6EE4;&#x6389;&#x8FD9;&#x4E9B;&#x7ED3;&#x679C;&#x96C6;&#x4E2D;&#x7684;&#x70B9;&#x3002;</span></p><div class="versionchanged"><p><span class="yiyi-st" id="yiyi-183"><span class="versionmodified">&#x5728;&#x7248;&#x672C;1.1&#x4E2D;&#x66F4;&#x6539;&#xFF1A;</span>&#x4ECE;SQLite&#x7248;&#x672C;3.10.0&#x5F00;&#x59CB;&#xFF0C;&#x4E0B;&#x5217;SQLite&#x95EE;&#x9898;&#x5DF2;&#x5F97;&#x5230;&#x89E3;&#x51B3;&#x3002;</span><span class="yiyi-st" id="yiyi-184">SQLAlchemy&#x81EA;<strong>1.1</strong>&#x81EA;&#x52A8;&#x7981;&#x7528;&#x57FA;&#x4E8E;&#x68C0;&#x6D4B;&#x6B64;&#x7248;&#x672C;&#x7684;&#x5185;&#x90E8;&#x53D8;&#x901A;&#x65B9;&#x6CD5;&#x3002;</span></p></div><p><span class="yiyi-st" id="yiyi-185">&#x8FD9;&#x4E2A;&#x9519;&#x8BEF;&#x5B8C;&#x5168;&#x5728;SQLAlchemy&#x4E4B;&#x5916;&#xFF0C;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x8BF4;&#x660E;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>

<span class="k">assert</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">sqlite_version_info</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="s2">&quot;bug is fixed in this version&quot;</span>

<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;:memory:&quot;</span><span class="p">)</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;create table x (a integer, b integer)&quot;</span><span class="p">)</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;insert into x (a, b) values (1, 1)&quot;</span><span class="p">)</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;insert into x (a, b) values (2, 2)&quot;</span><span class="p">)</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;select x.a, x.b from x&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&apos;a&apos;</span><span class="p">,</span> <span class="s1">&apos;b&apos;</span><span class="p">]</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&apos;&apos;&apos;</span>
<span class="s1">    select x.a, x.b from x where a=1</span>
<span class="s1">    union</span>
<span class="s1">    select x.a, x.b from x where a=2</span>
<span class="s1">&apos;&apos;&apos;</span><span class="p">)</span>
<span class="k">assert</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&apos;a&apos;</span><span class="p">,</span> <span class="s1">&apos;b&apos;</span><span class="p">],</span> \
    <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">]</span></pre></div></div><p><span class="yiyi-st" id="yiyi-186">&#x7B2C;&#x4E8C;&#x4E2A;&#x65AD;&#x8A00;&#x5931;&#x8D25;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  File &quot;test.py&quot;, line 19, in &lt;module&gt;
    [c[0] for c in cursor.description]
AssertionError: [&apos;x.a&apos;, &apos;x.b&apos;]</pre></div></div><p><span class="yiyi-st" id="yiyi-187">&#x5728;&#x4E0A;&#x9762;&#x7684;&#x60C5;&#x51B5;&#x4E2D;&#xFF0C;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x9519;&#x8BEF;&#x5730;&#x62A5;&#x544A;&#x4E86;&#x5217;&#x7684;&#x540D;&#x79F0;&#xFF0C;&#x5305;&#x62EC;&#x8868;&#x7684;&#x540D;&#x79F0;&#xFF0C;&#x8FD9;&#x4E0E;UNION&#x4E0D;&#x5B58;&#x5728;&#x65F6;&#x5B8C;&#x5168;&#x4E0D;&#x4E00;&#x81F4;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-188">SQLAlchemy&#x4F9D;&#x8D56;&#x4E8E;&#x5217;&#x540D;&#x4E0E;&#x539F;&#x59CB;&#x8BED;&#x53E5;&#x5339;&#x914D;&#x7684;&#x53EF;&#x9884;&#x6D4B;&#x6027;&#xFF0C;&#x56E0;&#x6B64;SQLAlchemy&#x65B9;&#x8A00;&#x522B;&#x65E0;&#x9009;&#x62E9;&#xFF0C;&#x53EA;&#x80FD;&#x5C06;&#x5176;&#x8FC7;&#x6EE4;&#x6389;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>

<span class="n">eng</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;sqlite://&quot;</span><span class="p">)</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">eng</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>

<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;create table x (a integer, b integer)&quot;</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;insert into x (a, b) values (1, 1)&quot;</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;insert into x (a, b) values (2, 2)&quot;</span><span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;select x.a, x.b from x&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">]</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&apos;&apos;&apos;</span>
<span class="s1">    select x.a, x.b from x where a=1</span>
<span class="s1">    union</span>
<span class="s1">    select x.a, x.b from x where a=2</span>
<span class="s1">&apos;&apos;&apos;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">]</span></pre></div></div><p><span class="yiyi-st" id="yiyi-189">&#x6CE8;&#x610F;&#x4E0A;&#x9762;&#xFF0C;&#x5373;&#x4F7F;SQLAlchemy&#x8FC7;&#x6EE4;&#x6389;&#x4E86;&#x8FD9;&#x4E9B;&#x70B9;&#xFF0C;<em>&#x8FD9;&#x4E24;&#x4E2A;&#x540D;&#x5B57;&#x4ECD;&#x7136;&#x662F;&#x53EF;&#x5BFB;&#x5740;&#x7684;</em>&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">row</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;x.a&quot;</span><span class="p">]</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">]</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;x.b&quot;</span><span class="p">]</span>
<span class="go">1</span></pre></div></div><p><span class="yiyi-st" id="yiyi-190">Therefore, the workaround applied by SQLAlchemy only impacts <a class="reference internal" href="core_connections.html#sqlalchemy.engine.ResultProxy.keys" title="sqlalchemy.engine.ResultProxy.keys"><code class="xref py py-meth docutils literal"><span class="pre">ResultProxy.keys()</span></code></a> and <a class="reference internal" href="core_connections.html#sqlalchemy.engine.RowProxy.keys" title="sqlalchemy.engine.RowProxy.keys"><code class="xref py py-meth docutils literal"><span class="pre">RowProxy.keys()</span></code></a> in the public API. </span><span class="yiyi-st" id="yiyi-191">In the very specific case where an application is forced to use column names that contain dots, and the functionality of <a class="reference internal" href="core_connections.html#sqlalchemy.engine.ResultProxy.keys" title="sqlalchemy.engine.ResultProxy.keys"><code class="xref py py-meth docutils literal"><span class="pre">ResultProxy.keys()</span></code></a> and <a class="reference internal" href="core_connections.html#sqlalchemy.engine.RowProxy.keys" title="sqlalchemy.engine.RowProxy.keys"><code class="xref py py-meth docutils literal"><span class="pre">RowProxy.keys()</span></code></a> is required to return these dotted names unmodified, the <code class="docutils literal"><span class="pre">sqlite_raw_colnames</span></code> execution option may be provided, either on a per-<a class="reference internal" href="core_connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal"><span class="pre">Connection</span></code></a> basis:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execution_options</span><span class="p">(</span><span class="n">sqlite_raw_colnames</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&apos;&apos;&apos;</span>
<span class="s1">    select x.a, x.b from x where a=1</span>
<span class="s1">    union</span>
<span class="s1">    select x.a, x.b from x where a=2</span>
<span class="s1">&apos;&apos;&apos;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;x.a&quot;</span><span class="p">,</span> <span class="s2">&quot;x.b&quot;</span><span class="p">]</span></pre></div></div><p><span class="yiyi-st" id="yiyi-192">&#x6216;&#x57FA;&#x4E8E;&#x6BCF;&#x4E2A;<a class="reference internal" href="core_connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal"><span class="pre">Engine</span></code></a>&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;sqlite://&quot;</span><span class="p">,</span> <span class="n">execution_options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;sqlite_raw_colnames&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span></pre></div></div><p><span class="yiyi-st" id="yiyi-193">&#x5728;&#x4F7F;&#x7528;per- <a class="reference internal" href="core_connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal"><span class="pre">Engine</span></code></a>&#x6267;&#x884C;&#x9009;&#x9879;&#x65F6;&#xFF0C;&#x8BF7;&#x6CE8;&#x610F;<strong>&#x4F7F;&#x7528;UNION&#x7684;&#x6838;&#x5FC3;&#x548C;ORM&#x67E5;&#x8BE2;&#x53EF;&#x80FD;&#x65E0;&#x6CD5;&#x6B63;&#x5E38;&#x5DE5;&#x4F5C;</strong>&#x3002;</span></p></div><div class="section" id="sqlite-data-types"><h2><span class="yiyi-st" id="yiyi-194">SQLite&#x6570;&#x636E;&#x7C7B;&#x578B;<a class="headerlink" href="#sqlite-data-types" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-195">&#x4E0E;&#x6240;&#x6709;SQLAlchemy&#x65B9;&#x8A00;&#x4E00;&#x6837;&#xFF0C;&#x6240;&#x6709;&#x5DF2;&#x77E5;&#x53EF;&#x7528;&#x4E8E;SQLite&#x7684;UPPERCASE&#x7C7B;&#x578B;&#x90FD;&#x53EF;&#x4EE5;&#x4ECE;&#x9876;&#x7EA7;&#x65B9;&#x8A00;&#x5BFC;&#x5165;&#xFF0C;&#x65E0;&#x8BBA;&#x5B83;&#x4EEC;&#x6E90;&#x81EA;<a class="reference internal" href="core_type_basics.html#module-sqlalchemy.types" title="sqlalchemy.types"><code class="xref py py-mod docutils literal"><span class="pre">sqlalchemy.types</span></code></a>&#x8FD8;&#x662F;&#x6765;&#x81EA;&#x672C;&#x5730;&#x65B9;&#x8A00;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.dialects.sqlite</span> <span class="kn">import</span> \
            <span class="n">BLOB</span><span class="p">,</span> <span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">CHAR</span><span class="p">,</span> <span class="n">DATE</span><span class="p">,</span> <span class="n">DATETIME</span><span class="p">,</span> <span class="n">DECIMAL</span><span class="p">,</span> <span class="n">FLOAT</span><span class="p">,</span> \
            <span class="n">INTEGER</span><span class="p">,</span> <span class="n">NUMERIC</span><span class="p">,</span> <span class="n">SMALLINT</span><span class="p">,</span> <span class="n">TEXT</span><span class="p">,</span> <span class="n">TIME</span><span class="p">,</span> <span class="n">TIMESTAMP</span><span class="p">,</span> \
            <span class="n">VARCHAR</span></pre></div></div><dl class="class"><dt id="sqlalchemy.dialects.sqlite.DATETIME"><span class="yiyi-st" id="yiyi-196"> <em class="property">class </em><code class="descclassname">sqlalchemy.dialects.sqlite.</code><code class="descname">DATETIME</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.sqlite.DATETIME" title="Permalink to this definition">&#xB6;</a></span></dt><dd><p><span class="yiyi-st" id="yiyi-197">&#x57FA;&#x7840;&#xFF1A;<code class="xref py py-class docutils literal"><span class="pre">sqlalchemy.dialects.sqlite.base._DateTimeMixin</span></code>&#xFF0C;<a class="reference internal" href="core_type_basics.html#sqlalchemy.types.DateTime" title="sqlalchemy.types.DateTime"><code class="xref py py-class docutils literal"><span class="pre">sqlalchemy.types.DateTime</span></code></a></span></p><p><span class="yiyi-st" id="yiyi-198">&#x4F7F;&#x7528;&#x5B57;&#x7B26;&#x4E32;&#x5728;SQLite&#x4E2D;&#x8868;&#x793A;Python&#x65E5;&#x671F;&#x65F6;&#x95F4;&#x5BF9;&#x8C61;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-199">&#x9ED8;&#x8BA4;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x5B58;&#x50A8;&#x683C;&#x5F0F;&#x662F;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="s2">&quot;</span><span class="si">%(year)04d</span><span class="s2">-</span><span class="si">%(month)02d</span><span class="s2">-</span><span class="si">%(day)02d</span><span class="s2"> </span><span class="si">%(hour)02d</span><span class="s2">:</span><span class="si">%(min)02d</span><span class="s2">:</span><span class="si">%(second)02d</span><span class="s2">.</span><span class="si">%(microsecond)06d</span><span class="s2">&quot;</span></pre></div></div><p><span class="yiyi-st" id="yiyi-200">&#x4F8B;&#x5982;&#x3002;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>2011-03-15 12:05:57.10558</pre></div></div><p><span class="yiyi-st" id="yiyi-201">&#x5B58;&#x50A8;&#x683C;&#x5F0F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">storage_format</span></code>&#x548C;<code class="docutils literal"><span class="pre">regexp</span></code>&#x53C2;&#x6570;&#x8FDB;&#x884C;&#x4E00;&#x5B9A;&#x7A0B;&#x5EA6;&#x7684;&#x81EA;&#x5B9A;&#x4E49;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.dialects.sqlite</span> <span class="kn">import</span> <span class="n">DATETIME</span>

<span class="n">dt</span> <span class="o">=</span> <span class="n">DATETIME</span><span class="p">(</span>
    <span class="n">storage_format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(year)04d</span><span class="s2">/</span><span class="si">%(month)02d</span><span class="s2">/</span><span class="si">%(day)02d</span><span class="s2"> </span><span class="si">%(hour)02d</span><span class="s2">:</span><span class="si">%(min)02d</span><span class="s2">:</span><span class="si">%(second)02d</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">regexp</span><span class="o">=</span><span class="s2">r&quot;(\d+)/(\d+)/(\d+) (\d+)-(\d+)-(\d+)&quot;</span>
<span class="p">)</span></pre></div></div><table class="docutils field-list" frame="void" rules="none"><tbody valign="top"><tr class="field-odd field"><th class="field-name"><span class="yiyi-st" id="yiyi-202">&#x53C2;&#x6570;&#xFF1A;</span></th><td class="field-body"><ul class="first last simple"><li><span class="yiyi-st" id="yiyi-203"><span class="target" id="sqlalchemy.dialects.sqlite.DATETIME.params.storage_format"></span><strong>storage_format</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.sqlite.DATETIME.params.storage_format">&#xB6;</a> &#x2013; format string which will be applied to the dict with keys year, month, day, hour, minute, second, and microsecond.</span></li><li><span class="yiyi-st" id="yiyi-204"><span class="target" id="sqlalchemy.dialects.sqlite.DATETIME.params.regexp"></span><strong>regexp</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.sqlite.DATETIME.params.regexp">&#xB6;</a> &#x2013; regular expression which will be applied to incoming result rows. </span><span class="yiyi-st" id="yiyi-205">&#x5982;&#x679C;&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;&#x5305;&#x542B;&#x547D;&#x540D;&#x7EC4;&#xFF0C;&#x5219;&#x6240;&#x5F97;&#x5339;&#x914D;&#x5B57;&#x5178;&#x4F5C;&#x4E3A;&#x5173;&#x952E;&#x5B57;&#x53C2;&#x6570;&#x5E94;&#x7528;&#x4E8E;Python datetime()&#x6784;&#x9020;&#x51FD;&#x6570;&#x3002;</span><span class="yiyi-st" id="yiyi-206">&#x5426;&#x5219;&#xFF0C;&#x5982;&#x679C;&#x4F7F;&#x7528;&#x4F4D;&#x7F6E;&#x7EC4;&#xFF0C;&#x5219;&#x4F7F;&#x7528;&#x4F4D;&#x7F6E;&#x53C2;&#x6570;&#x901A;&#x8FC7;<code class="docutils literal"><span class="pre">* map&#xFF08;int&#xFF0C;</span> <span class="pre">match_obj.groups&#xFF08;0&#xFF09;&#xFF09;</span>&#x8C03;&#x7528;datetime T0&gt;&#x3002;</code></span></li></ul></td></tr></tbody></table></dd></dl><dl class="class"><dt id="sqlalchemy.dialects.sqlite.DATE"><span class="yiyi-st" id="yiyi-207"><em class="property">class</em> <code class="descclassname">sqlalchemy.dialects.sqlite&#x3002;</code> <code class="descname">DATE</code> <span class="sig-paren">&#xFF08;</span> <em>storage_format =&#x65E0;</em>&#xFF0C;<em> regexp = None</em>&#xFF0C;<em>** kw</em> <span class="sig-paren">&#xFF09;</span> <a class="headerlink" href="#sqlalchemy.dialects.sqlite.DATE" title="Permalink to this definition">&#xB6;</a></span></dt><dd><p><span class="yiyi-st" id="yiyi-208">&#x57FA;&#x7840;&#xFF1A;<code class="xref py py-class docutils literal"><span class="pre">sqlalchemy.dialects.sqlite.base._DateTimeMixin</span></code>&#xFF0C;<a class="reference internal" href="core_type_basics.html#sqlalchemy.types.Date" title="sqlalchemy.types.Date"><code class="xref py py-class docutils literal"><span class="pre">sqlalchemy.types.Date</span></code></a></span></p><p><span class="yiyi-st" id="yiyi-209">&#x4F7F;&#x7528;&#x5B57;&#x7B26;&#x4E32;&#x5728;SQLite&#x4E2D;&#x8868;&#x793A;Python&#x65E5;&#x671F;&#x5BF9;&#x8C61;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-210">&#x9ED8;&#x8BA4;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x5B58;&#x50A8;&#x683C;&#x5F0F;&#x662F;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="s2">&quot;</span><span class="si">%(year)04d</span><span class="s2">-</span><span class="si">%(month)02d</span><span class="s2">-</span><span class="si">%(day)02d</span><span class="s2">&quot;</span></pre></div></div><p><span class="yiyi-st" id="yiyi-211">&#x4F8B;&#x5982;&#x3002;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="mi">2011</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">15</span></pre></div></div><p><span class="yiyi-st" id="yiyi-212">&#x5B58;&#x50A8;&#x683C;&#x5F0F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">storage_format</span></code>&#x548C;<code class="docutils literal"><span class="pre">regexp</span></code>&#x53C2;&#x6570;&#x8FDB;&#x884C;&#x4E00;&#x5B9A;&#x7A0B;&#x5EA6;&#x7684;&#x81EA;&#x5B9A;&#x4E49;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.dialects.sqlite</span> <span class="kn">import</span> <span class="n">DATE</span>

<span class="n">d</span> <span class="o">=</span> <span class="n">DATE</span><span class="p">(</span>
        <span class="n">storage_format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(month)02d</span><span class="s2">/</span><span class="si">%(day)02d</span><span class="s2">/</span><span class="si">%(year)04d</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">regexp</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;(?P&lt;month&gt;\d+)/(?P&lt;day&gt;\d+)/(?P&lt;year&gt;\d+)&quot;</span><span class="p">)</span>
    <span class="p">)</span></pre></div></div><table class="docutils field-list" frame="void" rules="none"><tbody valign="top"><tr class="field-odd field"><th class="field-name"><span class="yiyi-st" id="yiyi-213">&#x53C2;&#x6570;&#xFF1A;</span></th><td class="field-body"><ul class="first last simple"><li><span class="yiyi-st" id="yiyi-214"><span class="target" id="sqlalchemy.dialects.sqlite.DATE.params.storage_format"></span><strong>storage_format</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.sqlite.DATE.params.storage_format">&#xB6;</a> &#x2013; format string which will be applied to the dict with keys year, month, and day.</span></li><li><span class="yiyi-st" id="yiyi-215"><span class="target" id="sqlalchemy.dialects.sqlite.DATE.params.regexp"></span><strong>regexp</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.sqlite.DATE.params.regexp">&#xB6;</a> &#x2013; regular expression which will be applied to incoming result rows. </span><span class="yiyi-st" id="yiyi-216">&#x5982;&#x679C;&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;&#x5305;&#x542B;&#x547D;&#x540D;&#x7EC4;&#xFF0C;&#x5219;&#x6240;&#x5F97;&#x5230;&#x7684;&#x5339;&#x914D;&#x5B57;&#x5178;&#x4F5C;&#x4E3A;&#x5173;&#x952E;&#x5B57;&#x53C2;&#x6570;&#x5E94;&#x7528;&#x4E8E;Python date()&#x6784;&#x9020;&#x51FD;&#x6570;&#x3002;</span><span class="yiyi-st" id="yiyi-217">&#x5426;&#x5219;&#xFF0C;&#x5982;&#x679C;&#x4F7F;&#x7528;&#x4F4D;&#x7F6E;&#x7EC4;&#xFF0C;&#x5219;&#x4F7F;&#x7528;&#x4F4D;&#x7F6E;&#x53C2;&#x6570;&#x901A;&#x8FC7;<code class="docutils literal"><span class="pre">* map&#xFF08;int&#xFF0C;</span> <span class="pre">match_obj.groups&#xFF08;0&#xFF09;&#xFF09;</span>&#x8C03;&#x7528;date T0&gt;&#x3002;</code></span></li></ul></td></tr></tbody></table></dd></dl><dl class="class"><dt id="sqlalchemy.dialects.sqlite.TIME"><span class="yiyi-st" id="yiyi-218"> <em class="property">class </em><code class="descclassname">sqlalchemy.dialects.sqlite.</code><code class="descname">TIME</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.sqlite.TIME" title="Permalink to this definition">&#xB6;</a></span></dt><dd><p><span class="yiyi-st" id="yiyi-219">&#x57FA;&#x7840;&#xFF1A;<code class="xref py py-class docutils literal"><span class="pre">sqlalchemy.dialects.sqlite.base._DateTimeMixin</span></code>&#xFF0C;<a class="reference internal" href="core_type_basics.html#sqlalchemy.types.Time" title="sqlalchemy.types.Time"><code class="xref py py-class docutils literal"><span class="pre">sqlalchemy.types.Time</span></code></a></span></p><p><span class="yiyi-st" id="yiyi-220">&#x4F7F;&#x7528;&#x5B57;&#x7B26;&#x4E32;&#x5728;SQLite&#x4E2D;&#x8868;&#x793A;&#x4E00;&#x4E2A;Python&#x65F6;&#x95F4;&#x5BF9;&#x8C61;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-221">&#x9ED8;&#x8BA4;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x5B58;&#x50A8;&#x683C;&#x5F0F;&#x662F;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="s2">&quot;</span><span class="si">%(hour)02d</span><span class="s2">:</span><span class="si">%(minute)02d</span><span class="s2">:</span><span class="si">%(second)02d</span><span class="s2">.</span><span class="si">%(microsecond)06d</span><span class="s2">&quot;</span></pre></div></div><p><span class="yiyi-st" id="yiyi-222">&#x4F8B;&#x5982;&#x3002;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>12:05:57.10558</pre></div></div><p><span class="yiyi-st" id="yiyi-223">&#x5B58;&#x50A8;&#x683C;&#x5F0F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">storage_format</span></code>&#x548C;<code class="docutils literal"><span class="pre">regexp</span></code>&#x53C2;&#x6570;&#x8FDB;&#x884C;&#x4E00;&#x5B9A;&#x7A0B;&#x5EA6;&#x7684;&#x81EA;&#x5B9A;&#x4E49;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.dialects.sqlite</span> <span class="kn">import</span> <span class="n">TIME</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">TIME</span><span class="p">(</span>
    <span class="n">storage_format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(hour)02d</span><span class="s2">-</span><span class="si">%(minute)02d</span><span class="s2">-</span><span class="si">%(second)02d</span><span class="s2">-</span><span class="si">%(microsecond)06d</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">regexp</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;(\d+)-(\d+)-(\d+)-(?:-(\d+))?&quot;</span><span class="p">)</span>
<span class="p">)</span></pre></div></div><table class="docutils field-list" frame="void" rules="none"><tbody valign="top"><tr class="field-odd field"><th class="field-name"><span class="yiyi-st" id="yiyi-224">&#x53C2;&#x6570;&#xFF1A;</span></th><td class="field-body"><ul class="first last simple"><li><span class="yiyi-st" id="yiyi-225"><span class="target" id="sqlalchemy.dialects.sqlite.TIME.params.storage_format">  T0&gt; <strong> storage_format  T1&gt; <a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.sqlite.TIME.params.storage_format">&#xB6; T2&gt;  - &#x5C06;&#x88AB;&#x65BD;&#x52A0;&#x5230;&#x5B57;&#x5178;&#x8FDE;&#x952E;&#x65F6;&#xFF0C;&#x5206;&#xFF0C;&#x79D2;&#x548C;&#x5FAE;&#x79D2;&#x683C;&#x5F0F;&#x5B57;&#x7B26;&#x4E32;&#x3002;</a></strong></span></span></li><li><span class="yiyi-st" id="yiyi-226"><span class="target" id="sqlalchemy.dialects.sqlite.TIME.params.regexp"></span><strong>regexp</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.sqlite.TIME.params.regexp">&#xB6;</a> &#x2013; regular expression which will be applied to incoming result rows. </span><span class="yiyi-st" id="yiyi-227">&#x5982;&#x679C;&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;&#x5305;&#x542B;&#x547D;&#x540D;&#x7EC4;&#xFF0C;&#x5219;&#x6240;&#x5F97;&#x5339;&#x914D;&#x5B57;&#x5178;&#x4F5C;&#x4E3A;&#x5173;&#x952E;&#x5B57;&#x53C2;&#x6570;&#x5E94;&#x7528;&#x4E8E;Python time()&#x6784;&#x9020;&#x51FD;&#x6570;&#x3002;</span><span class="yiyi-st" id="yiyi-228">&#x5426;&#x5219;&#xFF0C;&#x5982;&#x679C;&#x4F7F;&#x7528;&#x4F4D;&#x7F6E;&#x7EC4;&#xFF0C;time()&#x6784;&#x9020;&#x51FD;&#x6570;&#x5C06;&#x901A;&#x8FC7;&#x4F4D;&#x7F6E;&#x53C2;&#x6570;&#x901A;&#x8FC7;<code class="docutils literal"><span class="pre">* map&#xFF08;int&#xFF0C;</span> <span class="pre">match_obj.groups&#xFF08;0&#xFF09;&#xFF09;</span> T0&gt;&#x3002;</code></span></li></ul></td></tr></tbody></table></dd></dl></div><div class="section" id="module-sqlalchemy.dialects.sqlite.pysqlite"><h2><span class="yiyi-st" id="yiyi-229">Pysqlite <a class="headerlink" href="#module-sqlalchemy.dialects.sqlite.pysqlite" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h2><p><span class="yiyi-st" id="yiyi-230">&#x901A;&#x8FC7;pysqlite&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x652F;&#x6301;SQLite&#x6570;&#x636E;&#x5E93;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-231">&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;<code class="docutils literal"><span class="pre">pysqlite</span></code>&#x4E0E;Python&#x53D1;&#x884C;&#x7248;&#x4E2D;&#x5305;&#x542B;&#x7684;<code class="docutils literal"><span class="pre">sqlite3</span></code>&#x6A21;&#x5757;&#x662F;&#x76F8;&#x540C;&#x7684;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x3002;</span></p><div class="section" id="dialect-sqlite-pysqlite-url"><h3><span class="yiyi-st" id="yiyi-232">DBAPI <a class="headerlink" href="#dialect-sqlite-pysqlite-url" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h3><p><span class="yiyi-st" id="yiyi-233">pysqlite&#x7684;&#x6587;&#x6863;&#x548C;&#x4E0B;&#x8F7D;&#x4FE1;&#x606F;&#xFF08;&#x5982;&#x679C;&#x9002;&#x7528;&#xFF09;&#x53EF;&#x5728;&#x4EE5;&#x4E0B;&#x7F51;&#x5740;&#x83B7;&#x5F97;&#xFF1A;<a class="reference external" href="http://docs.python.org/library/sqlite3.html">http://docs.python.org/library/sqlite3.html</a></span></p></div><div class="section" id="dialect-sqlite-pysqlite-connect"><h3><span class="yiyi-st" id="yiyi-234">&#x8FDE;&#x63A5;<a class="headerlink" href="#dialect-sqlite-pysqlite-connect" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h3><p><span class="yiyi-st" id="yiyi-235">&#x8FDE;&#x63A5;&#x5B57;&#x7B26;&#x4E32;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>sqlite+pysqlite:///file_path</pre></div></div></div><div class="section" id="driver"><h3><span class="yiyi-st" id="yiyi-236">&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;<a class="headerlink" href="#driver" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h3><p><span class="yiyi-st" id="yiyi-237">&#x5F53;&#x4F7F;&#x7528;Python 2.5&#x6216;&#x66F4;&#x9AD8;&#x7248;&#x672C;&#x65F6;&#xFF0C;&#x5185;&#x7F6E;&#x7684;<code class="docutils literal"><span class="pre">sqlite3</span></code>&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x5DF2;&#x7ECF;&#x5B89;&#x88C5;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x989D;&#x5916;&#x7684;&#x5B89;&#x88C5;&#x3002;</span><span class="yiyi-st" id="yiyi-238">&#x5426;&#x5219;&#xFF0C;&#x9700;&#x8981;&#x5B58;&#x5728;<code class="docutils literal"><span class="pre">pysqlite2</span></code>&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x3002;</span><span class="yiyi-st" id="yiyi-239">&#x8FD9;&#x4E0E;<code class="docutils literal"><span class="pre">sqlite3</span></code>&#x662F;&#x76F8;&#x540C;&#x7684;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#xFF0C;&#x53EA;&#x662F;&#x540D;&#x79F0;&#x4E0D;&#x540C;&#x800C;&#x5DF2;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-240"><code class="docutils literal"><span class="pre">pysqlite2</span></code>&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x5C06;&#x9996;&#x5148;&#x52A0;&#x8F7D;&#xFF0C;&#x5982;&#x679C;&#x672A;&#x627E;&#x5230;&#xFF0C;&#x5219;&#x52A0;&#x8F7D;<code class="docutils literal"><span class="pre">sqlite3</span></code>&#x3002;</span><span class="yiyi-st" id="yiyi-241">&#x8FD9;&#x5141;&#x8BB8;&#x660E;&#x786E;&#x5B89;&#x88C5;&#x7684;pysqlite&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x4F18;&#x5148;&#x4E8E;&#x5185;&#x7F6E;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x3002;</span><span class="yiyi-st" id="yiyi-242">As with all dialects, a specific DBAPI module may be provided to <a class="reference internal" href="core_engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal"><span class="pre">create_engine()</span></code></a> to control this explicitly:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlite3</span> <span class="kn">import</span> <span class="n">dbapi2</span> <span class="k">as</span> <span class="n">sqlite</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&apos;sqlite+pysqlite:///file.db&apos;</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="n">sqlite</span><span class="p">)</span></pre></div></div></div><div class="section" id="connect-strings"><h3><span class="yiyi-st" id="yiyi-243">&#x8FDE;&#x63A5;&#x5B57;&#x7B26;&#x4E32;<a class="headerlink" href="#connect-strings" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-244">SQLite&#x6570;&#x636E;&#x5E93;&#x7684;&#x6587;&#x4EF6;&#x89C4;&#x8303;&#x88AB;&#x8BA4;&#x4E3A;&#x662F;URL&#x7684;&#x201C;&#x6570;&#x636E;&#x5E93;&#x201D;&#x90E8;&#x5206;&#x3002;</span><span class="yiyi-st" id="yiyi-245">&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;SQLAlchemy&#x7F51;&#x5740;&#x7684;&#x683C;&#x5F0F;&#x662F;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>driver://user:pass@host/database</pre></div></div><p><span class="yiyi-st" id="yiyi-246">&#x8FD9;&#x610F;&#x5473;&#x7740;&#x8981;&#x4F7F;&#x7528;&#x7684;&#x5B9E;&#x9645;&#x6587;&#x4EF6;&#x540D;&#x4EE5;&#x7B2C;&#x4E09;&#x4E2A;&#x659C;&#x6760;&#x7684;<strong>&#x53F3;&#x4FA7;</strong>&#x4E2D;&#x7684;&#x5B57;&#x7B26;&#x5F00;&#x5934;&#x3002;</span><span class="yiyi-st" id="yiyi-247">&#x56E0;&#x6B64;&#x8FDE;&#x63A5;&#x5230;&#x76F8;&#x5BF9;&#x7684;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># relative path</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&apos;sqlite:///path/to/database.db&apos;</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-248">&#x7EDD;&#x5BF9;&#x8DEF;&#x5F84;&#xFF0C;&#x4EE5;&#x659C;&#x6760;&#x5F00;&#x59CB;&#xFF0C;&#x8868;&#x793A;&#x60A8;&#x9700;&#x8981;<strong>&#x56DB;&#x4E2A;</strong>&#x659C;&#x7EBF;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># absolute path</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&apos;sqlite:////path/to/database.db&apos;</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-249">&#x8981;&#x4F7F;&#x7528;Windows&#x8DEF;&#x5F84;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5E38;&#x89C4;&#x7684;&#x9A71;&#x52A8;&#x5668;&#x89C4;&#x683C;&#x548C;&#x53CD;&#x659C;&#x6760;&#x3002;</span><span class="yiyi-st" id="yiyi-250">&#x53EF;&#x80FD;&#x9700;&#x8981;&#x53CC;&#x53CD;&#x659C;&#x6760;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># absolute path on Windows</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&apos;sqlite:///C:</span><span class="se">\\</span><span class="s1">path</span><span class="se">\\</span><span class="s1">to</span><span class="se">\\</span><span class="s1">database.db&apos;</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-251">&#x5982;&#x679C;&#x6CA1;&#x6709;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#x5B58;&#x5728;&#xFF0C;sqlite <code class="docutils literal"><span class="pre">:memory:</span></code>&#x6807;&#x8BC6;&#x7B26;&#x662F;&#x9ED8;&#x8BA4;&#x503C;&#x3002;</span><span class="yiyi-st" id="yiyi-252">&#x6307;&#x5B9A;<code class="docutils literal"><span class="pre">sqlite://</span></code>&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x522B;&#x7684;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># in-memory database</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&apos;sqlite://&apos;</span><span class="p">)</span></pre></div></div></div><div class="section" id="compatibility-with-sqlite3-native-date-and-datetime-types"><h3><span class="yiyi-st" id="yiyi-253">&#x4E0E;sqlite3&#x201C;native&#x201D;&#x65E5;&#x671F;&#x548C;&#x65E5;&#x671F;&#x65F6;&#x95F4;&#x7C7B;&#x578B;&#x517C;&#x5BB9;<a class="headerlink" href="#compatibility-with-sqlite3-native-date-and-datetime-types" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-254">pysqlite&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x5305;&#x62EC;sqlite3.PARSE_DECLTYPES&#x548C;sqlite3.PARSE_COLNAMES&#x9009;&#x9879;&#xFF0C;&#x8FD9;&#x4E9B;&#x9009;&#x9879;&#x4F1A;&#x5C06;&#x663E;&#x5F0F;&#x8F6C;&#x6362;&#x4E3A;&#x201C;date&#x201D;&#x6216;&#x201C;timestamp&#x201D;&#x7684;&#x4EFB;&#x4F55;&#x5217;&#x6216;&#x8868;&#x8FBE;&#x5F0F;&#x8F6C;&#x6362;&#x4E3A;Python&#x65E5;&#x671F;&#x6216;&#x65E5;&#x671F;&#x65F6;&#x95F4;&#x5BF9;&#x8C61;&#x3002;</span><span class="yiyi-st" id="yiyi-255">pysqlite&#x65B9;&#x8A00;&#x63D0;&#x4F9B;&#x7684;&#x65E5;&#x671F;&#x548C;&#x65E5;&#x671F;&#x65F6;&#x95F4;&#x7C7B;&#x578B;&#x76EE;&#x524D;&#x4E0E;&#x8FD9;&#x4E9B;&#x9009;&#x9879;&#x4E0D;&#x517C;&#x5BB9;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x5448;&#x73B0;ISO&#x65E5;&#x671F;/&#x65E5;&#x671F;&#x65F6;&#x95F4;&#xFF08;&#x5305;&#x62EC;&#x5FAE;&#x79D2;&#xFF09;&#xFF0C;&#x800C;pysqlite&#x7684;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x5374;&#x6CA1;&#x6709;&#x3002;</span><span class="yiyi-st" id="yiyi-256">&#x6B64;&#x5916;&#xFF0C;SQLAlchemy&#x76EE;&#x524D;&#x4E0D;&#x4F1A;&#x81EA;&#x52A8;&#x5448;&#x73B0;&#x72EC;&#x7ACB;&#x51FD;&#x6570;&#x201C;current_timestamp&#x201D;&#x548C;&#x201C;current_date&#x201D;&#x6240;&#x9700;&#x7684;&#x201C;&#x5F3A;&#x5236;&#x8F6C;&#x6362;&#x201D;&#x8BED;&#x6CD5;&#xFF0C;&#x4EE5;&#x4FBF;&#x672C;&#x673A;&#x8FD4;&#x56DE;datetime / date&#x7C7B;&#x578B;&#x3002;</span><span class="yiyi-st" id="yiyi-257">&#x4E0D;&#x5E78;&#x7684;&#x662F;&#xFF0C;pysqlite&#x6CA1;&#x6709;&#x5728;<code class="docutils literal"><span class="pre">cursor.description</span></code>&#x4E2D;&#x63D0;&#x4F9B;&#x6807;&#x51C6;DBAPI&#x7C7B;&#x578B;&#xFF0C;&#x4F7F;&#x5F97;SQLAlchemy&#x65E0;&#x6CD5;&#x5728;&#x6CA1;&#x6709;&#x6602;&#x8D35;&#x7684;&#x6BCF;&#x884C;&#x7C7B;&#x578B;&#x68C0;&#x67E5;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x5373;&#x65F6;&#x68C0;&#x6D4B;&#x8FD9;&#x4E9B;&#x7C7B;&#x578B;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-258">&#x8BF7;&#x8BB0;&#x4F4F;&#xFF0C;&#x5EFA;&#x8BAE;&#x4E0D;&#x8981;&#x4F7F;&#x7528;pysqlite&#x7684;&#x89E3;&#x6790;&#x9009;&#x9879;&#xFF0C;&#x4E5F;&#x4E0D;&#x9700;&#x8981;&#x4F7F;&#x7528;SQLAlchemy&#xFF0C;&#x5982;&#x679C;&#x5728;create_engine()&#x4E0A;&#x914D;&#x7F6E;&#x4E86;&#x201C;native_datetime = True&#x201D;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x5F3A;&#x5236;&#x4F7F;&#x7528;PARSE_DECLTYPES&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&apos;sqlite://&apos;</span><span class="p">,</span>
    <span class="n">connect_args</span><span class="o">=</span><span class="p">{</span><span class="s1">&apos;detect_types&apos;</span><span class="p">:</span>
        <span class="n">sqlite3</span><span class="o">.</span><span class="n">PARSE_DECLTYPES</span><span class="o">|</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">PARSE_COLNAMES</span><span class="p">},</span>
    <span class="n">native_datetime</span><span class="o">=</span><span class="bp">True</span>
<span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-259">&#x542F;&#x7528;&#x6B64;&#x6807;&#x5FD7;&#x65F6;&#xFF0C;DATE&#x548C;TIMESTAMP&#x7C7B;&#x578B;&#xFF08;&#x4F46;&#x6CE8;&#x610F; - &#x4E0D;&#x662F;DATETIME&#x6216;TIME&#x7C7B;&#x578B;......&#x56F0;&#x60D1;&#x4E86;&#x5417;&#xFF1F;&#xFF09;</span><span class="yiyi-st" id="yiyi-260">&#x5C06;&#x4E0D;&#x6267;&#x884C;&#x4EFB;&#x4F55;&#x7ED1;&#x5B9A;&#x53C2;&#x6570;&#x6216;&#x7ED3;&#x679C;&#x5904;&#x7406;&#x3002;</span><span class="yiyi-st" id="yiyi-261">&#x6267;&#x884C;&#x201C;func.current_date()&#x201D;&#x5C06;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#x3002;</span><span class="yiyi-st" id="yiyi-262">&#x201C;func.current_timestamp()&#x201D;&#x88AB;&#x6CE8;&#x518C;&#x4E3A;&#x5728;SQLAlchemy&#x4E2D;&#x8FD4;&#x56DE;DATETIME&#x7C7B;&#x578B;&#xFF0C;&#x6240;&#x4EE5;&#x8BE5;&#x51FD;&#x6570;&#x4ECD;&#x7136;&#x63A5;&#x6536;SQLAlchemy&#x7EA7;&#x522B;&#x7684;&#x7ED3;&#x679C;&#x5904;&#x7406;&#x3002;</span></p></div><div class="section" id="threading-pooling-behavior"><h3><span class="yiyi-st" id="yiyi-263">&#x7EBF;&#x7A0B;/&#x6C60;&#x5316;&#x884C;&#x4E3A;<a class="headerlink" href="#threading-pooling-behavior" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-264">Pysqlite&#x7684;&#x9ED8;&#x8BA4;&#x884C;&#x4E3A;&#x662F;&#x7981;&#x6B62;&#x5728;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x4E2D;&#x4F7F;&#x7528;&#x5355;&#x4E2A;&#x8FDE;&#x63A5;&#x3002;</span><span class="yiyi-st" id="yiyi-265">&#x8FD9;&#x672C;&#x6765;&#x662F;&#x4E3A;&#x4E86;&#x9002;&#x5E94;&#x4E0D;&#x540C;&#x73AF;&#x5883;&#x4E0B;&#x4E0D;&#x652F;&#x6301;&#x591A;&#x7EBF;&#x7A0B;&#x64CD;&#x4F5C;&#x7684;&#x65E7;&#x7248;SQLite&#x3002;</span><span class="yiyi-st" id="yiyi-266">&#x7279;&#x522B;&#x662F;&#xFF0C;&#x5728;&#x4EFB;&#x4F55;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8F83;&#x65E7;&#x7684;SQLite&#x7248;&#x672C;&#x90FD;&#x4E0D;&#x5141;&#x8BB8;&#x5728;&#x591A;&#x7EBF;&#x7A0B;&#x4E2D;&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">:memory:</span></code>&#x6570;&#x636E;&#x5E93;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-267">Pysqlite&#x786E;&#x5B9E;&#x5305;&#x542B;&#x4E00;&#x4E2A;&#x540D;&#x4E3A;<code class="docutils literal"><span class="pre">check_same_thread</span></code>&#x7684;now-undocumented&#x6807;&#x5FD7;&#xFF0C;&#x5B83;&#x5C06;&#x7981;&#x7528;&#x6B64;&#x68C0;&#x67E5;&#xFF0C;&#x4F46;&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;pysqlite&#x8FDE;&#x63A5;&#x5728;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x4E2D;&#x5E76;&#x53D1;&#x4F7F;&#x7528;&#x4ECD;&#x7136;&#x4E0D;&#x5B89;&#x5168;&#x3002;</span><span class="yiyi-st" id="yiyi-268">&#x7279;&#x522B;&#x662F;&#xFF0C;&#x4EFB;&#x4F55;&#x8BED;&#x53E5;&#x6267;&#x884C;&#x8C03;&#x7528;&#x90FD;&#x9700;&#x8981;&#x5916;&#x90E8;&#x4E92;&#x65A5;&#xFF0C;&#x56E0;&#x4E3A;Pysqlite&#x4E0D;&#x4F1A;&#x63D0;&#x4F9B;&#x9519;&#x8BEF;&#x6D88;&#x606F;&#x7684;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x4F20;&#x64AD;&#x7B49;&#x3002;</span><span class="yiyi-st" id="yiyi-269">&#x56E0;&#x6B64;&#xFF0C;&#x5C3D;&#x7BA1;&#x5373;&#x4F7F;<code class="docutils literal"><span class="pre">:memory:</span></code>&#x6570;&#x636E;&#x5E93;&#x53EF;&#x4EE5;&#x5728;&#x73B0;&#x4EE3;SQLite&#x7684;&#x7EBF;&#x7A0B;&#x4E4B;&#x95F4;&#x5171;&#x4EAB;&#xFF0C;Pysqlite&#x4E5F;&#x4E0D;&#x80FD;&#x63D0;&#x4F9B;&#x8DB3;&#x591F;&#x7684;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x6027;&#x6765;&#x4F7F;&#x6B64;&#x7528;&#x6CD5;&#x503C;&#x5F97;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-270">SQLAlchemy&#x8BBE;&#x7F6E;&#x6C60;&#x4EE5;&#x4F7F;&#x7528;Pysqlite&#x7684;&#x9ED8;&#x8BA4;&#x884C;&#x4E3A;&#xFF1A;</span></p><ul><li><p class="first"><span class="yiyi-st" id="yiyi-271">&#x5F53;&#x6307;&#x5B9A;<code class="docutils literal"><span class="pre">:memory:</span></code> SQLite&#x6570;&#x636E;&#x5E93;&#x65F6;&#xFF0C;&#x7F3A;&#x7701;&#x65B9;&#x8A00;&#x5C06;&#x4F7F;&#x7528;<a class="reference internal" href="core_pooling.html#sqlalchemy.pool.SingletonThreadPool" title="sqlalchemy.pool.SingletonThreadPool"><code class="xref py py-class docutils literal"><span class="pre">SingletonThreadPool</span></code></a>&#x3002;</span><span class="yiyi-st" id="yiyi-272">&#x8BE5;&#x6C60;&#x4E3A;&#x6BCF;&#x4E2A;&#x7EBF;&#x7A0B;&#x7EF4;&#x62A4;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;&#xFF0C;&#x4EE5;&#x4FBF;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x4E2D;&#x5BF9;&#x5F15;&#x64CE;&#x7684;&#x6240;&#x6709;&#x8BBF;&#x95EE;&#x4F7F;&#x7528;&#x76F8;&#x540C;&#x7684;<code class="docutils literal"><span class="pre">:memory:</span></code>&#x6570;&#x636E;&#x5E93; - &#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x5C06;&#x8BBF;&#x95EE;&#x4E0D;&#x540C;&#x7684;<code class="docutils literal"><span class="pre">:memory:</span></code></span></p></li><li><p class="first"><span class="yiyi-st" id="yiyi-273">&#x5F53;&#x6307;&#x5B9A;&#x57FA;&#x4E8E;&#x6587;&#x4EF6;&#x7684;&#x6570;&#x636E;&#x5E93;&#x65F6;&#xFF0C;&#x65B9;&#x8A00;&#x5C06;&#x4F7F;&#x7528;<a class="reference internal" href="core_pooling.html#sqlalchemy.pool.NullPool" title="sqlalchemy.pool.NullPool"><code class="xref py py-class docutils literal"><span class="pre">NullPool</span></code></a>&#x4F5C;&#x4E3A;&#x8FDE;&#x63A5;&#x7684;&#x6765;&#x6E90;&#x3002;</span><span class="yiyi-st" id="yiyi-274">&#x6B64;&#x6C60;&#x5173;&#x95ED;&#x5E76;&#x4E22;&#x5F03;&#x7ACB;&#x5373;&#x8FD4;&#x56DE;&#x5230;&#x6C60;&#x7684;&#x8FDE;&#x63A5;&#x3002;</span><span class="yiyi-st" id="yiyi-275">&#x57FA;&#x4E8E;SQLite&#x6587;&#x4EF6;&#x7684;&#x8FDE;&#x63A5;&#x5F00;&#x9500;&#x975E;&#x5E38;&#x4F4E;&#xFF0C;&#x56E0;&#x6B64;&#x5E76;&#x4E0D;&#x662F;&#x5FC5;&#x9700;&#x7684;&#x3002;</span><span class="yiyi-st" id="yiyi-276">&#x8BE5;&#x65B9;&#x6848;&#x8FD8;&#x53EF;&#x4EE5;&#x9632;&#x6B62;&#x5728;&#x53E6;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x4E2D;&#x518D;&#x6B21;&#x4F7F;&#x7528;&#x8FDE;&#x63A5;&#xFF0C;&#x5E76;&#x4E14;&#x6700;&#x9002;&#x5408;SQLite&#x7684;&#x7C97;&#x7C92;&#x5EA6;&#x6587;&#x4EF6;&#x9501;&#x5B9A;&#x3002;</span></p><div class="versionchanged"><p><span class="yiyi-st" id="yiyi-277"><span class="versionmodified">&#x7248;&#x672C;0.7&#x4E2D;&#x7684;&#x66F4;&#x6539;&#xFF1A;</span>&#x9488;&#x5BF9;&#x57FA;&#x4E8E;SQLite&#x6587;&#x4EF6;&#x7684;&#x6570;&#x636E;&#x5E93;&#x7684;<a class="reference internal" href="core_pooling.html#sqlalchemy.pool.NullPool" title="sqlalchemy.pool.NullPool"><code class="xref py py-class docutils literal"><span class="pre">NullPool</span></code></a>&#x7684;&#x9ED8;&#x8BA4;&#x9009;&#x62E9;&#x3002;</span><span class="yiyi-st" id="yiyi-278">&#x4EE5;&#x524D;&#x7684;&#x7248;&#x672C;&#x9ED8;&#x8BA4;&#x4E3A;&#x6240;&#x6709;SQLite&#x6570;&#x636E;&#x5E93;&#x9009;&#x62E9;<a class="reference internal" href="core_pooling.html#sqlalchemy.pool.SingletonThreadPool" title="sqlalchemy.pool.SingletonThreadPool"><code class="xref py py-class docutils literal"><span class="pre">SingletonThreadPool</span></code></a>&#x3002;</span></p></div></li></ul><div class="section" id="using-a-memory-database-in-multiple-threads"><h4><span class="yiyi-st" id="yiyi-279">&#x5728;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x4E2D;&#x4F7F;&#x7528;&#x5185;&#x5B58;&#x6570;&#x636E;&#x5E93;<a class="headerlink" href="#using-a-memory-database-in-multiple-threads" title="Permalink to this headline">&#xB6;</a></span></h4><p><span class="yiyi-st" id="yiyi-280">&#x8981;&#x5728;&#x591A;&#x7EBF;&#x7A0B;&#x573A;&#x666F;&#x4E2D;&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">:memory:</span></code>&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x5FC5;&#x987B;&#x5728;&#x7EBF;&#x7A0B;&#x95F4;&#x5171;&#x4EAB;&#x76F8;&#x540C;&#x7684;&#x8FDE;&#x63A5;&#x5BF9;&#x8C61;&#xFF0C;&#x56E0;&#x4E3A;&#x6570;&#x636E;&#x5E93;&#x4EC5;&#x5B58;&#x5728;&#x4E8E;&#x8BE5;&#x8FDE;&#x63A5;&#x7684;&#x8303;&#x56F4;&#x5185;&#x3002;</span><span class="yiyi-st" id="yiyi-281"><a class="reference internal" href="core_pooling.html#sqlalchemy.pool.StaticPool" title="sqlalchemy.pool.StaticPool"><code class="xref py py-class docutils literal"><span class="pre">StaticPool</span></code></a>&#x5B9E;&#x73B0;&#x5C06;&#x5168;&#x5C40;&#x7EF4;&#x62A4;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;&#xFF0C;&#x5E76;&#x4E14;<code class="docutils literal"><span class="pre">check_same_thread</span></code>&#x6807;&#x5FD7;&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;<code class="docutils literal"><span class="pre">False</span></code>&#x4F20;&#x9012;&#x7ED9;Pysqlite&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.pool</span> <span class="kn">import</span> <span class="n">StaticPool</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&apos;sqlite://&apos;</span><span class="p">,</span>
                    <span class="n">connect_args</span><span class="o">=</span><span class="p">{</span><span class="s1">&apos;check_same_thread&apos;</span><span class="p">:</span><span class="bp">False</span><span class="p">},</span>
                    <span class="n">poolclass</span><span class="o">=</span><span class="n">StaticPool</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-282">&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x5728;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x4E2D;&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">:memory:</span></code>&#x6570;&#x636E;&#x5E93;&#x9700;&#x8981;&#x6700;&#x65B0;&#x7248;&#x672C;&#x7684;SQLite&#x3002;</span></p></div><div class="section" id="using-temporary-tables-with-sqlite"><h4><span class="yiyi-st" id="yiyi-283">&#x5728;SQLite&#x4E2D;&#x4F7F;&#x7528;&#x4E34;&#x65F6;&#x8868;<a class="headerlink" href="#using-temporary-tables-with-sqlite" title="Permalink to this headline">&#xB6;</a></span></h4><p><span class="yiyi-st" id="yiyi-284">&#x7531;&#x4E8E;SQLite&#x5904;&#x7406;&#x4E34;&#x65F6;&#x8868;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x5982;&#x679C;&#x60A8;&#x5E0C;&#x671B;&#x5728;&#x8DE8;&#x8FDE;&#x63A5;&#x6C60;&#x7684;&#x591A;&#x4E2A;&#x7B7E;&#x51FA;&#x7684;&#x57FA;&#x4E8E;&#x6587;&#x4EF6;&#x7684;SQLite&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x4F7F;&#x7528;&#x4E34;&#x65F6;&#x8868;&#xFF0C;&#x4F8B;&#x5982;&#x5728;&#x4F7F;&#x7528;&#x4E34;&#x65F6;&#x8868;&#x7684;ORM <a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x65F6;&#x4E34;&#x65F6;&#x8868;&#x8868;&#x5E94;&#x8BE5;&#x5728;<a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session.commit" title="sqlalchemy.orm.session.Session.commit"><code class="xref py py-meth docutils literal"><span class="pre">Session.commit()</span></code></a>&#x6216;<a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session.rollback" title="sqlalchemy.orm.session.Session.rollback"><code class="xref py py-meth docutils literal"><span class="pre">Session.rollback()</span></code></a>&#x4E4B;&#x540E;&#x7EE7;&#x7EED;&#x4FDD;&#x6301;&#xFF0C;&#x5FC5;&#x987B;&#x4F7F;&#x7528;&#x7EF4;&#x62A4;&#x5355;&#x4E2A;&#x8FDE;&#x63A5;&#x7684;&#x6C60;&#x3002;</span><span class="yiyi-st" id="yiyi-285">&#x5982;&#x679C;&#x4EC5;&#x5728;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x4E2D;&#x9700;&#x8981;&#x4F5C;&#x7528;&#x57DF;&#xFF0C;&#x5219;&#x4F7F;&#x7528;<a class="reference internal" href="core_pooling.html#sqlalchemy.pool.SingletonThreadPool" title="sqlalchemy.pool.SingletonThreadPool"><code class="xref py py-class docutils literal"><span class="pre">SingletonThreadPool</span></code></a>&#xFF0C;&#x6216;&#x8005;&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x5185;&#x9700;&#x8981;<a class="reference internal" href="core_pooling.html#sqlalchemy.pool.StaticPool" title="sqlalchemy.pool.StaticPool"><code class="xref py py-class docutils literal"><span class="pre">StaticPool</span></code></a>&#x4F5C;&#x7528;&#x57DF;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># maintain the same connection per thread</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.pool</span> <span class="kn">import</span> <span class="n">SingletonThreadPool</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&apos;sqlite:///mydb.db&apos;</span><span class="p">,</span>
                    <span class="n">poolclass</span><span class="o">=</span><span class="n">SingletonThreadPool</span><span class="p">)</span>


<span class="c1"># maintain the same connection across all threads</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.pool</span> <span class="kn">import</span> <span class="n">StaticPool</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&apos;sqlite:///mydb.db&apos;</span><span class="p">,</span>
                    <span class="n">poolclass</span><span class="o">=</span><span class="n">StaticPool</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-286">&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x5E94;&#x8BE5;&#x4E3A;&#x8981;&#x4F7F;&#x7528;&#x7684;&#x7EBF;&#x7A0B;&#x6570;&#x914D;&#x7F6E;<a class="reference internal" href="core_pooling.html#sqlalchemy.pool.SingletonThreadPool" title="sqlalchemy.pool.SingletonThreadPool"><code class="xref py py-class docutils literal"><span class="pre">SingletonThreadPool</span></code></a>&#xFF1B;&#x8D85;&#x8FC7;&#x8FD9;&#x4E2A;&#x6570;&#x5B57;&#xFF0C;&#x8FDE;&#x63A5;&#x5C06;&#x4EE5;&#x975E;&#x786E;&#x5B9A;&#x6027;&#x7684;&#x65B9;&#x5F0F;&#x88AB;&#x5173;&#x95ED;&#x3002;</span></p></div></div><div class="section" id="unicode"><h3><span class="yiyi-st" id="yiyi-287">Unicode&#x7684;<a class="headerlink" href="#unicode" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h3><p><span class="yiyi-st" id="yiyi-288">pysqlite&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x53EA;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x96C6;&#x4E2D;&#x7684;Python <code class="docutils literal"><span class="pre">unicode</span></code>&#x5BF9;&#x8C61;&#xFF0C;&#x4ECE;&#x4E0D;&#x4F7F;&#x7528;&#x666E;&#x901A;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x5E76;&#x4E14;&#x5728;&#x6240;&#x6709;&#x60C5;&#x51B5;&#x4E0B;&#x90FD;&#x53EF;&#x4EE5;&#x5728;&#x7ED1;&#x5B9A;&#x53C2;&#x6570;&#x503C;&#x4E2D;&#x5BB9;&#x7EB3;<code class="docutils literal"><span class="pre">unicode</span></code>&#x5BF9;&#x8C61;&#x3002;</span><span class="yiyi-st" id="yiyi-289">&#x65E0;&#x8BBA;&#x4F7F;&#x7528;&#x54EA;&#x79CD;SQLAlchemy&#x5B57;&#x7B26;&#x4E32;&#x7C7B;&#x578B;&#xFF0C;Python 2&#x4E2D;&#x7684;Python <code class="docutils literal"><span class="pre">unicode</span></code>&#x90FD;&#x5C06;&#x57FA;&#x4E8E;&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x7ED3;&#x679C;&#x503C;&#x3002;</span><span class="yiyi-st" id="yiyi-290">&#x4F46;&#x4ECD;&#x7136;&#x5E94;&#x8BE5;&#x4F7F;&#x7528;<a class="reference internal" href="core_type_basics.html#sqlalchemy.types.Unicode" title="sqlalchemy.types.Unicode"><code class="xref py py-class docutils literal"><span class="pre">Unicode</span></code></a>&#x7C7B;&#x578B;&#x6765;&#x6307;&#x793A;&#x90A3;&#x4E9B;&#x9700;&#x8981;unicode&#x7684;&#x5217;&#xFF0C;&#x4EE5;&#x4FBF;&#x975E;&#x6545;&#x610F;&#x4F20;&#x9012;&#x7684;&#x975E;<code class="docutils literal"><span class="pre">unicode</span></code>&#x503C;&#x4F1A;&#x53D1;&#x51FA;&#x8B66;&#x544A;&#x3002;</span><span class="yiyi-st" id="yiyi-291">&#x5982;&#x679C;&#x4F20;&#x9012;&#x5305;&#x542B;&#x975E;ASCII&#x5B57;&#x7B26;&#x7684;&#x975E;<code class="docutils literal"><span class="pre">unicode</span></code>&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x5219;Pysqlite&#x5C06;&#x53D1;&#x51FA;&#x9519;&#x8BEF;&#x3002;</span></p></div><div class="section" id="serializable-isolation-savepoints-transactional-ddl"><h3><span class="yiyi-st" id="yiyi-292">&#x53EF;&#x4E32;&#x884C;&#x5316;&#x9694;&#x79BB;/&#x4FDD;&#x5B58;&#x70B9;/&#x4E8B;&#x52A1;&#x6027;DDL <a class="headerlink" href="#serializable-isolation-savepoints-transactional-ddl" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-293">&#x5728;<a class="reference internal" href="#sqlite-concurrency"><span>Database Locking Behavior / Concurrency</span></a>&#x90E8;&#x5206;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5F15;&#x7528;&#x4E86;pysqlite&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x7684;&#x5404;&#x79CD;&#x95EE;&#x9898;&#xFF0C;&#x8FD9;&#x4E9B;&#x95EE;&#x9898;&#x963B;&#x6B62;SQLite&#x7684;&#x51E0;&#x4E2A;&#x529F;&#x80FD;&#x6B63;&#x5E38;&#x5DE5;&#x4F5C;&#x3002;</span><span class="yiyi-st" id="yiyi-294">pysqlite DBAPI&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x6709;&#x51E0;&#x4E2A;&#x957F;&#x671F;&#x5B58;&#x5728;&#x7684;&#x9519;&#x8BEF;&#x4F1A;&#x5F71;&#x54CD;&#x5176;&#x4EA4;&#x6613;&#x884C;&#x4E3A;&#x7684;&#x6B63;&#x786E;&#x6027;&#x3002;</span><span class="yiyi-st" id="yiyi-295">&#x5728;&#x9ED8;&#x8BA4;&#x64CD;&#x4F5C;&#x6A21;&#x5F0F;&#x4E0B;&#xFF0C;SQLite&#x529F;&#x80FD;&#xFF08;&#x5982;SERIALIZABLE&#x9694;&#x79BB;&#xFF0C;&#x4E8B;&#x52A1;&#x6027;DDL&#x548C;SAVEPOINT&#x652F;&#x6301;&#xFF09;&#x4E0D;&#x8D77;&#x4F5C;&#x7528;&#xFF0C;&#x4E3A;&#x4E86;&#x4F7F;&#x7528;&#x8FD9;&#x4E9B;&#x529F;&#x80FD;&#xFF0C;&#x5FC5;&#x987B;&#x91C7;&#x53D6;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-296">&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x57FA;&#x672C;&#x4E0A;&#x662F;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x5C1D;&#x8BD5;&#x7B2C;&#x4E8C;&#x6B21;&#x731C;&#x6D4B;&#x7528;&#x6237;&#x7684;&#x610F;&#x56FE;&#xFF0C;&#x65E0;&#x6CD5;&#x542F;&#x52A8;&#x4E8B;&#x52A1;&#x5E76;&#x4E14;&#x6709;&#x65F6;&#x4F1A;&#x8FC7;&#x65E9;&#x7ED3;&#x675F;&#x5B83;&#x4EEC;&#xFF0C;&#x4EE5;&#x5C3D;&#x91CF;&#x51CF;&#x5C11;SQLite&#x6570;&#x636E;&#x5E93;&#x7684;&#x6587;&#x4EF6;&#x9501;&#x5B9A;&#x884C;&#x4E3A;&#xFF0C;&#x5C3D;&#x7BA1;SQLite&#x672C;&#x8EAB;&#x4F7F;&#x7528;&#x201C;&#x5171;&#x4EAB;&#x201D;&#x9501;&#x6765;&#x8FDB;&#x884C;&#x53EA;&#x8BFB;&#x64CD;&#x4F5C;&#xFF0C;&#x53EA;&#x6709;&#x6D3B;&#x52A8;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-297">SQLAlchemy&#x9ED8;&#x8BA4;&#x9009;&#x62E9;&#x4E0D;&#x6539;&#x53D8;&#x8FD9;&#x79CD;&#x884C;&#x4E3A;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x662F;pysqlite&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x7684;&#x957F;&#x671F;&#x9884;&#x671F;&#x884C;&#x4E3A;&#xFF1B;&#x5982;&#x679C;&#x5F53;pysqlite&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x5C1D;&#x8BD5;&#x4FEE;&#x590D;&#x8FD9;&#x4E9B;&#x95EE;&#x9898;&#x65F6;&#xFF0C;&#x8FD9;&#x5C06;&#x6210;&#x4E3A;&#x66F4;&#x591A;SQLAlchemy&#x9ED8;&#x8BA4;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x7684;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-298">&#x597D;&#x6D88;&#x606F;&#x662F;&#xFF0C;&#x901A;&#x8FC7;&#x4E00;&#x4E9B;&#x4E8B;&#x4EF6;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5B8C;&#x5168;&#x5B9E;&#x73B0;&#x4E8B;&#x52A1;&#x6027;&#x652F;&#x6301;&#xFF0C;&#x5B8C;&#x5168;&#x7981;&#x7528;pysqlite&#x7684;&#x529F;&#x80FD;&#x5E76;&#x81EA;&#x884C;&#x53D1;&#x5E03;BEGIN&#x3002;</span><span class="yiyi-st" id="yiyi-299">&#x8FD9;&#x662F;&#x901A;&#x8FC7;&#x4F7F;&#x7528;&#x4E24;&#x4E2A;&#x4E8B;&#x4EF6;&#x76D1;&#x542C;&#x5668;&#x6765;&#x5B9E;&#x73B0;&#x7684;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span><span class="p">,</span> <span class="n">event</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;sqlite:///myfile.db&quot;</span><span class="p">)</span>

<span class="nd">@event.listens_for</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="s2">&quot;connect&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">do_connect</span><span class="p">(</span><span class="n">dbapi_connection</span><span class="p">,</span> <span class="n">connection_record</span><span class="p">):</span>
    <span class="c1"># disable pysqlite&apos;s emitting of the BEGIN statement entirely.</span>
    <span class="c1"># also stops it from emitting COMMIT before any DDL.</span>
    <span class="n">dbapi_connection</span><span class="o">.</span><span class="n">isolation_level</span> <span class="o">=</span> <span class="bp">None</span>

<span class="nd">@event.listens_for</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="s2">&quot;begin&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">do_begin</span><span class="p">(</span><span class="n">conn</span><span class="p">):</span>
    <span class="c1"># emit our own BEGIN</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;BEGIN&quot;</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-300">&#x4E0A;&#x9762;&#xFF0C;&#x6211;&#x4EEC;&#x62E6;&#x622A;&#x4E00;&#x4E2A;&#x65B0;&#x7684;pysqlite&#x8FDE;&#x63A5;&#x5E76;&#x7981;&#x7528;&#x4EFB;&#x4F55;&#x4E8B;&#x52A1;&#x96C6;&#x6210;&#x3002;</span><span class="yiyi-st" id="yiyi-301">Then, at the point at which SQLAlchemy knows that transaction scope is to begin, we emit <code class="docutils literal"><span class="pre">&quot;BEGIN&quot;</span></code> ourselves.</span></p><p><span class="yiyi-st" id="yiyi-302">&#x5F53;&#x6211;&#x4EEC;&#x63A7;&#x5236;<code class="docutils literal"><span class="pre">&quot;BEGIN&quot;</span></code>&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x63A7;&#x5236;<a class="reference external" href="http://sqlite.org/lang_transaction.html">BEGIN TRANSACTION</a>&#x4E2D;&#x5F15;&#x5165;&#x7684;SQLite&#x9501;&#x5B9A;&#x6A21;&#x5F0F;&#xFF0C;&#x65B9;&#x6CD5;&#x662F;&#x5C06;&#x6240;&#x9700;&#x7684;&#x9501;&#x5B9A;&#x6A21;&#x5F0F;&#x6DFB;&#x52A0;&#x5230;&#x6211;&#x4EEC;&#x7684;<code class="docutils literal"><span class="pre">&quot;BEGIN&quot;</span></code></span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@event.listens_for</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="s2">&quot;begin&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">do_begin</span><span class="p">(</span><span class="n">conn</span><span class="p">):</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;BEGIN EXCLUSIVE&quot;</span><span class="p">)</span></pre></div></div><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-303">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p><span class="yiyi-st" id="yiyi-304"><a class="reference external" href="http://sqlite.org/lang_transaction.html">BEGIN TRANSACTION</a>  - &#x5728;SQLite&#x7F51;&#x7AD9;&#x4E0A;</span></p><p><span class="yiyi-st" id="yiyi-305"><a class="reference external" href="http://bugs.python.org/issue9924">sqlite3 SELECT does not BEGIN a transaction</a> - on the Python bug tracker</span></p><p class="last"><span class="yiyi-st" id="yiyi-306"><a class="reference external" href="http://bugs.python.org/issue10740">sqlite3 module breaks transactions and potentially corrupts data</a> - on the Python bug tracker</span></p></div></div></div><div class="section" id="module-sqlalchemy.dialects.sqlite.pysqlcipher"><h2><span class="yiyi-st" id="yiyi-307">Pysqlcipher <a class="headerlink" href="#module-sqlalchemy.dialects.sqlite.pysqlcipher" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h2><p><span class="yiyi-st" id="yiyi-308">&#x901A;&#x8FC7;pysqlcipher&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x652F;&#x6301;SQLite&#x6570;&#x636E;&#x5E93;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-309"><code class="docutils literal"><span class="pre">pysqlcipher</span></code>&#x662F;&#x4F7F;&#x7528;<a class="reference external" href="https://www.zetetic.net/sqlcipher">SQLCipher</a>&#x540E;&#x7AEF;&#x7684;&#x6807;&#x51C6;<code class="docutils literal"><span class="pre">pysqlite</span></code>&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x7684;&#x4E00;&#x4E2A;&#x5206;&#x652F;&#x3002;</span></p><div class="versionadded"><p><span class="yiyi-st" id="yiyi-310"><span class="versionmodified">&#x7248;&#x672C;0.9.9&#x4E2D;&#x7684;&#x65B0;&#x529F;&#x80FD;</span></span></p></div><div class="section" id="dialect-sqlite-pysqlcipher-url"><h3><span class="yiyi-st" id="yiyi-311">DBAPI <a class="headerlink" href="#dialect-sqlite-pysqlcipher-url" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h3><p><span class="yiyi-st" id="yiyi-312">pysqlcipher&#x7684;&#x6587;&#x6863;&#x548C;&#x4E0B;&#x8F7D;&#x4FE1;&#x606F;&#xFF08;&#x5982;&#x679C;&#x9002;&#x7528;&#xFF09;&#x53EF;&#x5728;&#x4EE5;&#x4E0B;&#x7F51;&#x5740;&#x83B7;&#x5F97;&#xFF1A;<a class="reference external" href="https://pypi.python.org/pypi/pysqlcipher">https://pypi.python.org/pypi/pysqlcipher</a></span></p></div><div class="section" id="dialect-sqlite-pysqlcipher-connect"><h3><span class="yiyi-st" id="yiyi-313">&#x8FDE;&#x63A5;<a class="headerlink" href="#dialect-sqlite-pysqlcipher-connect" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h3><p><span class="yiyi-st" id="yiyi-314">&#x8FDE;&#x63A5;&#x5B57;&#x7B26;&#x4E32;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>sqlite+pysqlcipher://:passphrase/file_path[?kdf_iter=&lt;iter&gt;]</pre></div></div></div><div class="section" id="id3"><h3><span class="yiyi-st" id="yiyi-315">&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;<a class="headerlink" href="#id3" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h3><p><span class="yiyi-st" id="yiyi-316">&#x8FD9;&#x91CC;&#x7684;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x662F;&#x4F7F;&#x7528;SQLCipher&#x5F15;&#x64CE;&#x7684;<a class="reference external" href="https://pypi.python.org/pypi/pysqlcipher">pysqlcipher</a>&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x3002;</span><span class="yiyi-st" id="yiyi-317">&#x8BE5;&#x7CFB;&#x7EDF;&#x57FA;&#x672C;&#x4E0A;&#x5411;SQLite&#x5F15;&#x5165;&#x4E86;&#x65B0;&#x7684;PRAGMA&#x547D;&#x4EE4;&#xFF0C;&#x5141;&#x8BB8;&#x8BBE;&#x7F6E;&#x5BC6;&#x7801;&#x548C;&#x5176;&#x4ED6;&#x52A0;&#x5BC6;&#x53C2;&#x6570;&#xFF0C;&#x4ECE;&#x800C;&#x5141;&#x8BB8;&#x5BF9;&#x6570;&#x636E;&#x5E93;&#x6587;&#x4EF6;&#x8FDB;&#x884C;&#x52A0;&#x5BC6;&#x3002;</span></p></div><div class="section" id="id5"><h3><span class="yiyi-st" id="yiyi-318">&#x8FDE;&#x63A5;&#x5B57;&#x7B26;&#x4E32;<a class="headerlink" href="#id5" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-319">&#x8FDE;&#x63A5;&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x683C;&#x5F0F;&#x4E0E;<a class="reference internal" href="#module-sqlalchemy.dialects.sqlite.pysqlite" title="sqlalchemy.dialects.sqlite.pysqlite"><code class="xref py py-mod docutils literal"><span class="pre">pysqlite</span></code></a>&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x7684;&#x683C;&#x5F0F;&#x76F8;&#x540C;&#xFF0C;&#x53EA;&#x662F;&#x73B0;&#x5728;&#x63A5;&#x53D7;&#x4E86;&#x201C;&#x5BC6;&#x7801;&#x201D;&#x5B57;&#x6BB5;&#xFF0C;&#x5176;&#x4E2D;&#x5E94;&#x5305;&#x542B;&#x5BC6;&#x7801;&#x77ED;&#x8BED;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&apos;sqlite+pysqlcipher://:testing@/foo.db&apos;</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-320">&#x5BF9;&#x4E8E;&#x7EDD;&#x5BF9;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#xFF0C;&#x5E94;&#x8BE5;&#x4E3A;&#x6570;&#x636E;&#x5E93;&#x540D;&#x79F0;&#x4F7F;&#x7528;&#x4E24;&#x4E2A;&#x659C;&#x6760;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&apos;sqlite+pysqlcipher://:testing@//path/to/foo.db&apos;</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-321">&#x5728;<a class="reference external" href="https://www.zetetic.net/sqlcipher/sqlcipher-api/">https://www.zetetic.net/sqlcipher/sqlcipher-api/</a>&#x4E2D;&#x8BB0;&#x5F55;&#x7684;SQLCipher&#x652F;&#x6301;&#x7684;&#x5176;&#x4ED6;&#x4E0E;&#x52A0;&#x5BC6;&#x76F8;&#x5173;&#x7684;&#x7F16;&#x8BD1;&#x6307;&#x793A;&#x7684;&#x9009;&#x62E9;&#x53EF;&#x4EE5;&#x5728;&#x67E5;&#x8BE2;&#x5B57;&#x7B26;&#x4E32;&#x4E2D;&#x4F20;&#x9012;&#xFF0C;&#x5E76;&#x4E14;&#x4F1A;&#x5BFC;&#x81F4;PRAGMA&#x88AB;&#x79F0;&#x4E3A;&#x6BCF;&#x4E2A;&#x65B0;&#x7684;&#x8FDE;&#x63A5;&#x3002;</span><span class="yiyi-st" id="yiyi-322">&#x76EE;&#x524D;&#xFF0C;&#x652F;&#x6301;<code class="docutils literal"><span class="pre">cipher</span></code>&#xFF0C;<code class="docutils literal"><span class="pre">kdf_iter</span></code> <code class="docutils literal"><span class="pre">cipher_page_size</span></code>&#x548C;<code class="docutils literal"><span class="pre">cipher_use_hmac</span></code></span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&apos;sqlite+pysqlcipher://:testing@/foo.db?cipher=aes-256-cfb&amp;kdf_iter=64000&apos;</span><span class="p">)</span></pre></div></div></div><div class="section" id="pooling-behavior"><h3><span class="yiyi-st" id="yiyi-323">&#x5408;&#x5E76;&#x884C;&#x4E3A;<a class="headerlink" href="#pooling-behavior" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-324">&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x6839;&#x636E;<a class="reference internal" href="#pysqlite-threading-pooling"><span>Threading/Pooling Behavior</span></a>&#x4E2D;&#x7684;&#x63CF;&#x8FF0;&#x66F4;&#x6539;pysqlite&#x7684;&#x9ED8;&#x8BA4;&#x6C60;&#x884C;&#x4E3A;&#x3002;</span><span class="yiyi-st" id="yiyi-325">pysqlcipher&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x7684;&#x8FDE;&#x63A5;&#x901F;&#x5EA6;&#x6BD4;pysqlite&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x6162;&#x5F97;&#x591A;&#xFF0C;&#x5F88;&#x53EF;&#x80FD;&#x662F;&#x7531;&#x4E8E;&#x52A0;&#x5BC6;&#x5F00;&#x9500;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x7684;&#x65B9;&#x8A00;&#x9ED8;&#x8BA4;&#x4F7F;&#x7528;<a class="reference internal" href="core_pooling.html#sqlalchemy.pool.SingletonThreadPool" title="sqlalchemy.pool.SingletonThreadPool"><code class="xref py py-class docutils literal"><span class="pre">SingletonThreadPool</span></code></a>&#x5B9E;&#x73B0;&#xFF0C;&#x800C;&#x4E0D;&#x662F;<a class="reference internal" href="core_pooling.html#sqlalchemy.pool.NullPool" title="sqlalchemy.pool.NullPool"><code class="xref py py-class docutils literal"><span class="pre">NullPool</span></code></a>&#x7531;pysqlite&#x4F7F;&#x7528;&#x7684;&#x6C60;&#x3002;</span><span class="yiyi-st" id="yiyi-326">As always, the pool implementation is entirely configurable using the <a class="reference internal" href="core_engines.html#sqlalchemy.create_engine.params.poolclass" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal"><span class="pre">create_engine.poolclass</span></code></a> parameter; the <a class="reference internal" href="core_pooling.html#sqlalchemy.pool.StaticPool" title="sqlalchemy.pool.StaticPool"><code class="xref py py-class docutils literal"><span class="pre">StaticPool</span></code></a> may be more feasible for single-threaded use, or <a class="reference internal" href="core_pooling.html#sqlalchemy.pool.NullPool" title="sqlalchemy.pool.NullPool"><code class="xref py py-class docutils literal"><span class="pre">NullPool</span></code></a> may be used to prevent unencrypted connections from being held open for long periods of time, at the expense of slower startup time for new connections.</span></p></div></div>