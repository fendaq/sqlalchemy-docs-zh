<h1><span class="yiyi-st" id="yiyi-136">SQLAlchemy 1.1&#x6709;&#x54EA;&#x4E9B;&#x65B0;&#x7279;&#x6027;&#xFF1F;<a class="headerlink" href="#what-s-new-in-sqlalchemy-1-1" title="Permalink to this headline">&#xB6;</a></span></h1><div class="admonition-about-this-document admonition"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-137">&#x5173;&#x4E8E;&#x672C;&#x6587;&#x6863;</span></p><p class="last"><span class="yiyi-st" id="yiyi-138">&#x672C;&#x6587;&#x6863;&#x4ECB;&#x7ECD;SQLAlchemy&#x7248;&#x672C;1.0&#x548C;SQLAlchemy&#x7248;&#x672C;1.1&#x4E4B;&#x95F4;&#x7684;&#x53D8;&#x5316;&#x3002;</span></p></div><div class="section" id="introduction"><h2><span class="yiyi-st" id="yiyi-139">&#x5F15;&#x8A00;<a class="headerlink" href="#introduction" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h2><p><span class="yiyi-st" id="yiyi-140">&#x672C;&#x6307;&#x5357;&#x4ECB;&#x7ECD;SQLAlchemy 1.1&#x7248;&#x4E2D;&#x7684;&#x65B0;&#x589E;&#x529F;&#x80FD;&#xFF0C;&#x5E76;&#x4ECB;&#x7ECD;&#x5F71;&#x54CD;&#x7528;&#x6237;&#x5C06;&#x5176;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4ECE;1.0&#x7CFB;&#x5217;SQLAlchemy&#x8FC1;&#x79FB;&#x5230;1.1&#x7684;&#x66F4;&#x6539;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-141">&#x8BF7;&#x4ED4;&#x7EC6;&#x9605;&#x8BFB;&#x5173;&#x4E8E;&#x884C;&#x4E3A;&#x53D8;&#x5316;&#x7684;&#x7AE0;&#x8282;&#xFF0C;&#x4EE5;&#x4E86;&#x89E3;&#x884C;&#x4E3A;&#x4E2D;&#x6F5C;&#x5728;&#x7684;&#x5411;&#x540E;&#x4E0D;&#x517C;&#x5BB9;&#x7684;&#x53D8;&#x5316;&#x3002;</span></p></div><div class="section" id="platform-installer-changes"><h2><span class="yiyi-st" id="yiyi-142">&#x5E73;&#x53F0;/&#x5B89;&#x88C5;&#x7A0B;&#x5E8F;&#x66F4;&#x6539;<a class="headerlink" href="#platform-installer-changes" title="Permalink to this headline">&#xB6;</a></span></h2><div class="section" id="setuptools-is-now-required-for-install"><h3><span class="yiyi-st" id="yiyi-143">Setuptools&#x73B0;&#x5728;&#x9700;&#x8981;&#x5B89;&#x88C5;<a class="headerlink" href="#setuptools-is-now-required-for-install" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-144">SQLAlchemy&#x7684;<code class="docutils literal"><span class="pre">setup.py</span></code>&#x6587;&#x4EF6;&#x591A;&#x5E74;&#x6765;&#x90FD;&#x652F;&#x6301;&#x4F7F;&#x7528;Setuptools&#x5E76;&#x4E14;&#x6CA1;&#x6709;&#x5B89;&#x88C5;&#xFF1B;&#x652F;&#x6301;&#x4F7F;&#x7528;&#x76F4;&#x7EBF;Distutils&#x7684;&#x201C;&#x540E;&#x5907;&#x201D;&#x6A21;&#x5F0F;&#x3002;</span><span class="yiyi-st" id="yiyi-145">&#x7531;&#x4E8E;Setuptools-less Python&#x73AF;&#x5883;&#x73B0;&#x5728;&#x8FD8;&#x6CA1;&#x6709;&#x4EBA;&#x542C;&#x8BF4;&#x8FC7;&#xFF0C;&#x4E3A;&#x4E86;&#x66F4;&#x5168;&#x9762;&#x5730;&#x652F;&#x6301;Setuptools&#x7684;&#x7279;&#x6027;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x652F;&#x6301;py.test&#x4E0E;&#x5B83;&#x7684;&#x96C6;&#x6210;&#x4EE5;&#x53CA;&#x8BF8;&#x5982;&#x201C;extras&#x201D;&#x4E4B;&#x7C7B;&#x7684;&#x4E1C;&#x897F;&#xFF0C;<code class="docutils literal"><span class="pre">setup.py</span></code></span></p><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-146">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-147"><a class="reference internal" href="intro.html#installation"><span>Installation Guide</span></a></span></p></div><p><span class="yiyi-st" id="yiyi-148"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3489">&#xFF03;3489  T0&gt;</a></span></p></div><div class="section" id="enabling-disabling-c-extension-builds-is-only-via-environment-variable"><h3><span class="yiyi-st" id="yiyi-149">&#x542F;&#x7528;/&#x7981;&#x7528;C&#x6269;&#x5C55;&#x6784;&#x5EFA;&#x4EC5;&#x901A;&#x8FC7;&#x73AF;&#x5883;&#x53D8;&#x91CF;<a class="headerlink" href="#enabling-disabling-c-extension-builds-is-only-via-environment-variable" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-150">&#x53EA;&#x8981;&#x6709;&#x53EF;&#x80FD;&#xFF0C;C&#x6269;&#x5C55;&#x9ED8;&#x8BA4;&#x5728;&#x5B89;&#x88C5;&#x8FC7;&#x7A0B;&#x4E2D;&#x751F;&#x6210;&#x3002;</span><span class="yiyi-st" id="yiyi-151">&#x8981;&#x7981;&#x7528;C&#x6269;&#x5C55;&#x6784;&#x5EFA;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">DISABLE_SQLALCHEMY_CEXT</span></code>&#x73AF;&#x5883;&#x53D8;&#x91CF;&#xFF0C;&#x4ECE;SQLAlchemy 0.8.6 / 0.9.4&#x5F00;&#x59CB;&#x3002;</span><span class="yiyi-st" id="yiyi-152">&#x4E4B;&#x524D;&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">--without-cextensions</span></code>&#x53C2;&#x6570;&#x7684;&#x65B9;&#x6CD5;&#x5DF2;&#x88AB;&#x5220;&#x9664;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4F9D;&#x8D56;&#x4E8E;setuptools&#x7684;&#x4E0D;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x7684;&#x529F;&#x80FD;&#x3002;</span></p><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-153">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-154"><a class="reference internal" href="intro.html#c-extensions"><span>Installing the C Extensions</span></a></span></p></div><p><span class="yiyi-st" id="yiyi-155"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3500">&#xFF03;3500  T0&gt;</a></span></p></div></div><div class="section" id="new-features-and-improvements-orm"><h2><span class="yiyi-st" id="yiyi-156">&#x65B0;&#x529F;&#x80FD;&#x548C;&#x6539;&#x8FDB; -  ORM <a class="headerlink" href="#new-features-and-improvements-orm" title="Permalink to this headline">&#xB6;</a></span></h2><div class="section" id="new-session-lifecycle-events"><h3><span class="yiyi-st" id="yiyi-157">&#x65B0;&#x4F1A;&#x8BDD;&#x751F;&#x547D;&#x5468;&#x671F;&#x4E8B;&#x4EF6;<a class="headerlink" href="#new-session-lifecycle-events" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-158">The <a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a> has long supported events that allow some degree of tracking of state changes to objects, including <a class="reference internal" href="orm_events.html#sqlalchemy.orm.events.SessionEvents.before_attach" title="sqlalchemy.orm.events.SessionEvents.before_attach"><code class="xref py py-meth docutils literal"><span class="pre">SessionEvents.before_attach()</span></code></a>, <a class="reference internal" href="orm_events.html#sqlalchemy.orm.events.SessionEvents.after_attach" title="sqlalchemy.orm.events.SessionEvents.after_attach"><code class="xref py py-meth docutils literal"><span class="pre">SessionEvents.after_attach()</span></code></a>, and <a class="reference internal" href="orm_events.html#sqlalchemy.orm.events.SessionEvents.before_flush" title="sqlalchemy.orm.events.SessionEvents.before_flush"><code class="xref py py-meth docutils literal"><span class="pre">SessionEvents.before_flush()</span></code></a>. </span><span class="yiyi-st" id="yiyi-159">Session&#x6587;&#x6863;&#x8FD8;&#x5728;<a class="reference internal" href="orm_session_state_management.html#session-object-states"><span>Quickie Intro to Object States</span></a>&#x4E2D;&#x8BB0;&#x5F55;&#x4E3B;&#x8981;&#x5BF9;&#x8C61;&#x72B6;&#x6001;&#x3002;</span><span class="yiyi-st" id="yiyi-160">&#x4F46;&#x662F;&#xFF0C;&#x4ECE;&#x6765;&#x6CA1;&#x6709;&#x8FC7;&#x8DDF;&#x8E2A;&#x5BF9;&#x8C61;&#x7684;&#x7CFB;&#x7EDF;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x901A;&#x8FC7;&#x8FD9;&#x4E9B;&#x8F6C;&#x6362;&#x3002;</span><span class="yiyi-st" id="yiyi-161">&#x6B64;&#x5916;&#xFF0C;&#x7531;&#x4E8E;&#x5BF9;&#x8C61;&#x5728;&#x201C;&#x6301;&#x4E45;&#x201D;&#x548C;&#x201C;&#x5206;&#x79BB;&#x201D;&#x72B6;&#x6001;&#x4E4B;&#x95F4;&#x8D77;&#x4F5C;&#x7528;&#xFF0C;&#x201C;&#x88AB;&#x5220;&#x9664;&#x201D;&#x5BF9;&#x8C61;&#x7684;&#x72B6;&#x6001;&#x5386;&#x53F2;&#x4E0A;&#x4E00;&#x76F4;&#x5F88;&#x6A21;&#x7CCA;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-162">&#x4E3A;&#x4E86;&#x6E05;&#x7406;&#x8FD9;&#x4E2A;&#x533A;&#x57DF;&#x5E76;&#x4E14;&#x5141;&#x8BB8;&#x4F1A;&#x8BDD;&#x72B6;&#x6001;&#x8F6C;&#x6362;&#x7684;&#x9886;&#x57DF;&#x5B8C;&#x5168;&#x900F;&#x660E;&#xFF0C;&#x6DFB;&#x52A0;&#x4E86;&#x4E00;&#x7CFB;&#x5217;&#x65B0;&#x4E8B;&#x4EF6;&#xFF0C;&#x8FD9;&#x4E9B;&#x4E8B;&#x4EF6;&#x65E8;&#x5728;&#x6DB5;&#x76D6;&#x5BF9;&#x8C61;&#x53EF;&#x80FD;&#x5728;&#x72B6;&#x6001;&#x4E4B;&#x95F4;&#x8F6C;&#x6362;&#x7684;&#x5404;&#x79CD;&#x53EF;&#x80FD;&#x65B9;&#x5F0F;&#xFF0C;&#x5E76;&#x4E14;&#x53E6;&#x5916;&#x201C;&#x5DF2;&#x5220;&#x9664;&#x201D;&#x72B6;&#x6001;&#x5177;&#x6709;&#x5728;&#x4F1A;&#x8BDD;&#x5BF9;&#x8C61;&#x72B6;&#x6001;&#x8303;&#x56F4;&#x5185;&#x88AB;&#x8D4B;&#x4E88;&#x4E86;&#x81EA;&#x5DF1;&#x7684;&#x5B98;&#x65B9;&#x540D;&#x79F0;&#x3002;</span></p><div class="section" id="new-state-transition-events"><h4><span class="yiyi-st" id="yiyi-163">&#x65B0;&#x7684;&#x72B6;&#x6001;&#x8F6C;&#x6362;&#x4E8B;&#x4EF6;<a class="headerlink" href="#new-state-transition-events" title="Permalink to this headline">&#xB6;</a></span></h4><p><span class="yiyi-st" id="yiyi-164">&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x65E8;&#x5728;&#x8986;&#x76D6;&#x7279;&#x5B9A;&#x8F6C;&#x6362;&#x7684;&#x4F1A;&#x8BDD;&#x7EA7;&#x522B;&#x4E8B;&#x4EF6;&#x6765;&#x62E6;&#x622A;&#x8BF8;&#x5982;<a class="reference internal" href="glossary.html#term-persistent"><span class="xref std std-term">persistent</span></a>&#xFF0C;<a class="reference internal" href="glossary.html#term-pending"><span class="xref std std-term">pending</span></a>&#x7B49;&#x5BF9;&#x8C61;&#x7684;&#x6240;&#x6709;&#x72B6;&#x6001;&#x4E4B;&#x95F4;&#x7684;&#x8F6C;&#x6362;&#x3002;</span><span class="yiyi-st" id="yiyi-165">&#x5F53;&#x5BF9;&#x8C61;&#x79FB;&#x52A8;&#x5230;<a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x4E2D;&#x65F6;&#xFF0C;&#x4F1A;&#x8DF3;&#x51FA;<a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#xFF0C;&#x751A;&#x81F3;&#x662F;&#x4F7F;&#x7528;<a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session.rollback" title="sqlalchemy.orm.session.Session.rollback"><code class="xref py py-meth docutils literal"><span class="pre">Session.rollback()</span></code></a>&#x660E;&#x786E;&#x5B58;&#x5728;&#x4E8E;<a class="reference internal" href="orm_events.html#sqlalchemy.orm.events.SessionEvents" title="sqlalchemy.orm.events.SessionEvents"><code class="xref py py-class docutils literal"><span class="pre">SessionEvents</span></code></a>&#x7684;&#x754C;&#x9762;&#x4E2D;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-166">In total, there are <strong>ten new events</strong>. </span><span class="yiyi-st" id="yiyi-167">&#x8FD9;&#x4E9B;&#x4E8B;&#x4EF6;&#x7684;&#x6458;&#x8981;&#x4F4D;&#x4E8E;&#x65B0;&#x7F16;&#x5199;&#x7684;&#x6587;&#x6863;&#x90E8;&#x5206;<a class="reference internal" href="orm_session_events.html#session-lifecycle-events"><span>Object Lifecycle Events</span></a>&#x4E2D;&#x3002;</span></p></div><div class="section" id="new-object-state-deleted-is-added-deleted-objects-no-longer-persistent"><h4><span class="yiyi-st" id="yiyi-168">&#x6DFB;&#x52A0;&#x65B0;&#x5BF9;&#x8C61;&#x72B6;&#x6001;&#x201C;&#x5DF2;&#x5220;&#x9664;&#x201D;&#xFF0C;&#x5DF2;&#x5220;&#x9664;&#x5BF9;&#x8C61;&#x4E0D;&#x518D;&#x662F;&#x201C;&#x6301;&#x4E45;&#x6027;&#x201D;<a class="headerlink" href="#new-object-state-deleted-is-added-deleted-objects-no-longer-persistent" title="Permalink to this headline">&#xB6;</a></span></h4><p><span class="yiyi-st" id="yiyi-169">&#x59CB;&#x7EC8;&#x5C06;<a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x4E2D;&#x5BF9;&#x8C61;&#x7684;<a class="reference internal" href="glossary.html#term-persistent"><span class="xref std std-term">persistent</span></a>&#x72B6;&#x6001;&#x8BB0;&#x5F55;&#x4E3A;&#x5177;&#x6709;&#x6709;&#x6548;&#x6570;&#x636E;&#x5E93;&#x6807;&#x8BC6;&#x7684;&#x5BF9;&#x8C61;&#xFF1B;&#x7136;&#x800C;&#xFF0C;&#x5BF9;&#x4E8E;&#x5728;&#x5237;&#x65B0;&#x5185;&#x5220;&#x9664;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x5B83;&#x4EEC;&#x4E00;&#x76F4;&#x5904;&#x4E8E;&#x7070;&#x8272;&#x533A;&#x57DF;&#xFF0C;&#x5B83;&#x4EEC;&#x5E76;&#x672A;&#x771F;&#x6B63;&#x201C;&#x8131;&#x79BB;&#x201D;<a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x4ECD;&#x53EF;&#x5728;&#x56DE;&#x6EDA;&#x4E2D;&#x6062;&#x590D;&#xFF0C;&#x4F46;&#x5E76;&#x4E0D;&#x771F;&#x6B63;&#x201C;&#x6301;&#x4E45;&#x201D;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x7684;&#x6570;&#x636E;&#x5E93;&#x6807;&#x8BC6;&#x5DF2;&#x88AB;&#x5220;&#x9664;&#xFF0C;&#x5E76;&#x4E14;&#x5B83;&#x4EEC;&#x4E0D;&#x5B58;&#x5728;&#x4E8E;&#x6807;&#x8BC6;&#x6620;&#x5C04;&#x4E2D;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-170">&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x7ED9;&#x5B9A;&#x65B0;&#x4E8B;&#x4EF6;&#x7684;&#x7070;&#x8272;&#x533A;&#x57DF;&#xFF0C;&#x5F15;&#x5165;&#x4E86;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x5BF9;&#x8C61;&#x72B6;&#x6001;<a class="reference internal" href="glossary.html#term-deleted"><span class="xref std std-term">deleted</span></a>&#x3002;</span><span class="yiyi-st" id="yiyi-171">&#x8FD9;&#x79CD;&#x72B6;&#x6001;&#x5B58;&#x5728;&#x4E8E;&#x201C;&#x6301;&#x4E45;&#x201D;&#x548C;&#x201C;&#x5206;&#x79BB;&#x201D;&#x72B6;&#x6001;&#x4E4B;&#x95F4;&#x3002;</span><span class="yiyi-st" id="yiyi-172">&#x901A;&#x8FC7;<a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session.delete" title="sqlalchemy.orm.session.Session.delete"><code class="xref py py-meth docutils literal"><span class="pre">Session.delete()</span></code></a>&#x6807;&#x8BB0;&#x4E3A;&#x5220;&#x9664;&#x7684;&#x5BF9;&#x8C61;&#x4FDD;&#x6301;&#x201C;&#x6301;&#x4E45;&#x201D;&#x72B6;&#x6001;&#xFF0C;&#x76F4;&#x5230;&#x5237;&#x65B0;&#x7ED3;&#x675F;&#xFF1B;&#x6B64;&#x65F6;&#xFF0C;&#x5B83;&#x5C06;&#x4ECE;&#x8EAB;&#x4EFD;&#x6620;&#x5C04;&#x4E2D;&#x79FB;&#x9664;&#xFF0C;&#x79FB;&#x81F3;&#x201C;&#x5DF2;&#x5220;&#x9664;&#x201D;&#x72B6;&#x6001;&#xFF0C;&#x5E76;&#x8C03;&#x7528;<a class="reference internal" href="orm_events.html#sqlalchemy.orm.events.SessionEvents.persistent_to_deleted" title="sqlalchemy.orm.events.SessionEvents.persistent_to_deleted"><code class="xref py py-meth docutils literal"><span class="pre">SessionEvents.persistent_to_deleted()</span></code></a>&#x94A9;&#x5B50;&#x3002;</span><span class="yiyi-st" id="yiyi-173">&#x5982;&#x679C;&#x56DE;&#x6EDA;<a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x5BF9;&#x8C61;&#x7684;&#x4E8B;&#x52A1;&#xFF0C;&#x8BE5;&#x5BF9;&#x8C61;&#x5C06;&#x4F5C;&#x4E3A;&#x6301;&#x4E45;&#x6027;&#x6062;&#x590D;&#xFF1B;&#x8C03;&#x7528;<a class="reference internal" href="orm_events.html#sqlalchemy.orm.events.SessionEvents.deleted_to_persistent" title="sqlalchemy.orm.events.SessionEvents.deleted_to_persistent"><code class="xref py py-meth docutils literal"><span class="pre">SessionEvents.deleted_to_persistent()</span></code></a>&#x8F6C;&#x6362;&#x3002;</span><span class="yiyi-st" id="yiyi-174">&#x5426;&#x5219;&#xFF0C;&#x5982;&#x679C;<a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x5BF9;&#x8C61;&#x7684;&#x4E8B;&#x52A1;&#x88AB;&#x63D0;&#x4EA4;&#xFF0C;&#x5219;&#x8C03;&#x7528;<a class="reference internal" href="orm_events.html#sqlalchemy.orm.events.SessionEvents.deleted_to_detached" title="sqlalchemy.orm.events.SessionEvents.deleted_to_detached"><code class="xref py py-meth docutils literal"><span class="pre">SessionEvents.deleted_to_detached()</span></code></a>&#x8F6C;&#x6362;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-175">&#x6B64;&#x5916;&#xFF0C;&#x5BF9;&#x4E8E;&#x5904;&#x4E8E;&#x65B0;&#x201C;&#x5DF2;&#x5220;&#x9664;&#x201D;&#x72B6;&#x6001;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;<a class="reference internal" href="orm_internals.html#sqlalchemy.orm.state.InstanceState.persistent" title="sqlalchemy.orm.state.InstanceState.persistent"><code class="xref py py-attr docutils literal"><span class="pre">InstanceState.persistent</span></code></a>&#x8BBF;&#x95EE;&#x5668;<strong>&#x4E0D;&#x518D;&#x8FD4;&#x56DE;True</strong>&#xFF1B;&#x76F8;&#x53CD;&#xFF0C;<a class="reference internal" href="orm_internals.html#sqlalchemy.orm.state.InstanceState.deleted" title="sqlalchemy.orm.state.InstanceState.deleted"><code class="xref py py-attr docutils literal"><span class="pre">InstanceState.deleted</span></code></a>&#x8BBF;&#x95EE;&#x5668;&#x5DF2;&#x5F97;&#x5230;&#x589E;&#x5F3A;&#xFF0C;&#x53EF;&#x4EE5;&#x53EF;&#x9760;&#x5730;&#x62A5;&#x544A;&#x6B64;&#x65B0;&#x72B6;&#x6001;&#x3002;</span><span class="yiyi-st" id="yiyi-176">&#x5F53;&#x5BF9;&#x8C61;&#x88AB;&#x5206;&#x79BB;&#x65F6;&#xFF0C;<a class="reference internal" href="orm_internals.html#sqlalchemy.orm.state.InstanceState.deleted" title="sqlalchemy.orm.state.InstanceState.deleted"><code class="xref py py-attr docutils literal"><span class="pre">InstanceState.deleted</span></code></a>&#x5C06;&#x8FD4;&#x56DE;False&#xFF0C;&#x800C;<a class="reference internal" href="orm_internals.html#sqlalchemy.orm.state.InstanceState.detached" title="sqlalchemy.orm.state.InstanceState.detached"><code class="xref py py-attr docutils literal"><span class="pre">InstanceState.detached</span></code></a>&#x5B58;&#x53D6;&#x5668;&#x5219;&#x4E3A;True&#x3002;</span><span class="yiyi-st" id="yiyi-177">&#x8981;&#x786E;&#x5B9A;&#x67D0;&#x4E2A;&#x5BF9;&#x8C61;&#x662F;&#x5728;&#x5F53;&#x524D;&#x4E8B;&#x52A1;&#x4E2D;&#x8FD8;&#x662F;&#x5728;&#x4E4B;&#x524D;&#x7684;&#x4E8B;&#x52A1;&#x4E2D;&#x88AB;&#x5220;&#x9664;&#xFF0C;&#x8BF7;&#x4F7F;&#x7528;<a class="reference internal" href="orm_internals.html#sqlalchemy.orm.state.InstanceState.was_deleted" title="sqlalchemy.orm.state.InstanceState.was_deleted"><code class="xref py py-attr docutils literal"><span class="pre">InstanceState.was_deleted</span></code></a>&#x8BBF;&#x95EE;&#x5668;&#x3002;</span></p></div><div class="section" id="strong-identity-map-is-deprecated"><h4><span class="yiyi-st" id="yiyi-178">&#x5F3A;&#x8EAB;&#x4EFD;&#x5730;&#x56FE;&#x5DF2;&#x5F03;&#x7528;<a class="headerlink" href="#strong-identity-map-is-deprecated" title="Permalink to this headline">&#xB6;</a></span></h4><p><span class="yiyi-st" id="yiyi-179">&#x65B0;&#x7CFB;&#x5217;&#x8FC7;&#x6E21;&#x4E8B;&#x4EF6;&#x7684;&#x7075;&#x611F;&#x4E4B;&#x4E00;&#x662F;&#x80FD;&#x591F;&#x5728;&#x7269;&#x4F53;&#x8FDB;&#x51FA;&#x8EAB;&#x4EFD;&#x5730;&#x56FE;&#x65F6;&#x5BF9;&#x7269;&#x4F53;&#x8FDB;&#x884C;&#x9632;&#x6F0F;&#x8DDF;&#x8E2A;&#xFF0C;&#x4EE5;&#x4FBF;&#x53EF;&#x4EE5;&#x4FDD;&#x6301;&#x7269;&#x4F53;&#x79FB;&#x5165;&#x548C;&#x79FB;&#x51FA;&#x7684;&#x201C;&#x5F3A;&#x53C2;&#x7167;&#x7269;&#x201D;&#x5730;&#x56FE;&#x3002;</span><span class="yiyi-st" id="yiyi-180">&#x6709;&#x4E86;&#x8FD9;&#x4E2A;&#x65B0;&#x529F;&#x80FD;&#xFF0C;&#x5C31;&#x4E0D;&#x518D;&#x9700;&#x8981;<a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session.params.weak_identity_map" title="sqlalchemy.orm.session.Session"><code class="xref py py-paramref docutils literal"><span class="pre">Session.weak_identity_map</span></code></a>&#x53C2;&#x6570;&#x548C;&#x76F8;&#x5E94;&#x7684;<code class="xref py py-class docutils literal"><span class="pre">StrongIdentityMap</span></code>&#x5BF9;&#x8C61;&#x3002;</span><span class="yiyi-st" id="yiyi-181">&#x7531;&#x4E8E;&#x201C;&#x5F3A;&#x5F15;&#x7528;&#x201D;&#x884C;&#x4E3A;&#x66FE;&#x7ECF;&#x662F;&#x552F;&#x4E00;&#x53EF;&#x7528;&#x7684;&#x884C;&#x4E3A;&#xFF0C;&#x5E76;&#x4E14;&#x8BB8;&#x591A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x90FD;&#x662F;&#x4E3A;&#x4E86;&#x627F;&#x62C5;&#x6B64;&#x884C;&#x4E3A;&#x800C;&#x7F16;&#x5199;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x6B64;&#x9009;&#x9879;&#x5728;SQLAlchemy&#x4E2D;&#x4FDD;&#x7559;&#x4E86;&#x5F88;&#x591A;&#x5E74;&#x3002;</span><span class="yiyi-st" id="yiyi-182">&#x957F;&#x4E45;&#x4EE5;&#x6765;&#xFF0C;&#x5EFA;&#x8BAE;&#x5BF9;&#x8C61;&#x7684;&#x5F3A;&#x53C2;&#x8003;&#x8DDF;&#x8E2A;&#x4E0D;&#x662F;<a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x7684;&#x56FA;&#x6709;&#x5DE5;&#x4F5C;&#xFF0C;&#x800C;&#x662F;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x9700;&#x8981;&#x6784;&#x5EFA;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7EA7;&#x6784;&#x9020;&#xFF1B;&#x65B0;&#x7684;&#x4E8B;&#x4EF6;&#x6A21;&#x578B;&#x751A;&#x81F3;&#x53EF;&#x4EE5;&#x590D;&#x5236;&#x5F3A;&#x8EAB;&#x4EFD;&#x5730;&#x56FE;&#x7684;&#x786E;&#x5207;&#x884C;&#x4E3A;&#x3002;</span><span class="yiyi-st" id="yiyi-183">&#x6709;&#x5173;&#x8BF4;&#x660E;&#x5982;&#x4F55;&#x66FF;&#x6362;&#x5F3A;&#x8EAB;&#x4EFD;&#x6620;&#x5C04;&#x7684;&#x65B0;&#x914D;&#x65B9;&#xFF0C;&#x8BF7;&#x53C2;&#x89C1;<a class="reference internal" href="orm_session_state_management.html#session-referencing-behavior"><span>Session Referencing Behavior</span></a>&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-184"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2677">&#xFF03;2677  T0&gt;</a></span></p></div></div><div class="section" id="new-init-scalar-event-intercepts-default-values-at-orm-level"><h3><span class="yiyi-st" id="yiyi-185">&#x65B0;&#x7684;init_scalar()&#x4E8B;&#x4EF6;&#x5728;ORM&#x7EA7;&#x522B;<a class="headerlink" href="#new-init-scalar-event-intercepts-default-values-at-orm-level" title="Permalink to this headline">&#xB6;</a>&#x5904;&#x622A;&#x53D6;&#x9ED8;&#x8BA4;&#x503C;</span></h3><p><span class="yiyi-st" id="yiyi-186">&#x5BF9;&#x4E8E;&#x975E;&#x6301;&#x4E45;&#x5BF9;&#x8C61;&#xFF0C;&#x9996;&#x6B21;&#x8BBF;&#x95EE;&#x5C1A;&#x672A;&#x8BBE;&#x7F6E;&#x7684;&#x5C5E;&#x6027;&#x65F6;&#xFF0C;ORM&#x4F1A;&#x751F;&#x6210;<code class="docutils literal"><span class="pre">None</span></code>&#x503C;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">obj</span> <span class="o">=</span> <span class="n">MyObj</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">obj</span><span class="o">.</span><span class="n">some_value</span>
<span class="go">None</span></pre></div></div><p><span class="yiyi-st" id="yiyi-187">&#x5BF9;&#x4E8E;&#x8FD9;&#x4E2A;Python&#x5185;&#x90E8;&#x503C;&#x6765;&#x8BF4;&#xFF0C;&#x6709;&#x4E00;&#x4E2A;&#x7528;&#x4F8B;&#x4E0E;Core&#x751F;&#x6210;&#x7684;&#x9ED8;&#x8BA4;&#x503C;&#x76F8;&#x5BF9;&#x5E94;&#xFF0C;&#x751A;&#x81F3;&#x5728;&#x8BE5;&#x5BF9;&#x8C61;&#x88AB;&#x4FDD;&#x5B58;&#x4E4B;&#x524D;&#x3002;</span><span class="yiyi-st" id="yiyi-188">&#x4E3A;&#x4E86;&#x9002;&#x5E94;&#x8FD9;&#x79CD;&#x7528;&#x4F8B;&#xFF0C;&#x6DFB;&#x52A0;&#x4E86;&#x4E00;&#x4E2A;&#x65B0;&#x4E8B;&#x4EF6;<a class="reference internal" href="orm_events.html#sqlalchemy.orm.events.AttributeEvents.init_scalar" title="sqlalchemy.orm.events.AttributeEvents.init_scalar"><code class="xref py py-meth docutils literal"><span class="pre">AttributeEvents.init_scalar()</span></code></a>&#x3002;</span><span class="yiyi-st" id="yiyi-189">&#x5728;<a class="reference internal" href="orm_examples.html#examples-instrumentation"><span>Attribute Instrumentation</span></a>&#x5904;&#x7684;&#x65B0;&#x793A;&#x4F8B;<code class="docutils literal"><span class="pre">active_column_defaults.py</span></code>&#x6F14;&#x793A;&#x4E86;&#x4E00;&#x4E2A;&#x793A;&#x4F8B;&#x7528;&#x6CD5;&#xFF0C;&#x56E0;&#x6B64;&#x6548;&#x679C;&#x53EF;&#x4EE5;&#x662F;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">obj</span> <span class="o">=</span> <span class="n">MyObj</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">obj</span><span class="o">.</span><span class="n">some_value</span>
<span class="go">&quot;my default&quot;</span></pre></div></div><p><span class="yiyi-st" id="yiyi-190"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/1311">&#xFF03;1311  T0&gt;</a></span></p></div><div class="section" id="changes-regarding-unhashable-types"><h3><span class="yiyi-st" id="yiyi-191">&#x6709;&#x5173;&#x201C;&#x4E0D;&#x53EF;&#x5E72;&#x6270;&#x201D;&#x7C7B;&#x578B;&#x7684;&#x66F4;&#x6539;<a class="headerlink" href="#changes-regarding-unhashable-types" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-192"><a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query" title="sqlalchemy.orm.query.Query"><code class="xref py py-class docutils literal"><span class="pre">Query</span></code></a>&#x5BF9;&#x8C61;&#x5177;&#x6709;&#x4F17;&#x6240;&#x5468;&#x77E5;&#x7684;&#x201C;&#x6263;&#x9664;&#x201D;&#x8FD4;&#x56DE;&#x884C;&#x7684;&#x884C;&#x4E3A;&#xFF0C;&#x8BE5;&#x884C;&#x5305;&#x542B;&#x81F3;&#x5C11;&#x4E00;&#x4E2A;ORM&#x6620;&#x5C04;&#x5B9E;&#x4F53;&#xFF08;&#x4F8B;&#x5982;&#xFF0C;&#x5B8C;&#x5168;&#x6620;&#x5C04;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5355;&#x4E2A;&#x5217;&#x503C;&#xFF09;&#x3002;</span><span class="yiyi-st" id="yiyi-193">&#x8FD9;&#x6837;&#x505A;&#x7684;&#x4E3B;&#x8981;&#x76EE;&#x7684;&#x662F;&#x4F7F;&#x5B9E;&#x4F53;&#x7684;&#x5904;&#x7406;&#x80FD;&#x591F;&#x4E0E;&#x6807;&#x8BC6;&#x6620;&#x5C04;&#x4E00;&#x8D77;&#x5E73;&#x7A33;&#x5730;&#x5DE5;&#x4F5C;&#xFF0C;&#x5305;&#x62EC;&#x9002;&#x5E94;&#x901A;&#x5E38;&#x5728;&#x5DF2;&#x52A0;&#x5165;&#x7684;&#x52A0;&#x8F7D;&#x52A0;&#x8F7D;&#x4E2D;&#x8868;&#x793A;&#x7684;&#x91CD;&#x590D;&#x5B9E;&#x4F53;&#xFF0C;&#x4EE5;&#x53CA;&#x4F55;&#x65F6;&#x4F7F;&#x7528;&#x8FDE;&#x63A5;&#x6765;&#x8FC7;&#x6EE4;&#x989D;&#x5916;&#x7684;&#x5217;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-194">&#x6B64;&#x91CD;&#x590D;&#x6570;&#x636E;&#x5220;&#x9664;&#x4F9D;&#x8D56;&#x4E8E;&#x884C;&#x5185;&#x5143;&#x7D20;&#x7684;&#x53EF;&#x5426;&#x6027;&#x3002;</span><span class="yiyi-st" id="yiyi-195">&#x901A;&#x8FC7;&#x5F15;&#x5165;Postgresql&#x7684;&#x7279;&#x6B8A;&#x7C7B;&#x578B;&#xFF0C;&#x5982;<a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.ARRAY" title="sqlalchemy.dialects.postgresql.ARRAY"><code class="xref py py-class docutils literal"><span class="pre">postgresql.ARRAY</span></code></a>&#xFF0C;<a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.HSTORE" title="sqlalchemy.dialects.postgresql.HSTORE"><code class="xref py py-class docutils literal"><span class="pre">postgresql.HSTORE</span></code></a>&#x548C;<a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.JSON" title="sqlalchemy.dialects.postgresql.JSON"><code class="xref py py-class docutils literal"><span class="pre">postgresql.JSON</span></code></a>&#xFF0C;&#x884C;&#x4E2D;&#x7C7B;&#x578B;&#x7684;&#x4F53;&#x9A8C;&#x662F;&#x4E0D;&#x53EF;&#x53CA;&#x7684;&#xFF0C;&#x9047;&#x5230;&#x95EE;&#x9898;&#x6BD4;&#x4EE5;&#x524D;&#x66F4;&#x666E;&#x904D;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-196">&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;SQLAlchemy&#x4ECE;0.8&#x7248;&#x672C;&#x5F00;&#x59CB;&#x5728;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x4E2D;&#x5305;&#x542B;&#x4E00;&#x4E2A;&#x6807;&#x8BB0;&#xFF0C;&#x6807;&#x8BB0;&#x4E3A;&#x201C;&#x4E0D;&#x53EF;&#x5E72;&#x6270;&#x201D;&#xFF0C;&#x4F46;&#x662F;&#x6B64;&#x6807;&#x5FD7;&#x5728;&#x5185;&#x7F6E;&#x7C7B;&#x578B;&#x4E2D;&#x5E76;&#x672A;&#x4E00;&#x81F4;&#x4F7F;&#x7528;&#x3002;</span><span class="yiyi-st" id="yiyi-197">&#x5982;<a class="reference internal" href="#change-3499-postgresql"><span>ARRAY and JSON types now correctly specify &#x201C;unhashable&#x201D;</span></a>&#xFF0C;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x4E3A;&#x6240;&#x6709;Postgresql&#x7684;&#x201C;&#x7ED3;&#x6784;&#x201D;&#x7C7B;&#x578B;&#x4E00;&#x81F4;&#x5730;&#x8BBE;&#x7F6E;&#x6B64;&#x6807;&#x5FD7;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-198">&#x7531;&#x4E8E;<a class="reference internal" href="core_type_api.html#sqlalchemy.types.NullType" title="sqlalchemy.types.NullType"><code class="xref py py-class docutils literal"><span class="pre">NullType</span></code></a>&#x7528;&#x4E8E;&#x5F15;&#x7528;&#x672A;&#x77E5;&#x7C7B;&#x578B;&#x7684;&#x4EFB;&#x4F55;&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x56E0;&#x6B64;&#x201C;&#x4E0D;&#x53EF;&#x7528;&#x201D;&#x6807;&#x5FD7;&#x4E5F;&#x8BBE;&#x7F6E;&#x5728;<a class="reference internal" href="core_type_api.html#sqlalchemy.types.NullType" title="sqlalchemy.types.NullType"><code class="xref py py-class docutils literal"><span class="pre">NullType</span></code></a>&#x7C7B;&#x578B;&#x4E2D;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-199">&#x53E6;&#x5916;&#xFF0C;&#x6240;&#x8C13;&#x7684;&#x201C;&#x4E0D;&#x53EF;&#x5E72;&#x6270;&#x201D;&#x7C7B;&#x578B;&#x7684;&#x5904;&#x7406;&#x4E0E;&#x4EE5;&#x524D;&#x7684;&#x7248;&#x672C;&#x7565;&#x6709;&#x4E0D;&#x540C;&#xFF1B;&#x5728;&#x5185;&#x90E8;&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">id()</span></code>&#x51FD;&#x6570;&#x4ECE;&#x8FD9;&#x4E9B;&#x7ED3;&#x6784;&#x4E2D;&#x83B7;&#x53D6;&#x201C;&#x6563;&#x5217;&#x503C;&#x201D;&#xFF0C;&#x5C31;&#x50CF;&#x6211;&#x4EEC;&#x5BF9;&#x4EFB;&#x4F55;&#x666E;&#x901A;&#x7684;&#x6620;&#x5C04;&#x5BF9;&#x8C61;&#x4E00;&#x6837;&#x3002;</span><span class="yiyi-st" id="yiyi-200">&#x8FD9;&#x53D6;&#x4EE3;&#x4E86;&#x4E4B;&#x524D;&#x5BF9;&#x5BF9;&#x8C61;&#x5E94;&#x7528;&#x8BA1;&#x6570;&#x5668;&#x7684;&#x65B9;&#x6CD5;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-201"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3499">&#xFF03;3499  T0&gt;</a></span></p></div><div class="section" id="specific-checks-added-for-passing-mapped-classes-instances-as-sql-literals"><h3><span class="yiyi-st" id="yiyi-202">&#x6DFB;&#x52A0;&#x4E86;&#x7279;&#x5B9A;&#x7684;&#x68C0;&#x67E5;&#x4EE5;&#x4F20;&#x9012;&#x6620;&#x5C04;&#x7C7B;&#xFF0C;&#x5B9E;&#x4F8B;&#x4E3A;SQL&#x6587;&#x5B57;<a class="headerlink" href="#specific-checks-added-for-passing-mapped-classes-instances-as-sql-literals" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-203">&#x73B0;&#x5728;&#xFF0C;&#x952E;&#x5165;&#x7CFB;&#x7EDF;&#x5BF9;SQLAlchemy&#x201C;&#x53EF;&#x68C0;&#x67E5;&#x201D;&#x5BF9;&#x8C61;&#x5728;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x7684;&#x4F20;&#x9012;&#x8FDB;&#x884C;&#x4E86;&#x7279;&#x5B9A;&#x7684;&#x68C0;&#x67E5;&#xFF0C;&#x5426;&#x5219;&#x8FD9;&#x4E9B;&#x5BF9;&#x8C61;&#x5C06;&#x4F5C;&#x4E3A;&#x6587;&#x5B57;&#x503C;&#x5904;&#x7406;&#x3002;</span><span class="yiyi-st" id="yiyi-204">&#x4EFB;&#x4F55;&#x53EF;&#x5408;&#x6CD5;&#x4F5C;&#x4E3A;SQL&#x503C;&#x4F20;&#x9012;&#x7684;SQLAlchemy&#x5185;&#x7F6E;&#x5BF9;&#x8C61;&#x90FD;&#x5305;&#x542B;&#x4E00;&#x4E2A;&#x4E3A;&#x8BE5;&#x5BF9;&#x8C61;&#x63D0;&#x4F9B;&#x6709;&#x6548;SQL&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x65B9;&#x6CD5;<code class="docutils literal"><span class="pre">__clause_element__()</span></code>&#x3002;</span><span class="yiyi-st" id="yiyi-205">&#x5BF9;&#x4E8E;&#x4E0D;&#x63D0;&#x4F9B;&#x6B64;&#x529F;&#x80FD;&#x7684;SQLAlchemy&#x5BF9;&#x8C61;&#xFF08;&#x5982;&#x6620;&#x5C04;&#x7C7B;&#xFF0C;&#x6620;&#x5C04;&#x5668;&#x548C;&#x6620;&#x5C04;&#x5B9E;&#x4F8B;&#xFF09;&#xFF0C;&#x4F1A;&#x53D1;&#x51FA;&#x66F4;&#x591A;&#x4FE1;&#x606F;&#x6027;&#x9519;&#x8BEF;&#x6D88;&#x606F;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x8BA9;DBAPI&#x63A5;&#x6536;&#x5BF9;&#x8C61;&#x5E76;&#x7A0D;&#x540E;&#x5931;&#x8D25;&#x3002;</span><span class="yiyi-st" id="yiyi-206">&#x4E0B;&#x9762;&#x4E3E;&#x4F8B;&#x8BF4;&#x660E;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#xFF0C;&#x5176;&#x4E2D;&#x57FA;&#x4E8E;&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x5C5E;&#x6027;<code class="docutils literal"><span class="pre">User.name</span></code>&#x4E0E;<code class="docutils literal"><span class="pre">User()</span></code>&#x7684;&#x5B8C;&#x6574;&#x5B9E;&#x4F8B;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x9488;&#x5BF9;&#x5B57;&#x7B26;&#x4E32;&#x503C;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">some_user</span> <span class="o">=</span> <span class="n">User</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">some_user</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">sqlalchemy.exc.ArgumentError: Object &lt;__main__.User object at 0x103167e90&gt; is not legal as a SQL literal value</span></pre></div></div><p><span class="yiyi-st" id="yiyi-207">&#x5F53;&#x5728;<code class="docutils literal"><span class="pre">User.name</span> <span class="pre">==</span> <span class="pre">some_user</span></code>&#x4E4B;&#x95F4;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#x65F6;&#xFF0C;&#x7ACB;&#x5373;&#x53D1;&#x751F;&#x5F02;&#x5E38;&#x3002;</span><span class="yiyi-st" id="yiyi-208">&#x4EE5;&#x524D;&#xFF0C;&#x50CF;&#x4E0A;&#x9762;&#x8FD9;&#x6837;&#x7684;&#x6BD4;&#x8F83;&#x4F1A;&#x4EA7;&#x751F;&#x4E00;&#x4E2A;SQL&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x53EA;&#x6709;&#x5728;&#x89E3;&#x6790;&#x6210;DBAPI&#x6267;&#x884C;&#x8C03;&#x7528;&#x540E;&#x624D;&#x4F1A;&#x5931;&#x8D25;&#xFF1B;&#x6620;&#x5C04;&#x7684;<code class="docutils literal"><span class="pre">User</span></code>&#x5BF9;&#x8C61;&#x6700;&#x7EC8;&#x5C06;&#x6210;&#x4E3A;DBAPI&#x5C06;&#x62D2;&#x7EDD;&#x7684;&#x7ED1;&#x5B9A;&#x53C2;&#x6570;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-209">&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x5728;&#x4E0A;&#x9762;&#x7684;&#x793A;&#x4F8B;&#x4E2D;&#xFF0C;&#x8868;&#x8FBE;&#x5F0F;&#x5931;&#x8D25;&#xFF0C;&#x56E0;&#x4E3A;<code class="docutils literal"><span class="pre">User.name</span></code>&#x662F;&#x57FA;&#x4E8E;&#x5B57;&#x7B26;&#x4E32;&#x7684;&#xFF08;&#x4F8B;&#x5982;&#x5217;&#x5411;&#x5BFC;&#xFF09;&#x5C5E;&#x6027;&#x3002;</span><span class="yiyi-st" id="yiyi-210">The change does <em>not</em> impact the usual case of comparing a many-to-one relationship attribute to an object, which is handled distinctly:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Address.user refers to the User mapper, so</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># this is of course still OK!</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Address</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Address</span><span class="o">.</span><span class="n">user</span> <span class="o">==</span> <span class="n">some_user</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-211"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3321">&#xFF03;3321  T0&gt;</a></span></p></div><div class="section" id="new-indexable-orm-extension"><h3><span class="yiyi-st" id="yiyi-212">&#x65B0;&#x7684;&#x53EF;&#x7D22;&#x5F15;ORM&#x6269;&#x5C55;<a class="headerlink" href="#new-indexable-orm-extension" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-213"><a class="reference internal" href="orm_extensions_indexable.html"><span>Indexable</span></a>&#x6269;&#x5C55;&#x662F;&#x5BF9;&#x6DF7;&#x5408;&#x5C5E;&#x6027;&#x529F;&#x80FD;&#x7684;&#x6269;&#x5C55;&#xFF0C;&#x5B83;&#x5141;&#x8BB8;&#x6784;&#x5EFA;&#x5F15;&#x7528;&#x201C;&#x53EF;&#x7D22;&#x5F15;&#x201D;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x7684;&#x7279;&#x5B9A;&#x5143;&#x7D20;&#xFF08;&#x5982;&#x6570;&#x7EC4;&#x6216;JSON&#x5B57;&#x6BB5;&#xFF09;&#x7684;&#x5C5E;&#x6027;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;person&apos;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">JSON</span><span class="p">)</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">index_property</span><span class="p">(</span><span class="s1">&apos;data&apos;</span><span class="p">,</span> <span class="s1">&apos;name&apos;</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-214">&#x4EE5;&#x4E0A;&#xFF0C;&#x5728;&#x521D;&#x59CB;&#x5316;&#x4E3A;&#x7A7A;&#x5B57;&#x5178;&#x4E4B;&#x540E;&#xFF0C;<code class="docutils literal"><span class="pre">name</span></code>&#x5C5E;&#x6027;&#x5C06;&#x4ECE;JSON&#x5217;<code class="docutils literal"><span class="pre">data</span></code>&#x8BFB;&#x53D6;/&#x5199;&#x5165;&#x5B57;&#x6BB5;<code class="docutils literal"><span class="pre">&quot;name&quot;</span></code>&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">person</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&apos;foobar&apos;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">person</span><span class="o">.</span><span class="n">name</span>
<span class="go">foobar</span></pre></div></div><p><span class="yiyi-st" id="yiyi-215">&#x5F53;&#x8BE5;&#x5C5E;&#x6027;&#x88AB;&#x4FEE;&#x6539;&#x65F6;&#xFF0C;&#x8BE5;&#x6269;&#x5C55;&#x8FD8;&#x4F1A;&#x89E6;&#x53D1;&#x4E00;&#x4E2A;&#x66F4;&#x6539;&#x4E8B;&#x4EF6;&#xFF0C;&#x56E0;&#x6B64;&#x4E0D;&#x9700;&#x8981;&#x4F7F;&#x7528;<a class="reference internal" href="orm_extensions_mutable.html#sqlalchemy.ext.mutable.MutableDict" title="sqlalchemy.ext.mutable.MutableDict"><code class="xref py py-class docutils literal"><span class="pre">MutableDict</span></code></a>&#x6765;&#x8DDF;&#x8E2A;&#x6B64;&#x66F4;&#x6539;&#x3002;</span></p><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-216">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-217"><a class="reference internal" href="orm_extensions_indexable.html"><span>Indexable</span></a></span></p></div></div><div class="section" id="new-options-allowing-explicit-persistence-of-null-over-a-default"><h3><span class="yiyi-st" id="yiyi-218">&#x5141;&#x8BB8;&#x5728;&#x9ED8;&#x8BA4;<a class="headerlink" href="#new-options-allowing-explicit-persistence-of-null-over-a-default" title="Permalink to this headline">&#xB6;</a>&#x4E0A;&#x663E;&#x5F0F;&#x4FDD;&#x6301;NULL&#x7684;&#x65B0;&#x9009;&#x9879;</span></h3><p><span class="yiyi-st" id="yiyi-219">&#x4E0E;&#x4F5C;&#x4E3A;<a class="reference internal" href="#change-3514"><span>JSON &#x201C;null&#x201D; is inserted as expected with ORM operations, regardless of column default present</span></a>&#xFF0C;&#x57FA;&#x672C;&#x7684;<a class="reference internal" href="core_type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal"><span class="pre">TypeEngine</span></code></a>&#x7C7B;&#x73B0;&#x5728;&#x652F;&#x6301;<a class="reference internal" href="core_type_api.html#sqlalchemy.types.TypeEngine.evaluates_none" title="sqlalchemy.types.TypeEngine.evaluates_none"><code class="xref py py-meth docutils literal"><span class="pre">TypeEngine.evaluates_none()</span></code></a>&#x65B9;&#x6CD5;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x5141;&#x8BB8;&#x5C06;&#x5C5E;&#x6027;&#x4E0A;&#x7684;<code class="docutils literal"><span class="pre">None</span></code>&#x503C;&#x7684;&#x80AF;&#x5B9A;&#x96C6;&#x4FDD;&#x7559;&#x4E3A;NULL&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x4ECE;INSERT&#x8BED;&#x53E5;&#x4E2D;&#x7701;&#x7565;&#x5217;&#xFF0C;&#x5B83;&#x5177;&#x6709;&#x4F7F;&#x7528;&#x5217;&#x7EA7;&#x522B;&#x7F3A;&#x7701;&#x7684;&#x6548;&#x679C;&#x3002;</span><span class="yiyi-st" id="yiyi-220">&#x8FD9;&#x5141;&#x8BB8;&#x5C06;&#x73B0;&#x6709;&#x5BF9;&#x8C61;&#x7EA7;&#x522B;&#x7684;&#x6280;&#x672F;&#x5206;&#x914D;&#x7ED9;&#x5C5E;&#x6027;&#x7684;<code class="xref py py-func docutils literal"><span class="pre">sql.null()</span></code>&#x7684;&#x6620;&#x5C04;&#x5668;&#x7EA7;&#x914D;&#x7F6E;&#x3002;</span></p><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-221">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-222"><a class="reference internal" href="orm_persistence_techniques.html#session-forcing-null"><span>Forcing NULL on a column with a default</span></a>&#x7684;&#x5217;&#x4E0A;&#x5F3A;&#x5236;NULL</span></p></div><p><span class="yiyi-st" id="yiyi-223"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3250">&#xFF03;3250  T0&gt;</a></span></p></div><div class="section" id="further-fixes-to-single-table-inheritance-querying"><h3><span class="yiyi-st" id="yiyi-224">&#x8FDB;&#x4E00;&#x6B65;&#x4FEE;&#x590D;&#x5355;&#x8868;&#x7EE7;&#x627F;&#x67E5;&#x8BE2;<a class="headerlink" href="#further-fixes-to-single-table-inheritance-querying" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-225">Continuing from 1.0&#x2019;s <a class="reference internal" href="migration_10.html#migration-3177"><span>Change to single-table-inheritance criteria when using from_self(), count()</span></a>, the <a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query" title="sqlalchemy.orm.query.Query"><code class="xref py py-class docutils literal"><span class="pre">Query</span></code></a> should no longer inappropriately add the &#x201C;single inheritance&#x201D; criteria when the query is against a subquery expression such as an exists:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Widget</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;widget&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>
    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&apos;polymorphic_on&apos;</span><span class="p">:</span> <span class="nb">type</span><span class="p">}</span>


<span class="k">class</span> <span class="nc">FooWidget</span><span class="p">(</span><span class="n">Widget</span><span class="p">):</span>
    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&apos;polymorphic_identity&apos;</span><span class="p">:</span> <span class="s1">&apos;foo&apos;</span><span class="p">}</span>

<span class="n">q</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">FooWidget</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">FooWidget</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s1">&apos;bar&apos;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>

<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></pre></div></div><p><span class="yiyi-st" id="yiyi-226">&#x751F;&#x4EA7;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT EXISTS (SELECT 1
FROM widget
WHERE widget.data = :data_1 AND widget.type IN (:type_1)) AS anon_1</pre></div></div><p><span class="yiyi-st" id="yiyi-227">&#x5728;&#x5185;&#x90E8;&#x7684;IN&#x5B50;&#x53E5;&#x662F;&#x9002;&#x5F53;&#x7684;&#xFF0C;&#x4E3A;&#x4E86;&#x9650;&#x5236;&#x5230;FooWidget&#x5BF9;&#x8C61;&#xFF0C;&#x4F46;&#x662F;&#x4EE5;&#x524D;IN&#x5B50;&#x53E5;&#x4E5F;&#x4F1A;&#x5728;&#x5B50;&#x67E5;&#x8BE2;&#x7684;&#x5916;&#x9762;&#x518D;&#x6B21;&#x751F;&#x6210;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-228"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3582">&#xFF03;3582  T0&gt;</a></span></p></div><div class="section" id="improved-session-state-when-a-savepoint-is-cancelled-by-the-database"><h3><span class="yiyi-st" id="yiyi-229">&#x5F53;&#x6570;&#x636E;&#x5E93;<a class="headerlink" href="#improved-session-state-when-a-savepoint-is-cancelled-by-the-database" title="Permalink to this headline">&#xB6;</a>&#x53D6;&#x6D88;SAVEPOINT&#x65F6;&#x6539;&#x8FDB;&#x4E86;&#x4F1A;&#x8BDD;&#x72B6;&#x6001;</span></h3><p><span class="yiyi-st" id="yiyi-230">MySQL&#x7684;&#x4E00;&#x4E2A;&#x5E38;&#x89C1;&#x60C5;&#x51B5;&#x662F;&#x5F53;&#x4E8B;&#x52A1;&#x5185;&#x53D1;&#x751F;&#x6B7B;&#x9501;&#x65F6;&#xFF0C;SAVEPOINT&#x88AB;&#x53D6;&#x6D88;&#x3002;</span><span class="yiyi-st" id="yiyi-231"><a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x5DF2;&#x88AB;&#x4FEE;&#x6539;&#xFF0C;&#x4EE5;&#x7A0D;&#x5FAE;&#x66F4;&#x4F18;&#x96C5;&#x5730;&#x5904;&#x7406;&#x8FD9;&#x79CD;&#x5931;&#x8D25;&#x6A21;&#x5F0F;&#xFF0C;&#x4EE5;&#x4F7F;&#x5916;&#x90E8;&#x7684;&#x975E;&#x4FDD;&#x5B58;&#x70B9;&#x4E8B;&#x52A1;&#x4ECD;&#x7136;&#x53EF;&#x7528;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>
<span class="n">s</span><span class="o">.</span><span class="n">begin_nested</span><span class="p">()</span>

<span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">SomeObject</span><span class="p">())</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># assume the flush fails, flush goes to rollback to the</span>
    <span class="c1"># savepoint and that also fails</span>
    <span class="n">s</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Something broke, and our SAVEPOINT vanished too&quot;</span><span class="p">)</span>

<span class="c1"># this is the SAVEPOINT transaction, marked as</span>
<span class="c1"># DEACTIVE so the rollback() call succeeds</span>
<span class="n">s</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>

<span class="c1"># this is the outermost transaction, remains ACTIVE</span>
<span class="c1"># so rollback() or commit() can succeed</span>
<span class="n">s</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span></pre></div></div><p><span class="yiyi-st" id="yiyi-232">&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x662F;<a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2696">&#xFF03;2696</a>&#x7684;&#x4E00;&#x4E2A;&#x5EF6;&#x7EED;&#xFF0C;&#x6211;&#x4EEC;&#x53D1;&#x51FA;&#x8B66;&#x544A;&#xFF0C;&#x4EE5;&#x4FBF;&#x5728;Python 2&#x4E0A;&#x8FD0;&#x884C;&#x65F6;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x539F;&#x59CB;&#x9519;&#x8BEF;&#xFF0C;&#x5373;&#x4F7F;SAVEPOINT&#x5F02;&#x5E38;&#x4F18;&#x5148;&#x3002;</span><span class="yiyi-st" id="yiyi-233">&#x5728;Python 3&#x4E2D;&#xFF0C;&#x5F02;&#x5E38;&#x662F;&#x94FE;&#x63A5;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x4E24;&#x4E2A;&#x5931;&#x8D25;&#x90FD;&#x4F1A;&#x5355;&#x72EC;&#x62A5;&#x544A;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-234"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3680">&#xFF03;3680  T0&gt;</a></span></p></div><div class="section" id="erroneous-new-instance-x-conflicts-with-persistent-instance-y-flush-errors-fixed"><h3><span class="yiyi-st" id="yiyi-235">&#x9519;&#x8BEF;&#x7684;&#x201C;&#x65B0;&#x5B9E;&#x4F8B;X&#x4E0E;&#x6301;&#x4E45;&#x6027;&#x5B9E;&#x4F8B;Y&#x51B2;&#x7A81;&#x201D;flush flush fixed <a class="headerlink" href="#erroneous-new-instance-x-conflicts-with-persistent-instance-y-flush-errors-fixed" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-236"><a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session.rollback" title="sqlalchemy.orm.session.Session.rollback"><code class="xref py py-meth docutils literal"><span class="pre">Session.rollback()</span></code></a>&#x65B9;&#x6CD5;&#x8D1F;&#x8D23;&#x5220;&#x9664;&#x63D2;&#x5165;&#x5230;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x4F8B;&#x5982;&#x4ECE;&#x6302;&#x8D77;&#x8F6C;&#x79FB;&#x5230;&#x6301;&#x4E45;&#xFF0C;&#x5728;&#x73B0;&#x5728;&#x7684;&#x56DE;&#x6EDA;&#x4E8B;&#x52A1;&#x4E2D;&#x3002;</span><span class="yiyi-st" id="yiyi-237">&#x4F7F;&#x8FD9;&#x79CD;&#x72B6;&#x6001;&#x53D8;&#x5316;&#x7684;&#x5BF9;&#x8C61;&#x5728;&#x5F31;&#x5F15;&#x7528;&#x96C6;&#x5408;&#x4E2D;&#x88AB;&#x8DDF;&#x8E2A;&#xFF0C;&#x5E76;&#x4E14;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x4ECE;&#x8BE5;&#x96C6;&#x5408;&#x4E2D;&#x88AB;&#x5783;&#x573E;&#x6536;&#x96C6;&#xFF0C;<a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x4E0D;&#x518D;&#x62C5;&#x5FC3;&#x5B83;&#xFF08;&#x5426;&#x5219;&#x5B83;&#x4E0D;&#x4F1A;&#x4E3A;&#x63D2;&#x5165;&#x64CD;&#x4F5C;&#x4EA4;&#x6613;&#x4E2D;&#x7684;&#x8BB8;&#x591A;&#x65B0;&#x5BF9;&#x8C61;&#xFF09;&#x3002;</span><span class="yiyi-st" id="yiyi-238">&#x4F46;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5728;&#x56DE;&#x6EDA;&#x53D1;&#x751F;&#x4E4B;&#x524D;&#x91CD;&#x65B0;&#x52A0;&#x8F7D;&#x4E8B;&#x52A1;&#x5185;&#x7684;&#x76F8;&#x540C;&#x5783;&#x573E;&#x6536;&#x96C6;&#x884C;&#xFF0C;&#x5219;&#x4F1A;&#x51FA;&#x73B0;&#x95EE;&#x9898;&#xFF1B;&#x5982;&#x679C;&#x5BF9;&#x8BE5;&#x5BF9;&#x8C61;&#x7684;&#x5F3A;&#x5F15;&#x7528;&#x4FDD;&#x7559;&#x5728;&#x4E0B;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#x4E2D;&#xFF0C;&#x5219;&#x8BE5;&#x5BF9;&#x8C61;&#x672A;&#x88AB;&#x63D2;&#x5165;&#x5E76;&#x4E14;&#x5E94;&#x8BE5;&#x88AB;&#x79FB;&#x9664;&#x7684;&#x4E8B;&#x5B9E;&#x5C06;&#x4F1A;&#x4E22;&#x5931;&#xFF0C;&#x5E76;&#x4E14;flush&#x4F1A;&#x9519;&#x8BEF;&#x5730;&#x5F15;&#x53D1;&#x9519;&#x8BEF;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Column</span><span class="p">,</span> <span class="n">create_engine</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">Session</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>

<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;a&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;sqlite://&quot;</span><span class="p">,</span> <span class="n">echo</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">Session</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="c1"># persist an object</span>
<span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="n">s</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

<span class="c1"># rollback buffer loses reference to A</span>

<span class="c1"># load it again, rollback buffer knows nothing</span>
<span class="c1"># about it</span>
<span class="n">a1</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

<span class="c1"># roll back the transaction; all state is expired but the</span>
<span class="c1"># &quot;a1&quot; reference remains</span>
<span class="n">s</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>

<span class="c1"># previous &quot;a1&quot; conflicts with the new one because we aren&apos;t</span>
<span class="c1"># checking that it never got committed</span>
<span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="n">s</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></pre></div></div><p><span class="yiyi-st" id="yiyi-239">&#x4E0A;&#x8FF0;&#x8BA1;&#x5212;&#x5C06;&#x63D0;&#x9AD8;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>FlushError: New instance &lt;User at 0x7f0287eca4d0&gt; with identity key
(&lt;class &apos;test.orm.test_transaction.User&apos;&gt;, (&apos;u1&apos;,)) conflicts
with persistent instance &lt;User at 0x7f02889c70d0&gt;</pre></div></div><p><span class="yiyi-st" id="yiyi-240">&#x8FD9;&#x4E2A;&#x9519;&#x8BEF;&#x662F;&#xFF0C;&#x5F53;&#x4E0A;&#x9762;&#x7684;&#x5F02;&#x5E38;&#x88AB;&#x5F15;&#x53D1;&#x65F6;&#xFF0C;&#x5DE5;&#x4F5C;&#x5355;&#x5143;&#x6B63;&#x5728;&#x5BF9;&#x539F;&#x59CB;&#x5BF9;&#x8C61;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#xFF0C;&#x5047;&#x8BBE;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x6D3B;&#x52A8;&#x884C;&#xFF0C;&#x4E8B;&#x5B9E;&#x4E0A;&#x8BE5;&#x5BF9;&#x8C61;&#x5DF2;&#x7ECF;&#x8FC7;&#x671F;&#xFF0C;&#x5E76;&#x4E14;&#x7ECF;&#x8FC7;&#x6D4B;&#x8BD5;&#x53D1;&#x73B0;&#x5B83;&#x5DF2;&#x7ECF;&#x6D88;&#x5931;&#x3002;</span><span class="yiyi-st" id="yiyi-241">&#x4FEE;&#x590D;&#x7A0B;&#x5E8F;&#x73B0;&#x5728;&#x6D4B;&#x8BD5;&#x8FD9;&#x4E2A;&#x6761;&#x4EF6;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x6211;&#x4EEC;&#x770B;&#x5230;&#x7684;SQL&#x65E5;&#x5FD7;&#x4E2D;&#xFF1A;</span></p><div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">BEGIN</span> <span class="p">(</span><span class="k">implicit</span><span class="p">)</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">a</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="o">?</span><span class="p">)</span>
<span class="p">(</span><span class="mi">1</span><span class="p">,)</span>

<span class="k">SELECT</span> <span class="n">a</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">a_id</span> <span class="k">FROM</span> <span class="n">a</span> <span class="k">LIMIT</span> <span class="o">?</span> <span class="k">OFFSET</span> <span class="o">?</span>
<span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="k">ROLLBACK</span>

<span class="k">BEGIN</span> <span class="p">(</span><span class="k">implicit</span><span class="p">)</span>

<span class="k">SELECT</span> <span class="n">a</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">a_id</span> <span class="k">FROM</span> <span class="n">a</span> <span class="k">WHERE</span> <span class="n">a</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="o">?</span>
<span class="p">(</span><span class="mi">1</span><span class="p">,)</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">a</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="o">?</span><span class="p">)</span>
<span class="p">(</span><span class="mi">1</span><span class="p">,)</span>

<span class="k">COMMIT</span></pre></div></div><p><span class="yiyi-st" id="yiyi-242">&#x5728;&#x4E0A;&#x9762;&#xFF0C;&#x5DE5;&#x4F5C;&#x5355;&#x5143;&#x73B0;&#x5728;&#x4E3A;&#x6211;&#x4EEC;&#x5C06;&#x8981;&#x62A5;&#x544A;&#x7684;&#x884C;&#x505A;&#x4E00;&#x4E2A;SELECT&#xFF0C;&#x4F5C;&#x4E3A;&#x51B2;&#x7A81;&#xFF0C;&#x770B;&#x5230;&#x5B83;&#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x5E76;&#x6B63;&#x5E38;&#x8FDB;&#x884C;&#x3002;</span><span class="yiyi-st" id="yiyi-243">&#x53EA;&#x6709;&#x5728;&#x6211;&#x4EEC;&#x5728;&#x4EFB;&#x4F55;&#x60C5;&#x51B5;&#x4E0B;&#x90FD;&#x4F1A;&#x9519;&#x8BEF;&#x5730;&#x5F15;&#x53D1;&#x5F02;&#x5E38;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x624D;&#x4F1A;&#x4EA7;&#x751F;&#x6B64;SELECT&#x7684;&#x8D39;&#x7528;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-244"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3677">&#xFF03;3677  T0&gt;</a></span></p></div><div class="section" id="passive-deletes-feature-for-joined-inheritance-mappings"><h3><span class="yiyi-st" id="yiyi-245">&#x7528;&#x4E8E;&#x52A0;&#x5165;&#x7EE7;&#x627F;&#x6620;&#x5C04;&#x7684;passive_deletes&#x529F;&#x80FD;<a class="headerlink" href="#passive-deletes-feature-for-joined-inheritance-mappings" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-246">&#x73B0;&#x5728;&#xFF0C;&#x7531;&#x4E8E;<a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session.delete" title="sqlalchemy.orm.session.Session.delete"><code class="xref py py-meth docutils literal"><span class="pre">Session.delete()</span></code></a>&#xFF0C;&#x8FDE;&#x63A5;&#x8868;&#x7EE7;&#x627F;&#x6620;&#x5C04;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x5141;&#x8BB8;DELETE&#x7EE7;&#x7EED;&#x6267;&#x884C;&#xFF0C;&#x5B83;&#x4EC5;&#x4E3A;&#x57FA;&#x8868;&#x53D1;&#x51FA;DELETE&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5B50;&#x7C7B;&#x8868;&#xFF0C;&#x5141;&#x8BB8;&#x914D;&#x7F6E;ON DELETE CASCADE&#x4E3A;&#x914D;&#x7F6E;&#x7684;&#x5916;&#x952E;&#x8FDB;&#x884C;&#x3002;</span><span class="yiyi-st" id="yiyi-247">&#x8FD9;&#x662F;&#x4F7F;&#x7528;<a class="reference internal" href="orm_mapping_api.html#sqlalchemy.orm.mapper.params.passive_deletes" title="sqlalchemy.orm.mapper"><code class="xref py py-paramref docutils literal"><span class="pre">orm.mapper.passive_deletes</span></code></a>&#x9009;&#x9879;&#x914D;&#x7F6E;&#x7684;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">,</span> <span class="n">create_engine</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">Session</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>

<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;id&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>

    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&apos;polymorphic_on&apos;</span><span class="p">:</span> <span class="nb">type</span><span class="p">,</span>
        <span class="s1">&apos;polymorphic_identity&apos;</span><span class="p">:</span> <span class="s1">&apos;a&apos;</span><span class="p">,</span>
        <span class="s1">&apos;passive_deletes&apos;</span><span class="p">:</span> <span class="bp">True</span>
    <span class="p">}</span>


<span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;b&apos;</span>
    <span class="n">b_table_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;b_table_id&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">bid</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;bid&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;a.id&apos;</span><span class="p">,</span> <span class="n">ondelete</span><span class="o">=</span><span class="s2">&quot;CASCADE&quot;</span><span class="p">))</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;data&apos;</span><span class="p">,</span> <span class="n">String</span><span class="p">)</span>

    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&apos;polymorphic_identity&apos;</span><span class="p">:</span> <span class="s1">&apos;b&apos;</span>
    <span class="p">}</span></pre></div></div><p><span class="yiyi-st" id="yiyi-248">&#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x7684;&#x6620;&#x5C04;&#xFF0C;&#x5728;&#x57FA;&#x672C;&#x6620;&#x5C04;&#x5668;&#x4E0A;&#x914D;&#x7F6E;<a class="reference internal" href="orm_mapping_api.html#sqlalchemy.orm.mapper.params.passive_deletes" title="sqlalchemy.orm.mapper"><code class="xref py py-paramref docutils literal"><span class="pre">orm.mapper.passive_deletes</span></code></a>&#x9009;&#x9879;&#xFF1B;&#x5B83;&#x5BF9;&#x4E8E;&#x5177;&#x6709;&#x9009;&#x9879;&#x96C6;&#x7684;&#x6620;&#x5C04;&#x5668;&#x7684;&#x540E;&#x4EE3;&#x7684;&#x6240;&#x6709;&#x975E;&#x57FA;&#x672C;&#x6620;&#x5C04;&#x5668;&#x90FD;&#x6709;&#x6548;&#x3002;</span><span class="yiyi-st" id="yiyi-249">&#x5BF9;&#x4E8E;<code class="docutils literal"><span class="pre">B</span></code>&#x7C7B;&#x578B;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;DELETE&#x4E0D;&#x518D;&#x9700;&#x8981;&#x68C0;&#x7D22;<code class="docutils literal"><span class="pre">b_table_id</span></code>&#x7684;&#x4E3B;&#x952E;&#x503C;&#xFF08;&#x5982;&#x679C;&#x672A;&#x52A0;&#x8F7D;&#xFF09;&#xFF0C;&#x4E5F;&#x4E0D;&#x9700;&#x8981;&#x4E3A;&#x8868;&#x672C;&#x8EAB;&#x53D1;&#x51FA;DELETE&#x8BED;&#x53E5;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">some_b</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></pre></div></div><p><span class="yiyi-st" id="yiyi-250">&#x5C06;&#x53D1;&#x51FA;SQL&#x5982;&#x4E0B;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>DELETE FROM a WHERE a.id = %(id)s
{&apos;id&apos;: 1}
COMMIT</pre></div></div><p><span class="yiyi-st" id="yiyi-251">&#x4E0E;&#x5F80;&#x5E38;&#x4E00;&#x6837;&#xFF0C;&#x76EE;&#x6807;&#x6570;&#x636E;&#x5E93;&#x5FC5;&#x987B;&#x5177;&#x6709;&#x542F;&#x7528;ON DELETE CASCADE&#x7684;&#x5916;&#x952E;&#x652F;&#x6301;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-252"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2349">&#xFF03;2349  T0&gt;</a></span></p></div><div class="section" id="same-named-backrefs-will-not-raise-an-error-when-applied-to-concrete-inheritance-subclasses"><h3><span class="yiyi-st" id="yiyi-253">&#x76F8;&#x540C;&#x540D;&#x79F0;&#x7684;backrefs&#x5728;&#x5E94;&#x7528;&#x4E8E;&#x5177;&#x4F53;&#x7EE7;&#x627F;&#x5B50;&#x7C7B;&#x65F6;&#x4E0D;&#x4F1A;&#x5F15;&#x53D1;&#x9519;&#x8BEF;<a class="headerlink" href="#same-named-backrefs-will-not-raise-an-error-when-applied-to-concrete-inheritance-subclasses" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-254">&#x4EE5;&#x4E0B;&#x6620;&#x5C04;&#x603B;&#x662F;&#x53EF;&#x4EE5;&#x6CA1;&#x6709;&#x95EE;&#x9898;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;a&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="n">foreign_keys</span><span class="o">=</span><span class="s2">&quot;B.a_id&quot;</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">A1</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;a1&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="n">foreign_keys</span><span class="o">=</span><span class="s2">&quot;B.a1_id&quot;</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="s2">&quot;a1&quot;</span><span class="p">)</span>
    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&apos;concrete&apos;</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>

<span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;b&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">a_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;a.id&apos;</span><span class="p">))</span>
    <span class="n">a1_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;a1.id&apos;</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-255">&#x5728;&#x4E0A;&#x9762;&#xFF0C;&#x5C3D;&#x7BA1;&#x7C7B;<code class="docutils literal"><span class="pre">A</span></code>&#x548C;&#x7C7B;<code class="docutils literal"><span class="pre">A1</span></code>&#x6709;&#x4E00;&#x4E2A;&#x540D;&#x4E3A;<code class="docutils literal"><span class="pre">b</span></code>&#x7684;&#x5173;&#x7CFB;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x4F1A;&#x53D1;&#x751F;&#x51B2;&#x7A81;&#x8B66;&#x544A;&#x6216;&#x9519;&#x8BEF;&#xFF0C;&#x56E0;&#x4E3A;&#x7C7B;<code class="docutils literal"><span class="pre">A1</span></code></span></p><p><span class="yiyi-st" id="yiyi-256">&#x4F46;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x4EE5;&#x5176;&#x4ED6;&#x65B9;&#x5F0F;&#x914D;&#x7F6E;&#x5173;&#x7CFB;&#xFF0C;&#x5219;&#x4F1A;&#x53D1;&#x751F;&#x9519;&#x8BEF;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;a&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">A1</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;a1&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&apos;concrete&apos;</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>


<span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;b&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">a_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;a.id&apos;</span><span class="p">))</span>
    <span class="n">a1_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;a1.id&apos;</span><span class="p">))</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">)</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;A1&quot;</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-257">&#x6B64;&#x4FEE;&#x8865;&#x7A0B;&#x5E8F;&#x589E;&#x5F3A;&#x4E86;backref&#x529F;&#x80FD;&#xFF0C;&#x56E0;&#x6B64;&#x4E0D;&#x4F1A;&#x53D1;&#x51FA;&#x9519;&#x8BEF;&#xFF0C;&#x8FD8;&#x4F1A;&#x5728;&#x6620;&#x5C04;&#x7A0B;&#x5E8F;&#x903B;&#x8F91;&#x4E2D;&#x8FDB;&#x884C;&#x989D;&#x5916;&#x7684;&#x68C0;&#x67E5;&#x4EE5;&#x7ED5;&#x8FC7;&#x8981;&#x66FF;&#x6362;&#x7684;&#x5C5E;&#x6027;&#x7684;&#x8B66;&#x544A;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-258"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3630">&#xFF03;3630  T0&gt;</a></span></p></div><div class="section" id="hybrid-properties-and-methods-now-propagate-the-docstring-as-well-as-info"><h3><span class="yiyi-st" id="yiyi-259">&#x6DF7;&#x5408;&#x5C5E;&#x6027;&#x548C;&#x65B9;&#x6CD5;&#x73B0;&#x5728;&#x4F20;&#x64AD;docstring&#x4EE5;&#x53CA;.info <a class="headerlink" href="#hybrid-properties-and-methods-now-propagate-the-docstring-as-well-as-info" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-260">&#x6DF7;&#x5408;&#x65B9;&#x6CD5;&#x6216;&#x5C5E;&#x6027;&#x73B0;&#x5728;&#x5C06;&#x53CD;&#x6620;&#x539F;&#x59CB;&#x6587;&#x6863;&#x5B57;&#x7B26;&#x4E32;&#x4E2D;&#x5B58;&#x5728;&#x7684;<code class="docutils literal"><span class="pre">__doc__</span></code>&#x503C;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;a&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>

    <span class="nd">@hybrid_property</span>
    <span class="k">def</span> <span class="nf">some_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The name field&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span></pre></div></div><p><span class="yiyi-st" id="yiyi-261">&#x73B0;&#x5728;&#xFF0C;<code class="docutils literal"><span class="pre">A.some_name.__doc__</span></code>&#x7684;&#x4E0A;&#x8FF0;&#x503C;&#x73B0;&#x5728;&#x7B26;&#x5408;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span><span class="o">.</span><span class="n">some_name</span><span class="o">.</span><span class="n">__doc__</span>
<span class="go">The name field</span></pre></div></div><p><span class="yiyi-st" id="yiyi-262">&#x4F46;&#x662F;&#xFF0C;&#x8981;&#x5B9E;&#x73B0;&#x8FD9;&#x4E00;&#x70B9;&#xFF0C;&#x6DF7;&#x5408;&#x5C5E;&#x6027;&#x7684;&#x673A;&#x5236;&#x5FC5;&#x7136;&#x53D8;&#x5F97;&#x66F4;&#x52A0;&#x590D;&#x6742;&#x3002;</span><span class="yiyi-st" id="yiyi-263">&#x4EE5;&#x524D;&#xFF0C;&#x6DF7;&#x5408;&#x7C7B;&#x7684;&#x7EA7;&#x522B;&#x8BBF;&#x95EE;&#x5668;&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;pass-thru&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x8FD9;&#x4E2A;&#x6D4B;&#x8BD5;&#x4F1A;&#x6210;&#x529F;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">A</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="n">A</span><span class="o">.</span><span class="n">some_name</span></pre></div></div><p><span class="yiyi-st" id="yiyi-264">&#x901A;&#x8FC7;&#x6539;&#x53D8;&#xFF0C;&#x7531;<code class="docutils literal"><span class="pre">A.some_name</span></code>&#x8FD4;&#x56DE;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#x88AB;&#x5C01;&#x88C5;&#x5728;&#x5B83;&#x81EA;&#x5DF1;&#x7684;<code class="docutils literal"><span class="pre">QueryableAttribute</span></code>&#x5305;&#x88C5;&#x5668;&#x4E2D;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span><span class="o">.</span><span class="n">some_name</span>
<span class="go">&lt;sqlalchemy.orm.attributes.hybrid_propertyProxy object at 0x7fde03888230&gt;</span></pre></div></div><p><span class="yiyi-st" id="yiyi-265">&#x5927;&#x91CF;&#x7684;&#x6D4B;&#x8BD5;&#x8FDB;&#x5165;&#x786E;&#x4FDD;&#x8FD9;&#x4E2A;&#x5305;&#x88C5;&#x5668;&#x6B63;&#x5E38;&#x5DE5;&#x4F5C;&#xFF0C;&#x5305;&#x62EC;&#x50CF;<a class="reference external" href="http://techspot.zzzeek.org/2011/10/21/hybrids-and-value-agnostic-types/">Custom Value Object</a>&#x914D;&#x65B9;&#x90A3;&#x6837;&#x7684;&#x590D;&#x6742;&#x65B9;&#x6848;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x4F1A;&#x770B;&#x5230;&#x7528;&#x6237;&#x6CA1;&#x6709;&#x53D1;&#x751F;&#x5176;&#x4ED6;&#x56DE;&#x5F52;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-266">&#x4F5C;&#x4E3A;&#x8FD9;&#x79CD;&#x53D8;&#x5316;&#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x73B0;&#x5728;&#x8FD8;&#x4ECE;&#x6DF7;&#x5408;&#x63CF;&#x8FF0;&#x7B26;&#x672C;&#x8EAB;&#x4F20;&#x64AD;<code class="xref py py-attr docutils literal"><span class="pre">hybrid_property.info</span></code>&#x96C6;&#x5408;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x4ECE;&#x57FA;&#x7840;&#x8868;&#x8FBE;&#x5F0F;&#x4F20;&#x64AD;&#x3002;</span><span class="yiyi-st" id="yiyi-267">&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x8BBF;&#x95EE;<code class="docutils literal"><span class="pre">A.some_name.info</span></code>&#x73B0;&#x5728;&#x4F1A;&#x8FD4;&#x56DE;&#x60A8;&#x4ECE;<code class="docutils literal"><span class="pre">inspect(A).all_orm_descriptors[&apos;some_name&apos;].info</span></code>&#x83B7;&#x5F97;&#x7684;&#x76F8;&#x540C;&#x5B57;&#x5178;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span><span class="o">.</span><span class="n">some_name</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&apos;foo&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&apos;bar&apos;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">inspect</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inspect</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">all_orm_descriptors</span><span class="p">[</span><span class="s1">&apos;some_name&apos;</span><span class="p">]</span><span class="o">.</span><span class="n">info</span>
<span class="go">{&apos;foo&apos;: &apos;bar&apos;}</span></pre></div></div><p><span class="yiyi-st" id="yiyi-268">&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x8FD9;&#x4E2A;<code class="docutils literal"><span class="pre">.info</span></code>&#x5B57;&#x5178;&#x4E0E;&#x6DF7;&#x5408;&#x63CF;&#x8FF0;&#x7B26;&#x53EF;&#x80FD;&#x76F4;&#x63A5;&#x4EE3;&#x7406;&#x7684;&#x6620;&#x5C04;&#x5C5E;&#x6027;&#x7684;<strong>&#x5206;&#x5F00;</strong>&#x8FD9;&#x662F;&#x4ECE;1.0&#x5F00;&#x59CB;&#x7684;&#x884C;&#x4E3A;&#x53D8;&#x5316;&#x3002;</span><span class="yiyi-st" id="yiyi-269">&#x5305;&#x88C5;&#x5668;&#x4ECD;&#x5C06;&#x4EE3;&#x7406;&#x955C;&#x50CF;&#x5C5E;&#x6027;&#x7684;&#x5176;&#x4ED6;&#x6709;&#x7528;&#x5C5E;&#x6027;&#xFF0C;&#x5982;<a class="reference internal" href="orm_internals.html#sqlalchemy.orm.attributes.QueryableAttribute.property" title="sqlalchemy.orm.attributes.QueryableAttribute.property"><code class="xref py py-attr docutils literal"><span class="pre">QueryableAttribute.property</span></code></a>&#x548C;<code class="xref py py-attr docutils literal"><span class="pre">QueryableAttribute.class_</span></code>&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-270"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3653">&#xFF03;3653  T0&gt;</a></span></p></div><div class="section" id="session-merge-resolves-pending-conflicts-the-same-as-persistent"><h3><span class="yiyi-st" id="yiyi-271">Session.merge&#x89E3;&#x51B3;&#x4E86;&#x4E0E;&#x6301;&#x4E45;<a class="headerlink" href="#session-merge-resolves-pending-conflicts-the-same-as-persistent" title="Permalink to this headline">&#xB6;</a>&#x76F8;&#x540C;&#x7684;&#x672A;&#x51B3;&#x51B2;&#x7A81;</span></h3><p><span class="yiyi-st" id="yiyi-272"><a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session.merge" title="sqlalchemy.orm.session.Session.merge"><code class="xref py py-meth docutils literal"><span class="pre">Session.merge()</span></code></a>&#x65B9;&#x6CD5;&#x73B0;&#x5728;&#x5C06;&#x8DDF;&#x8E2A;&#x56FE;&#x4E2D;&#x7ED9;&#x5B9A;&#x7684;&#x5BF9;&#x8C61;&#x7684;&#x8EAB;&#x4EFD;&#xFF0C;&#x4EE5;&#x5728;&#x53D1;&#x51FA;INSERT&#x4E4B;&#x524D;&#x4FDD;&#x6301;&#x4E3B;&#x952E;&#x552F;&#x4E00;&#x6027;&#x3002;</span><span class="yiyi-st" id="yiyi-273">&#x5F53;&#x9047;&#x5230;&#x76F8;&#x540C;&#x8EAB;&#x4EFD;&#x7684;&#x91CD;&#x590D;&#x5BF9;&#x8C61;&#x65F6;&#xFF0C;&#x9047;&#x5230;&#x5BF9;&#x8C61;&#x65F6;&#x975E;&#x4E3B;&#x952E;&#x5C5E;&#x6027;&#x88AB;<strong>&#x8986;&#x76D6;</strong>&#xFF0C;&#x8FD9;&#x57FA;&#x672C;&#x4E0A;&#x662F;&#x975E;&#x786E;&#x5B9A;&#x6027;&#x7684;&#x3002;</span><span class="yiyi-st" id="yiyi-274">&#x6B64;&#x884C;&#x4E3A;&#x4E0E;&#x6301;&#x4E45;&#x5BF9;&#x8C61;&#xFF08;&#x5373;&#x901A;&#x8FC7;&#x4E3B;&#x952E;&#x5DF2;&#x4F4D;&#x4E8E;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x7684;&#x5BF9;&#x8C61;&#xFF09;&#x5DF2;&#x88AB;&#x5904;&#x7406;&#x7684;&#x65B9;&#x5F0F;&#x76F8;&#x5339;&#x914D;&#xFF0C;&#x56E0;&#x6B64;&#x6B64;&#x884C;&#x4E3A;&#x5728;&#x5185;&#x90E8;&#x66F4;&#x4E00;&#x81F4;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-275">&#x9274;&#x4E8E;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">u1</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&apos;x&apos;</span><span class="p">)</span>
<span class="n">u1</span><span class="o">.</span><span class="n">orders</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">Order</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&apos;o1&apos;</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="n">Address</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">email_address</span><span class="o">=</span><span class="s1">&apos;a&apos;</span><span class="p">)),</span>
    <span class="n">Order</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&apos;o2&apos;</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="n">Address</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">email_address</span><span class="o">=</span><span class="s1">&apos;b&apos;</span><span class="p">)),</span>
    <span class="n">Order</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&apos;o3&apos;</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="n">Address</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">email_address</span><span class="o">=</span><span class="s1">&apos;c&apos;</span><span class="p">))</span>
<span class="p">]</span>

<span class="n">sess</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>
<span class="n">sess</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-276">&#x5728;&#x4E0A;&#x9762;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x4E00;&#x4E2A;<code class="docutils literal"><span class="pre">User</span></code>&#x5BF9;&#x8C61;&#x4E0E;&#x4E09;&#x4E2A;&#x65B0;&#x7684;<code class="docutils literal"><span class="pre">Order</span></code>&#x5BF9;&#x8C61;&#x5408;&#x5E76;&#xFF0C;&#x6BCF;&#x4E2A;&#x5BF9;&#x8C61;&#x5F15;&#x7528;&#x4E00;&#x4E2A;&#x4E0D;&#x540C;&#x7684;<code class="docutils literal"><span class="pre">Address</span></code>&#x5BF9;&#x8C61;&#xFF0C;&#x4F46;&#x662F;&#x6BCF;&#x4E2A;&#x5BF9;&#x8C61;&#x90FD;&#x88AB;&#x8D4B;&#x4E88;&#x76F8;&#x540C;&#x7684;&#x4E3B;&#x952E;&#x3002;</span><span class="yiyi-st" id="yiyi-277"><a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session.merge" title="sqlalchemy.orm.session.Session.merge"><code class="xref py py-meth docutils literal"><span class="pre">Session.merge()</span></code></a>&#x7684;&#x5F53;&#x524D;&#x884C;&#x4E3A;&#x662F;&#x67E5;&#x627E;&#x6B64;<code class="docutils literal"><span class="pre">Address</span></code>&#x5BF9;&#x8C61;&#x7684;&#x6807;&#x8BC6;&#x6620;&#x5C04;&#xFF0C;&#x5E76;&#x5C06;&#x5176;&#x7528;&#x4F5C;&#x76EE;&#x6807;&#x3002;</span><span class="yiyi-st" id="yiyi-278">If the object is present, meaning that the database already has a row for <code class="docutils literal"><span class="pre">Address</span></code> with primary key &#x201C;1&#x201D;, we can see that the <code class="docutils literal"><span class="pre">email_address</span></code> field of the <code class="docutils literal"><span class="pre">Address</span></code> will be overwritten three times, in this case with the values a, b and finally c.</span></p><p><span class="yiyi-st" id="yiyi-279">&#x4F46;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x4E3B;&#x952E;&#x201C;1&#x201D;&#x7684;<code class="docutils literal"><span class="pre">Address</span></code>&#x884C;&#x4E0D;&#x5B58;&#x5728;&#xFF0C;<a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session.merge" title="sqlalchemy.orm.session.Session.merge"><code class="xref py py-meth docutils literal"><span class="pre">Session.merge()</span></code></a>&#x4F1A;&#x6539;&#x4E3A;&#x521B;&#x5EFA;&#x4E09;&#x4E2A;&#x5355;&#x72EC;&#x7684;<code class="docutils literal"><span class="pre">Address</span></code>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x4F1A;&#x5728;INSERT&#x65F6;&#x53D1;&#x751F;&#x4E3B;&#x952E;&#x51B2;&#x7A81;&#x3002;</span><span class="yiyi-st" id="yiyi-280">&#x65B0;&#x884C;&#x4E3A;&#x662F;&#x4E3A;&#x8FD9;&#x4E9B;<code class="docutils literal"><span class="pre">Address</span></code>&#x5BF9;&#x8C61;&#x5EFA;&#x8BAE;&#x7684;&#x4E3B;&#x952E;&#x5728;&#x5355;&#x72EC;&#x7684;&#x5B57;&#x5178;&#x4E2D;&#x8FDB;&#x884C;&#x8DDF;&#x8E2A;&#xFF0C;&#x4EE5;&#x4FBF;&#x6211;&#x4EEC;&#x5C06;&#x4E09;&#x4E2A;&#x5EFA;&#x8BAE;&#x7684;<code class="docutils literal"><span class="pre">Address</span></code>&#x5BF9;&#x8C61;&#x7684;&#x72B6;&#x6001;&#x5408;&#x5E76;&#x5230;&#x4E00;&#x4E2A;<code class="docutils literal"><span class="pre">Address</span></code>&#x8981;&#x63D2;&#x5165;&#x7684;&#x5BF9;&#x8C61;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-281">&#x5982;&#x679C;&#x539F;&#x59CB;&#x6848;&#x4F8B;&#x53D1;&#x51FA;&#x67D0;&#x79CD;&#x8B66;&#x544A;&#xFF0C;&#x5373;&#x5728;&#x5355;&#x4E00;&#x5408;&#x5E76;&#x6811;&#x4E2D;&#x5B58;&#x5728;&#x51B2;&#x7A81;&#x6570;&#x636E;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x66F4;&#x597D;&#x4E00;&#x4E9B;&#xFF0C;&#x4F46;&#x662F;&#x5BF9;&#x4E8E;&#x6301;&#x4E45;&#x6027;&#x6848;&#x4F8B;&#xFF0C;&#x4EF7;&#x503C;&#x7684;&#x975E;&#x786E;&#x5B9A;&#x6027;&#x5408;&#x5E76;&#x5DF2;&#x7ECF;&#x6301;&#x7EED;&#x591A;&#x5E74;&#x3002;&#x5B83;&#x73B0;&#x5728;&#x5339;&#x914D;&#x5F85;&#x5904;&#x7406;&#x7684;&#x6848;&#x4F8B;&#x3002;</span><span class="yiyi-st" id="yiyi-282">&#x5BF9;&#x4E8E;&#x8FD9;&#x4E24;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x8B66;&#x544A;&#x51B2;&#x7A81;&#x503C;&#x7684;&#x529F;&#x80FD;&#x4ECD;&#x7136;&#x53EF;&#x884C;&#xFF0C;&#x4F46;&#x4F1A;&#x589E;&#x52A0;&#x76F8;&#x5F53;&#x5927;&#x7684;&#x6027;&#x80FD;&#x5F00;&#x9500;&#xFF0C;&#x56E0;&#x4E3A;&#x5728;&#x5408;&#x5E76;&#x671F;&#x95F4;&#x5FC5;&#x987B;&#x5BF9;&#x6BCF;&#x4E2A;&#x5217;&#x503C;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-283"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3601">&#xFF03;3601  T0&gt;</a></span></p></div><div class="section" id="fix-involving-many-to-one-object-moves-with-user-initiated-foriegn-key-manipulations"><h3><span class="yiyi-st" id="yiyi-284">&#x4FEE;&#x590D;&#x6D89;&#x53CA;&#x591A;&#x5BF9;&#x4E00;&#x5BF9;&#x8C61;&#x7684;&#x79FB;&#x52A8;&#xFF0C;&#x5E76;&#x4F7F;&#x7528;&#x7528;&#x6237;&#x542F;&#x52A8;&#x7684;foriegn&#x952E;&#x64CD;&#x4F5C;<a class="headerlink" href="#fix-involving-many-to-one-object-moves-with-user-initiated-foriegn-key-manipulations" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-285">&#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#x5DF2;&#x7ECF;&#x88AB;&#x4FEE;&#x590D;&#xFF0C;&#x6D89;&#x53CA;&#x7528;&#x53E6;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x66FF;&#x6362;&#x5BF9;&#x8C61;&#x7684;&#x591A;&#x5BF9;&#x4E00;&#x5F15;&#x7528;&#x7684;&#x673A;&#x5236;&#x3002;</span><span class="yiyi-st" id="yiyi-286">&#x5728;&#x5C5E;&#x6027;&#x64CD;&#x4F5C;&#x671F;&#x95F4;&#xFF0C;&#x5148;&#x524D;&#x5F15;&#x7528;&#x7684;&#x5BF9;&#x8C61;&#x7684;&#x4F4D;&#x7F6E;&#x73B0;&#x5728;&#x4F7F;&#x7528;&#x6570;&#x636E;&#x5E93;&#x63D0;&#x4EA4;&#x7684;&#x5916;&#x952E;&#x503C;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5F53;&#x524D;&#x7684;&#x5916;&#x952E;&#x503C;&#x3002;</span><span class="yiyi-st" id="yiyi-287">&#x4FEE;&#x590D;&#x7684;&#x4E3B;&#x8981;&#x6548;&#x679C;&#x662F;&#xFF0C;&#x5373;&#x4F7F;&#x5916;&#x952E;&#x5C5E;&#x6027;&#x4E8B;&#x5148;&#x88AB;&#x624B;&#x52A8;&#x79FB;&#x52A8;&#x5230;&#x65B0;&#x503C;&#xFF0C;&#x5728;&#x8FDB;&#x884C;&#x591A;&#x5BF9;&#x4E00;&#x66F4;&#x6539;&#x65F6;&#xFF0C;&#x5BF9;&#x96C6;&#x5408;&#x7684;backref&#x4E8B;&#x4EF6;&#x4E5F;&#x4F1A;&#x66F4;&#x51C6;&#x786E;&#x5730;&#x89E6;&#x53D1;&#x3002;</span><span class="yiyi-st" id="yiyi-288">Assume a mapping of the classes <code class="docutils literal"><span class="pre">Parent</span></code> and <code class="docutils literal"><span class="pre">SomeClass</span></code>, where <code class="docutils literal"><span class="pre">SomeClass.parent</span></code> refers to <code class="docutils literal"><span class="pre">Parent</span></code> and <code class="docutils literal"><span class="pre">Parent.items</span></code> refers to the collection of <code class="docutils literal"><span class="pre">SomeClass</span></code> objects:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">some_object</span> <span class="o">=</span> <span class="n">SomeClass</span><span class="p">()</span>
<span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">some_object</span><span class="p">)</span>
<span class="n">some_object</span><span class="o">.</span><span class="n">parent_id</span> <span class="o">=</span> <span class="n">some_parent</span><span class="o">.</span><span class="n">id</span>
<span class="n">some_object</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">some_parent</span></pre></div></div><p><span class="yiyi-st" id="yiyi-289">&#x5728;&#x4E0A;&#x9762;&#xFF0C;&#x6211;&#x4EEC;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x6302;&#x8D77;&#x7684;&#x5BF9;&#x8C61;<code class="docutils literal"><span class="pre">some_object</span></code>&#xFF0C;&#x5C06;&#x5B83;&#x7684;&#x5916;&#x952E;&#x64CD;&#x4F5C;&#x4E3A;<code class="docutils literal"><span class="pre">Parent</span></code>&#x6765;&#x5F15;&#x7528;&#x5B83;&#xFF0C;<em>&#x7136;&#x540E;</em>&#x6211;&#x4EEC;&#x5B9E;&#x9645;&#x5EFA;&#x7ACB;&#x4E86;&#x5173;&#x7CFB;&#x3002;</span><span class="yiyi-st" id="yiyi-290">&#x5728;&#x9519;&#x8BEF;&#x4FEE;&#x590D;&#x4E4B;&#x524D;&#xFF0C;backref&#x4E0D;&#x4F1A;&#x88AB;&#x89E6;&#x53D1;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># before the fix</span>
<span class="k">assert</span> <span class="n">some_object</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">some_parent</span><span class="o">.</span><span class="n">items</span></pre></div></div><p><span class="yiyi-st" id="yiyi-291">&#x73B0;&#x5728;&#x7684;&#x4FEE;&#x6B63;&#x662F;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x8BD5;&#x56FE;&#x627E;&#x5230;<code class="docutils literal"><span class="pre">some_object.parent</span></code>&#x7684;&#x524D;&#x4E00;&#x4E2A;&#x503C;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x5FFD;&#x7565;&#x624B;&#x52A8;&#x8BBE;&#x7F6E;&#x7684;&#x7236;ID&#xFF0C;&#x7136;&#x540E;&#x67E5;&#x627E;&#x6570;&#x636E;&#x5E93;&#x63D0;&#x4EA4;&#x7684;&#x503C;&#x3002;</span><span class="yiyi-st" id="yiyi-292">&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5B83;&#x662F;None&#xFF0C;&#x56E0;&#x4E3A;&#x5BF9;&#x8C61;&#x5904;&#x4E8E;&#x6302;&#x8D77;&#x72B6;&#x6001;&#xFF0C;&#x6240;&#x4EE5;&#x4E8B;&#x4EF6;&#x7CFB;&#x7EDF;&#x5C06;<code class="docutils literal"><span class="pre">some_object.parent</span></code>&#x8BB0;&#x5F55;&#x4E3A;&#x51C0;&#x66F4;&#x6539;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># after the fix, backref fired off for some_object.parent = some_parent</span>
<span class="k">assert</span> <span class="n">some_object</span> <span class="ow">in</span> <span class="n">some_parent</span><span class="o">.</span><span class="n">items</span></pre></div></div><p><span class="yiyi-st" id="yiyi-293">&#x867D;&#x7136;&#x4E0D;&#x9F13;&#x52B1;&#x64CD;&#x7EB5;&#x7531;&#x5173;&#x7CFB;&#x7BA1;&#x7406;&#x7684;&#x5916;&#x952E;&#x5C5E;&#x6027;&#xFF0C;&#x4F46;&#x5BF9;&#x6B64;&#x7528;&#x4F8B;&#x7684;&#x652F;&#x6301;&#x6709;&#x9650;&#x3002;</span><span class="yiyi-st" id="yiyi-294">&#x4E3A;&#x4E86;&#x5141;&#x8BB8;&#x52A0;&#x8F7D;&#x8FDB;&#x884C;&#x800C;&#x64CD;&#x7EB5;&#x5916;&#x952E;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x901A;&#x5E38;&#x4F1A;&#x5229;&#x7528;<a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session.enable_relationship_loading" title="sqlalchemy.orm.session.Session.enable_relationship_loading"><code class="xref py py-meth docutils literal"><span class="pre">Session.enable_relationship_loading()</span></code></a>&#x548C;<code class="xref py py-attr docutils literal"><span class="pre">RelationshipProperty.load_on_pending</span></code>&#x7279;&#x6027;&#xFF0C;&#x8FD9;&#x4E9B;&#x7279;&#x6027;&#x4F1A;&#x5BFC;&#x81F4;&#x5173;&#x7CFB;&#x53D1;&#x51FA;&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x57FA;&#x4E8E;&#x5185;&#x5B58;&#x4E2D;&#x4E0D;&#x5B58;&#x5728;&#x7684;&#x5916;&#x952E;&#x503C;&#x3002;</span><span class="yiyi-st" id="yiyi-295">&#x65E0;&#x8BBA;&#x8FD9;&#x4E9B;&#x529F;&#x80FD;&#x662F;&#x5426;&#x5728;&#x4F7F;&#x7528;&#x4E2D;&#xFF0C;&#x8FD9;&#x79CD;&#x884C;&#x4E3A;&#x6539;&#x5584;&#x73B0;&#x5728;&#x90FD;&#x5C06;&#x663E;&#x800C;&#x6613;&#x89C1;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-296"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3708">&#xFF03;3708  T0&gt;</a></span></p></div><div class="section" id="improvements-to-the-query-correlate-method-with-polymoprhic-entities"><h3><span class="yiyi-st" id="yiyi-297">&#x4F7F;&#x7528;&#x591A;&#x6A21;&#x5B9E;&#x4F53;&#x5BF9;Query.correlate&#x65B9;&#x6CD5;&#x7684;&#x6539;&#x8FDB;<a class="headerlink" href="#improvements-to-the-query-correlate-method-with-polymoprhic-entities" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-298">&#x5728;&#x6700;&#x8FD1;&#x7684;SQLAlchemy&#x7248;&#x672C;&#x4E2D;&#xFF0C;&#x7531;&#x591A;&#x79CD;&#x5F62;&#x5F0F;&#x7684;&#x201C;&#x591A;&#x6001;&#x201D;&#x67E5;&#x8BE2;&#x751F;&#x6210;&#x7684;SQL&#x5177;&#x6709;&#x6BD4;&#x4EE5;&#x524D;&#x66F4;&#x52A0;&#x201C;&#x5E73;&#x5766;&#x201D;&#x7684;&#x5F62;&#x5F0F;&#xFF0C;&#x5176;&#x4E2D;&#x51E0;&#x4E2A;&#x8868;&#x7684;JOIN&#x4E0D;&#x518D;&#x65E0;&#x6761;&#x4EF6;&#x5730;&#x6346;&#x7ED1;&#x5230;&#x5B50;&#x67E5;&#x8BE2;&#x4E2D;&#x3002;</span><span class="yiyi-st" id="yiyi-299">&#x4E3A;&#x4E86;&#x9002;&#x5E94;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x73B0;&#x5728;&#xFF0C;<a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query.correlate" title="sqlalchemy.orm.query.Query.correlate"><code class="xref py py-meth docutils literal"><span class="pre">Query.correlate()</span></code></a>&#x65B9;&#x6CD5;&#x4ECE;&#x8FD9;&#x79CD;&#x591A;&#x6001;&#x9009;&#x62E9;&#x4E2D;&#x63D0;&#x53D6;&#x5355;&#x4E2A;&#x8868;&#x5E76;&#x786E;&#x4FDD;&#x6240;&#x6709;&#x90FD;&#x662F;&#x5B50;&#x67E5;&#x8BE2;&#x7684;&#x201C;&#x5173;&#x8054;&#x201D;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x3002;</span><span class="yiyi-st" id="yiyi-300">&#x5047;&#x8BBE;&#x6620;&#x5C04;&#x6587;&#x6863;&#x4E2D;&#x7684;<code class="docutils literal"><span class="pre">Person/Manager/Engineer-&gt;Company</span></code>&#x8BBE;&#x7F6E;&#xFF0C;&#x4F7F;&#x7528;with_polymorphic&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>sess.query(Person.name)
            .filter(
                sess.query(Company.name).
                filter(Company.company_id == Person.company_id).
                correlate(Person).as_scalar() == &quot;Elbonia, Inc.&quot;)</pre></div></div><p><span class="yiyi-st" id="yiyi-301">&#x4E0A;&#x9762;&#x7684;&#x67E5;&#x8BE2;&#x73B0;&#x5728;&#x751F;&#x6210;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT people.name AS people_name
FROM people
LEFT OUTER JOIN engineers ON people.person_id = engineers.person_id
LEFT OUTER JOIN managers ON people.person_id = managers.person_id
WHERE (SELECT companies.name
FROM companies
WHERE companies.company_id = people.company_id) = ?</pre></div></div><p><span class="yiyi-st" id="yiyi-302">Before the fix, the call to <code class="docutils literal"><span class="pre">correlate(Person)</span></code> would inadvertently attempt to correlate to the join of <code class="docutils literal"><span class="pre">Person</span></code>, <code class="docutils literal"><span class="pre">Engineer</span></code> and <code class="docutils literal"><span class="pre">Manager</span></code> as a single unit, so <code class="docutils literal"><span class="pre">Person</span></code> wouldn&#x2019;t be correlated:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>-- old, incorrect query
SELECT people.name AS people_name
FROM people
LEFT OUTER JOIN engineers ON people.person_id = engineers.person_id
LEFT OUTER JOIN managers ON people.person_id = managers.person_id
WHERE (SELECT companies.name
FROM companies, people
WHERE companies.company_id = people.company_id) = ?</pre></div></div><p><span class="yiyi-st" id="yiyi-303">&#x5BF9;&#x591A;&#x6001;&#x6620;&#x5C04;&#x4F7F;&#x7528;&#x76F8;&#x5173;&#x7684;&#x5B50;&#x67E5;&#x8BE2;&#x4ECD;&#x7136;&#x6709;&#x4E00;&#x4E9B;&#x672A;&#x5B8C;&#x5584;&#x7684;&#x8FB9;&#x7F18;&#x3002;</span><span class="yiyi-st" id="yiyi-304">&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;<code class="docutils literal"><span class="pre">Person</span></code>&#x4E0E;&#x6240;&#x8C13;&#x7684;&#x201C;&#x5177;&#x4F53;&#x591A;&#x6001;&#x8054;&#x5408;&#x201D;&#x67E5;&#x8BE2;&#x591A;&#x6001;&#x94FE;&#x63A5;&#xFF0C;&#x5219;&#x4E0A;&#x8FF0;&#x5B50;&#x67E5;&#x8BE2;&#x53EF;&#x80FD;&#x65E0;&#x6CD5;&#x6B63;&#x786E;&#x5F15;&#x7528;&#x6B64;&#x5B50;&#x67E5;&#x8BE2;&#x3002;</span><span class="yiyi-st" id="yiyi-305">&#x5728;&#x6240;&#x6709;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5B8C;&#x5168;&#x5F15;&#x7528;&#x201C;&#x591A;&#x6001;&#x201D;&#x5B9E;&#x4F53;&#x7684;&#x65B9;&#x6CD5;&#x662F;&#x9996;&#x5148;&#x4ECE;&#x5B83;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;<a class="reference internal" href="orm_query.html#sqlalchemy.orm.aliased" title="sqlalchemy.orm.aliased"><code class="xref py py-func docutils literal"><span class="pre">aliased()</span></code></a>&#x5BF9;&#x8C61;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span># works with all SQLAlchemy versions and all types of polymorphic
# aliasing.

paliased = aliased(Person)
sess.query(paliased.name)
            .filter(
                sess.query(Company.name).
                filter(Company.company_id == paliased.company_id).
                correlate(paliased).as_scalar() == &quot;Elbonia, Inc.&quot;)</pre></div></div><p><span class="yiyi-st" id="yiyi-306"><a class="reference internal" href="orm_query.html#sqlalchemy.orm.aliased" title="sqlalchemy.orm.aliased"><code class="xref py py-func docutils literal"><span class="pre">aliased()</span></code></a>&#x6784;&#x9020;&#x4FDD;&#x8BC1;&#x201C;&#x591A;&#x6001;&#x53EF;&#x9009;&#x201D;&#x5305;&#x88C5;&#x5728;&#x5B50;&#x67E5;&#x8BE2;&#x4E2D;&#x3002;</span><span class="yiyi-st" id="yiyi-307">&#x901A;&#x8FC7;&#x5728;&#x76F8;&#x5173;&#x7684;&#x5B50;&#x67E5;&#x8BE2;&#x4E2D;&#x660E;&#x786E;&#x5730;&#x5F15;&#x7528;&#x5B83;&#xFF0C;&#x6B63;&#x786E;&#x5730;&#x4F7F;&#x7528;&#x591A;&#x6001;&#x5F62;&#x5F0F;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-308"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3662">&#xFF03;3662  T0&gt;</a></span></p></div><div class="section" id="stringify-of-query-will-consult-the-session-for-the-correct-dialect"><h3><span class="yiyi-st" id="yiyi-309">&#x67E5;&#x8BE2;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x5316;&#x5C06;&#x5411;&#x4F1A;&#x8BDD;&#x67E5;&#x8BE2;&#x6B63;&#x786E;&#x7684;&#x65B9;&#x8A00;<a class="headerlink" href="#stringify-of-query-will-consult-the-session-for-the-correct-dialect" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-310">&#x5728;<a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query" title="sqlalchemy.orm.query.Query"><code class="xref py py-class docutils literal"><span class="pre">Query</span></code></a>&#x5BF9;&#x8C61;&#x4E0A;&#x8C03;&#x7528;<code class="docutils literal"><span class="pre">str()</span></code>&#x4F1A;&#x67E5;&#x8BE2;<a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x4E2D;&#x662F;&#x5426;&#x4F7F;&#x7528;&#x6B63;&#x786E;&#x7684;&#x201C;&#x7ED1;&#x5B9A;&#x201D;&#xFF0C;&#x4EE5;&#x4FBF;&#x5448;&#x73B0;SQL&#x88AB;&#x4F20;&#x9012;&#x7ED9;&#x6570;&#x636E;&#x5E93;&#x3002;</span><span class="yiyi-st" id="yiyi-311">&#x7279;&#x522B;&#x662F;&#xFF0C;&#x5047;&#x8BBE;<a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query" title="sqlalchemy.orm.query.Query"><code class="xref py py-class docutils literal"><span class="pre">Query</span></code></a>&#x4E0E;&#x9002;&#x5F53;&#x7684;<a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x76F8;&#x5173;&#x8054;&#xFF0C;&#x8FD9;&#x5141;&#x8BB8;&#x5F15;&#x7528;&#x7279;&#x5B9A;&#x4E8E;&#x65B9;&#x8A00;&#x7684;SQL&#x7ED3;&#x6784;&#x7684;<a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query" title="sqlalchemy.orm.query.Query"><code class="xref py py-class docutils literal"><span class="pre">Query</span></code></a>&#x662F;&#x53EF;&#x5448;&#x73B0;&#x7684;&#x3002;</span><span class="yiyi-st" id="yiyi-312">&#x4EE5;&#x524D;&#xFF0C;&#x5982;&#x679C;&#x4E0E;&#x6620;&#x5C04;&#x5173;&#x8054;&#x7684;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.MetaData" title="sqlalchemy.schema.MetaData"><code class="xref py py-class docutils literal"><span class="pre">MetaData</span></code></a>&#x672C;&#x8EAB;&#x7ED1;&#x5B9A;&#x5230;&#x76EE;&#x6807;<a class="reference internal" href="core_connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal"><span class="pre">Engine</span></code></a>&#xFF0C;&#x6B64;&#x884C;&#x4E3A;&#x624D;&#x4F1A;&#x751F;&#x6548;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-313">&#x5982;&#x679C;&#x5E95;&#x5C42;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.MetaData" title="sqlalchemy.schema.MetaData"><code class="xref py py-class docutils literal"><span class="pre">MetaData</span></code></a>&#x548C;<a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x90FD;&#x4E0D;&#x4E0E;&#x4EFB;&#x4F55;&#x7ED1;&#x5B9A;&#x7684;<a class="reference internal" href="core_connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal"><span class="pre">Engine</span></code></a>&#x76F8;&#x5173;&#x8054;&#xFF0C;&#x5219;&#x4F7F;&#x7528;&#x201C;&#x9ED8;&#x8BA4;&#x201D;&#x65B9;&#x8A00;&#x7684;&#x56DE;&#x9000;&#x6765;&#x751F;&#x6210;SQL&#x5B57;&#x7B26;&#x4E32;&#x3002;</span></p><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-314">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-315"><a class="reference internal" href="#change-3631"><span>&#x201C;Friendly&#x201D; stringification of Core SQL constructs without a dialect</span></a></span></p></div><p><span class="yiyi-st" id="yiyi-316"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3081">&#xFF03;3081  T0&gt;</a></span></p></div><div class="section" id="joined-eager-loading-where-the-same-entity-is-present-multiple-times-in-one-row"><h3><span class="yiyi-st" id="yiyi-317">&#x52A0;&#x5165;&#x4E86;&#x540C;&#x4E00;&#x4E2A;&#x5B9E;&#x4F53;&#x5728;&#x4E00;&#x884C;&#x4E2D;&#x51FA;&#x73B0;&#x591A;&#x6B21;&#x7684;&#x6025;&#x5207;&#x52A0;&#x8F7D;<a class="headerlink" href="#joined-eager-loading-where-the-same-entity-is-present-multiple-times-in-one-row" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-318">&#x5DF2;&#x7ECF;&#x505A;&#x4E86;&#x4E00;&#x4E2A;&#x4FEE;&#x590D;&#xFF0C;&#x5373;&#x901A;&#x8FC7;&#x52A0;&#x5165;&#x7684;&#x52A0;&#x8F7D;&#x52A0;&#x8F7D;&#x6765;&#x52A0;&#x8F7D;&#x5C5E;&#x6027;&#xFF0C;&#x5373;&#x4F7F;&#x5B9E;&#x4F53;&#x5DF2;&#x7ECF;&#x4ECE;&#x4E0D;&#x5305;&#x542B;&#x8BE5;&#x5C5E;&#x6027;&#x7684;&#x201C;&#x8DEF;&#x5F84;&#x201D;&#x4E0A;&#x7684;&#x884C;&#x52A0;&#x8F7D;&#x3002;</span><span class="yiyi-st" id="yiyi-319">&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5F88;&#x96BE;&#x91CD;&#x73B0;&#x7684;&#x6DF1;&#x5C42;&#x7528;&#x4F8B;&#xFF0C;&#x4F46;&#x603B;&#x4F53;&#x601D;&#x8DEF;&#x5982;&#x4E0B;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;a&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">b_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;b.id&apos;</span><span class="p">))</span>
    <span class="n">c_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;c.id&apos;</span><span class="p">))</span>

    <span class="n">b</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;C&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;b&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">c_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;c.id&apos;</span><span class="p">))</span>

    <span class="n">c</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;C&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;c&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">d_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;d.id&apos;</span><span class="p">))</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;D&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">D</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;d&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>


<span class="n">c_alias_1</span> <span class="o">=</span> <span class="n">aliased</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
<span class="n">c_alias_2</span> <span class="o">=</span> <span class="n">aliased</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>

<span class="n">q</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">c_alias_1</span><span class="p">,</span> <span class="n">B</span><span class="o">.</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">c_alias_1</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">contains_eager</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">contains_eager</span><span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="n">alias</span><span class="o">=</span><span class="n">c_alias_1</span><span class="p">)</span><span class="o">.</span><span class="n">contains_eager</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">d</span><span class="p">))</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">c_alias_2</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">c</span><span class="p">)</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">contains_eager</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="n">alias</span><span class="o">=</span><span class="n">c_alias_2</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-320">&#x4E0A;&#x9762;&#x7684;&#x67E5;&#x8BE2;&#x53D1;&#x51FA;SQL&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT
    d.id AS d_id,
    c_1.id AS c_1_id, c_1.d_id AS c_1_d_id,
    b.id AS b_id, b.c_id AS b_c_id,
    c_2.id AS c_2_id, c_2.d_id AS c_2_d_id,
    a.id AS a_id, a.b_id AS a_b_id, a.c_id AS a_c_id
FROM
    a
    JOIN b ON b.id = a.b_id
    JOIN c AS c_1 ON c_1.id = b.c_id
    JOIN d ON d.id = c_1.d_id
    JOIN c AS c_2 ON c_2.id = a.c_id</pre></div></div><p><span class="yiyi-st" id="yiyi-321">&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;<code class="docutils literal"><span class="pre">c</span></code>&#x8868;&#x662F;&#x4ECE;&#x4E24;&#x6B21;&#x4E2D;&#x9009;&#x62E9;&#x7684;&#xFF1B;&#x4E00;&#x6B21;&#x5728;<code class="docutils literal"><span class="pre">Abc</span> <span class="pre"> - &#xFF06;gt&#xFF1B;</span> <span class="pre">c_alias_1</span></code>&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#xFF0C;&#x53E6;&#x4E00;&#x4E2A;&#x5728;<code class="docutils literal"><span class="pre">Ac</span> <span class="pre"> - &#xFF06;gt&#xFF1B;</span> <span class="pre">c_alias_2</span></code>&#x3002;</span><span class="yiyi-st" id="yiyi-322">Also, we can see that it is quite possible that the <code class="docutils literal"><span class="pre">C</span></code> identity for a single row is the <strong>same</strong> for both <code class="docutils literal"><span class="pre">c_alias_1</span></code> and <code class="docutils literal"><span class="pre">c_alias_2</span></code>, meaning two sets of columns in one row result in only one new object being added to the identity map.</span></p><p><span class="yiyi-st" id="yiyi-323">&#x4E0A;&#x9762;&#x7684;&#x67E5;&#x8BE2;&#x9009;&#x9879;&#x53EA;&#x9700;&#x8981;&#x5728;<code class="docutils literal"><span class="pre">c_alias_1</span></code>&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x52A0;&#x8F7D;&#x5C5E;&#x6027;<code class="docutils literal"><span class="pre">C.d</span></code>&#xFF0C;&#x800C;&#x4E0D;&#x662F;<code class="docutils literal"><span class="pre">c_alias_2</span></code>&#x3002;</span><span class="yiyi-st" id="yiyi-324">&#x56E0;&#x6B64;&#xFF0C;&#x65E0;&#x8BBA;&#x6211;&#x4EEC;&#x5728;&#x6807;&#x8BC6;&#x6620;&#x5C04;&#x4E2D;&#x83B7;&#x5F97;&#x7684;&#x6700;&#x7EC8;<code class="docutils literal"><span class="pre">C</span></code>&#x5BF9;&#x8C61;&#x662F;&#x5426;&#x5177;&#x6709;&#x52A0;&#x8F7D;&#x7684;<code class="docutils literal"><span class="pre">C.d</span></code>&#x5C5E;&#x6027;&#xFF0C;&#x90FD;&#x53D6;&#x51B3;&#x4E8E;&#x904D;&#x5386;&#x6620;&#x5C04;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5B8C;&#x5168;&#x968F;&#x673A;&#x7684;&#xFF0C;&#x5B9E;&#x8D28;&#x4E0A;&#x4E0D;&#x662F;-deterministic&#x3002;</span><span class="yiyi-st" id="yiyi-325">The fix is that even if the loader for <code class="docutils literal"><span class="pre">c_alias_1</span></code> is processed after that of <code class="docutils literal"><span class="pre">c_alias_2</span></code> for a single row where they both refer to the same identity, the <code class="docutils literal"><span class="pre">C.d</span></code> element will still be loaded. </span><span class="yiyi-st" id="yiyi-326">&#x4EE5;&#x524D;&#xFF0C;&#x52A0;&#x8F7D;&#x5668;&#x5E76;&#x4E0D;&#x8BD5;&#x56FE;&#x4FEE;&#x6539;&#x5DF2;&#x7ECF;&#x901A;&#x8FC7;&#x4E0D;&#x540C;&#x8DEF;&#x5F84;&#x52A0;&#x8F7D;&#x7684;&#x5B9E;&#x4F53;&#x7684;&#x52A0;&#x8F7D;&#x3002;</span><span class="yiyi-st" id="yiyi-327">&#x9996;&#x5148;&#x5230;&#x8FBE;&#x5B9E;&#x4F53;&#x7684;&#x52A0;&#x8F7D;&#x5668;&#x4E00;&#x76F4;&#x662F;&#x975E;&#x786E;&#x5B9A;&#x6027;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x8FD9;&#x79CD;&#x4FEE;&#x590D;&#x53EF;&#x80FD;&#x5728;&#x67D0;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#x53EF;&#x4EE5;&#x68C0;&#x6D4B;&#x5230;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5176;&#x4ED6;&#x60C5;&#x51B5;&#x4E0B;&#x7684;&#x884C;&#x4E3A;&#x6539;&#x53D8;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-328">&#x8BE5;&#x4FEE;&#x590D;&#x5305;&#x62EC;&#x9488;&#x5BF9;&#x201C;&#x591A;&#x4E2A;&#x8DEF;&#x5F84;&#x5230;&#x4E00;&#x4E2A;&#x5B9E;&#x4F53;&#x201D;&#x6848;&#x4F8B;&#x7684;&#x4E24;&#x79CD;&#x53D8;&#x4F53;&#x7684;&#x6D4B;&#x8BD5;&#xFF0C;&#x4FEE;&#x590D;&#x5E94;&#x8BE5;&#x6DB5;&#x76D6;&#x6B64;&#x7C7B;&#x6027;&#x8D28;&#x7684;&#x6240;&#x6709;&#x5176;&#x4ED6;&#x573A;&#x666F;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-329"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3431">&#xFF03;3431  T0&gt;</a></span></p></div><div class="section" id="columns-no-longer-added-redundantly-with-distinct-order-by"><h3><span class="yiyi-st" id="yiyi-330">DISTINCT + ORDER BY <a class="headerlink" href="#columns-no-longer-added-redundantly-with-distinct-order-by" title="Permalink to this headline">&#xB6;</a>&#x4E0D;&#x518D;&#x91CD;&#x590D;&#x6DFB;&#x52A0;&#x5217;</span></h3><p><span class="yiyi-st" id="yiyi-331">&#x50CF;&#x4E0B;&#x9762;&#x8FD9;&#x6837;&#x7684;&#x67E5;&#x8BE2;&#x73B0;&#x5728;&#x53EA;&#x4F1A;&#x589E;&#x52A0;SELECT&#x5217;&#x8868;&#x4E2D;&#x7F3A;&#x5C11;&#x7684;&#x90A3;&#x4E9B;&#x5217;&#xFF0C;&#x800C;&#x6CA1;&#x6709;&#x91CD;&#x590D;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">q</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">User</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="s1">&apos;name&apos;</span><span class="p">))</span><span class="o">.</span>\
    <span class="n">distinct</span><span class="p">()</span><span class="o">.</span>\
    <span class="n">order_by</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">User</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">User</span><span class="o">.</span><span class="n">fullname</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-332">&#x751F;&#x4EA7;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT DISTINCT user.id AS a_id, user.name AS name,
 user.fullname AS a_fullname
FROM a ORDER BY user.id, user.name, user.fullname</pre></div></div><p><span class="yiyi-st" id="yiyi-333">&#x4EE5;&#x524D;&#xFF0C;&#x5B83;&#x4F1A;&#x4EA7;&#x751F;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT DISTINCT user.id AS a_id, user.name AS name, user.name AS a_name,
  user.fullname AS a_fullname
FROM a ORDER BY user.id, user.name, user.fullname</pre></div></div><p><span class="yiyi-st" id="yiyi-334">&#x5728;&#x4E0A;&#x9762;&#xFF0C;<code class="docutils literal"><span class="pre">user.name</span></code>&#x5217;&#x88AB;&#x4E0D;&#x5FC5;&#x8981;&#x5730;&#x6DFB;&#x52A0;&#x3002;</span><span class="yiyi-st" id="yiyi-335">&#x7ED3;&#x679C;&#x4E0D;&#x4F1A;&#x53D7;&#x5230;&#x5F71;&#x54CD;&#xFF0C;&#x56E0;&#x4E3A;&#x5728;&#x4EFB;&#x4F55;&#x60C5;&#x51B5;&#x4E0B;&#x9644;&#x52A0;&#x5217;&#x90FD;&#x4E0D;&#x5305;&#x542B;&#x5728;&#x7ED3;&#x679C;&#x4E2D;&#xFF0C;&#x4F46;&#x5217;&#x662F;&#x4E0D;&#x5FC5;&#x8981;&#x7684;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-336">&#x6B64;&#x5916;&#xFF0C;&#x5F53;&#x4F20;&#x9012;&#x8868;&#x8FBE;&#x5F0F;&#x5230;<a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query.distinct" title="sqlalchemy.orm.query.Query.distinct"><code class="xref py py-meth docutils literal"><span class="pre">Query.distinct()</span></code></a>&#x4F7F;&#x7528;Postgresql DISTINCT ON&#x683C;&#x5F0F;&#x65F6;&#xFF0C;&#x4E0A;&#x9762;&#x7684;&#x201C;&#x5217;&#x6DFB;&#x52A0;&#x201D;&#x903B;&#x8F91;&#x5B8C;&#x5168;&#x7981;&#x7528;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-337">&#x5F53;&#x67E5;&#x8BE2;&#x7ED1;&#x5B9A;&#x5230;&#x4E00;&#x4E2A;&#x5B50;&#x67E5;&#x8BE2;&#x4E2D;&#x7528;&#x4E8E;&#x52A0;&#x5165;&#x7684;&#x52A0;&#x8F7D;&#x65F6;&#xFF0C;&#x201C;&#x589E;&#x52A0;&#x5217;&#x8868;&#x201D;&#x89C4;&#x5219;&#x5FC5;&#x7136;&#x66F4;&#x5177;&#x4FB5;&#x7565;&#x6027;&#xFF0C;&#x56E0;&#x6B64;ORDER BY&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x88AB;&#x6EE1;&#x8DB3;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4FDD;&#x6301;&#x4E0D;&#x53D8;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-338"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3641">&#xFF03;3641  T0&gt;</a></span></p></div><div class="section" id="new-mutablelist-and-mutableset-helpers-added-to-the-mutation-tracking-extension"><h3><span class="yiyi-st" id="yiyi-339">&#x5C06;&#x65B0;&#x7684;MutableList&#x548C;MutableSet&#x52A9;&#x624B;&#x6DFB;&#x52A0;&#x5230;&#x7A81;&#x53D8;&#x8DDF;&#x8E2A;&#x6269;&#x5C55;<a class="headerlink" href="#new-mutablelist-and-mutableset-helpers-added-to-the-mutation-tracking-extension" title="Permalink to this headline">&#xB6;</a>&#x4E2D;</span></h3><p><span class="yiyi-st" id="yiyi-340">&#x65B0;&#x7684;&#x5E2E;&#x52A9;&#x7C7B;<a class="reference internal" href="orm_extensions_mutable.html#sqlalchemy.ext.mutable.MutableList" title="sqlalchemy.ext.mutable.MutableList"><code class="xref py py-class docutils literal"><span class="pre">MutableList</span></code></a>&#x548C;<a class="reference internal" href="orm_extensions_mutable.html#sqlalchemy.ext.mutable.MutableSet" title="sqlalchemy.ext.mutable.MutableSet"><code class="xref py py-class docutils literal"><span class="pre">MutableSet</span></code></a>&#x5DF2;&#x88AB;&#x6DFB;&#x52A0;&#x5230;<a class="reference internal" href="orm_extensions_mutable.html"><span>Mutation Tracking</span></a>&#x6269;&#x5C55;&#x4E2D;&#xFF0C;&#x4EE5;&#x8865;&#x5145;&#x73B0;&#x6709;&#x7684;<a class="reference internal" href="orm_extensions_mutable.html#sqlalchemy.ext.mutable.MutableDict" title="sqlalchemy.ext.mutable.MutableDict"><code class="xref py py-class docutils literal"><span class="pre">MutableDict</span></code></a>&#x52A9;&#x624B;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-341"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3297">&#xFF03;3297  T0&gt;</a></span></p></div><div class="section" id="new-raise-loader-strategy"><h3><span class="yiyi-st" id="yiyi-342">&#x65B0;&#x7684;&#x201C;raise&#x201D;&#x52A0;&#x8F7D;&#x5668;&#x7B56;&#x7565;<a class="headerlink" href="#new-raise-loader-strategy" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-343">&#x4E3A;&#x4E86;&#x5E2E;&#x52A9;&#x9632;&#x6B62;&#x5728;&#x52A0;&#x8F7D;&#x4E00;&#x7CFB;&#x5217;&#x5BF9;&#x8C61;&#x4E4B;&#x540E;&#x53D1;&#x751F;&#x4E0D;&#x9700;&#x8981;&#x7684;&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#xFF0C;&#x53EF;&#x4EE5;&#x5E94;&#x7528;&#x65B0;&#x7684;&#x201C;lazy =&apos;raise&apos;&#x201D;&#x7B56;&#x7565;&#x548C;&#x76F8;&#x5E94;&#x7684;&#x52A0;&#x8F7D;&#x7A0B;&#x5E8F;&#x9009;&#x9879;<a class="reference internal" href="orm_loading_relationships.html#sqlalchemy.orm.raiseload" title="sqlalchemy.orm.raiseload"><code class="xref py py-func docutils literal"><span class="pre">orm.raiseload()</span></code></a>&#x5173;&#x7CFB;&#x5C5E;&#x6027;&#xFF0C;&#x5F53;&#x8BBF;&#x95EE;&#x975E;&#x70ED;&#x5207;&#x52A0;&#x8F7D;&#x7684;&#x5C5E;&#x6027;&#x4EE5;&#x8FDB;&#x884C;&#x8BFB;&#x53D6;&#x65F6;&#xFF0C;&#x4F1A;&#x5BFC;&#x81F4;&#x8BE5;&#x5C5E;&#x6027;&#x5F15;&#x53D1;<code class="docutils literal"><span class="pre">InvalidRequestError</span></code>&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">raiseload</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a1</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">raiseload</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">bs</span><span class="p">))</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a1</span><span class="o">.</span><span class="n">bs</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">sqlalchemy.exc.InvalidRequestError</span>: <span class="n">&apos;A.bs&apos; is not available due to lazy=&apos;raise&apos;</span></pre></div></div><p><span class="yiyi-st" id="yiyi-344"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3512">&#xFF03;3512  T0&gt;</a></span></p></div><div class="section" id="mapper-order-by-is-deprecated"><h3><span class="yiyi-st" id="yiyi-345">Mapper.order_by&#x5DF2;&#x5F03;&#x7528;<a class="headerlink" href="#mapper-order-by-is-deprecated" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-346">&#x6765;&#x81EA;SQLAlchemy&#x6700;&#x521D;&#x7248;&#x672C;&#x7684;&#x8FD9;&#x4E2A;&#x65E7;&#x53C2;&#x6570;&#x662F;ORM&#x539F;&#x59CB;&#x8BBE;&#x8BA1;&#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x5B83;&#x5C06;<a class="reference internal" href="orm_mapping_api.html#sqlalchemy.orm.mapper.Mapper" title="sqlalchemy.orm.mapper.Mapper"><code class="xref py py-class docutils literal"><span class="pre">Mapper</span></code></a>&#x5BF9;&#x8C61;&#x4F5C;&#x4E3A;&#x9762;&#x5411;&#x516C;&#x4F17;&#x7684;&#x67E5;&#x8BE2;&#x7ED3;&#x6784;&#x3002;</span><span class="yiyi-st" id="yiyi-347">&#x8FD9;&#x4E2A;&#x89D2;&#x8272;&#x65E9;&#x5DF2;&#x88AB;<a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query" title="sqlalchemy.orm.query.Query"><code class="xref py py-class docutils literal"><span class="pre">Query</span></code></a>&#x5BF9;&#x8C61;&#x53D6;&#x4EE3;&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;<a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query.order_by" title="sqlalchemy.orm.query.Query.order_by"><code class="xref py py-meth docutils literal"><span class="pre">Query.order_by()</span></code></a>&#x6765;&#x6307;&#x793A;&#x7ED3;&#x679C;&#x7684;&#x6392;&#x5E8F;&#xFF0C;&#x4EE5;&#x4E00;&#x79CD;&#x5BF9;&#x4EFB;&#x610F;&#x7EC4;&#x5408;SELECT&#x8BED;&#x53E5;&#xFF0C;&#x5B9E;&#x4F53;&#x548C;SQL&#x8868;&#x8FBE;&#x5F0F;&#x3002;</span><span class="yiyi-st" id="yiyi-348">There are many areas in which <a class="reference internal" href="orm_mapping_api.html#sqlalchemy.orm.mapper.Mapper.params.order_by" title="sqlalchemy.orm.mapper.Mapper"><code class="xref py py-paramref docutils literal"><span class="pre">Mapper.order_by</span></code></a> doesn&#x2019;t work as expected (or what would be expected is not clear), such as when queries are combined into unions; these cases are not supported.</span></p><p><span class="yiyi-st" id="yiyi-349"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3394">&#xFF03;3394  T0&gt;</a></span></p></div></div><div class="section" id="new-features-and-improvements-core"><h2><span class="yiyi-st" id="yiyi-350">&#x65B0;&#x529F;&#x80FD;&#x548C;&#x6539;&#x8FDB; - &#x6838;&#x5FC3;<a class="headerlink" href="#new-features-and-improvements-core" title="Permalink to this headline">&#xB6;</a></span></h2><div class="section" id="cte-support-for-insert-update-delete"><h3><span class="yiyi-st" id="yiyi-351">CTE&#x652F;&#x6301;INSERT&#xFF0C;UPDATE&#xFF0C;DELETE <a class="headerlink" href="#cte-support-for-insert-update-delete" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-352">&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x6700;&#x5E7F;&#x6CDB;&#x8981;&#x6C42;&#x7684;&#x529F;&#x80FD;&#x662F;&#x652F;&#x6301;&#x4E0E;INSERT&#xFF0C;UPDATE&#xFF0C;DELETE&#x4E00;&#x8D77;&#x4F7F;&#x7528;&#x7684;&#x516C;&#x7528;&#x8868;&#x8868;&#x8FBE;&#x5F0F;&#xFF08;CTE&#xFF09;&#xFF0C;&#x73B0;&#x5728;&#x5DF2;&#x7ECF;&#x5B9E;&#x73B0;&#x3002;</span><span class="yiyi-st" id="yiyi-353">INSERT / UPDATE / DELETE&#x65E2;&#x53EF;&#x4EE5;&#x4ECE;SQL&#x9876;&#x90E8;&#x7684;WITH&#x5B50;&#x53E5;&#x4E2D;&#x7ED8;&#x5236;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x5728;&#x66F4;&#x5927;&#x7684;&#x8BED;&#x53E5;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x7528;&#x4F5C;CTE&#x672C;&#x8EAB;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-354">&#x4F5C;&#x4E3A;&#x6B64;&#x66F4;&#x6539;&#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x5305;&#x542B;CTE&#x7684;SELECT INSERT&#x5C06;&#x73B0;&#x5728;&#x5C06;CTE&#x5448;&#x73B0;&#x5728;&#x6574;&#x4E2A;&#x8BED;&#x53E5;&#x7684;&#x9876;&#x90E8;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x50CF;1.0&#x4E2D;&#x90A3;&#x6837;&#x5D4C;&#x5957;&#x5728;SELECT&#x8BED;&#x53E5;&#x4E2D;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-355">&#x4E0B;&#x9762;&#x662F;&#x4E00;&#x4E2A;&#x5728;&#x4E00;&#x4E2A;&#x8BED;&#x53E5;&#x4E2D;&#x5448;&#x73B0;UPDATE&#xFF0C;INSERT&#x548C;SELECT&#x5168;&#x90E8;&#x7684;&#x4F8B;&#x5B50;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">table</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">select</span><span class="p">,</span> <span class="n">literal</span><span class="p">,</span> <span class="n">exists</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">orders</span> <span class="o">=</span> <span class="n">table</span><span class="p">(</span>
<span class="gp">... </span>    <span class="s1">&apos;orders&apos;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">column</span><span class="p">(</span><span class="s1">&apos;region&apos;</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">column</span><span class="p">(</span><span class="s1">&apos;amount&apos;</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">column</span><span class="p">(</span><span class="s1">&apos;product&apos;</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">column</span><span class="p">(</span><span class="s1">&apos;quantity&apos;</span><span class="p">)</span>
<span class="gp">... </span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">upsert</span> <span class="o">=</span> <span class="p">(</span>
<span class="gp">... </span>    <span class="n">orders</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
<span class="gp">... </span>    <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">orders</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">region</span> <span class="o">==</span> <span class="s1">&apos;Region1&apos;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">amount</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="s1">&apos;Product1&apos;</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">... </span>    <span class="o">.</span><span class="n">returning</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">orders</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">_all_columns</span><span class="p">))</span><span class="o">.</span><span class="n">cte</span><span class="p">(</span><span class="s1">&apos;upsert&apos;</span><span class="p">))</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">insert</span> <span class="o">=</span> <span class="n">orders</span><span class="o">.</span><span class="n">insert</span><span class="p">()</span><span class="o">.</span><span class="n">from_select</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">orders</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
<span class="gp">... </span>    <span class="n">select</span><span class="p">([</span>
<span class="gp">... </span>        <span class="n">literal</span><span class="p">(</span><span class="s1">&apos;Region1&apos;</span><span class="p">),</span> <span class="n">literal</span><span class="p">(</span><span class="mf">1.0</span><span class="p">),</span>
<span class="gp">... </span>        <span class="n">literal</span><span class="p">(</span><span class="s1">&apos;Product1&apos;</span><span class="p">),</span> <span class="n">literal</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">... </span>    <span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">exists</span><span class="p">(</span><span class="n">upsert</span><span class="o">.</span><span class="n">select</span><span class="p">()))</span>
<span class="gp">... </span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">insert</span><span class="p">)</span>  <span class="c1"># note formatting added for clarity</span>
<span class="go">WITH upsert AS</span>
<span class="go">(UPDATE orders SET amount=:amount, product=:product, quantity=:quantity</span>
<span class="go"> WHERE orders.region = :region_1</span>
<span class="go"> RETURNING orders.region, orders.amount, orders.product, orders.quantity</span>
<span class="go">)</span>
<span class="go">INSERT INTO orders (region, amount, product, quantity)</span>
<span class="go">SELECT</span>
<span class="go">    :param_1 AS anon_1, :param_2 AS anon_2,</span>
<span class="go">    :param_3 AS anon_3, :param_4 AS anon_4</span>
<span class="go">WHERE NOT (</span>
<span class="go">    EXISTS (</span>
<span class="go">        SELECT upsert.region, upsert.amount,</span>
<span class="go">               upsert.product, upsert.quantity</span>
<span class="go">        FROM upsert))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-356"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2551">&#xFF03;2551  T0&gt;</a></span></p></div><div class="section" id="support-for-range-and-rows-specification-within-window-functions"><h3><span class="yiyi-st" id="yiyi-357">&#x5728;&#x7A97;&#x53E3;&#x51FD;&#x6570;&#x4E2D;&#x652F;&#x6301;RANGE&#x548C;ROWS&#x89C4;&#x8303;<a class="headerlink" href="#support-for-range-and-rows-specification-within-window-functions" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-358">&#x65B0;&#x7684;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.over.params.range_" title="sqlalchemy.sql.expression.over"><code class="xref py py-paramref docutils literal"><span class="pre">expression.over.range_</span></code></a>&#x548C;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.over.params.rows" title="sqlalchemy.sql.expression.over"><code class="xref py py-paramref docutils literal"><span class="pre">expression.over.rows</span></code></a>&#x53C2;&#x6570;&#x5141;&#x8BB8;&#x7A97;&#x53E3;&#x51FD;&#x6570;&#x7684;RANGE&#x548C;ROWS&#x8868;&#x8FBE;&#x5F0F;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">func</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">func</span><span class="o">.</span><span class="n">row_number</span><span class="p">()</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">order_by</span><span class="o">=</span><span class="s1">&apos;x&apos;</span><span class="p">,</span> <span class="n">range_</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="go">row_number() OVER (ORDER BY x RANGE BETWEEN :param_1 PRECEDING AND :param_2 FOLLOWING)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">func</span><span class="o">.</span><span class="n">row_number</span><span class="p">()</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">order_by</span><span class="o">=</span><span class="s1">&apos;x&apos;</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="go">row_number() OVER (ORDER BY x ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">func</span><span class="o">.</span><span class="n">row_number</span><span class="p">()</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">order_by</span><span class="o">=</span><span class="s1">&apos;x&apos;</span><span class="p">,</span> <span class="n">range_</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
<span class="go">row_number() OVER (ORDER BY x RANGE BETWEEN :param_1 PRECEDING AND UNBOUNDED FOLLOWING)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-359"><a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.over.params.range_" title="sqlalchemy.sql.expression.over"><code class="xref py py-paramref docutils literal"><span class="pre">expression.over.range_</span></code></a>&#x548C;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.over.params.rows" title="sqlalchemy.sql.expression.over"><code class="xref py py-paramref docutils literal"><span class="pre">expression.over.rows</span></code></a>&#x6307;&#x5B9A;&#x4E3A;2&#x5143;&#x7EC4;&#xFF0C;&#x6307;&#x5B9A;&#x7279;&#x5B9A;&#x8303;&#x56F4;&#x7684;&#x8D1F;&#x503C;&#x548C;&#x6B63;&#x503C;&#xFF0C;&#x201C;CURRENT ROW&#x201D;&#x4E3A;0&#xFF0C;&#x65E0;&#x5BF9;&#x4E8E;UNBOUNDED&#x3002;</span></p><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-360">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-361"><a class="reference internal" href="core_tutorial.html#window-functions"><span>Window Functions</span></a></span></p></div><p><span class="yiyi-st" id="yiyi-362"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3049">&#xFF03;3049  T0&gt;</a></span></p></div><div class="section" id="support-for-the-sql-lateral-keyword"><h3><span class="yiyi-st" id="yiyi-363">&#x652F;&#x6301;SQL LATERAL&#x5173;&#x952E;&#x5B57;<a class="headerlink" href="#support-for-the-sql-lateral-keyword" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-364">&#x76EE;&#x524D;&#x5DF2;&#x77E5;LATERAL&#x5173;&#x952E;&#x5B57;&#x4EC5;&#x53D7;Postgresql 9.3&#x53CA;&#x66F4;&#x9AD8;&#x7248;&#x672C;&#x652F;&#x6301;&#xFF0C;&#x4F46;&#x56E0;&#x4E3A;&#x5B83;&#x662F;SQL&#x5173;&#x952E;&#x5B57;&#x6DFB;&#x52A0;&#x5230;Core&#x7684;&#x6807;&#x51C6;&#x652F;&#x6301;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x3002;</span><span class="yiyi-st" id="yiyi-365"><a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.Select.lateral" title="sqlalchemy.sql.expression.Select.lateral"><code class="xref py py-meth docutils literal"><span class="pre">Select.lateral()</span></code></a>&#x7684;&#x5B9E;&#x73B0;&#x91C7;&#x7528;&#x4E86;&#x7279;&#x6B8A;&#x7684;&#x903B;&#x8F91;&#xFF0C;&#x800C;&#x4E0D;&#x4EC5;&#x4EC5;&#x662F;&#x5448;&#x73B0;LATERAL&#x5173;&#x952E;&#x5B57;&#xFF0C;&#x4EE5;&#x5141;&#x8BB8;&#x4ECE;&#x76F8;&#x540C;&#x7684;FROM&#x5B50;&#x53E5;&#x6D3E;&#x751F;&#x7684;&#x8868;&#x4E0E;&#x76F8;&#x5173;&#x7684;&#x53EF;&#x9009;&#x62E9;&#x7684;&#x5173;&#x8054;&#x3002;&#x6A2A;&#x5411;&#x76F8;&#x5173;&#x6027;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">table</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">select</span><span class="p">,</span> <span class="n">true</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">people</span> <span class="o">=</span> <span class="n">table</span><span class="p">(</span><span class="s1">&apos;people&apos;</span><span class="p">,</span> <span class="n">column</span><span class="p">(</span><span class="s1">&apos;people_id&apos;</span><span class="p">),</span> <span class="n">column</span><span class="p">(</span><span class="s1">&apos;age&apos;</span><span class="p">),</span> <span class="n">column</span><span class="p">(</span><span class="s1">&apos;name&apos;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">books</span> <span class="o">=</span> <span class="n">table</span><span class="p">(</span><span class="s1">&apos;books&apos;</span><span class="p">,</span> <span class="n">column</span><span class="p">(</span><span class="s1">&apos;book_id&apos;</span><span class="p">),</span> <span class="n">column</span><span class="p">(</span><span class="s1">&apos;owner_id&apos;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">subq</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">books</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">book_id</span><span class="p">])</span><span class="o">.</span>\
<span class="gp">... </span>     <span class="n">where</span><span class="p">(</span><span class="n">books</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">owner_id</span> <span class="o">==</span> <span class="n">people</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">people_id</span><span class="p">)</span><span class="o">.</span><span class="n">lateral</span><span class="p">(</span><span class="s2">&quot;book_subq&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">select</span><span class="p">([</span><span class="n">people</span><span class="p">])</span><span class="o">.</span><span class="n">select_from</span><span class="p">(</span><span class="n">people</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subq</span><span class="p">,</span> <span class="n">true</span><span class="p">())))</span>
<span class="go">SELECT people.people_id, people.age, people.name</span>
<span class="go">FROM people JOIN LATERAL (SELECT books.book_id AS book_id</span>
<span class="go">FROM books WHERE books.owner_id = people.people_id)</span>
<span class="go">AS book_subq ON true</span></pre></div></div><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-366">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p><span class="yiyi-st" id="yiyi-367"><a class="reference internal" href="core_tutorial.html#lateral-selects"><span>LATERAL correlation</span></a></span></p><p><span class="yiyi-st" id="yiyi-368"><a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.Lateral" title="sqlalchemy.sql.expression.Lateral"><code class="xref py py-class docutils literal"><span class="pre">Lateral</span></code></a></span></p><p class="last"><span class="yiyi-st" id="yiyi-369"><a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.Select.lateral" title="sqlalchemy.sql.expression.Select.lateral"><code class="xref py py-meth docutils literal"><span class="pre">Select.lateral()</span></code></a></span></p></div><p><span class="yiyi-st" id="yiyi-370"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2857">&#xFF03;2857  T0&gt;</a></span></p></div><div class="section" id="support-for-tablesample"><h3><span class="yiyi-st" id="yiyi-371">&#x652F;&#x6301;TABLESAMPLE <a class="headerlink" href="#support-for-tablesample" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-372">&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.FromClause.tablesample" title="sqlalchemy.sql.expression.FromClause.tablesample"><code class="xref py py-meth docutils literal"><span class="pre">FromClause.tablesample()</span></code></a>&#x65B9;&#x6CD5;&#x5448;&#x73B0;SQL&#x6807;&#x51C6;TABLESAMPLE&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#x7C7B;&#x4F3C;&#x4E8E;&#x522B;&#x540D;&#x7684;<a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.TableSample" title="sqlalchemy.sql.expression.TableSample"><code class="xref py py-class docutils literal"><span class="pre">TableSample</span></code></a>&#x7ED3;&#x6784;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">func</span>

<span class="n">selectable</span> <span class="o">=</span> <span class="n">people</span><span class="o">.</span><span class="n">tablesample</span><span class="p">(</span>
            <span class="n">func</span><span class="o">.</span><span class="n">bernoulli</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&apos;alias&apos;</span><span class="p">,</span>
            <span class="n">seed</span><span class="o">=</span><span class="n">func</span><span class="o">.</span><span class="n">random</span><span class="p">())</span>
<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">selectable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">people_id</span><span class="p">])</span></pre></div></div><p><span class="yiyi-st" id="yiyi-373">&#x5047;&#x8BBE;<code class="docutils literal"><span class="pre">people</span></code>&#x5177;&#x6709;&#x5217;<code class="docutils literal"><span class="pre">people_id</span></code>&#xFF0C;&#x5219;&#x4E0A;&#x8FF0;&#x8BED;&#x53E5;&#x5C06;&#x5448;&#x73B0;&#x4E3A;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT alias.people_id FROM
people AS alias TABLESAMPLE bernoulli(:bernoulli_1)
REPEATABLE (random())</pre></div></div><p><span class="yiyi-st" id="yiyi-374"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3718">&#xFF03;3718  T0&gt;</a></span></p></div><div class="section" id="the-autoincrement-directive-is-no-longer-implicitly-enabled-for-a-composite-primary-key-column"><h3><span class="yiyi-st" id="yiyi-375"><code class="docutils literal"><span class="pre">.autoincrement</span></code>&#x6307;&#x4EE4;&#x4E0D;&#x518D;&#x4E3A;&#x7EC4;&#x5408;&#x4E3B;&#x952E;&#x5217;&#x542F;&#x7528;<a class="headerlink" href="#the-autoincrement-directive-is-no-longer-implicitly-enabled-for-a-composite-primary-key-column" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-376">SQLAlchemy&#x4E00;&#x76F4;&#x5177;&#x6709;&#x4E3A;&#x5355;&#x5217;&#x6574;&#x6570;&#x4E3B;&#x952E;&#x542F;&#x7528;&#x540E;&#x7AEF;&#x6570;&#x636E;&#x5E93;&#x7684;&#x201C;&#x81EA;&#x52A8;&#x589E;&#x91CF;&#x201D;&#x529F;&#x80FD;&#x7684;&#x4FBF;&#x5229;&#x529F;&#x80FD;&#xFF1B;&#x901A;&#x8FC7;&#x201C;autoincrement&#x201D;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x610F;&#x601D;&#x662F;&#x6570;&#x636E;&#x5E93;&#x5217;&#x5C06;&#x5305;&#x542B;&#x6570;&#x636E;&#x5E93;&#x63D0;&#x4F9B;&#x7684;&#x4EFB;&#x4F55;DDL&#x6307;&#x4EE4;&#xFF0C;&#x4EE5;&#x6307;&#x793A;&#x81EA;&#x52A8;&#x9012;&#x589E;&#x7684;&#x6574;&#x6570;&#x6807;&#x8BC6;&#x7B26;&#xFF0C;&#x4F8B;&#x5982;MySQL&#x4E0A;&#x7684;Postgresql&#x6216;AUTO_INCREMENT&#x4E0A;&#x7684;SERIAL&#x5173;&#x952E;&#x5B57;&#xFF0C;&#x53E6;&#x5916;&#x65B9;&#x8A00;&#x5C06;&#x63A5;&#x6536;&#x8FD9;&#x4E9B;&#x751F;&#x6210;&#x7684;&#x4F7F;&#x7528;&#x9002;&#x5408;&#x8BE5;&#x540E;&#x7AEF;&#x7684;&#x6280;&#x672F;&#x6267;&#x884C;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Table.insert" title="sqlalchemy.schema.Table.insert"><code class="xref py py-meth docutils literal"><span class="pre">Table.insert()</span></code></a>&#x6784;&#x9020;&#x7684;&#x503C;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-377">&#x6539;&#x53D8;&#x7684;&#x662F;&#xFF0C;&#x8BE5;&#x529F;&#x80FD;&#x4E0D;&#x518D;&#x4E3A;<em>&#x590D;&#x5408;</em>&#x4E3B;&#x952E;&#x81EA;&#x52A8;&#x5F00;&#x542F;&#xFF1B;&#x4EE5;&#x524D;&#xFF0C;&#x4E00;&#x4E2A;&#x8868;&#x683C;&#x5B9A;&#x4E49;&#x5982;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">Table</span><span class="p">(</span>
    <span class="s1">&apos;some_table&apos;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;x&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;y&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-378">&#x5C06;&#x201C;&#x81EA;&#x52A8;&#x589E;&#x91CF;&#x201D;&#x8BED;&#x4E49;&#x5E94;&#x7528;&#x4E8E;<code class="docutils literal"><span class="pre">&apos;x&apos;</span></code>&#x5217;&#xFF0C;&#x4EC5;&#x4EC5;&#x662F;&#x56E0;&#x4E3A;&#x5B83;&#x9996;&#x5148;&#x5728;&#x4E3B;&#x952E;&#x5217;&#x7684;&#x5217;&#x8868;&#x4E2D;&#x3002;</span><span class="yiyi-st" id="yiyi-379">&#x4E3A;&#x4E86;&#x7981;&#x7528;&#x6B64;&#x529F;&#x80FD;&#xFF0C;&#x5FC5;&#x987B;&#x5728;&#x6240;&#x6709;&#x5217;&#x4E0A;&#x5173;&#x95ED;<code class="docutils literal"><span class="pre">autoincrement</span></code>&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># old way</span>
<span class="n">Table</span><span class="p">(</span>
    <span class="s1">&apos;some_table&apos;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;x&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">autoincrement</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;y&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">autoincrement</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-380">&#x4F7F;&#x7528;&#x65B0;&#x884C;&#x4E3A;&#xFF0C;&#x7EC4;&#x5408;&#x4E3B;&#x952E;&#x5C06;&#x4E0D;&#x4F1A;&#x6709;&#x81EA;&#x52A8;&#x589E;&#x91CF;&#x8BED;&#x4E49;&#xFF0C;&#x9664;&#x975E;&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">autoincrement=True</span></code>&#x663E;&#x5F0F;&#x6807;&#x8BB0;&#x5217;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># column &apos;y&apos; will be SERIAL/AUTO_INCREMENT/ auto-generating</span>
<span class="n">Table</span><span class="p">(</span>
    <span class="s1">&apos;some_table&apos;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;x&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;y&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">autoincrement</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-381">In order to anticipate some potential backwards-incompatible scenarios, the <a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Table.insert" title="sqlalchemy.schema.Table.insert"><code class="xref py py-meth docutils literal"><span class="pre">Table.insert()</span></code></a> construct will perform more thorough checks for missing primary key values on composite primary key columns that don&#x2019;t have autoincrement set up; given a table such as:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">Table</span><span class="p">(</span>
    <span class="s1">&apos;b&apos;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;x&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;y&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-382">&#x4E00;&#x4E2A;INSERT&#x53D1;&#x51FA;&#x6CA1;&#x6709;&#x503C;&#x7684;&#x8868;&#x5C06;&#x4EA7;&#x751F;&#x5F02;&#x5E38;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>CompileError: Column &apos;b.x&apos; is marked as a member of the primary
key for table &apos;b&apos;, but has no Python-side or server-side default
generator indicated, nor does it indicate &apos;autoincrement=True&apos;,
and no explicit value is passed.  Primary key columns may not
store NULL. Note that as of SQLAlchemy 1.1, &apos;autoincrement=True&apos;
must be indicated explicitly for composite (e.g. multicolumn)
primary keys if AUTO_INCREMENT/SERIAL/IDENTITY behavior is
expected for one of the columns in the primary key. CREATE TABLE
statements are impacted by this change as well on most backends.</pre></div></div><p><span class="yiyi-st" id="yiyi-383">&#x5BF9;&#x4E8E;&#x4ECE;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x9ED8;&#x8BA4;&#x6216;&#x4E0D;&#x5E38;&#x89C1;&#x7684;&#x4E3B;&#x952E;&#x503C;&#xFF08;&#x5982;&#x89E6;&#x53D1;&#x5668;&#xFF09;&#x63A5;&#x6536;&#x4E3B;&#x952E;&#x503C;&#x7684;&#x5217;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<a class="reference internal" href="core_defaults.html#sqlalchemy.schema.FetchedValue" title="sqlalchemy.schema.FetchedValue"><code class="xref py py-class docutils literal"><span class="pre">FetchedValue</span></code></a>&#x6307;&#x793A;&#x5B58;&#x5728;&#x503C;&#x751F;&#x6210;&#x5668;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">Table</span><span class="p">(</span>
    <span class="s1">&apos;b&apos;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;x&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">server_default</span><span class="o">=</span><span class="n">FetchedValue</span><span class="p">()),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;y&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">server_default</span><span class="o">=</span><span class="n">FetchedValue</span><span class="p">())</span>
<span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-384">&#x5BF9;&#x4E8E;&#x7EC4;&#x5408;&#x4E3B;&#x952E;&#x5B9E;&#x9645;&#x4E0A;&#x65E8;&#x5728;&#x5C06;NULL&#x5B58;&#x50A8;&#x5728;&#x5176;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x5217;&#x4E2D;&#xFF08;&#x4EC5;&#x5728;SQLite&#x548C;MySQL&#x4E2D;&#x53D7;&#x652F;&#x6301;&#xFF09;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x8BF7;&#x6307;&#x5B9A;&#x5177;&#x6709;<code class="docutils literal"><span class="pre">nullable=True</span></code>&#x7684;&#x5217;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">Table</span><span class="p">(</span>
    <span class="s1">&apos;b&apos;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;x&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;y&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-385">&#x5728;&#x76F8;&#x5173;&#x66F4;&#x6539;&#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x5177;&#x6709;&#x5BA2;&#x6237;&#x7AEF;&#x6216;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x9ED8;&#x8BA4;&#x503C;&#x7684;&#x5217;&#x4E0A;&#x5C06;<code class="docutils literal"><span class="pre">autoincrement</span></code>&#x6807;&#x5FD7;&#x8BBE;&#x7F6E;&#x4E3A;True&#x3002;</span><span class="yiyi-st" id="yiyi-386">&#x5728;INSERT&#x671F;&#x95F4;&#xFF0C;&#x8FD9;&#x901A;&#x5E38;&#x4E0D;&#x4F1A;&#x5BF9;&#x5217;&#x7684;&#x884C;&#x4E3A;&#x4EA7;&#x751F;&#x592A;&#x5927;&#x5F71;&#x54CD;&#x3002;</span></p><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-387">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-388"><a class="reference internal" href="#change-mysql-3216"><span>No more generation of an implicit KEY for composite primary key w/ AUTO_INCREMENT</span></a>&#x7684;&#x7EC4;&#x5408;&#x4E3B;&#x952E;&#x751F;&#x6210;&#x9690;&#x5F0F;KEY</span></p></div><p><span class="yiyi-st" id="yiyi-389"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3216">&#xFF03;3216  T0&gt;</a></span></p></div><div class="section" id="support-for-is-distinct-from-and-is-not-distinct-from"><h3><span class="yiyi-st" id="yiyi-390">&#x652F;&#x6301;IS DISTINCT FROM&#x548C;IS NOT DISTINCT FROM <a class="headerlink" href="#support-for-is-distinct-from-and-is-not-distinct-from" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-391">New operators <a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.operators.ColumnOperators.is_distinct_from" title="sqlalchemy.sql.operators.ColumnOperators.is_distinct_from"><code class="xref py py-meth docutils literal"><span class="pre">ColumnOperators.is_distinct_from()</span></code></a> and <a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.operators.ColumnOperators.isnot_distinct_from" title="sqlalchemy.sql.operators.ColumnOperators.isnot_distinct_from"><code class="xref py py-meth docutils literal"><span class="pre">ColumnOperators.isnot_distinct_from()</span></code></a> allow the IS DISTINCT FROM and IS NOT DISTINCT FROM sql operation:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">column</span><span class="p">(</span><span class="s1">&apos;x&apos;</span><span class="p">)</span><span class="o">.</span><span class="n">is_distinct_from</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
<span class="go">x IS DISTINCT FROM NULL</span></pre></div></div><p><span class="yiyi-st" id="yiyi-392">&#x5904;&#x7406;&#x63D0;&#x4F9B;&#x4E86;NULL&#xFF0C;True&#x548C;False&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">column</span><span class="p">(</span><span class="s1">&apos;x&apos;</span><span class="p">)</span><span class="o">.</span><span class="n">isnot_distinct_from</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="go">x IS NOT DISTINCT FROM false</span></pre></div></div><p><span class="yiyi-st" id="yiyi-393">&#x5BF9;&#x4E8E;&#x6CA1;&#x6709;&#x8FD9;&#x4E2A;&#x8FD0;&#x7B97;&#x7B26;&#x7684;SQLite&#xFF0C;&#x4F1A;&#x5448;&#x73B0;&#x201C;IS&#x201D;/&#x201C;IS NOT&#x201D;&#xFF0C;&#x5B83;&#x5728;SQLite&#x4E0A;&#x7684;&#x5DE5;&#x4F5C;&#x65B9;&#x5F0F;&#x4E0E;&#x5176;&#x4ED6;&#x540E;&#x7AEF;&#x4E0D;&#x540C;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy.dialects</span> <span class="kn">import</span> <span class="n">sqlite</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">column</span><span class="p">(</span><span class="s1">&apos;x&apos;</span><span class="p">)</span><span class="o">.</span><span class="n">is_distinct_from</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">dialect</span><span class="o">=</span><span class="n">sqlite</span><span class="o">.</span><span class="n">dialect</span><span class="p">())</span>
<span class="go">x IS NOT NULL</span></pre></div></div></div><div class="section" id="core-and-orm-support-for-full-outer-join"><h3><span class="yiyi-st" id="yiyi-394">&#x6838;&#x5FC3;&#x548C;ORM&#x652F;&#x6301;FULL OUTER JOIN <a class="headerlink" href="#core-and-orm-support-for-full-outer-join" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-395">The new flag <a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.FromClause.outerjoin.params.full" title="sqlalchemy.sql.expression.FromClause.outerjoin"><code class="xref py py-paramref docutils literal"><span class="pre">FromClause.outerjoin.full</span></code></a>, available at the Core and ORM level, instructs the compiler to render <code class="docutils literal"><span class="pre">FULL</span> <span class="pre">OUTER</span> <span class="pre">JOIN</span></code> where it would normally render <code class="docutils literal"><span class="pre">LEFT</span> <span class="pre">OUTER</span> <span class="pre">JOIN</span></code>:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">t1</span><span class="p">])</span><span class="o">.</span><span class="n">select_from</span><span class="p">(</span><span class="n">t1</span><span class="o">.</span><span class="n">outerjoin</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-396">&#x8BE5;&#x6807;&#x5FD7;&#x4E5F;&#x9002;&#x7528;&#x4E8E;ORM&#x7EA7;&#x522B;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">q</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">MyClass</span><span class="p">)</span><span class="o">.</span><span class="n">outerjoin</span><span class="p">(</span><span class="n">MyOtherClass</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-397"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/1957">&#xFF03;1957  T0&gt;</a></span></p></div><div class="section" id="resultset-column-matching-enhancements-positional-column-setup-for-textual-sql"><h3><span class="yiyi-st" id="yiyi-398">ResultSet&#x5217;&#x5339;&#x914D;&#x589E;&#x5F3A;&#xFF1B;&#x6587;&#x672C;SQL&#x7684;&#x4F4D;&#x7F6E;&#x5217;&#x8BBE;&#x7F6E;<a class="headerlink" href="#resultset-column-matching-enhancements-positional-column-setup-for-textual-sql" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-399">&#x4F5C;&#x4E3A;<a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/918">&#xFF03;918</a>&#x7684;&#x4E00;&#x90E8;&#x5206;&#x5BF9;1.0&#x7CFB;&#x5217;&#x4E2D;&#x7684;<a class="reference internal" href="core_connections.html#sqlalchemy.engine.ResultProxy" title="sqlalchemy.engine.ResultProxy"><code class="xref py py-class docutils literal"><span class="pre">ResultProxy</span></code></a>&#x7CFB;&#x7EDF;&#x8FDB;&#x884C;&#x4E86;&#x4E00;&#x7CFB;&#x5217;&#x6539;&#x8FDB;&#xFF0C;&#x5B83;&#x91CD;&#x65B0;&#x7EC4;&#x7EC7;&#x5185;&#x90E8;&#x4EE5;&#x5C06;&#x4E0E;&#x6E38;&#x6807;&#x7ED1;&#x5B9A;&#x7684;&#x7ED3;&#x679C;&#x5217;&#x4E0E;&#x8868;/ ORM&#x5143;&#x6570;&#x636E;&#x5728;&#x4F4D;&#x7F6E;&#x4E0A;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x901A;&#x8FC7;&#x5339;&#x914D;&#x540D;&#x79F0;&#xFF0C;&#x5BF9;&#x4E8E;&#x5305;&#x542B;&#x6709;&#x5173;&#x8981;&#x8FD4;&#x56DE;&#x7684;&#x7ED3;&#x679C;&#x884C;&#x7684;&#x5B8C;&#x6574;&#x4FE1;&#x606F;&#x7684;&#x7F16;&#x8BD1;SQL&#x7ED3;&#x6784;&#x3002;</span><span class="yiyi-st" id="yiyi-400">&#x8FD9;&#x53EF;&#x4EE5;&#x663E;&#x7740;&#x8282;&#x7701;Python&#x5F00;&#x9500;&#xFF0C;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x5C06;ORM&#x548C;Core SQL&#x8868;&#x8FBE;&#x5F0F;&#x94FE;&#x63A5;&#x5230;&#x7ED3;&#x679C;&#x884C;&#x7684;&#x51C6;&#x786E;&#x6027;&#x66F4;&#x9AD8;&#x3002;</span><span class="yiyi-st" id="yiyi-401">&#x5728;1.1&#x4E2D;&#xFF0C;&#x8FD9;&#x79CD;&#x91CD;&#x7EC4;&#x5DF2;&#x7ECF;&#x5728;&#x5185;&#x90E8;&#x5F97;&#x5230;&#x4E86;&#x8FDB;&#x4E00;&#x6B65;&#x7814;&#x7A76;&#xFF0C;&#x5E76;&#x4E14;&#x901A;&#x8FC7;&#x4F7F;&#x7528;&#x6700;&#x8FD1;&#x6DFB;&#x52A0;&#x7684;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.TextClause.columns" title="sqlalchemy.sql.expression.TextClause.columns"><code class="xref py py-meth docutils literal"><span class="pre">TextClause.columns()</span></code></a>&#x65B9;&#x6CD5;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x7EAF;&#x6587;&#x672C;SQL&#x7ED3;&#x6784;&#x3002;</span></p><div class="section" id="textasfrom-columns-now-works-positionally"><h4><span class="yiyi-st" id="yiyi-402">TextAsFrom.columns()&#x73B0;&#x5728;&#x5728;&#x4F4D;&#x7F6E;&#x4E0A;&#x5DE5;&#x4F5C;<a class="headerlink" href="#textasfrom-columns-now-works-positionally" title="Permalink to this headline">&#xB6;</a></span></h4><p><span class="yiyi-st" id="yiyi-403">&#x5728;0.9&#x4E2D;&#x6DFB;&#x52A0;&#x7684;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.TextClause.columns" title="sqlalchemy.sql.expression.TextClause.columns"><code class="xref py py-meth docutils literal"><span class="pre">TextClause.columns()</span></code></a>&#x65B9;&#x6CD5;&#x5728;&#x4F4D;&#x7F6E;&#x4E0A;&#x63A5;&#x53D7;&#x57FA;&#x4E8E;&#x5217;&#x7684;&#x53C2;&#x6570;&#xFF1B;&#x5728;1.1&#x4E2D;&#xFF0C;&#x5F53;&#x6240;&#x6709;&#x5217;&#x5728;&#x4F4D;&#x7F6E;&#x4E0A;&#x901A;&#x8FC7;&#x65F6;&#xFF0C;&#x8FD9;&#x4E9B;&#x5217;&#x4E0E;&#x6700;&#x7EC8;&#x7ED3;&#x679C;&#x96C6;&#x7684;&#x76F8;&#x5173;&#x6027;&#x4E5F;&#x5728;&#x4F4D;&#x7F6E;&#x4E0A;&#x6267;&#x884C;&#x3002;</span><span class="yiyi-st" id="yiyi-404">&#x8FD9;&#x91CC;&#x7684;&#x5173;&#x952E;&#x4F18;&#x52BF;&#x5728;&#x4E8E;&#xFF0C;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x5C06;&#x6587;&#x672C;SQL&#x94FE;&#x63A5;&#x5230;ORM&#x7EA7;&#x522B;&#x7684;&#x7ED3;&#x679C;&#x96C6;&#xFF0C;&#x800C;&#x65E0;&#x9700;&#x5904;&#x7406;&#x4E0D;&#x660E;&#x786E;&#x6216;&#x91CD;&#x590D;&#x7684;&#x5217;&#x540D;&#x79F0;&#xFF0C;&#x6216;&#x8005;&#x5FC5;&#x987B;&#x5C06;&#x6807;&#x7B7E;&#x65B9;&#x6848;&#x4E0E;ORM&#x7EA7;&#x522B;&#x6807;&#x7B7E;&#x65B9;&#x6848;&#x76F8;&#x5339;&#x914D;&#x3002;</span><span class="yiyi-st" id="yiyi-405">&#x73B0;&#x5728;&#x9700;&#x8981;&#x7684;&#x4EC5;&#x4EC5;&#x662F;&#x4F20;&#x9012;&#x7ED9;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.TextClause.columns" title="sqlalchemy.sql.expression.TextClause.columns"><code class="xref py py-meth docutils literal"><span class="pre">TextClause.columns()</span></code></a>&#x7684;&#x6587;&#x672C;SQL&#x548C;&#x5217;&#x53C2;&#x6570;&#x4E2D;&#x76F8;&#x540C;&#x7684;&#x5217;&#x987A;&#x5E8F;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">text</span>
<span class="n">stmt</span> <span class="o">=</span> <span class="n">text</span><span class="p">(</span><span class="s2">&quot;SELECT users.id, addresses.id, users.id, &quot;</span>
     <span class="s2">&quot;users.name, addresses.email_address AS email &quot;</span>
     <span class="s2">&quot;FROM users JOIN addresses ON users.id=addresses.user_id &quot;</span>
     <span class="s2">&quot;WHERE users.id = 1&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="p">(</span>
        <span class="n">User</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">Address</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">Address</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
        <span class="n">User</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="n">Address</span><span class="o">.</span><span class="n">email_address</span>
     <span class="p">)</span>

<span class="n">query</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">from_statement</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">options</span><span class="p">(</span><span class="n">contains_eager</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">addresses</span><span class="p">))</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></pre></div></div><p><span class="yiyi-st" id="yiyi-406">&#x4EE5;&#x4E0A;&#xFF0C;&#x6587;&#x672C;SQL&#x5305;&#x542B;&#x4E09;&#x6B21;&#x201C;id&#x201D;&#x5217;&#xFF0C;&#x8FD9;&#x901A;&#x5E38;&#x662F;&#x4E0D;&#x660E;&#x786E;&#x7684;&#x3002;</span><span class="yiyi-st" id="yiyi-407">Using the new feature, we can apply the mapped columns from the <code class="docutils literal"><span class="pre">User</span></code> and <code class="docutils literal"><span class="pre">Address</span></code> class directly, even linking the <code class="docutils literal"><span class="pre">Address.user_id</span></code> column to the <code class="docutils literal"><span class="pre">users.id</span></code> column in textual SQL for fun, and the <a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query" title="sqlalchemy.orm.query.Query"><code class="xref py py-class docutils literal"><span class="pre">Query</span></code></a> object will receive rows that are correctly targetable as needed, including for an eager load.</span></p><p><span class="yiyi-st" id="yiyi-408">&#x8FD9;&#x79CD;&#x53D8;&#x5316;&#x662F;<strong>&#x5411;&#x540E;&#x4E0D;&#x517C;&#x5BB9;</strong>&#xFF0C;&#x5176;&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#x5C06;&#x5217;&#x4F20;&#x9012;&#x7ED9;&#x65B9;&#x6CD5;&#x7684;&#x987A;&#x5E8F;&#x4E0E;&#x6587;&#x672C;&#x8BED;&#x53E5;&#x4E2D;&#x5B58;&#x5728;&#x7684;&#x987A;&#x5E8F;&#x4E0D;&#x540C;&#x3002;</span><span class="yiyi-st" id="yiyi-409">&#x5E0C;&#x671B;&#x8FD9;&#x79CD;&#x5F71;&#x54CD;&#x4F1A;&#x5F88;&#x4F4E;&#xFF0C;&#x56E0;&#x4E3A;&#x4E8B;&#x5B9E;&#x4E0A;&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x603B;&#x662F;&#x88AB;&#x8BB0;&#x5F55;&#x4E0B;&#x6765;&#xFF0C;&#x8BF4;&#x660E;&#x6309;&#x7167;&#x4E0E;&#x6587;&#x672C;SQL&#x8BED;&#x53E5;&#x76F8;&#x540C;&#x7684;&#x987A;&#x5E8F;&#x4F20;&#x9012;&#x7684;&#x5217;&#xFF0C;&#x5C3D;&#x7BA1;&#x5185;&#x90E8;&#x6CA1;&#x6709;&#x68C0;&#x67E5;&#x4E3A;&#x4E86;&#x8FD9;&#x3002;</span><span class="yiyi-st" id="yiyi-410">&#x8BE5;&#x65B9;&#x6CD5;&#x672C;&#x8EAB;&#x5728;&#x4EFB;&#x4F55;&#x60C5;&#x51B5;&#x4E0B;&#x4EC5;&#x6DFB;&#x52A0;0.9&#xFF0C;&#x53EF;&#x80FD;&#x5C1A;&#x672A;&#x5E7F;&#x6CDB;&#x4F7F;&#x7528;&#x3002;</span><span class="yiyi-st" id="yiyi-411">&#x6709;&#x5173;&#x5982;&#x4F55;&#x5904;&#x7406;&#x4F7F;&#x7528;&#x5B83;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x884C;&#x4E3A;&#x66F4;&#x6539;&#x7684;&#x6CE8;&#x610F;&#x4E8B;&#x9879;&#x5728;<a class="reference internal" href="#behavior-change-3501"><span>TextClause.columns() will match columns positionally, not by name, when passed positionally</span></a>&#x3002;</span></p><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-412">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p><span class="yiyi-st" id="yiyi-413"><a class="reference internal" href="core_tutorial.html#sqlexpression-text-columns"><span>Specifying Result-Column Behaviors</span></a>  - &#x5728;Core&#x6559;&#x7A0B;&#x4E2D;</span></p><p class="last"><span class="yiyi-st" id="yiyi-414"><a class="reference internal" href="#behavior-change-3501"><span>TextClause.columns() will match columns positionally, not by name, when passed positionally</span></a> - backwards compatibility remarks</span></p></div></div><div class="section" id="positional-matching-is-trusted-over-name-based-matching-for-core-orm-sql-constructs"><h4><span class="yiyi-st" id="yiyi-415">&#x4F4D;&#x7F6E;&#x5339;&#x914D;&#x5BF9;&#x4E8E;core_ORM SQL&#x7ED3;&#x6784;<a class="headerlink" href="#positional-matching-is-trusted-over-name-based-matching-for-core-orm-sql-constructs" title="Permalink to this headline">&#xB6;</a>&#x7684;&#x57FA;&#x4E8E;&#x540D;&#x79F0;&#x7684;&#x5339;&#x914D;&#x503C;&#x5F97;&#x4FE1;&#x8D56;</span></h4><p><span class="yiyi-st" id="yiyi-416">&#x6B64;&#x66F4;&#x6539;&#x7684;&#x53E6;&#x4E00;&#x65B9;&#x9762;&#x662F;&#x5339;&#x914D;&#x5217;&#x7684;&#x89C4;&#x5219;&#x4E5F;&#x5DF2;&#x88AB;&#x4FEE;&#x6539;&#xFF0C;&#x4EE5;&#x4FBF;&#x66F4;&#x52A0;&#x5145;&#x5206;&#x5730;&#x4F9D;&#x8D56;&#x7F16;&#x8BD1;SQL&#x7ED3;&#x6784;&#x7684;&#x201C;&#x4F4D;&#x7F6E;&#x201D;&#x5339;&#x914D;&#x3002;</span><span class="yiyi-st" id="yiyi-417">&#x7ED9;&#x51FA;&#x5982;&#x4E0B;&#x7684;&#x58F0;&#x660E;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">ua</span> <span class="o">=</span> <span class="n">users</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&apos;ua&apos;</span><span class="p">)</span>
<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">users</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">ua</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">user_id</span><span class="p">])</span></pre></div></div><p><span class="yiyi-st" id="yiyi-418">&#x4E0A;&#x8FF0;&#x58F0;&#x660E;&#x5C06;&#x7F16;&#x8BD1;&#x4E3A;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT users.user_id, ua.user_id FROM users, users AS ua</pre></div></div><p><span class="yiyi-st" id="yiyi-419">&#x5728;1.0&#x4E2D;&#xFF0C;&#x4E0A;&#x9762;&#x7684;&#x8BED;&#x53E5;&#x5728;&#x6267;&#x884C;&#x65F6;&#x4F1A;&#x4F7F;&#x7528;&#x4F4D;&#x7F6E;&#x5339;&#x914D;&#x4E0E;&#x5176;&#x539F;&#x59CB;&#x7F16;&#x8BD1;&#x6784;&#x9020;&#x76F8;&#x5339;&#x914D;&#xFF0C;&#x4F46;&#x7531;&#x4E8E;&#x8BED;&#x53E5;&#x5305;&#x542B;&#x91CD;&#x590D;&#x7684;<code class="docutils literal"><span class="pre">&apos;user_id&apos;</span></code>&#x6807;&#x7B7E;&#xFF0C;&#x6240;&#x4EE5;&#x201C;&#x6A21;&#x7CCA;&#x5217;&#x201D;&#x89C4;&#x5219;&#x4ECD;&#x7136;&#x4F1A;&#x6D89;&#x53CA;&#x9632;&#x6B62;&#x4ECE;&#x4E00;&#x884C;&#x4E2D;&#x83B7;&#x53D6;&#x5217;&#x3002;</span><span class="yiyi-st" id="yiyi-420">&#x4ECE;1.1&#x5F00;&#x59CB;&#xFF0C;&#x201C;&#x6A21;&#x7CCA;&#x5217;&#x201D;&#x89C4;&#x5219;&#x4E0D;&#x4F1A;&#x5F71;&#x54CD;&#x4ECE;&#x5217;&#x7ED3;&#x6784;&#x5230;SQL&#x5217;&#x7684;&#x5B8C;&#x5168;&#x5339;&#x914D;&#xFF0C;&#x8FD9;&#x662F;ORM&#x7528;&#x4E8E;&#x8BFB;&#x53D6;&#x5217;&#x7684;&#x5185;&#x5BB9;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<span class="n">row</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

<span class="c1"># these both match positionally, so no error</span>
<span class="n">user_id</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">users</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">user_id</span><span class="p">]</span>
<span class="n">ua_id</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">ua</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">user_id</span><span class="p">]</span>

<span class="c1"># this still raises, however</span>
<span class="n">user_id</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&apos;user_id&apos;</span><span class="p">]</span></pre></div></div></div><div class="section" id="much-less-likely-to-get-an-ambiguous-column-error-message"><h4><span class="yiyi-st" id="yiyi-421"><a class="headerlink" href="#much-less-likely-to-get-an-ambiguous-column-error-message" title="Permalink to this headline">&#xB6;</a>&#x4E0D;&#x592A;&#x53EF;&#x80FD;&#x51FA;&#x73B0;&#x201C;&#x6A21;&#x7CCA;&#x5217;&#x201D;&#x9519;&#x8BEF;&#x6D88;&#x606F;</span></h4><p><span class="yiyi-st" id="yiyi-422">&#x4F5C;&#x4E3A;&#x8FD9;&#x79CD;&#x6539;&#x53D8;&#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x9519;&#x8BEF;&#x6D88;&#x606F;&#x7684;&#x63AA;&#x8F9E;<code class="docutils literal"><span class="pre">&#x4E0D;&#x660E;&#x786E;</span> <span class="pre">&#x5217;</span> <span class="pre">&#x540D;&#x79F0;</span> <span class="pre">&apos;&#xFF06;lt&#xFF1B; name&#xFF06;gt&#xFF1B; t4&gt; <span class="pre">in</span> <span class="pre">&#x7ED3;&#x679C;</span> <span class="pre">set&#xFF01;</span> <span class="pre"><span class="pre">&apos;use_labels&apos;</span> <span class="pre">/ t10&gt; <span class="pre">on</span> <span class="pre">&#x9009;&#x62E9;</span> <span class="pre">&#x8BED;&#x53E5;&#x3002;</span></span></span></span></code></span><span class="yiyi-st" id="yiyi-423"> has been dialed back; as this message should now be extremely rare when using the ORM or Core compiled SQL constructs, it merely states <code class="docutils literal"><span class="pre">Ambiguous</span> <span class="pre">column</span> <span class="pre">name</span> <span class="pre">&apos;&lt;name&gt;&apos;</span> <span class="pre">in</span> <span class="pre">result</span> <span class="pre">set</span> <span class="pre">column</span> <span class="pre">descriptions</span></code>, and only when a result column is retrieved using the string name that is actually ambiguous, e.g. <code class="docutils literal"><span class="pre">row[&apos;user_id&apos;]</span></code> in the above example. </span><span class="yiyi-st" id="yiyi-424">&#x5B83;&#x73B0;&#x5728;&#x8FD8;&#x5F15;&#x7528;&#x4E86;&#x5448;&#x73B0;&#x7684;SQL&#x8BED;&#x53E5;&#x672C;&#x8EAB;&#x4E2D;&#x5B9E;&#x9645;&#x4E0D;&#x660E;&#x786E;&#x7684;&#x540D;&#x79F0;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x6307;&#x793A;&#x7528;&#x4E8E;&#x63D0;&#x53D6;&#x7684;&#x6784;&#x9020;&#x672C;&#x5730;&#x7684;&#x952E;&#x6216;&#x540D;&#x79F0;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-425"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3501">&#xFF03;3501  T0&gt;</a></span></p></div></div><div class="section" id="support-for-python-s-native-enum-type-and-compatible-forms"><h3><span class="yiyi-st" id="yiyi-426">&#x652F;&#x6301;Python&#x7684;&#x672C;&#x5730;<code class="docutils literal"><span class="pre">enum</span></code>&#x7C7B;&#x578B;&#x548C;&#x517C;&#x5BB9;&#x5F62;&#x5F0F;<a class="headerlink" href="#support-for-python-s-native-enum-type-and-compatible-forms" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-427">&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4EFB;&#x4F55;&#x7B26;&#x5408;PEP-435&#x679A;&#x4E3E;&#x7C7B;&#x578B;&#x6765;&#x6784;&#x9020;<a class="reference internal" href="core_type_basics.html#sqlalchemy.types.Enum" title="sqlalchemy.types.Enum"><code class="xref py py-class docutils literal"><span class="pre">Enum</span></code></a>&#x7C7B;&#x578B;&#x3002;</span><span class="yiyi-st" id="yiyi-428">&#x4F7F;&#x7528;&#x6B64;&#x6A21;&#x5F0F;&#x65F6;&#xFF0C;&#x8F93;&#x5165;&#x503C;&#x548C;&#x8FD4;&#x56DE;&#x503C;&#x662F;&#x5B9E;&#x9645;&#x7684;&#x679A;&#x4E3E;&#x5BF9;&#x8C61;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5B57;&#x7B26;&#x4E32;&#x503C;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">enum</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Table</span><span class="p">,</span> <span class="n">MetaData</span><span class="p">,</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Enum</span><span class="p">,</span> <span class="n">create_engine</span>


<span class="k">class</span> <span class="nc">MyEnum</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">one</span> <span class="o">=</span> <span class="s2">&quot;one&quot;</span>
    <span class="n">two</span> <span class="o">=</span> <span class="s2">&quot;two&quot;</span>
    <span class="n">three</span> <span class="o">=</span> <span class="s2">&quot;three&quot;</span>


<span class="n">t</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s1">&apos;data&apos;</span><span class="p">,</span> <span class="n">MetaData</span><span class="p">(),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;value&apos;</span><span class="p">,</span> <span class="n">Enum</span><span class="p">(</span><span class="n">MyEnum</span><span class="p">))</span>
<span class="p">)</span>

<span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;sqlite://&quot;</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="n">e</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">insert</span><span class="p">(),</span> <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">MyEnum</span><span class="o">.</span><span class="n">two</span><span class="p">})</span>
<span class="k">assert</span> <span class="n">e</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">select</span><span class="p">())</span> <span class="ow">is</span> <span class="n">MyEnum</span><span class="o">.</span><span class="n">two</span></pre></div></div><p><span class="yiyi-st" id="yiyi-429"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3292">&#xFF03;3292  T0&gt;</a></span></p></div><div class="section" id="negative-integer-indexes-accommodated-by-core-result-rows"><h3><span class="yiyi-st" id="yiyi-430">Core&#x7ED3;&#x679C;&#x884C;&#x5BB9;&#x7EB3;&#x7684;&#x8D1F;&#x6574;&#x6570;&#x7D22;&#x5F15;<a class="headerlink" href="#negative-integer-indexes-accommodated-by-core-result-rows" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-431">The <a class="reference internal" href="core_connections.html#sqlalchemy.engine.RowProxy" title="sqlalchemy.engine.RowProxy"><code class="xref py py-class docutils literal"><span class="pre">RowProxy</span></code></a> object now accomodates single negative integer indexes like a regular Python sequence, both in the pure Python and C-extension version. </span><span class="yiyi-st" id="yiyi-432">&#x4EE5;&#x524D;&#xFF0C;&#x8D1F;&#x503C;&#x53EA;&#x80FD;&#x5728;&#x5207;&#x7247;&#x4E2D;&#x4F7F;&#x7528;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;sqlite://&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">row</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;select 1, 2, 3&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">row</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<span class="go">3 2 2 (2,)</span></pre></div></div></div><div class="section" id="the-enum-type-now-does-in-python-validation-of-values"><h3><span class="yiyi-st" id="yiyi-433">&#x73B0;&#x5728;&#xFF0C;<code class="docutils literal"><span class="pre">Enum</span></code>&#x7C7B;&#x578B;&#x5BF9;&#x503C;&#x8FDB;&#x884C;&#x4E86;Python&#x9A8C;&#x8BC1;<a class="headerlink" href="#the-enum-type-now-does-in-python-validation-of-values" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-434">&#x4E3A;&#x4E86;&#x9002;&#x5E94;Python&#x672C;&#x5730;&#x679A;&#x4E3E;&#x5BF9;&#x8C61;&#x4EE5;&#x53CA;&#x8FB9;&#x7F18;&#x60C5;&#x51B5;&#xFF0C;&#x4F8B;&#x5982;&#x5728;ARRAY&#x4E2D;&#x4F7F;&#x7528;&#x975E;&#x672C;&#x5730;ENUM&#x7C7B;&#x578B;&#x5E76;&#x4E14;CHECK&#x7EA6;&#x675F;&#x4E0D;&#x53EF;&#x884C;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x73B0;&#x5728;<a class="reference internal" href="core_type_basics.html#sqlalchemy.types.Enum" title="sqlalchemy.types.Enum"><code class="xref py py-class docutils literal"><span class="pre">Enum</span></code></a>&#x6570;&#x636E;&#x7C7B;&#x578B;&#x6DFB;&#x52A0; - &#x4F7F;&#x7528;<a class="reference internal" href="core_type_basics.html#sqlalchemy.types.Enum.params.validate_strings" title="sqlalchemy.types.Enum"><code class="xref py py-paramref docutils literal"><span class="pre">Enum.validate_strings</span></code></a>&#x6807;&#x5FD7;&#x65F6;&#xFF0C;&#x8F93;&#x5165;&#x503C;&#x7684;Python&#x9A8C;&#x8BC1;&#xFF08;1.1.0b2&#xFF09;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Table</span><span class="p">,</span> <span class="n">MetaData</span><span class="p">,</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Enum</span><span class="p">,</span> <span class="n">create_engine</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
<span class="gp">... </span>    <span class="s1">&apos;data&apos;</span><span class="p">,</span> <span class="n">MetaData</span><span class="p">(),</span>
<span class="gp">... </span>    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;value&apos;</span><span class="p">,</span> <span class="n">Enum</span><span class="p">(</span><span class="s2">&quot;one&quot;</span><span class="p">,</span> <span class="s2">&quot;two&quot;</span><span class="p">,</span> <span class="s2">&quot;three&quot;</span><span class="p">,</span> <span class="n">validate_strings</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;sqlite://&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">insert</span><span class="p">(),</span> <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;four&quot;</span><span class="p">})</span>
<span class="gt">Traceback (most recent call last):</span>
  <span class="c">...</span>
<span class="gr">sqlalchemy.exc.StatementError</span>: <span class="n">(exceptions.LookupError)</span>
<span class="go">&quot;four&quot; is not among the defined enum values</span>
<span class="go">[SQL: u&apos;INSERT INTO data (value) VALUES (?)&apos;]</span>
<span class="go">[parameters: [{&apos;value&apos;: &apos;four&apos;}]]</span></pre></div></div><p><span class="yiyi-st" id="yiyi-435">&#x6B64;&#x9A8C;&#x8BC1;&#x5728;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#x5904;&#x4E8E;&#x5173;&#x95ED;&#x72B6;&#x6001;&#xFF0C;&#x56E0;&#x4E3A;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x7528;&#x6237;&#x4E0D;&#x5E0C;&#x671B;&#x8FDB;&#x884C;&#x6B64;&#x7C7B;&#x9A8C;&#x8BC1;&#xFF08;&#x4F8B;&#x5982;&#x5B57;&#x7B26;&#x4E32;&#x6BD4;&#x8F83;&#xFF09;&#x7684;&#x7528;&#x4F8B;&#x3002;</span><span class="yiyi-st" id="yiyi-436">&#x5BF9;&#x4E8E;&#x975E;&#x5B57;&#x7B26;&#x4E32;&#x7C7B;&#x578B;&#xFF0C;&#x5B83;&#x5FC5;&#x7136;&#x53D1;&#x751F;&#x5728;&#x6240;&#x6709;&#x60C5;&#x51B5;&#x4E0B;&#x3002;</span><span class="yiyi-st" id="yiyi-437">&#x5F53;&#x8FD4;&#x56DE;&#x6765;&#x81EA;&#x6570;&#x636E;&#x5E93;&#x7684;&#x503C;&#x65F6;&#xFF0C;&#x68C0;&#x67E5;&#x4E5F;&#x65E0;&#x6761;&#x4EF6;&#x5730;&#x53D1;&#x751F;&#x5728;&#x7ED3;&#x679C;&#x5904;&#x7406;&#x7AEF;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-438">&#x6B64;&#x9A8C;&#x8BC1;&#x9664;&#x4E86;&#x4F7F;&#x7528;&#x975E;&#x672C;&#x673A;&#x679A;&#x4E3E;&#x7C7B;&#x578B;&#x65F6;&#x521B;&#x5EFA;CHECK&#x7EA6;&#x675F;&#x7684;&#x73B0;&#x6709;&#x884C;&#x4E3A;&#x5916;&#x3002;</span><span class="yiyi-st" id="yiyi-439">&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x65B0;&#x7684;<a class="reference internal" href="core_type_basics.html#sqlalchemy.types.Enum.params.create_constraint" title="sqlalchemy.types.Enum"><code class="xref py py-paramref docutils literal"><span class="pre">Enum.create_constraint</span></code></a>&#x6807;&#x5FD7;&#x7981;&#x6B62;&#x521B;&#x5EFA;&#x6B64;CHECK&#x7EA6;&#x675F;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-440"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3095">&#xFF03;3095  T0&gt;</a></span></p></div><div class="section" id="non-native-boolean-integer-values-coerced-to-zero-one-none-in-all-cases"><h3><span class="yiyi-st" id="yiyi-441">&#x5728;&#x6240;&#x6709;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x975E;&#x672C;&#x5730;&#x5E03;&#x5C14;&#x6574;&#x578B;&#x503C;&#x5F3A;&#x5236;&#x4E3A;&#x96F6;/&#x4E00;/&#x65E0;<a class="headerlink" href="#non-native-boolean-integer-values-coerced-to-zero-one-none-in-all-cases" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-442"><a class="reference internal" href="core_type_basics.html#sqlalchemy.types.Boolean" title="sqlalchemy.types.Boolean"><code class="xref py py-class docutils literal"><span class="pre">Boolean</span></code></a>&#x6570;&#x636E;&#x7C7B;&#x578B;&#x5C06;Python&#x5E03;&#x5C14;&#x503C;&#x5F3A;&#x5236;&#x4E3A;&#x4E0D;&#x5177;&#x6709;&#x672C;&#x673A;&#x5E03;&#x5C14;&#x7C7B;&#x578B;&#x7684;&#x540E;&#x7AEF;&#x7684;&#x6574;&#x6570;&#x503C;&#xFF0C;&#x4F8B;&#x5982;SQLite&#x548C;MySQL&#x3002;</span><span class="yiyi-st" id="yiyi-443">&#x5728;&#x8FD9;&#x4E9B;&#x540E;&#x7AEF;&#x4E0A;&#xFF0C;&#x901A;&#x5E38;&#x4F1A;&#x5EFA;&#x7ACB;CHECK&#x7EA6;&#x675F;&#xFF0C;&#x4EE5;&#x786E;&#x4FDD;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x7684;&#x503C;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x8FD9;&#x4E24;&#x4E2A;&#x503C;&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x3002;</span><span class="yiyi-st" id="yiyi-444">&#x4F46;&#x662F;&#xFF0C;MySQL&#x4F1A;&#x5FFD;&#x7565;CHECK&#x7EA6;&#x675F;&#xFF0C;&#x7EA6;&#x675F;&#x662F;&#x53EF;&#x9009;&#x7684;&#xFF0C;&#x5E76;&#x4E14;&#x73B0;&#x6709;&#x6570;&#x636E;&#x5E93;&#x53EF;&#x80FD;&#x6CA1;&#x6709;&#x6B64;&#x7EA6;&#x675F;&#x3002;</span><span class="yiyi-st" id="yiyi-445"><a class="reference internal" href="core_type_basics.html#sqlalchemy.types.Boolean" title="sqlalchemy.types.Boolean"><code class="xref py py-class docutils literal"><span class="pre">Boolean</span></code></a>&#x6570;&#x636E;&#x7C7B;&#x578B;&#x5DF2;&#x88AB;&#x4FEE;&#x590D;&#xFF0C;&#x4F7F;&#x5F97;&#x5DF2;&#x7ECF;&#x662F;&#x6574;&#x6570;&#x503C;&#x7684;&#x4F20;&#x5165;Python&#x7AEF;&#x503C;&#x88AB;&#x5F3A;&#x5236;&#x4E3A;0&#x6216;1&#xFF0C;&#x800C;&#x4E0D;&#x4EC5;&#x4EC5;&#x662F;&#x6309;&#x539F;&#x6837;&#x4F20;&#x9012;&#xFF1B;&#x53E6;&#x5916;&#xFF0C;&#x7ED3;&#x679C;&#x7684;int-to-boolean&#x5904;&#x7406;&#x5668;&#x7684;C&#x6269;&#x5C55;&#x7248;&#x672C;&#x73B0;&#x5728;&#x4F7F;&#x7528;&#x76F8;&#x540C;&#x7684;Python&#x5E03;&#x5C14;&#x503C;&#x89E3;&#x91CA;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x65AD;&#x8A00;&#x4E00;&#x4E2A;&#x786E;&#x5207;&#x7684;&#x4E00;&#x4E2A;&#x6216;&#x96F6;&#x503C;&#x3002;</span><span class="yiyi-st" id="yiyi-446">&#x73B0;&#x5728;&#xFF0C;&#x8FD9;&#x4E0E;&#x7EAF;Python&#x7684;int-to-boolean&#x5904;&#x7406;&#x5668;&#x4E00;&#x81F4;&#xFF0C;&#x5E76;&#x4E14;&#x66F4;&#x52A0;&#x5BBD;&#x5BB9;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x5DF2;&#x5B58;&#x5728;&#x7684;&#x6570;&#x636E;&#x3002;</span><span class="yiyi-st" id="yiyi-447">None / NULL&#x7684;&#x503C;&#x4E0E;&#x4E4B;&#x524D;&#x4E00;&#x6837;&#x4FDD;&#x7559;&#x4E3A;None / NULL&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-448"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3730">&#xFF03;3730  T0&gt;</a></span></p></div><div class="section" id="large-parameter-and-row-values-are-now-truncated-in-logging-and-exception-displays"><h3><span class="yiyi-st" id="yiyi-449">&#x5927;&#x7684;&#x53C2;&#x6570;&#x548C;&#x884C;&#x503C;&#x73B0;&#x5728;&#x5728;&#x65E5;&#x5FD7;&#x548C;&#x5F02;&#x5E38;&#x663E;&#x793A;&#x4E2D;&#x88AB;&#x622A;&#x65AD;<a class="headerlink" href="#large-parameter-and-row-values-are-now-truncated-in-logging-and-exception-displays" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-450">&#x73B0;&#x5728;&#xFF0C;&#x5728;&#x8BB0;&#x5F55;&#xFF0C;&#x5F02;&#x5E38;&#x62A5;&#x544A;&#x4EE5;&#x53CA;<code class="docutils literal"><span class="pre">repr()</span></code>&#x671F;&#x95F4;&#x7684;&#x663E;&#x793A;&#x671F;&#x95F4;&#xFF0C;&#x5C06;&#x622A;&#x65AD;&#x4F5C;&#x4E3A;SQL&#x8BED;&#x53E5;&#x7684;&#x7ED1;&#x5B9A;&#x53C2;&#x6570;&#x4EE5;&#x53CA;&#x7ED3;&#x679C;&#x884C;&#x4E2D;&#x5B58;&#x5728;&#x7684;&#x5927;&#x503C;&#x7684;&#x5927;&#x503C;&#x3002;&#x8BE5;&#x884C;&#x672C;&#x8EAB;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">random</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;sqlite://&quot;</span><span class="p">,</span> <span class="n">echo</span><span class="o">=</span><span class="s1">&apos;debug&apos;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">some_value</span> <span class="o">=</span> <span class="s1">&apos;&apos;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">52</span><span class="p">,</span> <span class="mi">85</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5000</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">row</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;select ?&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">some_value</span><span class="p">])</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<span class="gp">... </span><span class="p">(</span><span class="n">lines</span> <span class="n">are</span> <span class="n">wrapped</span> <span class="k">for</span> <span class="n">clarity</span><span class="p">)</span> <span class="o">...</span>
<span class="go">2016-02-17 13:23:03,027 INFO sqlalchemy.engine.base.Engine select ?</span>
<span class="go">2016-02-17 13:23:03,027 INFO sqlalchemy.engine.base.Engine</span>
<span class="go">(&apos;E6@?&gt;9HPOJB&lt;&lt;BHR:@=TS:5ILU=;JLM&lt;4?B9&lt;S48PTNG9&gt;:=TSTLA;9K;9FPM4M8M@;NM6GU</span>
<span class="go">LUAEBT9QGHNHTHR5EP75@OER4?SKC;D:TFUMD:M&gt;;C6U:JLM6R67GEK&lt;A6@S@C@J7&gt;4=4:P</span>
<span class="go">GJ7HQ6 ... (4702 characters truncated) ... J6IK546AJMB4N6S9L;;9AKI;=RJP</span>
<span class="go">HDSSOTNBUEEC9@Q:RCL:I@5?FO&lt;9K&gt;KJAGAO@E6@A7JI8O:J7B69T6&lt;8;F:S;4BEIJS9HM</span>
<span class="go">K:;5OLPM@JR;R:J6&lt;SOTTT=&gt;Q&gt;7T@I::OTDC:CC&lt;=NGP6C&gt;BC8N&apos;,)</span>
<span class="go">2016-02-17 13:23:03,027 DEBUG sqlalchemy.engine.base.Engine Col (&apos;?&apos;,)</span>
<span class="go">2016-02-17 13:23:03,027 DEBUG sqlalchemy.engine.base.Engine</span>
<span class="go">Row (u&apos;E6@?&gt;9HPOJB&lt;&lt;BHR:@=TS:5ILU=;JLM&lt;4?B9&lt;S48PTNG9&gt;:=TSTLA;9K;9FPM4M8M@;</span>
<span class="go">NM6GULUAEBT9QGHNHTHR5EP75@OER4?SKC;D:TFUMD:M&gt;;C6U:JLM6R67GEK&lt;A6@S@C@J7</span>
<span class="go">&gt;4=4:PGJ7HQ ... (4703 characters truncated) ... J6IK546AJMB4N6S9L;;9AKI;=</span>
<span class="go">RJPHDSSOTNBUEEC9@Q:RCL:I@5?FO&lt;9K&gt;KJAGAO@E6@A7JI8O:J7B69T6&lt;8;F:S;4BEIJS9HM</span>
<span class="go">K:;5OLPM@JR;R:J6&lt;SOTTT=&gt;Q&gt;7T@I::OTDC:CC&lt;=NGP6C&gt;BC8N&apos;,)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<span class="go">(u&apos;E6@?&gt;9HPOJB&lt;&lt;BHR:@=TS:5ILU=;JLM&lt;4?B9&lt;S48PTNG9&gt;:=TSTLA;9K;9FPM4M8M@;NM6</span>
<span class="go">GULUAEBT9QGHNHTHR5EP75@OER4?SKC;D:TFUMD:M&gt;;C6U:JLM6R67GEK&lt;A6@S@C@J7&gt;4</span>
<span class="go">=4:PGJ7HQ ... (4703 characters truncated) ... J6IK546AJMB4N6S9L;;9AKI;</span>
<span class="go">=RJPHDSSOTNBUEEC9@Q:RCL:I@5?FO&lt;9K&gt;KJAGAO@E6@A7JI8O:J7B69T6&lt;8;F:S;4BEIJS9H</span>
<span class="go">MK:;5OLPM@JR;R:J6&lt;SOTTT=&gt;Q&gt;7T@I::OTDC:CC&lt;=NGP6C&gt;BC8N&apos;,)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-451"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2837">&#xFF03;2837  T0&gt;</a></span></p></div><div class="section" id="a-union-or-similar-of-selects-with-limit-offset-order-by-now-parenthesizes-the-embedded-selects"><h3><span class="yiyi-st" id="yiyi-452">&#x5177;&#x6709;LIMIT / OFFSET / ORDER BY&#x7684;UNION&#x6216;&#x7C7B;&#x4F3C;SELECT&#x7684;&#x9009;&#x9879;&#x73B0;&#x5728;&#x5C06;&#x5D4C;&#x5165;&#x7684;&#x9009;&#x62E9;&#x7B26;&#x62EC;&#x8D77;&#x6765;<a class="headerlink" href="#a-union-or-similar-of-selects-with-limit-offset-order-by-now-parenthesizes-the-embedded-selects" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-453">&#x4E0E;&#x5176;&#x4ED6;&#x4EBA;&#x4E00;&#x6837;&#xFF0C;SQLite&#x7F3A;&#x4E4F;&#x80FD;&#x529B;&#x9A71;&#x52A8;&#x7684;&#x95EE;&#x9898;&#x73B0;&#x5728;&#x5DF2;&#x5F97;&#x5230;&#x589E;&#x5F3A;&#xFF0C;&#x53EF;&#x7528;&#x4E8E;&#x6240;&#x6709;&#x652F;&#x6301;&#x7684;&#x540E;&#x7AEF;&#x3002;</span><span class="yiyi-st" id="yiyi-454">&#x6211;&#x4EEC;&#x5F15;&#x7528;&#x7684;&#x67E5;&#x8BE2;&#x662F;SELECT&#x8BED;&#x53E5;&#x7684;UNION&#xFF0C;&#x5B83;&#x4EEC;&#x672C;&#x8EAB;&#x5305;&#x542B;&#x884C;&#x9650;&#x5236;&#x6216;&#x6392;&#x5E8F;&#x529F;&#x80FD;&#xFF0C;&#x5176;&#x4E2D;&#x5305;&#x62EC;LIMIT&#xFF0C;OFFSET&#x548C;/&#x6216;ORDER BY&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>(SELECT x FROM table1 ORDER BY y LIMIT 1) UNION
(SELECT x FROM table2 ORDER BY y LIMIT 2)</pre></div></div><p><span class="yiyi-st" id="yiyi-455">&#x4E0A;&#x9762;&#x7684;&#x67E5;&#x8BE2;&#x9700;&#x8981;&#x5728;&#x6BCF;&#x4E2A;&#x5B50;&#x9009;&#x62E9;&#x5185;&#x90E8;&#x8FDB;&#x884C;&#x62EC;&#x53F7;&#xFF0C;&#x4EE5;&#x4FBF;&#x6B63;&#x786E;&#x5730;&#x5BF9;&#x5B50;&#x7ED3;&#x679C;&#x8FDB;&#x884C;&#x5206;&#x7EC4;&#x3002;</span><span class="yiyi-st" id="yiyi-456">&#x5728;SQLAlchemy Core&#x4E2D;&#x751F;&#x6210;&#x4E0A;&#x8FF0;&#x8BED;&#x53E5;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">stmt1</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">table1</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="p">])</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">table1</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">stmt2</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">table1</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="p">])</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">table2</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="n">stmt</span> <span class="o">=</span> <span class="n">union</span><span class="p">(</span><span class="n">stmt1</span><span class="p">,</span> <span class="n">stmt2</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-457">&#x4EE5;&#x524D;&#xFF0C;&#x4E0A;&#x9762;&#x7684;&#x6784;&#x9020;&#x4E0D;&#x4F1A;&#x4E3A;&#x5185;&#x90E8;SELECT&#x8BED;&#x53E5;&#x4EA7;&#x751F;&#x62EC;&#x53F7;&#xFF0C;&#x4EA7;&#x751F;&#x4E00;&#x4E2A;&#x5728;&#x6240;&#x6709;&#x540E;&#x7AEF;&#x90FD;&#x5931;&#x8D25;&#x7684;&#x67E5;&#x8BE2;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-458">The above formats will <strong>continue to fail on SQLite</strong>; additionally, the format that includes ORDER BY but no LIMIT/SELECT will <strong>continue to fail on Oracle</strong>. </span><span class="yiyi-st" id="yiyi-459">&#x8FD9;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x5411;&#x540E;&#x4E0D;&#x517C;&#x5BB9;&#x7684;&#x66F4;&#x6539;&#xFF0C;&#x56E0;&#x4E3A;&#x67E5;&#x8BE2;&#x5931;&#x8D25;&#x65F6;&#x6CA1;&#x6709;&#x62EC;&#x53F7;&#xFF1B;&#x901A;&#x8FC7;&#x4FEE;&#x590D;&#xFF0C;&#x67E5;&#x8BE2;&#x81F3;&#x5C11;&#x53EF;&#x4EE5;&#x5728;&#x6240;&#x6709;&#x5176;&#x4ED6;&#x6570;&#x636E;&#x5E93;&#x4E0A;&#x5DE5;&#x4F5C;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-460">&#x5728;&#x6240;&#x6709;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4E3A;&#x4E86;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x6709;&#x9650;&#x7684;SELECT&#x8BED;&#x53E5;&#x7684;UNION&#xFF0C;&#x5B83;&#x4E5F;&#x9002;&#x7528;&#x4E8E;SQLite&#xFF0C;&#x5E76;&#x4E14;&#x5728;&#x6240;&#x6709;&#x60C5;&#x51B5;&#x4E0B;&#x90FD;&#x9002;&#x7528;&#x4E8E;Oracle&#xFF0C;&#x5B50;&#x67E5;&#x8BE2;&#x5FC5;&#x987B;&#x662F;ALIAS&#x7684;SELECT&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">stmt1</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">table1</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="p">])</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">table1</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">()</span><span class="o">.</span><span class="n">select</span><span class="p">()</span>
<span class="n">stmt2</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">table2</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="p">])</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">table2</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">()</span><span class="o">.</span><span class="n">select</span><span class="p">()</span>

<span class="n">stmt</span> <span class="o">=</span> <span class="n">union</span><span class="p">(</span><span class="n">stmt1</span><span class="p">,</span> <span class="n">stmt2</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-461">&#x6B64;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#x9002;&#x7528;&#x4E8E;&#x6240;&#x6709;SQLAlchemy&#x7248;&#x672C;&#x3002;</span><span class="yiyi-st" id="yiyi-462">&#x5728;ORM&#x4E2D;&#xFF0C;&#x5B83;&#x770B;&#x8D77;&#x6765;&#x50CF;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">stmt1</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Model1</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">Model1</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">subquery</span><span class="p">()</span><span class="o">.</span><span class="n">select</span><span class="p">()</span>
<span class="n">stmt2</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Model2</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">Model2</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">subquery</span><span class="p">()</span><span class="o">.</span><span class="n">select</span><span class="p">()</span>

<span class="n">stmt</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Model1</span><span class="p">)</span><span class="o">.</span><span class="n">from_statement</span><span class="p">(</span><span class="n">stmt1</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">stmt2</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-463">&#x8FD9;&#x91CC;&#x7684;&#x884C;&#x4E3A;&#x6709;&#x8BB8;&#x591A;&#x7C7B;&#x4F3C;&#x4E8E;&#x5728;<a class="reference internal" href="migration_09.html#feature-joins-09"><span>Many JOIN and LEFT OUTER JOIN expressions will no longer be wrapped in (SELECT * FROM ..) AS ANON_1</span></a>&#x4E2D;&#xFF1B;&#x4F46;&#x662F;&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6211;&#x4EEC;&#x9009;&#x62E9;&#x4E0D;&#x6DFB;&#x52A0;&#x65B0;&#x7684;&#x91CD;&#x5199;&#x884C;&#x4E3A;&#x6765;&#x9002;&#x5E94;SQLite&#x7684;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x3002;</span><span class="yiyi-st" id="yiyi-464">&#x73B0;&#x6709;&#x7684;&#x91CD;&#x5199;&#x884C;&#x4E3A;&#x5DF2;&#x7ECF;&#x975E;&#x5E38;&#x590D;&#x6742;&#x4E86;&#xFF0C;&#x800C;&#x4F7F;&#x7528;&#x62EC;&#x53F7;&#x5316;SELECT&#x8BED;&#x53E5;&#x7684;UNION&#x7684;&#x60C5;&#x51B5;&#x6BD4;&#x90A3;&#x4E2A;&#x7279;&#x6027;&#x7684;&#x201C;&#x53F3;&#x5D4C;&#x5957;&#x8FDE;&#x63A5;&#x201D;&#x7528;&#x4F8B;&#x8981;&#x5C11;&#x5F97;&#x591A;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-465"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2528">&#xFF03;2528  T0&gt;</a></span></p></div><div class="section" id="json-support-added-to-core"><h3><span class="yiyi-st" id="yiyi-466">&#x5BF9;Core <a class="headerlink" href="#json-support-added-to-core" title="Permalink to this headline">&#xB6;</a>&#x6DFB;&#x52A0;&#x4E86;JSON&#x652F;&#x6301;</span></h3><p><span class="yiyi-st" id="yiyi-467">&#x7531;&#x4E8E;MySQL&#x73B0;&#x5728;&#x9664;&#x4E86;Postgresql JSON&#x6570;&#x636E;&#x7C7B;&#x578B;&#x4E4B;&#x5916;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;JSON&#x6570;&#x636E;&#x7C7B;&#x578B;&#xFF0C;&#x6240;&#x4EE5;&#x73B0;&#x5728;&#x5185;&#x6838;&#x83B7;&#x5F97;&#x4E86;&#x4E00;&#x4E2A;<a class="reference internal" href="core_type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal"><span class="pre">sqlalchemy.types.JSON</span></code></a>&#x6570;&#x636E;&#x7C7B;&#x578B;&#xFF0C;&#x5B83;&#x4EEC;&#x662F;&#x8FD9;&#x4E24;&#x4E2A;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x7684;&#x57FA;&#x7840;&#x3002;</span><span class="yiyi-st" id="yiyi-468">&#x4F7F;&#x7528;&#x8FD9;&#x79CD;&#x7C7B;&#x578B;&#x5141;&#x8BB8;&#x4EE5;&#x5BF9;Postgresql&#x548C;MySQL&#x4E0D;&#x53EF;&#x77E5;&#x7684;&#x65B9;&#x5F0F;&#x8BBF;&#x95EE;&#x201C;getitem&#x201D;&#x8FD0;&#x7B97;&#x7B26;&#x4EE5;&#x53CA;&#x201C;getpath&#x201D;&#x8FD0;&#x7B97;&#x7B26;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-469">&#x65B0;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x8FD8;&#x5BF9;NULL&#x503C;&#x7684;&#x5904;&#x7406;&#x4EE5;&#x53CA;&#x8868;&#x8FBE;&#x5F0F;&#x5904;&#x7406;&#x8FDB;&#x884C;&#x4E86;&#x4E00;&#x7CFB;&#x5217;&#x6539;&#x8FDB;&#x3002;</span></p><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-470">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p><span class="yiyi-st" id="yiyi-471"><a class="reference internal" href="#change-3547"><span>MySQL JSON Support</span></a></span></p><p><span class="yiyi-st" id="yiyi-472"><a class="reference internal" href="core_type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal"><span class="pre">types.JSON</span></code></a></span></p><p><span class="yiyi-st" id="yiyi-473"><a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.JSON" title="sqlalchemy.dialects.postgresql.JSON"><code class="xref py py-class docutils literal"><span class="pre">postgresql.JSON</span></code></a></span></p><p class="last"><span class="yiyi-st" id="yiyi-474"><a class="reference internal" href="dialects_mysql.html#sqlalchemy.dialects.mysql.JSON" title="sqlalchemy.dialects.mysql.JSON"><code class="xref py py-class docutils literal"><span class="pre">mysql.JSON</span></code></a></span></p></div><p><span class="yiyi-st" id="yiyi-475"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3619">&#xFF03;3619  T0&gt;</a></span></p><div class="section" id="json-null-is-inserted-as-expected-with-orm-operations-regardless-of-column-default-present"><h4><span class="yiyi-st" id="yiyi-476">JSON&#x201C;null&#x201D;&#x6309;&#x9884;&#x671F;&#x63D2;&#x5165;ORM&#x64CD;&#x4F5C;&#xFF0C;&#x800C;&#x4E0D;&#x7BA1;&#x5217;&#x9ED8;&#x8BA4;&#x5B58;&#x5728;<a class="headerlink" href="#json-null-is-inserted-as-expected-with-orm-operations-regardless-of-column-default-present" title="Permalink to this headline">&#xB6;</a></span></h4><p><span class="yiyi-st" id="yiyi-477">The <a class="reference internal" href="core_type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal"><span class="pre">types.JSON</span></code></a> type and its descendant types <a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.JSON" title="sqlalchemy.dialects.postgresql.JSON"><code class="xref py py-class docutils literal"><span class="pre">postgresql.JSON</span></code></a> and <a class="reference internal" href="dialects_mysql.html#sqlalchemy.dialects.mysql.JSON" title="sqlalchemy.dialects.mysql.JSON"><code class="xref py py-class docutils literal"><span class="pre">mysql.JSON</span></code></a> have a flag <a class="reference internal" href="core_type_basics.html#sqlalchemy.types.JSON.params.none_as_null" title="sqlalchemy.types.JSON"><code class="xref py py-paramref docutils literal"><span class="pre">types.JSON.none_as_null</span></code></a> which when set to True indicates that the Python value <code class="docutils literal"><span class="pre">None</span></code> should translate into a SQL NULL rather than a JSON NULL value. </span><span class="yiyi-st" id="yiyi-478">This flag defaults to False, which means that the column should <em>never</em> insert SQL NULL or fall back to a default unless the <a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.null" title="sqlalchemy.sql.expression.null"><code class="xref py py-func docutils literal"><span class="pre">null()</span></code></a> constant were used. </span><span class="yiyi-st" id="yiyi-479">&#x4F46;&#x662F;&#xFF0C;&#x5728;&#x4E24;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;ORM&#x53EF;&#x80FD;&#x4F1A;&#x5931;&#x8D25;&#xFF1B;&#x4E00;&#x79CD;&#x662F;&#x5F53;&#x5217;&#x4E2D;&#x8FD8;&#x5305;&#x542B;default&#x6216;server_default&#x503C;&#x65F6;&#xFF0C;&#x6620;&#x5C04;&#x5C5E;&#x6027;&#x4E0A;&#x7684;&#x6B63;&#x503C;<code class="docutils literal"><span class="pre">None</span></code>&#x4ECD;&#x7136;&#x4F1A;&#x5BFC;&#x81F4;&#x5217;&#x7EA7;&#x522B;&#x7684;&#x9ED8;&#x8BA4;&#x503C;&#x88AB;&#x89E6;&#x53D1;&#xFF0C;&#x66FF;&#x6362;<code class="docutils literal"><span class="pre">None</span></code></span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">obj</span> <span class="o">=</span> <span class="n">MyObject</span><span class="p">(</span><span class="n">json_value</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>   <span class="c1"># would fire off default / server_default, not encode &quot;&apos;none&apos;&quot;</span></pre></div></div><p><span class="yiyi-st" id="yiyi-480">The other is when the <a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session.bulk_insert_mappings" title="sqlalchemy.orm.session.Session.bulk_insert_mappings"><code class="xref py py-meth docutils literal"><span class="pre">Session.bulk_insert_mappings()</span></code></a> method were used, <code class="docutils literal"><span class="pre">None</span></code> would be ignored in all cases:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">bulk_insert_mappings</span><span class="p">(</span>
    <span class="n">MyObject</span><span class="p">,</span>
    <span class="p">[{</span><span class="s2">&quot;json_value&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">}])</span>  <span class="c1"># would insert SQL NULL and/or trigger defaults</span></pre></div></div><p><span class="yiyi-st" id="yiyi-481"><a class="reference internal" href="core_type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal"><span class="pre">types.JSON</span></code></a>&#x7C7B;&#x578B;&#x73B0;&#x5728;&#x5B9E;&#x73B0;&#x4E86;<a class="reference internal" href="core_type_api.html#sqlalchemy.types.TypeEngine.should_evaluate_none" title="sqlalchemy.types.TypeEngine.should_evaluate_none"><code class="xref py py-attr docutils literal"><span class="pre">TypeEngine.should_evaluate_none</span></code></a>&#x6807;&#x5FD7;&#xFF0C;&#x8868;&#x793A;<code class="docutils literal"><span class="pre">None</span></code>&#x5728;&#x8FD9;&#x91CC;&#x4E0D;&#x5E94;&#x5FFD;&#x7565;&#xFF1B;&#x5B83;&#x4F1A;&#x6839;&#x636E;<a class="reference internal" href="core_type_basics.html#sqlalchemy.types.JSON.params.none_as_null" title="sqlalchemy.types.JSON"><code class="xref py py-paramref docutils literal"><span class="pre">types.JSON.none_as_null</span></code></a>&#x7684;&#x503C;&#x81EA;&#x52A8;&#x8FDB;&#x884C;&#x914D;&#x7F6E;&#x3002;</span><span class="yiyi-st" id="yiyi-482">&#x611F;&#x8C22;<a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3061">&#xFF03;3061</a>&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x533A;&#x5206;&#x4F55;&#x65F6;&#x503C;<code class="docutils literal"><span class="pre">None</span></code>&#x7531;&#x7528;&#x6237;&#x4E3B;&#x52A8;&#x8BBE;&#x7F6E;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x6839;&#x672C;&#x4E0D;&#x8BBE;&#x7F6E;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-483">&#x5982;&#x679C;&#x8BE5;&#x5C5E;&#x6027;&#x6839;&#x672C;&#x6CA1;&#x6709;&#x8BBE;&#x7F6E;&#xFF0C;&#x90A3;&#x4E48;&#x5217;&#x7EA7;&#x522B;&#x7684;&#x9ED8;&#x8BA4;&#x503C;<em>&#x5C06;</em>&#x89E6;&#x53D1;&#x5E76;&#x4E14;/&#x6216;&#x8005;SQL NULL&#x6309;&#x9884;&#x671F;&#x63D2;&#x5165;&#xFF0C;&#x5C31;&#x50CF;&#x4EE5;&#x524D;&#x7684;&#x884C;&#x4E3A;&#x4E00;&#x6837;&#x3002;</span><span class="yiyi-st" id="yiyi-484">&#x4E0B;&#x9762;&#x8BF4;&#x660E;&#x4E24;&#x4E2A;&#x53D8;&#x4F53;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">obj</span> <span class="o">=</span> <span class="n">MyObject</span><span class="p">(</span><span class="n">json_value</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>   <span class="c1"># *will not* fire off column defaults, will insert JSON &apos;null&apos;</span>

<span class="n">obj</span> <span class="o">=</span> <span class="n">MyObject</span><span class="p">()</span>
<span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>   <span class="c1"># *will* fire off column defaults, and/or insert SQL NULL</span></pre></div></div><p><span class="yiyi-st" id="yiyi-485">&#x8BE5;&#x529F;&#x80FD;&#x4E5F;&#x9002;&#x7528;&#x4E8E;&#x65B0;&#x7684;&#x57FA;&#x7840;<a class="reference internal" href="core_type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal"><span class="pre">types.JSON</span></code></a>&#x7C7B;&#x578B;&#x53CA;&#x5176;&#x540E;&#x4EE3;&#x7C7B;&#x578B;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-486"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3514">&#xFF03;3514  T0&gt;</a></span></p></div><div class="section" id="new-json-null-constant-added"><h4><span class="yiyi-st" id="yiyi-487">&#x65B0;&#x7684;JSON.NULL&#x5E38;&#x91CF;&#x5DF2;&#x6DFB;&#x52A0;<a class="headerlink" href="#new-json-null-constant-added" title="Permalink to this headline">&#xB6;</a></span></h4><p><span class="yiyi-st" id="yiyi-488">&#x4E3A;&#x4E86;&#x786E;&#x4FDD;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x59CB;&#x7EC8;&#x80FD;&#x591F;&#x5B8C;&#x5168;&#x63A7;&#x5236;<a class="reference internal" href="core_type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal"><span class="pre">types.JSON</span></code></a>&#xFF0C;<a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.JSON" title="sqlalchemy.dialects.postgresql.JSON"><code class="xref py py-class docutils literal"><span class="pre">postgresql.JSON</span></code></a>&#xFF0C;<a class="reference internal" href="dialects_mysql.html#sqlalchemy.dialects.mysql.JSON" title="sqlalchemy.dialects.mysql.JSON"><code class="xref py py-class docutils literal"><span class="pre">mysql.JSON</span></code></a>&#x7684;&#x503C;&#x7EA7;&#x522B;&#xFF0C;&#x6216;<a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.JSONB" title="sqlalchemy.dialects.postgresql.JSONB"><code class="xref py py-class docutils literal"><span class="pre">postgresql.JSONB</span></code></a>&#x5217;&#x5E94;&#x8BE5;&#x63A5;&#x6536;&#x5230;SQL NULL&#x6216;JSON <code class="docutils literal"><span class="pre">&quot;null&quot;</span></code>&#x503C;&#x65F6;&#xFF0C;&#x5E38;&#x91CF;<a class="reference internal" href="core_type_basics.html#sqlalchemy.types.JSON.NULL" title="sqlalchemy.types.JSON.NULL"><code class="xref py py-attr docutils literal"><span class="pre">types.JSON.NULL</span></code></a>&#x5DF2;&#x88AB;&#x6DFB;&#x52A0;&#xFF0C;&#x4E0E;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.null" title="sqlalchemy.sql.expression.null"><code class="xref py py-func docutils literal"><span class="pre">null()</span></code></a>&#x7ED3;&#x5408;&#x4F7F;&#x7528;&#x53EF;&#x4EE5;&#x5B8C;&#x5168;&#x786E;&#x5B9A;SQL NULL&#x548C;JSON <code class="docutils literal"><span class="pre">&quot;null&quot;</span></code>&#x4E4B;&#x95F4;&#x7684;&#x5173;&#x7CFB;&#xFF0C;&#x65E0;&#x8BBA;<a class="reference internal" href="core_type_basics.html#sqlalchemy.types.JSON.params.none_as_null" title="sqlalchemy.types.JSON"><code class="xref py py-paramref docutils literal"><span class="pre">types.JSON.none_as_null</span></code></a>&#x88AB;&#x8BBE;&#x5B9A;&#x4E3A;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">null</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.dialects.postgresql</span> <span class="kn">import</span> <span class="n">JSON</span>

<span class="n">obj1</span> <span class="o">=</span> <span class="n">MyObject</span><span class="p">(</span><span class="n">json_value</span><span class="o">=</span><span class="n">null</span><span class="p">())</span>  <span class="c1"># will *always* insert SQL NULL</span>
<span class="n">obj2</span> <span class="o">=</span> <span class="n">MyObject</span><span class="p">(</span><span class="n">json_value</span><span class="o">=</span><span class="n">JSON</span><span class="o">.</span><span class="n">NULL</span><span class="p">)</span>  <span class="c1"># will *always* insert JSON string &quot;null&quot;</span>

<span class="n">session</span><span class="o">.</span><span class="n">add_all</span><span class="p">([</span><span class="n">obj1</span><span class="p">,</span> <span class="n">obj2</span><span class="p">])</span>
<span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></pre></div></div><p><span class="yiyi-st" id="yiyi-489">&#x8BE5;&#x529F;&#x80FD;&#x4E5F;&#x9002;&#x7528;&#x4E8E;&#x65B0;&#x7684;&#x57FA;&#x7840;<a class="reference internal" href="core_type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal"><span class="pre">types.JSON</span></code></a>&#x7C7B;&#x578B;&#x53CA;&#x5176;&#x540E;&#x4EE3;&#x7C7B;&#x578B;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-490"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3514">&#xFF03;3514  T0&gt;</a></span></p></div></div><div class="section" id="array-support-added-to-core-new-any-and-all-operators"><h3><span class="yiyi-st" id="yiyi-491">&#x9635;&#x5217;&#x652F;&#x6301;&#x6DFB;&#x52A0;&#x5230;&#x6838;&#x5FC3;&#xFF1B;&#x65B0;&#x7684;ANY&#x548C;&#x6240;&#x6709;&#x8FD0;&#x7B97;&#x7B26;<a class="headerlink" href="#array-support-added-to-core-new-any-and-all-operators" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-492">Along with the enhancements made to the Postgresql <a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.ARRAY" title="sqlalchemy.dialects.postgresql.ARRAY"><code class="xref py py-class docutils literal"><span class="pre">postgresql.ARRAY</span></code></a> type described in <a class="reference internal" href="#change-3503"><span>Correct SQL Types are Established from Indexed Access of ARRAY, JSON, HSTORE</span></a>, the base class of <a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.ARRAY" title="sqlalchemy.dialects.postgresql.ARRAY"><code class="xref py py-class docutils literal"><span class="pre">postgresql.ARRAY</span></code></a> itself has been moved to Core in a new class <a class="reference internal" href="core_type_basics.html#sqlalchemy.types.ARRAY" title="sqlalchemy.types.ARRAY"><code class="xref py py-class docutils literal"><span class="pre">types.ARRAY</span></code></a>.</span></p><p><span class="yiyi-st" id="yiyi-493">&#x6570;&#x7EC4;&#x662F;SQL&#x6807;&#x51C6;&#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x4E5F;&#x6709;&#x51E0;&#x4E2A;&#x9762;&#x5411;&#x6570;&#x7EC4;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x5982;<code class="docutils literal"><span class="pre">array_agg()</span></code>&#x548C;<code class="docutils literal"><span class="pre">unnest()</span></code>&#x3002;</span><span class="yiyi-st" id="yiyi-494">&#x4E3A;&#x4E86;&#x652F;&#x6301;&#x8FD9;&#x4E9B;&#x7ED3;&#x6784;&#x4E0D;&#x4EC5;&#x9002;&#x7528;&#x4E8E;PostgreSQL&#xFF0C;&#x800C;&#x4E14;&#x8FD8;&#x9002;&#x7528;&#x4E8E;&#x672A;&#x6765;&#x5176;&#x4ED6;&#x5177;&#x6709;&#x9635;&#x5217;&#x80FD;&#x529B;&#x7684;&#x540E;&#x7AEF;&#xFF0C;&#x4F8B;&#x5982;DB2&#xFF0C;SQL&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x5927;&#x90E8;&#x5206;&#x6570;&#x7EC4;&#x903B;&#x8F91;&#x73B0;&#x5728;&#x4F4D;&#x4E8E;Core&#x4E2D;&#x3002;</span><span class="yiyi-st" id="yiyi-495"><a class="reference internal" href="core_type_basics.html#sqlalchemy.types.ARRAY" title="sqlalchemy.types.ARRAY"><code class="xref py py-class docutils literal"><span class="pre">types.ARRAY</span></code></a>&#x7C7B;&#x578B;still <strong>&#x4EC5;&#x9002;&#x7528;&#x4E8E;Postgresql</strong>&#xFF0C;&#x4F46;&#x5B83;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#xFF0C;&#x652F;&#x6301;&#x7279;&#x6B8A;&#x7684;&#x6570;&#x7EC4;&#x7528;&#x4F8B;&#xFF0C;&#x4F8B;&#x5982;&#x7D22;&#x5F15;&#x8BBF;&#x95EE;&#xFF0C;&#x4EE5;&#x53CA;&#x652F;&#x6301;ANY&#x548C;&#x6240;&#x6709;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">mytable</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s2">&quot;mytable&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
        <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">ARRAY</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
    <span class="p">)</span>

<span class="n">expr</span> <span class="o">=</span> <span class="n">mytable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span>

<span class="n">expr</span> <span class="o">=</span> <span class="n">mytable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-496">In support of ANY and ALL, the <a class="reference internal" href="core_type_basics.html#sqlalchemy.types.ARRAY" title="sqlalchemy.types.ARRAY"><code class="xref py py-class docutils literal"><span class="pre">types.ARRAY</span></code></a> type retains the same <a class="reference internal" href="core_type_basics.html#sqlalchemy.types.ARRAY.Comparator.any" title="sqlalchemy.types.ARRAY.Comparator.any"><code class="xref py py-meth docutils literal"><span class="pre">types.ARRAY.Comparator.any()</span></code></a> and <a class="reference internal" href="core_type_basics.html#sqlalchemy.types.ARRAY.Comparator.all" title="sqlalchemy.types.ARRAY.Comparator.all"><code class="xref py py-meth docutils literal"><span class="pre">types.ARRAY.Comparator.all()</span></code></a> methods from the PostgreSQL type, but also exports these operations to new standalone operator functions <a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.any_" title="sqlalchemy.sql.expression.any_"><code class="xref py py-func docutils literal"><span class="pre">sql.expression.any_()</span></code></a> and <a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.all_" title="sqlalchemy.sql.expression.all_"><code class="xref py py-func docutils literal"><span class="pre">sql.expression.all_()</span></code></a>. </span><span class="yiyi-st" id="yiyi-497">&#x8FD9;&#x4E24;&#x4E2A;&#x51FD;&#x6570;&#x4EE5;&#x66F4;&#x4F20;&#x7EDF;&#x7684;SQL&#x65B9;&#x5F0F;&#x5DE5;&#x4F5C;&#xFF0C;&#x5141;&#x8BB8;&#x4F7F;&#x7528;&#x53F3;&#x4FA7;&#x8868;&#x8FBE;&#x5F62;&#x5F0F;&#xFF0C;&#x5982;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">any_</span><span class="p">,</span> <span class="n">all_</span>

<span class="n">select</span><span class="p">([</span><span class="n">mytable</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="mi">12</span> <span class="o">==</span> <span class="n">any_</span><span class="p">(</span><span class="n">mytable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-498">&#x5BF9;&#x4E8E;&#x7279;&#x5B9A;&#x4E8E;PostgreSQL&#x7684;&#x8FD0;&#x7B97;&#x7B26;&#x201C;contains&#x201D;&#xFF0C;&#x201C;contained_by&#x201D;&#x548C;&#x201C;overlapps&#x201D;&#xFF0C;&#x5E94;&#x8BE5;&#x7EE7;&#x7EED;&#x76F4;&#x63A5;&#x4F7F;&#x7528;<a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.ARRAY" title="sqlalchemy.dialects.postgresql.ARRAY"><code class="xref py py-class docutils literal"><span class="pre">postgresql.ARRAY</span></code></a>&#x7C7B;&#x578B;&#xFF0C;&#x5B83;&#x63D0;&#x4F9B;&#x4E86;<a class="reference internal" href="core_type_basics.html#sqlalchemy.types.ARRAY" title="sqlalchemy.types.ARRAY"><code class="xref py py-class docutils literal"><span class="pre">types.ARRAY</span></code></a>&#x7C7B;&#x578B;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-499"><a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.any_" title="sqlalchemy.sql.expression.any_"><code class="xref py py-func docutils literal"><span class="pre">sql.expression.any_()</span></code></a>&#x548C;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.all_" title="sqlalchemy.sql.expression.all_"><code class="xref py py-func docutils literal"><span class="pre">sql.expression.all_()</span></code></a>&#x8FD0;&#x7B97;&#x7B26;&#x5728;Core&#x7EA7;&#x522B;&#x662F;&#x5F00;&#x653E;&#x5F0F;&#x7684;&#xFF0C;&#x4F46;&#x662F;&#x5B83;&#x4EEC;&#x5BF9;&#x540E;&#x7AEF;&#x6570;&#x636E;&#x5E93;&#x7684;&#x89E3;&#x91CA;&#x662F;&#x6709;&#x9650;&#x7684;&#x3002;</span><span class="yiyi-st" id="yiyi-500">&#x5728;Postgresql&#x540E;&#x7AEF;&#xFF0C;&#x4E24;&#x4E2A;&#x8FD0;&#x7B97;&#x7B26;<strong>&#x53EA;&#x63A5;&#x53D7;&#x6570;&#x7EC4;&#x503C;</strong>&#x3002;</span><span class="yiyi-st" id="yiyi-501">&#x800C;&#x5728;MySQL&#x540E;&#x7AEF;&#xFF0C;&#x5B83;&#x4EEC;<strong>&#x53EA;&#x63A5;&#x53D7;&#x5B50;&#x67E5;&#x8BE2;&#x503C;</strong>&#x3002;</span><span class="yiyi-st" id="yiyi-502">&#x5728;MySQL&#x4E0A;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5982;&#x4E0B;&#x8868;&#x8FBE;&#x5F0F;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">any_</span><span class="p">,</span> <span class="n">all_</span>

<span class="n">subq</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">mytable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">value</span><span class="p">])</span>
<span class="n">select</span><span class="p">([</span><span class="n">mytable</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="mi">12</span> <span class="o">&gt;</span> <span class="n">any_</span><span class="p">(</span><span class="n">subq</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-503"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3516">&#xFF03;3516  T0&gt;</a></span></p></div><div class="section" id="new-function-features-within-group-array-agg-and-set-aggregate-functions"><h3><span class="yiyi-st" id="yiyi-504">&#x65B0;&#x51FD;&#x6570;&#x529F;&#x80FD;&#xFF0C;&#x201C;WITHIN GROUP&#x201D;&#xFF0C;array_agg&#x548C;&#x96C6;&#x5408;&#x51FD;&#x6570;<a class="headerlink" href="#new-function-features-within-group-array-agg-and-set-aggregate-functions" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-505">&#x4F7F;&#x7528;&#x65B0;&#x7684;<a class="reference internal" href="core_type_basics.html#sqlalchemy.types.ARRAY" title="sqlalchemy.types.ARRAY"><code class="xref py py-class docutils literal"><span class="pre">types.ARRAY</span></code></a>&#x7C7B;&#x578B;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x4E3A;&#x8FD4;&#x56DE;&#x6570;&#x7EC4;&#x7684;<code class="docutils literal"><span class="pre">array_agg()</span></code> SQL&#x51FD;&#x6570;&#x5B9E;&#x73B0;&#x9884;&#x5148;&#x952E;&#x5165;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x8BE5;&#x51FD;&#x6570;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<a class="reference internal" href="core_functions.html#sqlalchemy.sql.functions.array_agg" title="sqlalchemy.sql.functions.array_agg"><code class="xref py py-class docutils literal"><span class="pre">array_agg</span></code></a></span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">func</span>
<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">func</span><span class="o">.</span><span class="n">array_agg</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">value</span><span class="p">)])</span></pre></div></div><p><span class="yiyi-st" id="yiyi-506">&#x7528;&#x4E8E;&#x805A;&#x5408;ORDER BY&#x7684;Postgresql&#x5143;&#x7D20;&#x4E5F;&#x901A;&#x8FC7;<a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.aggregate_order_by" title="sqlalchemy.dialects.postgresql.aggregate_order_by"><code class="xref py py-class docutils literal"><span class="pre">postgresql.aggregate_order_by</span></code></a>&#x6DFB;&#x52A0;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.dialects.postgresql</span> <span class="kn">import</span> <span class="n">aggregate_order_by</span>
<span class="n">expr</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">array_agg</span><span class="p">(</span><span class="n">aggregate_order_by</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">desc</span><span class="p">()))</span>
<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">expr</span><span class="p">])</span></pre></div></div><p><span class="yiyi-st" id="yiyi-507">&#x751F;&#x4EA7;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT array_agg(table1.a ORDER BY table1.b DESC) AS array_agg_1 FROM table1</pre></div></div><p><span class="yiyi-st" id="yiyi-508">PG&#x65B9;&#x8A00;&#x672C;&#x8EAB;&#x4E5F;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;<a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.array_agg" title="sqlalchemy.dialects.postgresql.array_agg"><code class="xref py py-func docutils literal"><span class="pre">postgresql.array_agg()</span></code></a>&#x5305;&#x88C5;&#x6765;&#x786E;&#x4FDD;<a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.ARRAY" title="sqlalchemy.dialects.postgresql.ARRAY"><code class="xref py py-class docutils literal"><span class="pre">postgresql.ARRAY</span></code></a>&#x7C7B;&#x578B;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.dialects.postgresql</span> <span class="kn">import</span> <span class="n">array_agg</span>
<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">array_agg</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&apos;foo&apos;</span><span class="p">)])</span></pre></div></div><p><span class="yiyi-st" id="yiyi-509">Additionally, functions like <code class="docutils literal"><span class="pre">percentile_cont()</span></code>, <code class="docutils literal"><span class="pre">percentile_disc()</span></code>, <code class="docutils literal"><span class="pre">rank()</span></code>, <code class="docutils literal"><span class="pre">dense_rank()</span></code> and others that require an ordering via <code class="docutils literal"><span class="pre">WITHIN</span> <span class="pre">GROUP</span> <span class="pre">(ORDER</span> <span class="pre">BY</span> <span class="pre">&lt;expr&gt;)</span></code> are now available via the <a class="reference internal" href="core_functions.html#sqlalchemy.sql.functions.FunctionElement.within_group" title="sqlalchemy.sql.functions.FunctionElement.within_group"><code class="xref py py-meth docutils literal"><span class="pre">FunctionElement.within_group()</span></code></a> modifier:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">func</span>
<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span>
    <span class="n">department</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
    <span class="n">func</span><span class="o">.</span><span class="n">percentile_cont</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">within_group</span><span class="p">(</span>
        <span class="n">department</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">salary</span><span class="o">.</span><span class="n">desc</span><span class="p">()</span>
    <span class="p">)</span>
<span class="p">])</span></pre></div></div><p><span class="yiyi-st" id="yiyi-510">&#x4E0A;&#x9762;&#x7684;&#x8BED;&#x53E5;&#x4F1A;&#x4EA7;&#x751F;SQL&#x7C7B;&#x4F3C;&#x4E8E;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT department.id, percentile_cont(0.5)
WITHIN GROUP (ORDER BY department.salary DESC)</pre></div></div><p><span class="yiyi-st" id="yiyi-511">&#x73B0;&#x5728;&#x4E3A;&#x8FD9;&#x4E9B;&#x51FD;&#x6570;&#x63D0;&#x4F9B;&#x4E86;&#x6B63;&#x786E;&#x8FD4;&#x56DE;&#x7C7B;&#x578B;&#x7684;&#x5360;&#x4F4D;&#x7B26;&#xFF0C;&#x5B83;&#x4EEC;&#x5305;&#x62EC;<a class="reference internal" href="core_functions.html#sqlalchemy.sql.functions.percentile_cont" title="sqlalchemy.sql.functions.percentile_cont"><code class="xref py py-class docutils literal"><span class="pre">percentile_cont</span></code></a>&#xFF0C;<a class="reference internal" href="core_functions.html#sqlalchemy.sql.functions.percentile_disc" title="sqlalchemy.sql.functions.percentile_disc"><code class="xref py py-class docutils literal"><span class="pre">percentile_disc</span></code></a>&#xFF0C;<a class="reference internal" href="core_functions.html#sqlalchemy.sql.functions.rank" title="sqlalchemy.sql.functions.rank"><code class="xref py py-class docutils literal"><span class="pre">rank</span></code></a>&#xFF0C;<a class="reference internal" href="core_functions.html#sqlalchemy.sql.functions.dense_rank" title="sqlalchemy.sql.functions.dense_rank"><code class="xref py py-class docutils literal"><span class="pre">dense_rank</span></code></a> <a class="reference internal" href="core_functions.html#sqlalchemy.sql.functions.mode" title="sqlalchemy.sql.functions.mode"><code class="xref py py-class docutils literal"><span class="pre">mode</span></code></a>&#xFF0C;<a class="reference internal" href="core_functions.html#sqlalchemy.sql.functions.percent_rank" title="sqlalchemy.sql.functions.percent_rank"><code class="xref py py-class docutils literal"><span class="pre">percent_rank</span></code></a>&#x548C;<a class="reference internal" href="core_functions.html#sqlalchemy.sql.functions.cume_dist" title="sqlalchemy.sql.functions.cume_dist"><code class="xref py py-class docutils literal"><span class="pre">cume_dist</span></code></a>&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-512"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3132">&#xFF03;3132</a> <a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/1370">&#xFF03;1370</a></span></p></div><div class="section" id="typedecorator-now-works-with-enum-boolean-schema-types-automatically"><h3><span class="yiyi-st" id="yiyi-513">TypeDecorator&#x73B0;&#x5728;&#x81EA;&#x52A8;&#x4F7F;&#x7528;Enum&#xFF0C;Boolean&#x548C;&#x201C;&#x6A21;&#x5F0F;&#x201D;&#x7C7B;&#x578B;<a class="headerlink" href="#typedecorator-now-works-with-enum-boolean-schema-types-automatically" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-514"><a class="reference internal" href="core_type_basics.html#sqlalchemy.types.SchemaType" title="sqlalchemy.types.SchemaType"><code class="xref py py-class docutils literal"><span class="pre">SchemaType</span></code></a>&#x7C7B;&#x578B;&#x5305;&#x62EC;<a class="reference internal" href="core_type_basics.html#sqlalchemy.types.Enum" title="sqlalchemy.types.Enum"><code class="xref py py-class docutils literal"><span class="pre">Enum</span></code></a>&#x548C;<a class="reference internal" href="core_type_basics.html#sqlalchemy.types.Boolean" title="sqlalchemy.types.Boolean"><code class="xref py py-class docutils literal"><span class="pre">Boolean</span></code></a>&#x7B49;&#x7C7B;&#x578B;&#xFF0C;&#x9664;&#x4E86;&#x4E0E;&#x6570;&#x636E;&#x5E93;&#x7C7B;&#x578B;&#x76F8;&#x5BF9;&#x5E94;&#x5916;&#xFF0C;&#x8FD8;&#x4F1A;&#x751F;&#x6210;CHECK&#x7EA6;&#x675F;&#x6216;Postgresql ENUM&#x4E00;&#x4E2A;&#x65B0;&#x7684;CREATE TYPE&#x8BED;&#x53E5;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x73B0;&#x5728;&#x5C06;&#x81EA;&#x52A8;&#x4E0E;<a class="reference internal" href="core_custom_types.html#sqlalchemy.types.TypeDecorator" title="sqlalchemy.types.TypeDecorator"><code class="xref py py-class docutils literal"><span class="pre">TypeDecorator</span></code></a>&#x914D;&#x65B9;&#x4E00;&#x8D77;&#x5DE5;&#x4F5C;&#x3002;</span><span class="yiyi-st" id="yiyi-515">&#x4EE5;&#x524D;&#xFF0C;<a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.ENUM" title="sqlalchemy.dialects.postgresql.ENUM"><code class="xref py py-class docutils literal"><span class="pre">postgresql.ENUM</span></code></a>&#x7684;<a class="reference internal" href="core_custom_types.html#sqlalchemy.types.TypeDecorator" title="sqlalchemy.types.TypeDecorator"><code class="xref py py-class docutils literal"><span class="pre">TypeDecorator</span></code></a>&#x5FC5;&#x987B;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># old way</span>
<span class="k">class</span> <span class="nc">MyEnum</span><span class="p">(</span><span class="n">TypeDecorator</span><span class="p">,</span> <span class="n">SchemaType</span><span class="p">):</span>
    <span class="n">impl</span> <span class="o">=</span> <span class="n">postgresql</span><span class="o">.</span><span class="n">ENUM</span><span class="p">(</span><span class="s1">&apos;one&apos;</span><span class="p">,</span> <span class="s1">&apos;two&apos;</span><span class="p">,</span> <span class="s1">&apos;three&apos;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&apos;myenum&apos;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">impl</span><span class="o">.</span><span class="n">_set_table</span><span class="p">(</span><span class="n">table</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-516">&#x73B0;&#x5728;&#xFF0C;<a class="reference internal" href="core_custom_types.html#sqlalchemy.types.TypeDecorator" title="sqlalchemy.types.TypeDecorator"><code class="xref py py-class docutils literal"><span class="pre">TypeDecorator</span></code></a>&#x4F20;&#x64AD;&#x8FD9;&#x4E9B;&#x9644;&#x52A0;&#x4E8B;&#x4EF6;&#xFF0C;&#x56E0;&#x6B64;&#x53EF;&#x4EE5;&#x50CF;&#x5176;&#x4ED6;&#x7C7B;&#x578B;&#x90A3;&#x6837;&#x5B8C;&#x6210;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># new way</span>
<span class="k">class</span> <span class="nc">MyEnum</span><span class="p">(</span><span class="n">TypeDecorator</span><span class="p">):</span>
    <span class="n">impl</span> <span class="o">=</span> <span class="n">postgresql</span><span class="o">.</span><span class="n">ENUM</span><span class="p">(</span><span class="s1">&apos;one&apos;</span><span class="p">,</span> <span class="s1">&apos;two&apos;</span><span class="p">,</span> <span class="s1">&apos;three&apos;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&apos;myenum&apos;</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-517"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2919">&#xFF03;2919  T0&gt;</a></span></p></div><div class="section" id="multi-tenancy-schema-translation-for-table-objects"><h3><span class="yiyi-st" id="yiyi-518">&#x8868;&#x5BF9;&#x8C61;&#x7684;&#x591A;&#x79DF;&#x6237;&#x6A21;&#x5F0F;&#x8F6C;&#x6362;<a class="headerlink" href="#multi-tenancy-schema-translation-for-table-objects" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-519">&#x4E3A;&#x4E86;&#x652F;&#x6301;&#x5728;&#x8BB8;&#x591A;&#x6A21;&#x5F0F;&#x4E2D;&#x4F7F;&#x7528;&#x540C;&#x4E00;&#x7EC4;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal"><span class="pre">Table</span></code></a>&#x5BF9;&#x8C61;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x7528;&#x4F8B;&#xFF0C;&#x4F8B;&#x5982;schema-per-user&#xFF0C;&#x65B0;&#x7684;&#x6267;&#x884C;&#x9009;&#x9879;<a class="reference internal" href="core_connections.html#sqlalchemy.engine.Connection.execution_options.params.schema_translate_map" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal"><span class="pre">Connection.execution_options.schema_translate_map</span></code></a></span><span class="yiyi-st" id="yiyi-520">&#x4F7F;&#x7528;&#x8FD9;&#x79CD;&#x6620;&#x5C04;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x6BCF;&#x4E2A;&#x8FDE;&#x63A5;&#x7684;&#x57FA;&#x7840;&#x4E0A;&#x521B;&#x5EFA;&#x4E00;&#x7EC4;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal"><span class="pre">Table</span></code></a>&#x5BF9;&#x8C61;&#x6765;&#x5F15;&#x7528;&#x4EFB;&#x4F55;&#x4E00;&#x7EC4;&#x6A21;&#x5F0F;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x6307;&#x5B9A;&#x5B83;&#x4EEC;&#x7684;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Table.params.schema" title="sqlalchemy.schema.Table"><code class="xref py py-paramref docutils literal"><span class="pre">Table.schema</span></code></a> &#x3002;</span><span class="yiyi-st" id="yiyi-521">&#x8BE5;&#x7FFB;&#x8BD1;&#x9002;&#x7528;&#x4E8E;DDL&#x548C;SQL&#x751F;&#x6210;&#x4EE5;&#x53CA;ORM&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-522">&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;<code class="docutils literal"><span class="pre">User</span></code>&#x7C7B;&#x5206;&#x914D;&#x4E86;&#x67B6;&#x6784;&#x201C;per_user&#x201D;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;user&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">__table_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&apos;schema&apos;</span><span class="p">:</span> <span class="s1">&apos;per_user&apos;</span><span class="p">}</span></pre></div></div><p><span class="yiyi-st" id="yiyi-523">&#x5728;&#x6BCF;&#x6B21;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;<a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x4E3A;&#x6BCF;&#x6B21;&#x5F15;&#x7528;&#x4E0D;&#x540C;&#x7684;&#x6A21;&#x5F0F;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>
<span class="n">session</span><span class="o">.</span><span class="n">connection</span><span class="p">(</span><span class="n">execution_options</span><span class="o">=</span><span class="p">{</span>
    <span class="s2">&quot;schema_translate_map&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;per_user&quot;</span><span class="p">:</span> <span class="s2">&quot;account_one&quot;</span><span class="p">}})</span>

<span class="c1"># will query from the ``account_one.user`` table</span>
<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span></pre></div></div><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-524">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-525"><a class="reference internal" href="core_connections.html#schema-translating"><span>Translation of Schema Names</span></a></span></p></div><p><span class="yiyi-st" id="yiyi-526"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2685">&#xFF03;2685  T0&gt;</a></span></p></div><div class="section" id="friendly-stringification-of-core-sql-constructs-without-a-dialect"><h3><span class="yiyi-st" id="yiyi-527">&#x201C;&#x53CB;&#x597D;&#x201D;&#x7684;&#x6838;&#x5FC3;SQL&#x7ED3;&#x6784;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x5316;&#xFF0C;&#x6CA1;&#x6709;&#x65B9;&#x8A00;<a class="headerlink" href="#friendly-stringification-of-core-sql-constructs-without-a-dialect" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-528">&#x5728;Core SQL&#x6784;&#x9020;&#x4E0A;&#x8C03;&#x7528;<code class="docutils literal"><span class="pre">str()</span></code>&#x73B0;&#x5728;&#x4F1A;&#x5728;&#x6BD4;&#x4EE5;&#x524D;&#x66F4;&#x591A;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x652F;&#x6301;&#x9ED8;&#x8BA4;SQL&#x4E2D;&#x901A;&#x5E38;&#x4E0D;&#x5B58;&#x5728;&#x7684;&#x5404;&#x79CD;SQL&#x6784;&#x9020;&#xFF0C;&#x4F8B;&#x5982;RETURNING&#xFF0C;&#x6570;&#x7EC4;&#x7D22;&#x5F15;&#x548C;&#x975E;&#x6807;&#x51C6;&#x6570;&#x636E;&#x7C7B;&#x578B;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">table</span><span class="p">,</span> <span class="n">column</span>
<span class="go">t&gt;&gt;&gt; t = table(&apos;x&apos;, column(&apos;a&apos;), column(&apos;b&apos;))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">insert</span><span class="p">()</span><span class="o">.</span><span class="n">returning</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">b</span><span class="p">))</span>
<span class="go">INSERT INTO x (a, b) VALUES (:a, :b) RETURNING x.a, x.b</span></pre></div></div><p><span class="yiyi-st" id="yiyi-529">&#x73B0;&#x5728;&#xFF0C;<code class="docutils literal"><span class="pre">str()</span></code>&#x51FD;&#x6570;&#x8C03;&#x7528;&#x4E00;&#x4E2A;&#x5B8C;&#x5168;&#x72EC;&#x7ACB;&#x7684;&#x65B9;&#x8A00;/&#x7F16;&#x8BD1;&#x5668;&#xFF0C;&#x4EC5;&#x7528;&#x4E8E;&#x7EAF;&#x5B57;&#x7B26;&#x4E32;&#x6253;&#x5370;&#x800C;&#x4E0D;&#x8BBE;&#x7F6E;&#x7279;&#x5B9A;&#x7684;&#x65B9;&#x8A00;&#xFF0C;&#x56E0;&#x6B64;&#x66F4;&#x591A;&#x7684;&#x201C;&#x53EA;&#x663E;&#x793A;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#xFF01;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x5230;&#x8FD9;&#x4E2A;&#x65B9;&#x8A00;/&#x7F16;&#x8BD1;&#x5668;&#xFF0C;&#x800C;&#x4E0D;&#x4F1A;&#x5F71;&#x54CD;&#x771F;&#x6B63;&#x65B9;&#x8A00;&#x7684;&#x884C;&#x4E3A;&#x3002;</span></p><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-530">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-531"><a class="reference internal" href="#change-3081"><span>Stringify of Query will consult the Session for the correct dialect</span></a></span></p></div><p><span class="yiyi-st" id="yiyi-532"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3631">&#xFF03;3631  T0&gt;</a></span></p></div><div class="section" id="the-type-coerce-function-is-now-a-persistent-sql-element"><h3><span class="yiyi-st" id="yiyi-533">type_coerce&#x51FD;&#x6570;&#x73B0;&#x5728;&#x662F;&#x4E00;&#x4E2A;&#x6301;&#x4E45;&#x5316;&#x7684;SQL&#x5143;&#x7D20;<a class="headerlink" href="#the-type-coerce-function-is-now-a-persistent-sql-element" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-534">&#x6839;&#x636E;&#x8F93;&#x5165;&#xFF0C;&#x4EE5;&#x524D;&#x7684;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.type_coerce" title="sqlalchemy.sql.expression.type_coerce"><code class="xref py py-func docutils literal"><span class="pre">expression.type_coerce()</span></code></a>&#x51FD;&#x6570;&#x4F1A;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x7C7B;&#x578B;&#x4E3A;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.BindParameter" title="sqlalchemy.sql.expression.BindParameter"><code class="xref py py-class docutils literal"><span class="pre">BindParameter</span></code></a>&#x6216;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.Label" title="sqlalchemy.sql.expression.Label"><code class="xref py py-class docutils literal"><span class="pre">Label</span></code></a>&#x7684;&#x5BF9;&#x8C61;&#x3002;</span><span class="yiyi-st" id="yiyi-535">&#x8FD9;&#x5C06;&#x4F1A;&#x4EA7;&#x751F;&#x7684;&#x6548;&#x679C;&#x662F;&#xFF0C;&#x5728;&#x4F7F;&#x7528;&#x8868;&#x8FBE;&#x5F0F;&#x8F6C;&#x6362;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4F8B;&#x5982;&#x5C06;&#x5143;&#x7D20;&#x4ECE;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a>&#x8F6C;&#x6362;&#x4E3A;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.BindParameter" title="sqlalchemy.sql.expression.BindParameter"><code class="xref py py-class docutils literal"><span class="pre">BindParameter</span></code></a>&#xFF0C;&#x8FD9;&#x5BF9;&#x4E8E;ORM&#x7EA7;&#x61D2;&#x60F0;&#x81F3;&#x5173;&#x91CD;&#x8981;&#x52A0;&#x8F7D;&#x65F6;&#xFF0C;&#x7C7B;&#x578B;&#x5F3A;&#x5236;&#x4FE1;&#x606F;&#x5C06;&#x4E0D;&#x4F1A;&#x88AB;&#x4F7F;&#x7528;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x5DF2;&#x7ECF;&#x4E22;&#x5931;&#x4E86;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-536">&#x4E3A;&#x4E86;&#x6539;&#x5584;&#x8FD9;&#x79CD;&#x884C;&#x4E3A;&#xFF0C;&#x51FD;&#x6570;&#x73B0;&#x5728;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x6301;&#x7EED;&#x7684;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.TypeCoerce" title="sqlalchemy.sql.expression.TypeCoerce"><code class="xref py py-class docutils literal"><span class="pre">TypeCoerce</span></code></a>&#x5BB9;&#x5668;&#xFF0C;&#x8BE5;&#x5BB9;&#x5668;&#x56F4;&#x7ED5;&#x7ED9;&#x5B9A;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x5B83;&#x672C;&#x8EAB;&#x4E0D;&#x53D7;&#x5F71;&#x54CD;&#xFF1B;&#x6B64;&#x6784;&#x9020;&#x7531;SQL&#x7F16;&#x8BD1;&#x5668;&#x660E;&#x786E;&#x8BC4;&#x4F30;&#x3002;</span><span class="yiyi-st" id="yiyi-537">&#x8FD9;&#x5141;&#x8BB8;&#x4FDD;&#x6301;&#x5185;&#x90E8;&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x5F3A;&#x5236;&#xFF0C;&#x800C;&#x4E0D;&#x7BA1;&#x8BED;&#x53E5;&#x5982;&#x4F55;&#x88AB;&#x4FEE;&#x6539;&#xFF0C;&#x5305;&#x62EC;&#x5982;&#x679C;&#x5305;&#x542B;&#x7684;&#x5143;&#x7D20;&#x88AB;&#x66FF;&#x6362;&#x4E3A;&#x4E0D;&#x540C;&#x7684;&#x5143;&#x7D20;&#xFF0C;&#x5C31;&#x50CF;ORM&#x7684;&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x7279;&#x6027;&#x4E2D;&#x5E38;&#x89C1;&#x7684;&#x90A3;&#x6837;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-538">&#x8BF4;&#x660E;&#x8BE5;&#x6548;&#x679C;&#x7684;&#x6D4B;&#x8BD5;&#x7528;&#x4F8B;&#x4F7F;&#x7528;&#x4E86;&#x4E00;&#x79CD;&#x5F02;&#x6784;&#x7684;primaryjoin&#x6761;&#x4EF6;&#xFF0C;&#x5E76;&#x7ED3;&#x5408;&#x81EA;&#x5B9A;&#x4E49;&#x7C7B;&#x578B;&#x548C;&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x3002;</span><span class="yiyi-st" id="yiyi-539">&#x7ED9;&#x5B9A;&#x4E00;&#x4E2A;&#x5C06;CAST&#x7528;&#x4F5C;&#x201C;&#x7ED1;&#x5B9A;&#x8868;&#x8FBE;&#x5F0F;&#x201D;&#x7684;&#x81EA;&#x5B9A;&#x4E49;&#x7C7B;&#x578B;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">StringAsInt</span><span class="p">(</span><span class="n">TypeDecorator</span><span class="p">):</span>
    <span class="n">impl</span> <span class="o">=</span> <span class="n">String</span>

    <span class="k">def</span> <span class="nf">column_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">Integer</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">bind_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">String</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-540">&#x7136;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x4E00;&#x4E2A;&#x8868;&#x4E0A;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x201C;id&#x201D;&#x5217;&#x4E0E;&#x53E6;&#x4E00;&#x4E2A;&#x8868;&#x4E0A;&#x7684;&#x6574;&#x6570;&#x201C;id&#x201D;&#x5217;&#x76F8;&#x7B49;&#x7684;&#x6620;&#x5C04;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;person&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">StringAsInt</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">pets</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span>
        <span class="s1">&apos;Pets&apos;</span><span class="p">,</span>
        <span class="n">primaryjoin</span><span class="o">=</span><span class="p">(</span>
            <span class="s1">&apos;foreign(Pets.person_id)&apos;</span>
            <span class="s1">&apos;==cast(type_coerce(Person.id, Integer), Integer)&apos;</span>
        <span class="p">)</span>
    <span class="p">)</span>

<span class="k">class</span> <span class="nc">Pets</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;pets&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;id&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">person_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;person_id&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-541">&#x5728;<a class="reference internal" href="orm_relationship_api.html#sqlalchemy.orm.relationship.params.primaryjoin" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">relationship.primaryjoin</span></code></a>&#x8868;&#x8FBE;&#x5F0F;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.type_coerce" title="sqlalchemy.sql.expression.type_coerce"><code class="xref py py-func docutils literal"><span class="pre">type_coerce()</span></code></a>&#x6765;&#x5904;&#x7406;&#x901A;&#x8FC7;lazyloading&#x4F20;&#x9012;&#x7684;&#x7ED1;&#x5B9A;&#x53C2;&#x6570;&#x4F5C;&#x4E3A;&#x6574;&#x6570;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x77E5;&#x9053;&#x8FD9;&#x4E9B;&#x53C2;&#x6570;&#x5C06;&#x6765;&#x81EA;<code class="docutils literal"><span class="pre">StringAsInt</span></code>&#x7C7B;&#x578B;&#xFF0C;&#x5B83;&#x5728;Python&#x4E2D;&#x5C06;&#x503C;&#x4FDD;&#x6301;&#x4E3A;&#x6574;&#x6570;&#x3002;</span><span class="yiyi-st" id="yiyi-542">&#x7136;&#x540E;&#x6211;&#x4EEC;&#x4F7F;&#x7528;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.cast" title="sqlalchemy.sql.expression.cast"><code class="xref py py-func docutils literal"><span class="pre">cast()</span></code></a>&#xFF0C;&#x56E0;&#x6B64;&#x4F5C;&#x4E3A;SQL&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;VARCHAR&#x201C;id&#x201D;&#x5217;&#x5C06;&#x88AB;CAST&#x4E3A;&#x5E38;&#x89C4;&#x672A;&#x8F6C;&#x6362;&#x8FDE;&#x63A5;&#x7684;&#x6574;&#x6570;&#xFF0C;&#x5982;&#x540C;<a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query.join" title="sqlalchemy.orm.query.Query.join"><code class="xref py py-meth docutils literal"><span class="pre">Query.join()</span></code></a>&#x6216;<a class="reference internal" href="orm_loading_relationships.html#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal"><span class="pre">orm.joinedload()</span></code></a>&#x3002;</span><span class="yiyi-st" id="yiyi-543">&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;<code class="docutils literal"><span class="pre">.pets</span></code>&#x7684;&#x8FDE;&#x63A5;&#x52A0;&#x8F7D;&#x770B;&#x8D77;&#x6765;&#x50CF;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT person.id AS person_id, pets_1.id AS pets_1_id,
       pets_1.person_id AS pets_1_person_id
FROM person
LEFT OUTER JOIN pets AS pets_1
ON pets_1.person_id = CAST(person.id AS INTEGER)</pre></div></div><p><span class="yiyi-st" id="yiyi-544">&#x6CA1;&#x6709;&#x8054;&#x63A5;&#x7684;ON&#x5B50;&#x53E5;&#x4E2D;&#x7684;CAST&#xFF0C;&#x5F3A;&#x7C7B;&#x578B;&#x6570;&#x636E;&#x5E93;&#xFF08;&#x5982;Postgresql&#xFF09;&#x5C06;&#x62D2;&#x7EDD;&#x9690;&#x5F0F;&#x6BD4;&#x8F83;&#x6574;&#x6570;&#x548C;&#x5931;&#x8D25;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-545"><code class="docutils literal"><span class="pre">.pets</span></code>&#x7684;lazyload&#x60C5;&#x51B5;&#x4F9D;&#x8D56;&#x4E8E;&#x5728;&#x52A0;&#x8F7D;&#x65F6;&#x7528;&#x4E00;&#x4E2A;&#x7ED1;&#x5B9A;&#x53C2;&#x6570;&#x66FF;&#x6362;<code class="docutils literal"><span class="pre">Person.id</span></code>&#x5217;&#xFF0C;&#x8BE5;&#x7ED1;&#x5B9A;&#x53C2;&#x6570;&#x63A5;&#x6536;&#x4E00;&#x4E2A;Python&#x52A0;&#x8F7D;&#x7684;&#x503C;&#x3002;</span><span class="yiyi-st" id="yiyi-546">&#x8FD9;&#x79CD;&#x66FF;&#x6362;&#x7279;&#x522B;&#x9002;&#x7528;&#x4E8E;&#x6211;&#x4EEC;&#x7684;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.type_coerce" title="sqlalchemy.sql.expression.type_coerce"><code class="xref py py-func docutils literal"><span class="pre">type_coerce()</span></code></a>&#x51FD;&#x6570;&#x7684;&#x610F;&#x56FE;&#x4F1A;&#x4E22;&#x5931;&#x7684;&#x5730;&#x65B9;&#x3002;</span><span class="yiyi-st" id="yiyi-547">&#x5728;&#x66F4;&#x6539;&#x4E4B;&#x524D;&#xFF0C;&#x8FD9;&#x4E2A;&#x61D2;&#x60F0;&#x8D1F;&#x8F7D;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT pets.id AS pets_id, pets.person_id AS pets_person_id
FROM pets
WHERE pets.person_id = CAST(CAST(%(param_1)s AS VARCHAR) AS INTEGER)
{&apos;param_1&apos;: 5}</pre></div></div><p><span class="yiyi-st" id="yiyi-548">&#x5728;&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x770B;&#x5230;&#x6211;&#x4EEC;&#x7684;Python in-value&#x503C;&#x662F;<code class="docutils literal"><span class="pre">5</span></code>&#xFF0C;&#x5148;&#x662F;CAST&#x5230;VARCHAR&#xFF0C;&#x7136;&#x540E;&#x8FD4;&#x56DE;&#x5230;SQL&#x4E2D;&#x7684;INTEGER&#xFF1B;&#x4E00;&#x4E2A;&#x53EF;&#x4EE5;&#x5DE5;&#x4F5C;&#x7684;&#x53CC;&#x91CD;CAST&#xFF0C;&#x4F46;&#x5E76;&#x4E0D;&#x662F;&#x6211;&#x4EEC;&#x6240;&#x8981;&#x6C42;&#x7684;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-549">&#x968F;&#x7740;&#x66F4;&#x6539;&#xFF0C;&#x5373;&#x4F7F;&#x5728;&#x5C06;&#x5217;&#x6362;&#x51FA;&#x4E3A;&#x7ED1;&#x5B9A;&#x53C2;&#x6570;&#x4E4B;&#x540E;&#xFF0C;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.type_coerce" title="sqlalchemy.sql.expression.type_coerce"><code class="xref py py-func docutils literal"><span class="pre">type_coerce()</span></code></a>&#x51FD;&#x6570;&#x4E5F;&#x4F1A;&#x7EF4;&#x62A4;&#x4E00;&#x4E2A;&#x5305;&#x88C5;&#xFF0C;&#x73B0;&#x5728;&#x67E5;&#x8BE2;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT pets.id AS pets_id, pets.person_id AS pets_person_id
FROM pets
WHERE pets.person_id = CAST(%(param_1)s AS INTEGER)
{&apos;param_1&apos;: 5}</pre></div></div><p><span class="yiyi-st" id="yiyi-550">&#x5728;&#x6211;&#x4EEC;&#x7684;&#x4E3B;&#x8981;&#x8054;&#x63A5;&#x4E2D;&#x7684;&#x5916;&#x90E8;CAST&#x4ECD;&#x7136;&#x751F;&#x6548;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6839;&#x636E;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.type_coerce" title="sqlalchemy.sql.expression.type_coerce"><code class="xref py py-func docutils literal"><span class="pre">type_coerce()</span></code></a>&#x51FD;&#x6570;&#x7684;&#x610F;&#x56FE;&#x5220;&#x9664;&#x4E86;&#x5728;<code class="docutils literal"><span class="pre">StringAsInt</span></code>&#x5B9A;&#x5236;&#x7C7B;&#x578B;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x4E2D;&#x7684;&#x4E0D;&#x5FC5;&#x8981;&#x7684;CAST&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-551"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3531">&#xFF03;3531  T0&gt;</a></span></p></div></div><div class="section" id="key-behavioral-changes-orm"><h2><span class="yiyi-st" id="yiyi-552">&#x5173;&#x952E;&#x884C;&#x4E3A;&#x6539;&#x53D8; -  ORM <a class="headerlink" href="#key-behavioral-changes-orm" title="Permalink to this headline">&#xB6;</a></span></h2></div><div class="section" id="key-behavioral-changes-core"><h2><span class="yiyi-st" id="yiyi-553">&#x5173;&#x952E;&#x884C;&#x4E3A;&#x6539;&#x53D8; - &#x6838;&#x5FC3;<a class="headerlink" href="#key-behavioral-changes-core" title="Permalink to this headline">&#xB6;</a></span></h2><div class="section" id="textclause-columns-will-match-columns-positionally-not-by-name-when-passed-positionally"><h3><span class="yiyi-st" id="yiyi-554">&#x5F53;&#x4F4D;&#x7F6E;&#x901A;&#x8FC7;&#x65F6;&#xFF0C;TextClause.columns()&#x5C06;&#x6309;&#x4F4D;&#x7F6E;&#x5339;&#x914D;&#x5217;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x6309;&#x540D;&#x79F0;&#x5339;&#x914D;<a class="headerlink" href="#textclause-columns-will-match-columns-positionally-not-by-name-when-passed-positionally" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-555"><a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.TextClause.columns" title="sqlalchemy.sql.expression.TextClause.columns"><code class="xref py py-meth docutils literal"><span class="pre">TextClause.columns()</span></code></a>&#x65B9;&#x6CD5;&#x7684;&#x65B0;&#x884C;&#x4E3A;&#x672C;&#x8EAB;&#x6700;&#x8FD1;&#x5728;0.9&#x7CFB;&#x5217;&#x4E2D;&#x6DFB;&#x52A0;&#x65F6;&#xFF0C;&#x662F;&#x5F53;&#x5217;&#x4F4D;&#x7F6E;&#x4F20;&#x9012;&#x65F6;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x5176;&#x4ED6;&#x5173;&#x952E;&#x5B57;&#x53C2;&#x6570;&#x65F6;&#xFF0C;&#x5B83;&#x4EEC;&#x88AB;&#x94FE;&#x63A5;&#x5230;&#x6700;&#x7EC8;&#x7ED3;&#x679C;&#x8BBE;&#x7F6E;&#x5217;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x5E76;&#x4E0D;&#x518D;&#x540D;&#x79F0;&#x3002;</span><span class="yiyi-st" id="yiyi-556">&#x5E0C;&#x671B;&#x8FD9;&#x79CD;&#x6539;&#x53D8;&#x7684;&#x5F71;&#x54CD;&#x5F88;&#x5C0F;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x603B;&#x662F;&#x88AB;&#x8BB0;&#x5F55;&#x4E0B;&#x6765;&#xFF0C;&#x8BF4;&#x660E;&#x6309;&#x7167;&#x4E0E;&#x6587;&#x672C;SQL&#x8BED;&#x53E5;&#x76F8;&#x540C;&#x7684;&#x987A;&#x5E8F;&#x4F20;&#x9012;&#x7684;&#x5217;&#xFF0C;&#x8FD9;&#x770B;&#x8D77;&#x6765;&#x5F88;&#x76F4;&#x89C2;&#xFF0C;&#x5373;&#x4F7F;&#x5185;&#x90E8;&#x7ED3;&#x6784;&#x6CA1;&#x6709;&#x4E0D;&#x68C0;&#x67E5;&#x8FD9;&#x4E2A;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-557">&#x901A;&#x8FC7;&#x5C06;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a>&#x5BF9;&#x8C61;&#x4F20;&#x9012;&#x7ED9;&#x5B83;&#x7684;&#x4F4D;&#x7F6E;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5FC5;&#x987B;&#x786E;&#x4FDD;&#x8FD9;&#x4E9B;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a>&#x5BF9;&#x8C61;&#x7684;&#x4F4D;&#x7F6E;&#x4E0E;&#x6587;&#x672C;SQL&#x4E2D;&#x8FD9;&#x4E9B;&#x5217;&#x7684;&#x4F4D;&#x7F6E;&#x5339;&#x914D;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-558">&#x4F8B;&#x5982;&#xFF0C;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">stmt</span> <span class="o">=</span> <span class="n">text</span><span class="p">(</span><span class="s2">&quot;SELECT id, name, description FROM table&quot;</span><span class="p">)</span>

<span class="c1"># no longer matches by name</span>
<span class="n">stmt</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">columns</span><span class="p">(</span><span class="n">my_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">my_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">my_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-559">&#x5C06;&#x4E0D;&#x518D;&#x6309;&#x9884;&#x671F;&#x5DE5;&#x4F5C;&#xFF1B;&#x73B0;&#x5728;&#x7ED9;&#x51FA;&#x7684;&#x5217;&#x7684;&#x987A;&#x5E8F;&#x662F;&#x91CD;&#x8981;&#x7684;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># correct version</span>
<span class="n">stmt</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">columns</span><span class="p">(</span><span class="n">my_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">my_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">my_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">description</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-560">&#x53EF;&#x80FD;&#x66F4;&#x6709;&#x53EF;&#x80FD;&#x7684;&#x662F;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x9648;&#x8FF0;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">stmt</span> <span class="o">=</span> <span class="n">text</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM table&quot;</span><span class="p">)</span>
<span class="n">stmt</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">columns</span><span class="p">(</span><span class="n">my_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">my_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">my_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">description</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-561">&#x73B0;&#x5728;&#x6709;&#x70B9;&#x5192;&#x9669;&#xFF0C;&#x56E0;&#x4E3A;&#x201C;*&#x201D;&#x89C4;&#x8303;&#x901A;&#x5E38;&#x4F1A;&#x6309;&#x7167;&#x5B83;&#x4EEC;&#x51FA;&#x73B0;&#x5728;&#x8868;&#x4E2D;&#x7684;&#x987A;&#x5E8F;&#x4F20;&#x9012;&#x5217;&#x3002;</span><span class="yiyi-st" id="yiyi-562">&#x5982;&#x679C;&#x8868;&#x7684;&#x7ED3;&#x6784;&#x56E0;&#x6A21;&#x5F0F;&#x66F4;&#x6539;&#x800C;&#x53D1;&#x751F;&#x66F4;&#x6539;&#xFF0C;&#x5219;&#x6B64;&#x6392;&#x5E8F;&#x53EF;&#x80FD;&#x4E0D;&#x518D;&#x76F8;&#x540C;&#x3002;</span><span class="yiyi-st" id="yiyi-563">&#x56E0;&#x6B64;&#xFF0C;&#x5728;&#x4F7F;&#x7528;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.TextClause.columns" title="sqlalchemy.sql.expression.TextClause.columns"><code class="xref py py-meth docutils literal"><span class="pre">TextClause.columns()</span></code></a>&#x65F6;&#xFF0C;&#x5EFA;&#x8BAE;&#x5728;&#x6587;&#x672C;SQL&#x4E2D;&#x660E;&#x786E;&#x5217;&#x51FA;&#x6240;&#x9700;&#x7684;&#x5217;&#xFF0C;&#x4F46;&#x4E0D;&#x5FC5;&#x518D;&#x62C5;&#x5FC3;&#x6587;&#x672C;SQL&#x4E2D;&#x7684;&#x540D;&#x79F0;&#x672C;&#x8EAB;&#x3002;</span></p><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-564">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-565"><a class="reference internal" href="#change-3501"><span>ResultSet column matching enhancements; positional column setup for textual SQL</span></a></span></p></div></div></div><div class="section" id="dialect-improvements-and-changes-postgresql"><h2><span class="yiyi-st" id="yiyi-566">&#x65B9;&#x8A00;&#x7684;&#x6539;&#x8FDB;&#x548C;&#x53D8;&#x5316; -  Postgresql <a class="headerlink" href="#dialect-improvements-and-changes-postgresql" title="Permalink to this headline">&#xB6;</a></span></h2><div class="section" id="support-for-insert-on-conflict-do-update-do-nothing"><h3><span class="yiyi-st" id="yiyi-567">&#x652F;&#x6301;INSERT..ON CONFLICT&#xFF08;DO UPDATE | DO NOTHING&#xFF09;<a class="headerlink" href="#support-for-insert-on-conflict-do-update-do-nothing" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-568">The <code class="docutils literal"><span class="pre">ON</span> <span class="pre">CONFLICT</span></code> clause of <code class="docutils literal"><span class="pre">INSERT</span></code> added to Postgresql as of version 9.5 is now supported using a Postgresql-specific version of the <a class="reference internal" href="core_dml.html#sqlalchemy.sql.expression.Insert" title="sqlalchemy.sql.expression.Insert"><code class="xref py py-class docutils literal"><span class="pre">Insert</span></code></a> object, via <a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.dml.insert" title="sqlalchemy.dialects.postgresql.dml.insert"><code class="xref py py-func docutils literal"><span class="pre">sqlalchemy.dialects.postgresql.dml.insert()</span></code></a>. </span><span class="yiyi-st" id="yiyi-569">This <a class="reference internal" href="core_dml.html#sqlalchemy.sql.expression.Insert" title="sqlalchemy.sql.expression.Insert"><code class="xref py py-class docutils literal"><span class="pre">Insert</span></code></a> subclass adds two new methods <a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.dml.Insert.on_conflict_do_update" title="sqlalchemy.dialects.postgresql.dml.Insert.on_conflict_do_update"><code class="xref py py-meth docutils literal"><span class="pre">Insert.on_conflict_do_update()</span></code></a> and <a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.dml.Insert.on_conflict_do_nothing" title="sqlalchemy.dialects.postgresql.dml.Insert.on_conflict_do_nothing"><code class="xref py py-meth docutils literal"><span class="pre">Insert.on_conflict_do_nothing()</span></code></a> which implement the full syntax supported by Posgresql 9.5 in this area:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>from sqlalchemy.dialects.postgresql import insert

insert_stmt = insert(my_table). \\
    values(id=&apos;some_id&apos;, data=&apos;some data to insert&apos;)

do_update_stmt = insert_stmt.on_conflict_do_update(
    index_elements=[my_table.c.id],
    set_=dict(data=&apos;some data to update&apos;)
)

conn.execute(do_update_stmt)</pre></div></div><p><span class="yiyi-st" id="yiyi-570">&#x4EE5;&#x4E0A;&#x5C06;&#x5448;&#x73B0;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>INSERT INTO my_table (id, data)
VALUES (:id, :data)
ON CONFLICT id DO UPDATE SET data=:data_2</pre></div></div><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-571">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-572"><a class="reference internal" href="dialects_postgresql.html#postgresql-insert-on-conflict"><span>INSERT...ON CONFLICT (Upsert)</span></a></span></p></div><p><span class="yiyi-st" id="yiyi-573"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3529">&#xFF03;3529  T0&gt;</a></span></p></div><div class="section" id="array-and-json-types-now-correctly-specify-unhashable"><h3><span class="yiyi-st" id="yiyi-574">ARRAY&#x548C;JSON&#x7C7B;&#x578B;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x6B63;&#x786E;&#x6307;&#x5B9A;&#x201C;&#x4E0D;&#x53EF;&#x7528;&#x201D;<a class="headerlink" href="#array-and-json-types-now-correctly-specify-unhashable" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-575">&#x5982;<a class="reference internal" href="#change-3499"><span>Changes regarding &#x201C;unhashable&#x201D; types</span></a>&#x4E2D;&#x6240;&#x8FF0;&#xFF0C;&#x5F53;&#x67E5;&#x8BE2;&#x7684;&#x9009;&#x5B9A;&#x5B9E;&#x4F53;&#x5C06;&#x5B8C;&#x6574;&#x7684;ORM&#x5B9E;&#x4F53;&#x4E0E;&#x5217;&#x8868;&#x8FBE;&#x5F0F;&#x6DF7;&#x5408;&#x65F6;&#xFF0C;ORM&#x4F9D;&#x8D56;&#x4E8E;&#x80FD;&#x591F;&#x4E3A;&#x5217;&#x503C;&#x751F;&#x6210;&#x6563;&#x5217;&#x51FD;&#x6570;&#x3002;</span><span class="yiyi-st" id="yiyi-576"><code class="docutils literal"><span class="pre">hashable=False</span></code>&#x6807;&#x5FD7;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x5728;&#x6240;&#x6709;PG&#x7684;&#x201C;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x201D;&#x7C7B;&#x578B;&#x4E2D;&#x6B63;&#x786E;&#x8BBE;&#x7F6E;&#xFF0C;&#x5305;&#x62EC;<a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.ARRAY" title="sqlalchemy.dialects.postgresql.ARRAY"><code class="xref py py-class docutils literal"><span class="pre">postgresql.ARRAY</span></code></a>&#x548C;<a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.JSON" title="sqlalchemy.dialects.postgresql.JSON"><code class="xref py py-class docutils literal"><span class="pre">postgresql.JSON</span></code></a>&#x3002;</span><span class="yiyi-st" id="yiyi-577"><a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.JSONB" title="sqlalchemy.dialects.postgresql.JSONB"><code class="xref py py-class docutils literal"><span class="pre">JSONB</span></code></a>&#x548C;<a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.HSTORE" title="sqlalchemy.dialects.postgresql.HSTORE"><code class="xref py py-class docutils literal"><span class="pre">HSTORE</span></code></a>&#x7C7B;&#x578B;&#x5DF2;&#x5305;&#x542B;&#x6B64;&#x6807;&#x5FD7;&#x3002;</span><span class="yiyi-st" id="yiyi-578">&#x5BF9;&#x4E8E;<a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.ARRAY" title="sqlalchemy.dialects.postgresql.ARRAY"><code class="xref py py-class docutils literal"><span class="pre">postgresql.ARRAY</span></code></a>&#xFF0C;&#x8FD9;&#x662F;&#x57FA;&#x4E8E;<a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.ARRAY.params.as_tuple" title="sqlalchemy.dialects.postgresql.ARRAY"><code class="xref py py-paramref docutils literal"><span class="pre">postgresql.ARRAY.as_tuple</span></code></a>&#x6807;&#x5FD7;&#x7684;&#x6761;&#x4EF6;&#xFF0C;&#x4F46;&#x662F;&#x4E0D;&#x5E94;&#x8BE5;&#x518D;&#x8BBE;&#x7F6E;&#x8BE5;&#x6807;&#x5FD7;&#x6765;&#x83B7;&#x5F97;&#x6570;&#x7EC4;&#x503C;&#x5B58;&#x5728;&#x4E8E;&#x7EC4;&#x6210;&#x7684;ORM&#x884C;&#x4E2D;&#x3002;</span></p><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-579">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p><span class="yiyi-st" id="yiyi-580"><a class="reference internal" href="#change-3499"><span>Changes regarding &#x201C;unhashable&#x201D; types</span></a></span></p><p class="last"><span class="yiyi-st" id="yiyi-581"><a class="reference internal" href="#change-3503"><span>Correct SQL Types are Established from Indexed Access of ARRAY, JSON, HSTORE</span></a></span></p></div><p><span class="yiyi-st" id="yiyi-582"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3499">&#xFF03;3499  T0&gt;</a></span></p></div><div class="section" id="correct-sql-types-are-established-from-indexed-access-of-array-json-hstore"><h3><span class="yiyi-st" id="yiyi-583">&#x901A;&#x8FC7;&#x5BF9;ARRAY&#xFF0C;JSON&#xFF0C;HSTORE&#x7684;&#x7D22;&#x5F15;&#x8BBF;&#x95EE;&#x5EFA;&#x7ACB;&#x6B63;&#x786E;&#x7684;SQL&#x7C7B;&#x578B;<a class="headerlink" href="#correct-sql-types-are-established-from-indexed-access-of-array-json-hstore" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-584">For all three of <a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.ARRAY" title="sqlalchemy.dialects.postgresql.ARRAY"><code class="xref py py-class docutils literal"><span class="pre">ARRAY</span></code></a>, <a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.JSON" title="sqlalchemy.dialects.postgresql.JSON"><code class="xref py py-class docutils literal"><span class="pre">JSON</span></code></a> and <a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.HSTORE" title="sqlalchemy.dialects.postgresql.HSTORE"><code class="xref py py-class docutils literal"><span class="pre">HSTORE</span></code></a>, the SQL type assigned to the expression returned by indexed access, e.g. <code class="docutils literal"><span class="pre">col[someindex]</span></code>, should be correct in all cases.</span></p><p><span class="yiyi-st" id="yiyi-585">&#x8FD9;&#x5305;&#x62EC;&#xFF1A;</span></p><ul><li><p class="first"><span class="yiyi-st" id="yiyi-586">&#x5206;&#x914D;&#x7ED9;<a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.ARRAY" title="sqlalchemy.dialects.postgresql.ARRAY"><code class="xref py py-class docutils literal"><span class="pre">ARRAY</span></code></a>&#x7684;&#x7D22;&#x5F15;&#x8BBF;&#x95EE;&#x7684;SQL&#x7C7B;&#x578B;&#x8003;&#x8651;&#x4E86;&#x914D;&#x7F6E;&#x7684;&#x7EF4;&#x6570;&#x3002;</span><span class="yiyi-st" id="yiyi-587">&#x5177;&#x6709;&#x4E09;&#x4E2A;&#x7EF4;&#x5EA6;&#x7684;<a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.ARRAY" title="sqlalchemy.dialects.postgresql.ARRAY"><code class="xref py py-class docutils literal"><span class="pre">ARRAY</span></code></a>&#x5C06;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x5177;&#x6709;&#x5C11;&#x4E8E;&#x4E00;&#x4E2A;&#x7EF4;&#x5EA6;&#x7684;<a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.ARRAY" title="sqlalchemy.dialects.postgresql.ARRAY"><code class="xref py py-class docutils literal"><span class="pre">ARRAY</span></code></a>&#x7C7B;&#x578B;&#x7684;SQL&#x8868;&#x8FBE;&#x5F0F;&#x3002;</span><span class="yiyi-st" id="yiyi-588">&#x7ED9;&#x5B9A;&#x4E00;&#x4E2A;&#x7C7B;&#x578B;&#x4E3A;<code class="docutils literal"><span class="pre">ARRAY&#xFF08;Integer&#xFF0C;</span> <span class="pre">dimensions = 3&#xFF09;</span></code>&#x7684;&#x5217;&#xFF0C;&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x6267;&#x884C;&#x4E0B;&#x9762;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">int_expr</span> <span class="o">=</span> <span class="n">col</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">6</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span>   <span class="c1"># returns an Integer expression object</span></pre></div></div><p><span class="yiyi-st" id="yiyi-589">&#x4EE5;&#x524D;&#xFF0C;&#x5BF9;<code class="docutils literal"><span class="pre">col[5]</span></code>&#x7684;&#x7D22;&#x5F15;&#x8BBF;&#x95EE;&#x5C06;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x7C7B;&#x578B;&#x4E3A;<a class="reference internal" href="core_type_basics.html#sqlalchemy.types.Integer" title="sqlalchemy.types.Integer"><code class="xref py py-class docutils literal"><span class="pre">Integer</span></code></a>&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x6211;&#x4EEC;&#x4E0D;&#x80FD;&#x518D;&#x4E3A;&#x5176;&#x4F59;&#x7EF4;&#x5EA6;&#x6267;&#x884C;&#x7D22;&#x5F15;&#x8BBF;&#x95EE;&#xFF0C;&#x9664;&#x975E;&#x6211;&#x4EEC;&#x4F7F;&#x7528;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.cast" title="sqlalchemy.sql.expression.cast"><code class="xref py py-func docutils literal"><span class="pre">cast()</span></code></a>&#x6216;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.type_coerce" title="sqlalchemy.sql.expression.type_coerce"><code class="xref py py-func docutils literal"><span class="pre">type_coerce()</span></code></a>&#x3002;</span></p></li><li><p class="first"><span class="yiyi-st" id="yiyi-590">&#x73B0;&#x5728;&#xFF0C;<a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.JSON" title="sqlalchemy.dialects.postgresql.JSON"><code class="xref py py-class docutils literal"><span class="pre">JSON</span></code></a>&#x548C;<a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.JSONB" title="sqlalchemy.dialects.postgresql.JSONB"><code class="xref py py-class docutils literal"><span class="pre">JSONB</span></code></a>&#x7C7B;&#x578B;&#x53CD;&#x6620;&#x4E86;Postgresql&#x672C;&#x8EAB;&#x4E3A;&#x7D22;&#x5F15;&#x8BBF;&#x95EE;&#x6240;&#x505A;&#x7684;&#x5DE5;&#x4F5C;&#x3002;</span><span class="yiyi-st" id="yiyi-591">This means that all indexed access for a <a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.JSON" title="sqlalchemy.dialects.postgresql.JSON"><code class="xref py py-class docutils literal"><span class="pre">JSON</span></code></a> or <a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.JSONB" title="sqlalchemy.dialects.postgresql.JSONB"><code class="xref py py-class docutils literal"><span class="pre">JSONB</span></code></a> type returns an expression that itself is <em>always</em> <a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.JSON" title="sqlalchemy.dialects.postgresql.JSON"><code class="xref py py-class docutils literal"><span class="pre">JSON</span></code></a> or <a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.JSONB" title="sqlalchemy.dialects.postgresql.JSONB"><code class="xref py py-class docutils literal"><span class="pre">JSONB</span></code></a> itself, unless the <a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.JSON.Comparator.astext" title="sqlalchemy.dialects.postgresql.JSON.Comparator.astext"><code class="xref py py-attr docutils literal"><span class="pre">astext</span></code></a> modifier is used. </span><span class="yiyi-st" id="yiyi-592">&#x8FD9;&#x610F;&#x5473;&#x7740;&#x65E0;&#x8BBA;JSON&#x7ED3;&#x6784;&#x7684;&#x7D22;&#x5F15;&#x8BBF;&#x95EE;&#x6700;&#x7EC8;&#x662F;&#x6307;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x5217;&#x8868;&#xFF0C;&#x6570;&#x5B57;&#x8FD8;&#x662F;&#x5176;&#x4ED6;JSON&#x7ED3;&#x6784;&#xFF0C;Postgresql&#x59CB;&#x7EC8;&#x8BA4;&#x4E3A;&#x5B83;&#x672C;&#x8EAB;&#x662F;JSON&#xFF0C;&#x9664;&#x975E;&#x5B83;&#x660E;&#x786E;&#x5730;&#x88AB;&#x8F6C;&#x6362;&#x4E3A;&#x4E0D;&#x540C;&#x7684;&#x5F62;&#x5F0F;&#x3002;</span><span class="yiyi-st" id="yiyi-593">&#x50CF;<a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.ARRAY" title="sqlalchemy.dialects.postgresql.ARRAY"><code class="xref py py-class docutils literal"><span class="pre">ARRAY</span></code></a>&#x7C7B;&#x578B;&#x4E00;&#x6837;&#xFF0C;&#x8FD9;&#x610F;&#x5473;&#x7740;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x751F;&#x6210;&#x5177;&#x6709;&#x591A;&#x7EA7;&#x7D22;&#x5F15;&#x8BBF;&#x95EE;&#x7684;JSON&#x8868;&#x8FBE;&#x5F0F;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">json_expr</span> <span class="o">=</span> <span class="n">json_col</span><span class="p">[</span><span class="s1">&apos;key1&apos;</span><span class="p">][</span><span class="s1">&apos;attr1&apos;</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span></pre></div></div></li><li><p class="first"><span class="yiyi-st" id="yiyi-594">The &#x201C;textual&#x201D; type that is returned by indexed access of <a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.HSTORE" title="sqlalchemy.dialects.postgresql.HSTORE"><code class="xref py py-class docutils literal"><span class="pre">HSTORE</span></code></a> as well as the &#x201C;textual&#x201D; type that is returned by indexed access of <a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.JSON" title="sqlalchemy.dialects.postgresql.JSON"><code class="xref py py-class docutils literal"><span class="pre">JSON</span></code></a> and <a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.JSONB" title="sqlalchemy.dialects.postgresql.JSONB"><code class="xref py py-class docutils literal"><span class="pre">JSONB</span></code></a> in conjunction with the <a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.JSON.Comparator.astext" title="sqlalchemy.dialects.postgresql.JSON.Comparator.astext"><code class="xref py py-attr docutils literal"><span class="pre">astext</span></code></a> modifier is now configurable; it defaults to <a class="reference internal" href="core_type_basics.html#sqlalchemy.types.Text" title="sqlalchemy.types.Text"><code class="xref py py-class docutils literal"><span class="pre">Text</span></code></a> in both cases but can be set to a user-defined type using the <a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.JSON.params.astext_type" title="sqlalchemy.dialects.postgresql.JSON"><code class="xref py py-paramref docutils literal"><span class="pre">postgresql.JSON.astext_type</span></code></a> or <a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.HSTORE.params.text_type" title="sqlalchemy.dialects.postgresql.HSTORE"><code class="xref py py-paramref docutils literal"><span class="pre">postgresql.HSTORE.text_type</span></code></a> parameters.</span></p></li></ul><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-595">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-596"><a class="reference internal" href="#change-3503-cast"><span>The JSON cast() operation now requires .astext is called explicitly</span></a></span></p></div><p><span class="yiyi-st" id="yiyi-597"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3499">&#xFF03;3499</a> <a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3487">&#xFF03;3487</a></span></p></div><div class="section" id="the-json-cast-operation-now-requires-astext-is-called-explicitly"><h3><span class="yiyi-st" id="yiyi-598">JSON cast()&#x64CD;&#x4F5C;&#x73B0;&#x5728;&#x9700;&#x8981;<code class="docutils literal"><span class="pre">.astext</span></code>&#x88AB;&#x663E;&#x5F0F;&#x8C03;&#x7528;<a class="headerlink" href="#the-json-cast-operation-now-requires-astext-is-called-explicitly" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-599">As part of the changes in <a class="reference internal" href="#change-3503"><span>Correct SQL Types are Established from Indexed Access of ARRAY, JSON, HSTORE</span></a>, the workings of the <a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.ColumnElement.cast" title="sqlalchemy.sql.expression.ColumnElement.cast"><code class="xref py py-meth docutils literal"><span class="pre">ColumnElement.cast()</span></code></a> operator on <a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.JSON" title="sqlalchemy.dialects.postgresql.JSON"><code class="xref py py-class docutils literal"><span class="pre">postgresql.JSON</span></code></a> and <a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.JSONB" title="sqlalchemy.dialects.postgresql.JSONB"><code class="xref py py-class docutils literal"><span class="pre">postgresql.JSONB</span></code></a> no longer implictly invoke the <a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.JSON.Comparator.astext" title="sqlalchemy.dialects.postgresql.JSON.Comparator.astext"><code class="xref py py-attr docutils literal"><span class="pre">postgresql.JSON.Comparator.astext</span></code></a> modifier; Postgresql&#x2019;s JSON/JSONB types support CAST operations to each other without the &#x201C;astext&#x201D; aspect.</span></p><p><span class="yiyi-st" id="yiyi-600">&#x8FD9;&#x610F;&#x5473;&#x7740;&#x5728;&#x5927;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8FD9;&#x6837;&#x505A;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">expr</span> <span class="o">=</span> <span class="n">json_col</span><span class="p">[</span><span class="s1">&apos;somekey&apos;</span><span class="p">]</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">Integer</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-601">&#x73B0;&#x5728;&#x9700;&#x8981;&#x6539;&#x53D8;&#x4E3A;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">expr</span> <span class="o">=</span> <span class="n">json_col</span><span class="p">[</span><span class="s1">&apos;somekey&apos;</span><span class="p">]</span><span class="o">.</span><span class="n">astext</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">Integer</span><span class="p">)</span></pre></div></div></div><div class="section" id="array-with-enum-will-now-emit-create-type-for-the-enum"><h3><span class="yiyi-st" id="yiyi-602">&#x5E26;&#x6709;ENUM&#x7684;ARRAY&#x73B0;&#x5728;&#x4F1A;&#x4E3A;ENUM <a class="headerlink" href="#array-with-enum-will-now-emit-create-type-for-the-enum" title="Permalink to this headline">&#xB6;</a>&#x53D1;&#x51FA;CREATE TYPE</span></h3><p><span class="yiyi-st" id="yiyi-603">&#x50CF;&#x4E0B;&#x9762;&#x8FD9;&#x6837;&#x7684;&#x8868;&#x5B9A;&#x4E49;&#x73B0;&#x5728;&#x5C06;&#x6309;&#x7167;&#x9884;&#x671F;&#x53D1;&#x51FA;CREATE TYPE&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">enum</span> <span class="o">=</span> <span class="n">Enum</span><span class="p">(</span>
    <span class="s1">&apos;manager&apos;</span><span class="p">,</span> <span class="s1">&apos;place_admin&apos;</span><span class="p">,</span> <span class="s1">&apos;carwash_admin&apos;</span><span class="p">,</span>
    <span class="s1">&apos;parking_admin&apos;</span><span class="p">,</span> <span class="s1">&apos;service_admin&apos;</span><span class="p">,</span> <span class="s1">&apos;tire_admin&apos;</span><span class="p">,</span>
    <span class="s1">&apos;mechanic&apos;</span><span class="p">,</span> <span class="s1">&apos;carwasher&apos;</span><span class="p">,</span> <span class="s1">&apos;tire_mechanic&apos;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;work_place_roles&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">WorkPlacement</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;work_placement&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">roles</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ARRAY</span><span class="p">(</span><span class="n">enum</span><span class="p">))</span>


<span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;postgresql://scott:tiger@localhost/test&quot;</span><span class="p">,</span> <span class="n">echo</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-604">&#x53D1;&#x51FA;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>CREATE TYPE work_place_roles AS ENUM (
    &apos;manager&apos;, &apos;place_admin&apos;, &apos;carwash_admin&apos;, &apos;parking_admin&apos;,
    &apos;service_admin&apos;, &apos;tire_admin&apos;, &apos;mechanic&apos;, &apos;carwasher&apos;,
    &apos;tire_mechanic&apos;)

CREATE TABLE work_placement (
    id SERIAL NOT NULL,
    roles work_place_roles[],
    PRIMARY KEY (id)
)</pre></div></div><p><span class="yiyi-st" id="yiyi-605"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2729">&#xFF03;2729  T0&gt;</a></span></p></div><div class="section" id="check-constraints-now-reflect"><h3><span class="yiyi-st" id="yiyi-606">&#x68C0;&#x67E5;&#x7EA6;&#x675F;&#x73B0;&#x5728;&#x53CD;&#x6620;<a class="headerlink" href="#check-constraints-now-reflect" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-607">Postgresql&#x65B9;&#x8A00;&#x73B0;&#x5728;&#x652F;&#x6301;&#x5728;&#x65B9;&#x6CD5;<a class="reference internal" href="core_reflection.html#sqlalchemy.engine.reflection.Inspector.get_check_constraints" title="sqlalchemy.engine.reflection.Inspector.get_check_constraints"><code class="xref py py-meth docutils literal"><span class="pre">Inspector.get_check_constraints()</span></code></a>&#x4EE5;&#x53CA;<code class="xref py py-attr docutils literal"><span class="pre">Table.constraints</span></code>&#x5185;&#x7684;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal"><span class="pre">Table</span></code></a>&#x53CD;&#x5C04;&#x5185;&#x53CD;&#x6620;CHECK&#x7EA6;&#x675F;&#x3002;&#x91C7;&#x96C6;&#x3002;</span></p></div><div class="section" id="plain-and-materialized-views-can-be-inspected-separately"><h3><span class="yiyi-st" id="yiyi-608">&#x201C;Plain&#x201D;&#x548C;&#x201C;Materialized&#x201D;&#x89C6;&#x56FE;&#x53EF;&#x4EE5;&#x5355;&#x72EC;&#x68C0;&#x67E5;<a class="headerlink" href="#plain-and-materialized-views-can-be-inspected-separately" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-609">&#x65B0;&#x53C2;&#x6570;<a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.base.PGInspector.get_view_names.params.include" title="sqlalchemy.dialects.postgresql.base.PGInspector.get_view_names"><code class="xref py py-paramref docutils literal"><span class="pre">PGInspector.get_view_names.include</span></code></a>&#x5141;&#x8BB8;&#x6307;&#x5B9A;&#x5E94;&#x8FD4;&#x56DE;&#x54EA;&#x4E9B;&#x89C6;&#x56FE;&#x7684;&#x5B50;&#x7C7B;&#x578B;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">inspect</span>
<span class="n">insp</span> <span class="o">=</span> <span class="n">inspect</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>

<span class="n">plain_views</span> <span class="o">=</span> <span class="n">insp</span><span class="o">.</span><span class="n">get_view_names</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s1">&apos;plain&apos;</span><span class="p">)</span>
<span class="n">all_views</span> <span class="o">=</span> <span class="n">insp</span><span class="o">.</span><span class="n">get_view_names</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">(</span><span class="s1">&apos;plain&apos;</span><span class="p">,</span> <span class="s1">&apos;materialized&apos;</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-610"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3588">&#xFF03;3588  T0&gt;</a></span></p></div><div class="section" id="added-tablespace-option-to-index"><h3><span class="yiyi-st" id="yiyi-611">&#x7D22;&#x5F15;<a class="headerlink" href="#added-tablespace-option-to-index" title="Permalink to this headline">&#xB6;</a>&#x589E;&#x52A0;&#x4E86;&#x8868;&#x7A7A;&#x95F4;&#x9009;&#x9879;</span></h3><p><span class="yiyi-st" id="yiyi-612">&#x4E3A;&#x4E86;&#x6307;&#x5B9A;TABLESPACE&#xFF0C;<a class="reference internal" href="core_constraints.html#sqlalchemy.schema.Index" title="sqlalchemy.schema.Index"><code class="xref py py-class docutils literal"><span class="pre">Index</span></code></a>&#x5BF9;&#x8C61;&#x73B0;&#x5728;&#x63A5;&#x53D7;&#x53C2;&#x6570;<code class="docutils literal"><span class="pre">postgresql_tablespace</span></code>&#xFF0C;&#x8FD9;&#x4E0E;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal"><span class="pre">Table</span></code></a>&#x5BF9;&#x8C61;&#x63A5;&#x53D7;&#x7684;&#x65B9;&#x5F0F;&#x76F8;&#x540C;&#x3002;</span></p><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-613">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-614"><a class="reference internal" href="dialects_postgresql.html#postgresql-index-storage"><span>Index Storage Parameters</span></a></span></p></div><p><span class="yiyi-st" id="yiyi-615"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3720">&#xFF03;3720  T0&gt;</a></span></p></div><div class="section" id="support-for-pygresql"><h3><span class="yiyi-st" id="yiyi-616">&#x652F;&#x6301;PyGreSQL <a class="headerlink" href="#support-for-pygresql" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-617">&#x73B0;&#x5728;&#x652F;&#x6301;<a class="reference external" href="https://pypi.python.org/pypi/PyGreSQL">PyGreSQL</a> DBAPI&#x3002;</span></p><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-618">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-619"><a class="reference internal" href="dialects_postgresql.html#dialect-postgresql-pygresql"><span>pygresql</span></a></span></p></div></div><div class="section" id="the-postgres-module-is-removed"><h3><span class="yiyi-st" id="yiyi-620">&#x201C;postgres&#x201D;&#x6A21;&#x5757;&#x88AB;&#x5220;&#x9664;<a class="headerlink" href="#the-postgres-module-is-removed" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-621">&#x957F;&#x671F;&#x5F03;&#x7528;&#x7684;<code class="docutils literal"><span class="pre">sqlalchemy.dialects.postgres</span></code>&#x6A21;&#x5757;&#x5C06;&#x88AB;&#x5220;&#x9664;&#xFF1B;&#x8FD9;&#x5DF2;&#x7ECF;&#x53D1;&#x51FA;&#x4E86;&#x591A;&#x5E74;&#x7684;&#x8B66;&#x544A;&#xFF0C;&#x5E76;&#x4E14;&#x9879;&#x76EE;&#x5E94;&#x8BE5;&#x8C03;&#x7528;<code class="docutils literal"><span class="pre">sqlalchemy.dialects.postgresql</span></code>&#x3002;</span><span class="yiyi-st" id="yiyi-622">&#x7136;&#x800C;&#xFF0C;&#x5F62;&#x5F0F;&#x4E3A;<code class="docutils literal"><span class="pre">postgres://</span></code>&#x7684;&#x5F15;&#x64CE;&#x7F51;&#x5740;&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x7EE7;&#x7EED;&#x4F7F;&#x7528;&#x3002;</span></p></div><div class="section" id="support-for-for-update-skip-locked-for-no-key-update-for-key-share"><h3><span class="yiyi-st" id="yiyi-623">&#x652F;&#x6301;FOR UPDATE SKIP LOCKED /&#x65E0;&#x5BC6;&#x94A5;&#x66F4;&#x65B0;/&#x7528;&#x4E8E;&#x5BC6;&#x94A5;&#x5171;&#x4EAB;<a class="headerlink" href="#support-for-for-update-skip-locked-for-no-key-update-for-key-share" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-624">Core&#x548C;ORM&#x4E2D;&#x7684;&#x65B0;&#x53C2;&#x6570;<a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.GenerativeSelect.with_for_update.params.skip_locked" title="sqlalchemy.sql.expression.GenerativeSelect.with_for_update"><code class="xref py py-paramref docutils literal"><span class="pre">GenerativeSelect.with_for_update.skip_locked</span></code></a>&#x548C;<a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.GenerativeSelect.with_for_update.params.key_share" title="sqlalchemy.sql.expression.GenerativeSelect.with_for_update"><code class="xref py py-paramref docutils literal"><span class="pre">GenerativeSelect.with_for_update.key_share</span></code></a>&#x5BF9;&#x201C;SELECT ... FOR UPDATE&#x201D;&#x6216;&#x201C;SELECT&#x201D;&#x8FDB;&#x884C;&#x4FEE;&#x6539;&#x3002; ..FOR SHARE&#x201C;&#x67E5;&#x8BE2;Postgresql&#x540E;&#x7AEF;&#xFF1A;</span></p><ul><li><p class="first"><span class="yiyi-st" id="yiyi-625">&#x9009;&#x62E9;&#x65E0;&#x94A5;&#x5319;&#x66F4;&#x65B0;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">table</span><span class="p">])</span><span class="o">.</span><span class="n">with_for_update</span><span class="p">(</span><span class="n">key_share</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div></div></li><li><p class="first"><span class="yiyi-st" id="yiyi-626">SELECT FOR UPDATE SKIP LOCKED&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">table</span><span class="p">])</span><span class="o">.</span><span class="n">with_for_update</span><span class="p">(</span><span class="n">skip_locked</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div></div></li><li><p class="first"><span class="yiyi-st" id="yiyi-627">&#x9009;&#x62E9;&#x5173;&#x952E;&#x5171;&#x4EAB;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">table</span><span class="p">])</span><span class="o">.</span><span class="n">with_for_update</span><span class="p">(</span><span class="n">read</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">key_share</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div></div></li></ul></div></div><div class="section" id="dialect-improvements-and-changes-mysql"><h2><span class="yiyi-st" id="yiyi-628">&#x65B9;&#x8A00;&#x7684;&#x6539;&#x8FDB;&#x548C;&#x6539;&#x53D8; -  MySQL <a class="headerlink" href="#dialect-improvements-and-changes-mysql" title="Permalink to this headline">&#xB6;</a></span></h2><div class="section" id="mysql-json-support"><h3><span class="yiyi-st" id="yiyi-629">MySQL JSON&#x652F;&#x6301;<a class="headerlink" href="#mysql-json-support" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-630">&#x4E00;&#x4E2A;&#x65B0;&#x7C7B;&#x578B;&#x7684;<a class="reference internal" href="dialects_mysql.html#sqlalchemy.dialects.mysql.JSON" title="sqlalchemy.dialects.mysql.JSON"><code class="xref py py-class docutils literal"><span class="pre">mysql.JSON</span></code></a>&#x88AB;&#x6DFB;&#x52A0;&#x5230;&#x652F;&#x6301;&#x65B0;&#x6DFB;&#x52A0;&#x5230;MySQL 5.7&#x7684;JSON&#x7C7B;&#x578B;&#x7684;MySQL&#x65B9;&#x8A00;&#x4E2D;&#x3002;</span><span class="yiyi-st" id="yiyi-631">&#x8BE5;&#x7C7B;&#x578B;&#x5728;&#x5185;&#x90E8;&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">JSON_EXTRACT</span></code>&#x51FD;&#x6570;&#x63D0;&#x4F9B;JSON&#x7684;&#x6301;&#x4E45;&#x6027;&#x4EE5;&#x53CA;&#x57FA;&#x672C;&#x7684;&#x7D22;&#x5F15;&#x8BBF;&#x95EE;&#x3002;</span><span class="yiyi-st" id="yiyi-632">&#x901A;&#x8FC7;&#x4F7F;&#x7528;MySQL&#x548C;Postgresql&#x5171;&#x540C;&#x7684;<a class="reference internal" href="core_type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal"><span class="pre">types.JSON</span></code></a>&#x6570;&#x636E;&#x7C7B;&#x578B;&#xFF0C;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x8DE8;MySQL&#x548C;Postgresql&#x7684;&#x53EF;&#x7D22;&#x5F15;JSON&#x5217;&#x3002;</span></p><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-633">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-634"><a class="reference internal" href="#change-3619"><span>JSON support added to Core</span></a></span></p></div><p><span class="yiyi-st" id="yiyi-635"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3547">&#xFF03;3547  T0&gt;</a></span></p></div><div class="section" id="added-support-for-autocommit-isolation-level"><h3><span class="yiyi-st" id="yiyi-636">&#x589E;&#x52A0;&#x4E86;&#x5BF9;AUTOCOMMIT&#x201C;&#x9694;&#x79BB;&#x7EA7;&#x522B;&#x201D;&#x7684;&#x652F;&#x6301;<a class="headerlink" href="#added-support-for-autocommit-isolation-level" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-637">The MySQL dialect now accepts the value &#x201C;AUTOCOMMIT&#x201D; for the <a class="reference internal" href="core_engines.html#sqlalchemy.create_engine.params.isolation_level" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal"><span class="pre">create_engine.isolation_level</span></code></a> and <a class="reference internal" href="core_connections.html#sqlalchemy.engine.Connection.execution_options.params.isolation_level" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal"><span class="pre">Connection.execution_options.isolation_level</span></code></a> parameters:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">connection</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">connection</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">execution_options</span><span class="p">(</span>
    <span class="n">isolation_level</span><span class="o">=</span><span class="s2">&quot;AUTOCOMMIT&quot;</span>
<span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-638">&#x9694;&#x79BB;&#x7EA7;&#x522B;&#x5229;&#x7528;&#x4E86;&#x5927;&#x591A;&#x6570;MySQL DBAPI&#x63D0;&#x4F9B;&#x7684;&#x5404;&#x79CD;&#x201C;&#x81EA;&#x52A8;&#x63D0;&#x4EA4;&#x201D;&#x5C5E;&#x6027;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-639"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3332">&#xFF03;3332  T0&gt;</a></span></p></div><div class="section" id="no-more-generation-of-an-implicit-key-for-composite-primary-key-w-auto-increment"><h3><span class="yiyi-st" id="yiyi-640">&#x4E0D;&#x518D;&#x4E3A;&#x590D;&#x5408;&#x4E3B;&#x952E;&#x751F;&#x6210;&#x9690;&#x5F0F;KEY w / AUTO_INCREMENT <a class="headerlink" href="#no-more-generation-of-an-implicit-key-for-composite-primary-key-w-auto-increment" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-641">MySQL&#x65B9;&#x8A00;&#x5177;&#x6709;&#x8FD9;&#x6837;&#x7684;&#x884C;&#x4E3A;&#xFF0C;&#x5982;&#x679C;InnoDB&#x8868;&#x4E0A;&#x7684;&#x7EC4;&#x5408;&#x4E3B;&#x952E;&#x5728;&#x4E0D;&#x662F;&#x7B2C;&#x4E00;&#x5217;&#x7684;&#x5217;&#x4E4B;&#x4E00;&#x4E0A;&#x5177;&#x6709;AUTO_INCREMENT&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s1">&apos;some_table&apos;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;x&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">autoincrement</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;y&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">autoincrement</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
    <span class="n">mysql_engine</span><span class="o">=</span><span class="s1">&apos;InnoDB&apos;</span>
<span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-642">&#x5C06;&#x751F;&#x6210;&#x5982;&#x4E0B;&#x7684;DDL&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>CREATE TABLE some_table (
    x INTEGER NOT NULL,
    y INTEGER NOT NULL AUTO_INCREMENT,
    PRIMARY KEY (x, y),
    KEY idx_autoinc_y (y)
)ENGINE=InnoDB</pre></div></div><p><span class="yiyi-st" id="yiyi-643">&#x6CE8;&#x610F;&#x4E0A;&#x9762;&#x5E26;&#x6709;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x540D;&#x79F0;&#x7684;&#x201C;KEY&#x201D;&#xFF1B;&#x8FD9;&#x662F;&#x591A;&#x5E74;&#x524D;&#x5728;&#x65B9;&#x8A00;&#x4E2D;&#x53D1;&#x73B0;&#x7684;&#x4E00;&#x4E2A;&#x53D8;&#x5316;&#xFF0C;&#x4EE5;&#x56DE;&#x5E94;AUTO_INCREMENT&#x5728;&#x6CA1;&#x6709;&#x8FD9;&#x4E2A;&#x989D;&#x5916;KEY&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x4F1A;&#x5728;InnoDB&#x4E0A;&#x5931;&#x8D25;&#x7684;&#x95EE;&#x9898;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-644">&#x8FD9;&#x79CD;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#x5DF2;&#x88AB;&#x5220;&#x9664;&#xFF0C;&#x5E76;&#x66FF;&#x6362;&#x4E3A;&#x4EC5;&#x5728;&#x4E3B;&#x952E;&#x4E2D;&#x58F0;&#x660E;AUTO_INCREMENT&#x5217;<em>first</em>&#x7684;&#x66F4;&#x597D;&#x7CFB;&#x7EDF;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>CREATE TABLE some_table (
    x INTEGER NOT NULL,
    y INTEGER NOT NULL AUTO_INCREMENT,
    PRIMARY KEY (y, x)
)ENGINE=InnoDB</pre></div></div><p><span class="yiyi-st" id="yiyi-645">&#x4E3A;&#x4E86;&#x660E;&#x786E;&#x63A7;&#x5236;&#x4E3B;&#x952E;&#x5217;&#x7684;&#x6392;&#x5E8F;&#xFF0C;&#x663E;&#x5F0F;&#x5730;&#x4F7F;&#x7528;<a class="reference internal" href="core_constraints.html#sqlalchemy.schema.PrimaryKeyConstraint" title="sqlalchemy.schema.PrimaryKeyConstraint"><code class="xref py py-class docutils literal"><span class="pre">PrimaryKeyConstraint</span></code></a>&#x7ED3;&#x6784;&#xFF08;1.1.0b2&#xFF09;&#xFF08;&#x4EE5;&#x53CA;MySQL&#x8981;&#x6C42;&#x7684;&#x81EA;&#x52A8;&#x589E;&#x91CF;&#x5217;&#x7684;KEY&#xFF09;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s1">&apos;some_table&apos;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;x&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;y&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">autoincrement</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
    <span class="n">PrimaryKeyConstraint</span><span class="p">(</span><span class="s1">&apos;x&apos;</span><span class="p">,</span> <span class="s1">&apos;y&apos;</span><span class="p">),</span>
    <span class="n">UniqueConstraint</span><span class="p">(</span><span class="s1">&apos;y&apos;</span><span class="p">),</span>
    <span class="n">mysql_engine</span><span class="o">=</span><span class="s1">&apos;InnoDB&apos;</span>
<span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-646">&#x968F;&#x7740;<a class="reference internal" href="#change-3216"><span>The .autoincrement directive is no longer implicitly enabled for a composite primary key column</span></a>&#x4E0D;&#x518D;&#x4E3A;&#x7EC4;&#x5408;&#x4E3B;&#x952E;&#x5217;&#x9690;&#x5F0F;&#x542F;&#x7528;.autoincrement&#x6307;&#x4EE4;&#xFF0C;&#x73B0;&#x5728;&#x66F4;&#x5BB9;&#x6613;&#x6307;&#x5B9A;&#x5177;&#x6709;&#x6216;&#x4E0D;&#x5177;&#x6709;&#x81EA;&#x52A8;&#x589E;&#x91CF;&#x7684;&#x7EC4;&#x5408;&#x4E3B;&#x952E;&#xFF1B; <a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column.params.autoincrement" title="sqlalchemy.schema.Column"><code class="xref py py-paramref docutils literal"><span class="pre">Column.autoincrement</span></code></a>&#x73B0;&#x5728;&#x9ED8;&#x8BA4;&#x4E3A;<code class="docutils literal"><span class="pre">&quot;auto&quot;</span></code>&#x503C;&#xFF0C;&#x5E76;&#x4E14;&#x4E0D;&#x518D;&#x9700;&#x8981;<code class="docutils literal"><span class="pre">autoincrement=False</span></code>&#x6307;&#x4EE4;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s1">&apos;some_table&apos;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;x&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;y&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">autoincrement</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
    <span class="n">mysql_engine</span><span class="o">=</span><span class="s1">&apos;InnoDB&apos;</span>
<span class="p">)</span></pre></div></div></div></div><div class="section" id="dialect-improvements-and-changes-sqlite"><h2><span class="yiyi-st" id="yiyi-647">&#x65B9;&#x8A00;&#x7684;&#x6539;&#x8FDB;&#x548C;&#x6539;&#x53D8; -  SQLite <a class="headerlink" href="#dialect-improvements-and-changes-sqlite" title="Permalink to this headline">&#xB6;</a></span></h2><div class="section" id="right-nested-join-workaround-lifted-for-sqlite-version-3-7-16"><h3><span class="yiyi-st" id="yiyi-648">&#x4E3A;SQLite 3.7.16&#x7248;&#x672C;&#x63D0;&#x4F9B;&#x4E86;&#x53F3;&#x5D4C;&#x5957;&#x8FDE;&#x63A5;&#x89E3;&#x51B3;&#x65B9;&#x200B;&#x200B;&#x6CD5;<a class="headerlink" href="#right-nested-join-workaround-lifted-for-sqlite-version-3-7-16" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-649">&#x5728;0.9&#x7248;&#x672C;&#x4E2D;&#xFF0C;&#x7531;<a class="reference internal" href="migration_09.html#feature-joins-09"><span>Many JOIN and LEFT OUTER JOIN expressions will no longer be wrapped in (SELECT * FROM ..) AS ANON_1</span></a></span><span class="yiyi-st" id="yiyi-650">Ironically, the version of SQLite noted in that migration note, 3.7.15.2, was the <em>last</em> version of SQLite to actually have this limitation! </span><span class="yiyi-st" id="yiyi-651">&#x4E0B;&#x4E00;&#x4E2A;&#x7248;&#x672C;&#x662F;3.7.16&#xFF0C;&#x5E76;&#x4E14;&#x6B63;&#x786E;&#x5730;&#x6DFB;&#x52A0;&#x4E86;&#x5BF9;&#x6B63;&#x786E;&#x7684;&#x5D4C;&#x5957;&#x8FDE;&#x63A5;&#x7684;&#x652F;&#x6301;&#x3002;</span><span class="yiyi-st" id="yiyi-652">&#x5728;1.1&#x4E2D;&#xFF0C;&#x786E;&#x5B9A;&#x8FDB;&#x884C;&#x6B64;&#x66F4;&#x6539;&#x7684;&#x7279;&#x5B9A;SQLite&#x7248;&#x672C;&#x548C;&#x6E90;&#x63D0;&#x4EA4;&#x7684;&#x5DE5;&#x4F5C;&#x5DF2;&#x5B8C;&#x6210;&#xFF08;SQlite&#x7684;&#x66F4;&#x6539;&#x65E5;&#x5FD7;&#x4E2D;&#x5F15;&#x7528;&#x4E86;&#x9690;&#x542B;&#x77ED;&#x8BED;&#x201C;&#x589E;&#x5F3A;&#x67E5;&#x8BE2;&#x4F18;&#x5316;&#x5668;&#x5229;&#x7528;&#x4F20;&#x9012;&#x8FDE;&#x63A5;&#x7EA6;&#x675F;&#x201D;&#xFF0C;&#x800C;&#x4E0D;&#x94FE;&#x63A5;&#x5230;&#x4EFB;&#x4F55;&#x95EE;&#x9898;&#x7F16;&#x53F7;&#xFF0C;&#x66F4;&#x6539;&#x6570;&#x5B57;&#x6216;&#x8FDB;&#x4E00;&#x6B65;&#x89E3;&#x91CA;&#xFF09;&#xFF0C;&#x5E76;&#x4E14;&#x5F53;DBAPI&#x62A5;&#x544A;3.7.16&#x7248;&#x6216;&#x66F4;&#x9AD8;&#x7248;&#x672C;&#x751F;&#x6548;&#x65F6;&#xFF0C;&#x6B64;&#x66F4;&#x6539;&#x4E2D;&#x63D0;&#x4F9B;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#x73B0;&#x5DF2;&#x89E3;&#x9664;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-653"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3634">&#xFF03;3634  T0&gt;</a></span></p></div><div class="section" id="dotted-column-names-workaround-lifted-for-sqlite-version-3-10-0"><h3><span class="yiyi-st" id="yiyi-654">&#x4E3A;SQLite&#x7248;&#x672C;3.10.0&#x89E3;&#x51B3;&#x4E86;&#x865A;&#x7EBF;&#x5217;&#x540D;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;<a class="headerlink" href="#dotted-column-names-workaround-lifted-for-sqlite-version-3-10-0" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-655">&#x5BF9;&#x4E8E;&#x6570;&#x636E;&#x5E93;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x4E0D;&#x62A5;&#x544A;&#x67D0;&#x4E9B;SQL&#x7ED3;&#x679C;&#x96C6;&#x7684;&#x6B63;&#x786E;&#x5217;&#x540D;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x5728;&#x4F7F;&#x7528;UNION&#x65F6;&#xFF0C;SQLite&#x65B9;&#x8A00;&#x65E9;&#x5C31;&#x6709;&#x4E86;&#x4E00;&#x4E2A;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#x3002;</span><span class="yiyi-st" id="yiyi-656">&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#x8BE6;&#x89C1;<a class="reference internal" href="dialects_sqlite.html#sqlite-dotted-column-names"><span>Dotted Column Names</span></a>&#xFF0C;&#x5E76;&#x8981;&#x6C42;SQLAlchemy&#x5047;&#x5B9A;&#x4EFB;&#x4F55;&#x5E26;&#x6709;&#x70B9;&#x7684;&#x5217;&#x540D;&#x5B9E;&#x9645;&#x4E0A;&#x90FD;&#x662F;&#x901A;&#x8FC7;&#x6B64;&#x9519;&#x8BEF;&#x884C;&#x4E3A;&#x63D0;&#x4F9B;&#x7684;<code class="docutils literal"><span class="pre">tablename.columnname</span></code>&#x7EC4;&#x5408;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<code class="docutils literal"><span class="pre">sqlite_raw_colnames</span></code>&#x6267;&#x884C;&#x9009;&#x9879;&#x5C06;&#x5176;&#x5173;&#x95ED;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-657">&#x4ECE;SQLite&#x7248;&#x672C;3.10.0&#x5F00;&#x59CB;&#xFF0C;UNION&#x548C;&#x5176;&#x4ED6;&#x67E5;&#x8BE2;&#x4E2D;&#x7684;bug&#x5DF2;&#x7ECF;&#x4FEE;&#x590D;&#xFF1B;&#x5C31;&#x50CF;<a class="reference internal" href="#change-3634"><span>Right-nested join workaround lifted for SQLite version 3.7.16</span></a>&#x4E2D;&#x63CF;&#x8FF0;&#x7684;&#x66F4;&#x6539;&#x4E00;&#x6837;&#xFF0C;SQLite&#x7684;&#x66F4;&#x6539;&#x65E5;&#x5FD7;&#x4EC5;&#x5C06;&#x5176;&#x9690;&#x542B;&#x5730;&#x6807;&#x8BC6;&#x4E3A;&#x201C;&#x6DFB;&#x52A0;&#x4E86;sqlite3_index_info&#x7684;colUsed&#x5B57;&#x6BB5;&#x4EE5;&#x4F9B;sqlite3_module.xBestIndex&#x65B9;&#x6CD5;&#x4F7F;&#x7528;&#x201D;&#xFF0C;&#x4F46;&#x662F;&#x6B64;&#x7248;&#x672C;&#x4E0D;&#x518D;&#x9700;&#x8981;SQLAlchemy&#x5BF9;&#x8FD9;&#x4E9B;&#x865A;&#x7EBF;&#x5217;&#x540D;&#x7684;&#x7FFB;&#x8BD1;&#xFF0C;&#x56E0;&#x6B64;&#x5728;&#x68C0;&#x6D4B;&#x5230;3.10.0&#x6216;&#x66F4;&#x9AD8;&#x7248;&#x672C;&#x65F6;&#x5173;&#x95ED;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-658">&#x603B;&#x4F53;&#x800C;&#x8A00;&#xFF0C;&#x4ECE;1.0&#x7CFB;&#x5217;&#x5F00;&#x59CB;&#xFF0C;SQLAlchemy <a class="reference internal" href="core_connections.html#sqlalchemy.engine.ResultProxy" title="sqlalchemy.engine.ResultProxy"><code class="xref py py-class docutils literal"><span class="pre">ResultProxy</span></code></a>&#x5728;&#x4E3A;Core&#x548C;ORM SQL&#x7ED3;&#x6784;&#x63D0;&#x4F9B;&#x7ED3;&#x679C;&#x65F6;&#xFF0C;&#x5BF9;&#x7ED3;&#x679C;&#x96C6;&#x4E2D;&#x7684;&#x5217;&#x540D;&#x7684;&#x4F9D;&#x8D56;&#x8981;&#x5C11;&#x5F97;&#x591A;&#xFF0C;&#x56E0;&#x6B64;&#x5728;&#x4EFB;&#x4F55;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6B64;&#x95EE;&#x9898;&#x7684;&#x91CD;&#x8981;&#x6027;&#x90FD;&#x5DF2;&#x51CF;&#x8F7B;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-659"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3633">&#xFF03;3633  T0&gt;</a></span></p></div><div class="section" id="improved-support-for-remote-schemas"><h3><span class="yiyi-st" id="yiyi-660">&#x6539;&#x8FDB;&#x4E86;&#x5BF9;&#x8FDC;&#x7A0B;&#x6A21;&#x5F0F;&#x7684;&#x652F;&#x6301;<a class="headerlink" href="#improved-support-for-remote-schemas" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-661">The SQLite dialect now implements <a class="reference internal" href="core_reflection.html#sqlalchemy.engine.reflection.Inspector.get_schema_names" title="sqlalchemy.engine.reflection.Inspector.get_schema_names"><code class="xref py py-meth docutils literal"><span class="pre">Inspector.get_schema_names()</span></code></a> and additionally has improved support for tables and indexes that are created and reflected from a remote schema, which in SQLite is a dataase that is assigned a name via the <code class="docutils literal"><span class="pre">ATTACH</span></code> statement; previously, the``CREATE INDEX`` DDL didn&#x2019;t work correctly for a schema-bound table and the <a class="reference internal" href="core_reflection.html#sqlalchemy.engine.reflection.Inspector.get_foreign_keys" title="sqlalchemy.engine.reflection.Inspector.get_foreign_keys"><code class="xref py py-meth docutils literal"><span class="pre">Inspector.get_foreign_keys()</span></code></a> method will now indicate the given schema in the results. </span><span class="yiyi-st" id="yiyi-662">&#x4E0D;&#x652F;&#x6301;&#x8DE8;&#x6A21;&#x5F0F;&#x5916;&#x952E;&#x3002;</span></p></div><div class="section" id="reflection-of-the-name-of-primary-key-constraints"><h3><span class="yiyi-st" id="yiyi-663">PRIMARY KEY&#x7EA6;&#x675F;&#x540D;&#x79F0;&#x7684;&#x53CD;&#x6620;<a class="headerlink" href="#reflection-of-the-name-of-primary-key-constraints" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-664">SQLite&#x540E;&#x7AEF;&#x73B0;&#x5728;&#x5229;&#x7528;SQLite&#x7684;&#x201C;sqlite_master&#x201D;&#x89C6;&#x56FE;&#x6765;&#x4ECE;&#x539F;&#x59CB;DDL&#x4E2D;&#x63D0;&#x53D6;&#x8868;&#x7684;&#x4E3B;&#x952E;&#x7EA6;&#x675F;&#x7684;&#x540D;&#x79F0;&#xFF0C;&#x4E0E;&#x6700;&#x8FD1;SQLAlchemy&#x7248;&#x672C;&#x4E2D;&#x7684;&#x5916;&#x952E;&#x7EA6;&#x675F;&#x6240;&#x5B9E;&#x73B0;&#x7684;&#x65B9;&#x5F0F;&#x76F8;&#x540C;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-665"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3629">&#xFF03;3629  T0&gt;</a></span></p></div><div class="section" id="id1"><h3><span class="yiyi-st" id="yiyi-666">&#x68C0;&#x67E5;&#x7EA6;&#x675F;&#x73B0;&#x5728;&#x53CD;&#x6620;<a class="headerlink" href="#id1" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-667">SQLite&#x65B9;&#x8A00;&#x73B0;&#x5728;&#x652F;&#x6301;&#x5728;<code class="xref py py-attr docutils literal"><span class="pre">Table.constraints</span></code>&#x5185;&#x7684;&#x65B9;&#x6CD5;<a class="reference internal" href="core_reflection.html#sqlalchemy.engine.reflection.Inspector.get_check_constraints" title="sqlalchemy.engine.reflection.Inspector.get_check_constraints"><code class="xref py py-meth docutils literal"><span class="pre">Inspector.get_check_constraints()</span></code></a>&#x4EE5;&#x53CA;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal"><span class="pre">Table</span></code></a>&#x53CD;&#x5C04;&#x5185;&#x53CD;&#x6620;CHECK&#x7EA6;&#x675F;&#x3002;&#x91C7;&#x96C6;&#x3002;</span></p></div><div class="section" id="on-delete-and-on-update-foreign-key-phrases-now-reflect"><h3><span class="yiyi-st" id="yiyi-668">ON DELETE&#x548C;ON UPDATE&#x5916;&#x952E;&#x5173;&#x952E;&#x77ED;&#x8BED;&#x73B0;&#x5728;&#x53CD;&#x6620;<a class="headerlink" href="#on-delete-and-on-update-foreign-key-phrases-now-reflect" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-669">The <a class="reference internal" href="core_reflection.html#sqlalchemy.engine.reflection.Inspector" title="sqlalchemy.engine.reflection.Inspector"><code class="xref py py-class docutils literal"><span class="pre">Inspector</span></code></a> will now include ON DELETE and ON UPDATE phrases from foreign key constraints on the SQLite dialect, and the <a class="reference internal" href="core_constraints.html#sqlalchemy.schema.ForeignKeyConstraint" title="sqlalchemy.schema.ForeignKeyConstraint"><code class="xref py py-class docutils literal"><span class="pre">ForeignKeyConstraint</span></code></a> object as reflected as part of a <a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal"><span class="pre">Table</span></code></a> will also indicate these phrases.</span></p></div></div><div class="section" id="dialect-improvements-and-changes-sql-server"><h2><span class="yiyi-st" id="yiyi-670">&#x65B9;&#x8A00;&#x7684;&#x6539;&#x8FDB;&#x548C;&#x6539;&#x53D8; -  SQL Server <a class="headerlink" href="#dialect-improvements-and-changes-sql-server" title="Permalink to this headline">&#xB6;</a></span></h2><div class="section" id="added-transaction-isolation-level-support-for-sql-server"><h3><span class="yiyi-st" id="yiyi-671">&#x589E;&#x52A0;&#x4E86;SQL Server <a class="headerlink" href="#added-transaction-isolation-level-support-for-sql-server" title="Permalink to this headline">&#xB6;</a>&#x7684;&#x4E8B;&#x52A1;&#x9694;&#x79BB;&#x7EA7;&#x522B;&#x652F;&#x6301;</span></h3><p><span class="yiyi-st" id="yiyi-672">&#x6240;&#x6709;SQL Server&#x65B9;&#x8A00;&#x90FD;&#x901A;&#x8FC7;<a class="reference internal" href="core_engines.html#sqlalchemy.create_engine.params.isolation_level" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal"><span class="pre">create_engine.isolation_level</span></code></a>&#x548C;<a class="reference internal" href="core_connections.html#sqlalchemy.engine.Connection.execution_options.params.isolation_level" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal"><span class="pre">Connection.execution_options.isolation_level</span></code></a>&#x53C2;&#x6570;&#x652F;&#x6301;&#x4E8B;&#x52A1;&#x9694;&#x79BB;&#x7EA7;&#x522B;&#x8BBE;&#x7F6E;&#x3002;</span><span class="yiyi-st" id="yiyi-673">&#x652F;&#x6301;&#x56DB;&#x79CD;&#x6807;&#x51C6;&#x7EA7;&#x522B;&#x4EE5;&#x53CA;<code class="docutils literal"><span class="pre">SNAPSHOT</span></code>&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
    <span class="s2">&quot;mssql+pyodbc://scott:tiger@ms_2008&quot;</span><span class="p">,</span>
    <span class="n">isolation_level</span><span class="o">=</span><span class="s2">&quot;REPEATABLE READ&quot;</span>
<span class="p">)</span></pre></div></div><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-674">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-675"><a class="reference internal" href="dialects_mssql.html#mssql-isolation-level"><span>Transaction Isolation Level</span></a></span></p></div><p><span class="yiyi-st" id="yiyi-676"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3534">&#xFF03;3534  T0&gt;</a></span></p></div><div class="section" id="string-varlength-types-no-longer-represent-max-explicitly-on-reflection"><h3><span class="yiyi-st" id="yiyi-677">&#x5B57;&#x7B26;&#x4E32;/ varlength&#x7C7B;&#x578B;&#x4E0D;&#x518D;&#x5728;&#x53CD;&#x5C04;<a class="headerlink" href="#string-varlength-types-no-longer-represent-max-explicitly-on-reflection" title="Permalink to this headline">&#xB6;</a>&#x4E0A;&#x660E;&#x786E;&#x8868;&#x793A;&#x201C;max&#x201D;</span></h3><p><span class="yiyi-st" id="yiyi-678">&#x53CD;&#x6620;<a class="reference internal" href="core_type_basics.html#sqlalchemy.types.String" title="sqlalchemy.types.String"><code class="xref py py-class docutils literal"><span class="pre">String</span></code></a>&#xFF0C;<a class="reference internal" href="core_type_basics.html#sqlalchemy.types.Text" title="sqlalchemy.types.Text"><code class="xref py py-class docutils literal"><span class="pre">Text</span></code></a>&#x7B49;&#x7C7B;&#x578B;&#x65F6;</span><span class="yiyi-st" id="yiyi-679">&#x5176;&#x4E2D;&#x5305;&#x62EC;&#x4E00;&#x4E2A;&#x957F;&#x5EA6;&#xFF0C;SQL Server&#x4E0B;&#x7684;&#x201C;un-extended&#x201D;&#x7C7B;&#x578B;&#x4F1A;&#x5C06;&#x201C;length&#x201D;&#x53C2;&#x6570;&#x590D;&#x5236;&#x4E3A;&#x503C;<code class="docutils literal"><span class="pre">&quot;max&quot;</span></code>&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span><span class="p">,</span> <span class="n">inspect</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&apos;mssql+pyodbc://scott:tiger@ms_2008&apos;</span><span class="p">,</span> <span class="n">echo</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;create table s (x varchar(max), y varbinary(max))&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">insp</span> <span class="o">=</span> <span class="n">inspect</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">insp</span><span class="o">.</span><span class="n">get_columns</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="s1">&apos;type&apos;</span><span class="p">]</span><span class="o">.</span><span class="n">__class__</span><span class="p">,</span> <span class="n">col</span><span class="p">[</span><span class="s1">&apos;type&apos;</span><span class="p">]</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">&lt;class &apos;sqlalchemy.sql.sqltypes.VARCHAR&apos;&gt; max</span>
<span class="go">&lt;class &apos;sqlalchemy.dialects.mssql.base.VARBINARY&apos;&gt; max</span></pre></div></div><p><span class="yiyi-st" id="yiyi-680">&#x9884;&#x8BA1;&#x57FA;&#x672C;&#x7C7B;&#x578B;&#x4E2D;&#x7684;&#x201C;length&#x201D;&#x53C2;&#x6570;&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x6574;&#x6570;&#x503C;&#x6216;None&#xFF1B; None&#x8868;&#x793A;SQL Server&#x65B9;&#x8A00;&#x89E3;&#x91CA;&#x4E3A;&#x201C;max&#x201D;&#x7684;&#x65E0;&#x9650;&#x957F;&#x5EA6;&#x3002;</span><span class="yiyi-st" id="yiyi-681">&#x7136;&#x540E;&#x4FEE;&#x6B63;&#x662F;&#x8FD9;&#x6837;&#x7684;&#xFF0C;&#x8FD9;&#x4E9B;&#x957F;&#x5EA6;&#x662F;None&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x4E9B;&#x7C7B;&#x578B;&#x5BF9;&#x8C61;&#x5728;&#x975E;SQL Server&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x5DE5;&#x4F5C;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">insp</span><span class="o">.</span><span class="n">get_columns</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="s1">&apos;type&apos;</span><span class="p">]</span><span class="o">.</span><span class="n">__class__</span><span class="p">,</span> <span class="n">col</span><span class="p">[</span><span class="s1">&apos;type&apos;</span><span class="p">]</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">&lt;class &apos;sqlalchemy.sql.sqltypes.VARCHAR&apos;&gt; None</span>
<span class="go">&lt;class &apos;sqlalchemy.dialects.mssql.base.VARBINARY&apos;&gt; None</span></pre></div></div><p><span class="yiyi-st" id="yiyi-682">&#x53EF;&#x80FD;&#x4F9D;&#x8D56;&#x4E8E;&#x201C;&#x957F;&#x5EA6;&#x201D;&#x503C;&#x4E0E;&#x5B57;&#x7B26;&#x4E32;&#x201C;max&#x201D;&#x76F4;&#x63A5;&#x6BD4;&#x8F83;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5E94;&#x8BE5;&#x5C06;<code class="docutils literal"><span class="pre">None</span></code>&#x7684;&#x503C;&#x89C6;&#x4E3A;&#x540C;&#x4E00;&#x4EF6;&#x4E8B;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-683"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3504">&#xFF03;3504  T0&gt;</a></span></p></div><div class="section" id="support-for-non-clustered-on-primary-key-to-allow-clustered-elsewhere"><h3><span class="yiyi-st" id="yiyi-684">&#x652F;&#x6301;&#x4E3B;&#x952E;&#x4E0A;&#x7684;&#x201C;&#x975E;&#x7FA4;&#x96C6;&#x201D;&#x4EE5;&#x5141;&#x8BB8;&#x5728;&#x5176;&#x4ED6;&#x5730;&#x65B9;&#x7FA4;&#x96C6;<a class="headerlink" href="#support-for-non-clustered-on-primary-key-to-allow-clustered-elsewhere" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-685"><a class="reference internal" href="core_constraints.html#sqlalchemy.schema.UniqueConstraint" title="sqlalchemy.schema.UniqueConstraint"><code class="xref py py-class docutils literal"><span class="pre">UniqueConstraint</span></code></a>&#xFF0C;<a class="reference internal" href="core_constraints.html#sqlalchemy.schema.PrimaryKeyConstraint" title="sqlalchemy.schema.PrimaryKeyConstraint"><code class="xref py py-class docutils literal"><span class="pre">PrimaryKeyConstraint</span></code></a>&#xFF0C;<a class="reference internal" href="core_constraints.html#sqlalchemy.schema.Index" title="sqlalchemy.schema.Index"><code class="xref py py-class docutils literal"><span class="pre">Index</span></code></a>&#x4E0A;&#x53EF;&#x7528;&#x7684;<code class="docutils literal"><span class="pre">mssql_clustered</span></code>&#x6807;&#x5FD7;&#x73B0;&#x5728;&#x9ED8;&#x8BA4;&#x4E3A;<code class="docutils literal"><span class="pre">None</span></code>&#xFF0C;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x4E3A;False&#xFF0C;&#x8FD9;&#x5C06;&#x4F1A;&#x4E3A;&#x4E3B;&#x952E;&#x7279;&#x522B;&#x5448;&#x73B0;NONCLUSTERED&#x5173;&#x952E;&#x5B57;&#xFF0C;&#x4ECE;&#x800C;&#x5141;&#x8BB8;&#x5C06;&#x4E0D;&#x540C;&#x7684;&#x7D22;&#x5F15;&#x7528;&#x4F5C;&#x201C;&#x805A;&#x96C6;&#x201D;&#x3002;</span></p><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-686">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-687"><a class="reference internal" href="dialects_mssql.html#mssql-indexes"><span>Clustered Index Support</span></a></span></p></div></div><div class="section" id="the-legacy-schema-aliasing-flag-is-now-set-to-false"><h3><span class="yiyi-st" id="yiyi-688">legacy_schema_aliasing&#x6807;&#x5FD7;&#x73B0;&#x5728;&#x8BBE;&#x7F6E;&#x4E3A;False <a class="headerlink" href="#the-legacy-schema-aliasing-flag-is-now-set-to-false" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-689">SQLAlchemy 1.0.5 introduced the <code class="docutils literal"><span class="pre">legacy_schema_aliasing</span></code> flag to the MSSQL dialect, allowing so-called &#x201C;legacy mode&#x201D; aliasing to be turned off. </span><span class="yiyi-st" id="yiyi-690">&#x8FD9;&#x79CD;&#x522B;&#x540D;&#x5C1D;&#x8BD5;&#x5C06;&#x6A21;&#x5F0F;&#x9650;&#x5B9A;&#x7684;&#x8868;&#x8F6C;&#x6362;&#x4E3A;&#x522B;&#x540D;&#xFF1B;&#x7ED9;&#x5B9A;&#x4E00;&#x4E2A;&#x8868;&#x683C;&#x5982;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">account_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s1">&apos;account&apos;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;id&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;info&apos;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">100</span><span class="p">)),</span>
    <span class="n">schema</span><span class="o">=</span><span class="s2">&quot;customer_schema&quot;</span>
<span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-691">&#x4F20;&#x7EDF;&#x7684;&#x884C;&#x4E3A;&#x6A21;&#x5F0F;&#x5C06;&#x5C1D;&#x8BD5;&#x5C06;&#x7B26;&#x5408;&#x6A21;&#x5F0F;&#x7684;&#x8868;&#x540D;&#x79F0;&#x53D8;&#x4E3A;&#x522B;&#x540D;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">eng</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;mssql+pymssql://mydsn&quot;</span><span class="p">,</span> <span class="n">legacy_schema_aliasing</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">account_table</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">eng</span><span class="p">))</span>
<span class="go">SELECT account_1.id, account_1.info</span>
<span class="go">FROM customer_schema.account AS account_1</span></pre></div></div><p><span class="yiyi-st" id="yiyi-692">&#x4F46;&#x662F;&#xFF0C;&#x8FD9;&#x79CD;&#x522B;&#x540D;&#x5DF2;&#x88AB;&#x8BC1;&#x660E;&#x662F;&#x4E0D;&#x5FC5;&#x8981;&#x7684;&#xFF0C;&#x5E76;&#x4E14;&#x5728;&#x8BB8;&#x591A;&#x60C5;&#x51B5;&#x4E0B;&#x4F1A;&#x4EA7;&#x751F;&#x4E0D;&#x6B63;&#x786E;&#x7684;SQL&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-693">&#x5728;SQLAlchemy 1.1&#x4E2D;&#xFF0C;<code class="docutils literal"><span class="pre">legacy_schema_aliasing</span></code>&#x6807;&#x5FD7;&#x73B0;&#x5728;&#x9ED8;&#x8BA4;&#x4E3A;False&#xFF0C;&#x7981;&#x7528;&#x8FD9;&#x79CD;&#x884C;&#x4E3A;&#x6A21;&#x5F0F;&#xFF0C;&#x5E76;&#x5141;&#x8BB8;MSSQL&#x65B9;&#x8A00;&#x5BF9;&#x4F7F;&#x7528;&#x6A21;&#x5F0F;&#x9650;&#x5B9A;&#x7684;&#x8868;&#x6B63;&#x5E38;&#x8FD0;&#x884C;&#x3002;</span><span class="yiyi-st" id="yiyi-694">&#x5BF9;&#x4E8E;&#x53EF;&#x80FD;&#x4F9D;&#x8D56;&#x6B64;&#x884C;&#x4E3A;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x5C06;&#x6807;&#x5FD7;&#x8BBE;&#x7F6E;&#x4E3A;True&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-695"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3434">&#xFF03;3434  T0&gt;</a></span></p></div></div><div class="section" id="dialect-improvements-and-changes-oracle"><h2><span class="yiyi-st" id="yiyi-696">&#x65B9;&#x8A00;&#x7684;&#x6539;&#x8FDB;&#x548C;&#x6539;&#x53D8; -  Oracle <a class="headerlink" href="#dialect-improvements-and-changes-oracle" title="Permalink to this headline">&#xB6;</a></span></h2><div class="section" id="support-for-skip-locked"><h3><span class="yiyi-st" id="yiyi-697">&#x652F;&#x6301;SKIP LOCKED <a class="headerlink" href="#support-for-skip-locked" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-698">Core&#x548C;ORM&#x4E2D;&#x7684;&#x65B0;&#x53C2;&#x6570;<a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.GenerativeSelect.with_for_update.params.skip_locked" title="sqlalchemy.sql.expression.GenerativeSelect.with_for_update"><code class="xref py py-paramref docutils literal"><span class="pre">GenerativeSelect.with_for_update.skip_locked</span></code></a>&#x5C06;&#x751F;&#x6210;&#x201C;SELECT ... FOR UPDATE&#x201D;&#x6216;&#x201C;SELECT .. FOR SHARE&#x201D;&#x67E5;&#x8BE2;&#x7684;&#x201C;SKIP LOCKED&#x201D;&#x540E;&#x7F00;&#x3002;</span></p></div></div>