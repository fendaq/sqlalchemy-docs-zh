<h1><span class="yiyi-st" id="yiyi-94">SQLAlchemy 0.8&#x6709;&#x54EA;&#x4E9B;&#x65B0;&#x7279;&#x6027;&#xFF1F;<a class="headerlink" href="#what-s-new-in-sqlalchemy-0-8" title="Permalink to this headline">&#xB6;</a></span></h1><div class="admonition-about-this-document admonition"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-95">&#x5173;&#x4E8E;&#x672C;&#x6587;&#x6863;</span></p><p><span class="yiyi-st" id="yiyi-96">&#x672C;&#x6587;&#x6863;&#x4ECB;&#x7ECD;&#x4E86;&#x622A;&#x81F3;2012&#x5E74;10&#x6708;&#x53D1;&#x5E03;&#x7684;SQLAlchemy&#x7248;&#x672C;0.7&#xFF0C;&#x4EE5;&#x53CA;&#x9884;&#x8BA1;2013&#x5E74;&#x521D;&#x53D1;&#x5E03;&#x7684;SQLAlchemy&#x7248;&#x672C;0.8&#x4E4B;&#x95F4;&#x7684;&#x53D8;&#x5316;&#x3002;</span></p><p class="last"><span class="yiyi-st" id="yiyi-97">&#x6587;&#x4EF6;&#x65E5;&#x671F;&#xFF1A;2012&#x5E74;10&#x6708;25&#x65E5;&#x66F4;&#x65B0;&#x65E5;&#x671F;&#xFF1A;2013&#x5E74;3&#x6708;9&#x65E5;</span></p></div><div class="section" id="introduction"><h2><span class="yiyi-st" id="yiyi-98">&#x5F15;&#x8A00;<a class="headerlink" href="#introduction" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h2><p><span class="yiyi-st" id="yiyi-99">&#x672C;&#x6307;&#x5357;&#x4ECB;&#x7ECD;&#x4E86;SQLAlchemy 0.8&#x7248;&#x4E2D;&#x7684;&#x65B0;&#x589E;&#x529F;&#x80FD;&#xFF0C;&#x5E76;&#x4ECB;&#x7ECD;&#x4E86;&#x5F71;&#x54CD;&#x7528;&#x6237;&#x5C06;&#x5176;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4ECE;0.7&#x7CFB;&#x5217;SQLAlchemy&#x8FC1;&#x79FB;&#x5230;0.8&#x7684;&#x66F4;&#x6539;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-100">SQLAlchemy&#x7248;&#x672C;&#x5C06;&#x5728;1.0&#x7248;&#x4E2D;&#x5173;&#x95ED;&#xFF0C;&#x800C;0.5&#x7248;&#x4EE5;&#x540E;&#x7684;&#x6BCF;&#x4E2A;&#x65B0;&#x7248;&#x672C;&#x90FD;&#x4F1A;&#x51CF;&#x5C11;&#x4E3B;&#x8981;&#x7684;&#x4F7F;&#x7528;&#x66F4;&#x6539;&#x3002;</span><span class="yiyi-st" id="yiyi-101">&#x5927;&#x90E8;&#x5206;&#x5E94;&#x7528;&#x73B0;&#x4EE3;0.7&#x6A21;&#x5F0F;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5E94;&#x8BE5;&#x53EF;&#x4EE5;&#x79FB;&#x52A8;&#x5230;0.8&#x800C;&#x65E0;&#x9700;&#x66F4;&#x6539;&#x3002;</span><span class="yiyi-st" id="yiyi-102">&#x4F7F;&#x7528;0.6&#x751A;&#x81F3;0.5&#x6A21;&#x5F0F;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E5F;&#x5E94;&#x8BE5;&#x76F4;&#x63A5;&#x8FC1;&#x79FB;&#x5230;0.8&#xFF0C;&#x5C3D;&#x7BA1;&#x66F4;&#x5927;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x6BCF;&#x4E2A;&#x4E34;&#x65F6;&#x7248;&#x672C;&#x8FDB;&#x884C;&#x6D4B;&#x8BD5;&#x3002;</span></p></div><div class="section" id="platform-support"><h2><span class="yiyi-st" id="yiyi-103">&#x5E73;&#x53F0;&#x652F;&#x6301;<a class="headerlink" href="#platform-support" title="Permalink to this headline">&#xB6;</a></span></h2><div class="section" id="targeting-python-2-5-and-up-now"><h3><span class="yiyi-st" id="yiyi-104">&#x9488;&#x5BF9;Python 2.5&#x53CA;&#x66F4;&#x9AD8;&#x7248;&#x672C;<a class="headerlink" href="#targeting-python-2-5-and-up-now" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-105">SQLAlchemy 0.8&#x5C06;&#x9488;&#x5BF9;Python 2.5&#x5E76;&#x8F6C;&#x53D1;&#xFF1B; Python 2.4&#x7684;&#x517C;&#x5BB9;&#x6027;&#x6B63;&#x5728;&#x88AB;&#x4E22;&#x5F03;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-106">The internals will be able to make usage of Python ternaries (that is, <code class="docutils literal"><span class="pre">x</span> <span class="pre">if</span> <span class="pre">y</span> <span class="pre">else</span> <span class="pre">z</span></code>) which will improve things versus the usage of <code class="docutils literal"><span class="pre">y</span> <span class="pre">and</span> <span class="pre">x</span> <span class="pre">or</span> <span class="pre">z</span></code>, which naturally has been the source of some bugs, as well as context managers (that is, <code class="docutils literal"><span class="pre">with:</span></code>) and perhaps in some cases <code class="docutils literal"><span class="pre">try:/except:/else:</span></code> blocks which will help with code readability.</span></p><p><span class="yiyi-st" id="yiyi-107">SQLAlchemy&#x6700;&#x7EC8;&#x4E5F;&#x4F1A;&#x51CF;&#x5C11;2.5&#x7684;&#x652F;&#x6301; - &#x5F53;2.6&#x8FBE;&#x5230;&#x57FA;&#x7EBF;&#x65F6;&#xFF0C;SQLAlchemy&#x5C06;&#x8F6C;&#x800C;&#x4F7F;&#x7528;2.6 / 3.3&#x539F;&#x5730;&#x517C;&#x5BB9;&#x6027;&#xFF0C;&#x53BB;&#x6389;<code class="docutils literal"><span class="pre">2to3</span></code>&#x5DE5;&#x5177;&#x7684;&#x4F7F;&#x7528;&#x5E76;&#x7EF4;&#x62A4;&#x4E00;&#x4E2A;&#x6E90;&#x4EE3;&#x7801;&#x5E93;&#x4E0E;Python 2&#x548C;3&#x540C;&#x65F6;&#x5DE5;&#x4F5C;&#x3002;</span></p></div></div><div class="section" id="new-orm-features"><h2><span class="yiyi-st" id="yiyi-108">&#x65B0;&#x7684;ORM&#x529F;&#x80FD;<a class="headerlink" href="#new-orm-features" title="Permalink to this headline">&#xB6;</a></span></h2><div class="section" id="rewritten-relationship-mechanics"><h3><span class="yiyi-st" id="yiyi-109">&#x91CD;&#x5199;<a class="reference internal" href="orm_relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#x7ED3;&#x6784;<a class="headerlink" href="#rewritten-relationship-mechanics" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-110">0.8&#x7279;&#x6027;&#x662F;&#x4E00;&#x4E2A;&#x5173;&#x4E8E;&#x5982;&#x4F55;<a class="reference internal" href="orm_relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#x786E;&#x5B9A;&#x5982;&#x4F55;&#x5728;&#x4E24;&#x4E2A;&#x5B9E;&#x4F53;&#x4E4B;&#x95F4;&#x8FDB;&#x884C;&#x8FDE;&#x63A5;&#x7684;&#x6539;&#x8FDB;&#x4E14;&#x529F;&#x80FD;&#x5F3A;&#x5927;&#x7684;&#x7CFB;&#x7EDF;&#x3002;</span><span class="yiyi-st" id="yiyi-111">&#x65B0;&#x7CFB;&#x7EDF;&#x5305;&#x542B;&#x4EE5;&#x4E0B;&#x529F;&#x80FD;&#xFF1A;</span></p><ul><li><p class="first"><span class="yiyi-st" id="yiyi-112">The <code class="docutils literal"><span class="pre">primaryjoin</span></code> argument is <strong>no longer needed</strong> when constructing a <a class="reference internal" href="orm_relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a> against a class that has multiple foreign key paths to the target. </span><span class="yiyi-st" id="yiyi-113">&#x53EA;&#x9700;&#x8981;<code class="docutils literal"><span class="pre">foreign_keys</span></code>&#x53C2;&#x6570;&#x6765;&#x6307;&#x5B9A;&#x5E94;&#x5305;&#x542B;&#x7684;&#x5217;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Parent</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;parent&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">child_id_one</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;child.id&apos;</span><span class="p">))</span>
    <span class="n">child_id_two</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;child.id&apos;</span><span class="p">))</span>

    <span class="n">child_one</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Child&quot;</span><span class="p">,</span> <span class="n">foreign_keys</span><span class="o">=</span><span class="n">child_id_one</span><span class="p">)</span>
    <span class="n">child_two</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Child&quot;</span><span class="p">,</span> <span class="n">foreign_keys</span><span class="o">=</span><span class="n">child_id_two</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Child</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;child&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div></div></li><li><p class="first"><span class="yiyi-st" id="yiyi-114">&#x4E0E;&#x81EA;&#x5F15;&#x7528;&#x5173;&#x7CFB;&#x7684;&#x5173;&#x7CFB;&#xFF0C;&#x73B0;&#x5728;&#x652F;&#x6301;<strong>&#x5217;&#x6307;&#x5411;&#x81EA;&#x8EAB;</strong>&#x7684;&#x590D;&#x5408;&#x5916;&#x952E;&#x3002;</span><span class="yiyi-st" id="yiyi-115">&#x89C4;&#x8303;&#x60C5;&#x51B5;&#x5982;&#x4E0B;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Folder</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;folder&apos;</span>
    <span class="n">__table_args__</span> <span class="o">=</span> <span class="p">(</span>
      <span class="n">ForeignKeyConstraint</span><span class="p">(</span>
          <span class="p">[</span><span class="s1">&apos;account_id&apos;</span><span class="p">,</span> <span class="s1">&apos;parent_id&apos;</span><span class="p">],</span>
          <span class="p">[</span><span class="s1">&apos;folder.account_id&apos;</span><span class="p">,</span> <span class="s1">&apos;folder.folder_id&apos;</span><span class="p">]),</span>
    <span class="p">)</span>

    <span class="n">account_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">folder_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">parent_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>

    <span class="n">parent_folder</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Folder&quot;</span><span class="p">,</span>
                        <span class="n">backref</span><span class="o">=</span><span class="s2">&quot;child_folders&quot;</span><span class="p">,</span>
                        <span class="n">remote_side</span><span class="o">=</span><span class="p">[</span><span class="n">account_id</span><span class="p">,</span> <span class="n">folder_id</span><span class="p">]</span>
                  <span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-116">Above, the <code class="docutils literal"><span class="pre">Folder</span></code> refers to its parent <code class="docutils literal"><span class="pre">Folder</span></code> joining from <code class="docutils literal"><span class="pre">account_id</span></code> to itself, and <code class="docutils literal"><span class="pre">parent_id</span></code> to <code class="docutils literal"><span class="pre">folder_id</span></code>. </span><span class="yiyi-st" id="yiyi-117">&#x5F53;SQLAlchemy&#x6784;&#x9020;&#x4E00;&#x4E2A;&#x81EA;&#x52A8;&#x8FDE;&#x63A5;&#x65F6;&#xFF0C;&#x5B83;&#x4E0D;&#x518D;&#x53EF;&#x4EE5;&#x5047;&#x8BBE;&#x201C;&#x8FDC;&#x7A0B;&#x201D;&#x4E00;&#x4FA7;&#x7684;&#x6240;&#x6709;&#x5217;&#x90FD;&#x662F;&#x522B;&#x540D;&#xFF0C;&#x800C;&#x201C;&#x672C;&#x5730;&#x201D;&#x4E00;&#x4FA7;&#x7684;&#x6240;&#x6709;&#x5217;&#x90FD;&#x4E0D;&#x662F;&#x8FD9;&#x6837; -  <code class="docutils literal"><span class="pre">account_id</span></code>&#x5217;&#x662F;<strong>&#x4E24;&#x8FB9;</strong>&#x3002;</span><span class="yiyi-st" id="yiyi-118">&#x6240;&#x4EE5;&#x5185;&#x90E8;&#x5173;&#x7CFB;&#x673A;&#x5236;&#x88AB;&#x5B8C;&#x5168;&#x91CD;&#x5199;&#x4EE5;&#x652F;&#x6301;&#x5B8C;&#x5168;&#x4E0D;&#x540C;&#x7684;&#x7CFB;&#x7EDF;&#xFF0C;&#x7531;&#x6B64;&#x751F;&#x6210;&#x4E24;&#x4E2A;<code class="docutils literal"><span class="pre">account_id</span></code>&#x526F;&#x672C;&#xFF0C;&#x6BCF;&#x4E2A;&#x526F;&#x672C;&#x5305;&#x542B;&#x4E0D;&#x540C;&#x7684;<em>&#x6CE8;&#x91CA;</em>&#x4EE5;&#x786E;&#x5B9A;&#x5B83;&#x4EEC;&#x5728;&#x8BED;&#x53E5;&#x4E2D;&#x7684;&#x89D2;&#x8272;&#x3002;</span><span class="yiyi-st" id="yiyi-119">&#x8BF7;&#x6CE8;&#x610F;&#x57FA;&#x672C;&#x70ED;&#x5207;&#x8D1F;&#x8F7D;&#x4E2D;&#x7684;&#x8FDE;&#x63A5;&#x6761;&#x4EF6;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT
    folder.account_id AS folder_account_id,
    folder.folder_id AS folder_folder_id,
    folder.parent_id AS folder_parent_id,
    folder.name AS folder_name,
    folder_1.account_id AS folder_1_account_id,
    folder_1.folder_id AS folder_1_folder_id,
    folder_1.parent_id AS folder_1_parent_id,
    folder_1.name AS folder_1_name
FROM folder
    LEFT OUTER JOIN folder AS folder_1
    ON
        folder_1.account_id = folder.account_id
        AND folder.folder_id = folder_1.parent_id

WHERE folder.folder_id = ? AND folder.account_id = ?</pre></div></div></li><li><p class="first"><span class="yiyi-st" id="yiyi-120">&#x4EE5;&#x524D;&#x5F88;&#x96BE;&#x7684;&#x81EA;&#x5B9A;&#x4E49;&#x8FDE;&#x63A5;&#x6761;&#x4EF6;&#xFF0C;&#x5982;&#x6D89;&#x53CA;&#x51FD;&#x6570;&#x548C;/&#x6216;CASTing&#x7C7B;&#x578B;&#x7684;&#x8FDE;&#x63A5;&#x6761;&#x4EF6;&#xFF0C;&#x73B0;&#x5728;&#x5728;&#x5927;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x4E0B;&#x4F1A;&#x6309;&#x9884;&#x671F;&#x8FD0;&#x884C;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">HostEntry</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;host_entry&apos;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">ip_address</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">INET</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>

    <span class="c1"># relationship() using explicit foreign_keys, remote_side</span>
    <span class="n">parent_host</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;HostEntry&quot;</span><span class="p">,</span>
                        <span class="n">primaryjoin</span><span class="o">=</span><span class="n">ip_address</span> <span class="o">==</span> <span class="n">cast</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">INET</span><span class="p">),</span>
                        <span class="n">foreign_keys</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                        <span class="n">remote_side</span><span class="o">=</span><span class="n">ip_address</span>
                    <span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-121">&#x65B0;&#x7684;<a class="reference internal" href="orm_relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#x673A;&#x5236;&#x5229;&#x7528;&#x4E86;&#x88AB;&#x79F0;&#x4E3A;<a class="reference internal" href="glossary.html#term-annotations"><span class="xref std std-term">annotations</span></a>&#x7684;SQLAlchemy&#x6982;&#x5FF5;&#x3002;</span><span class="yiyi-st" id="yiyi-122">&#x8FD9;&#x4E9B;&#x6CE8;&#x91CA;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<a class="reference internal" href="orm_relationship_api.html#sqlalchemy.orm.foreign" title="sqlalchemy.orm.foreign"><code class="xref py py-func docutils literal"><span class="pre">foreign()</span></code></a>&#x548C;<a class="reference internal" href="orm_relationship_api.html#sqlalchemy.orm.remote" title="sqlalchemy.orm.remote"><code class="xref py py-func docutils literal"><span class="pre">remote()</span></code></a>&#x51FD;&#x6570;&#x663E;&#x5F0F;&#x5730;&#x63D0;&#x4F9B;&#x7ED9;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4EE3;&#x7801;&#xFF0C;&#x4F5C;&#x4E3A;&#x63D0;&#x9AD8;&#x9AD8;&#x7EA7;&#x914D;&#x7F6E;&#x53EF;&#x8BFB;&#x6027;&#x6216;&#x76F4;&#x63A5;&#x6CE8;&#x5165;&#x7CBE;&#x786E;&#x5EA6;&#x914D;&#x7F6E;&#xFF0C;&#x7ED5;&#x8FC7;&#x901A;&#x5E38;&#x7684;&#x52A0;&#x5165;&#x68C0;&#x67E5;&#x8BD5;&#x63A2;&#x6CD5;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">foreign</span><span class="p">,</span> <span class="n">remote</span>

<span class="k">class</span> <span class="nc">HostEntry</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;host_entry&apos;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">ip_address</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">INET</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>

    <span class="c1"># relationship() using explicit foreign() and remote() annotations</span>
    <span class="c1"># in lieu of separate arguments</span>
    <span class="n">parent_host</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;HostEntry&quot;</span><span class="p">,</span>
                        <span class="n">primaryjoin</span><span class="o">=</span><span class="n">remote</span><span class="p">(</span><span class="n">ip_address</span><span class="p">)</span> <span class="o">==</span> \
                                <span class="n">cast</span><span class="p">(</span><span class="n">foreign</span><span class="p">(</span><span class="n">content</span><span class="p">),</span> <span class="n">INET</span><span class="p">),</span>
                    <span class="p">)</span></pre></div></div></li></ul><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-123">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-124"><a class="reference internal" href="orm_join_conditions.html#relationship-configure-joins"><span>Configuring how Relationship Joins</span></a>  - &#x5173;&#x4E8E;<a class="reference internal" href="orm_relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#x7684;&#x65B0;&#x4FEE;&#x8BA2;&#x90E8;&#x5206;&#xFF0C;&#x8BE6;&#x7EC6;&#x4ECB;&#x7ECD;&#x4E86;&#x5B9A;&#x5236;&#x76F8;&#x5173;&#x5C5E;&#x6027;&#x548C;&#x96C6;&#x5408;&#x8BBF;&#x95EE;&#x7684;&#x6700;&#x65B0;&#x6280;&#x672F;&#x3002;</span></p></div><p><span class="yiyi-st" id="yiyi-125"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/1401">&#xFF03;1401</a> <a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/610">&#xFF03;610</a></span></p></div><div class="section" id="new-class-object-inspection-system"><h3><span class="yiyi-st" id="yiyi-126">&#x65B0;&#x7C7B;/&#x5BF9;&#x8C61;&#x68C0;&#x67E5;&#x7CFB;&#x7EDF;<a class="headerlink" href="#new-class-object-inspection-system" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-127">&#x8BB8;&#x591A;SQLAlchemy&#x7528;&#x6237;&#x6B63;&#x5728;&#x7F16;&#x5199;&#x9700;&#x8981;&#x68C0;&#x67E5;&#x6620;&#x5C04;&#x7C7B;&#x5C5E;&#x6027;&#x7684;&#x7CFB;&#x7EDF;&#xFF0C;&#x5305;&#x62EC;&#x80FD;&#x591F;&#x83B7;&#x53D6;&#x4E3B;&#x952E;&#x5217;&#xFF0C;&#x5BF9;&#x8C61;&#x5173;&#x7CFB;&#xFF0C;&#x666E;&#x901A;&#x5C5E;&#x6027;&#x7B49;&#x7B49;&#xFF0C;&#x901A;&#x5E38;&#x7528;&#x4E8E;&#x6784;&#x5EFA;&#x6570;&#x636E;&#x7F16;&#x7EC4;&#x7CFB;&#x7EDF;&#xFF0C;&#x5982;JSON / XML&#x8F6C;&#x6362;&#x65B9;&#x6848;&#xFF0C;&#x5F53;&#x7136;&#x8FD8;&#x6709;&#x5F62;&#x5F0F;&#x5E93;&#x4E30;&#x5BCC;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-128">&#x6700;&#x521D;&#xFF0C;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal"><span class="pre">Table</span></code></a>&#x548C;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a>&#x6A21;&#x578B;&#x662F;&#x6700;&#x521D;&#x7684;&#x68C0;&#x67E5;&#x70B9;&#xFF0C;&#x5B83;&#x4EEC;&#x5177;&#x6709;&#x826F;&#x597D;&#x7684;&#x6587;&#x4EF6;&#x8BB0;&#x5F55;&#x7CFB;&#x7EDF;&#x3002;</span><span class="yiyi-st" id="yiyi-129">&#x867D;&#x7136;SQLAlchemy ORM&#x6A21;&#x578B;&#x4E5F;&#x5B8C;&#x5168;&#x53EF;&#x4EE5;&#x53CD;&#x6620;&#x5185;&#x5BB9;&#xFF0C;&#x4F46;&#x8FD9;&#x4ECE;&#x6765;&#x5C31;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x5B8C;&#x5168;&#x7A33;&#x5B9A;&#x548C;&#x652F;&#x6301;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x7528;&#x6237;&#x5F80;&#x5F80;&#x4E0D;&#x6E05;&#x695A;&#x5982;&#x4F55;&#x83B7;&#x53D6;&#x8FD9;&#x4E9B;&#x4FE1;&#x606F;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-130">&#x73B0;&#x5728;&#xFF0C;0.8&#x4E3A;&#x6B64;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x81F4;&#xFF0C;&#x7A33;&#x5B9A;&#x4E14;&#x5B8C;&#x5168;&#x8BB0;&#x5F55;&#x7684;API&#xFF0C;&#x5176;&#x4E2D;&#x5305;&#x62EC;&#x4E00;&#x4E2A;&#x7528;&#x4E8E;&#x6620;&#x5C04;&#x7C7B;&#xFF0C;&#x5B9E;&#x4F8B;&#xFF0C;&#x5C5E;&#x6027;&#x548C;&#x5176;&#x4ED6;Core&#x548C;ORM&#x6784;&#x9020;&#x7684;&#x68C0;&#x67E5;&#x7CFB;&#x7EDF;&#x3002;</span><span class="yiyi-st" id="yiyi-131">&#x8BE5;&#x7CFB;&#x7EDF;&#x7684;&#x5165;&#x53E3;&#x70B9;&#x662F;&#x6838;&#x5FC3;&#x7EA7;&#x522B;&#x7684;<a class="reference internal" href="core_inspection.html#sqlalchemy.inspection.inspect" title="sqlalchemy.inspection.inspect"><code class="xref py py-func docutils literal"><span class="pre">inspect()</span></code></a>&#x51FD;&#x6570;&#x3002;</span><span class="yiyi-st" id="yiyi-132">&#x5728;&#x5927;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x88AB;&#x68C0;&#x67E5;&#x7684;&#x5BF9;&#x8C61;&#x5DF2;&#x7ECF;&#x662F;SQLAlchemy&#x7CFB;&#x7EDF;&#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x6BD4;&#x5982;<a class="reference internal" href="orm_mapping_api.html#sqlalchemy.orm.mapper.Mapper" title="sqlalchemy.orm.mapper.Mapper"><code class="xref py py-class docutils literal"><span class="pre">Mapper</span></code></a>&#xFF0C;<a class="reference internal" href="orm_internals.html#sqlalchemy.orm.state.InstanceState" title="sqlalchemy.orm.state.InstanceState"><code class="xref py py-class docutils literal"><span class="pre">InstanceState</span></code></a>&#xFF0C;<a class="reference internal" href="core_reflection.html#sqlalchemy.engine.reflection.Inspector" title="sqlalchemy.engine.reflection.Inspector"><code class="xref py py-class docutils literal"><span class="pre">Inspector</span></code></a>&#x3002;</span><span class="yiyi-st" id="yiyi-133">&#x5728;&#x67D0;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6DFB;&#x52A0;&#x65B0;&#x5BF9;&#x8C61;&#x7684;&#x5DE5;&#x4F5C;&#x662F;&#x5728;&#x7279;&#x5B9A;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x63D0;&#x4F9B;&#x68C0;&#x67E5;API&#xFF0C;&#x4F8B;&#x5982;<a class="reference internal" href="orm_query.html#sqlalchemy.orm.util.AliasedInsp" title="sqlalchemy.orm.util.AliasedInsp"><code class="xref py py-class docutils literal"><span class="pre">AliasedInsp</span></code></a>&#x548C;<a class="reference internal" href="orm_internals.html#sqlalchemy.orm.state.AttributeState" title="sqlalchemy.orm.state.AttributeState"><code class="xref py py-class docutils literal"><span class="pre">AttributeState</span></code></a>&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-134">&#x4E00;&#x4E9B;&#x5173;&#x952E;&#x529F;&#x80FD;&#x7684;&#x6F14;&#x7EC3;&#x5982;&#x4E0B;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;user&apos;</span>
<span class="gp">... </span>    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">name_syn</span> <span class="o">=</span> <span class="n">synonym</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">addresses</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Address&quot;</span><span class="p">)</span>
<span class="gp">...</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># universal entry point is inspect()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">inspect</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># b in this case is the Mapper</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span>
<span class="go">&lt;Mapper at 0x101521950; User&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Column namespace</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">id</span>
<span class="go">Column(&apos;id&apos;, Integer(), table=&lt;user&gt;, primary_key=True, nullable=False)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># mapper&apos;s perspective of the primary key</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">primary_key</span>
<span class="go">(Column(&apos;id&apos;, Integer(), table=&lt;user&gt;, primary_key=True, nullable=False),)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># MapperProperties available from .attrs</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="go">[&apos;name_syn&apos;, &apos;addresses&apos;, &apos;id&apos;, &apos;name&apos;]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># .column_attrs, .relationships, etc. filter this collection</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">column_attrs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="go">[&apos;id&apos;, &apos;name&apos;]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">relationships</span><span class="p">)</span>
<span class="go">[&lt;sqlalchemy.orm.properties.RelationshipProperty object at 0x1015212d0&gt;]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># they are also namespaces</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">column_attrs</span><span class="o">.</span><span class="n">id</span>
<span class="go">&lt;sqlalchemy.orm.properties.ColumnProperty object at 0x101525090&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">relationships</span><span class="o">.</span><span class="n">addresses</span>
<span class="go">&lt;sqlalchemy.orm.properties.RelationshipProperty object at 0x1015212d0&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># point inspect() at a mapped, class level attribute,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># returns the attribute itself</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">inspect</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">addresses</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span>
<span class="go">&lt;sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x101521fd0&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># From here we can get the mapper:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">mapper</span>
<span class="go">&lt;Mapper at 0x101525810; Address&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># the parent inspector, in this case a mapper</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">parent</span>
<span class="go">&lt;Mapper at 0x101521950; User&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># an expression</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">expression</span><span class="p">)</span>
<span class="go">&quot;user&quot;.id = address.user_id</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># inspect works on instances</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u1</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&apos;x&apos;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">inspect</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># it returns the InstanceState</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span>
<span class="go">&lt;sqlalchemy.orm.state.InstanceState object at 0x10152bed0&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># similar attrs accessor refers to the</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="go">[&apos;id&apos;, &apos;name_syn&apos;, &apos;addresses&apos;, &apos;name&apos;]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># attribute interface - from attrs, you get a state object</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">id</span>
<span class="go">&lt;sqlalchemy.orm.state.AttributeState object at 0x10152bf90&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># this object can give you, current value...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">value</span>
<span class="go">3</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># ... current history</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">history</span>
<span class="go">History(added=[3], unchanged=(), deleted=())</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># InstanceState can also provide session state information</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># lets assume the object is persistent</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># now we can get primary key identity, always</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># works in query.get()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">identity</span>
<span class="go">(3,)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># the mapper level key</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">identity_key</span>
<span class="go">(&lt;class &apos;__main__.User&apos;&gt;, (3,))</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># state within the session</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">persistent</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">transient</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">deleted</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">detached</span>
<span class="go">(True, False, False, False)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># owning session</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">session</span>
<span class="go">&lt;sqlalchemy.orm.session.Session object at 0x101701150&gt;</span></pre></div></div><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-135">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-136"><a class="reference internal" href="core_inspection.html"><span>Runtime Inspection API</span></a></span></p></div><p><span class="yiyi-st" id="yiyi-137"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2208">&#xFF03;2208  T0&gt;</a></span></p></div><div class="section" id="new-with-polymorphic-feature-can-be-used-anywhere"><h3><span class="yiyi-st" id="yiyi-138">&#x65B0;&#x7684;with_polymorphic()&#x529F;&#x80FD;&#x53EF;&#x7528;&#x4E8E;&#x4EFB;&#x4F55;&#x5730;&#x65B9;<a class="headerlink" href="#new-with-polymorphic-feature-can-be-used-anywhere" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-139">The <a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query.with_polymorphic" title="sqlalchemy.orm.query.Query.with_polymorphic"><code class="xref py py-meth docutils literal"><span class="pre">Query.with_polymorphic()</span></code></a> method allows the user to specify which tables should be present when querying against a joined-table entity. </span><span class="yiyi-st" id="yiyi-140">&#x4E0D;&#x5E78;&#x7684;&#x662F;&#xFF0C;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x5F88;&#x7B28;&#x62D9;&#xFF0C;&#x53EA;&#x9002;&#x7528;&#x4E8E;&#x5217;&#x8868;&#x4E2D;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x5B9E;&#x4F53;&#xFF0C;&#x5426;&#x5219;&#x5728;&#x5185;&#x90E8;&#x4F7F;&#x7528;&#x548C;&#x5185;&#x90E8;&#x4F7F;&#x7528;&#x90FD;&#x4F1A;&#x6709;&#x5C34;&#x5C2C;&#x7684;&#x884C;&#x4E3A;&#x3002;</span><span class="yiyi-st" id="yiyi-141">&#x5DF2;&#x6DFB;&#x52A0;&#x540D;&#x4E3A;<a class="reference internal" href="orm_inheritance.html#sqlalchemy.orm.with_polymorphic" title="sqlalchemy.orm.with_polymorphic"><code class="xref py py-func docutils literal"><span class="pre">with_polymorphic()</span></code></a>&#x7684;&#x5BF9;<a class="reference internal" href="orm_query.html#sqlalchemy.orm.aliased" title="sqlalchemy.orm.aliased"><code class="xref py py-func docutils literal"><span class="pre">aliased()</span></code></a>&#x7ED3;&#x6784;&#x7684;&#x65B0;&#x589E;&#x5F3A;&#xFF0C;&#x5141;&#x8BB8;&#x5C06;&#x4EFB;&#x4F55;&#x5B9E;&#x4F53;&#x201C;&#x522B;&#x540D;&#x201D;&#x4E3A;&#x5176;&#x81EA;&#x8EAB;&#x7684;&#x201C;&#x591A;&#x6001;&#x201D;&#x7248;&#x672C;&#xFF0C;&#x53EF;&#x81EA;&#x7531;&#x4F7F;&#x7528;&#x4EFB;&#x4F55;&#x5730;&#x65B9;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">with_polymorphic</span>
<span class="n">palias</span> <span class="o">=</span> <span class="n">with_polymorphic</span><span class="p">(</span><span class="n">Person</span><span class="p">,</span> <span class="p">[</span><span class="n">Engineer</span><span class="p">,</span> <span class="n">Manager</span><span class="p">])</span>
<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Company</span><span class="p">)</span><span class="o">.</span>\
            <span class="n">join</span><span class="p">(</span><span class="n">palias</span><span class="p">,</span> <span class="n">Company</span><span class="o">.</span><span class="n">employees</span><span class="p">)</span><span class="o">.</span>\
            <span class="nb">filter</span><span class="p">(</span><span class="n">or_</span><span class="p">(</span><span class="n">Engineer</span><span class="o">.</span><span class="n">language</span><span class="o">==</span><span class="s1">&apos;java&apos;</span><span class="p">,</span> <span class="n">Manager</span><span class="o">.</span><span class="n">hair</span><span class="o">==</span><span class="s1">&apos;pointy&apos;</span><span class="p">))</span></pre></div></div><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-142">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-143"><a class="reference internal" href="orm_inheritance.html#with-polymorphic"><span>Basic Control of Which Tables are Queried</span></a>  - &#x7528;&#x4E8E;&#x591A;&#x6001;&#x52A0;&#x8F7D;&#x63A7;&#x5236;&#x7684;&#x65B0;&#x66F4;&#x65B0;&#x6587;&#x6863;&#x3002;</span></p></div><p><span class="yiyi-st" id="yiyi-144"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2333">&#xFF03;2333  T0&gt;</a></span></p></div><div class="section" id="of-type-works-with-alias-with-polymorphic-any-has-joinedload-subqueryload-contains-eager"><h3><span class="yiyi-st" id="yiyi-145">of_type() works with alias(), with_polymorphic(), any(), has(), joinedload(), subqueryload(), contains_eager()<a class="headerlink" href="#of-type-works-with-alias-with-polymorphic-any-has-joinedload-subqueryload-contains-eager" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-146">The <a class="reference internal" href="orm_internals.html#sqlalchemy.orm.interfaces.PropComparator.of_type" title="sqlalchemy.orm.interfaces.PropComparator.of_type"><code class="xref py py-meth docutils literal"><span class="pre">PropComparator.of_type()</span></code></a> method is used to specify a specific subtype to use when constructing SQL expressions along a <a class="reference internal" href="orm_relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a> that has a <a class="reference internal" href="glossary.html#term-polymorphic"><span class="xref std std-term">polymorphic</span></a> mapping as its target. </span><span class="yiyi-st" id="yiyi-147">This method can now be used to target <em>any number</em> of target subtypes, by combining it with the new <a class="reference internal" href="orm_inheritance.html#sqlalchemy.orm.with_polymorphic" title="sqlalchemy.orm.with_polymorphic"><code class="xref py py-func docutils literal"><span class="pre">with_polymorphic()</span></code></a> function:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># use eager loading in conjunction with with_polymorphic targets</span>
<span class="n">Job_P</span> <span class="o">=</span> <span class="n">with_polymorphic</span><span class="p">(</span><span class="n">Job</span><span class="p">,</span> <span class="p">[</span><span class="n">SubJob</span><span class="p">,</span> <span class="n">ExtraJob</span><span class="p">],</span> <span class="n">aliased</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">DataContainer</span><span class="p">)</span><span class="o">.</span>\
            <span class="n">join</span><span class="p">(</span><span class="n">DataContainer</span><span class="o">.</span><span class="n">jobs</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">Job_P</span><span class="p">))</span><span class="o">.</span>\
                <span class="n">options</span><span class="p">(</span><span class="n">contains_eager</span><span class="p">(</span><span class="n">DataContainer</span><span class="o">.</span><span class="n">jobs</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">Job_P</span><span class="p">)))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-148">The method now works equally well in most places a regular relationship attribute is accepted, including with loader functions like <a class="reference internal" href="orm_loading_relationships.html#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal"><span class="pre">joinedload()</span></code></a>, <a class="reference internal" href="orm_loading_relationships.html#sqlalchemy.orm.subqueryload" title="sqlalchemy.orm.subqueryload"><code class="xref py py-func docutils literal"><span class="pre">subqueryload()</span></code></a>, <a class="reference internal" href="orm_loading_relationships.html#sqlalchemy.orm.contains_eager" title="sqlalchemy.orm.contains_eager"><code class="xref py py-func docutils literal"><span class="pre">contains_eager()</span></code></a>, and comparison methods like <a class="reference internal" href="orm_internals.html#sqlalchemy.orm.interfaces.PropComparator.any" title="sqlalchemy.orm.interfaces.PropComparator.any"><code class="xref py py-meth docutils literal"><span class="pre">PropComparator.any()</span></code></a> and <a class="reference internal" href="orm_internals.html#sqlalchemy.orm.interfaces.PropComparator.has" title="sqlalchemy.orm.interfaces.PropComparator.has"><code class="xref py py-meth docutils literal"><span class="pre">PropComparator.has()</span></code></a>:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># use eager loading in conjunction with with_polymorphic targets</span>
<span class="n">Job_P</span> <span class="o">=</span> <span class="n">with_polymorphic</span><span class="p">(</span><span class="n">Job</span><span class="p">,</span> <span class="p">[</span><span class="n">SubJob</span><span class="p">,</span> <span class="n">ExtraJob</span><span class="p">],</span> <span class="n">aliased</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">DataContainer</span><span class="p">)</span><span class="o">.</span>\
            <span class="n">join</span><span class="p">(</span><span class="n">DataContainer</span><span class="o">.</span><span class="n">jobs</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">Job_P</span><span class="p">))</span><span class="o">.</span>\
                <span class="n">options</span><span class="p">(</span><span class="n">contains_eager</span><span class="p">(</span><span class="n">DataContainer</span><span class="o">.</span><span class="n">jobs</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">Job_P</span><span class="p">)))</span>

<span class="c1"># pass subclasses to eager loads (implicitly applies with_polymorphic)</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">ParentThing</span><span class="p">)</span><span class="o">.</span>\
                <span class="n">options</span><span class="p">(</span>
                    <span class="n">joinedload_all</span><span class="p">(</span>
                        <span class="n">ParentThing</span><span class="o">.</span><span class="n">container</span><span class="p">,</span>
                        <span class="n">DataContainer</span><span class="o">.</span><span class="n">jobs</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">SubJob</span><span class="p">)</span>
                <span class="p">))</span>

<span class="c1"># control self-referential aliasing with any()/has()</span>
<span class="n">Job_A</span> <span class="o">=</span> <span class="n">aliased</span><span class="p">(</span><span class="n">Job</span><span class="p">)</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Job</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DataContainer</span><span class="o">.</span><span class="n">jobs</span><span class="p">)</span><span class="o">.</span>\
                <span class="nb">filter</span><span class="p">(</span>
                    <span class="n">DataContainer</span><span class="o">.</span><span class="n">jobs</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">Job_A</span><span class="p">)</span><span class="o">.</span>\
                        <span class="nb">any</span><span class="p">(</span><span class="n">and_</span><span class="p">(</span><span class="n">Job_A</span><span class="o">.</span><span class="n">id</span> <span class="o">&lt;</span> <span class="n">Job</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">Job_A</span><span class="o">.</span><span class="n">type</span><span class="o">==</span><span class="s1">&apos;fred&apos;</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span></pre></div></div><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-149">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-150"><a class="reference internal" href="orm_inheritance.html#of-type"><span>Creating Joins to Specific Subtypes</span></a></span></p></div><p><span class="yiyi-st" id="yiyi-151"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2438">&#xFF03;2438</a> <a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/1106">&#xFF03;1106</a></span></p></div><div class="section" id="events-can-be-applied-to-unmapped-superclasses"><h3><span class="yiyi-st" id="yiyi-152">&#x4E8B;&#x4EF6;&#x53EF;&#x4EE5;&#x5E94;&#x7528;&#x4E8E;&#x672A;&#x6620;&#x5C04;&#x7684;&#x8D85;&#x7C7B;<a class="headerlink" href="#events-can-be-applied-to-unmapped-superclasses" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-153">Mapper&#x548C;&#x5B9E;&#x4F8B;&#x4E8B;&#x4EF6;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x4E0E;&#x4E00;&#x4E2A;&#x672A;&#x6620;&#x5C04;&#x7684;&#x8D85;&#x7C7B;&#x76F8;&#x5173;&#x8054;&#xFF0C;&#x5176;&#x4E2D;&#x8FD9;&#x4E9B;&#x4E8B;&#x4EF6;&#x5C06;&#x88AB;&#x6620;&#x5C04;&#x5230;&#x8FD9;&#x4E9B;&#x5B50;&#x7C7B;&#x65F6;&#x4F20;&#x64AD;&#x5230;&#x5B50;&#x7C7B;&#x3002;</span><span class="yiyi-st" id="yiyi-154">&#x5E94;&#x8BE5;&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">propagate=True</span></code>&#x6807;&#x5FD7;&#x3002;</span><span class="yiyi-st" id="yiyi-155">&#x6B64;&#x529F;&#x80FD;&#x5141;&#x8BB8;&#x5C06;&#x4E8B;&#x4EF6;&#x4E0E;&#x58F0;&#x660E;&#x6027;&#x57FA;&#x7C7B;&#x5173;&#x8054;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>

<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>

<span class="nd">@event.listens_for</span><span class="p">(</span><span class="s2">&quot;load&quot;</span><span class="p">,</span> <span class="n">Base</span><span class="p">,</span> <span class="n">propagate</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">on_load</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;New instance loaded:&quot;</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>

<span class="c1"># on_load() will be applied to SomeClass</span>
<span class="k">class</span> <span class="nc">SomeClass</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;sometable&apos;</span>

    <span class="c1"># ...</span></pre></div></div><p><span class="yiyi-st" id="yiyi-156"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2585">&#xFF03;2585  T0&gt;</a></span></p></div><div class="section" id="declarative-distinguishes-between-modules-packages"><h3><span class="yiyi-st" id="yiyi-157">&#x58F0;&#x660E;&#x533A;&#x5206;&#x6A21;&#x5757;/&#x5305;<a class="headerlink" href="#declarative-distinguishes-between-modules-packages" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-158">Declarative&#x7684;&#x4E00;&#x4E2A;&#x5173;&#x952E;&#x7279;&#x6027;&#x662F;&#x80FD;&#x591F;&#x4F7F;&#x7528;&#x5176;&#x5B57;&#x7B26;&#x4E32;&#x540D;&#x79F0;&#x5F15;&#x7528;&#x5176;&#x4ED6;&#x6620;&#x5C04;&#x7C7B;&#x3002;</span><span class="yiyi-st" id="yiyi-159">&#x7C7B;&#x540D;&#x6CE8;&#x518C;&#x8868;&#x73B0;&#x5728;&#x5BF9;&#x7ED9;&#x5B9A;&#x7C7B;&#x7684;&#x62E5;&#x6709;&#x6A21;&#x5757;&#x548C;&#x5305;&#x662F;&#x654F;&#x611F;&#x7684;&#x3002;</span><span class="yiyi-st" id="yiyi-160">&#x7C7B;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8868;&#x8FBE;&#x5F0F;&#x4E2D;&#x7684;&#x865A;&#x7EBF;&#x540D;&#x79F0;&#x5F15;&#x7528;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Snack</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="c1"># ...</span>

    <span class="n">peanuts</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;nuts.Peanut&quot;</span><span class="p">,</span>
            <span class="n">primaryjoin</span><span class="o">=</span><span class="s2">&quot;nuts.Peanut.snack_id == Snack.id&quot;</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-161">&#x8BE5;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x5141;&#x8BB8;&#x4F7F;&#x7528;&#x4EFB;&#x4F55;&#x5B8C;&#x6574;&#x6216;&#x90E8;&#x5206;&#x6D88;&#x9664;&#x6B67;&#x4E49;&#x7684;&#x8F6F;&#x4EF6;&#x5305;&#x540D;&#x79F0;&#x3002;</span><span class="yiyi-st" id="yiyi-162">&#x5982;&#x679C;&#x7279;&#x5B9A;&#x7C7B;&#x7684;&#x8DEF;&#x5F84;&#x4ECD;&#x4E0D;&#x660E;&#x786E;&#xFF0C;&#x5219;&#x4F1A;&#x5F15;&#x53D1;&#x9519;&#x8BEF;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-163"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2338">&#xFF03;2338  T0&gt;</a></span></p></div><div class="section" id="new-deferredreflection-feature-in-declarative"><h3><span class="yiyi-st" id="yiyi-164">&#x58F0;&#x660E;&#x5F0F;<a class="headerlink" href="#new-deferredreflection-feature-in-declarative" title="Permalink to this headline">&#xB6;</a>&#x4E2D;&#x7684;&#x65B0;DeferredReflection&#x7279;&#x6027;</span></h3><p><span class="yiyi-st" id="yiyi-165">&#x201C;&#x5EF6;&#x8FDF;&#x53CD;&#x5C04;&#x201D;&#x793A;&#x4F8B;&#x5DF2;&#x79FB;&#x81F3;&#x58F0;&#x660E;&#x4E2D;&#x7684;&#x652F;&#x6301;&#x529F;&#x80FD;&#x3002;</span><span class="yiyi-st" id="yiyi-166">&#x8FD9;&#x4E2A;&#x7279;&#x6027;&#x5141;&#x8BB8;&#x53EA;&#x7528;&#x5360;&#x4F4D;&#x7B26;<code class="docutils literal"><span class="pre">Table</span></code>&#x5143;&#x6570;&#x636E;&#x6784;&#x9020;&#x58F0;&#x660E;&#x5F0F;&#x6620;&#x5C04;&#x7C7B;&#xFF0C;&#x76F4;&#x5230;<code class="docutils literal"><span class="pre">prepare()</span></code>&#x6B65;&#x9AA4;&#x88AB;&#x8C03;&#x7528;&#xFF0C;&#x7ED9;&#x5B9A;&#x4E00;&#x4E2A;<code class="docutils literal"><span class="pre">Engine</span></code>&#x5145;&#x5206;&#x53CD;&#x6620;&#x6240;&#x6709;&#x8868;&#x683C;&#x5E76;&#x5EFA;&#x7ACB;&#x5B9E;&#x9645;&#x6620;&#x5C04;&#x3002;</span><span class="yiyi-st" id="yiyi-167">&#x7CFB;&#x7EDF;&#x652F;&#x6301;&#x91CD;&#x5199;&#x5217;&#xFF0C;&#x5355;&#x4E2A;&#x548C;&#x8054;&#x5408;&#x7EE7;&#x627F;&#xFF0C;&#x4EE5;&#x53CA;&#x4E0D;&#x540C;&#x7684;&#x6BCF;&#x4E2A;&#x5F15;&#x64CE;&#x57FA;&#x6570;&#x3002;</span><span class="yiyi-st" id="yiyi-168">&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x5728;&#x5F15;&#x64CE;&#x521B;&#x5EFA;&#x65F6;&#x5728;&#x4E00;&#x4E2A;&#x6B65;&#x9AA4;&#x4E2D;&#x6C47;&#x7F16;&#x7684;&#x73B0;&#x6709;&#x8868;&#x521B;&#x5EFA;&#x5B8C;&#x6574;&#x7684;&#x58F0;&#x660E;&#x6027;&#x914D;&#x7F6E;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ReflectedOne</span><span class="p">(</span><span class="n">DeferredReflection</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="n">__abstract__</span> <span class="o">=</span> <span class="bp">True</span>

<span class="k">class</span> <span class="nc">ReflectedTwo</span><span class="p">(</span><span class="n">DeferredReflection</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="n">__abstract__</span> <span class="o">=</span> <span class="bp">True</span>

<span class="k">class</span> <span class="nc">MyClass</span><span class="p">(</span><span class="n">ReflectedOne</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;mytable&apos;</span>

<span class="k">class</span> <span class="nc">MyOtherClass</span><span class="p">(</span><span class="n">ReflectedOne</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;myothertable&apos;</span>

<span class="k">class</span> <span class="nc">YetAnotherClass</span><span class="p">(</span><span class="n">ReflectedTwo</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;yetanothertable&apos;</span>

<span class="n">ReflectedOne</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="n">engine_one</span><span class="p">)</span>
<span class="n">ReflectedTwo</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="n">engine_two</span><span class="p">)</span></pre></div></div><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-169">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-170"><a class="reference internal" href="orm_extensions_declarative_api.html#sqlalchemy.ext.declarative.DeferredReflection" title="sqlalchemy.ext.declarative.DeferredReflection"><code class="xref py py-class docutils literal"><span class="pre">DeferredReflection</span></code></a></span></p></div><p><span class="yiyi-st" id="yiyi-171"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2485">&#xFF03;2485  T0&gt;</a></span></p></div><div class="section" id="orm-classes-now-accepted-by-core-constructs"><h3><span class="yiyi-st" id="yiyi-172">ORM&#x7C7B;&#x73B0;&#x5728;&#x88AB;&#x6838;&#x5FC3;&#x6784;&#x9020;&#x63A5;&#x53D7;<a class="headerlink" href="#orm-classes-now-accepted-by-core-constructs" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-173">While the SQL expressions used with <a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query.filter" title="sqlalchemy.orm.query.Query.filter"><code class="xref py py-meth docutils literal"><span class="pre">Query.filter()</span></code></a>, such as <code class="docutils literal"><span class="pre">User.id</span> <span class="pre">==</span> <span class="pre">5</span></code>, have always been compatible for use with core constructs such as <a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal"><span class="pre">select()</span></code></a>, the mapped class itself would not be recognized when passed to <a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal"><span class="pre">select()</span></code></a>, <a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.Select.select_from" title="sqlalchemy.sql.expression.Select.select_from"><code class="xref py py-meth docutils literal"><span class="pre">Select.select_from()</span></code></a>, or <a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.Select.correlate" title="sqlalchemy.sql.expression.Select.correlate"><code class="xref py py-meth docutils literal"><span class="pre">Select.correlate()</span></code></a>. </span><span class="yiyi-st" id="yiyi-174">&#x65B0;&#x7684;SQL&#x6CE8;&#x518C;&#x7CFB;&#x7EDF;&#x5141;&#x8BB8;&#x6620;&#x5C04;&#x7C7B;&#x5728;&#x6838;&#x5FC3;&#x5185;&#x88AB;&#x63A5;&#x53D7;&#x4E3A;FROM&#x5B50;&#x53E5;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">select</span>

<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">User</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-175">&#x4EE5;&#x4E0A;&#xFF0C;&#x6620;&#x5C04;&#x7684;<code class="docutils literal"><span class="pre">User</span></code>&#x7C7B;&#x5C06;&#x5C55;&#x5F00;&#x5230;&#x6620;&#x5C04;<code class="docutils literal"><span class="pre">User</span></code>&#x7684;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal"><span class="pre">Table</span></code></a>&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-176"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2245">&#xFF03;2245  T0&gt;</a></span></p></div><div class="section" id="query-update-supports-update-from"><h3><span class="yiyi-st" id="yiyi-177">Query.update()&#x652F;&#x6301;UPDATE..FROM <a class="headerlink" href="#query-update-supports-update-from" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-178">&#x65B0;&#x7684;UPDATE..FROM&#x673A;&#x5236;&#x5728;query.update()&#x4E2D;&#x5DE5;&#x4F5C;&#x3002;</span><span class="yiyi-st" id="yiyi-179">&#x4E0B;&#x9762;&#xFF0C;&#x6211;&#x4EEC;&#x9488;&#x5BF9;<code class="docutils literal"><span class="pre">SomeEntity</span></code>&#x53D1;&#x51FA;UPDATE&#xFF0C;&#x5E76;&#x9488;&#x5BF9;<code class="docutils literal"><span class="pre">SomeOtherEntity</span></code>&#x6DFB;&#x52A0;&#x4E86;&#x4E00;&#x4E2A;FROM&#x5B50;&#x53E5;&#xFF08;&#x6216;&#x7B49;&#x4EF7;&#x7269;&#xFF0C;&#x5177;&#x4F53;&#x53D6;&#x51B3;&#x4E8E;&#x540E;&#x7AEF;&#xFF09;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">query</span><span class="p">(</span><span class="n">SomeEntity</span><span class="p">)</span><span class="o">.</span>\
    <span class="nb">filter</span><span class="p">(</span><span class="n">SomeEntity</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="n">SomeOtherEntity</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span>\
    <span class="nb">filter</span><span class="p">(</span><span class="n">SomeOtherEntity</span><span class="o">.</span><span class="n">foo</span><span class="o">==</span><span class="s1">&apos;bar&apos;</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">update</span><span class="p">({</span><span class="s2">&quot;data&quot;</span><span class="p">:</span><span class="s2">&quot;x&quot;</span><span class="p">})</span></pre></div></div><p><span class="yiyi-st" id="yiyi-180">&#x7279;&#x522B;&#x662F;&#xFF0C;&#x5BF9;&#x5DF2;&#x52A0;&#x5165;&#x7EE7;&#x627F;&#x5B9E;&#x4F53;&#x7684;&#x66F4;&#x65B0;&#x662F;&#x53D7;&#x652F;&#x6301;&#x7684;&#xFF0C;&#x524D;&#x63D0;&#x662F;UPDATE&#x7684;&#x76EE;&#x6807;&#x5BF9;&#x8981;&#x8FC7;&#x6EE4;&#x7684;&#x8868;&#x662F;&#x672C;&#x5730;&#x7684;&#xFF0C;&#x6216;&#x8005;&#x5982;&#x679C;&#x7236;&#x8868;&#x548C;&#x5B50;&#x8868;&#x6DF7;&#x5408;&#x5728;&#x4E00;&#x8D77;&#xFF0C;&#x5219;&#x5B83;&#x4EEC;&#x5C06;&#x663E;&#x5F0F;&#x8FDE;&#x63A5;&#x5230;&#x67E5;&#x8BE2;&#x4E2D;&#x3002;</span><span class="yiyi-st" id="yiyi-181">&#x4E0B;&#x9762;&#xFF0C;&#x7ED9;&#x51FA;<code class="docutils literal"><span class="pre">Engineer</span></code>&#x4F5C;&#x4E3A;<code class="docutils literal"><span class="pre">Person</span></code>&#x7684;&#x8054;&#x5408;&#x5B50;&#x7C7B;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">query</span><span class="p">(</span><span class="n">Engineer</span><span class="p">)</span><span class="o">.</span>\
        <span class="nb">filter</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="n">Engineer</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span>\
        <span class="nb">filter</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s1">&apos;dilbert&apos;</span><span class="p">)</span><span class="o">.</span>\
        <span class="n">update</span><span class="p">({</span><span class="s2">&quot;engineer_data&quot;</span><span class="p">:</span><span class="s2">&quot;java&quot;</span><span class="p">})</span></pre></div></div><p><span class="yiyi-st" id="yiyi-182">&#x4F1A;&#x4EA7;&#x751F;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>UPDATE engineer SET engineer_data=&apos;java&apos; FROM person
WHERE person.id=engineer.id AND person.name=&apos;dilbert&apos;</pre></div></div><p><span class="yiyi-st" id="yiyi-183"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2365">&#xFF03;2365  T0&gt;</a></span></p></div><div class="section" id="rollback-will-only-roll-back-dirty-objects-from-a-begin-nested"><h3><span class="yiyi-st" id="yiyi-184">rollback()&#x53EA;&#x4F1A;&#x4ECE;begin_nested()<a class="headerlink" href="#rollback-will-only-roll-back-dirty-objects-from-a-begin-nested" title="Permalink to this headline">&#xB6;</a>&#x56DE;&#x6EDA;&#x201C;&#x810F;&#x201D;&#x5BF9;&#x8C61;</span></h3><p><span class="yiyi-st" id="yiyi-185">&#x901A;&#x8FC7;<code class="docutils literal"><span class="pre">Session.begin_nested()</span></code>  - &#x5728;<code class="docutils literal"><span class="pre">rollback()</span></code>&#x4E0A;&#x6539;&#x53D8;&#x4F7F;&#x7528;SAVEPOINT&#x7684;&#x7528;&#x6237;&#x7684;&#x884C;&#x4E3A;&#x6539;&#x53D8;&#x65F6;&#xFF0C;&#x53EA;&#x6709;&#x90A3;&#x4E9B;&#x81EA;&#x4E0A;&#x6B21;&#x5237;&#x65B0;&#x540E;&#x53D8;&#x810F;&#x7684;&#x5BF9;&#x8C61;&#x624D;&#x4F1A;&#x6709;&#x6548;&#x8FC7;&#x671F;&#x65F6;&#xFF0C;<code class="docutils literal"><span class="pre">Session</span></code>&#x7684;&#x5176;&#x4F59;&#x90E8;&#x5206;&#x4FDD;&#x6301;&#x4E0D;&#x53D8;&#x3002;</span><span class="yiyi-st" id="yiyi-186">&#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#x5BF9;SAVEPOINT&#x7684;ROLLBACK&#x4E0D;&#x4F1A;&#x7EC8;&#x6B62;&#x5305;&#x542B;&#x4E8B;&#x52A1;&#x7684;&#x9694;&#x79BB;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x9700;&#x8981;&#x8FC7;&#x671F;&#xFF0C;&#x9664;&#x975E;&#x90A3;&#x4E9B;&#x5728;&#x5F53;&#x524D;&#x4E8B;&#x52A1;&#x4E2D;&#x6CA1;&#x6709;&#x5237;&#x65B0;&#x7684;&#x66F4;&#x6539;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-187"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2452">&#xFF03;2452  T0&gt;</a></span></p></div><div class="section" id="caching-example-now-uses-dogpile-cache"><h3><span class="yiyi-st" id="yiyi-188">&#x7F13;&#x5B58;&#x793A;&#x4F8B;&#x73B0;&#x5728;&#x4F7F;&#x7528;dogpile.cache <a class="headerlink" href="#caching-example-now-uses-dogpile-cache" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-189">&#x7F13;&#x5B58;&#x793A;&#x4F8B;&#x73B0;&#x5728;&#x4F7F;&#x7528;<a class="reference external" href="https://dogpilecache.readthedocs.io/">dogpile.cache</a>&#x3002;</span><span class="yiyi-st" id="yiyi-190">Dogpile.cache&#x662F;&#x200B;&#x200B;Beaker&#x7F13;&#x5B58;&#x90E8;&#x5206;&#x7684;&#x91CD;&#x5199;&#xFF0C;&#x5177;&#x6709;&#x6781;&#x5176;&#x7B80;&#x5355;&#x548C;&#x5FEB;&#x901F;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x5E76;&#x652F;&#x6301;&#x5206;&#x5E03;&#x5F0F;&#x9501;&#x5B9A;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-191">&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;Dogpile&#x793A;&#x4F8B;&#x4EE5;&#x53CA;&#x4E4B;&#x524D;&#x7684;Beaker&#x793A;&#x4F8B;&#x6240;&#x4F7F;&#x7528;&#x7684;SQLAlchemy API&#x5DF2;&#x7A0D;&#x6709;&#x53D8;&#x5316;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x5982;Beaker&#x793A;&#x4F8B;&#x6240;&#x793A;&#xFF0C;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x6B64;&#x66F4;&#x6539;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>--- examples/beaker_caching/caching_query.py
+++ examples/beaker_caching/caching_query.py
@@ -222,7 +222,8 @@

         &quot;&quot;&quot;
         if query._current_path:
-            mapper, key = query._current_path[-2:]
+            mapper, prop = query._current_path[-2:]
+            key = prop.key

             for cls in mapper.class_.__mro__:
                 if (cls, key) in self._relationship_options:</pre></div></div><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-192">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-193"><code class="xref py py-mod docutils literal"><span class="pre">dogpile_caching</span></code></span></p></div><p><span class="yiyi-st" id="yiyi-194"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2589">&#xFF03;2589  T0&gt;</a></span></p></div></div><div class="section" id="new-core-features"><h2><span class="yiyi-st" id="yiyi-195">&#x65B0;&#x7684;&#x6838;&#x5FC3;&#x529F;&#x80FD;<a class="headerlink" href="#new-core-features" title="Permalink to this headline">&#xB6;</a></span></h2><div class="section" id="fully-extensible-type-level-operator-support-in-core"><h3><span class="yiyi-st" id="yiyi-196">Core <a class="headerlink" href="#fully-extensible-type-level-operator-support-in-core" title="Permalink to this headline">&#xB6;</a>&#x4E2D;&#x5B8C;&#x5168;&#x53EF;&#x6269;&#x5C55;&#x7684;&#x7C7B;&#x578B;&#x7EA7;&#x522B;&#x64CD;&#x4F5C;&#x7B26;&#x652F;&#x6301;</span></h3><p><span class="yiyi-st" id="yiyi-197">&#x6838;&#x5FC3;&#x8FC4;&#x4ECA;&#x4ECE;&#x6765;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x7CFB;&#x7EDF;&#x4E3A;Column&#x548C;&#x5176;&#x4ED6;&#x8868;&#x8FBE;&#x5F0F;&#x7ED3;&#x6784;&#x6DFB;&#x52A0;&#x5BF9;&#x65B0;SQL&#x8FD0;&#x7B97;&#x7B26;&#x7684;&#x652F;&#x6301;&#xFF0C;&#x9664;&#x4E86;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.operators.ColumnOperators.op" title="sqlalchemy.sql.operators.ColumnOperators.op"><code class="xref py py-meth docutils literal"><span class="pre">ColumnOperators.op()</span></code></a>&#x65B9;&#x6CD5;&#xFF0C;&#x5B83;&#x8DB3;&#x4EE5;&#x8BA9;&#x4E8B;&#x60C5;&#x53D1;&#x6325;&#x4F5C;&#x7528;&#x3002;</span><span class="yiyi-st" id="yiyi-198">Core&#x4ECE;&#x6765;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x7CFB;&#x7EDF;&#x53EF;&#x4EE5;&#x8BA9;&#x73B0;&#x6709;&#x64CD;&#x4F5C;&#x5458;&#x7684;&#x884C;&#x4E3A;&#x88AB;&#x8986;&#x76D6;&#x3002;</span><span class="yiyi-st" id="yiyi-199">&#x5230;&#x76EE;&#x524D;&#x4E3A;&#x6B62;&#xFF0C;&#x64CD;&#x4F5C;&#x7B26;&#x53EF;&#x4EE5;&#x88AB;&#x7075;&#x6D3B;&#x5730;&#x91CD;&#x65B0;&#x5B9A;&#x4E49;&#x7684;&#x552F;&#x4E00;&#x65B9;&#x6CD5;&#x662F;&#x5728;ORM&#x5C42;&#x4E2D;&#xFF0C;&#x4F7F;&#x7528;<a class="reference internal" href="orm_mapping_columns.html#sqlalchemy.orm.column_property" title="sqlalchemy.orm.column_property"><code class="xref py py-func docutils literal"><span class="pre">column_property()</span></code></a>&#x7ED9;&#x51FA;&#x4E00;&#x4E2A;<code class="docutils literal"><span class="pre">comparator_factory</span></code>&#x53C2;&#x6570;&#x3002;</span><span class="yiyi-st" id="yiyi-200">&#x56E0;&#x6B64;&#xFF0C;&#x50CF;GeoAlchemy&#x8FD9;&#x6837;&#x7684;&#x7B2C;&#x4E09;&#x65B9;&#x5E93;&#x4E0D;&#x5F97;&#x4E0D;&#x4EE5;ORM&#x4E3A;&#x4E2D;&#x5FC3;&#xFF0C;&#x5E76;&#x4F9D;&#x9760;&#x4E00;&#x7CFB;&#x5217;&#x9ED1;&#x5BA2;&#x6765;&#x5E94;&#x7528;&#x65B0;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x5E76;&#x8BA9;&#x5B83;&#x4EEC;&#x6B63;&#x786E;&#x4F20;&#x64AD;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-201">Core&#x4E2D;&#x7684;&#x65B0;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x6DFB;&#x52A0;&#x4E86;&#x4E00;&#x76F4;&#x7F3A;&#x5C11;&#x7684;&#x94A9;&#x5B50;&#xFF0C;&#x5B83;&#x5C06;&#x65B0;&#x7684;&#x548C;&#x91CD;&#x8F7D;&#x7684;&#x64CD;&#x4F5C;&#x7B26;&#x4E0E;<em>&#x7C7B;&#x578B;</em>&#x5173;&#x8054;&#x3002;</span><span class="yiyi-st" id="yiyi-202">&#x6BD5;&#x7ADF;&#xFF0C;&#x5B83;&#x4E0D;&#x662F;&#x771F;&#x6B63;&#x7684;&#x5217;&#xFF0C;CAST&#x8FD0;&#x7B97;&#x7B26;&#x6216;SQL&#x51FD;&#x6570;&#xFF0C;&#x5B83;&#x4EEC;&#x771F;&#x6B63;&#x9A71;&#x52A8;&#x51FA;&#x73B0;&#x7684;&#x64CD;&#x4F5C;&#x7C7B;&#x578B;&#xFF0C;&#x5B83;&#x662F;&#x8868;&#x8FBE;&#x5F0F;&#x7684;<em>&#x7C7B;&#x578B;</em>&#x3002;</span><span class="yiyi-st" id="yiyi-203">&#x5B9E;&#x73B0;&#x7EC6;&#x8282;&#x662F;&#x6700;&#x5C0F;&#x7684; - &#x53EA;&#x6709;&#x4E00;&#x4E9B;&#x989D;&#x5916;&#x7684;&#x65B9;&#x6CD5;&#x88AB;&#x6DFB;&#x52A0;&#x5230;&#x6838;&#x5FC3;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.ColumnElement" title="sqlalchemy.sql.expression.ColumnElement"><code class="xref py py-class docutils literal"><span class="pre">ColumnElement</span></code></a>&#x7C7B;&#x578B;&#x4E2D;&#xFF0C;&#x4EE5;&#x4FBF;&#x4E3A;&#x53EF;&#x9009;&#x7684;&#x8FD0;&#x7B97;&#x7B26;&#x96C6;&#x54A8;&#x8BE2;&#x5B83;&#x7684;<a class="reference internal" href="core_type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal"><span class="pre">TypeEngine</span></code></a>&#x5BF9;&#x8C61;&#x3002;</span><span class="yiyi-st" id="yiyi-204">&#x65B0;&#x7684;&#x6216;&#x4FEE;&#x6539;&#x7684;&#x64CD;&#x4F5C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4F7F;&#x7528;<a class="reference internal" href="core_custom_types.html#sqlalchemy.types.TypeDecorator" title="sqlalchemy.types.TypeDecorator"><code class="xref py py-class docutils literal"><span class="pre">TypeDecorator</span></code></a>&#x6216;&#x201C;&#x5168;&#x5C40;&#x5168;&#x9762;&#x201D;&#x901A;&#x8FC7;&#x9644;&#x52A0;&#x65B0;&#x7684;<a class="reference internal" href="core_type_api.html#sqlalchemy.types.TypeEngine.Comparator" title="sqlalchemy.types.TypeEngine.Comparator"><code class="xref py py-class docutils literal"><span class="pre">TypeEngine.Comparator</span></code></a></span></p><p><span class="yiyi-st" id="yiyi-205">&#x4F8B;&#x5982;&#xFF0C;&#x8981;&#x5C06;&#x5BF9;&#x6570;&#x652F;&#x6301;&#x6DFB;&#x52A0;&#x5230;<a class="reference internal" href="core_type_basics.html#sqlalchemy.types.Numeric" title="sqlalchemy.types.Numeric"><code class="xref py py-class docutils literal"><span class="pre">Numeric</span></code></a>&#x7C7B;&#x578B;&#x4E2D;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.types</span> <span class="kn">import</span> <span class="n">Numeric</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.sql</span> <span class="kn">import</span> <span class="n">func</span>

<span class="k">class</span> <span class="nc">CustomNumeric</span><span class="p">(</span><span class="n">Numeric</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">comparator_factory</span><span class="p">(</span><span class="n">Numeric</span><span class="o">.</span><span class="n">Comparator</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">func</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-206">&#x65B0;&#x7684;&#x7C7B;&#x578B;&#x53EF;&#x4EE5;&#x50CF;&#x4EFB;&#x4F55;&#x5176;&#x4ED6;&#x7C7B;&#x578B;&#x4E00;&#x6837;&#x4F7F;&#x7528;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&apos;data&apos;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
          <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;id&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
          <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;x&apos;</span><span class="p">,</span> <span class="n">CustomNumeric</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
          <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;y&apos;</span><span class="p">,</span> <span class="n">CustomNumeric</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
     <span class="p">)</span>

<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">data</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">y</span><span class="p">)])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span></pre></div></div><p><span class="yiyi-st" id="yiyi-207">&#x7531;&#x6B64;&#x4EA7;&#x751F;&#x7684;&#x65B0;&#x529F;&#x80FD;&#x7ACB;&#x5373;&#x5305;&#x62EC;&#x5BF9;Postgresql&#x7684;HSTORE&#x7C7B;&#x578B;&#x7684;&#x652F;&#x6301;&#xFF0C;&#x4EE5;&#x53CA;&#x4E0E;Postgresql&#x7684;ARRAY&#x7C7B;&#x578B;&#x76F8;&#x5173;&#x7684;&#x65B0;&#x64CD;&#x4F5C;&#x3002;</span><span class="yiyi-st" id="yiyi-208">&#x5B83;&#x8FD8;&#x4E3A;&#x73B0;&#x6709;&#x7C7B;&#x578B;&#x83B7;&#x53D6;&#x66F4;&#x591A;&#x7279;&#x5B9A;&#x4E8E;&#x8FD9;&#x4E9B;&#x7C7B;&#x578B;&#x7684;&#x8FD0;&#x7B97;&#x7B26;&#xFF08;&#x6BD4;&#x5982;&#x66F4;&#x591A;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x6574;&#x6570;&#x548C;&#x65E5;&#x671F;&#x8FD0;&#x7B97;&#x7B26;&#xFF09;&#x94FA;&#x5E73;&#x4E86;&#x9053;&#x8DEF;&#x3002;</span></p><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-209">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p><span class="yiyi-st" id="yiyi-210"><a class="reference internal" href="core_custom_types.html#types-operators"><span>Redefining and Creating New Operators</span></a></span></p><p class="last"><span class="yiyi-st" id="yiyi-211"><a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.HSTORE" title="sqlalchemy.dialects.postgresql.HSTORE"><code class="xref py py-class docutils literal"><span class="pre">HSTORE</span></code></a></span></p></div><p><span class="yiyi-st" id="yiyi-212"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2547">&#xFF03;2547  T0&gt;</a></span></p></div><div class="section" id="multiple-values-support-for-insert"><h3><span class="yiyi-st" id="yiyi-213">&#x5BF9;&#x63D2;&#x5165;<a class="headerlink" href="#multiple-values-support-for-insert" title="Permalink to this headline">&#xB6;</a>&#x7684;&#x591A;&#x503C;&#x652F;&#x6301;</span></h3><p><span class="yiyi-st" id="yiyi-214">The <a class="reference internal" href="core_dml.html#sqlalchemy.sql.expression.Insert.values" title="sqlalchemy.sql.expression.Insert.values"><code class="xref py py-meth docutils literal"><span class="pre">Insert.values()</span></code></a> method now supports a list of dictionaries, which will render a multi-VALUES statement such as <code class="docutils literal"><span class="pre">VALUES</span> <span class="pre">(&lt;row1&gt;),</span> <span class="pre">(&lt;row2&gt;),</span> <span class="pre">...</span></code>. </span><span class="yiyi-st" id="yiyi-215">&#x8FD9;&#x53EA;&#x4E0E;&#x652F;&#x6301;&#x8FD9;&#x79CD;&#x8BED;&#x6CD5;&#x7684;&#x540E;&#x7AEF;&#x76F8;&#x5173;&#xFF0C;&#x5305;&#x62EC;Postgresql&#xFF0C;SQLite&#x548C;MySQL&#x3002;</span><span class="yiyi-st" id="yiyi-216">&#x5B83;&#x4E0E;&#x901A;&#x5E38;&#x7684;<code class="docutils literal"><span class="pre">executemany()</span></code>&#x98CE;&#x683C;&#x7684;INSERT&#x4E0D;&#x540C;&#xFF0C;&#x5B83;&#x4FDD;&#x6301;&#x4E0D;&#x53D8;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">users</span><span class="o">.</span><span class="n">insert</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">([</span>
                    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;some name&quot;</span><span class="p">},</span>
                    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;some other name&quot;</span><span class="p">},</span>
                    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;yet another name&quot;</span><span class="p">},</span>
                <span class="p">])</span></pre></div></div><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-217">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-218"><a class="reference internal" href="core_dml.html#sqlalchemy.sql.expression.Insert.values" title="sqlalchemy.sql.expression.Insert.values"><code class="xref py py-meth docutils literal"><span class="pre">Insert.values()</span></code></a></span></p></div><p><span class="yiyi-st" id="yiyi-219"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2623">&#xFF03;2623  T0&gt;</a></span></p></div><div class="section" id="type-expressions"><h3><span class="yiyi-st" id="yiyi-220">&#x8F93;&#x5165;&#x8868;&#x8FBE;&#x5F0F;<a class="headerlink" href="#type-expressions" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-221">SQL&#x8868;&#x8FBE;&#x5F0F;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x4E0E;&#x7C7B;&#x578B;&#x76F8;&#x5173;&#x8054;&#x3002;</span><span class="yiyi-st" id="yiyi-222">Historically, <a class="reference internal" href="core_type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal"><span class="pre">TypeEngine</span></code></a> has always allowed Python-side functions which receive both bound parameters as well as result row values, passing them through a Python side conversion function on the way to/back from the database. </span><span class="yiyi-st" id="yiyi-223">&#x65B0;&#x529F;&#x80FD;&#x5141;&#x8BB8;&#x7C7B;&#x4F3C;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x9664;&#x4E86;&#x5728;&#x6570;&#x636E;&#x5E93;&#x65B9;&#x9762;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.types</span> <span class="kn">import</span> <span class="n">String</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">func</span><span class="p">,</span> <span class="n">Table</span><span class="p">,</span> <span class="n">Column</span><span class="p">,</span> <span class="n">MetaData</span>

<span class="k">class</span> <span class="nc">LowerString</span><span class="p">(</span><span class="n">String</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">bind_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bindvalue</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">func</span><span class="o">.</span><span class="n">lower</span><span class="p">(</span><span class="n">bindvalue</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">column_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">func</span><span class="o">.</span><span class="n">lower</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>

<span class="n">metadata</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">()</span>
<span class="n">test_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
        <span class="s1">&apos;test_table&apos;</span><span class="p">,</span>
        <span class="n">metadata</span><span class="p">,</span>
        <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;data&apos;</span><span class="p">,</span> <span class="n">LowerString</span><span class="p">)</span>
<span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-224">&#x4E0A;&#x9762;&#xFF0C;<code class="docutils literal"><span class="pre">LowerString</span></code>&#x7C7B;&#x578B;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x4E2A;SQL&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x53EA;&#x8981;&#x5728;SELECT&#x8BED;&#x53E5;&#x7684;columns&#x5B50;&#x53E5;&#x4E2D;&#x5448;&#x73B0;<code class="docutils literal"><span class="pre">test_table.c.data</span></code>&#x5217;&#x65F6;&#x5C31;&#x4F1A;&#x53D1;&#x51FA;&#x8BE5;&#x8868;&#x8FBE;&#x5F0F;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">select</span><span class="p">([</span><span class="n">test_table</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">test_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s1">&apos;HI&apos;</span><span class="p">))</span>
<span class="go">SELECT lower(test_table.data) AS data</span>
<span class="go">FROM test_table</span>
<span class="go">WHERE test_table.data = lower(:data_1)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-225">GeoAlchemy&#x7684;&#x65B0;&#x7248;&#x672C;&#x4E5F;&#x5927;&#x91CF;&#x4F7F;&#x7528;&#x4E86;&#x8BE5;&#x529F;&#x80FD;&#xFF0C;&#x4EE5;&#x4FBF;&#x6839;&#x636E;&#x7C7B;&#x578B;&#x89C4;&#x5219;&#x5728;SQL&#x4E2D;&#x5185;&#x8054;&#x5D4C;&#x5165;PostGIS&#x8868;&#x8FBE;&#x5F0F;&#x3002;</span></p><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-226">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-227"><a class="reference internal" href="core_custom_types.html#types-sql-value-processing"><span>Applying SQL-level Bind/Result Processing</span></a></span></p></div><p><span class="yiyi-st" id="yiyi-228"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/1534">&#xFF03;1534  T0&gt;</a></span></p></div><div class="section" id="core-inspection-system"><h3><span class="yiyi-st" id="yiyi-229">&#x6838;&#x5FC3;&#x68C0;&#x67E5;&#x7CFB;&#x7EDF;<a class="headerlink" href="#core-inspection-system" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-230"><a class="reference internal" href="#feature-orminspection-08"><span>New Class/Object Inspection System</span></a>&#x4E2D;&#x5F15;&#x5165;&#x7684;<a class="reference internal" href="core_inspection.html#sqlalchemy.inspection.inspect" title="sqlalchemy.inspection.inspect"><code class="xref py py-func docutils literal"><span class="pre">inspect()</span></code></a>&#x51FD;&#x6570;&#x4E5F;&#x9002;&#x7528;&#x4E8E;&#x6838;&#x5FC3;&#x3002;</span><span class="yiyi-st" id="yiyi-231">&#x5E94;&#x7528;&#x4E8E;<a class="reference internal" href="core_connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal"><span class="pre">Engine</span></code></a>&#x65F6;&#xFF0C;&#x5B83;&#x4F1A;&#x751F;&#x6210;&#x4E00;&#x4E2A;<a class="reference internal" href="core_reflection.html#sqlalchemy.engine.reflection.Inspector" title="sqlalchemy.engine.reflection.Inspector"><code class="xref py py-class docutils literal"><span class="pre">Inspector</span></code></a>&#x5BF9;&#x8C61;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">inspect</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;postgresql://scott:tiger@localhost/test&quot;</span><span class="p">)</span>
<span class="n">insp</span> <span class="o">=</span> <span class="n">inspect</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">insp</span><span class="o">.</span><span class="n">get_table_names</span><span class="p">())</span></pre></div></div><p><span class="yiyi-st" id="yiyi-232">It can also be applied to any <a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.ClauseElement" title="sqlalchemy.sql.expression.ClauseElement"><code class="xref py py-class docutils literal"><span class="pre">ClauseElement</span></code></a>, which returns the <a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.ClauseElement" title="sqlalchemy.sql.expression.ClauseElement"><code class="xref py py-class docutils literal"><span class="pre">ClauseElement</span></code></a> itself, such as <a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal"><span class="pre">Table</span></code></a>, <a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a>, <a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal"><span class="pre">Select</span></code></a>, etc. </span><span class="yiyi-st" id="yiyi-233">&#x8FD9;&#x4F7F;&#x5B83;&#x53EF;&#x4EE5;&#x5728;Core&#x548C;ORM&#x7ED3;&#x6784;&#x4E4B;&#x95F4;&#x6D41;&#x7545;&#x5730;&#x5DE5;&#x4F5C;&#x3002;</span></p></div><div class="section" id="new-method-select-correlate-except"><h3><span class="yiyi-st" id="yiyi-234">&#x65B0;&#x65B9;&#x6CD5;<a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.Select.correlate_except" title="sqlalchemy.sql.expression.Select.correlate_except"><code class="xref py py-meth docutils literal"><span class="pre">Select.correlate_except()</span></code></a> <a class="headerlink" href="#new-method-select-correlate-except" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-235"><a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal"><span class="pre">select()</span></code></a> now has a method <a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.Select.correlate_except" title="sqlalchemy.sql.expression.Select.correlate_except"><code class="xref py py-meth docutils literal"><span class="pre">Select.correlate_except()</span></code></a> which specifies &#x201C;correlate on all FROM clauses except those specified&#x201D;. </span><span class="yiyi-st" id="yiyi-236">&#x5B83;&#x53EF;&#x7528;&#x4E8E;&#x6620;&#x5C04;&#x76F8;&#x5173;&#x5B50;&#x67E5;&#x8BE2;&#x5E94;&#x6B63;&#x5E38;&#x5173;&#x8054;&#x7684;&#x573A;&#x666F;&#xFF0C;&#x9664;&#x4E86;&#x53EF;&#x9009;&#x7684;&#x7279;&#x5B9A;&#x76EE;&#x6807;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SnortEvent</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;event&quot;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">signature</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;signature.id&quot;</span><span class="p">))</span>

    <span class="n">signatures</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Signature&quot;</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Signature</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;signature&quot;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">sig_count</span> <span class="o">=</span> <span class="n">column_property</span><span class="p">(</span>
                    <span class="n">select</span><span class="p">([</span><span class="n">func</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&apos;*&apos;</span><span class="p">)])</span><span class="o">.</span>\
                        <span class="n">where</span><span class="p">(</span><span class="n">SnortEvent</span><span class="o">.</span><span class="n">signature</span> <span class="o">==</span> <span class="nb">id</span><span class="p">)</span><span class="o">.</span>
                        <span class="n">correlate_except</span><span class="p">(</span><span class="n">SnortEvent</span><span class="p">)</span>
                <span class="p">)</span></pre></div></div><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-237">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-238"><a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.Select.correlate_except" title="sqlalchemy.sql.expression.Select.correlate_except"><code class="xref py py-meth docutils literal"><span class="pre">Select.correlate_except()</span></code></a></span></p></div></div><div class="section" id="postgresql-hstore-type"><h3><span class="yiyi-st" id="yiyi-239">Postgresql HSTORE&#x7C7B;&#x578B;<a class="headerlink" href="#postgresql-hstore-type" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-240">&#x5BF9;Postgresql&#x7684;<code class="docutils literal"><span class="pre">HSTORE</span></code>&#x7C7B;&#x578B;&#x7684;&#x652F;&#x6301;&#x73B0;&#x5728;&#x53EF;&#x7528;&#x4F5C;<a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.HSTORE" title="sqlalchemy.dialects.postgresql.HSTORE"><code class="xref py py-class docutils literal"><span class="pre">postgresql.HSTORE</span></code></a>&#x3002;</span><span class="yiyi-st" id="yiyi-241">This type makes great usage of the new operator system to provide a full range of operators for HSTORE types, including index access, concatenation, and containment methods such as <code class="xref py py-meth docutils literal"><span class="pre">has_key()</span></code>, <code class="xref py py-meth docutils literal"><span class="pre">has_any()</span></code>, and <code class="xref py py-meth docutils literal"><span class="pre">matrix()</span></code>:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.dialects.postgresql</span> <span class="kn">import</span> <span class="n">HSTORE</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&apos;data_table&apos;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
        <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;id&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;hstore_data&apos;</span><span class="p">,</span> <span class="n">HSTORE</span><span class="p">)</span>
    <span class="p">)</span>

<span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
    <span class="n">select</span><span class="p">([</span><span class="n">data</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">hstore_data</span><span class="p">[</span><span class="s1">&apos;some_key&apos;</span><span class="p">]])</span>
<span class="p">)</span><span class="o">.</span><span class="n">scalar</span><span class="p">()</span>

<span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
    <span class="n">select</span><span class="p">([</span><span class="n">data</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">hstore_data</span><span class="o">.</span><span class="n">matrix</span><span class="p">()])</span>
<span class="p">)</span><span class="o">.</span><span class="n">scalar</span><span class="p">()</span></pre></div></div><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-242">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p><span class="yiyi-st" id="yiyi-243"><a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.HSTORE" title="sqlalchemy.dialects.postgresql.HSTORE"><code class="xref py py-class docutils literal"><span class="pre">postgresql.HSTORE</span></code></a></span></p><p class="last"><span class="yiyi-st" id="yiyi-244"><a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.hstore" title="sqlalchemy.dialects.postgresql.hstore"><code class="xref py py-class docutils literal"><span class="pre">postgresql.hstore</span></code></a></span></p></div><p><span class="yiyi-st" id="yiyi-245"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2606">&#xFF03;2606  T0&gt;</a></span></p></div><div class="section" id="enhanced-postgresql-array-type"><h3><span class="yiyi-st" id="yiyi-246">&#x589E;&#x5F3A;&#x7684;Postgresql ARRAY&#x7C7B;&#x578B;<a class="headerlink" href="#enhanced-postgresql-array-type" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-247"><a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.ARRAY" title="sqlalchemy.dialects.postgresql.ARRAY"><code class="xref py py-class docutils literal"><span class="pre">postgresql.ARRAY</span></code></a>&#x7C7B;&#x578B;&#x5C06;&#x63A5;&#x53D7;&#x53EF;&#x9009;&#x7684;&#x201C;&#x7EF4;&#x5EA6;&#x201D;&#x53C2;&#x6570;&#xFF0C;&#x5C06;&#x5176;&#x56FA;&#x5B9A;&#x4E3A;&#x56FA;&#x5B9A;&#x6570;&#x91CF;&#x7684;&#x7EF4;&#x5EA6;&#xFF0C;&#x5E76;&#x5728;&#x68C0;&#x7D22;&#x7ED3;&#x679C;&#x65F6;&#x5927;&#x5927;&#x63D0;&#x9AD8;&#x6548;&#x7387;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># old way, still works since PG supports N-dimensions per row:</span>
<span class="n">Column</span><span class="p">(</span><span class="s2">&quot;my_array&quot;</span><span class="p">,</span> <span class="n">postgresql</span><span class="o">.</span><span class="n">ARRAY</span><span class="p">(</span><span class="n">Integer</span><span class="p">))</span>

<span class="c1"># new way, will render ARRAY with correct number of [] in DDL,</span>
<span class="c1"># will process binds and results more efficiently as we don&apos;t need</span>
<span class="c1"># to guess how many levels deep to go</span>
<span class="n">Column</span><span class="p">(</span><span class="s2">&quot;my_array&quot;</span><span class="p">,</span> <span class="n">postgresql</span><span class="o">.</span><span class="n">ARRAY</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-248">&#x8BE5;&#x7C7B;&#x578B;&#x8FD8;&#x5F15;&#x5165;&#x4E86;&#x65B0;&#x7684;&#x8FD0;&#x7B97;&#x7B26;&#xFF0C;&#x4F7F;&#x7528;&#x65B0;&#x7684;&#x7C7B;&#x578B;&#x7279;&#x5B9A;&#x7684;&#x8FD0;&#x7B97;&#x7B26;&#x6846;&#x67B6;&#x3002;</span><span class="yiyi-st" id="yiyi-249">&#x65B0;&#x7684;&#x64CD;&#x4F5C;&#x5305;&#x62EC;&#x7D22;&#x5F15;&#x8BBF;&#x95EE;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
    <span class="n">select</span><span class="p">([</span><span class="n">mytable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">arraycol</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
<span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-250">&#x5728;SELECT&#x4E2D;&#x5207;&#x7247;&#x8BBF;&#x95EE;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
    <span class="n">select</span><span class="p">([</span><span class="n">mytable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">arraycol</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]])</span>
<span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-251">&#x5728;&#x66F4;&#x65B0;&#x4E2D;&#x5207;&#x7247;&#x66F4;&#x65B0;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
    <span class="n">mytable</span><span class="o">.</span><span class="n">update</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">({</span><span class="n">mytable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">arraycol</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">]:</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]})</span>
<span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-252">&#x72EC;&#x7ACB;&#x9635;&#x5217;&#x6587;&#x5B57;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy.dialects</span> <span class="kn">import</span> <span class="n">postgresql</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">conn</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span>
<span class="gp">... </span>   <span class="n">select</span><span class="p">([</span>
<span class="gp">... </span>       <span class="n">postgresql</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="n">postgresql</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="gp">... </span>   <span class="p">])</span>
<span class="gp">... </span> <span class="p">)</span>
<span class="go">[1, 2, 3, 4, 5]</span></pre></div></div><p><span class="yiyi-st" id="yiyi-253">&#x6570;&#x7EC4;&#x4E32;&#x8054;&#xFF0C;&#x5176;&#x4E2D;&#x53F3;&#x4FA7;<code class="docutils literal"><span class="pre">[4&#xFF0C;</span> <span class="pre">5&#xFF0C;</span> <span class="pre">6&gt;</span></code>&#xFF09;&#x88AB;&#x5F3A;&#x5236;&#x8F6C;&#x6362;&#x4E3A;&#x6570;&#x7EC4;&#x6587;&#x5B57;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">select</span><span class="p">([</span><span class="n">mytable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">arraycol</span> <span class="o">+</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]])</span></pre></div></div><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-254">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p><span class="yiyi-st" id="yiyi-255"><a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.ARRAY" title="sqlalchemy.dialects.postgresql.ARRAY"><code class="xref py py-class docutils literal"><span class="pre">postgresql.ARRAY</span></code></a></span></p><p class="last"><span class="yiyi-st" id="yiyi-256"><a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.array" title="sqlalchemy.dialects.postgresql.array"><code class="xref py py-class docutils literal"><span class="pre">postgresql.array</span></code></a></span></p></div><p><span class="yiyi-st" id="yiyi-257"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2441">&#xFF03;2441  T0&gt;</a></span></p></div><div class="section" id="new-configurable-date-time-types-for-sqlite"><h3><span class="yiyi-st" id="yiyi-258">SQLite <a class="headerlink" href="#new-configurable-date-time-types-for-sqlite" title="Permalink to this headline">&#xB6;</a>&#x7684;&#x65B0;&#x7684;&#xFF0C;&#x53EF;&#x914D;&#x7F6E;&#x7684;DATE&#xFF0C;TIME&#x7C7B;&#x578B;</span></h3><p><span class="yiyi-st" id="yiyi-259">SQLite&#x6CA1;&#x6709;&#x5185;&#x7F6E;&#x7684;DATE&#xFF0C;TIME&#x6216;DATETIME&#x7C7B;&#x578B;&#xFF0C;&#x800C;&#x662F;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E9B;&#x652F;&#x6301;&#x5C06;&#x65E5;&#x671F;&#x548C;&#x65F6;&#x95F4;&#x503C;&#x5B58;&#x50A8;&#x4E3A;&#x5B57;&#x7B26;&#x4E32;&#x6216;&#x6574;&#x6570;&#x3002;</span><span class="yiyi-st" id="yiyi-260">SQLite&#x7684;&#x65E5;&#x671F;&#x548C;&#x65F6;&#x95F4;&#x7C7B;&#x578B;&#x5728;0.8&#x4E2D;&#x5F97;&#x5230;&#x4E86;&#x589E;&#x5F3A;&#xFF0C;&#x53EF;&#x4EE5;&#x9488;&#x5BF9;&#x7279;&#x5B9A;&#x683C;&#x5F0F;&#x8FDB;&#x884C;&#x66F4;&#x591A;&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x5305;&#x62EC;&#x201C;&#x5FAE;&#x79D2;&#x201D;&#x90E8;&#x5206;&#x662F;&#x53EF;&#x9009;&#x7684;&#xFF0C;&#x4EE5;&#x53CA;&#x5176;&#x4ED6;&#x51E0;&#x4E4E;&#x6240;&#x6709;&#x7684;&#x90E8;&#x5206;&#x3002;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">Column</span><span class="p">(</span><span class="s1">&apos;sometimestamp&apos;</span><span class="p">,</span> <span class="n">sqlite</span><span class="o">.</span><span class="n">DATETIME</span><span class="p">(</span><span class="n">truncate_microseconds</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
<span class="n">Column</span><span class="p">(</span><span class="s1">&apos;sometimestamp&apos;</span><span class="p">,</span> <span class="n">sqlite</span><span class="o">.</span><span class="n">DATETIME</span><span class="p">(</span>
                    <span class="n">storage_format</span><span class="o">=</span><span class="p">(</span>
                                <span class="s2">&quot;</span><span class="si">%(year)04d%(month)02d%(day)02d</span><span class="s2">&quot;</span>
                                <span class="s2">&quot;</span><span class="si">%(hour)02d%(minute)02d%(second)02d%(microsecond)06d</span><span class="s2">&quot;</span>
                    <span class="p">),</span>
                    <span class="n">regexp</span><span class="o">=</span><span class="s2">&quot;(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{6})&quot;</span>
                    <span class="p">)</span>
            <span class="p">)</span>
<span class="n">Column</span><span class="p">(</span><span class="s1">&apos;somedate&apos;</span><span class="p">,</span> <span class="n">sqlite</span><span class="o">.</span><span class="n">DATE</span><span class="p">(</span>
                    <span class="n">storage_format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(month)02d</span><span class="s2">/</span><span class="si">%(day)02d</span><span class="s2">/</span><span class="si">%(year)04d</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">regexp</span><span class="o">=</span><span class="s2">&quot;(?P&lt;month&gt;\d+)/(?P&lt;day&gt;\d+)/(?P&lt;year&gt;\d+)&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-261">&#x975E;&#x5E38;&#x611F;&#x8C22;Nate Dub&#x5728;Pycon 2012&#x4E0A;&#x7684;&#x51B2;&#x523A;&#x3002;</span></p><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-262">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p><span class="yiyi-st" id="yiyi-263"><a class="reference internal" href="dialects_sqlite.html#sqlalchemy.dialects.sqlite.DATETIME" title="sqlalchemy.dialects.sqlite.DATETIME"><code class="xref py py-class docutils literal"><span class="pre">sqlite.DATETIME</span></code></a></span></p><p><span class="yiyi-st" id="yiyi-264"><a class="reference internal" href="dialects_sqlite.html#sqlalchemy.dialects.sqlite.DATE" title="sqlalchemy.dialects.sqlite.DATE"><code class="xref py py-class docutils literal"><span class="pre">sqlite.DATE</span></code></a></span></p><p class="last"><span class="yiyi-st" id="yiyi-265"><a class="reference internal" href="dialects_sqlite.html#sqlalchemy.dialects.sqlite.TIME" title="sqlalchemy.dialects.sqlite.TIME"><code class="xref py py-class docutils literal"><span class="pre">sqlite.TIME</span></code></a></span></p></div><p><span class="yiyi-st" id="yiyi-266"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2363">&#xFF03;2363  T0&gt;</a></span></p></div><div class="section" id="collate-supported-across-all-dialects-in-particular-mysql-postgresql-sqlite"><h3><span class="yiyi-st" id="yiyi-267">&#x6240;&#x6709;&#x65B9;&#x8A00;&#x90FD;&#x652F;&#x6301;&#x201C;COLLATE&#x201D;&#xFF1B;&#x7279;&#x522B;&#x662F;MySQL&#xFF0C;Postgresql&#xFF0C;SQLite <a class="headerlink" href="#collate-supported-across-all-dialects-in-particular-mysql-postgresql-sqlite" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-268">The &#x201C;collate&#x201D; keyword, long accepted by the MySQL dialect, is now established on all <a class="reference internal" href="core_type_basics.html#sqlalchemy.types.String" title="sqlalchemy.types.String"><code class="xref py py-class docutils literal"><span class="pre">String</span></code></a> types and will render on any backend, including when features such as <a class="reference internal" href="core_metadata.html#sqlalchemy.schema.MetaData.create_all" title="sqlalchemy.schema.MetaData.create_all"><code class="xref py py-meth docutils literal"><span class="pre">MetaData.create_all()</span></code></a> and <a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.cast" title="sqlalchemy.sql.expression.cast"><code class="xref py py-func docutils literal"><span class="pre">cast()</span></code></a> is used:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">cast</span><span class="p">(</span><span class="n">sometable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">somechar</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="n">collation</span><span class="o">=</span><span class="s1">&apos;utf8&apos;</span><span class="p">))])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<span class="go">SELECT CAST(sometable.somechar AS VARCHAR(20) COLLATE &quot;utf8&quot;) AS anon_1</span>
<span class="go">FROM sometable</span></pre></div></div><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-269">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-270"><a class="reference internal" href="core_type_basics.html#sqlalchemy.types.String" title="sqlalchemy.types.String"><code class="xref py py-class docutils literal"><span class="pre">String</span></code></a></span></p></div><p><span class="yiyi-st" id="yiyi-271"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2276">&#xFF03;2276  T0&gt;</a></span></p></div><div class="section" id="prefixes-now-supported-for-update-delete"><h3><span class="yiyi-st" id="yiyi-272">&#x201C;&#x524D;&#x7F00;&#x201D;&#x73B0;&#x5728;&#x652F;&#x6301;<a class="reference internal" href="core_dml.html#sqlalchemy.sql.expression.update" title="sqlalchemy.sql.expression.update"><code class="xref py py-func docutils literal"><span class="pre">update()</span></code></a>&#xFF0C;<a class="reference internal" href="core_dml.html#sqlalchemy.sql.expression.delete" title="sqlalchemy.sql.expression.delete"><code class="xref py py-func docutils literal"><span class="pre">delete()</span></code></a> <a class="headerlink" href="#prefixes-now-supported-for-update-delete" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-273">&#x9762;&#x5411;MySQL&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x4EFB;&#x4F55;&#x8FD9;&#x4E9B;&#x7ED3;&#x6784;&#x4E2D;&#x5448;&#x73B0;&#x201C;&#x524D;&#x7F00;&#x201D;&#x3002;</span><span class="yiyi-st" id="yiyi-274">&#x4F8B;&#x5982;&#x3002;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">stmt</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span><span class="o">.</span><span class="n">prefix_with</span><span class="p">(</span><span class="s2">&quot;LOW_PRIORITY&quot;</span><span class="p">,</span> <span class="n">dialect</span><span class="o">=</span><span class="s2">&quot;mysql&quot;</span><span class="p">)</span>


<span class="n">stmt</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">update</span><span class="p">()</span><span class="o">.</span><span class="n">prefix_with</span><span class="p">(</span><span class="s2">&quot;LOW_PRIORITY&quot;</span><span class="p">,</span> <span class="n">dialect</span><span class="o">=</span><span class="s2">&quot;mysql&quot;</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-275">&#x9664;&#x4E86;&#x90A3;&#x4E9B;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x4E8E;<a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.dml.insert" title="sqlalchemy.dialects.postgresql.dml.insert"><code class="xref py py-func docutils literal"><span class="pre">insert()</span></code></a>&#xFF0C;<a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal"><span class="pre">select()</span></code></a>&#x548C;<a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query" title="sqlalchemy.orm.query.Query"><code class="xref py py-class docutils literal"><span class="pre">Query</span></code></a>&#x4E0A;&#x7684;&#x65B9;&#x6CD5;&#x4E4B;&#x5916;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x662F;&#x65B0;&#x589E;&#x7684;&#x3002;</span></p><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-276">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p><span class="yiyi-st" id="yiyi-277"><a class="reference internal" href="core_dml.html#sqlalchemy.sql.expression.Update.prefix_with" title="sqlalchemy.sql.expression.Update.prefix_with"><code class="xref py py-meth docutils literal"><span class="pre">Update.prefix_with()</span></code></a></span></p><p><span class="yiyi-st" id="yiyi-278"><a class="reference internal" href="core_dml.html#sqlalchemy.sql.expression.Delete.prefix_with" title="sqlalchemy.sql.expression.Delete.prefix_with"><code class="xref py py-meth docutils literal"><span class="pre">Delete.prefix_with()</span></code></a></span></p><p><span class="yiyi-st" id="yiyi-279"><a class="reference internal" href="core_dml.html#sqlalchemy.sql.expression.Insert.prefix_with" title="sqlalchemy.sql.expression.Insert.prefix_with"><code class="xref py py-meth docutils literal"><span class="pre">Insert.prefix_with()</span></code></a></span></p><p><span class="yiyi-st" id="yiyi-280"><a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.Select.prefix_with" title="sqlalchemy.sql.expression.Select.prefix_with"><code class="xref py py-meth docutils literal"><span class="pre">Select.prefix_with()</span></code></a></span></p><p class="last"><span class="yiyi-st" id="yiyi-281"><a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query.prefix_with" title="sqlalchemy.orm.query.Query.prefix_with"><code class="xref py py-meth docutils literal"><span class="pre">Query.prefix_with()</span></code></a></span></p></div><p><span class="yiyi-st" id="yiyi-282"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2431">&#xFF03;2431  T0&gt;</a></span></p></div></div><div class="section" id="behavioral-changes"><h2><span class="yiyi-st" id="yiyi-283">&#x884C;&#x4E3A;&#x6539;&#x53D8;<a class="headerlink" href="#behavioral-changes" title="Permalink to this headline">&#xB6;</a></span></h2><div class="section" id="the-consideration-of-a-pending-object-as-an-orphan-has-been-made-more-aggressive"><h3><span class="yiyi-st" id="yiyi-284">&#x201C;&#x5F85;&#x51B3;&#x201D;&#x5BF9;&#x8C61;&#x4F5C;&#x4E3A;&#x201C;&#x5B64;&#x513F;&#x201D;&#x7684;&#x8003;&#x8651;&#x5DF2;&#x7ECF;&#x53D8;&#x5F97;&#x66F4;&#x52A0;&#x6FC0;&#x8FDB;<a class="headerlink" href="#the-consideration-of-a-pending-object-as-an-orphan-has-been-made-more-aggressive" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-285">&#x8FD9;&#x662F;0.8&#x7CFB;&#x5217;&#x7684;&#x540E;&#x671F;&#x589E;&#x52A0;&#xFF0C;&#x4F46;&#x5E0C;&#x671B;&#x65B0;&#x7684;&#x884C;&#x4E3A;&#x5728;&#x66F4;&#x5E7F;&#x6CDB;&#x7684;&#x5404;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#x901A;&#x5E38;&#x66F4;&#x52A0;&#x4E00;&#x81F4;&#x548C;&#x76F4;&#x89C2;&#x3002;</span><span class="yiyi-st" id="yiyi-286">The ORM has since at least version 0.4 included behavior such that an object that&#x2019;s &#x201C;pending&#x201D;, meaning that it&#x2019;s associated with a <a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a> but hasn&#x2019;t been inserted into the database yet, is automatically expunged from the <a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a> when it becomes an &#x201C;orphan&#x201D;, which means it has been de-associated with a parent object that refers to it with <code class="docutils literal"><span class="pre">delete-orphan</span></code> cascade on the configured <a class="reference internal" href="orm_relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>. </span><span class="yiyi-st" id="yiyi-287">&#x6B64;&#x884C;&#x4E3A;&#x65E8;&#x5728;&#x5927;&#x81F4;&#x53CD;&#x6620;&#x6301;&#x4E45;&#x6027;&#xFF08;&#x5373;&#x5DF2;&#x63D2;&#x5165;&#xFF09;&#x5BF9;&#x8C61;&#x7684;&#x884C;&#x4E3A;&#xFF0C;&#x5176;&#x4E2D;ORM&#x5C06;&#x9488;&#x5BF9;&#x57FA;&#x4E8E;&#x62E6;&#x622A;&#x4E8B;&#x4EF6;&#x7684;&#x5B64;&#x7ACB;&#x6210;&#x4E3A;&#x5B64;&#x7ACB;&#x5BF9;&#x8C61;&#x7684;&#x8FD9;&#x4E9B;&#x5BF9;&#x8C61;&#x53D1;&#x51FA;DELETE&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-288">&#x5BF9;&#x4E8E;&#x7531;&#x591A;&#x79CD;&#x7236;&#x9879;&#x5F15;&#x7528;&#x7684;&#x5BF9;&#x8C61;&#xFF08;&#x6BCF;&#x4E2A;&#x5BF9;&#x8C61;&#x6307;&#x5B9A;&#x4E86;<code class="docutils literal"><span class="pre">delete-orphan</span></code>&#xFF09;&#xFF0C;&#x884C;&#x4E3A;&#x53D8;&#x5316;&#x90FD;&#x4F1A;&#x53D1;&#x6325;&#x4F5C;&#x7528;&#x3002;&#x5178;&#x578B;&#x7684;&#x4F8B;&#x5B50;&#x662F;&#x4E00;&#x4E2A;<a class="reference internal" href="orm_basic_relationships.html#association-pattern"><span>association object</span></a>&#xFF0C;&#x5B83;&#x4EE5;&#x591A;&#x5BF9;&#x591A;&#x7684;&#x6A21;&#x5F0F;&#x8FDE;&#x63A5;&#x4E24;&#x79CD;&#x5176;&#x4ED6;&#x7C7B;&#x578B;&#x7684;&#x5BF9;&#x8C61;&#x3002;</span><span class="yiyi-st" id="yiyi-289">&#x4EE5;&#x524D;&#xFF0C;&#x884C;&#x4E3A;&#x662F;&#x8FD9;&#x6837;&#x7684;&#xFF0C;&#x53EA;&#x6709;&#x5728;&#x4E0E;&#x5176;&#x7236;&#x6BCD;&#x7684;<em>all</em>&#x5173;&#x8054;&#x65F6;&#xFF0C;&#x5F85;&#x5904;&#x7406;&#x5BF9;&#x8C61;&#x624D;&#x4F1A;&#x88AB;&#x6E05;&#x9664;&#x3002;</span><span class="yiyi-st" id="yiyi-290">&#x968F;&#x7740;&#x884C;&#x4E3A;&#x7684;&#x53D8;&#x5316;&#xFF0C;&#x4E00;&#x65E6;&#x4ECE;<em>&#x4E0E;&#x4E4B;&#x524D;&#x5173;&#x8054;&#x7684;&#x7236;&#x6BCD;&#x7684;&#x4EFB;&#x4F55;</em>&#x53BB;&#x76F8;&#x5173;&#x8054;&#xFF0C;&#x5F85;&#x5904;&#x7406;&#x5BF9;&#x8C61;&#x5C31;&#x88AB;&#x6E05;&#x9664;&#x3002;</span><span class="yiyi-st" id="yiyi-291">&#x6B64;&#x884C;&#x4E3A;&#x65E8;&#x5728;&#x66F4;&#x52A0;&#x7D27;&#x5BC6;&#x5730;&#x5339;&#x914D;&#x6301;&#x4E45;&#x5BF9;&#x8C61;&#x7684;&#x884C;&#x4E3A;&#xFF0C;&#x6301;&#x4E45;&#x5BF9;&#x8C61;&#x4E0E;&#x7236;&#x5BF9;&#x8C61;&#x5173;&#x8054;&#x540E;&#x7ACB;&#x5373;&#x5220;&#x9664;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-292">&#x65E7;&#x7248;&#x884C;&#x4E3A;&#x7684;&#x57FA;&#x672C;&#x539F;&#x7406;&#x81F3;&#x5C11;&#x53EF;&#x4EE5;&#x8FFD;&#x6EAF;&#x5230;&#x7248;&#x672C;0.4&#xFF0C;&#x5E76;&#x4E14;&#x57FA;&#x672C;&#x4E0A;&#x662F;&#x4E00;&#x4E2A;&#x9632;&#x5FA1;&#x6027;&#x7684;&#x51B3;&#x5B9A;&#xFF0C;&#x5F53;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x4ECD;&#x5728;&#x4E3A;INSERT&#x6784;&#x5EFA;&#x65F6;&#xFF0C;&#x8BD5;&#x56FE;&#x51CF;&#x8F7B;&#x6DF7;&#x6DC6;&#x3002;</span><span class="yiyi-st" id="yiyi-293">&#x4F46;&#x4E8B;&#x5B9E;&#x662F;&#xFF0C;&#x53EA;&#x8981;&#x5728;&#x4EFB;&#x4F55;&#x60C5;&#x51B5;&#x4E0B;&#x5C06;&#x5BF9;&#x8C61;&#x8FDE;&#x63A5;&#x5230;&#x4EFB;&#x4F55;&#x65B0;&#x7684;&#x7236;&#x5BF9;&#x8C61;&#xFF0C;&#x5BF9;&#x8C61;&#x5C31;&#x4F1A;&#x4E0E;<a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a></span></p><p><span class="yiyi-st" id="yiyi-294">&#x5982;&#x679C;&#x5BF9;&#x8C61;&#x4E0D;&#x662F;&#x9996;&#x5148;&#x4E0E;&#x90A3;&#x4E9B;&#x7236;&#x6BCD;&#x5173;&#x8054;&#xFF0C;&#x6216;&#x8005;&#x5982;&#x679C;&#x5B83;&#x5DF2;&#x88AB;&#x6E05;&#x9664;&#xFF0C;&#x4F46;&#x968F;&#x540E;&#x91CD;&#x65B0;&#x4E0E;<a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x901A;&#x8FC7;&#x540E;&#x7EED;&#x7684;&#x9644;&#x4EF6;&#x4E8B;&#x4EF6;&#xFF0C;&#x4F46;&#x4ECD;&#x672A;&#x5B8C;&#x5168;&#x5173;&#x8054;&#x3002;</span><span class="yiyi-st" id="yiyi-295">&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x9884;&#x8BA1;&#x6570;&#x636E;&#x5E93;&#x4F1A;&#x53D1;&#x51FA;&#x5B8C;&#x6574;&#x6027;&#x9519;&#x8BEF;&#xFF0C;&#x56E0;&#x4E3A;&#x53EF;&#x80FD;&#x6709;NOT NULL&#x5916;&#x952E;&#x5217;&#x672A;&#x88AB;&#x586B;&#x5145;&#x3002;</span><span class="yiyi-st" id="yiyi-296">ORM&#x51B3;&#x5B9A;&#x8BA9;&#x8FD9;&#x4E9B;INSERT&#x5C1D;&#x8BD5;&#x53D1;&#x751F;&#xFF0C;&#x8FD9;&#x662F;&#x57FA;&#x4E8E;&#x5224;&#x65AD;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x53EA;&#x662F;&#x90E8;&#x5206;&#x4E0E;&#x5176;&#x6240;&#x9700;&#x7684;&#x7236;&#x5BF9;&#x8C61;&#x5173;&#x8054;&#xFF0C;&#x4F46;&#x4E0E;&#x5176;&#x4E2D;&#x4E00;&#x4E9B;&#x5BF9;&#x8C61;&#x6709;&#x6D3B;&#x52A8;&#x5173;&#x8054;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x901A;&#x5E38;&#x4E0D;&#x662F;&#x7528;&#x6237;&#x9519;&#x8BEF;&#xFF0C;&#x800C;&#x662F;&#x6545;&#x610F;&#x5FFD;&#x7565;&#xFF0C;&#x5E94;&#x8BE5;&#x9ED8;&#x9ED8;&#x8DF3;&#x8FC7; - &#x5728;&#x8FD9;&#x91CC;&#x9ED8;&#x9ED8;&#x5730;&#x8DF3;&#x8FC7;INSERT&#x4F1A;&#x5BFC;&#x81F4;&#x8FD9;&#x79CD;&#x6027;&#x8D28;&#x7684;&#x7528;&#x6237;&#x9519;&#x8BEF;&#x975E;&#x5E38;&#x96BE;&#x4EE5;&#x8C03;&#x8BD5;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-297">&#x901A;&#x8FC7;&#x5C06;flag <code class="docutils literal"><span class="pre">legacy_is_orphan</span></code>&#x6307;&#x5B9A;&#x4E3A;&#x6620;&#x5C04;&#x5668;&#x9009;&#x9879;&#xFF0C;&#x53EF;&#x4EE5;&#x91CD;&#x65B0;&#x4E3A;&#x4EFB;&#x4F55;<a class="reference internal" href="orm_mapping_api.html#sqlalchemy.orm.mapper.Mapper" title="sqlalchemy.orm.mapper.Mapper"><code class="xref py py-class docutils literal"><span class="pre">Mapper</span></code></a>&#x542F;&#x7528;&#x53EF;&#x80FD;&#x4F9D;&#x8D56;&#x5B83;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x65E7;&#x884C;&#x4E3A;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-298">&#x65B0;&#x7684;&#x884C;&#x4E3A;&#x5141;&#x8BB8;&#x4EE5;&#x4E0B;&#x6D4B;&#x8BD5;&#x7528;&#x4F8B;&#x7684;&#x5DE5;&#x4F5C;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">ForeignKey</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">relationship</span><span class="p">,</span> <span class="n">backref</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>

<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;user&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">64</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">UserKeyword</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;user_keyword&apos;</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;user.id&apos;</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">keyword_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;keyword.id&apos;</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">user</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="n">User</span><span class="p">,</span>
                <span class="n">backref</span><span class="o">=</span><span class="n">backref</span><span class="p">(</span><span class="s2">&quot;user_keywords&quot;</span><span class="p">,</span>
                                <span class="n">cascade</span><span class="o">=</span><span class="s2">&quot;all, delete-orphan&quot;</span><span class="p">)</span>
            <span class="p">)</span>

    <span class="n">keyword</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Keyword&quot;</span><span class="p">,</span>
                <span class="n">backref</span><span class="o">=</span><span class="n">backref</span><span class="p">(</span><span class="s2">&quot;user_keywords&quot;</span><span class="p">,</span>
                                <span class="n">cascade</span><span class="o">=</span><span class="s2">&quot;all, delete-orphan&quot;</span><span class="p">)</span>
            <span class="p">)</span>

    <span class="c1"># uncomment this to enable the old behavior</span>
    <span class="c1"># __mapper_args__ = {&quot;legacy_is_orphan&quot;: True}</span>

<span class="k">class</span> <span class="nc">Keyword</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;keyword&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">keyword</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;keyword&apos;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">64</span><span class="p">))</span>

<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">Session</span>

<span class="c1"># note we&apos;re using Postgresql to ensure that referential integrity</span>
<span class="c1"># is enforced, for demonstration purposes.</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;postgresql://scott:tiger@localhost/test&quot;</span><span class="p">,</span> <span class="n">echo</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">drop_all</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="n">u1</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;u1&quot;</span><span class="p">)</span>
<span class="n">k1</span> <span class="o">=</span> <span class="n">Keyword</span><span class="p">(</span><span class="n">keyword</span><span class="o">=</span><span class="s2">&quot;k1&quot;</span><span class="p">)</span>

<span class="n">session</span><span class="o">.</span><span class="n">add_all</span><span class="p">([</span><span class="n">u1</span><span class="p">,</span> <span class="n">k1</span><span class="p">])</span>

<span class="n">uk1</span> <span class="o">=</span> <span class="n">UserKeyword</span><span class="p">(</span><span class="n">keyword</span><span class="o">=</span><span class="n">k1</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">u1</span><span class="p">)</span>

<span class="c1"># previously, if session.flush() were called here,</span>
<span class="c1"># this operation would succeed, but if session.flush()</span>
<span class="c1"># were not called here, the operation fails with an</span>
<span class="c1"># integrity error.</span>
<span class="c1"># session.flush()</span>
<span class="k">del</span> <span class="n">u1</span><span class="o">.</span><span class="n">user_keywords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></pre></div></div><p><span class="yiyi-st" id="yiyi-299"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2655">&#xFF03;2655  T0&gt;</a></span></p></div><div class="section" id="the-after-attach-event-fires-after-the-item-is-associated-with-the-session-instead-of-before-before-attach-added"><h3><span class="yiyi-st" id="yiyi-300">after_attach&#x4E8B;&#x4EF6;&#x5728;&#x4E0E;&#x4F1A;&#x8BDD;&#x76F8;&#x5173;&#x8054;&#x800C;&#x4E0D;&#x662F;&#x4E4B;&#x524D;&#x89E6;&#x53D1;&#x540E;&#x89E6;&#x53D1;&#xFF1B; before_attach&#x6DFB;&#x52A0;<a class="headerlink" href="#the-after-attach-event-fires-after-the-item-is-associated-with-the-session-instead-of-before-before-attach-added" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-301">&#x4F7F;&#x7528;after_attach&#x7684;&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x5047;&#x5B9A;&#x7ED9;&#x5B9A;&#x5B9E;&#x4F8B;&#x4E0E;&#x7ED9;&#x5B9A;&#x4F1A;&#x8BDD;&#x5173;&#x8054;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@event.listens_for</span><span class="p">(</span><span class="n">Session</span><span class="p">,</span> <span class="s2">&quot;after_attach&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">after_attach</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">instance</span> <span class="ow">in</span> <span class="n">session</span></pre></div></div><p><span class="yiyi-st" id="yiyi-302">&#x4E00;&#x4E9B;&#x7528;&#x4F8B;&#x8981;&#x6C42;&#x5B83;&#x4EE5;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x5DE5;&#x4F5C;&#x3002;</span><span class="yiyi-st" id="yiyi-303">&#x4F46;&#x662F;&#xFF0C;&#x5176;&#x4ED6;&#x7528;&#x4F8B;&#x8981;&#x6C42;&#x8BE5;&#x9879;&#x76EE;<em>&#x4E0D;&#x662F;</em>&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x4F1A;&#x8BDD;&#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x4F8B;&#x5982;&#xFF0C;&#x7528;&#x4E8E;&#x52A0;&#x8F7D;&#x5B9E;&#x4F8B;&#x6240;&#x9700;&#x72B6;&#x6001;&#x7684;&#x67E5;&#x8BE2;&#x9996;&#x5148;&#x53D1;&#x51FA;&#x81EA;&#x52A8;&#x5237;&#x65B0;&#xFF0C;&#x5426;&#x5219;&#x4F1A;&#x8FC7;&#x65E9;&#x5237;&#x65B0;&#x76EE;&#x6807;&#x76EE;&#x7684;&#x3002;</span><span class="yiyi-st" id="yiyi-304">&#x8FD9;&#x4E9B;&#x7528;&#x4F8B;&#x5E94;&#x8BE5;&#x4F7F;&#x7528;&#x65B0;&#x7684;&#x201C;before_attach&#x201D;&#x4E8B;&#x4EF6;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@event.listens_for</span><span class="p">(</span><span class="n">Session</span><span class="p">,</span> <span class="s2">&quot;before_attach&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">before_attach</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
    <span class="n">instance</span><span class="o">.</span><span class="n">some_necessary_attribute</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Widget</span><span class="p">)</span><span class="o">.</span>\
                                            <span class="n">filter_by</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">widget_name</span><span class="p">)</span><span class="o">.</span>\
                                            <span class="n">first</span><span class="p">()</span></pre></div></div><p><span class="yiyi-st" id="yiyi-305"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2464">&#xFF03;2464  T0&gt;</a></span></p></div><div class="section" id="query-now-auto-correlates-like-a-select-does"><h3><span class="yiyi-st" id="yiyi-306">&#x73B0;&#x5728;&#x67E5;&#x8BE2;&#x81EA;&#x52A8;&#x5173;&#x8054;&#xFF0C;&#x5C31;&#x50CF;select()&#x505A;<a class="headerlink" href="#query-now-auto-correlates-like-a-select-does" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-307">&#x4EE5;&#x524D;&#x6709;&#x5FC5;&#x8981;&#x8C03;&#x7528;<a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query.correlate" title="sqlalchemy.orm.query.Query.correlate"><code class="xref py py-meth docutils literal"><span class="pre">Query.correlate()</span></code></a>&#x4EE5;&#x4F7F;&#x5217;&#x6216;WHERE&#x5B50;&#x67E5;&#x8BE2;&#x4E0E;&#x7236;&#x9879;&#x76F8;&#x5173;&#x8054;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">subq</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Entity</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span>\
                <span class="nb">filter</span><span class="p">(</span><span class="n">Entity</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="n">Parent</span><span class="o">.</span><span class="n">entity_id</span><span class="p">)</span><span class="o">.</span>\
                <span class="n">correlate</span><span class="p">(</span><span class="n">Parent</span><span class="p">)</span><span class="o">.</span>\
                <span class="n">as_scalar</span><span class="p">()</span>
<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Parent</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">subq</span><span class="o">==</span><span class="s2">&quot;some value&quot;</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-308">&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x666E;&#x901A;&#x7684;<code class="docutils literal"><span class="pre">select()</span></code>&#x6784;&#x9020;&#x7684;&#x76F8;&#x53CD;&#x884C;&#x4E3A;&#xFF0C;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#x4F1A;&#x91C7;&#x7528;&#x81EA;&#x52A8;&#x5173;&#x8054;&#x3002;</span><span class="yiyi-st" id="yiyi-309">0.8&#x4E2D;&#x7684;&#x4E0A;&#x8FF0;&#x8BED;&#x53E5;&#x5C06;&#x81EA;&#x52A8;&#x5173;&#x8054;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">subq</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Entity</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span>\
                <span class="nb">filter</span><span class="p">(</span><span class="n">Entity</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="n">Parent</span><span class="o">.</span><span class="n">entity_id</span><span class="p">)</span><span class="o">.</span>\
                <span class="n">as_scalar</span><span class="p">()</span>
<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Parent</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">subq</span><span class="o">==</span><span class="s2">&quot;some value&quot;</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-310">&#x4F8B;&#x5982;&#x5728;<code class="docutils literal"><span class="pre">select()</span></code>&#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8C03;&#x7528;<code class="docutils literal"><span class="pre">query.correlate(None)</span></code>&#x6765;&#x7981;&#x7528;&#x5173;&#x8054;&#xFF0C;&#x6216;&#x8005;&#x901A;&#x8FC7;&#x4F20;&#x9012;&#x5B9E;&#x4F53;<code class="docutils literal"><span class="pre">query.correlate(someentity)</span></code></span></p><p><span class="yiyi-st" id="yiyi-311"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2179">&#xFF03;2179  T0&gt;</a></span></p></div><div class="section" id="correlation-is-now-always-context-specific"><h3><span class="yiyi-st" id="yiyi-312">&#x76F8;&#x5173;&#x6027;&#x73B0;&#x5728;&#x59CB;&#x7EC8;&#x662F;&#x7279;&#x5B9A;&#x4E8E;&#x4E0A;&#x4E0B;&#x6587;&#x7684;<a class="headerlink" href="#correlation-is-now-always-context-specific" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-313">To allow a wider variety of correlation scenarios, the behavior of <a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.Select.correlate" title="sqlalchemy.sql.expression.Select.correlate"><code class="xref py py-meth docutils literal"><span class="pre">Select.correlate()</span></code></a> and <a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query.correlate" title="sqlalchemy.orm.query.Query.correlate"><code class="xref py py-meth docutils literal"><span class="pre">Query.correlate()</span></code></a> has changed slightly such that the SELECT statement will omit the &#x201C;correlated&#x201D; target from the FROM clause only if the statement is actually used in that context. </span><span class="yiyi-st" id="yiyi-314">&#x53E6;&#x5916;&#xFF0C;&#x5728;&#x5C01;&#x95ED;&#x7684;SELECT&#x8BED;&#x53E5;&#x4E2D;&#x4F5C;&#x4E3A;FROM&#x653E;&#x7F6E;&#x7684;SELECT&#x8BED;&#x53E5;&#x4E0D;&#x518D;&#x53EF;&#x80FD;&#x201C;&#x5173;&#x8054;&#x201D;&#xFF08;&#x5373;&#x7701;&#x7565;&#xFF09;FROM&#x5B50;&#x53E5;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-315">&#x8FD9;&#x79CD;&#x6539;&#x53D8;&#x53EA;&#x4F1A;&#x4F7F;&#x6E32;&#x67D3;SQL&#x53D8;&#x5F97;&#x66F4;&#x597D;&#xFF0C;&#x56E0;&#x4E3A;&#x5728;&#x76F8;&#x5BF9;&#x4E8E;&#x6240;&#x9009;&#x5185;&#x5BB9;&#x7684;FROM&#x5BF9;&#x8C61;&#x4E0D;&#x8DB3;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4E0D;&#x518D;&#x53EF;&#x80FD;&#x6E32;&#x67D3;&#x975E;&#x6CD5;SQL&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.sql</span> <span class="kn">import</span> <span class="n">table</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">select</span>

<span class="n">t1</span> <span class="o">=</span> <span class="n">table</span><span class="p">(</span><span class="s1">&apos;t1&apos;</span><span class="p">,</span> <span class="n">column</span><span class="p">(</span><span class="s1">&apos;x&apos;</span><span class="p">))</span>
<span class="n">t2</span> <span class="o">=</span> <span class="n">table</span><span class="p">(</span><span class="s1">&apos;t2&apos;</span><span class="p">,</span> <span class="n">column</span><span class="p">(</span><span class="s1">&apos;y&apos;</span><span class="p">))</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">])</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">t1</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-316">&#x5728;&#x6B64;&#x66F4;&#x6539;&#x4E4B;&#x524D;&#xFF0C;&#x4E0A;&#x8FF0;&#x5185;&#x5BB9;&#x5C06;&#x8FD4;&#x56DE;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT t1.x, t2.y FROM t2</pre></div></div><p><span class="yiyi-st" id="yiyi-317">&#x8FD9;&#x662F;&#x65E0;&#x6548;&#x7684;SQL&#xFF0C;&#x56E0;&#x4E3A;&#x201C;t1&#x201D;&#x5728;&#x4EFB;&#x4F55;FROM&#x5B50;&#x53E5;&#x4E2D;&#x90FD;&#x6CA1;&#x6709;&#x5F15;&#x7528;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-318">&#x73B0;&#x5728;&#xFF0C;&#x5728;&#x6CA1;&#x6709;&#x5305;&#x542B;SELECT&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5B83;&#x4F1A;&#x8FD4;&#x56DE;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT t1.x, t2.y FROM t1, t2</pre></div></div><p><span class="yiyi-st" id="yiyi-319">&#x5728;SELECT&#x4E2D;&#xFF0C;&#x76F8;&#x5173;&#x6309;&#x9884;&#x671F;&#x751F;&#x6548;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>s2 = select([t1, t2]).where(t1.c.x == t2.c.y).where(t1.c.x == s)

print(s2)

SELECT t1.x, t2.y FROM t1, t2
WHERE t1.x = t2.y AND t1.x =
    (SELECT t1.x, t2.y FROM t2)</pre></div></div><p><span class="yiyi-st" id="yiyi-320">&#x9884;&#x671F;&#x6B64;&#x66F4;&#x6539;&#x4E0D;&#x4F1A;&#x5F71;&#x54CD;&#x4EFB;&#x4F55;&#x73B0;&#x6709;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x56E0;&#x4E3A;&#x76F8;&#x5173;&#x884C;&#x4E3A;&#x5BF9;&#x4E8E;&#x6B63;&#x786E;&#x6784;&#x5EFA;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#x800C;&#x8A00;&#x4ECD;&#x7136;&#x76F8;&#x540C;&#x3002;</span><span class="yiyi-st" id="yiyi-321">&#x53EA;&#x6709;&#x5728;&#x6D4B;&#x8BD5;&#x573A;&#x666F;&#x4E2D;&#x4F9D;&#x8D56;&#x4E8E;&#x975E;&#x76F8;&#x5173;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x4F7F;&#x7528;&#x7684;&#x76F8;&#x5173;SELECT&#x7684;&#x65E0;&#x6548;&#x5B57;&#x7B26;&#x4E32;&#x8F93;&#x51FA;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x624D;&#x4F1A;&#x770B;&#x5230;&#x4EFB;&#x4F55;&#x66F4;&#x6539;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-322"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2668">&#xFF03;2668  T0&gt;</a></span></p></div><div class="section" id="create-all-and-drop-all-will-now-honor-an-empty-list-as-such"><h3><span class="yiyi-st" id="yiyi-323">&#x73B0;&#x5728;&#xFF0C;create_all()&#x548C;drop_all()&#x5C06;&#x6388;&#x4E88;&#x4E00;&#x4E2A;&#x7A7A;&#x5217;&#x8868;<a class="headerlink" href="#create-all-and-drop-all-will-now-honor-an-empty-list-as-such" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-324">&#x73B0;&#x5728;&#xFF0C;&#x65B9;&#x6CD5;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.MetaData.create_all" title="sqlalchemy.schema.MetaData.create_all"><code class="xref py py-meth docutils literal"><span class="pre">MetaData.create_all()</span></code></a>&#x548C;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.MetaData.drop_all" title="sqlalchemy.schema.MetaData.drop_all"><code class="xref py py-meth docutils literal"><span class="pre">MetaData.drop_all()</span></code></a>&#x5C06;&#x63A5;&#x53D7;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal"><span class="pre">Table</span></code></a>&#x5BF9;&#x8C61;&#x7684;&#x5217;&#x8868;&#xFF0C;&#x8FD9;&#x4E9B;&#x5BF9;&#x8C61;&#x662F;&#x7A7A;&#x7684;&#xFF0C;&#x5E76;&#x4E14;&#x4E0D;&#x4F1A;&#x53D1;&#x51FA;&#x4EFB;&#x4F55;CREATE&#x6216;DROP&#x8BED;&#x53E5;&#x3002;</span><span class="yiyi-st" id="yiyi-325">&#x4EE5;&#x524D;&#xFF0C;&#x4E00;&#x4E2A;&#x7A7A;&#x7684;&#x5217;&#x8868;&#x4E0E;&#x4E3A;&#x96C6;&#x5408;&#x4F20;&#x9012;<code class="docutils literal"><span class="pre">None</span></code>&#x76F8;&#x540C;&#xFF0C;&#x5E76;&#x4E14;&#x65E0;&#x6761;&#x4EF6;&#x5730;&#x4E3A;&#x6240;&#x6709;&#x9879;&#x76EE;&#x53D1;&#x51FA;CREATE / DROP&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-326">&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#x4FEE;&#x590D;&#xFF0C;&#x4F46;&#x67D0;&#x4E9B;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x53EF;&#x80FD;&#x4F9D;&#x8D56;&#x4E8E;&#x4EE5;&#x524D;&#x7684;&#x884C;&#x4E3A;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-327"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2664">&#xFF03;2664  T0&gt;</a></span></p></div><div class="section" id="repaired-the-event-targeting-of-instrumentationevents"><h3><span class="yiyi-st" id="yiyi-328">&#x4FEE;&#x590D;&#x4E86;<a class="reference internal" href="orm_events.html#sqlalchemy.orm.events.InstrumentationEvents" title="sqlalchemy.orm.events.InstrumentationEvents"><code class="xref py py-class docutils literal"><span class="pre">InstrumentationEvents</span></code></a> <a class="headerlink" href="#repaired-the-event-targeting-of-instrumentationevents" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-329">The <a class="reference internal" href="orm_events.html#sqlalchemy.orm.events.InstrumentationEvents" title="sqlalchemy.orm.events.InstrumentationEvents"><code class="xref py py-class docutils literal"><span class="pre">InstrumentationEvents</span></code></a> series of event targets have documented that the events will only be fired off according to the actual class passed as a target. </span><span class="yiyi-st" id="yiyi-330">&#x901A;&#x8FC7;0.7&#xFF0C;&#x60C5;&#x51B5;&#x5E76;&#x975E;&#x5982;&#x6B64;&#xFF0C;&#x4EFB;&#x4F55;&#x9002;&#x7528;&#x4E8E;<a class="reference internal" href="orm_events.html#sqlalchemy.orm.events.InstrumentationEvents" title="sqlalchemy.orm.events.InstrumentationEvents"><code class="xref py py-class docutils literal"><span class="pre">InstrumentationEvents</span></code></a>&#x7684;&#x4E8B;&#x4EF6;&#x4FA6;&#x542C;&#x5668;&#x90FD;&#x5C06;&#x88AB;&#x6620;&#x5C04;&#x7684;&#x6240;&#x6709;&#x7C7B;&#x8C03;&#x7528;&#x3002;</span><span class="yiyi-st" id="yiyi-331">&#x5728;0.8&#x4E2D;&#xFF0C;&#x589E;&#x52A0;&#x4E86;&#x989D;&#x5916;&#x7684;&#x903B;&#x8F91;&#xFF0C;&#x4EE5;&#x4FBF;&#x4E8B;&#x4EF6;&#x53EA;&#x4F1A;&#x8C03;&#x7528;&#x90A3;&#x4E9B;&#x53D1;&#x9001;&#x7684;&#x7C7B;&#x3002;</span><span class="yiyi-st" id="yiyi-332">&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;<code class="docutils literal"><span class="pre">propagate</span></code>&#x6807;&#x5FD7;&#x9ED8;&#x8BA4;&#x8BBE;&#x7F6E;&#x4E3A;<code class="docutils literal"><span class="pre">True</span></code>&#xFF0C;&#x56E0;&#x4E3A;&#x7C7B;&#x5DE5;&#x5177;&#x4E8B;&#x4EF6;&#x901A;&#x5E38;&#x7528;&#x4E8E;&#x62E6;&#x622A;&#x5C1A;&#x672A;&#x521B;&#x5EFA;&#x7684;&#x7C7B;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-333"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2590">&#xFF03;2590  T0&gt;</a></span></p></div><div class="section" id="no-more-magic-coercion-of-to-in-when-comparing-to-subquery-in-ms-sql"><h3><span class="yiyi-st" id="yiyi-334">&#x4E0E;MS-SQL&#x4E2D;&#x7684;&#x5B50;&#x67E5;&#x8BE2;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#x65F6;&#xFF0C;&#x4E0D;&#x518D;&#x9700;&#x8981;&#x5BF9;IN&#x8FDB;&#x884C;&#x201C;=&#x201D;&#x7684;&#x9B54;&#x672F;&#x5F3A;&#x5316;<a class="headerlink" href="#no-more-magic-coercion-of-to-in-when-comparing-to-subquery-in-ms-sql" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-335">&#x6211;&#x4EEC;&#x5728;MSSQL&#x65B9;&#x8A00;&#x4E2D;&#x53D1;&#x73B0;&#x4E86;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x53E4;&#x8001;&#x7684;&#x884C;&#x4E3A;&#xFF0C;&#x5B83;&#x4F1A;&#x5728;&#x5C1D;&#x8BD5;&#x50CF;&#x8FD9;&#x6837;&#x505A;&#x65F6;&#x5C1D;&#x8BD5;&#x4ECE;&#x7528;&#x6237;&#x8EAB;&#x4E0A;&#x62A2;&#x6551;&#x7528;&#x6237;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">scalar_subq</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">someothertable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">someothertable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="o">==</span><span class="s1">&apos;foo&apos;</span><span class="p">)</span>
<span class="n">select</span><span class="p">([</span><span class="n">sometable</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">sometable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="n">scalar_subq</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-336">SQL Server&#x4E0D;&#x5141;&#x8BB8;&#x4E0E;&#x6807;&#x91CF;SELECT&#x8FDB;&#x884C;&#x7B49;&#x540C;&#x6BD4;&#x8F83;&#xFF0C;&#x5373;&#x201C;x =&#xFF08;SELECT something&#xFF09;&#x201D;&#x3002;</span><span class="yiyi-st" id="yiyi-337">MSSQL&#x65B9;&#x8A00;&#x4F1A;&#x5C06;&#x5176;&#x8F6C;&#x6362;&#x4E3A;IN&#x3002;</span><span class="yiyi-st" id="yiyi-338">&#x7136;&#x800C;&#xFF0C;&#x50CF;&#x201C;&#xFF08;SELECT something&#xFF09;= x&#x201D;&#x8FD9;&#x6837;&#x7684;&#x6BD4;&#x8F83;&#x4F1A;&#x53D1;&#x751F;&#x540C;&#x6837;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;&#x603B;&#x7684;&#x6765;&#x8BF4;&#xFF0C;&#x8FD9;&#x79CD;&#x731C;&#x6D4B;&#x7EA7;&#x522B;&#x8D85;&#x51FA;&#x4E86;SQLAlchemy&#x7684;&#x901A;&#x5E38;&#x8303;&#x56F4;&#xFF0C;&#x56E0;&#x6B64;&#x884C;&#x4E3A;&#x88AB;&#x5220;&#x9664;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-339"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2277">&#xFF03;2277  T0&gt;</a></span></p></div><div class="section" id="fixed-the-behavior-of-session-is-modified"><h3><span class="yiyi-st" id="yiyi-340">&#x4FEE;&#x6B63;&#x4E86;<a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session.is_modified" title="sqlalchemy.orm.session.Session.is_modified"><code class="xref py py-meth docutils literal"><span class="pre">Session.is_modified()</span></code></a> <a class="headerlink" href="#fixed-the-behavior-of-session-is-modified" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-341"><a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session.is_modified" title="sqlalchemy.orm.session.Session.is_modified"><code class="xref py py-meth docutils literal"><span class="pre">Session.is_modified()</span></code></a>&#x65B9;&#x6CD5;&#x63A5;&#x53D7;&#x4E00;&#x4E2A;&#x53C2;&#x6570;<code class="docutils literal"><span class="pre">passive</span></code>&#xFF0C;&#x8FD9;&#x57FA;&#x672C;&#x4E0A;&#x4E0D;&#x662F;&#x5FC5;&#x987B;&#x7684;&#xFF0C;&#x53C2;&#x6570;&#x5728;&#x6240;&#x6709;&#x60C5;&#x51B5;&#x4E0B;&#x90FD;&#x5E94;&#x8BE5;&#x662F;<code class="docutils literal"><span class="pre">True</span></code>&#x5F53;&#x5B83;&#x4FDD;&#x7559;&#x9ED8;&#x8BA4;&#x7684;<code class="docutils literal"><span class="pre">False</span></code>&#x65F6;&#xFF0C;&#x5B83;&#x4F1A;&#x89E6;&#x53CA;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x5E76;&#x7ECF;&#x5E38;&#x89E6;&#x53D1;autoflush&#xFF0C;&#x5B83;&#x672C;&#x8EAB;&#x4F1A;&#x6539;&#x53D8;&#x7ED3;&#x679C;&#x3002;</span><span class="yiyi-st" id="yiyi-342">&#x5728;0.8&#x4E2D;&#xFF0C;<code class="docutils literal"><span class="pre">passive</span></code>&#x53C2;&#x6570;&#x5C06;&#x4E0D;&#x8D77;&#x4F5C;&#x7528;&#xFF0C;&#x5E76;&#x4E14;&#x672A;&#x52A0;&#x8F7D;&#x7684;&#x5C5E;&#x6027;&#x5C06;&#x6C38;&#x8FDC;&#x4E0D;&#x4F1A;&#x88AB;&#x68C0;&#x67E5;&#x5386;&#x53F2;&#x8BB0;&#x5F55;&#xFF0C;&#x56E0;&#x4E3A;&#x6839;&#x636E;&#x5B9A;&#x4E49;&#xFF0C;&#x672A;&#x52A0;&#x8F7D;&#x7684;&#x5C5E;&#x6027;&#x53EF;&#x80FD;&#x6CA1;&#x6709;&#x6302;&#x8D77;&#x7684;&#x72B6;&#x6001;&#x66F4;&#x6539;&#x3002;</span></p><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-343">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-344"><a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session.is_modified" title="sqlalchemy.orm.session.Session.is_modified"><code class="xref py py-meth docutils literal"><span class="pre">Session.is_modified()</span></code></a></span></p></div><p><span class="yiyi-st" id="yiyi-345"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2320">&#xFF03;2320  T0&gt;</a></span></p></div><div class="section" id="column-key-is-honored-in-the-select-c-attribute-of-select-with-select-apply-labels"><h3><span class="yiyi-st" id="yiyi-346"><code class="xref py py-attr docutils literal"><span class="pre">Column.key</span></code> is honored in the <a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.Select.c" title="sqlalchemy.sql.expression.Select.c"><code class="xref py py-attr docutils literal"><span class="pre">Select.c</span></code></a> attribute of <a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal"><span class="pre">select()</span></code></a> with <a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.Select.apply_labels" title="sqlalchemy.sql.expression.Select.apply_labels"><code class="xref py py-meth docutils literal"><span class="pre">Select.apply_labels()</span></code></a><a class="headerlink" href="#column-key-is-honored-in-the-select-c-attribute-of-select-with-select-apply-labels" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-347">&#x8868;&#x8FBE;&#x5F0F;&#x7CFB;&#x7EDF;&#x7684;&#x7528;&#x6237;&#x77E5;&#x9053;<a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.Select.apply_labels" title="sqlalchemy.sql.expression.Select.apply_labels"><code class="xref py py-meth docutils literal"><span class="pre">Select.apply_labels()</span></code></a>&#x4E3A;&#x6BCF;&#x4E2A;&#x5217;&#x540D;&#x6DFB;&#x52A0;&#x8868;&#x540D;&#xFF0C;&#x5F71;&#x54CD;<a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.Select.c" title="sqlalchemy.sql.expression.Select.c"><code class="xref py py-attr docutils literal"><span class="pre">Select.c</span></code></a>&#x4E2D;&#x53EF;&#x7528;&#x7684;&#x540D;&#x79F0;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">table1</span><span class="p">])</span><span class="o">.</span><span class="n">apply_labels</span><span class="p">()</span>
<span class="n">s</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">table1_col1</span>
<span class="n">s</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">table1_col2</span></pre></div></div><p><span class="yiyi-st" id="yiyi-348">&#x5728;0.8&#x4E4B;&#x524D;&#xFF0C;&#x5982;&#x679C;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a>&#x5177;&#x6709;&#x4E0D;&#x540C;&#x7684;<code class="xref py py-attr docutils literal"><span class="pre">Column.key</span></code>&#xFF0C;&#x5219;&#x6B64;&#x952E;&#x5C06;&#x88AB;&#x5FFD;&#x7565;&#xFF0C;&#x4E0E;<a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.Select.apply_labels" title="sqlalchemy.sql.expression.Select.apply_labels"><code class="xref py py-meth docutils literal"><span class="pre">Select.apply_labels()</span></code></a>&#x4E0D;&#x4E00;&#x81F4;&#x7528;&#x8FC7;&#x7684;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># before 0.8</span>
<span class="n">table1</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&apos;t1&apos;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;col1&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&apos;column_one&apos;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">table1</span><span class="p">])</span>
<span class="n">s</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">column_one</span> <span class="c1"># would be accessible like this</span>
<span class="n">s</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">col1</span> <span class="c1"># would raise AttributeError</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">table1</span><span class="p">])</span><span class="o">.</span><span class="n">apply_labels</span><span class="p">()</span>
<span class="n">s</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">table1_column_one</span> <span class="c1"># would raise AttributeError</span>
<span class="n">s</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">table1_col1</span> <span class="c1"># would be accessible like this</span></pre></div></div><p><span class="yiyi-st" id="yiyi-349">In 0.8, <code class="xref py py-attr docutils literal"><span class="pre">Column.key</span></code> is honored in both cases:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># with 0.8</span>
<span class="n">table1</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&apos;t1&apos;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;col1&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&apos;column_one&apos;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">table1</span><span class="p">])</span>
<span class="n">s</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">column_one</span> <span class="c1"># works</span>
<span class="n">s</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">col1</span> <span class="c1"># AttributeError</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">table1</span><span class="p">])</span><span class="o">.</span><span class="n">apply_labels</span><span class="p">()</span>
<span class="n">s</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">table1_column_one</span> <span class="c1"># works</span>
<span class="n">s</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">table1_col1</span> <span class="c1"># AttributeError</span></pre></div></div><p><span class="yiyi-st" id="yiyi-350">&#x5173;&#x4E8E;&#x201C;name&#x201D;&#x548C;&#x201C;key&#x201D;&#x7684;&#x6240;&#x6709;&#x5176;&#x4ED6;&#x884C;&#x4E3A;&#x662F;&#x76F8;&#x540C;&#x7684;&#xFF0C;&#x5305;&#x62EC;&#x5448;&#x73B0;&#x7684;SQL&#x4ECD;&#x5C06;&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">&lt;tablename&gt;_&lt;colname&gt;</span></code>&#x5F62;&#x5F0F; - &#x8FD9;&#x91CC;&#x5F3A;&#x8C03;&#x4E86;&#x9632;&#x6B62;<code class="xref py py-attr docutils literal"><span class="pre">Column.key</span></code>&#x5185;&#x5BB9;&#x88AB;&#x5448;&#x73B0;&#x5230;<code class="docutils literal"><span class="pre">SELECT</span></code>&#x8BED;&#x53E5;&#x4E2D;&#xFF0C;&#x56E0;&#x6B64;<code class="xref py py-attr docutils literal"><span class="pre">Column.key</span></code>&#x4E2D;&#x4F7F;&#x7528;&#x7684;&#x7279;&#x6B8A;/&#x975E;ascii&#x5B57;&#x7B26;&#x6CA1;&#x6709;&#x95EE;&#x9898;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-351"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2397">&#xFF03;2397  T0&gt;</a></span></p></div><div class="section" id="single-parent-warning-is-now-an-error"><h3><span class="yiyi-st" id="yiyi-352">single_parent&#x8B66;&#x544A;&#x73B0;&#x5728;&#x662F;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;<a class="headerlink" href="#single-parent-warning-is-now-an-error" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-353">&#x4E00;&#x4E2A;<a class="reference internal" href="orm_relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#x662F;&#x591A;&#x5BF9;&#x4E00;&#x6216;&#x591A;&#x5BF9;&#x591A;&#x7684;&#xFF0C;&#x5E76;&#x4E14;&#x6307;&#x5B9A;&#x4E86;&#x201C;cascade =&apos;all&#xFF0C;delete-orphan&apos;&#x201D;&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5C34;&#x5C2C;&#x4F46;&#x4ECD;&#x7136;&#x53D7;&#x652F;&#x6301;&#x7684;&#x7528;&#x4F8B;&#xFF08;&#x9650;&#x5236;&#xFF09;&#x5982;&#x679C;&#x5173;&#x7CFB;&#x6CA1;&#x6709;&#x6307;&#x5B9A;<code class="docutils literal"><span class="pre">single_parent=True</span></code>&#x9009;&#x9879;&#xFF0C;&#x73B0;&#x5728;&#x4F1A;&#x5F15;&#x53D1;&#x9519;&#x8BEF;&#x3002;</span><span class="yiyi-st" id="yiyi-354">&#x4EE5;&#x524D;&#x5B83;&#x53EA;&#x4F1A;&#x53D1;&#x51FA;&#x8B66;&#x544A;&#xFF0C;&#x4F46;&#x5728;&#x4EFB;&#x4F55;&#x60C5;&#x51B5;&#x4E0B;&#x90FD;&#x4F1A;&#x5728;&#x5C5E;&#x6027;&#x7CFB;&#x7EDF;&#x4E2D;&#x7ACB;&#x5373;&#x51FA;&#x73B0;&#x6545;&#x969C;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-355"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2405">&#xFF03;2405  T0&gt;</a></span></p></div><div class="section" id="adding-the-inspector-argument-to-the-column-reflect-event"><h3><span class="yiyi-st" id="yiyi-356">&#x5C06;<code class="docutils literal"><span class="pre">inspector</span></code>&#x53C2;&#x6570;&#x6DFB;&#x52A0;&#x5230;<code class="docutils literal"><span class="pre">column_reflect</span></code>&#x4E8B;&#x4EF6;<a class="headerlink" href="#adding-the-inspector-argument-to-the-column-reflect-event" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-357">0.7&#x6DFB;&#x52A0;&#x4E86;&#x4E00;&#x4E2A;&#x540D;&#x4E3A;<code class="docutils literal"><span class="pre">column_reflect</span></code>&#x7684;&#x65B0;&#x4E8B;&#x4EF6;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x53CD;&#x6620;&#x51FA;&#x5217;&#x7684;&#x53CD;&#x5C04;&#xFF0C;&#x56E0;&#x4E3A;&#x6BCF;&#x4E2A;&#x5217;&#x90FD;&#x53CD;&#x6620;&#x51FA;&#x6765;&#x3002;</span><span class="yiyi-st" id="yiyi-358">&#x6211;&#x4EEC;&#x5F97;&#x5230;&#x8FD9;&#x4E2A;&#x4E8B;&#x4EF6;&#x6709;&#x70B9;&#x4E0D;&#x5BF9;&#xFF0C;&#x56E0;&#x4E3A;&#x4E8B;&#x4EF6;&#x6CA1;&#x6709;&#x529E;&#x6CD5;&#x83B7;&#x53D6;&#x7528;&#x4E8E;&#x53CD;&#x5C04;&#x7684;&#x5F53;&#x524D;<code class="docutils literal"><span class="pre">Inspector</span></code>&#x548C;<code class="docutils literal"><span class="pre">Connection</span></code>&#xFF0C;&#x5728;&#x6765;&#x81EA;&#x6570;&#x636E;&#x5E93;&#x7684;&#x9644;&#x52A0;&#x4FE1;&#x606F;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x662F;&#x5FC5;&#x8981;&#x7684;&#x3002;</span><span class="yiyi-st" id="yiyi-359">&#x7531;&#x4E8E;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5C1A;&#x672A;&#x5E7F;&#x6CDB;&#x4F7F;&#x7528;&#x7684;&#x65B0;&#x4E8B;&#x4EF6;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x5C06;&#x76F4;&#x63A5;&#x5411;&#x5176;&#x4E2D;&#x6DFB;&#x52A0;<code class="docutils literal"><span class="pre">inspector</span></code>&#x53C2;&#x6570;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>@event.listens_for(Table, &quot;column_reflect&quot;)
def listen_for_col(inspector, table, column_info):
    # ...</pre></div></div><p><span class="yiyi-st" id="yiyi-360"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2418">&#xFF03;2418  T0&gt;</a></span></p></div><div class="section" id="disabling-auto-detect-of-collations-casing-for-mysql"><h3><span class="yiyi-st" id="yiyi-361">&#x7981;&#x7528;&#x6392;&#x5E8F;&#x89C4;&#x5219;&#x7684;&#x81EA;&#x52A8;&#x68C0;&#x6D4B;&#xFF0C;MySQL&#x7684;&#x5957;&#x7BA1;<a class="headerlink" href="#disabling-auto-detect-of-collations-casing-for-mysql" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-362">MySQL&#x65B9;&#x8A00;&#x6267;&#x884C;&#x4E24;&#x4E2A;&#x8C03;&#x7528;&#xFF0C;&#x4E00;&#x4E2A;&#x662F;&#x975E;&#x5E38;&#x6602;&#x8D35;&#x7684;&#xFF0C;&#x7528;&#x4E8E;&#x4ECE;&#x6570;&#x636E;&#x5E93;&#x52A0;&#x8F7D;&#x6240;&#x6709;&#x53EF;&#x80FD;&#x7684;&#x6392;&#x5E8F;&#x89C4;&#x5219;&#x4EE5;&#x53CA;&#x7B2C;&#x4E00;&#x6B21;<code class="docutils literal"><span class="pre">Engine</span></code>&#x8FDE;&#x63A5;&#x65F6;&#x7684;&#x5957;&#x7BA1;&#x4FE1;&#x606F;&#x3002;</span><span class="yiyi-st" id="yiyi-363">&#x8FD9;&#x4E9B;&#x96C6;&#x5408;&#x90FD;&#x4E0D;&#x7528;&#x4E8E;&#x4EFB;&#x4F55;SQLAlchemy&#x51FD;&#x6570;&#xFF0C;&#x56E0;&#x6B64;&#x8FD9;&#x4E9B;&#x8C03;&#x7528;&#x5C06;&#x88AB;&#x66F4;&#x6539;&#x4E3A;&#x4E0D;&#x518D;&#x81EA;&#x52A8;&#x53D1;&#x5C04;&#x3002;</span><span class="yiyi-st" id="yiyi-364">&#x53EF;&#x80FD;&#x4F9D;&#x8D56;&#x8FD9;&#x4E9B;&#x96C6;&#x5408;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5B58;&#x5728;&#x4E8E;<code class="docutils literal"><span class="pre">engine.dialect</span></code>&#x4E0A;&#xFF0C;&#x9700;&#x8981;&#x76F4;&#x63A5;&#x8C03;&#x7528;<code class="docutils literal"><span class="pre">_detect_collations()</span></code>&#x548C;<code class="docutils literal"><span class="pre">_detect_casing()</span></code>&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-365"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2404">&#xFF03;2404  T0&gt;</a></span></p></div><div class="section" id="unconsumed-column-names-warning-becomes-an-exception"><h3><span class="yiyi-st" id="yiyi-366">&#x201C;Unconsumed column names&#x201D; warning becomes an exception<a class="headerlink" href="#unconsumed-column-names-warning-becomes-an-exception" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-367">&#x5F15;&#x7528;<code class="docutils literal"><span class="pre">insert()</span></code>&#x6216;<code class="docutils literal"><span class="pre">update()</span></code>&#x6784;&#x9020;&#x4E2D;&#x4E0D;&#x5B58;&#x5728;&#x7684;&#x5217;&#x4F1A;&#x5F15;&#x53D1;&#x9519;&#x8BEF;&#x800C;&#x4E0D;&#x662F;&#x8B66;&#x544A;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">t1</span> <span class="o">=</span> <span class="n">table</span><span class="p">(</span><span class="s1">&apos;t1&apos;</span><span class="p">,</span> <span class="n">column</span><span class="p">(</span><span class="s1">&apos;x&apos;</span><span class="p">))</span>
<span class="n">t1</span><span class="o">.</span><span class="n">insert</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> <span class="c1"># raises &quot;Unconsumed column names: z&quot;</span></pre></div></div><p><span class="yiyi-st" id="yiyi-368"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2415">&#xFF03;2415  T0&gt;</a></span></p></div><div class="section" id="inspector-get-primary-keys-is-deprecated-use-inspector-get-pk-constraint"><h3><span class="yiyi-st" id="yiyi-369">Inspector.get_primary_keys()&#x5DF2;&#x5F03;&#x7528;&#xFF0C;&#x8BF7;&#x4F7F;&#x7528;Inspector.get_pk_constraint <a class="headerlink" href="#inspector-get-primary-keys-is-deprecated-use-inspector-get-pk-constraint" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-370"><code class="docutils literal"><span class="pre">Inspector</span></code>&#x4E0A;&#x7684;&#x8FD9;&#x4E24;&#x4E2A;&#x65B9;&#x6CD5;&#x662F;&#x591A;&#x4F59;&#x7684;&#xFF0C;&#x5176;&#x4E2D;<code class="docutils literal"><span class="pre">get_primary_keys()</span></code>&#x5C06;&#x8FD4;&#x56DE;&#x4E0E;<code class="docutils literal"><span class="pre">get_pk_constraint()</span></code>&#x76F8;&#x540C;&#x7684;&#x4FE1;&#x606F;&#x51CF;&#x53BB;&#x7EA6;&#x675F;&#x7684;&#x540D;&#x79F0;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">insp</span><span class="o">.</span><span class="n">get_primary_keys</span><span class="p">()</span>
<span class="go">[&quot;a&quot;, &quot;b&quot;]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">insp</span><span class="o">.</span><span class="n">get_pk_constraint</span><span class="p">()</span>
<span class="go">{&quot;name&quot;:&quot;pk_constraint&quot;, &quot;constrained_columns&quot;:[&quot;a&quot;, &quot;b&quot;]}</span></pre></div></div><p><span class="yiyi-st" id="yiyi-371"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2422">&#xFF03;2422  T0&gt;</a></span></p></div><div class="section" id="case-insensitive-result-row-names-will-be-disabled-in-most-cases"><h3><span class="yiyi-st" id="yiyi-372">&#x5728;&#x5927;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4E0D;&#x533A;&#x5206;&#x5927;&#x5C0F;&#x5199;&#x7684;&#x7ED3;&#x679C;&#x884C;&#x540D;&#x79F0;&#x5C06;&#x88AB;&#x7981;&#x7528;<a class="headerlink" href="#case-insensitive-result-row-names-will-be-disabled-in-most-cases" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-373">&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x53E4;&#x8001;&#x7684;&#x884C;&#x4E3A;&#xFF0C;<code class="docutils literal"><span class="pre">RowProxy</span></code>&#x4E2D;&#x7684;&#x5217;&#x540D;&#x59CB;&#x7EC8;&#x4E0D;&#x533A;&#x5206;&#x5927;&#x5C0F;&#x5199;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">row</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">row</span><span class="p">[</span><span class="s1">&apos;foo&apos;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&apos;FOO&apos;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&apos;Foo&apos;</span><span class="p">]</span>
<span class="go">True</span></pre></div></div><p><span class="yiyi-st" id="yiyi-374">&#x8FD9;&#x662F;&#x4E3A;&#x4E86;&#x4E00;&#x4E9B;&#x65E9;&#x671F;&#x9700;&#x8981;&#x7684;&#x65B9;&#x8A00;&#x7684;&#x597D;&#x5904;&#xFF0C;&#x5982;Oracle&#x548C;Firebird&#xFF0C;&#x4F46;&#x5728;&#x73B0;&#x4EE3;&#x7528;&#x6CD5;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x6709;&#x66F4;&#x51C6;&#x786E;&#x7684;&#x65B9;&#x6CD5;&#x6765;&#x5904;&#x7406;&#x8FD9;&#x4E24;&#x4E2A;&#x5E73;&#x53F0;&#x7684;&#x4E0D;&#x533A;&#x5206;&#x5927;&#x5C0F;&#x5199;&#x7684;&#x884C;&#x4E3A;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-375">&#x5C55;&#x671B;&#x672A;&#x6765;&#xFF0C;&#x53EA;&#x6709;&#x901A;&#x8FC7;&#x5C06;&#x6807;&#x5FD7;<code class="docutils literal"><span class="pre">`case_sensitive=False`</span></code>&#x4F20;&#x9012;&#x7ED9;<code class="docutils literal"><span class="pre">`create_engine()`</span></code>&#xFF0C;&#x6B64;&#x884C;&#x4E3A;&#x624D;&#x53EF;&#x7528;&#xFF0C;&#x4F46;&#x5426;&#x5219;&#x5FC5;&#x987B;&#x4ECE;&#x884C;&#x4E2D;&#x8BF7;&#x6C42;&#x5217;&#x540D;&#x5C3D;&#x53EF;&#x80FD;&#x5339;&#x914D;&#x5957;&#x7BA1;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-376"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2423">&#xFF03;2423  T0&gt;</a></span></p></div><div class="section" id="instrumentationmanager-and-alternate-class-instrumentation-is-now-an-extension"><h3><span class="yiyi-st" id="yiyi-377"><code class="docutils literal"><span class="pre">InstrumentationManager</span></code> and alternate class instrumentation is now an extension<a class="headerlink" href="#instrumentationmanager-and-alternate-class-instrumentation-is-now-an-extension" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-378"><code class="docutils literal"><span class="pre">sqlalchemy.orm.interfaces.InstrumentationManager</span></code>&#x7C7B;&#x5C06;&#x79FB;&#x81F3;<code class="docutils literal"><span class="pre">sqlalchemy.ext.instrumentation.InstrumentationManager</span></code>&#x3002;</span><span class="yiyi-st" id="yiyi-379">&#x201C;&#x66FF;&#x4EE3;&#x4EEA;&#x8868;&#x201D;&#x7CFB;&#x7EDF;&#x662F;&#x4E3A;&#x4E86;&#x9700;&#x8981;&#x4E0E;&#x73B0;&#x6709;&#x6216;&#x4E0D;&#x5BFB;&#x5E38;&#x7684;&#x7C7B;&#x4EEA;&#x5668;&#x7CFB;&#x7EDF;&#x4E00;&#x8D77;&#x5DE5;&#x4F5C;&#x7684;&#x6781;&#x5C11;&#x6570;&#x5B89;&#x88C5;&#x800C;&#x5EFA;&#x7ACB;&#x7684;&#xFF0C;&#x5E76;&#x4E14;&#x901A;&#x5E38;&#x5F88;&#x5C11;&#x4F7F;&#x7528;&#x3002;</span><span class="yiyi-st" id="yiyi-380">&#x8BE5;&#x7CFB;&#x7EDF;&#x7684;&#x590D;&#x6742;&#x6027;&#x5DF2;&#x88AB;&#x5BFC;&#x51FA;&#x5230;<code class="docutils literal"><span class="pre">ext.</span></code></span><span class="yiyi-st" id="yiyi-381">&#x6A21;&#x5757;&#x3002;</span><span class="yiyi-st" id="yiyi-382">It remains unused until once imported, typically when a third party library imports <code class="docutils literal"><span class="pre">InstrumentationManager</span></code>, at which point it is injected back into <code class="docutils literal"><span class="pre">sqlalchemy.orm</span></code> by replacing the default <code class="docutils literal"><span class="pre">InstrumentationFactory</span></code> with <code class="docutils literal"><span class="pre">ExtendedInstrumentationRegistry</span></code>.</span></p></div></div><div class="section" id="removed"><h2><span class="yiyi-st" id="yiyi-383">&#x9664;&#x53BB;<a class="headerlink" href="#removed" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h2><div class="section" id="sqlsoup"><h3><span class="yiyi-st" id="yiyi-384">SQLSoup <a class="headerlink" href="#sqlsoup" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h3><p><span class="yiyi-st" id="yiyi-385">SQLSoup&#x662F;&#x4E00;&#x4E2A;&#x65B9;&#x4FBF;&#x7684;&#x5305;&#xFF0C;&#x5B83;&#x5728;SQLAlchemy ORM&#x4E4B;&#x4E0A;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x66FF;&#x4EE3;&#x63A5;&#x53E3;&#x3002;</span><span class="yiyi-st" id="yiyi-386">SQLSoup&#x73B0;&#x5728;&#x88AB;&#x79FB;&#x690D;&#x5230;&#x81EA;&#x5DF1;&#x7684;&#x9879;&#x76EE;&#x4E2D;&#xFF0C;&#x5E76;&#x5355;&#x72EC;&#x8BB0;&#x5F55;/&#x53D1;&#x5E03;&#xFF1B;&#x8BF7;&#x53C2;&#x9605;<a class="reference external" href="https://bitbucket.org/zzzeek/sqlsoup">https://bitbucket.org/zzzeek/sqlsoup</a>&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-387">SQLSoup&#x662F;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x7B80;&#x5355;&#x7684;&#x5DE5;&#x5177;&#xFF0C;&#x53EF;&#x4EE5;&#x4ECE;&#x5BF9;&#x5176;&#x4F7F;&#x7528;&#x98CE;&#x683C;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x8D21;&#x732E;&#x8005;&#x4E2D;&#x53D7;&#x76CA;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-388"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2262">&#xFF03;2262  T0&gt;</a></span></p></div><div class="section" id="mutabletype"><h3><span class="yiyi-st" id="yiyi-389">MutableType <a class="headerlink" href="#mutabletype" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h3><p><span class="yiyi-st" id="yiyi-390">SQLAlchemy ORM&#x4E2D;&#x65E7;&#x7684;&#x201C;&#x53EF;&#x53D8;&#x201D;&#x7CFB;&#x7EDF;&#x5DF2;&#x88AB;&#x5220;&#x9664;&#x3002;</span><span class="yiyi-st" id="yiyi-391">&#x8FD9;&#x6307;&#x7684;&#x662F;<code class="docutils literal"><span class="pre">MutableType</span></code>&#x63A5;&#x53E3;&#xFF0C;&#x8BE5;&#x63A5;&#x53E3;&#x5DF2;&#x5E94;&#x7528;&#x4E8E;<code class="docutils literal"><span class="pre">PickleType</span></code>&#x7B49;&#x7C7B;&#x578B;&#x5E76;&#x6709;&#x6761;&#x4EF6;&#x5730;&#x5E94;&#x7528;&#x4E8E;<code class="docutils literal"><span class="pre">TypeDecorator</span></code>&#xFF0C;&#x5E76;&#x4E14;&#x7531;&#x4E8E;&#x5F88;&#x65E9;&#x7684;SQLAlchemy&#x7248;&#x672C;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x79CD;&#x65B9;&#x5F0F;&#x4E3A;ORM&#x68C0;&#x6D4B;&#x6240;&#x8C13;&#x7684;&#x201C;&#x53EF;&#x53D8;&#x201D;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF08;&#x5982;JSON&#x7ED3;&#x6784;&#x548C;&#x814C;&#x6E0D;&#x5BF9;&#x8C61;&#xFF09;&#x7684;&#x53D8;&#x5316;&#x3002;</span><span class="yiyi-st" id="yiyi-392">&#x7136;&#x800C;&#xFF0C;&#x5B9E;&#x65BD;&#x4ECE;&#x6765;&#x90FD;&#x4E0D;&#x5408;&#x7406;&#xFF0C;&#x5E76;&#x4E14;&#x8FEB;&#x4F7F;&#x5DE5;&#x4F5C;&#x5355;&#x5143;&#x4F7F;&#x7528;&#x6548;&#x7387;&#x975E;&#x5E38;&#x4F4E;&#x7684;&#x6A21;&#x5F0F;&#xFF0C;&#x8FD9;&#x5BFC;&#x81F4;&#x5728;&#x51B2;&#x6D17;&#x671F;&#x95F4;&#x5BF9;&#x6240;&#x6709;&#x5BF9;&#x8C61;&#x8FDB;&#x884C;&#x6602;&#x8D35;&#x7684;&#x626B;&#x63CF;&#x3002;</span><span class="yiyi-st" id="yiyi-393">&#x5728;0.7&#x4E2D;&#x5F15;&#x5165;&#x4E86;<a class="reference external" href="http://docs.sqlalchemy.org/en/latest/orm_extensions_mutable.html">sqlalchemy.ext.mutable</a>&#x6269;&#x5C55;&#xFF0C;&#x4EE5;&#x4FBF;&#x5728;&#x53D1;&#x751F;&#x66F4;&#x6539;&#x65F6;&#x7528;&#x6237;&#x5B9A;&#x4E49;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x53EF;&#x4EE5;&#x5C06;&#x4E8B;&#x4EF6;&#x9002;&#x5F53;&#x5730;&#x53D1;&#x9001;&#x5230;&#x5DE5;&#x4F5C;&#x5355;&#x5143;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-394">&#x4ECA;&#x5929;&#xFF0C;<code class="docutils literal"><span class="pre">MutableType</span></code>&#x7684;&#x4F7F;&#x7528;&#x91CF;&#x9884;&#x8BA1;&#x4F1A;&#x5F88;&#x4F4E;&#xFF0C;&#x56E0;&#x4E3A;&#x5176;&#x6548;&#x7387;&#x4F4E;&#x4E0B;&#x5DF2;&#x7ECF;&#x6709;&#x51E0;&#x5E74;&#x4E86;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-395"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2442">&#xFF03;2442  T0&gt;</a></span></p></div><div class="section" id="sqlalchemy-exceptions-has-been-sqlalchemy-exc-for-years"><h3><span class="yiyi-st" id="yiyi-396">sqlalchemy.exceptions&#xFF08;&#x591A;&#x5E74;&#x6765;&#x4E00;&#x76F4;&#x662F;sqlalchemy.exc&#xFF09;<a class="headerlink" href="#sqlalchemy-exceptions-has-been-sqlalchemy-exc-for-years" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-397">&#x6211;&#x4EEC;&#x7559;&#x4E0B;&#x4E86;&#x4E00;&#x4E2A;&#x522B;&#x540D;<code class="docutils literal"><span class="pre">sqlalchemy.exceptions</span></code>&#xFF0C;&#x8BD5;&#x56FE;&#x4F7F;&#x4E00;&#x4E9B;&#x5C1A;&#x672A;&#x5347;&#x7EA7;&#x5230;&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">sqlalchemy.exc</span></code>&#x7684;&#x975E;&#x5E38;&#x65E7;&#x7684;&#x5E93;&#x53D8;&#x5F97;&#x66F4;&#x5BB9;&#x6613;&#x4E00;&#x4E9B;&#x3002;</span><span class="yiyi-st" id="yiyi-398">&#x4F46;&#x6709;&#x4E9B;&#x7528;&#x6237;&#x4ECD;&#x7136;&#x5BF9;&#x5B83;&#x611F;&#x5230;&#x56F0;&#x60D1;&#xFF0C;&#x6240;&#x4EE5;&#x5728;0.8&#x7248;&#x672C;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x6B63;&#x5728;&#x5F7B;&#x5E95;&#x6D88;&#x9664;&#x8FD9;&#x79CD;&#x6DF7;&#x6DC6;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-399"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2433">&#xFF03;2433  T0&gt;</a></span></p></div></div>