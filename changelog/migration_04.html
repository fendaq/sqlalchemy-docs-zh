<h1><span class="yiyi-st" id="yiyi-95">SQLAlchemy 0.4&#x6709;&#x54EA;&#x4E9B;&#x65B0;&#x7279;&#x6027;&#xFF1F;<a class="headerlink" href="#what-s-new-in-sqlalchemy-0-4" title="Permalink to this headline">&#xB6;</a></span></h1><div class="admonition-about-this-document admonition"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-96">&#x5173;&#x4E8E;&#x672C;&#x6587;&#x6863;</span></p><p><span class="yiyi-st" id="yiyi-97">&#x672C;&#x6587;&#x6863;&#x4ECB;&#x7ECD;&#x4E86;2008&#x5E74;10&#x6708;14&#x65E5;&#x53D1;&#x5E03;&#x7684;SQLAlchemy 0.3&#x7248;&#x548C;2007&#x5E74;10&#x6708;12&#x65E5;&#x53D1;&#x5E03;&#x7684;SQLAlchemy 0.4&#x7248;&#x4E4B;&#x95F4;&#x7684;&#x53D8;&#x5316;&#x3002;</span></p><p class="last"><span class="yiyi-st" id="yiyi-98">&#x6587;&#x4EF6;&#x65E5;&#x671F;&#xFF1A;2008&#x5E74;3&#x6708;21&#x65E5;</span></p></div><div class="section" id="first-things-first"><h2><span class="yiyi-st" id="yiyi-99">&#x7B2C;&#x4E00;&#x4EF6;&#x4E8B;&#x7B2C;&#x4E00;&#x4EF6;<a class="headerlink" href="#first-things-first" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-100">&#x5982;&#x679C;&#x60A8;&#x4F7F;&#x7528;&#x4EFB;&#x4F55;ORM&#x529F;&#x80FD;&#xFF0C;&#x8BF7;&#x786E;&#x4FDD;&#x4ECE;<code class="docutils literal"><span class="pre">sqlalchemy.orm</span></code>&#x5BFC;&#x5165;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="o">*</span></pre></div></div><p><span class="yiyi-st" id="yiyi-101">Secondly, anywhere you used to say <code class="docutils literal"><span class="pre">engine=</span></code>, <code class="docutils literal"><span class="pre">connectable=</span></code>, <code class="docutils literal"><span class="pre">bind_to=</span></code>, <code class="docutils literal"><span class="pre">something.engine</span></code>, <code class="docutils literal"><span class="pre">metadata.connect()</span></code>, use <code class="docutils literal"><span class="pre">bind</span></code>:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">myengine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&apos;sqlite://&apos;</span><span class="p">)</span>

<span class="n">meta</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">(</span><span class="n">myengine</span><span class="p">)</span>

<span class="n">meta2</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">()</span>
<span class="n">meta2</span><span class="o">.</span><span class="n">bind</span> <span class="o">=</span> <span class="n">myengine</span>

<span class="n">session</span> <span class="o">=</span> <span class="n">create_session</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">myengine</span><span class="p">)</span>

<span class="n">statement</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">table</span><span class="p">],</span> <span class="n">bind</span><span class="o">=</span><span class="n">myengine</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-102">&#x6709;&#x8FD9;&#x4E9B;&#xFF1F;</span><span class="yiyi-st" id="yiyi-103">&#x597D;&#xFF01;</span><span class="yiyi-st" id="yiyi-104">&#x4F60;&#x73B0;&#x5728;&#xFF08;95&#xFF05;&#xFF09;0.4&#x517C;&#x5BB9;&#x3002;</span><span class="yiyi-st" id="yiyi-105">&#x5982;&#x679C;&#x60A8;&#x4F7F;&#x7528;0.3.10&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x7ACB;&#x5373;&#x8FDB;&#x884C;&#x8FD9;&#x4E9B;&#x66F4;&#x6539;&#xFF1B;&#x4ED6;&#x4EEC;&#x4E5F;&#x4F1A;&#x5728;&#x90A3;&#x91CC;&#x5DE5;&#x4F5C;&#x3002;</span></p></div><div class="section" id="module-imports"><h2><span class="yiyi-st" id="yiyi-106">&#x6A21;&#x5757;&#x5BFC;&#x5165;<a class="headerlink" href="#module-imports" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-107">In 0.3, &#x201C;<code class="docutils literal"><span class="pre">from</span> <span class="pre">sqlachemy</span> <span class="pre">import</span> <span class="pre">*</span></code>&#x201D; would import all of sqlachemy&#x2019;s sub-modules into your namespace. </span><span class="yiyi-st" id="yiyi-108">&#x7248;&#x672C;0.4&#x4E0D;&#x518D;&#x5C06;&#x5B50;&#x6A21;&#x5757;&#x5BFC;&#x5165;&#x540D;&#x79F0;&#x7A7A;&#x95F4;&#x3002;</span><span class="yiyi-st" id="yiyi-109">&#x8FD9;&#x53EF;&#x80FD;&#x610F;&#x5473;&#x7740;&#x60A8;&#x9700;&#x8981;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x6DFB;&#x52A0;&#x989D;&#x5916;&#x7684;&#x5BFC;&#x5165;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-110">&#x5728;0.3&#x4E2D;&#xFF0C;&#x6B64;&#x4EE3;&#x7801;&#x8D77;&#x4F5C;&#x7528;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">class</span> <span class="nc">UTCDateTime</span><span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">TypeDecorator</span><span class="p">):</span>
    <span class="k">pass</span></pre></div></div><p><span class="yiyi-st" id="yiyi-111">&#x5728;0.4&#x4E2D;&#xFF0C;&#x5FC5;&#x987B;&#x8FD9;&#x6837;&#x505A;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">types</span>

<span class="k">class</span> <span class="nc">UTCDateTime</span><span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">TypeDecorator</span><span class="p">):</span>
    <span class="k">pass</span></pre></div></div></div><div class="section" id="object-relational-mapping"><h2><span class="yiyi-st" id="yiyi-112">&#x5BF9;&#x8C61;&#x5173;&#x7CFB;&#x6620;&#x5C04;<a class="headerlink" href="#object-relational-mapping" title="Permalink to this headline">&#xB6;</a></span></h2><div class="section" id="querying"><h3><span class="yiyi-st" id="yiyi-113">&#x67E5;&#x8BE2;<a class="headerlink" href="#querying" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h3><div class="section" id="new-query-api"><h4><span class="yiyi-st" id="yiyi-114">&#x65B0;&#x7684;&#x67E5;&#x8BE2;API <a class="headerlink" href="#new-query-api" title="Permalink to this headline">&#xB6;</a></span></h4><p><span class="yiyi-st" id="yiyi-115">&#x67E5;&#x8BE2;&#x5728;&#x751F;&#x6210;&#x754C;&#x9762;&#x4E0A;&#x662F;&#x6807;&#x51C6;&#x5316;&#x7684;&#xFF08;&#x65E7;&#x754C;&#x9762;&#x4ECD;&#x7136;&#x5B58;&#x5728;&#xFF0C;&#x4EC5;&#x6B64;&#x800C;&#x5DF2;&#xFF09;&#x3002;</span><span class="yiyi-st" id="yiyi-116">&#x867D;&#x7136;&#x5927;&#x591A;&#x6570;&#x751F;&#x6210;&#x63A5;&#x53E3;&#x7684;&#x53EF;&#x7528;&#x6027;&#x4E3A;0.3&#xFF0C;&#x4F46;0.4 Query&#x5177;&#x6709;&#x4E0E;&#x5916;&#x90E8;&#x751F;&#x6210;&#x5339;&#x914D;&#x7684;&#x5185;&#x5728;&#x80C6;&#x91CF;&#xFF0C;&#x5E76;&#x4E14;&#x6709;&#x66F4;&#x591A;&#x6280;&#x5DE7;&#x3002;</span><span class="yiyi-st" id="yiyi-117">&#x6240;&#x6709;&#x7ED3;&#x679C;&#x7F29;&#x5C0F;&#x90FD;&#x901A;&#x8FC7;<code class="docutils literal"><span class="pre">filter()</span></code>&#x548C;<code class="docutils literal"><span class="pre">filter_by()</span></code>&#xFF0C;&#x9650;&#x5236;/&#x504F;&#x79FB;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6570;&#x7EC4;&#x5207;&#x7247;&#x6216;<code class="docutils literal"><span class="pre">limit()</span></code> / <code class="docutils literal"><span class="pre">offset()</span></code>&#xFF0C;&#x52A0;&#x5165;&#x662F;&#x901A;&#x8FC7;<code class="docutils literal"><span class="pre">join()</span></code>&#x548C;<code class="docutils literal"><span class="pre">outerjoin()</span></code>&#xFF08;&#x6216;&#x8005;&#x66F4;&#x624B;&#x52A8;&#x5730;&#x901A;&#x8FC7;<code class="docutils literal"><span class="pre">select_from()</span></code>&#x4F5C;&#x4E3A;&#x624B;&#x52A8;&#x5F62;&#x6210;&#x7684;&#x6807;&#x51C6;&#xFF09;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-118">&#x4E3A;&#x907F;&#x514D;&#x5F03;&#x7528;&#x8B66;&#x544A;&#xFF0C;&#x60A8;&#x5FC5;&#x987B;&#x5BF9;&#x60A8;&#x7684;03&#x4EE3;&#x7801;&#x8FDB;&#x884C;&#x4E00;&#x4E9B;&#x66F4;&#x6539;</span></p><p><span class="yiyi-st" id="yiyi-119">User.query.get_by&#xFF08;** kwargs&#xFF09;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span></pre></div></div><p><span class="yiyi-st" id="yiyi-120">User.query.select_by&#xFF08;** kwargs&#xFF09;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></pre></div></div><p><span class="yiyi-st" id="yiyi-121">User.query.select()</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">xxx</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></pre></div></div></div><div class="section" id="new-property-based-expression-constructs"><h4><span class="yiyi-st" id="yiyi-122">&#x65B0;&#x7684;&#x57FA;&#x4E8E;&#x5C5E;&#x6027;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#x6784;&#x9020;<a class="headerlink" href="#new-property-based-expression-constructs" title="Permalink to this headline">&#xB6;</a></span></h4><p><span class="yiyi-st" id="yiyi-123">&#x5230;&#x76EE;&#x524D;&#x4E3A;&#x6B62;&#xFF0C;ORM&#x4E2D;&#x6700;&#x660E;&#x663E;&#x7684;&#x5DEE;&#x5F02;&#x662F;&#xFF0C;&#x60A8;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x57FA;&#x4E8E;&#x7C7B;&#x7684;&#x5C5E;&#x6027;&#x6784;&#x5EFA;&#x67E5;&#x8BE2;&#x6761;&#x4EF6;&#x3002;</span><span class="yiyi-st" id="yiyi-124">&#x4F7F;&#x7528;&#x6620;&#x5C04;&#x7C7B;&#x65F6;&#xFF0C;&#x4E0D;&#x518D;&#x9700;&#x8981;&#x201C;.c&#x3002;&#x201D;&#x524D;&#x7F00;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">and_</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&apos;fred&apos;</span><span class="p">,</span> <span class="n">User</span><span class="o">.</span><span class="n">id</span> <span class="o">&gt;</span> <span class="mi">17</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-125">&#x5C3D;&#x7BA1;&#x7B80;&#x5355;&#x7684;&#x57FA;&#x4E8E;&#x5217;&#x7684;&#x6BD4;&#x8F83;&#x6CA1;&#x6709;&#x4EC0;&#x4E48;&#x5927;&#x4E0D;&#x4E86;&#xFF0C;&#x4F46;&#x7C7B;&#x5C5E;&#x6027;&#x6709;&#x4E00;&#x4E9B;&#x65B0;&#x7684;&#x201C;&#x66F4;&#x9AD8;&#x7EA7;&#x522B;&#x201D;&#x7ED3;&#x6784;&#x53EF;&#x7528;&#xFF0C;&#x5305;&#x62EC;&#x4EE5;&#x524D;&#x4EC5;&#x5728;<code class="docutils literal"><span class="pre">filter_by()</span></code>&#x4E2D;&#x53EF;&#x7528;&#x7684;&#x7ED3;&#x6784;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># comparison of scalar relations to an instance</span>
<span class="nb">filter</span><span class="p">(</span><span class="n">Address</span><span class="o">.</span><span class="n">user</span> <span class="o">==</span> <span class="n">user</span><span class="p">)</span>

<span class="c1"># return all users who contain a particular address</span>
<span class="nb">filter</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">addresses</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">address</span><span class="p">))</span>

<span class="c1"># return all users who *dont* contain the address</span>
<span class="nb">filter</span><span class="p">(</span><span class="o">~</span><span class="n">User</span><span class="o">.</span><span class="n">address</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">address</span><span class="p">))</span>

<span class="c1"># return all users who contain a particular address with</span>
<span class="c1"># the email_address like &apos;%foo%&apos;</span>
<span class="nb">filter</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">addresses</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">Address</span><span class="o">.</span><span class="n">email_address</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="s1">&apos;</span><span class="si">%f</span><span class="s1">oo%&apos;</span><span class="p">)))</span>

<span class="c1"># same, email address equals &apos;foo@bar.com&apos;.  can fall back to keyword</span>
<span class="c1"># args for simple comparisons</span>
<span class="nb">filter</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">addresses</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">email_address</span> <span class="o">=</span> <span class="s1">&apos;foo@bar.com&apos;</span><span class="p">))</span>

<span class="c1"># return all Addresses whose user attribute has the username &apos;ed&apos;</span>
<span class="nb">filter</span><span class="p">(</span><span class="n">Address</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">has</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&apos;ed&apos;</span><span class="p">))</span>

<span class="c1"># return all Addresses whose user attribute has the username &apos;ed&apos;</span>
<span class="c1"># and an id &gt; 5 (mixing clauses with kwargs)</span>
<span class="nb">filter</span><span class="p">(</span><span class="n">Address</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">has</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">id</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&apos;ed&apos;</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-126"><code class="docutils literal"><span class="pre">Column</span></code>&#x96C6;&#x5408;&#x5728;<code class="docutils literal"><span class="pre">.c</span></code>&#x5C5E;&#x6027;&#x4E2D;&#x7684;&#x6620;&#x5C04;&#x7C7B;&#x4E0A;&#x4ECD;&#x7136;&#x53EF;&#x7528;&#x3002;</span><span class="yiyi-st" id="yiyi-127">&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x57FA;&#x4E8E;&#x5C5E;&#x6027;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#x4EC5;&#x9002;&#x7528;&#x4E8E;&#x6620;&#x5C04;&#x7C7B;&#x7684;&#x6620;&#x5C04;&#x5C5E;&#x6027;&#x3002;</span><span class="yiyi-st" id="yiyi-128"><code class="docutils literal"><span class="pre">.c</span></code>&#x4ECD;&#x7136;&#x7528;&#x4E8E;&#x8BBF;&#x95EE;&#x5E38;&#x89C4;&#x8868;&#x4E2D;&#x7684;&#x5217;&#x548C;SQL&#x8868;&#x8FBE;&#x5F0F;&#x751F;&#x6210;&#x7684;&#x53EF;&#x9009;&#x5BF9;&#x8C61;&#x3002;</span></p></div><div class="section" id="automatic-join-aliasing"><h4><span class="yiyi-st" id="yiyi-129">&#x81EA;&#x52A8;&#x8FDE;&#x63A5;&#x522B;&#x540D;<a class="headerlink" href="#automatic-join-aliasing" title="Permalink to this headline">&#xB6;</a></span></h4><p><span class="yiyi-st" id="yiyi-130">&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x6709;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;join()&#x548C;outerjoin()&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>session.query(Order).join(&apos;items&apos;)...</pre></div></div><p><span class="yiyi-st" id="yiyi-131">&#x73B0;&#x5728;&#x4F60;&#x53EF;&#x4EE5;&#x522B;&#x540D;&#x4E86;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>session.query(Order).join(&apos;items&apos;, aliased=True).
   filter(Item.name=&apos;item 1&apos;).join(&apos;items&apos;, aliased=True).filter(Item.name==&apos;item 3&apos;)</pre></div></div><p><span class="yiyi-st" id="yiyi-132">&#x4EE5;&#x4E0A;&#x5C06;&#x4F7F;&#x7528;&#x522B;&#x540D;&#x4ECE;&#x8BA2;&#x5355; - &gt;&#x9879;&#x76EE;&#x521B;&#x5EFA;&#x4E24;&#x4E2A;&#x8FDE;&#x63A5;&#x3002;</span><span class="yiyi-st" id="yiyi-133">&#x6BCF;&#x4E2A;&#x540E;&#x9762;&#x7684;<code class="docutils literal"><span class="pre">filter()</span></code>&#x8C03;&#x7528;&#x90FD;&#x4F1A;&#x5C06;&#x5176;&#x8868;&#x683C;&#x6807;&#x51C6;&#x8C03;&#x6574;&#x4E3A;&#x522B;&#x540D;&#x6807;&#x51C6;&#x3002;</span><span class="yiyi-st" id="yiyi-134">&#x8981;&#x83B7;&#x53D6;<code class="docutils literal"><span class="pre">Item</span></code>&#x5BF9;&#x8C61;&#xFF0C;&#x8BF7;&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">add_entity()</span></code>&#x5E76;&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">id</span></code>&#x5B9A;&#x4F4D;&#x6BCF;&#x4E2A;&#x8FDE;&#x63A5;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>session.query(Order).join(&apos;items&apos;, id=&apos;j1&apos;, aliased=True).
filter(Item.name == &apos;item 1&apos;).join(&apos;items&apos;, aliased=True, id=&apos;j2&apos;).
filter(Item.name == &apos;item 3&apos;).add_entity(Item, id=&apos;j1&apos;).add_entity(Item, id=&apos;j2&apos;)</pre></div></div><p><span class="yiyi-st" id="yiyi-135">&#x4EE5;&#x4E0B;&#x9762;&#x7684;&#x5F62;&#x5F0F;&#x8FD4;&#x56DE;&#x5143;&#x7EC4;&#xFF1A;<code class="docutils literal"><span class="pre">&#xFF08;Order&#xFF0C;</span> <span class="pre">Item&#xFF0C;</span> <span class="pre">Item&#xFF09;</span></code>&#x3002;</span></p></div><div class="section" id="self-referential-queries"><h4><span class="yiyi-st" id="yiyi-136">&#x81EA;&#x6211;&#x5F15;&#x7528;&#x67E5;&#x8BE2;<a class="headerlink" href="#self-referential-queries" title="Permalink to this headline">&#xB6;</a></span></h4><p><span class="yiyi-st" id="yiyi-137">&#x6240;&#x4EE5;query.join()&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x751F;&#x6210;&#x522B;&#x540D;&#x3002;</span><span class="yiyi-st" id="yiyi-138">&#x8FD9;&#x7ED9;&#x4E86;&#x6211;&#x4EEC;&#x4EC0;&#x4E48;&#xFF1F;</span><span class="yiyi-st" id="yiyi-139">&#x81EA;&#x5F15;&#x7528;&#x67E5;&#x8BE2;&#xFF01;</span><span class="yiyi-st" id="yiyi-140">&#x8FDE;&#x63A5;&#x53EF;&#x4EE5;&#x5728;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;<code class="docutils literal"><span class="pre">Alias</span></code>&#x5BF9;&#x8C61;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x5B8C;&#x6210;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># standard self-referential TreeNode mapper with backref</span>
<span class="n">mapper</span><span class="p">(</span><span class="n">TreeNode</span><span class="p">,</span> <span class="n">tree_nodes</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="p">{</span>
    <span class="s1">&apos;children&apos;</span><span class="p">:</span><span class="n">relation</span><span class="p">(</span><span class="n">TreeNode</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="n">backref</span><span class="p">(</span><span class="s1">&apos;parent&apos;</span><span class="p">,</span> <span class="n">remote_side</span><span class="o">=</span><span class="n">tree_nodes</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
<span class="p">})</span>

<span class="c1"># query for node with child containing &quot;bar&quot; two levels deep</span>
<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">TreeNode</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;children&quot;</span><span class="p">,</span> <span class="s2">&quot;children&quot;</span><span class="p">],</span> <span class="n">aliased</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&apos;bar&apos;</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-141">&#x8981;&#x4E3A;&#x522B;&#x540D;&#x4E2D;&#x7684;&#x6BCF;&#x4E2A;&#x8868;&#x6DFB;&#x52A0;&#x6761;&#x4EF6;&#x6807;&#x51C6;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">from_joinpoint</span></code>&#x7EE7;&#x7EED;&#x52A0;&#x5165;&#x540C;&#x4E00;&#x884C;&#x522B;&#x540D;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># search for the treenode along the path &quot;n1/n12/n122&quot;</span>

<span class="c1"># first find a Node with name=&quot;n122&quot;</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Node</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&apos;n122&apos;</span><span class="p">)</span>

<span class="c1"># then join to parent with &quot;n12&quot;</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&apos;parent&apos;</span><span class="p">,</span> <span class="n">aliased</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&apos;n12&apos;</span><span class="p">)</span>

<span class="c1"># join again to the next parent with &apos;n1&apos;.  use &apos;from_joinpoint&apos;</span>
<span class="c1"># so we join from the previous point, instead of joining off the</span>
<span class="c1"># root table</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&apos;parent&apos;</span><span class="p">,</span> <span class="n">aliased</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">from_joinpoint</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&apos;n1&apos;</span><span class="p">)</span>

<span class="n">node</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">first</span><span class="p">()</span></pre></div></div></div><div class="section" id="query-populate-existing"><h4><span class="yiyi-st" id="yiyi-142"><code class="docutils literal"><span class="pre">query.populate_existing()</span></code><a class="headerlink" href="#query-populate-existing" title="Permalink to this headline">&#xB6;</a></span></h4><p><span class="yiyi-st" id="yiyi-143"><code class="docutils literal"><span class="pre">query.load()</span></code>&#xFF08;&#x6216;<code class="docutils literal"><span class="pre">session.refresh()</span></code>&#xFF09;&#x7684;&#x70ED;&#x5207;&#x7248;&#x672C;&#x3002;</span><span class="yiyi-st" id="yiyi-144">&#x5982;&#x679C;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x4E8E;&#x4F1A;&#x8BDD;&#x4E2D;&#xFF0C;&#x5219;&#x4ECE;&#x67E5;&#x8BE2;&#x52A0;&#x8F7D;&#x7684;&#x6BCF;&#x4E2A;&#x5B9E;&#x4F8B;&#xFF08;&#x5305;&#x62EC;&#x6240;&#x6709;&#x6025;&#x5207;&#x52A0;&#x8F7D;&#x7684;&#x9879;&#x76EE;&#xFF09;&#x90FD;&#x4F1A;&#x7ACB;&#x5373;&#x5237;&#x65B0;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Blah</span><span class="p">)</span><span class="o">.</span><span class="n">populate_existing</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></pre></div></div></div></div><div class="section" id="relations"><h3><span class="yiyi-st" id="yiyi-145">&#x5173;&#x7CFB;<a class="headerlink" href="#relations" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h3><div class="section" id="sql-clauses-embedded-in-updates-inserts"><h4><span class="yiyi-st" id="yiyi-146">&#x5D4C;&#x5165;&#x5230;&#x66F4;&#x65B0;/&#x63D2;&#x5165;&#x4E2D;&#x7684;SQL&#x5B50;&#x53E5;<a class="headerlink" href="#sql-clauses-embedded-in-updates-inserts" title="Permalink to this headline">&#xB6;</a></span></h4><p><span class="yiyi-st" id="yiyi-147">&#x5BF9;&#x4E8E;&#x5728;<code class="docutils literal"><span class="pre">flush()</span></code>&#x671F;&#x95F4;&#x5D4C;&#x5165;&#x5F0F;&#x6267;&#x884C;SQL&#x5B50;&#x53E5;&#xFF0C;&#x76F4;&#x63A5;&#x5D4C;&#x5165;UPDATE&#x6216;INSERT&#x4E2D;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">myobject</span><span class="o">.</span><span class="n">foo</span> <span class="o">=</span> <span class="n">mytable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="mi">1</span>

<span class="n">user</span><span class="o">.</span><span class="n">pwhash</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>

<span class="n">order</span><span class="o">.</span><span class="n">hash</span> <span class="o">=</span> <span class="n">text</span><span class="p">(</span><span class="s2">&quot;select hash from hashing_table&quot;</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-148">&#x5728;&#x64CD;&#x4F5C;&#x4E4B;&#x540E;&#xFF0C;&#x4F7F;&#x7528;&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x5668;&#x8BBE;&#x7F6E;column-attribute&#xFF0C;&#x4EE5;&#x4FBF;&#x5728;&#x4E0B;&#x6B21;&#x8BBF;&#x95EE;&#x65F6;&#x53D1;&#x51FA;SQL&#x4EE5;&#x52A0;&#x8F7D;&#x65B0;&#x503C;&#x3002;</span></p></div><div class="section" id="self-referential-and-cyclical-eager-loading"><h4><span class="yiyi-st" id="yiyi-149">&#x81EA;&#x5F15;&#x7528;&#x548C;&#x5468;&#x671F;&#x6027;&#x5FEB;&#x901F;&#x52A0;&#x8F7D;<a class="headerlink" href="#self-referential-and-cyclical-eager-loading" title="Permalink to this headline">&#xB6;</a></span></h4><p><span class="yiyi-st" id="yiyi-150">&#x7531;&#x4E8E;&#x6211;&#x4EEC;&#x7684;alias-fu&#x5DF2;&#x7ECF;&#x6539;&#x8FDB;&#xFF0C;&#x6240;&#x4EE5;<code class="docutils literal"><span class="pre">relation()</span></code>&#x53EF;&#x4EE5;&#x6CBF;&#x540C;&#x4E00;&#x4E2A;&#x8868;&#x52A0;&#x5165;*&#x4EFB;&#x610F;&#x6B21;&#x6570;*&#xFF1B;&#x4F60;&#x544A;&#x8BC9;&#x5B83;&#x4F60;&#x60F3;&#x8D70;&#x591A;&#x6DF1;&#x3002;</span><span class="yiyi-st" id="yiyi-151">&#x8BA9;&#x6211;&#x4EEC;&#x66F4;&#x6E05;&#x695A;&#x5730;&#x663E;&#x793A;&#x81EA;&#x5F15;&#x7528;&#x7684;<code class="docutils literal"><span class="pre">TreeNode</span></code>&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">nodes</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&apos;nodes&apos;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
     <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;id&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
     <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;parent_id&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;nodes.id&apos;</span><span class="p">)),</span>
     <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;name&apos;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">30</span><span class="p">)))</span>

<span class="k">class</span> <span class="nc">TreeNode</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="n">mapper</span><span class="p">(</span><span class="n">TreeNode</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="p">{</span>
    <span class="s1">&apos;children&apos;</span><span class="p">:</span><span class="n">relation</span><span class="p">(</span><span class="n">TreeNode</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">join_depth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="p">})</span></pre></div></div><p><span class="yiyi-st" id="yiyi-152">&#x90A3;&#x4E48;&#x5F53;&#x6211;&#x4EEC;&#x8BF4;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">create_session</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">TreeNode</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></pre></div></div><p><span class="yiyi-st" id="yiyi-153">? </span><span class="yiyi-st" id="yiyi-154">&#x6CBF;&#x7740;&#x522B;&#x540D;&#x8FDB;&#x884C;&#x8FDE;&#x63A5;&#xFF0C;&#x4ECE;&#x7236;&#x6BCD;&#x90A3;&#x91CC;&#x6DF1;&#x5165;&#x4E09;&#x7EA7;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT
nodes_3.id AS nodes_3_id, nodes_3.parent_id AS nodes_3_parent_id, nodes_3.name AS nodes_3_name,
nodes_2.id AS nodes_2_id, nodes_2.parent_id AS nodes_2_parent_id, nodes_2.name AS nodes_2_name,
nodes_1.id AS nodes_1_id, nodes_1.parent_id AS nodes_1_parent_id, nodes_1.name AS nodes_1_name,
nodes.id AS nodes_id, nodes.parent_id AS nodes_parent_id, nodes.name AS nodes_name
FROM nodes LEFT OUTER JOIN nodes AS nodes_1 ON nodes.id = nodes_1.parent_id
LEFT OUTER JOIN nodes AS nodes_2 ON nodes_1.id = nodes_2.parent_id
LEFT OUTER JOIN nodes AS nodes_3 ON nodes_2.id = nodes_3.parent_id
ORDER BY nodes.oid, nodes_1.oid, nodes_2.oid, nodes_3.oid</pre></div></div><p><span class="yiyi-st" id="yiyi-155">&#x6CE8;&#x610F;&#x5E72;&#x51C0;&#x7684;&#x522B;&#x540D;&#x3002;</span><span class="yiyi-st" id="yiyi-156">&#x52A0;&#x5165;&#x5E76;&#x4E0D;&#x5173;&#x5FC3;&#x5B83;&#x662F;&#x5426;&#x8FDD;&#x80CC;&#x540C;&#x4E00;&#x4E2A;&#x76F4;&#x63A5;&#x8868;&#x6216;&#x5176;&#x4ED6;&#x5BF9;&#x8C61;&#xFF0C;&#x7136;&#x540E;&#x5FAA;&#x73AF;&#x56DE;&#x5230;&#x5F00;&#x59CB;&#x3002;</span><span class="yiyi-st" id="yiyi-157">&#x5F53;&#x6307;&#x5B9A;<code class="docutils literal"><span class="pre">join_depth</span></code>&#x65F6;&#xFF0C;&#x4EFB;&#x4F55;&#x7C7B;&#x578B;&#x7684;&#x70ED;&#x5207;&#x52A0;&#x8F7D;&#x94FE;&#x90FD;&#x53EF;&#x4EE5;&#x5FAA;&#x73AF;&#x56DE;&#x81EA;&#x8EAB;&#x3002;</span><span class="yiyi-st" id="yiyi-158">&#x5F53;&#x4E0D;&#x5B58;&#x5728;&#x65F6;&#xFF0C;&#x6025;&#x5207;&#x52A0;&#x8F7D;&#x5728;&#x78B0;&#x5230;&#x4E00;&#x4E2A;&#x5FAA;&#x73AF;&#x65F6;&#x81EA;&#x52A8;&#x505C;&#x6B62;&#x3002;</span></p></div><div class="section" id="composite-types"><h4><span class="yiyi-st" id="yiyi-159">&#x590D;&#x5408;&#x7C7B;&#x578B;<a class="headerlink" href="#composite-types" title="Permalink to this headline">&#xB6;</a></span></h4><p><span class="yiyi-st" id="yiyi-160">&#x8FD9;&#x662F;Hibernate&#x9635;&#x8425;&#x7684;&#x4E00;&#x5458;&#x3002;</span><span class="yiyi-st" id="yiyi-161">&#x590D;&#x5408;&#x7C7B;&#x578B;&#x5141;&#x8BB8;&#x60A8;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x7531;&#x591A;&#x4E2A;&#x5217;&#xFF08;&#x6216;&#x8005;&#x4E00;&#x5217;&#xFF0C;&#x5982;&#x679C;&#x9700;&#x8981;&#xFF09;&#x7EC4;&#x6210;&#x7684;&#x81EA;&#x5B9A;&#x4E49;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x3002;</span><span class="yiyi-st" id="yiyi-162">&#x8BA9;&#x6211;&#x4EEC;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x7C7B;&#x578B;&#xFF0C;<code class="docutils literal"><span class="pre">Point</span></code>&#x3002;</span><span class="yiyi-st" id="yiyi-163">&#x5B58;&#x50A8;x / y&#x5750;&#x6807;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Point</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
    <span class="k">def</span> <span class="nf">__composite_values__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-164">&#x5B9A;&#x4E49;<code class="docutils literal"><span class="pre">Point</span></code>&#x5BF9;&#x8C61;&#x7684;&#x65B9;&#x5F0F;&#x7279;&#x5B9A;&#x4E8E;&#x81EA;&#x5B9A;&#x4E49;&#x7C7B;&#x578B;&#xFF1B;&#x6784;&#x9020;&#x51FD;&#x6570;&#x63A5;&#x53D7;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x5217;&#x8868;&#xFF0C;&#x5E76;&#x4E14;<code class="docutils literal"><span class="pre">__composite_values__()</span></code>&#x65B9;&#x6CD5;&#x4EA7;&#x751F;&#x8FD9;&#x4E9B;&#x53C2;&#x6570;&#x7684;&#x5E8F;&#x5217;&#x3002;</span><span class="yiyi-st" id="yiyi-165">&#x987A;&#x5E8F;&#x5C06;&#x4E0E;&#x6211;&#x4EEC;&#x7684;&#x6620;&#x5C04;&#x5668;&#x76F8;&#x5339;&#x914D;&#xFF0C;&#x6211;&#x4EEC;&#x7A0D;&#x540E;&#x4F1A;&#x770B;&#x5230;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-166">&#x6211;&#x4EEC;&#x6765;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x9876;&#x70B9;&#x8868;&#xFF0C;&#x6BCF;&#x884C;&#x5B58;&#x50A8;&#x4E24;&#x4E2A;&#x70B9;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">vertices</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&apos;vertices&apos;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;id&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;x1&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;y1&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;x2&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;y2&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">),</span>
    <span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-167">&#x7136;&#x540E;&#xFF0C;&#x6620;&#x5C04;&#x5B83;&#xFF01;</span><span class="yiyi-st" id="yiyi-168">&#x6211;&#x4EEC;&#x5C06;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5B58;&#x50A8;&#x4E24;&#x4E2A;<code class="docutils literal"><span class="pre">Point</span></code>&#x5BF9;&#x8C61;&#x7684;<code class="docutils literal"><span class="pre">Vertex</span></code>&#x5BF9;&#x8C61;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Vertex</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">end</span>

<span class="n">mapper</span><span class="p">(</span><span class="n">Vertex</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="p">{</span>
    <span class="s1">&apos;start&apos;</span><span class="p">:</span><span class="n">composite</span><span class="p">(</span><span class="n">Point</span><span class="p">,</span> <span class="n">vertices</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">x1</span><span class="p">,</span> <span class="n">vertices</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">y1</span><span class="p">),</span>
    <span class="s1">&apos;end&apos;</span><span class="p">:</span><span class="n">composite</span><span class="p">(</span><span class="n">Point</span><span class="p">,</span> <span class="n">vertices</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">x2</span><span class="p">,</span> <span class="n">vertices</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">y2</span><span class="p">)</span>
<span class="p">})</span></pre></div></div><p><span class="yiyi-st" id="yiyi-169">&#x4E00;&#x65E6;&#x4F60;&#x8BBE;&#x7F6E;&#x4E86;&#x4F60;&#x7684;&#x590D;&#x5408;&#x7C7B;&#x578B;&#xFF0C;&#x5B83;&#x5C31;&#x50CF;&#x5176;&#x4ED6;&#x4EFB;&#x4F55;&#x7C7B;&#x578B;&#x4E00;&#x6837;&#x53EF;&#x7528;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">v</span> <span class="o">=</span> <span class="n">Vertex</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="mi">26</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>
<span class="n">session</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

<span class="c1"># works in queries too</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Vertex</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Vertex</span><span class="o">.</span><span class="n">start</span> <span class="o">==</span> <span class="n">Point</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-170">&#x5982;&#x679C;&#x60A8;&#x60F3;&#x5B9A;&#x4E49;&#x6620;&#x5C04;&#x5C5E;&#x6027;&#x5728;&#x8868;&#x8FBE;&#x5F0F;&#x4E2D;&#x4F7F;&#x7528;&#x65F6;&#x751F;&#x6210;SQL&#x5B50;&#x53E5;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x8BF7;&#x521B;&#x5EFA;&#x60A8;&#x81EA;&#x5DF1;&#x7684;<code class="docutils literal"><span class="pre">sqlalchemy.orm.PropComparator</span></code>&#x5B50;&#x7C7B;&#xFF0C;&#x5B9A;&#x4E49;&#x4EFB;&#x4F55;&#x5E38;&#x7528;&#x8FD0;&#x7B97;&#x7B26;&#xFF08;&#x5982;<code class="docutils literal"><span class="pre">__eq__()</span></code>&#xFF0C;<code class="docutils literal"><span class="pre">__le__()</span></code>&#x7B49;</span><span class="yiyi-st" id="yiyi-171">&#xFF09;&#xFF0C;&#x5E76;&#x5C06;&#x5B83;&#x53D1;&#x9001;&#x5230;<code class="docutils literal"><span class="pre">composite()</span></code>&#x3002;</span><span class="yiyi-st" id="yiyi-172">&#x590D;&#x5408;&#x7C7B;&#x578B;&#x4E5F;&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;&#x4E3B;&#x952E;&#xFF0C;&#x5E76;&#x53EF;&#x7528;&#x4E8E;<code class="docutils literal"><span class="pre">query.get()</span></code>&#x4E2D;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># a Document class which uses a composite Version</span>
<span class="c1"># object as primary key</span>
<span class="n">document</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Version</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&apos;a&apos;</span><span class="p">))</span></pre></div></div></div><div class="section" id="dynamic-loader-relations"><h4><span class="yiyi-st" id="yiyi-173"><code class="docutils literal"><span class="pre">dynamic_loader()</span></code>&#x5173;&#x7CFB;<a class="headerlink" href="#dynamic-loader-relations" title="Permalink to this headline">&#xB6;</a></span></h4><p><span class="yiyi-st" id="yiyi-174">&#x4E00;&#x4E2A;<code class="docutils literal"><span class="pre">relation()</span></code>&#xFF0C;&#x5B83;&#x4E3A;&#x6240;&#x6709;&#x8BFB;&#x53D6;&#x64CD;&#x4F5C;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x5B9E;&#x65F6;<code class="docutils literal"><span class="pre">Query</span></code>&#x5BF9;&#x8C61;&#x3002;</span><span class="yiyi-st" id="yiyi-175">&#x5199;&#x64CD;&#x4F5C;&#x4EC5;&#x9650;&#x4E8E;<code class="docutils literal"><span class="pre">append()</span></code>&#x548C;<code class="docutils literal"><span class="pre">remove()</span></code>&#xFF0C;&#x96C6;&#x5408;&#x7684;&#x66F4;&#x6539;&#x5728;&#x5237;&#x65B0;&#x4F1A;&#x8BDD;&#x4E4B;&#x524D;&#x4E0D;&#x53EF;&#x89C1;&#x3002;</span><span class="yiyi-st" id="yiyi-176">&#x6B64;&#x529F;&#x80FD;&#x7279;&#x522B;&#x9002;&#x7528;&#x4E8E;&#x5728;&#x6BCF;&#x6B21;&#x67E5;&#x8BE2;&#x4E4B;&#x524D;&#x5237;&#x65B0;&#x7684;&#x201C;&#x81EA;&#x52A8;&#x5237;&#x65B0;&#x201D;&#x4F1A;&#x8BDD;&#x3002;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>mapper(Foo, foo_table, properties={
    &apos;bars&apos;:dynamic_loader(Bar, backref=&apos;foo&apos;, &lt;other relation() opts&gt;)
})

session = create_session(autoflush=True)
foo = session.query(Foo).first()

foo.bars.append(Bar(name=&apos;lala&apos;))

for bar in foo.bars.filter(Bar.name==&apos;lala&apos;):
    print(bar)

session.commit()</pre></div></div></div><div class="section" id="new-options-undefer-group-eagerload-all"><h4><span class="yiyi-st" id="yiyi-177">&#x65B0;&#x9009;&#x9879;&#xFF1A;<code class="docutils literal"><span class="pre">undefer_group()</span></code>&#xFF0C;<code class="docutils literal"><span class="pre">eagerload_all()</span></code> <a class="headerlink" href="#new-options-undefer-group-eagerload-all" title="Permalink to this headline">&#xB6;</a></span></h4><p><span class="yiyi-st" id="yiyi-178">&#x4E00;&#x4E9B;&#x65B9;&#x4FBF;&#x7684;&#x67E5;&#x8BE2;&#x9009;&#x9879;&#x3002;</span><span class="yiyi-st" id="yiyi-179"><code class="docutils literal"><span class="pre">undefer_group()</span></code>&#x5C06;&#x4E00;&#x7EC4;&#x201C;&#x5EF6;&#x8FDF;&#x201D;&#x5217;&#x6807;&#x8BB0;&#x4E3A;undeferred&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>mapper(Class, table, properties={
    &apos;foo&apos; : deferred(table.c.foo, group=&apos;group1&apos;),
    &apos;bar&apos; : deferred(table.c.bar, group=&apos;group1&apos;),
    &apos;bat&apos; : deferred(table.c.bat, group=&apos;group1&apos;),
)

session.query(Class).options(undefer_group(&apos;group1&apos;)).filter(...).all()</pre></div></div><p><span class="yiyi-st" id="yiyi-180">&#x548C;<code class="docutils literal"><span class="pre">eagerload_all()</span></code>&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;&#x5C5E;&#x6027;&#x94FE;&#xFF0C;&#x4EE5;&#x4FBF;&#x5728;&#x4E00;&#x6B21;&#x4F20;&#x9012;&#x4E2D;&#x4FDD;&#x6301;&#x6E34;&#x671B;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">mapper</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="n">foo_table</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="p">{</span>
   <span class="s1">&apos;bar&apos;</span><span class="p">:</span><span class="n">relation</span><span class="p">(</span><span class="n">Bar</span><span class="p">)</span>
<span class="p">})</span>
<span class="n">mapper</span><span class="p">(</span><span class="n">Bar</span><span class="p">,</span> <span class="n">bar_table</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="p">{</span>
   <span class="s1">&apos;bat&apos;</span><span class="p">:</span><span class="n">relation</span><span class="p">(</span><span class="n">Bat</span><span class="p">)</span>
<span class="p">})</span>
<span class="n">mapper</span><span class="p">(</span><span class="n">Bat</span><span class="p">,</span> <span class="n">bat_table</span><span class="p">)</span>

<span class="c1"># eager load bar and bat</span>
<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Foo</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">eagerload_all</span><span class="p">(</span><span class="s1">&apos;bar.bat&apos;</span><span class="p">))</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="o">...</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></pre></div></div></div><div class="section" id="new-collection-api"><h4><span class="yiyi-st" id="yiyi-181">&#x65B0;&#x96C6;&#x5408;API <a class="headerlink" href="#new-collection-api" title="Permalink to this headline">&#xB6;</a></span></h4><p><span class="yiyi-st" id="yiyi-182">&#x96C6;&#x5408;&#x4E0D;&#x518D;&#x7531;{{{InstrumentedList}}}&#x4EE3;&#x7406;&#x4EE3;&#x7406;&#xFF0C;&#x5E76;&#x4E14;&#x5BF9;&#x6210;&#x5458;&#xFF0C;&#x65B9;&#x6CD5;&#x548C;&#x5C5E;&#x6027;&#x7684;&#x8BBF;&#x95EE;&#x662F;&#x76F4;&#x63A5;&#x7684;&#x3002;</span><span class="yiyi-st" id="yiyi-183">&#x88C5;&#x9970;&#x8005;&#x73B0;&#x5728;&#x62E6;&#x622A;&#x8FDB;&#x5165;&#x548C;&#x79BB;&#x5F00;&#x96C6;&#x5408;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x8F7B;&#x677E;&#x5730;&#x7F16;&#x5199;&#x7BA1;&#x7406;&#x81EA;&#x5DF1;&#x7684;&#x6210;&#x5458;&#x8D44;&#x683C;&#x7684;&#x81EA;&#x5B9A;&#x4E49;&#x96C6;&#x5408;&#x7C7B;&#x3002;</span><span class="yiyi-st" id="yiyi-184">&#x7075;&#x6D3B;&#x7684;&#x88C5;&#x9970;&#x5668;&#x4E5F;&#x53EF;&#x4EE5;&#x66FF;&#x6362;0.3&#x4E2D;&#x5B9A;&#x5236;&#x96C6;&#x5408;&#x7684;&#x547D;&#x540D;&#x65B9;&#x6CD5;&#x63A5;&#x53E3;&#xFF0C;&#x4ECE;&#x800C;&#x4F7F;&#x4EFB;&#x4F55;&#x7C7B;&#x90FD;&#x53EF;&#x4EE5;&#x5F88;&#x5BB9;&#x6613;&#x5730;&#x4F5C;&#x4E3A;&#x96C6;&#x5408;&#x5BB9;&#x5668;&#x4F7F;&#x7528;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-185">&#x57FA;&#x4E8E;&#x5B57;&#x5178;&#x7684;&#x96C6;&#x5408;&#x73B0;&#x5728;&#x66F4;&#x5BB9;&#x6613;&#x4F7F;&#x7528;&#xFF0C;&#x5E76;&#x4E14;&#x5B8C;&#x5168;&#x50CF;<code class="docutils literal"><span class="pre">dict</span></code>&#x4E00;&#x6837;&#x3002;</span><span class="yiyi-st" id="yiyi-186">Changing <code class="docutils literal"><span class="pre">__iter__</span></code> is no longer needed for <code class="docutils literal"><span class="pre">dict``s,</span> <span class="pre">and</span> <span class="pre">new</span> <span class="pre">built-in</span> <span class="pre">``dict</span></code> types cover many needs:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># use a dictionary relation keyed by a column</span>
<span class="n">relation</span><span class="p">(</span><span class="n">Item</span><span class="p">,</span> <span class="n">collection_class</span><span class="o">=</span><span class="n">column_mapped_collection</span><span class="p">(</span><span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">keyword</span><span class="p">))</span>
<span class="c1"># or named attribute</span>
<span class="n">relation</span><span class="p">(</span><span class="n">Item</span><span class="p">,</span> <span class="n">collection_class</span><span class="o">=</span><span class="n">attribute_mapped_collection</span><span class="p">(</span><span class="s1">&apos;keyword&apos;</span><span class="p">))</span>
<span class="c1"># or any function you like</span>
<span class="n">relation</span><span class="p">(</span><span class="n">Item</span><span class="p">,</span> <span class="n">collection_class</span><span class="o">=</span><span class="n">mapped_collection</span><span class="p">(</span><span class="k">lambda</span> <span class="n">entity</span><span class="p">:</span> <span class="n">entity</span><span class="o">.</span><span class="n">a</span> <span class="o">+</span> <span class="n">entity</span><span class="o">.</span><span class="n">b</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-187">&#x9700;&#x8981;&#x4E3A;&#x65B0;API&#x66F4;&#x65B0;&#x73B0;&#x6709;&#x7684;0.3 <code class="docutils literal"><span class="pre">dict</span></code>&#x6837;&#x548C;&#x81EA;&#x7531;&#x683C;&#x5F0F;&#x7684;&#x5BF9;&#x8C61;&#x6D3E;&#x751F;&#x96C6;&#x5408;&#x7C7B;&#x3002;</span><span class="yiyi-st" id="yiyi-188">&#x5728;&#x5927;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8FD9;&#x53EA;&#x662F;&#x5C06;&#x4E00;&#x4E9B;&#x88C5;&#x9970;&#x5668;&#x6DFB;&#x52A0;&#x5230;&#x7C7B;&#x5B9A;&#x4E49;&#x4E2D;&#x7684;&#x95EE;&#x9898;&#x3002;</span></p></div><div class="section" id="mapped-relations-from-external-tables-subqueries"><h4><span class="yiyi-st" id="yiyi-189">&#x4ECE;&#x5916;&#x90E8;&#x8868;/&#x5B50;&#x67E5;&#x8BE2;&#x6620;&#x5C04;&#x5173;&#x7CFB;<a class="headerlink" href="#mapped-relations-from-external-tables-subqueries" title="Permalink to this headline">&#xB6;</a></span></h4><p><span class="yiyi-st" id="yiyi-190">&#x8FD9;&#x4E2A;&#x7279;&#x6027;&#x9759;&#x9759;&#x5730;&#x51FA;&#x73B0;&#x5728;0.3&#x4E2D;&#xFF0C;&#x4F46;&#x5728;0.4&#x4E0B;&#x5F97;&#x5230;&#x4E86;&#x6539;&#x8FDB;&#xFF0C;&#x8FD9;&#x8981;&#x5F52;&#x529F;&#x4E8E;&#x80FD;&#x591F;&#x5C06;&#x5B50;&#x67E5;&#x8BE2;&#x8F6C;&#x6362;&#x4E3A;&#x8868;&#x7684;&#x5B50;&#x67E5;&#x8BE2;&#x8F6C;&#x6362;&#x4E3A;&#x9488;&#x5BF9;&#x8BE5;&#x8868;&#x7684;&#x522B;&#x540D;&#x7684;&#x5B50;&#x67E5;&#x8BE2;&#x3002;&#x8FD9;&#x5BF9;&#x4E8E;&#x6025;&#x5207;&#x52A0;&#x8F7D;&#xFF0C;&#x67E5;&#x8BE2;&#x4E2D;&#x7684;&#x522B;&#x540D;&#x52A0;&#x5165;&#x7B49;&#x662F;&#x5173;&#x952E;&#x7684;&#x3002;</span><span class="yiyi-st" id="yiyi-191">&#x5F53;&#x60A8;&#x53EA;&#x9700;&#x8981;&#x6DFB;&#x52A0;&#x4E00;&#x4E9B;&#x989D;&#x5916;&#x7684;&#x5217;&#x6216;&#x5B50;&#x67E5;&#x8BE2;&#x65F6;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x51CF;&#x5C11;&#x5BF9;select&#x8BED;&#x53E5;&#x521B;&#x5EFA;&#x6620;&#x5C04;&#x5668;&#x7684;&#x9700;&#x8981;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">mapper</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">users</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="p">{</span>
       <span class="s1">&apos;fullname&apos;</span><span class="p">:</span> <span class="n">column_property</span><span class="p">((</span><span class="n">users</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">firstname</span> <span class="o">+</span> <span class="n">users</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">lastname</span><span class="p">)</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="s1">&apos;fullname&apos;</span><span class="p">)),</span>
       <span class="s1">&apos;numposts&apos;</span><span class="p">:</span> <span class="n">column_property</span><span class="p">(</span>
            <span class="n">select</span><span class="p">([</span><span class="n">func</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">1</span><span class="p">)],</span> <span class="n">users</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="n">posts</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">users</span><span class="p">)</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="s1">&apos;posts&apos;</span><span class="p">)</span>
       <span class="p">)</span>
    <span class="p">})</span></pre></div></div><p><span class="yiyi-st" id="yiyi-192">&#x4E00;&#x4E2A;&#x5178;&#x578B;&#x7684;&#x67E5;&#x8BE2;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT (SELECT count(1) FROM posts WHERE users.id = posts.user_id) AS count,
users.firstname || users.lastname AS fullname,
users.id AS users_id, users.firstname AS users_firstname, users.lastname AS users_lastname
FROM users ORDER BY users.oid</pre></div></div></div></div><div class="section" id="horizontal-scaling-sharding-api"><h3><span class="yiyi-st" id="yiyi-193">&#x6C34;&#x5E73;&#x7F29;&#x653E;&#xFF08;&#x5206;&#x7247;&#xFF09;API <a class="headerlink" href="#horizontal-scaling-sharding-api" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-194">[browser&#xFF1A;/ sqlalchemy / trunk / examples / sharding / attribute_shard .py]</span></p></div><div class="section" id="sessions"><h3><span class="yiyi-st" id="yiyi-195">&#x4F1A;&#x8BDD;<a class="headerlink" href="#sessions" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h3><div class="section" id="new-session-create-paradigm-sessioncontext-assignmapper-deprecated"><h4><span class="yiyi-st" id="yiyi-196">&#x65B0;&#x4F1A;&#x8BDD;&#x521B;&#x5EFA;&#x8303;&#x5F0F;&#xFF1B; SessionContext&#xFF0C;assignmapper&#x5DF2;&#x5F03;&#x7528;<a class="headerlink" href="#new-session-create-paradigm-sessioncontext-assignmapper-deprecated" title="Permalink to this headline">&#xB6;</a></span></h4><p><span class="yiyi-st" id="yiyi-197">&#x6CA1;&#x9519;&#xFF0C;&#x6574;&#x4E2A;shebang&#x88AB;&#x4E24;&#x4E2A;&#x914D;&#x7F6E;&#x51FD;&#x6570;&#x53D6;&#x4EE3;&#x3002;</span><span class="yiyi-st" id="yiyi-198">&#x4F7F;&#x7528;&#x5B83;&#x4EEC;&#x5C06;&#x4EA7;&#x751F;&#x81EA;0.1&#x4EE5;&#x6765;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x5177;&#x6709;&#x7684;&#x6700;&#x591A;0.1sh&#x7684;&#x611F;&#x89C9;&#xFF08;&#x5373;&#xFF0C;&#x6700;&#x5C11;&#x91CF;&#x7684;&#x6253;&#x5B57;&#xFF09;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-199">&#x5728;&#x60A8;&#x5B9A;&#x4E49;<code class="docutils literal"><span class="pre">engine</span></code>&#xFF08;&#x6216;&#x4EFB;&#x4F55;&#x5730;&#x65B9;&#xFF09;&#x7684;&#x4F4D;&#x7F6E;&#x914D;&#x7F6E;&#x60A8;&#x81EA;&#x5DF1;&#x7684;<code class="docutils literal"><span class="pre">Session</span></code>&#x7C7B;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">sessionmaker</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&apos;myengine://&apos;</span><span class="p">)</span>
<span class="n">Session</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">,</span> <span class="n">autoflush</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">transactional</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># use the new Session() freely</span>
<span class="n">sess</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>
<span class="n">sess</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">someobject</span><span class="p">)</span>
<span class="n">sess</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span></pre></div></div><p><span class="yiyi-st" id="yiyi-200">&#x5982;&#x679C;&#x60A8;&#x9700;&#x8981;&#x540E;&#x671F;&#x914D;&#x7F6E;&#x4F1A;&#x8BDD;&#xFF0C;&#x8BF7;&#x4F7F;&#x7528;&#x5F15;&#x64CE;&#x8FDB;&#x884C;&#x914D;&#x7F6E;&#xFF0C;&#x7A0D;&#x540E;&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">configure()</span></code>&#x6DFB;&#x52A0;&#x5B83;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">Session</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">create_engine</span><span class="p">(</span><span class="o">...</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-201">All the behaviors of <code class="docutils literal"><span class="pre">SessionContext</span></code> and the <code class="docutils literal"><span class="pre">query</span></code> and <code class="docutils literal"><span class="pre">__init__</span></code> methods of <code class="docutils literal"><span class="pre">assignmapper</span></code> are moved into the new <code class="docutils literal"><span class="pre">scoped_session()</span></code> function, which is compatible with both <code class="docutils literal"><span class="pre">sessionmaker</span></code> as well as <code class="docutils literal"><span class="pre">create_session()</span></code>:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">scoped_session</span><span class="p">,</span> <span class="n">sessionmaker</span>

<span class="n">Session</span> <span class="o">=</span> <span class="n">scoped_session</span><span class="p">(</span><span class="n">sessionmaker</span><span class="p">(</span><span class="n">autoflush</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">transactional</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
<span class="n">Session</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>

<span class="n">u</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&apos;wendy&apos;</span><span class="p">)</span>

<span class="n">sess</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>
<span class="n">sess</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
<span class="n">sess</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<span class="c1"># Session constructor is thread-locally scoped.  Everyone gets the same</span>
<span class="c1"># Session in the thread when scope=&quot;thread&quot;.</span>
<span class="n">sess2</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">sess</span> <span class="ow">is</span> <span class="n">sess2</span></pre></div></div><p><span class="yiyi-st" id="yiyi-202">&#x5F53;&#x4F7F;&#x7528;&#x7EBF;&#x7A0B;&#x672C;&#x5730;&#x7684;<code class="docutils literal"><span class="pre">Session</span></code>&#x65F6;&#xFF0C;&#x8FD4;&#x56DE;&#x7684;&#x7C7B;&#x5C06;&#x6240;&#x6709;<code class="docutils literal"><span class="pre">Session&apos;s</span></code>&#x63A5;&#x53E3;&#x5B9E;&#x73B0;&#x4E3A;classmethods&#xFF0C;&#x5E76;&#x4E14;&#x201C;assignmapper&#x201D;&#x7684;&#x529F;&#x80FD;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">mapper</span></code></span><span class="yiyi-st" id="yiyi-203">&#x5C31;&#x50CF;&#x65E7;&#x7684;<code class="docutils literal"><span class="pre">objectstore</span></code>&#x5929;......</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># &quot;assignmapper&quot;-like functionality available via ScopedSession.mapper</span>
<span class="n">Session</span><span class="o">.</span><span class="n">mapper</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">users_table</span><span class="p">)</span>

<span class="n">u</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&apos;wendy&apos;</span><span class="p">)</span>

<span class="n">Session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></pre></div></div></div><div class="section" id="sessions-are-again-weak-referencing-by-default"><h4><span class="yiyi-st" id="yiyi-204">&#x4F1A;&#x8BDD;&#x518D;&#x6B21;&#x9ED8;&#x8BA4;&#x4E3A;&#x5F31;&#x5F15;&#x7528;<a class="headerlink" href="#sessions-are-again-weak-referencing-by-default" title="Permalink to this headline">&#xB6;</a></span></h4><p><span class="yiyi-st" id="yiyi-205">&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;Session&#x4E2D;&#x7684;weak_identity_map&#x6807;&#x5FD7;&#x73B0;&#x5728;&#x8BBE;&#x7F6E;&#x4E3A;<code class="docutils literal"><span class="pre">True</span></code>&#x3002;</span><span class="yiyi-st" id="yiyi-206">&#x81EA;&#x52A8;&#x4ECE;&#x4F1A;&#x8BDD;&#x4E2D;&#x5220;&#x9664;&#x5916;&#x90E8;&#x63A8;&#x65AD;&#x548C;&#x8D85;&#x51FA;&#x8303;&#x56F4;&#x7684;&#x5B9E;&#x4F8B;&#x3002;</span><span class="yiyi-st" id="yiyi-207">&#x4F46;&#x662F;&#xFF0C;&#x5B58;&#x5728;&#x201C;&#x810F;&#x201D;&#x53D8;&#x5316;&#x7684;&#x9879;&#x76EE;&#x5C06;&#x4FDD;&#x6301;&#x5F3A;&#x5F15;&#x7528;&#x72B6;&#x6001;&#xFF0C;&#x76F4;&#x5230;&#x8FD9;&#x4E9B;&#x53D8;&#x5316;&#x88AB;&#x5237;&#x65B0;&#x4E3A;&#x6B62;&#xFF0C;&#x6B64;&#x65F6;&#x5BF9;&#x8C61;&#x5C06;&#x6062;&#x590D;&#x4E3A;&#x5F31;&#x5F15;&#x7528;&#xFF08;&#x8FD9;&#x5BF9;&apos;&#x53EF;&#x53D8;&apos;&#x7C7B;&#x578B;&#x4E5F;&#x9002;&#x7528;&#xFF0C;&#x5982;&#x53EF;&#x9009;&#x5C5E;&#x6027;&#xFF09;&#x3002;</span><span class="yiyi-st" id="yiyi-208">&#x5C06;weak_identity_map&#x8BBE;&#x7F6E;&#x4E3A;<code class="docutils literal"><span class="pre">False</span></code>&#x4E3A;&#x4F7F;&#x7528;&#x4F1A;&#x8BDD;&#x7684;&#x7528;&#x6237;&#x6062;&#x590D;&#x65E7;&#x7684;&#x5F3A;&#x5F15;&#x7528;&#x884C;&#x4E3A;&#xFF0C;&#x5982;&#x7F13;&#x5B58;&#x3002;</span></p></div><div class="section" id="auto-transactional-sessions"><h4><span class="yiyi-st" id="yiyi-209">&#x81EA;&#x52A8;&#x4E8B;&#x52A1;&#x4F1A;&#x8BDD;<a class="headerlink" href="#auto-transactional-sessions" title="Permalink to this headline">&#xB6;</a></span></h4><p><span class="yiyi-st" id="yiyi-210">&#x6B63;&#x5982;&#x60A8;&#x53EF;&#x80FD;&#x5DF2;&#x7ECF;&#x6CE8;&#x610F;&#x5230;&#x7684;&#x90A3;&#x6837;&#xFF0C;&#x6211;&#x4EEC;&#x6B63;&#x5728;<code class="docutils literal"><span class="pre">Session</span></code>&#x4E0A;&#x8C03;&#x7528;<code class="docutils literal"><span class="pre">commit()</span></code>&#x3002;</span><span class="yiyi-st" id="yiyi-211">&#x6807;&#x5FD7;<code class="docutils literal"><span class="pre">transactional=True</span></code>&#x8868;&#x793A;<code class="docutils literal"><span class="pre">Session</span></code>&#x603B;&#x662F;&#x5728;&#x4E8B;&#x52A1;&#x4E2D;&#xFF0C;<code class="docutils literal"><span class="pre">commit()</span></code>&#x6C38;&#x4E45;&#x4FDD;&#x5B58;&#x3002;</span></p></div><div class="section" id="auto-flushing-sessions"><h4><span class="yiyi-st" id="yiyi-212">&#x81EA;&#x52A8;&#x5237;&#x65B0;&#x4F1A;&#x8BDD;<a class="headerlink" href="#auto-flushing-sessions" title="Permalink to this headline">&#xB6;</a></span></h4><p><span class="yiyi-st" id="yiyi-213">Also, <code class="docutils literal"><span class="pre">autoflush=True</span></code> means the <code class="docutils literal"><span class="pre">Session</span></code> will <code class="docutils literal"><span class="pre">flush()</span></code> before each <code class="docutils literal"><span class="pre">query</span></code> as well as when you call <code class="docutils literal"><span class="pre">flush()</span></code> or <code class="docutils literal"><span class="pre">commit()</span></code>. </span><span class="yiyi-st" id="yiyi-214">&#x6240;&#x4EE5;&#x73B0;&#x5728;&#x8FD9;&#x5C06;&#x5DE5;&#x4F5C;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">Session</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">,</span> <span class="n">autoflush</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">transactional</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">u</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&apos;wendy&apos;</span><span class="p">)</span>

<span class="n">sess</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>
<span class="n">sess</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>

<span class="c1"># wendy is flushed, comes right back from a query</span>
<span class="n">wendy</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&apos;wendy&apos;</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span></pre></div></div></div><div class="section" id="transactional-methods-moved-onto-sessions"><h4><span class="yiyi-st" id="yiyi-215">&#x4E8B;&#x52A1;&#x65B9;&#x6CD5;&#x5DF2;&#x79FB;&#x81F3;&#x4F1A;&#x8BDD;<a class="headerlink" href="#transactional-methods-moved-onto-sessions" title="Permalink to this headline">&#xB6;</a></span></h4><p><span class="yiyi-st" id="yiyi-216"><code class="docutils literal"><span class="pre">commit()</span></code>&#x548C;<code class="docutils literal"><span class="pre">rollback()</span></code>&#xFF0C;&#x4EE5;&#x53CA;<code class="docutils literal"><span class="pre">begin()</span></code>&#x73B0;&#x5728;&#x76F4;&#x63A5;&#x5728;<code class="docutils literal"><span class="pre">Session</span></code>&#x4E0A;&#x3002;</span><span class="yiyi-st" id="yiyi-217">&#x4E0D;&#x9700;&#x8981;&#x4E3A;&#x4EFB;&#x4F55;&#x4E8B;&#x60C5;&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">SessionTransaction</span></code>&#xFF08;&#x5B83;&#x4ECD;&#x7136;&#x5728;&#x540E;&#x53F0;&#xFF09;&#x3002;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">Session</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">autoflush</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">transactional</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">sess</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>
<span class="n">sess</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span>

<span class="c1"># use the session</span>

<span class="n">sess</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span> <span class="c1"># commit transaction</span></pre></div></div><p><span class="yiyi-st" id="yiyi-218">&#x4E0E;&#x5C01;&#x95ED;&#x7684;&#x5F15;&#x64CE;&#x7EA7;&#x522B;&#xFF08;&#x5373;&#x975E;ORM&#xFF09;&#x4E8B;&#x52A1;&#x5171;&#x4EAB;<code class="docutils literal"><span class="pre">Session</span></code>&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">Session</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">autoflush</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">transactional</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">conn</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">trans</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span>
<span class="n">sess</span> <span class="o">=</span> <span class="n">Session</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">conn</span><span class="p">)</span>

<span class="c1"># ... session is transactional</span>

<span class="c1"># commit the outermost transaction</span>
<span class="n">trans</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></pre></div></div></div><div class="section" id="nested-session-transactions-with-savepoint"><h4><span class="yiyi-st" id="yiyi-219">&#x4F7F;&#x7528;SAVEPOINT <a class="headerlink" href="#nested-session-transactions-with-savepoint" title="Permalink to this headline">&#xB6;</a>&#x5D4C;&#x5957;&#x4F1A;&#x8BDD;&#x4E8B;&#x52A1;</span></h4><p><span class="yiyi-st" id="yiyi-220">&#x5728;&#x5F15;&#x64CE;&#x548C;ORM&#x7EA7;&#x522B;&#x53EF;&#x7528;&#x3002;</span><span class="yiyi-st" id="yiyi-221">ORM&#x6587;&#x6863;&#x5230;&#x76EE;&#x524D;&#x4E3A;&#x6B62;&#xFF1A;</span></p><p><span class="yiyi-st" id="yiyi-222"><a class="reference external" href="http://www.sqlalchemy.org/docs/04/session.html#unitofwork_ma">http://www.sqlalchemy.org/docs/04/session.html#unitofwork_ma</a> naging</span></p></div><div class="section" id="two-phase-commit-sessions"><h4><span class="yiyi-st" id="yiyi-223">&#x4E24;&#x9636;&#x6BB5;&#x63D0;&#x4EA4;&#x4F1A;&#x8BDD;<a class="headerlink" href="#two-phase-commit-sessions" title="Permalink to this headline">&#xB6;</a></span></h4><p><span class="yiyi-st" id="yiyi-224">&#x5728;&#x5F15;&#x64CE;&#x548C;ORM&#x7EA7;&#x522B;&#x53EF;&#x7528;&#x3002;</span><span class="yiyi-st" id="yiyi-225">ORM&#x6587;&#x6863;&#x5230;&#x76EE;&#x524D;&#x4E3A;&#x6B62;&#xFF1A;</span></p><p><span class="yiyi-st" id="yiyi-226"><a class="reference external" href="http://www.sqlalchemy.org/docs/04/session.html#unitofwork_ma">http://www.sqlalchemy.org/docs/04/session.html#unitofwork_ma</a> naging</span></p></div></div><div class="section" id="inheritance"><h3><span class="yiyi-st" id="yiyi-227">&#x7EE7;&#x627F;<a class="headerlink" href="#inheritance" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h3><div class="section" id="polymorphic-inheritance-with-no-joins-or-unions"><h4><span class="yiyi-st" id="yiyi-228">&#x65E0;&#x8FDE;&#x63A5;&#x6216;&#x8054;&#x5408;&#x7684;&#x591A;&#x6001;&#x7EE7;&#x627F;<a class="headerlink" href="#polymorphic-inheritance-with-no-joins-or-unions" title="Permalink to this headline">&#xB6;</a></span></h4><p><span class="yiyi-st" id="yiyi-229">&#x65B0;&#x7684;&#x7EE7;&#x627F;&#x6587;&#x6863;&#xFF1A;<a class="reference external" href="http://www.sqlalchemy.org/docs/04">http://www.sqlalchemy.org/docs/04</a> /mappers.html#advdatamapping_mapper_inheritance_joined</span></p></div><div class="section" id="better-polymorphic-behavior-with-get"><h4><span class="yiyi-st" id="yiyi-230">&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">get()</span></code> <a class="headerlink" href="#better-polymorphic-behavior-with-get" title="Permalink to this headline">&#xB6;</a>&#x66F4;&#x597D;&#x5730;&#x8FDB;&#x884C;&#x591A;&#x6001;&#x884C;&#x4E3A;</span></h4><p><span class="yiyi-st" id="yiyi-231">&#x8FDE;&#x63A5;&#x8868;&#x7EE7;&#x627F;&#x5C42;&#x6B21;&#x7ED3;&#x6784;&#x4E2D;&#x7684;&#x6240;&#x6709;&#x7C7B;&#x90FD;&#x4F7F;&#x7528;&#x57FA;&#x7C7B;&#x83B7;&#x53D6;<code class="docutils literal"><span class="pre">_instance_key</span></code>&#xFF0C;&#x5373;<code class="docutils literal"><span class="pre">&#xFF08;BaseClass&#xFF0C;</span> <span class="pre">&#xFF08;1&#xFF0C;</span> <span class="pre">&#xFF09;&#xFF0C;</span> <span class="pre">&#x65E0;&#xFF09;</span></code>&#x3002;</span><span class="yiyi-st" id="yiyi-232">&#x901A;&#x8FC7;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#xFF0C;&#x5F53;&#x60A8;&#x9488;&#x5BF9;&#x57FA;&#x7C7B;&#x8C03;&#x7528;<code class="docutils literal"><span class="pre">get()</span></code> a <code class="docutils literal"><span class="pre">Query</span></code>&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x5F53;&#x524D;&#x6807;&#x8BC6;&#x6620;&#x5C04;&#x4E2D;&#x67E5;&#x627E;&#x5B50;&#x7C7B;&#x5B9E;&#x4F8B;&#xFF0C;&#x800C;&#x65E0;&#x9700;&#x67E5;&#x8BE2;&#x6570;&#x636E;&#x5E93;&#x3002;</span></p></div></div><div class="section" id="types"><h3><span class="yiyi-st" id="yiyi-233">&#x7C7B;&#x578B;<a class="headerlink" href="#types" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h3><div class="section" id="custom-subclasses-of-sqlalchemy-types-typedecorator"><h4><span class="yiyi-st" id="yiyi-234"><code class="docutils literal"><span class="pre">sqlalchemy.types.TypeDecorator</span></code> <a class="headerlink" href="#custom-subclasses-of-sqlalchemy-types-typedecorator" title="Permalink to this headline">&#xB6;</a></span></h4><p><span class="yiyi-st" id="yiyi-235">&#x6709;&#x4E00;&#x4E2A;&#x7528;&#x4E8E;&#x5B50;&#x7C7B;&#x5316;TypeDecorator&#x7684;<a class="reference external" href="http://www.sqlalchemy.org/docs/04/types.html#types_custom">&#x65B0;API</a>&#x3002;</span><span class="yiyi-st" id="yiyi-236">&#x5728;&#x67D0;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#x4F7F;&#x7528;0.3 API&#x4F1A;&#x5BFC;&#x81F4;&#x7F16;&#x8BD1;&#x9519;&#x8BEF;&#x3002;</span></p></div></div></div><div class="section" id="sql-expressions"><h2><span class="yiyi-st" id="yiyi-237">SQL&#x8868;&#x8FBE;&#x5F0F;<a class="headerlink" href="#sql-expressions" title="Permalink to this headline">&#xB6;</a></span></h2><div class="section" id="all-new-deterministic-label-alias-generation"><h3><span class="yiyi-st" id="yiyi-238">&#x5168;&#x65B0;&#xFF0C;&#x786E;&#x5B9A;&#x6027;&#x6807;&#x7B7E;/&#x522B;&#x540D;&#x751F;&#x6210;<a class="headerlink" href="#all-new-deterministic-label-alias-generation" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-239">&#x6240;&#x6709;&#x201C;&#x533F;&#x540D;&#x201D;&#x6807;&#x7B7E;&#x548C;&#x522B;&#x540D;&#x73B0;&#x5728;&#x90FD;&#x4F7F;&#x7528;&#x7B80;&#x5355;&#x7684;<name>_ <number>&#x683C;&#x5F0F;&#x3002;  T1&gt;  T0&gt;</number></name></span><span class="yiyi-st" id="yiyi-240">SQL&#x66F4;&#x5BB9;&#x6613;&#x9605;&#x8BFB;&#xFF0C;&#x5E76;&#x4E0E;&#x8BA1;&#x5212;&#x4F18;&#x5316;&#x5668;&#x7F13;&#x5B58;&#x517C;&#x5BB9;&#x3002;</span><span class="yiyi-st" id="yiyi-241">&#x8BF7;&#x67E5;&#x770B;&#x6559;&#x7A0B;&#x4E2D;&#x7684;&#x4E00;&#x4E9B;&#x793A;&#x4F8B;&#xFF1A;<a class="reference external" href="http://www.sqlalchemy.org/docs/04/ormtutorial.html">http://www.sqlalchemy.org/docs/04/ormtutorial.html</a> <a class="reference external" href="http://www.sqlalchemy.org/docs/04/sqlexpression.html">http://www.sqlalchemy.org/docs/ 04 / sqlexpression.html  T1&gt;</a></span></p></div><div class="section" id="generative-select-constructs"><h3><span class="yiyi-st" id="yiyi-242">&#x751F;&#x6210;select()&#x6784;&#x9020;<a class="headerlink" href="#generative-select-constructs" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-243">&#x8FD9;&#x7EDD;&#x5BF9;&#x662F;&#x901A;&#x8FC7;<code class="docutils literal"><span class="pre">select()</span></code>&#x8FDB;&#x884C;&#x7684;&#x3002;</span><span class="yiyi-st" id="yiyi-244">&#x8BF7;&#x53C2;&#x9605;htt p&#xFF1A;//www.sqlalchemy.org/docs/04/sqlexpression.html#sql_transf orm&#x3002;</span></p></div><div class="section" id="new-operator-system"><h3><span class="yiyi-st" id="yiyi-245">&#x65B0;&#x7684;&#x64CD;&#x4F5C;&#x5458;&#x7CFB;&#x7EDF;<a class="headerlink" href="#new-operator-system" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-246">SQL&#x8FD0;&#x7B97;&#x7B26;&#x548C;&#x6216;&#x591A;&#x6216;&#x5C11;&#x6BCF;&#x4E2A;SQL&#x5173;&#x952E;&#x5B57;&#x90FD;&#x88AB;&#x62BD;&#x8C61;&#x5230;&#x7F16;&#x8BD1;&#x5668;&#x5C42;&#x3002;</span><span class="yiyi-st" id="yiyi-247">&#x4ED6;&#x4EEC;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x667A;&#x80FD;&#x5730;&#x64CD;&#x4F5C;&#xFF0C;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x8BC6;&#x522B;&#x7C7B;&#x578B;/&#x540E;&#x7AEF;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;&#xFF1A;<a class="reference external" href="http://www.sq">http&#xFF1A;//www.sq</a> lalchemy.org/docs/04/sqlexpression.html#sql_operators</span></p></div><div class="section" id="all-type-keyword-arguments-renamed-to-type"><h3><span class="yiyi-st" id="yiyi-248">&#x6240;&#x6709;<code class="docutils literal"><span class="pre">type</span></code>&#x5173;&#x952E;&#x5B57;&#x53C2;&#x6570;&#x91CD;&#x547D;&#x540D;&#x4E3A;<code class="docutils literal"><span class="pre">type_</span></code> <a class="headerlink" href="#all-type-keyword-arguments-renamed-to-type" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-249">&#x5C31;&#x50CF;&#x5B83;&#x8BF4;&#x7684;&#x90A3;&#x6837;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">bindparam</span><span class="p">(</span><span class="s1">&apos;foo&apos;</span><span class="p">,</span> <span class="n">type_</span><span class="o">=</span><span class="n">String</span><span class="p">)</span></pre></div></div></div><div class="section" id="in-function-changed-to-accept-sequence-or-selectable"><h3><span class="yiyi-st" id="yiyi-250">in_&#x51FD;&#x6570;&#x66F4;&#x6539;&#x4E3A;&#x63A5;&#x53D7;&#x5E8F;&#x5217;&#x6216;&#x53EF;&#x9009;<a class="headerlink" href="#in-function-changed-to-accept-sequence-or-selectable" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-251">in_&#x51FD;&#x6570;&#x73B0;&#x5728;&#x5C06;&#x4E00;&#x7CFB;&#x5217;&#x503C;&#x6216;&#x53EF;&#x9009;&#x503C;&#x4F5C;&#x4E3A;&#x5176;&#x552F;&#x4E00;&#x53C2;&#x6570;&#x3002;</span><span class="yiyi-st" id="yiyi-252">&#x4EE5;&#x524D;&#x4F20;&#x5165;&#x503C;&#x4F5C;&#x4E3A;&#x4F4D;&#x7F6E;&#x53C2;&#x6570;&#x7684;API&#x4ECD;&#x7136;&#x6709;&#x6548;&#xFF0C;&#x4F46;&#x73B0;&#x5728;&#x5DF2;&#x88AB;&#x5F03;&#x7528;&#x3002;</span><span class="yiyi-st" id="yiyi-253">&#x8FD9;&#x610F;&#x5473;&#x7740;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>my_table.select(my_table.c.id.in_(1,2,3)
my_table.select(my_table.c.id.in_(*listOfIds)</pre></div></div><p><span class="yiyi-st" id="yiyi-254">&#x5E94;&#x6539;&#x4E3A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>my_table.select(my_table.c.id.in_([1,2,3])
my_table.select(my_table.c.id.in_(listOfIds)</pre></div></div></div></div><div class="section" id="schema-and-reflection"><h2><span class="yiyi-st" id="yiyi-255">&#x67B6;&#x6784;&#x548C;&#x53CD;&#x601D;<a class="headerlink" href="#schema-and-reflection" title="Permalink to this headline">&#xB6;</a></span></h2><div class="section" id="metadata-boundmetadata-dynamicmetadata"><h3><span class="yiyi-st" id="yiyi-256"><code class="docutils literal"><span class="pre">MetaData</span></code>, <code class="docutils literal"><span class="pre">BoundMetaData</span></code>, <code class="docutils literal"><span class="pre">DynamicMetaData</span></code>...<a class="headerlink" href="#metadata-boundmetadata-dynamicmetadata" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-257">&#x5728;0.3.x&#x7CFB;&#x5217;&#x4E2D;&#xFF0C;&#x4E0D;&#x8D5E;&#x6210;&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">MetaData</span></code>&#x548C;<code class="docutils literal"><span class="pre">ThreadLocalMetaData</span></code>&#x7684;<code class="docutils literal"><span class="pre">BoundMetaData</span></code>&#x548C;<code class="docutils literal"><span class="pre">DynamicMetaData</span></code>&#x3002;</span><span class="yiyi-st" id="yiyi-258">0.4&#x7684;&#x65E7;&#x540D;&#x79F0;&#x5DF2;&#x88AB;&#x5220;&#x9664;&#x3002;</span><span class="yiyi-st" id="yiyi-259">&#x66F4;&#x65B0;&#x5F88;&#x7B80;&#x5355;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>+-------------------------------------+-------------------------+
|If You Had                           | Now Use                 |
+=====================================+=========================+
| ``MetaData``                        | ``MetaData``            |
+-------------------------------------+-------------------------+
| ``BoundMetaData``                   | ``MetaData``            |
+-------------------------------------+-------------------------+
| ``DynamicMetaData`` (with one       | ``MetaData``            |
| engine or threadlocal=False)        |                         |
+-------------------------------------+-------------------------+
| ``DynamicMetaData``                 | ``ThreadLocalMetaData`` |
| (with different engines per thread) |                         |
+-------------------------------------+-------------------------+</pre></div></div><p><span class="yiyi-st" id="yiyi-260"><code class="docutils literal"><span class="pre">MetaData</span></code>&#x7C7B;&#x578B;&#x7684;&#x5F88;&#x5C11;&#x4F7F;&#x7528;&#x7684;<code class="docutils literal"><span class="pre">name</span></code>&#x53C2;&#x6570;&#x5DF2;&#x88AB;&#x5220;&#x9664;&#x3002;</span><span class="yiyi-st" id="yiyi-261"><code class="docutils literal"><span class="pre">ThreadLocalMetaData</span></code>&#x6784;&#x9020;&#x51FD;&#x6570;&#x73B0;&#x5728;&#x4E0D;&#x5E26;&#x4EFB;&#x4F55;&#x53C2;&#x6570;&#x3002;</span><span class="yiyi-st" id="yiyi-262">&#x73B0;&#x5728;&#x8FD9;&#x4E24;&#x79CD;&#x7C7B;&#x578B;&#x90FD;&#x53EF;&#x4EE5;&#x7ED1;&#x5B9A;&#x5230;<code class="docutils literal"><span class="pre">Engine</span></code>&#x6216;&#x5355;&#x4E2A;<code class="docutils literal"><span class="pre">Connection</span></code>&#x3002;</span></p></div><div class="section" id="one-step-multi-table-reflection"><h3><span class="yiyi-st" id="yiyi-263">&#x4E00;&#x6B65;&#x591A;&#x8868;&#x53CD;&#x5C04;<a class="headerlink" href="#one-step-multi-table-reflection" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-264">&#x60A8;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x52A0;&#x8F7D;&#x8868;&#x5B9A;&#x4E49;&#xFF0C;&#x5E76;&#x901A;&#x8FC7;&#x4E00;&#x6B21;&#x4F20;&#x9012;&#x4ECE;&#x6574;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#x6216;&#x6A21;&#x5F0F;&#x81EA;&#x52A8;&#x521B;&#x5EFA;<code class="docutils literal"><span class="pre">Table</span></code>&#x5BF9;&#x8C61;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">metadata</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">(</span><span class="n">myengine</span><span class="p">,</span> <span class="n">reflect</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">metadata</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="go">[&apos;table_a&apos;, &apos;table_b&apos;, &apos;table_c&apos;, &apos;...&apos;]</span></pre></div></div><p><span class="yiyi-st" id="yiyi-265"><code class="docutils literal"><span class="pre">MetaData</span></code> also gains a <code class="docutils literal"><span class="pre">.reflect()</span></code> method enabling finer control over the loading process, including specification of a subset of available tables to load.</span></p></div></div><div class="section" id="sql-execution"><h2><span class="yiyi-st" id="yiyi-266">SQL&#x6267;&#x884C;<a class="headerlink" href="#sql-execution" title="Permalink to this headline">&#xB6;</a></span></h2><div class="section" id="engine-connectable-and-bind-to-are-all-now-bind"><h3><span class="yiyi-st" id="yiyi-267"><code class="docutils literal"><span class="pre">engine</span></code>, <code class="docutils literal"><span class="pre">connectable</span></code>, and <code class="docutils literal"><span class="pre">bind_to</span></code> are all now <code class="docutils literal"><span class="pre">bind</span></code><a class="headerlink" href="#engine-connectable-and-bind-to-are-all-now-bind" title="Permalink to this headline">&#xB6;</a></span></h3></div><div class="section" id="transactions-nestedtransactions-and-twophasetransactions"><h3><span class="yiyi-st" id="yiyi-268"><code class="docutils literal"><span class="pre">Transactions</span></code>&#xFF0C;<code class="docutils literal"><span class="pre">NestedTransactions</span></code>&#x548C;<code class="docutils literal"><span class="pre">TwoPhaseTransactions</span></code> <a class="headerlink" href="#transactions-nestedtransactions-and-twophasetransactions" title="Permalink to this headline">&#xB6;</a></span></h3></div><div class="section" id="connection-pool-events"><h3><span class="yiyi-st" id="yiyi-269">&#x8FDE;&#x63A5;&#x6C60;&#x4E8B;&#x4EF6;<a class="headerlink" href="#connection-pool-events" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-270">&#x8FDE;&#x63A5;&#x6C60;&#x73B0;&#x5728;&#x4F1A;&#x5728;&#x521B;&#x5EFA;&#x65B0;&#x7684;DB-API&#x8FDE;&#x63A5;&#x65F6;&#x89E6;&#x53D1;&#x4E8B;&#x4EF6;&#xFF0C;&#x68C0;&#x51FA;&#x5E76;&#x68C0;&#x5165;&#x6C60;&#x4E2D;&#x3002;</span><span class="yiyi-st" id="yiyi-271">&#x4F8B;&#x5982;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5B83;&#x4EEC;&#x5728;&#x65B0;&#x8FDE;&#x63A5;&#x4E0A;&#x6267;&#x884C;&#x4F1A;&#x8BDD;&#x8303;&#x56F4;&#x7684;SQL&#x5B89;&#x88C5;&#x8BED;&#x53E5;&#x3002;</span></p></div><div class="section" id="oracle-engine-fixed"><h3><span class="yiyi-st" id="yiyi-272">Oracle&#x5F15;&#x64CE;&#x5DF2;&#x4FEE;&#x590D;<a class="headerlink" href="#oracle-engine-fixed" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-273">&#x5728;0.3.11&#x4E2D;&#xFF0C;Oracle&#x5F15;&#x64CE;&#x4E2D;&#x5B58;&#x5728;&#x5173;&#x4E8E;&#x5982;&#x4F55;&#x5904;&#x7406;&#x4E3B;&#x952E;&#x7684;&#x9519;&#x8BEF;&#x3002;</span><span class="yiyi-st" id="yiyi-274">&#x8FD9;&#x4E9B;&#x9519;&#x8BEF;&#x53EF;&#x80FD;&#x4F1A;&#x5BFC;&#x81F4;&#x5728;&#x5176;&#x4ED6;&#x5F15;&#x64CE;&#xFF08;&#x5982;sqlite&#xFF09;&#x4E2D;&#x6B63;&#x5E38;&#x5DE5;&#x4F5C;&#x7684;&#x7A0B;&#x5E8F;&#x5728;&#x4F7F;&#x7528;Oracle&#x5F15;&#x64CE;&#x65F6;&#x5931;&#x8D25;&#x3002;</span><span class="yiyi-st" id="yiyi-275">&#x5728;0.4&#x7248;&#x672C;&#x4E2D;&#xFF0C;Oracle&#x5F15;&#x64CE;&#x5DF2;&#x7ECF;&#x8FC7;&#x4FEE;&#x6539;&#xFF0C;&#x4FEE;&#x590D;&#x4E86;&#x8FD9;&#x4E9B;&#x4E3B;&#x952E;&#x95EE;&#x9898;&#x3002;</span></p></div><div class="section" id="out-parameters-for-oracle"><h3><span class="yiyi-st" id="yiyi-276">Oracle&#x7684;&#x8F93;&#x51FA;&#x53C2;&#x6570;<a class="headerlink" href="#out-parameters-for-oracle" title="Permalink to this headline">&#xB6;</a></span></h3><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">text</span><span class="p">(</span><span class="s2">&quot;begin foo(:x, :y, :z); end;&quot;</span><span class="p">,</span> <span class="n">bindparams</span><span class="o">=</span><span class="p">[</span><span class="n">bindparam</span><span class="p">(</span><span class="s1">&apos;x&apos;</span><span class="p">,</span> <span class="n">Numeric</span><span class="p">),</span> <span class="n">outparam</span><span class="p">(</span><span class="s1">&apos;y&apos;</span><span class="p">,</span> <span class="n">Numeric</span><span class="p">),</span> <span class="n">outparam</span><span class="p">(</span><span class="s1">&apos;z&apos;</span><span class="p">,</span> <span class="n">Numeric</span><span class="p">)]),</span> <span class="n">x</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">out_parameters</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&apos;y&apos;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&apos;z&apos;</span><span class="p">:</span><span class="mi">75</span><span class="p">}</span></pre></div></div></div><div class="section" id="connection-bound-metadata-sessions"><h3><span class="yiyi-st" id="yiyi-277">&#x8FDE;&#x63A5;&#x7ED1;&#x5B9A;<code class="docutils literal"><span class="pre">MetaData</span></code>&#xFF0C;<code class="docutils literal"><span class="pre">Sessions</span></code> <a class="headerlink" href="#connection-bound-metadata-sessions" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-278"><code class="docutils literal"><span class="pre">MetaData</span></code> and <code class="docutils literal"><span class="pre">Session</span></code> can be explicitly bound to a connection:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">conn</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">sess</span> <span class="o">=</span> <span class="n">create_session</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">conn</span><span class="p">)</span></pre></div></div></div><div class="section" id="faster-more-foolproof-resultproxy-objects"><h3><span class="yiyi-st" id="yiyi-279">&#x66F4;&#x5FEB;&#xFF0C;&#x66F4;&#x5B89;&#x5168;<code class="docutils literal"><span class="pre">ResultProxy</span></code>&#x5BF9;&#x8C61;<a class="headerlink" href="#faster-more-foolproof-resultproxy-objects" title="Permalink to this headline">&#xB6;</a></span></h3></div></div>