<h1><span class="yiyi-st" id="yiyi-95">SQLAlchemy 0.9&#x6709;&#x54EA;&#x4E9B;&#x65B0;&#x7279;&#x6027;&#xFF1F;<a class="headerlink" href="#what-s-new-in-sqlalchemy-0-9" title="Permalink to this headline">&#xB6;</a></span></h1><div class="admonition-about-this-document admonition"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-96">&#x5173;&#x4E8E;&#x672C;&#x6587;&#x6863;</span></p><p><span class="yiyi-st" id="yiyi-97">&#x672C;&#x6587;&#x6863;&#x4ECB;&#x7ECD;&#x4E86;2013&#x5E74;5&#x6708;&#x53D1;&#x5E03;&#x7684;SQLAlchemy&#x7248;&#x672C;0.8&#x548C;2013&#x5E74;12&#x6708;30&#x65E5;&#x53D1;&#x5E03;&#x7684;SQLAlchemy 0.9&#x7248;&#x672C;&#x4E4B;&#x95F4;&#x7684;&#x66F4;&#x6539;&#x3002;</span></p><p class="last"><span class="yiyi-st" id="yiyi-98">&#x6587;&#x4EF6;&#x6700;&#x540E;&#x66F4;&#x65B0;&#x65E5;&#x671F;&#xFF1A;2015&#x5E74;6&#x6708;10&#x65E5;</span></p></div><div class="section" id="introduction"><h2><span class="yiyi-st" id="yiyi-99">&#x5F15;&#x8A00;<a class="headerlink" href="#introduction" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h2><p><span class="yiyi-st" id="yiyi-100">&#x672C;&#x6307;&#x5357;&#x4ECB;&#x7ECD;&#x4E86;SQLAlchemy 0.9&#x7248;&#x4E2D;&#x7684;&#x65B0;&#x589E;&#x529F;&#x80FD;&#xFF0C;&#x5E76;&#x4ECB;&#x7ECD;&#x4E86;&#x5F71;&#x54CD;&#x7528;&#x6237;&#x5C06;&#x5176;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4ECE;0.8&#x7CFB;&#x5217;SQLAlchemy&#x8FC1;&#x79FB;&#x5230;0.9&#x7684;&#x66F4;&#x6539;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-101">&#x8BF7;&#x4ED4;&#x7EC6;&#x67E5;&#x770B;<a class="reference internal" href="#behavioral-changes-orm-09"><span>Behavioral Changes - ORM</span></a>&#x548C;<a class="reference internal" href="#behavioral-changes-core-09"><span>Behavioral Changes - Core</span></a>&#x4EE5;&#x4E86;&#x89E3;&#x6F5C;&#x5728;&#x7684;&#x5411;&#x540E;&#x4E0D;&#x517C;&#x5BB9;&#x53D8;&#x66F4;&#x3002;</span></p></div><div class="section" id="platform-support"><h2><span class="yiyi-st" id="yiyi-102">&#x5E73;&#x53F0;&#x652F;&#x6301;<a class="headerlink" href="#platform-support" title="Permalink to this headline">&#xB6;</a></span></h2><div class="section" id="targeting-python-2-6-and-up-now-python-3-without-2to3"><h3><span class="yiyi-st" id="yiyi-103">&#x9488;&#x5BF9;Python 2.6&#x53CA;&#x66F4;&#x9AD8;&#x7248;&#x672C;&#xFF0C;Python 3&#x65E0;2to3 <a class="headerlink" href="#targeting-python-2-6-and-up-now-python-3-without-2to3" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-104">0.9&#x7248;&#x672C;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x6210;&#x5C31;&#x662F;&#x6D88;&#x9664;&#x4E86;&#x5BF9;Python 3&#x517C;&#x5BB9;&#x6027;&#x7684;2to3&#x5DE5;&#x5177;&#x7684;&#x4F9D;&#x8D56;&#x3002;</span><span class="yiyi-st" id="yiyi-105">&#x4E3A;&#x4E86;&#x66F4;&#x7B80;&#x5355;&#x660E;&#x4E86;&#xFF0C;&#x73B0;&#x5728;&#x6700;&#x4F4E;&#x7248;&#x672C;&#x7684;Python&#x7248;&#x672C;&#x662F;2.6&#xFF0C;&#x5B83;&#x5177;&#x6709;&#x4E0E;Python 3&#x7684;&#x5E7F;&#x6CDB;&#x517C;&#x5BB9;&#x6027;&#x3002;</span><span class="yiyi-st" id="yiyi-106">&#x73B0;&#x5728;&#x6240;&#x6709;&#x7684;SQLAlchemy&#x6A21;&#x5757;&#x548C;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x90FD;&#x53EF;&#x4EE5;&#x7528;2.6&#x524D;&#x5411;&#x7248;&#x7684;&#x4EFB;&#x4F55;Python&#x89E3;&#x91CA;&#x5668;&#x89E3;&#x91CA;&#xFF0C;&#x5305;&#x62EC;3.1&#x548C;3.2&#x89E3;&#x91CA;&#x5668;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-107"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2671">&#xFF03;2671  T0&gt;</a></span></p></div><div class="section" id="c-extensions-supported-on-python-3"><h3><span class="yiyi-st" id="yiyi-108">Python 3&#x652F;&#x6301;&#x7684;C&#x6269;&#x5C55;<a class="headerlink" href="#c-extensions-supported-on-python-3" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-109">C&#x6269;&#x5C55;&#x5DF2;&#x7ECF;&#x79FB;&#x690D;&#x5230;&#x652F;&#x6301;Python 3&#xFF0C;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x5728;Python 2&#x548C;Python 3&#x73AF;&#x5883;&#x4E2D;&#x6784;&#x5EFA;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-110"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2161">&#xFF03;2161  T0&gt;</a></span></p></div></div><div class="section" id="behavioral-changes-orm"><h2><span class="yiyi-st" id="yiyi-111">&#x884C;&#x4E3A;&#x6539;&#x53D8; -  ORM <a class="headerlink" href="#behavioral-changes-orm" title="Permalink to this headline">&#xB6;</a></span></h2><div class="section" id="composite-attributes-are-now-returned-as-their-object-form-when-queried-on-a-per-attribute-basis"><h3><span class="yiyi-st" id="yiyi-112">&#x5F53;&#x4EE5;&#x6BCF;&#x4E2A;&#x5C5E;&#x6027;&#x4E3A;&#x57FA;&#x7840;&#x67E5;&#x8BE2;&#x65F6;&#xFF0C;&#x590D;&#x5408;&#x5C5E;&#x6027;&#x73B0;&#x5728;&#x4EE5;&#x5176;&#x5BF9;&#x8C61;&#x5F62;&#x5F0F;&#x8FD4;&#x56DE;<a class="headerlink" href="#composite-attributes-are-now-returned-as-their-object-form-when-queried-on-a-per-attribute-basis" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-113">&#x5C06;<a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query" title="sqlalchemy.orm.query.Query"><code class="xref py py-class docutils literal"><span class="pre">Query</span></code></a>&#x4E0E;&#x590D;&#x5408;&#x5C5E;&#x6027;&#x7ED3;&#x5408;&#x4F7F;&#x7528;&#x73B0;&#x5728;&#x8FD4;&#x56DE;&#x7531;&#x8BE5;&#x590D;&#x5408;&#x7269;&#x7EF4;&#x62A4;&#x7684;&#x5BF9;&#x8C61;&#x7C7B;&#x578B;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5206;&#x89E3;&#x4E3A;&#x5355;&#x72EC;&#x7684;&#x5217;&#x3002;</span><span class="yiyi-st" id="yiyi-114">&#x5728;<a class="reference internal" href="orm_composites.html#mapper-composite"><span>Composite Column Types</span></a>&#x4E2D;&#x4F7F;&#x7528;&#x6620;&#x5C04;&#x8BBE;&#x7F6E;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Vertex</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">Vertex</span><span class="o">.</span><span class="n">end</span><span class="p">)</span><span class="o">.</span>\
<span class="gp">... </span>    <span class="nb">filter</span><span class="p">(</span><span class="n">Vertex</span><span class="o">.</span><span class="n">start</span> <span class="o">==</span> <span class="n">Point</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="go">[(Point(x=3, y=4), Point(x=5, y=6))]</span></pre></div></div><p><span class="yiyi-st" id="yiyi-115">&#x6B64;&#x66F4;&#x6539;&#x4E0E;&#x4EE3;&#x7801;&#x4E2D;&#x7684;&#x540E;&#x5411;&#x4E0D;&#x517C;&#x5BB9;&#xFF0C;&#x8BE5;&#x4EE3;&#x7801;&#x9700;&#x8981;&#x5C06;&#x5355;&#x4E2A;&#x5C5E;&#x6027;&#x6269;&#x5C55;&#x4E3A;&#x5355;&#x4E2A;&#x5217;&#x3002;</span><span class="yiyi-st" id="yiyi-116">&#x8981;&#x83B7;&#x5F97;&#x8BE5;&#x884C;&#x4E3A;&#xFF0C;&#x8BF7;&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">.clauses</span></code>&#x8BBF;&#x95EE;&#x5668;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Vertex</span><span class="o">.</span><span class="n">start</span><span class="o">.</span><span class="n">clauses</span><span class="p">,</span> <span class="n">Vertex</span><span class="o">.</span><span class="n">end</span><span class="o">.</span><span class="n">clauses</span><span class="p">)</span><span class="o">.</span>\
<span class="gp">... </span>    <span class="nb">filter</span><span class="p">(</span><span class="n">Vertex</span><span class="o">.</span><span class="n">start</span> <span class="o">==</span> <span class="n">Point</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="go">[(3, 4, 5, 6)]</span></pre></div></div><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-117">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-118"><a class="reference internal" href="#change-2824"><span>Column Bundles for ORM queries</span></a></span></p></div><p><span class="yiyi-st" id="yiyi-119"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2824">&#xFF03;2824  T0&gt;</a></span></p></div><div class="section" id="query-select-from-no-longer-applies-the-clause-to-corresponding-entities"><h3><span class="yiyi-st" id="yiyi-120"><a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query.select_from" title="sqlalchemy.orm.query.Query.select_from"><code class="xref py py-meth docutils literal"><span class="pre">Query.select_from()</span></code></a>&#x4E0D;&#x518D;&#x5C06;&#x8BE5;&#x5B50;&#x53E5;&#x5E94;&#x7528;&#x4E8E;&#x76F8;&#x5E94;&#x7684;&#x5B9E;&#x4F53;<a class="headerlink" href="#query-select-from-no-longer-applies-the-clause-to-corresponding-entities" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-121">&#x5728;&#x6700;&#x8FD1;&#x7684;&#x7248;&#x672C;&#x4E2D;&#xFF0C;<a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query.select_from" title="sqlalchemy.orm.query.Query.select_from"><code class="xref py py-meth docutils literal"><span class="pre">Query.select_from()</span></code></a>&#x65B9;&#x6CD5;&#x4F5C;&#x4E3A;&#x63A7;&#x5236;<a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query" title="sqlalchemy.orm.query.Query"><code class="xref py py-class docutils literal"><span class="pre">Query</span></code></a>&#x5BF9;&#x8C61;&#x201C;&#x4ECE;&#x4E2D;&#x9009;&#x62E9;&#x201D;&#x7684;&#x7B2C;&#x4E00;&#x4EF6;&#x4E8B;&#x7684;&#x624B;&#x6BB5;&#x5DF2;&#x7ECF;&#x666E;&#x53CA;&#xFF0C;&#x901A;&#x5E38;&#x7528;&#x4E8E;&#x63A7;&#x5236;JOIN&#x5C06;&#x5982;&#x4F55;&#x5448;&#x73B0;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-122">&#x6839;&#x636E;&#x901A;&#x5E38;&#x7684;<code class="docutils literal"><span class="pre">User</span></code>&#x6620;&#x200B;&#x200B;&#x5C04;&#x8003;&#x8651;&#x4EE5;&#x4E0B;&#x793A;&#x4F8B;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">select_stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">User</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">()</span>

<span class="n">q</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span>\
           <span class="n">join</span><span class="p">(</span><span class="n">select_stmt</span><span class="p">,</span> <span class="n">User</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">select_stmt</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span>\
           <span class="nb">filter</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&apos;ed&apos;</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-123">&#x4E0A;&#x9762;&#x7684;&#x8BED;&#x53E5;&#x53EF;&#x9884;&#x6D4B;&#x5730;&#x5448;&#x73B0;&#x5982;&#x4E0B;&#x7684;SQL&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT &quot;user&quot;.id AS user_id, &quot;user&quot;.name AS user_name
FROM &quot;user&quot; JOIN (SELECT &quot;user&quot;.id AS id, &quot;user&quot;.name AS name
FROM &quot;user&quot;
WHERE &quot;user&quot;.id = :id_1) AS anon_1 ON &quot;user&quot;.id = anon_1.id
WHERE &quot;user&quot;.name = :name_1</pre></div></div><p><span class="yiyi-st" id="yiyi-124">&#x5982;&#x679C;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x98A0;&#x5012;JOIN&#x7684;&#x5DE6;&#x4FA7;&#x548C;&#x53F3;&#x4FA7;&#x5143;&#x7D20;&#x7684;&#x987A;&#x5E8F;&#xFF0C;&#x6587;&#x6863;&#x5C06;&#x5BFC;&#x81F4;&#x6211;&#x4EEC;&#x76F8;&#x4FE1;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query.select_from" title="sqlalchemy.orm.query.Query.select_from"><code class="xref py py-meth docutils literal"><span class="pre">Query.select_from()</span></code></a>&#x6765;&#x6267;&#x884C;&#x6B64;&#x64CD;&#x4F5C;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">q</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span>\
        <span class="n">select_from</span><span class="p">(</span><span class="n">select_stmt</span><span class="p">)</span><span class="o">.</span>\
        <span class="n">join</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">User</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">select_stmt</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span>\
        <span class="nb">filter</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&apos;ed&apos;</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-125">However, in version 0.8 and earlier, the above use of <a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query.select_from" title="sqlalchemy.orm.query.Query.select_from"><code class="xref py py-meth docutils literal"><span class="pre">Query.select_from()</span></code></a> would apply the <code class="docutils literal"><span class="pre">select_stmt</span></code> to <strong>replace</strong> the <code class="docutils literal"><span class="pre">User</span></code> entity, as it selects from the <code class="docutils literal"><span class="pre">user</span></code> table which is compatible with <code class="docutils literal"><span class="pre">User</span></code>:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>-- SQLAlchemy 0.8 and earlier...
SELECT anon_1.id AS anon_1_id, anon_1.name AS anon_1_name
FROM (SELECT &quot;user&quot;.id AS id, &quot;user&quot;.name AS name
FROM &quot;user&quot;
WHERE &quot;user&quot;.id = :id_1) AS anon_1 JOIN &quot;user&quot; ON anon_1.id = anon_1.id
WHERE anon_1.name = :name_1</pre></div></div><p><span class="yiyi-st" id="yiyi-126">The above statement is a mess, the ON clause refers <code class="docutils literal"><span class="pre">anon_1.id</span> <span class="pre">=</span> <span class="pre">anon_1.id</span></code>, our WHERE clause has been replaced with <code class="docutils literal"><span class="pre">anon_1</span></code> as well.</span></p><p><span class="yiyi-st" id="yiyi-127">&#x8FD9;&#x79CD;&#x884C;&#x4E3A;&#x662F;&#x975E;&#x5E38;&#x6709;&#x610F;&#x7684;&#xFF0C;&#x4F46;&#x662F;&#x4E0E;<a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query.select_from" title="sqlalchemy.orm.query.Query.select_from"><code class="xref py py-meth docutils literal"><span class="pre">Query.select_from()</span></code></a>&#x6D41;&#x884C;&#x7684;&#x7528;&#x4F8B;&#x6709;&#x4E0D;&#x540C;&#x7684;&#x7528;&#x4F8B;&#x3002;</span><span class="yiyi-st" id="yiyi-128">&#x4E0A;&#x8FF0;&#x884C;&#x4E3A;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x79F0;&#x4E3A;<a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query.select_entity_from" title="sqlalchemy.orm.query.Query.select_entity_from"><code class="xref py py-meth docutils literal"><span class="pre">Query.select_entity_from()</span></code></a>&#x7684;&#x65B0;&#x65B9;&#x6CD5;&#x4F7F;&#x7528;&#x3002;</span><span class="yiyi-st" id="yiyi-129">&#x8FD9;&#x662F;&#x4E00;&#x79CD;&#x8F83;&#x5C11;&#x4F7F;&#x7528;&#x7684;&#x884C;&#x4E3A;&#xFF0C;&#x5728;&#x73B0;&#x4EE3;SQLAlchemy&#x4E2D;&#x5927;&#x81F4;&#x7B49;&#x4EF7;&#x4E8E;&#x4ECE;&#x5B9A;&#x5236;&#x7684;<a class="reference internal" href="orm_query.html#sqlalchemy.orm.aliased" title="sqlalchemy.orm.aliased"><code class="xref py py-func docutils literal"><span class="pre">aliased()</span></code></a>&#x7ED3;&#x6784;&#x4E2D;&#x8FDB;&#x884C;&#x9009;&#x62E9;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">select_stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">User</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">user_from_stmt</span> <span class="o">=</span> <span class="n">aliased</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">select_stmt</span><span class="o">.</span><span class="n">alias</span><span class="p">())</span>

<span class="n">q</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">user_from_stmt</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">user_from_stmt</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&apos;ed&apos;</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-130">&#x56E0;&#x6B64;&#xFF0C;&#x5BF9;&#x4E8E;SQLAlchemy 0.9&#xFF0C;&#x6211;&#x4EEC;&#x4ECE;<code class="docutils literal"><span class="pre">select_stmt</span></code>&#x4E2D;&#x9009;&#x62E9;&#x7684;&#x67E5;&#x8BE2;&#x4EA7;&#x751F;&#x4E86;&#x6211;&#x4EEC;&#x671F;&#x671B;&#x7684;SQL&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>-- SQLAlchemy 0.9
SELECT &quot;user&quot;.id AS user_id, &quot;user&quot;.name AS user_name
FROM (SELECT &quot;user&quot;.id AS id, &quot;user&quot;.name AS name
FROM &quot;user&quot;
WHERE &quot;user&quot;.id = :id_1) AS anon_1 JOIN &quot;user&quot; ON &quot;user&quot;.id = id
WHERE &quot;user&quot;.name = :name_1</pre></div></div><p><span class="yiyi-st" id="yiyi-131">The <a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query.select_entity_from" title="sqlalchemy.orm.query.Query.select_entity_from"><code class="xref py py-meth docutils literal"><span class="pre">Query.select_entity_from()</span></code></a> method will be available in SQLAlchemy <strong>0.8.2</strong>, so applications which rely on the old behavior can transition to this method first, ensure all tests continue to function, then upgrade to 0.9 without issue.</span></p><p><span class="yiyi-st" id="yiyi-132"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2736">&#xFF03;2736  T0&gt;</a></span></p></div><div class="section" id="viewonly-true-on-relationship-prevents-history-from-taking-effect"><h3><span class="yiyi-st" id="yiyi-133"><code class="docutils literal"><span class="pre">viewonly=True</span></code> on <code class="docutils literal"><span class="pre">relationship()</span></code> prevents history from taking effect<a class="headerlink" href="#viewonly-true-on-relationship-prevents-history-from-taking-effect" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-134"><a class="reference internal" href="orm_relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#x4E0A;&#x7684;<code class="docutils literal"><span class="pre">viewonly</span></code>&#x6807;&#x5FD7;&#x7528;&#x4E8E;&#x9632;&#x6B62;&#x66F4;&#x6539;&#x76EE;&#x6807;&#x5C5E;&#x6027;&#x5728;&#x5237;&#x65B0;&#x8FC7;&#x7A0B;&#x4E2D;&#x4EA7;&#x751F;&#x4EFB;&#x4F55;&#x6548;&#x679C;&#x3002;</span><span class="yiyi-st" id="yiyi-135">&#x8FD9;&#x662F;&#x901A;&#x8FC7;&#x6D88;&#x9664;&#x5237;&#x65B0;&#x671F;&#x95F4;&#x7684;&#x5C5E;&#x6027;&#x6765;&#x5B9E;&#x73B0;&#x7684;&#x3002;</span><span class="yiyi-st" id="yiyi-136">&#x4F46;&#x662F;&#xFF0C;&#x76F4;&#x5230;&#x73B0;&#x5728;&#xFF0C;&#x5BF9;&#x8BE5;&#x5C5E;&#x6027;&#x7684;&#x66F4;&#x6539;&#x4ECD;&#x7136;&#x4F1A;&#x5C06;&#x7236;&#x5BF9;&#x8C61;&#x6CE8;&#x518C;&#x4E3A;&#x201C;&#x810F;&#x201D;&#x5E76;&#x89E6;&#x53D1;&#x6F5C;&#x5728;&#x7684;&#x5237;&#x65B0;&#x3002;</span><span class="yiyi-st" id="yiyi-137">&#x73B0;&#x5728;&#x7684;&#x53D8;&#x5316;&#x662F;&#xFF0C;<code class="docutils literal"><span class="pre">viewonly</span></code>&#x6807;&#x5FD7;&#x73B0;&#x5728;&#x4E5F;&#x7981;&#x6B62;&#x4E3A;&#x76EE;&#x6807;&#x5C5E;&#x6027;&#x8BBE;&#x7F6E;&#x5386;&#x53F2;&#x8BB0;&#x5F55;&#x3002;</span><span class="yiyi-st" id="yiyi-138">&#x50CF;backrefs&#x548C;&#x7528;&#x6237;&#x5B9A;&#x4E49;&#x4E8B;&#x4EF6;&#x7684;&#x5C5E;&#x6027;&#x4E8B;&#x4EF6;&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x7EE7;&#x7EED;&#x6B63;&#x5E38;&#x8FD0;&#x884C;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-139">&#x66F4;&#x6539;&#x8BF4;&#x660E;&#x5982;&#x4E0B;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">,</span> <span class="n">create_engine</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">backref</span><span class="p">,</span> <span class="n">relationship</span><span class="p">,</span> <span class="n">Session</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">inspect</span>

<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;a&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;b&apos;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">a_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;a.id&apos;</span><span class="p">))</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="n">backref</span><span class="p">(</span><span class="s2">&quot;bs&quot;</span><span class="p">,</span> <span class="n">viewonly</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>

<span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;sqlite://&quot;</span><span class="p">)</span>
<span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">B</span><span class="p">()</span>

<span class="n">sess</span> <span class="o">=</span> <span class="n">Session</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="n">sess</span><span class="o">.</span><span class="n">add_all</span><span class="p">([</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">])</span>
<span class="n">sess</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<span class="n">b</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">a</span>

<span class="k">assert</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">sess</span><span class="o">.</span><span class="n">dirty</span>

<span class="c1"># before 0.9.0</span>
<span class="c1"># assert a in sess.dirty</span>
<span class="c1"># assert inspect(a).attrs.bs.history.has_changes()</span>

<span class="c1"># after 0.9.0</span>
<span class="k">assert</span> <span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sess</span><span class="o">.</span><span class="n">dirty</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">inspect</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">bs</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">has_changes</span><span class="p">()</span></pre></div></div><p><span class="yiyi-st" id="yiyi-140"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2833">&#xFF03;2833  T0&gt;</a></span></p></div><div class="section" id="association-proxy-sql-expression-improvements-and-fixes"><h3><span class="yiyi-st" id="yiyi-141">&#x5173;&#x8054;&#x4EE3;&#x7406;SQL&#x8868;&#x8FBE;&#x5F0F;&#x6539;&#x8FDB;&#x548C;&#x4FEE;&#x590D;<a class="headerlink" href="#association-proxy-sql-expression-improvements-and-fixes" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-142">&#x7531;&#x5F15;&#x7528;&#x6807;&#x91CF;&#x5173;&#x7CFB;&#x4E0A;&#x7684;&#x6807;&#x91CF;&#x503C;&#x7684;&#x5173;&#x8054;&#x4EE3;&#x7406;&#x5B9E;&#x73B0;&#x7684;<code class="docutils literal"><span class="pre">==</span></code>&#x548C;<code class="docutils literal"><span class="pre">!=</span></code>&#x8FD0;&#x7B97;&#x7B26;&#x73B0;&#x5728;&#x751F;&#x6210;&#x66F4;&#x5B8C;&#x6574;&#x7684;SQL&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x65E8;&#x5728;&#x8003;&#x8651;&#x5F53;&#x6BD4;&#x8F83;&#x662F;&#x9488;&#x5BF9;<code class="docutils literal"><span class="pre">None</span></code>&#x65F6;&#xFF0C;&#x201C;&#x5173;&#x8054;&#x201D;&#x884C;&#x662F;&#x5426;&#x5B58;&#x5728;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-143">&#x8003;&#x8651;&#x8FD9;&#x4E2A;&#x6620;&#x5C04;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;a&apos;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">b_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;b.id&apos;</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">)</span>
    <span class="n">b_value</span> <span class="o">=</span> <span class="n">association_proxy</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;b&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-144">&#x901A;&#x8FC7;0.8&#xFF0C;&#x67E5;&#x8BE2;&#x5982;&#x4E0B;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">b_value</span> <span class="o">==</span> <span class="bp">None</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></pre></div></div><p><span class="yiyi-st" id="yiyi-145">&#x4F1A;&#x4EA7;&#x751F;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT a.id AS a_id, a.b_id AS a_b_id
FROM a
WHERE EXISTS (SELECT 1
FROM b
WHERE b.id = a.b_id AND b.value IS NULL)</pre></div></div><p><span class="yiyi-st" id="yiyi-146">&#x5728;0.9&#x4E2D;&#xFF0C;&#x5B83;&#x73B0;&#x5728;&#x4EA7;&#x751F;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT a.id AS a_id, a.b_id AS a_b_id
FROM a
WHERE (EXISTS (SELECT 1
FROM b
WHERE b.id = a.b_id AND b.value IS NULL)) OR a.b_id IS NULL</pre></div></div><p><span class="yiyi-st" id="yiyi-147">&#x4E0D;&#x540C;&#x4E4B;&#x5904;&#x5728;&#x4E8E;&#xFF0C;&#x5B83;&#x4E0D;&#x4EC5;&#x68C0;&#x67E5;<code class="docutils literal"><span class="pre">b.value</span></code>&#xFF0C;&#x8FD8;&#x68C0;&#x67E5;<code class="docutils literal"><span class="pre">a</span></code>&#x662F;&#x5426;&#x6839;&#x672C;&#x4E0D;&#x6307;&#x5411;<code class="docutils literal"><span class="pre">b</span></code>&#x884C;&#x3002;</span><span class="yiyi-st" id="yiyi-148">&#x8FD9;&#x5C06;&#x8FD4;&#x56DE;&#x4E0E;&#x5148;&#x524D;&#x7248;&#x672C;&#x4E0D;&#x540C;&#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x5BF9;&#x4E8E;&#x4F7F;&#x7528;&#x6B64;&#x7C7B;&#x6BD4;&#x8F83;&#x7684;&#x7CFB;&#x7EDF;&#xFF0C;&#x5176;&#x4E2D;&#x67D0;&#x4E9B;&#x7236;&#x884C;&#x6CA1;&#x6709;&#x5173;&#x8054;&#x884C;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-149">&#x66F4;&#x5173;&#x952E;&#x7684;&#x662F;&#xFF0C;&#x4E3A;<code class="docutils literal"><span class="pre">A.b_value</span> <span class="pre">&#xFF01;=</span> <span class="pre">&#x65E0;</span></code>&#x53D1;&#x51FA;&#x6B63;&#x786E;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#x3002;</span><span class="yiyi-st" id="yiyi-150">&#x5728;0.8&#x4E2D;&#xFF0C;&#x5BF9;&#x4E8E;&#x6CA1;&#x6709;<code class="docutils literal"><span class="pre">b</span></code>&#x7684;<code class="docutils literal"><span class="pre">A</span></code>&#x884C;&#xFF0C;&#x8FD9;&#x5C06;&#x8FD4;&#x56DE;<code class="docutils literal"><span class="pre">True</span></code>&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT a.id AS a_id, a.b_id AS a_b_id
FROM a
WHERE NOT (EXISTS (SELECT 1
FROM b
WHERE b.id = a.b_id AND b.value IS NULL))</pre></div></div><p><span class="yiyi-st" id="yiyi-151">&#x73B0;&#x5728;&#x5728;0.9&#x4E2D;&#xFF0C;&#x68C0;&#x67E5;&#x5DF2;&#x88AB;&#x91CD;&#x65B0;&#x7F16;&#x8BD1;&#xFF0C;&#x4EE5;&#x786E;&#x4FDD;A.b_id&#x884C;&#x5B58;&#x5728;&#xFF0C;&#x9664;&#x4E86;<code class="docutils literal"><span class="pre">B.value</span></code>&#x4E3A;&#x975E;NULL&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT a.id AS a_id, a.b_id AS a_b_id
FROM a
WHERE EXISTS (SELECT 1
FROM b
WHERE b.id = a.b_id AND b.value IS NOT NULL)</pre></div></div><p><span class="yiyi-st" id="yiyi-152">&#x6B64;&#x5916;&#xFF0C;&#x8FD8;&#x589E;&#x5F3A;&#x4E86;<code class="docutils literal"><span class="pre">has()</span></code>&#x8FD0;&#x7B97;&#x7B26;&#xFF0C;&#x4EE5;&#x4FBF;&#x60A8;&#x53EF;&#x4EE5;&#x5728;&#x4E0D;&#x4F7F;&#x7528;&#x6807;&#x51C6;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x5C06;&#x5176;&#x79F0;&#x4E3A;&#x6807;&#x91CF;&#x5217;&#x503C;&#xFF0C;&#x5E76;&#x4E14;&#x5B83;&#x4F1A;&#x751F;&#x6210;&#x68C0;&#x67E5;&#x5B58;&#x5728;&#x6216;&#x4E0D;&#x5B58;&#x5728;&#x7684;&#x5173;&#x8054;&#x884C;&#x7684;&#x6761;&#x4EF6;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">b_value</span><span class="o">.</span><span class="n">has</span><span class="p">())</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></pre></div></div><p><span class="yiyi-st" id="yiyi-153">&#x8F93;&#x51FA;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT a.id AS a_id, a.b_id AS a_b_id
FROM a
WHERE EXISTS (SELECT 1
FROM b
WHERE b.id = a.b_id)</pre></div></div><p><span class="yiyi-st" id="yiyi-154">&#x8FD9;&#x76F8;&#x5F53;&#x4E8E;<code class="docutils literal"><span class="pre">A.b.has()</span></code>&#xFF0C;&#x4F46;&#x5141;&#x8BB8;&#x76F4;&#x63A5;&#x5BF9;<code class="docutils literal"><span class="pre">b_value</span></code>&#x8FDB;&#x884C;&#x67E5;&#x8BE2;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-155"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2751">&#xFF03;2751  T0&gt;</a></span></p></div><div class="section" id="association-proxy-missing-scalar-returns-none"><h3><span class="yiyi-st" id="yiyi-156">&#x5173;&#x8054;&#x4EE3;&#x7406;&#x4E22;&#x5931;&#x6807;&#x91CF;&#x8FD4;&#x56DE;&#x65E0;<a class="headerlink" href="#association-proxy-missing-scalar-returns-none" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-157">&#x5982;&#x679C;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;&#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x5219;&#x4ECE;&#x6807;&#x91CF;&#x5C5E;&#x6027;&#x5230;&#x6807;&#x91CF;&#x7684;&#x5173;&#x8054;&#x4EE3;&#x7406;&#x73B0;&#x5728;&#x5C06;&#x8FD4;&#x56DE;<code class="docutils literal"><span class="pre">None</span></code>&#x3002;</span><span class="yiyi-st" id="yiyi-158">&#x8FD9;&#x4E0E;&#x5728;SQLAlchemy&#x4E2D;&#x7F3A;&#x5C11;&#x591A;&#x5BF9;&#x4E00;&#x8FD4;&#x56DE;None&#x7684;&#x4E8B;&#x5B9E;&#x4E00;&#x81F4;&#xFF0C;&#x6240;&#x4EE5;&#x5E94;&#x8BE5;&#x4F7F;&#x7528;&#x4EE3;&#x7406;&#x503C;&#x3002;</span><span class="yiyi-st" id="yiyi-159">&#x4F8B;&#x5982;&#x3002;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.associationproxy</span> <span class="kn">import</span> <span class="n">association_proxy</span>

<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;a&apos;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="n">uselist</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="n">bname</span> <span class="o">=</span> <span class="n">association_proxy</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;b&apos;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">a_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;a.id&apos;</span><span class="p">))</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>

<span class="n">a1</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>

<span class="c1"># this is how m2o&apos;s always have worked</span>
<span class="k">assert</span> <span class="n">a1</span><span class="o">.</span><span class="n">b</span> <span class="ow">is</span> <span class="bp">None</span>

<span class="c1"># but prior to 0.9, this would raise AttributeError,</span>
<span class="c1"># now returns None just like the proxied value.</span>
<span class="k">assert</span> <span class="n">a1</span><span class="o">.</span><span class="n">bname</span> <span class="ow">is</span> <span class="bp">None</span></pre></div></div><p><span class="yiyi-st" id="yiyi-160"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2810">&#xFF03;2810  T0&gt;</a></span></p></div><div class="section" id="attributes-get-history-will-query-from-the-db-by-default-if-value-not-present"><h3><span class="yiyi-st" id="yiyi-161">&#x5982;&#x679C;&#x503C;&#x4E0D;&#x5B58;&#x5728;&#xFF0C;attributes.get_history()&#x5C06;&#x9ED8;&#x8BA4;&#x4ECE;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x67E5;&#x8BE2;<a class="headerlink" href="#attributes-get-history-will-query-from-the-db-by-default-if-value-not-present" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-162">A bugfix regarding <a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.attributes.get_history" title="sqlalchemy.orm.attributes.get_history"><code class="xref py py-func docutils literal"><span class="pre">attributes.get_history()</span></code></a> allows a column-based attribute to query out to the database for an unloaded value, assuming the <code class="docutils literal"><span class="pre">passive</span></code> flag is left at its default of <code class="docutils literal"><span class="pre">PASSIVE_OFF</span></code>. </span><span class="yiyi-st" id="yiyi-163">&#x4EE5;&#x524D;&#xFF0C;&#x8FD9;&#x4E2A;&#x6807;&#x5FD7;&#x4E0D;&#x4F1A;&#x88AB;&#x5151;&#x73B0;&#x3002;</span><span class="yiyi-st" id="yiyi-164">&#x6B64;&#x5916;&#xFF0C;&#x6DFB;&#x52A0;&#x4E86;&#x4E00;&#x4E2A;&#x65B0;&#x65B9;&#x6CD5;<a class="reference internal" href="orm_internals.html#sqlalchemy.orm.state.AttributeState.load_history" title="sqlalchemy.orm.state.AttributeState.load_history"><code class="xref py py-meth docutils literal"><span class="pre">AttributeState.load_history()</span></code></a>&#x4EE5;&#x8865;&#x5145;<a class="reference internal" href="orm_internals.html#sqlalchemy.orm.state.AttributeState.history" title="sqlalchemy.orm.state.AttributeState.history"><code class="xref py py-attr docutils literal"><span class="pre">AttributeState.history</span></code></a>&#x5C5E;&#x6027;&#xFF0C;&#x8BE5;&#x5C5E;&#x6027;&#x5C06;&#x4E3A;&#x672A;&#x52A0;&#x8F7D;&#x5C5E;&#x6027;&#x53D1;&#x51FA;&#x52A0;&#x8F7D;&#x5668;&#x53EF;&#x8C03;&#x7528;&#x5BF9;&#x8C61;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-165">&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5C0F;&#x5C0F;&#x7684;&#x53D8;&#x5316;&#xFF0C;&#x6F14;&#x793A;&#x5982;&#x4E0B;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">create_engine</span><span class="p">,</span> <span class="n">inspect</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">Session</span><span class="p">,</span> <span class="n">attributes</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>

<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;a&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>

<span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;sqlite://&quot;</span><span class="p">,</span> <span class="n">echo</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="n">sess</span> <span class="o">=</span> <span class="n">Session</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="n">a1</span> <span class="o">=</span> <span class="n">A</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&apos;a1&apos;</span><span class="p">)</span>
<span class="n">sess</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span>
<span class="n">sess</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>  <span class="c1"># a1 is now expired</span>

<span class="c1"># history doesn&apos;t emit loader callables</span>
<span class="k">assert</span> <span class="n">inspect</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">history</span> <span class="o">==</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

<span class="c1"># in 0.8, this would fail to load the unloaded state.</span>
<span class="k">assert</span> <span class="n">attributes</span><span class="o">.</span><span class="n">get_history</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="s1">&apos;data&apos;</span><span class="p">)</span> <span class="o">==</span> <span class="p">((),</span> <span class="p">[</span><span class="s1">&apos;a1&apos;</span><span class="p">,],</span> <span class="p">())</span>

<span class="c1"># load_history() is now equiavlent to get_history() with</span>
<span class="c1"># passive=PASSIVE_OFF ^ INIT_OK</span>
<span class="k">assert</span> <span class="n">inspect</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">load_history</span><span class="p">()</span> <span class="o">==</span> <span class="p">((),</span> <span class="p">[</span><span class="s1">&apos;a1&apos;</span><span class="p">,],</span> <span class="p">())</span></pre></div></div><p><span class="yiyi-st" id="yiyi-166"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2787">&#xFF03;2787  T0&gt;</a></span></p></div></div><div class="section" id="behavioral-changes-core"><h2><span class="yiyi-st" id="yiyi-167">&#x884C;&#x4E3A;&#x6539;&#x53D8; - &#x6838;&#x5FC3;<a class="headerlink" href="#behavioral-changes-core" title="Permalink to this headline">&#xB6;</a></span></h2><div class="section" id="type-objects-no-longer-accept-ignored-keyword-arguments"><h3><span class="yiyi-st" id="yiyi-168">&#x7C7B;&#x578B;&#x5BF9;&#x8C61;&#x4E0D;&#x518D;&#x63A5;&#x53D7;&#x88AB;&#x5FFD;&#x7565;&#x7684;&#x5173;&#x952E;&#x5B57;&#x53C2;&#x6570;<a class="headerlink" href="#type-objects-no-longer-accept-ignored-keyword-arguments" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-169">&#x901A;&#x8FC7;0.8&#x7CFB;&#x5217;&#xFF0C;&#x5927;&#x591A;&#x6570;&#x7C7B;&#x578B;&#x7684;&#x5BF9;&#x8C61;&#x63A5;&#x53D7;&#x4E86;&#x88AB;&#x9ED8;&#x9ED8;&#x5FFD;&#x7565;&#x7684;&#x4EFB;&#x610F;&#x5173;&#x952E;&#x5B57;&#x53C2;&#x6570;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Date</span><span class="p">,</span> <span class="n">Integer</span>

<span class="c1"># storage_format argument here has no effect on any backend;</span>
<span class="c1"># it needs to be on the SQLite-specific type</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">Date</span><span class="p">(</span><span class="n">storage_format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(day)02d</span><span class="s2">.</span><span class="si">%(month)02d</span><span class="s2">.</span><span class="si">%(year)04d</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># display_width argument here has no effect on any backend;</span>
<span class="c1"># it needs to be on the MySQL-specific type</span>
<span class="n">i</span> <span class="o">=</span> <span class="n">Integer</span><span class="p">(</span><span class="n">display_width</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-170">&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x53E4;&#x8001;&#x7684;bug&#xFF0C;&#x4E3A;0.8&#x7CFB;&#x5217;&#x6DFB;&#x52A0;&#x4E86;&#x5F03;&#x7528;&#x8B66;&#x544A;&#xFF0C;&#x4F46;&#x56E0;&#x4E3A;&#x6CA1;&#x6709;&#x4EBA;&#x7528;&#x201C;-W&#x201D;&#x6807;&#x5FD7;&#x8FD0;&#x884C;Python&#xFF0C;&#x6240;&#x4EE5;&#x5927;&#x90E8;&#x5206;&#x90FD;&#x6CA1;&#x6709;&#x770B;&#x5230;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>$ python -W always::DeprecationWarning ~/dev/sqlalchemy/test.py
/Users/classic/dev/sqlalchemy/test.py:5: SADeprecationWarning: Passing arguments to
type object constructor &lt;class &apos;sqlalchemy.types.Date&apos;&gt; is deprecated
  d = Date(storage_format=&quot;%(day)02d.%(month)02d.%(year)04d&quot;)
/Users/classic/dev/sqlalchemy/test.py:9: SADeprecationWarning: Passing arguments to
type object constructor &lt;class &apos;sqlalchemy.types.Integer&apos;&gt; is deprecated
  i = Integer(display_width=5)</pre></div></div><p><span class="yiyi-st" id="yiyi-171">&#x4ECE;0.9&#x7CFB;&#x5217;&#x5F00;&#x59CB;&#xFF0C;&#x201C;catch all&#x201D;&#x6784;&#x9020;&#x51FD;&#x6570;&#x4ECE;<a class="reference internal" href="core_type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal"><span class="pre">TypeEngine</span></code></a>&#x4E2D;&#x79FB;&#x9664;&#xFF0C;&#x5E76;&#x4E14;&#x8FD9;&#x4E9B;&#x65E0;&#x610F;&#x4E49;&#x7684;&#x53C2;&#x6570;&#x4E0D;&#x518D;&#x88AB;&#x63A5;&#x53D7;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-172">&#x4F7F;&#x7528;&#x7279;&#x5B9A;&#x4E8E;&#x65B9;&#x8A00;&#x7684;&#x53C2;&#x6570;&#xFF08;&#x5982;<code class="docutils literal"><span class="pre">storage_format</span></code>&#x548C;<code class="docutils literal"><span class="pre">display_width</span></code>&#xFF09;&#x7684;&#x6B63;&#x786E;&#x65B9;&#x6CD5;&#x662F;&#x4F7F;&#x7528;&#x9002;&#x5F53;&#x7684;&#x65B9;&#x8A00;&#x7279;&#x5B9A;&#x7C7B;&#x578B;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.dialects.sqlite</span> <span class="kn">import</span> <span class="n">DATE</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.dialects.mysql</span> <span class="kn">import</span> <span class="n">INTEGER</span>

<span class="n">d</span> <span class="o">=</span> <span class="n">DATE</span><span class="p">(</span><span class="n">storage_format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(day)02d</span><span class="s2">.</span><span class="si">%(month)02d</span><span class="s2">.</span><span class="si">%(year)04d</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">i</span> <span class="o">=</span> <span class="n">INTEGER</span><span class="p">(</span><span class="n">display_width</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-173">&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x65B9;&#x8A00;&#x4E0D;&#x53EF;&#x77E5;&#x7C7B;&#x578B;&#x7684;&#x60C5;&#x51B5;&#x5462;&#xFF1F;</span><span class="yiyi-st" id="yiyi-174">&#x6211;&#x4EEC;&#x4F7F;&#x7528;<a class="reference internal" href="core_type_api.html#sqlalchemy.types.TypeEngine.with_variant" title="sqlalchemy.types.TypeEngine.with_variant"><code class="xref py py-meth docutils literal"><span class="pre">TypeEngine.with_variant()</span></code></a>&#x65B9;&#x6CD5;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Date</span><span class="p">,</span> <span class="n">Integer</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.dialects.sqlite</span> <span class="kn">import</span> <span class="n">DATE</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.dialects.mysql</span> <span class="kn">import</span> <span class="n">INTEGER</span>

<span class="n">d</span> <span class="o">=</span> <span class="n">Date</span><span class="p">()</span><span class="o">.</span><span class="n">with_variant</span><span class="p">(</span>
        <span class="n">DATE</span><span class="p">(</span><span class="n">storage_format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(day)02d</span><span class="s2">.</span><span class="si">%(month)02d</span><span class="s2">.</span><span class="si">%(year)04d</span><span class="s2">&quot;</span><span class="p">),</span>
        <span class="s2">&quot;sqlite&quot;</span>
    <span class="p">)</span>

<span class="n">i</span> <span class="o">=</span> <span class="n">Integer</span><span class="p">()</span><span class="o">.</span><span class="n">with_variant</span><span class="p">(</span>
        <span class="n">INTEGER</span><span class="p">(</span><span class="n">display_width</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
        <span class="s2">&quot;mysql&quot;</span>
    <span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-175"><a class="reference internal" href="core_type_api.html#sqlalchemy.types.TypeEngine.with_variant" title="sqlalchemy.types.TypeEngine.with_variant"><code class="xref py py-meth docutils literal"><span class="pre">TypeEngine.with_variant()</span></code></a> isn&#x2019;t new, it was added in SQLAlchemy 0.7.2. </span><span class="yiyi-st" id="yiyi-176">&#x56E0;&#x6B64;&#xFF0C;&#x5728;0.8&#x7CFB;&#x5217;&#x4E0A;&#x8FD0;&#x884C;&#x7684;&#x4EE3;&#x7801;&#x53EF;&#x4EE5;&#x66F4;&#x6B63;&#x4E3A;&#x5728;&#x5347;&#x7EA7;&#x5230;0.9&#x4E4B;&#x524D;&#x4F7F;&#x7528;&#x6B64;&#x65B9;&#x6CD5;&#x5E76;&#x8FDB;&#x884C;&#x6D4B;&#x8BD5;&#x3002;</span></p></div><div class="section" id="none-can-no-longer-be-used-as-a-partial-and-constructor"><h3><span class="yiyi-st" id="yiyi-177"><code class="docutils literal"><span class="pre">None</span></code>&#x4E0D;&#x80FD;&#x518D;&#x7528;&#x4F5C;&#x201C;&#x90E8;&#x5206;AND&#x201D;&#x6784;&#x9020;&#x51FD;&#x6570;<a class="headerlink" href="#none-can-no-longer-be-used-as-a-partial-and-constructor" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-178"><code class="docutils literal"><span class="pre">None</span></code> can no longer be used as the &#x201C;backstop&#x201D; to form an AND condition piecemeal. </span><span class="yiyi-st" id="yiyi-179">&#x5373;&#x4F7F;&#x67D0;&#x4E9B;SQLAlchemy&#x5185;&#x90E8;&#x51FD;&#x6570;&#x4F7F;&#x7528;&#x4E86;&#x5B83;&#xFF0C;&#x8BE5;&#x6A21;&#x5F0F;&#x4E5F;&#x4E0D;&#x662F;&#x6587;&#x6863;&#x6A21;&#x5F0F;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">condition</span> <span class="o">=</span> <span class="bp">None</span>

<span class="k">for</span> <span class="n">cond</span> <span class="ow">in</span> <span class="n">conditions</span><span class="p">:</span>
    <span class="n">condition</span> <span class="o">=</span> <span class="n">condition</span> <span class="o">&amp;</span> <span class="n">cond</span>

<span class="k">if</span> <span class="n">condition</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
    <span class="n">stmt</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">condition</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-180">&#x5F53;<code class="docutils literal"><span class="pre">conditions</span></code>&#x975E;&#x7A7A;&#x65F6;&#xFF0C;&#x4E0A;&#x8FF0;&#x5E8F;&#x5217;&#x5C06;&#x5728;0.9&#x4EA7;&#x751F;<code class="docutils literal"><span class="pre">SELECT</span> <span class="pre">..</span> <span class="pre">WHERE</span> <span class="pre">&#xFF06;lt&#xFF1B; condition&#xFF06;gt&#xFF1B;</span> <span class="pre">AND <span class="pre">NULL</span></span></code>&#x3002;</span><span class="yiyi-st" id="yiyi-181"><code class="docutils literal"><span class="pre">None</span></code>&#x4E0D;&#x518D;&#x88AB;&#x9690;&#x5F0F;&#x5FFD;&#x7565;&#xFF0C;&#x800C;&#x662F;&#x4E0E;<code class="docutils literal"><span class="pre">None</span></code>&#x5728;&#x5176;&#x4ED6;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x89E3;&#x91CA;&#x65F6;&#x4E00;&#x81F4;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-182">&#x5BF9;&#x4E8E;0.8&#x548C;0.9&#xFF0C;&#x6B63;&#x786E;&#x7684;&#x4EE3;&#x7801;&#x5E94;&#x4E3A;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.sql</span> <span class="kn">import</span> <span class="n">and_</span>

<span class="k">if</span> <span class="n">conditions</span><span class="p">:</span>
    <span class="n">stmt</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">and_</span><span class="p">(</span><span class="o">*</span><span class="n">conditions</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-183">&#x53E6;&#x4E00;&#x4E2A;&#x9002;&#x7528;&#x4E8E;&#x6240;&#x6709;&#x540E;&#x7AEF;&#x7684;&#x53D8;&#x79CD;0.9&#xFF0C;&#x4F46;&#x5728;0.8&#x4E0A;&#x53EA;&#x9002;&#x7528;&#x4E8E;&#x652F;&#x6301;&#x5E03;&#x5C14;&#x5E38;&#x91CF;&#x7684;&#x540E;&#x7AEF;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.sql</span> <span class="kn">import</span> <span class="n">true</span>

<span class="n">condition</span> <span class="o">=</span> <span class="n">true</span><span class="p">()</span>

<span class="k">for</span> <span class="n">cond</span> <span class="ow">in</span> <span class="n">conditions</span><span class="p">:</span>
    <span class="n">condition</span> <span class="o">=</span> <span class="n">cond</span> <span class="o">&amp;</span> <span class="n">condition</span>

<span class="n">stmt</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">condition</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-184">&#x5728;0.8&#x4E0A;&#xFF0C;&#x8FD9;&#x5C06;&#x4EA7;&#x751F;&#x4E00;&#x4E2A;SELECT&#x8BED;&#x53E5;&#xFF0C;&#x8BE5;&#x8BED;&#x53E5;&#x5728;WHERE&#x5B50;&#x53E5;&#x4E2D;&#x603B;&#x662F;&#x6709;<code class="docutils literal"><span class="pre">AND</span> <span class="pre">true</span></code>&#xFF0C;&#x800C;&#x540E;&#x8005;&#x4E0D;&#x4F1A;&#x88AB;&#x63A5;&#x53D7;&#x652F;&#x6301;&#x5E03;&#x5C14;&#x5E38;&#x91CF;&#xFF08;MySQL&#xFF0C;MSSQL&#xFF09;&#x3002;</span><span class="yiyi-st" id="yiyi-185">&#x5728;0.9&#x4E0A;&#xFF0C;<code class="docutils literal"><span class="pre">true</span></code>&#x5E38;&#x91CF;&#x5C06;&#x88AB;&#x653E;&#x5728;<code class="docutils literal"><span class="pre">and_()</span></code>&#x8FDE;&#x63A5;&#x7B26;&#x4E2D;&#x3002;</span></p><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-186">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-187"><a class="reference internal" href="#migration-2804"><span>Improved rendering of Boolean constants, NULL constants, conjunctions</span></a>&#x7684;&#x6E32;&#x67D3;</span></p></div></div><div class="section" id="the-password-portion-of-a-create-engine-no-longer-considers-the-sign-as-an-encoded-space"><h3><span class="yiyi-st" id="yiyi-188"><code class="docutils literal"><span class="pre">create_engine()</span></code>&#x7684;&#x201C;&#x5BC6;&#x7801;&#x201D;&#x90E8;&#x5206;&#x4E0D;&#x518D;&#x5C06;<code class="docutils literal"><span class="pre">+</span></code>&#x6807;&#x8BB0;&#x89C6;&#x4E3A;&#x7F16;&#x7801;&#x7A7A;&#x95F4;<a class="headerlink" href="#the-password-portion-of-a-create-engine-no-longer-considers-the-sign-as-an-encoded-space" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-189">&#x65E0;&#x8BBA;&#x51FA;&#x4E8E;&#x4F55;&#x79CD;&#x539F;&#x56E0;&#xFF0C;Python&#x51FD;&#x6570;<code class="docutils literal"><span class="pre">unquote_plus()</span></code>&#x90FD;&#x5E94;&#x7528;&#x4E8E;URL&#x7684;&#x201C;password&#x201D;&#x5B57;&#x6BB5;&#xFF0C;&#x8FD9;&#x662F;<a class="reference external" href="http://www.ietf.org/rfc/rfc1738.txt">RFC 1738</a>&#x4E2D;&#x63CF;&#x8FF0;&#x7684;&#x7F16;&#x7801;&#x89C4;&#x5219;&#x7684;&#x9519;&#x8BEF;&#x5E94;&#x7528;&#x3002;&#x5B83;&#x4F5C;&#x4E3A;&#x52A0;&#x53F7;&#x9003;&#x8131;&#x4E86;&#x7A7A;&#x95F4;&#x3002;</span><span class="yiyi-st" id="yiyi-190">&#x73B0;&#x5728;URL&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x53EA;&#x5BF9;&#x201C;&#xFF1A;&#x200B;&#x200B;&#x201D;&#xFF0C;&#x201C;@&#x201D;&#x6216;&#x201C;/&#x201D;&#x8FDB;&#x884C;&#x7F16;&#x7801;&#xFF0C;&#x5E76;&#x4E14;&#x73B0;&#x5728;&#x4E5F;&#x5E94;&#x7528;&#x4E8E;<code class="docutils literal"><span class="pre">username</span></code>&#x548C;<code class="docutils literal"><span class="pre">password</span></code>&#x5B57;&#x6BB5;&#x4EE5;&#x524D;&#x5B83;&#x53EA;&#x9002;&#x7528;&#x4E8E;&#x5BC6;&#x7801;&#xFF09;&#x3002;</span><span class="yiyi-st" id="yiyi-191">&#x5728;&#x89E3;&#x6790;&#x65F6;&#xFF0C;&#x7F16;&#x7801;&#x5B57;&#x7B26;&#x88AB;&#x8F6C;&#x6362;&#xFF0C;&#x4F46;&#x52A0;&#x53F7;&#x548C;&#x7A7A;&#x683C;&#x6309;&#x539F;&#x6837;&#x4F20;&#x9012;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span># password: &quot;pass word + other:words&quot;
dbtype://user:pass word + other%3Awords@host/dbname

# password: &quot;apples/oranges&quot;
dbtype://username:apples%2Foranges@hostspec/database

# password: &quot;apples@oranges@@&quot;
dbtype://username:apples%40oranges%40%40@hostspec/database

# password: &apos;&apos;, username is &quot;username@&quot;
dbtype://username%40:@hostspec/database</pre></div></div><p><span class="yiyi-st" id="yiyi-192"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2873">&#xFF03;2873  T0&gt;</a></span></p></div><div class="section" id="the-precedence-rules-for-collate-have-been-changed"><h3><span class="yiyi-st" id="yiyi-193">COLLATE&#x7684;&#x4F18;&#x5148;&#x89C4;&#x5219;&#x5DF2;&#x88AB;&#x66F4;&#x6539;<a class="headerlink" href="#the-precedence-rules-for-collate-have-been-changed" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-194">&#x4EE5;&#x524D;&#xFF0C;&#x50CF;&#x4E0B;&#x9762;&#x8FD9;&#x6837;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">((</span><span class="n">column</span><span class="p">(</span><span class="s1">&apos;x&apos;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&apos;somevalue&apos;</span><span class="p">)</span><span class="o">.</span><span class="n">collate</span><span class="p">(</span><span class="s2">&quot;en_EN&quot;</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-195">&#x4F1A;&#x4EA7;&#x751F;&#x8FD9;&#x6837;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>-- 0.8 behavior
(x = :x_1) COLLATE en_EN</pre></div></div><p><span class="yiyi-st" id="yiyi-196">&#x4E0A;&#x8FF0;&#x5185;&#x5BB9;&#x88AB;MSSQL&#x8BEF;&#x89E3;&#xFF0C;&#x901A;&#x5E38;&#x4E0D;&#x662F;&#x9488;&#x5BF9;&#x4EFB;&#x4F55;&#x6570;&#x636E;&#x5E93;&#x5EFA;&#x8BAE;&#x7684;&#x8BED;&#x6CD5;&#x3002;</span><span class="yiyi-st" id="yiyi-197">&#x8BE5;&#x8868;&#x8FBE;&#x5F0F;&#x73B0;&#x5728;&#x5C06;&#x751F;&#x6210;&#x5927;&#x591A;&#x6570;&#x6570;&#x636E;&#x5E93;&#x6587;&#x6863;&#x6240;&#x8BF4;&#x660E;&#x7684;&#x8BED;&#x6CD5;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>-- 0.9 behavior
x = :x_1 COLLATE en_EN</pre></div></div><p><span class="yiyi-st" id="yiyi-198">&#x5982;&#x679C;&#x5C06;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.operators.ColumnOperators.collate" title="sqlalchemy.sql.operators.ColumnOperators.collate"><code class="xref py py-meth docutils literal"><span class="pre">collate()</span></code></a>&#x8FD0;&#x7B97;&#x7B26;&#x5E94;&#x7528;&#x4E8E;&#x53F3;&#x5217;&#xFF0C;&#x5219;&#x53EF;&#x80FD;&#x51FA;&#x73B0;&#x5411;&#x540E;&#x4E0D;&#x517C;&#x5BB9;&#x7684;&#x66F4;&#x6539;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">column</span><span class="p">(</span><span class="s1">&apos;x&apos;</span><span class="p">)</span> <span class="o">==</span> <span class="n">literal</span><span class="p">(</span><span class="s1">&apos;somevalue&apos;</span><span class="p">)</span><span class="o">.</span><span class="n">collate</span><span class="p">(</span><span class="s2">&quot;en_EN&quot;</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-199">&#x5728;0.8&#x4E2D;&#xFF0C;&#x8FD9;&#x4EA7;&#x751F;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>x = :param_1 COLLATE en_EN</pre></div></div><p><span class="yiyi-st" id="yiyi-200">&#x7136;&#x800C;&#x5728;0.9&#x4E2D;&#xFF0C;&#x73B0;&#x5728;&#x4F1A;&#x4EA7;&#x751F;&#x66F4;&#x51C6;&#x786E;&#x4F46;&#x53EF;&#x80FD;&#x4E0D;&#x662F;&#x4F60;&#x60F3;&#x8981;&#x7684;&#x5F62;&#x5F0F;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>x = (:param_1 COLLATE en_EN)</pre></div></div><p><span class="yiyi-st" id="yiyi-201">The <a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.operators.ColumnOperators.collate" title="sqlalchemy.sql.operators.ColumnOperators.collate"><code class="xref py py-meth docutils literal"><span class="pre">ColumnOperators.collate()</span></code></a> operator now works more appropriately within an <code class="docutils literal"><span class="pre">ORDER</span> <span class="pre">BY</span></code> expression as well, as a specific precedence has been given to the <code class="docutils literal"><span class="pre">ASC</span></code> and <code class="docutils literal"><span class="pre">DESC</span></code> operators which will again ensure no parentheses are generated:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># 0.8</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">column</span><span class="p">(</span><span class="s1">&apos;x&apos;</span><span class="p">)</span><span class="o">.</span><span class="n">collate</span><span class="p">(</span><span class="s1">&apos;en_EN&apos;</span><span class="p">)</span><span class="o">.</span><span class="n">desc</span><span class="p">())</span>
<span class="go">(x COLLATE en_EN) DESC</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># 0.9</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">column</span><span class="p">(</span><span class="s1">&apos;x&apos;</span><span class="p">)</span><span class="o">.</span><span class="n">collate</span><span class="p">(</span><span class="s1">&apos;en_EN&apos;</span><span class="p">)</span><span class="o">.</span><span class="n">desc</span><span class="p">())</span>
<span class="go">x COLLATE en_EN DESC</span></pre></div></div><p><span class="yiyi-st" id="yiyi-202"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2879">&#xFF03;2879  T0&gt;</a></span></p></div><div class="section" id="postgresql-create-type-x-as-enum-now-applies-quoting-to-values"><h3><span class="yiyi-st" id="yiyi-203">Postgresql CREATE TYPE <x>AS ENUM&#x73B0;&#x5728;&#x5C06;&#x5F15;&#x7528;&#x5E94;&#x7528;&#x4E8E;&#x503C;<a class="headerlink" href="#postgresql-create-type-x-as-enum-now-applies-quoting-to-values" title="Permalink to this headline">&#xB6;</a></x></span></h3><p><span class="yiyi-st" id="yiyi-204">&#x73B0;&#x5728;&#xFF0C;<a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.ENUM" title="sqlalchemy.dialects.postgresql.ENUM"><code class="xref py py-class docutils literal"><span class="pre">postgresql.ENUM</span></code></a>&#x7C7B;&#x578B;&#x5C06;&#x5BF9;&#x679A;&#x4E3E;&#x503C;&#x4E2D;&#x7684;&#x5355;&#x5F15;&#x53F7;&#x8FDB;&#x884C;&#x8F6C;&#x4E49;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy.dialects</span> <span class="kn">import</span> <span class="n">postgresql</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span> <span class="o">=</span> <span class="n">postgresql</span><span class="o">.</span><span class="n">ENUM</span><span class="p">(</span><span class="s1">&apos;one&apos;</span><span class="p">,</span> <span class="s1">&apos;two&apos;</span><span class="p">,</span> <span class="s2">&quot;three&apos;s&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;myenum&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy.dialects.postgresql</span> <span class="kn">import</span> <span class="n">base</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">CreateEnumType</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">dialect</span><span class="o">=</span><span class="n">postgresql</span><span class="o">.</span><span class="n">dialect</span><span class="p">()))</span>
<span class="go">CREATE TYPE myenum AS ENUM (&apos;one&apos;,&apos;two&apos;,&apos;three&apos;&apos;s&apos;)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-205">&#x73B0;&#x6709;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#x5DF2;&#x7ECF;&#x9003;&#x8131;&#x4E86;&#x5355;&#x5F15;&#x53F7;&#xFF0C;&#x9700;&#x8981;&#x4FEE;&#x6539;&#xFF0C;&#x5426;&#x5219;&#x4ED6;&#x4EEC;&#x73B0;&#x5728;&#x4F1A;&#x53CC;&#x91CD;&#x9003;&#x8131;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-206"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2878">&#xFF03;2878  T0&gt;</a></span></p></div></div><div class="section" id="new-features"><h2><span class="yiyi-st" id="yiyi-207">&#x65B0;&#x529F;&#x80FD;<a class="headerlink" href="#new-features" title="Permalink to this headline">&#xB6;</a></span></h2><div class="section" id="event-removal-api"><h3><span class="yiyi-st" id="yiyi-208">&#x4E8B;&#x4EF6;&#x6E05;&#x9664;API <a class="headerlink" href="#event-removal-api" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-209">&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x65B0;&#x7684;<a class="reference internal" href="core_event.html#sqlalchemy.event.remove" title="sqlalchemy.event.remove"><code class="xref py py-func docutils literal"><span class="pre">event.remove()</span></code></a>&#x51FD;&#x6570;&#x5220;&#x9664;&#x4F7F;&#x7528;<a class="reference internal" href="core_event.html#sqlalchemy.event.listen" title="sqlalchemy.event.listen"><code class="xref py py-func docutils literal"><span class="pre">event.listen()</span></code></a>&#x6216;<a class="reference internal" href="core_event.html#sqlalchemy.event.listens_for" title="sqlalchemy.event.listens_for"><code class="xref py py-func docutils literal"><span class="pre">event.listens_for()</span></code></a>&#x5EFA;&#x7ACB;&#x7684;&#x4E8B;&#x4EF6;&#x3002;</span><span class="yiyi-st" id="yiyi-210">&#x53D1;&#x9001;&#x5230;<a class="reference internal" href="core_event.html#sqlalchemy.event.remove" title="sqlalchemy.event.remove"><code class="xref py py-func docutils literal"><span class="pre">event.remove()</span></code></a>&#x7684;<code class="docutils literal"><span class="pre">target</span></code>&#xFF0C;<code class="docutils literal"><span class="pre">identifier</span></code>&#x548C;<code class="docutils literal"><span class="pre">fn</span></code>&#x53C2;&#x6570;&#x9700;&#x8981;&#x4E0E;&#x53D1;&#x9001;&#x7684;&#x53C2;&#x6570;&#x5B8C;&#x5168;&#x5339;&#x914D;&#x8046;&#x542C;&#xFF0C;&#x5E76;&#x5C06;&#x8BE5;&#x4E8B;&#x4EF6;&#x4ECE;&#x6240;&#x6709;&#x5DF2;&#x5EFA;&#x7ACB;&#x7684;&#x5730;&#x70B9;&#x5220;&#x9664;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@event.listens_for</span><span class="p">(</span><span class="n">MyClass</span><span class="p">,</span> <span class="s2">&quot;before_insert&quot;</span><span class="p">,</span> <span class="n">propagate</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_before_insert</span><span class="p">(</span><span class="n">mapper</span><span class="p">,</span> <span class="n">connection</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;listen for before_insert&quot;&quot;&quot;</span>
    <span class="c1"># ...</span>

<span class="n">event</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">MyClass</span><span class="p">,</span> <span class="s2">&quot;before_insert&quot;</span><span class="p">,</span> <span class="n">my_before_insert</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-211">&#x5728;&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x8BBE;&#x7F6E;&#x4E86;<code class="docutils literal"><span class="pre">propagate=True</span></code>&#x6807;&#x5FD7;&#x3002;</span><span class="yiyi-st" id="yiyi-212">&#x8FD9;&#x610F;&#x5473;&#x7740;<code class="docutils literal"><span class="pre">my_before_insert()</span></code>&#x88AB;&#x5EFA;&#x7ACB;&#x4E3A;<code class="docutils literal"><span class="pre">MyClass</span></code>&#x4EE5;&#x53CA;<code class="docutils literal"><span class="pre">MyClass</span></code>&#x7684;&#x6240;&#x6709;&#x5B50;&#x7C7B;&#x7684;&#x4FA6;&#x542C;&#x5668;&#x3002;</span><span class="yiyi-st" id="yiyi-213">The system tracks everywhere that the <code class="docutils literal"><span class="pre">my_before_insert()</span></code> listener function had been placed as a result of this call and removes it as a result of calling <a class="reference internal" href="core_event.html#sqlalchemy.event.remove" title="sqlalchemy.event.remove"><code class="xref py py-func docutils literal"><span class="pre">event.remove()</span></code></a>.</span></p><p><span class="yiyi-st" id="yiyi-214">&#x5220;&#x9664;&#x7CFB;&#x7EDF;&#x4F7F;&#x7528;&#x6CE8;&#x518C;&#x8868;&#x5C06;&#x4F20;&#x9012;&#x7ED9;<a class="reference internal" href="core_event.html#sqlalchemy.event.listen" title="sqlalchemy.event.listen"><code class="xref py py-func docutils literal"><span class="pre">event.listen()</span></code></a>&#x7684;&#x53C2;&#x6570;&#x4E0E;&#x4E8B;&#x4EF6;&#x4FA6;&#x542C;&#x5668;&#x7684;&#x96C6;&#x5408;&#x5173;&#x8054;&#xFF0C;&#x4E8B;&#x4EF6;&#x4FA6;&#x542C;&#x5668;&#x5728;&#x5F88;&#x591A;&#x60C5;&#x51B5;&#x4E0B;&#x90FD;&#x662F;&#x539F;&#x59CB;&#x7528;&#x6237;&#x63D0;&#x4F9B;&#x7684;&#x51FD;&#x6570;&#x7684;&#x5C01;&#x88C5;&#x7248;&#x672C;&#x3002;</span><span class="yiyi-st" id="yiyi-215">&#x6B64;&#x6CE8;&#x518C;&#x8868;&#x5927;&#x91CF;&#x4F7F;&#x7528;&#x5F31;&#x5F15;&#x7528;&#xFF0C;&#x4EE5;&#x4FBF;&#x5141;&#x8BB8;&#x6240;&#x6709;&#x5305;&#x542B;&#x7684;&#x5185;&#x5BB9;&#xFF08;&#x5982;&#x4FA6;&#x542C;&#x5668;&#x76EE;&#x6807;&#xFF09;&#x5728;&#x8D85;&#x51FA;&#x8303;&#x56F4;&#x65F6;&#x8FDB;&#x884C;&#x5783;&#x573E;&#x56DE;&#x6536;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-216"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2268">&#xFF03;2268  T0&gt;</a></span></p></div><div class="section" id="new-query-options-api-load-only-option"><h3><span class="yiyi-st" id="yiyi-217">&#x65B0;&#x7684;&#x67E5;&#x8BE2;&#x9009;&#x9879;API&#xFF1B; <code class="docutils literal"><span class="pre">load_only()</span></code>&#x9009;&#x9879;<a class="headerlink" href="#new-query-options-api-load-only-option" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-218">The system of loader options such as <a class="reference internal" href="orm_loading_relationships.html#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal"><span class="pre">orm.joinedload()</span></code></a>, <a class="reference internal" href="orm_loading_relationships.html#sqlalchemy.orm.subqueryload" title="sqlalchemy.orm.subqueryload"><code class="xref py py-func docutils literal"><span class="pre">orm.subqueryload()</span></code></a>, <a class="reference internal" href="orm_loading_relationships.html#sqlalchemy.orm.lazyload" title="sqlalchemy.orm.lazyload"><code class="xref py py-func docutils literal"><span class="pre">orm.lazyload()</span></code></a>, <a class="reference internal" href="orm_loading_columns.html#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal"><span class="pre">orm.defer()</span></code></a>, etc. </span><span class="yiyi-st" id="yiyi-219">&#x5168;&#x90E8;&#x57FA;&#x4E8E;&#x79F0;&#x4E3A;<a class="reference internal" href="orm_query.html#sqlalchemy.orm.strategy_options.Load" title="sqlalchemy.orm.strategy_options.Load"><code class="xref py py-class docutils literal"><span class="pre">Load</span></code></a>&#x7684;&#x65B0;&#x7CFB;&#x7EDF;&#x3002;</span><span class="yiyi-st" id="yiyi-220"><a class="reference internal" href="orm_query.html#sqlalchemy.orm.strategy_options.Load" title="sqlalchemy.orm.strategy_options.Load"><code class="xref py py-class docutils literal"><span class="pre">Load</span></code></a>&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x79CD;&#x201C;&#x65B9;&#x6CD5;&#x94FE;&#x63A5;&#x201D;&#xFF08;a.k.a.</span><span class="yiyi-st" id="yiyi-221"><a class="reference internal" href="glossary.html#term-generative"><span class="xref std std-term">generative</span></a>&#xFF09;&#x52A0;&#x8F7D;&#x5668;&#x9009;&#x9879;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x4EE5;&#x4FBF;&#x4E0D;&#x4F7F;&#x7528;&#x70B9;&#x6216;&#x591A;&#x4E2A;&#x5C5E;&#x6027;&#x540D;&#x79F0;&#x5C06;&#x957F;&#x8DEF;&#x5F84;&#x8FDE;&#x63A5;&#x5728;&#x4E00;&#x8D77;&#xFF0C;&#x800C;&#x662F;&#x4E3A;&#x6BCF;&#x4E2A;&#x8DEF;&#x5F84;&#x6307;&#x5B9A;&#x4E00;&#x4E2A;&#x660E;&#x786E;&#x7684;&#x52A0;&#x8F7D;&#x5668;&#x6837;&#x5F0F;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-222">&#x867D;&#x7136;&#x65B0;&#x65B9;&#x6CD5;&#x7565;&#x4E3A;&#x5197;&#x957F;&#xFF0C;&#x4F46;&#x7406;&#x89E3;&#x8D77;&#x6765;&#x66F4;&#x7B80;&#x5355;&#x4E00;&#x70B9;&#xFF0C;&#x5C31;&#x662F;&#x54EA;&#x4E9B;&#x9009;&#x9879;&#x9002;&#x7528;&#x4E8E;&#x54EA;&#x4E9B;&#x8DEF;&#x5F84;&#x6CA1;&#x6709;&#x542B;&#x7CCA;&#x4E0D;&#x6E05;&#x4E4B;&#x5904;&#xFF1B;&#x5B83;&#x7B80;&#x5316;&#x4E86;&#x9009;&#x9879;&#x7684;&#x65B9;&#x6CD5;&#x7B7E;&#x540D;&#x5E76;&#x63D0;&#x4F9B;&#x4E86;&#x66F4;&#x5927;&#x7684;&#x7075;&#x6D3B;&#x6027;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x5BF9;&#x4E8E;&#x57FA;&#x4E8E;&#x5217;&#x7684;&#x9009;&#x9879;&#x3002;</span><span class="yiyi-st" id="yiyi-223">&#x65E7;&#x7CFB;&#x7EDF;&#x4E5F;&#x4F1A;&#x65E0;&#x9650;&#x671F;&#x5730;&#x4FDD;&#x6301;&#x529F;&#x80FD;&#xFF0C;&#x6240;&#x6709;&#x6837;&#x5F0F;&#x90FD;&#x53EF;&#x4EE5;&#x6DF7;&#x5408;&#x4F7F;&#x7528;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-224"><strong>&#x65E7;&#x65B9;&#x5F0F;</strong></span></p><p><span class="yiyi-st" id="yiyi-225">&#x8981;&#x5728;&#x591A;&#x5143;&#x7D20;&#x8DEF;&#x5F84;&#x4E2D;&#x7684;&#x6BCF;&#x4E2A;&#x94FE;&#x63A5;&#x4E0A;&#x8BBE;&#x7F6E;&#x7279;&#x5B9A;&#x7684;&#x52A0;&#x8F7D;&#x6837;&#x5F0F;&#xFF0C;&#x5FC5;&#x987B;&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">_all()</span></code>&#x9009;&#x9879;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">joinedload_all</span><span class="p">(</span><span class="s2">&quot;orders.items.keywords&quot;</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-226"><strong>&#x65B0;&#x9014;&#x5F84;</strong></span></p><p><span class="yiyi-st" id="yiyi-227">Loader&#x9009;&#x9879;&#x73B0;&#x5728;&#x662F;&#x53EF;&#x94FE;&#x63A5;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x540C;&#x6837;&#x7684;<code class="docutils literal"><span class="pre">joinedload(x)</span></code>&#x65B9;&#x6CD5;&#x540C;&#x6837;&#x9002;&#x7528;&#x4E8E;&#x6BCF;&#x4E2A;&#x94FE;&#x63A5;&#xFF0C;&#x65E0;&#x9700;&#x5728;<a class="reference internal" href="orm_loading_relationships.html#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal"><span class="pre">joinedload()</span></code></a>&#x548C;<a class="reference internal" href="orm_loading_relationships.html#sqlalchemy.orm.joinedload_all" title="sqlalchemy.orm.joinedload_all"><code class="xref py py-func docutils literal"><span class="pre">joinedload_all()</span></code></a></span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">joinedload</span><span class="p">(</span><span class="s2">&quot;orders&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">joinedload</span><span class="p">(</span><span class="s2">&quot;items&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">joinedload</span><span class="p">(</span><span class="s2">&quot;keywords&quot;</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-228"><strong>&#x65E7;&#x65B9;&#x5F0F;</strong></span></p><p><span class="yiyi-st" id="yiyi-229">&#x5728;&#x57FA;&#x4E8E;&#x5B50;&#x7C7B;&#x7684;&#x8DEF;&#x5F84;&#x4E0A;&#x8BBE;&#x7F6E;&#x9009;&#x9879;&#x8981;&#x6C42;&#x5C06;&#x8DEF;&#x5F84;&#x4E2D;&#x7684;&#x6240;&#x6709;&#x94FE;&#x63A5;&#x62FC;&#x5199;&#x4E3A;&#x7C7B;&#x7ED1;&#x5B9A;&#x5C5E;&#x6027;&#xFF0C;&#x56E0;&#x4E3A;&#x9700;&#x8981;&#x8C03;&#x7528;<a class="reference internal" href="orm_internals.html#sqlalchemy.orm.interfaces.PropComparator.of_type" title="sqlalchemy.orm.interfaces.PropComparator.of_type"><code class="xref py py-meth docutils literal"><span class="pre">PropComparator.of_type()</span></code></a>&#x65B9;&#x6CD5;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Company</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">options</span><span class="p">(</span>
        <span class="n">subqueryload_all</span><span class="p">(</span>
            <span class="n">Company</span><span class="o">.</span><span class="n">employees</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">Engineer</span><span class="p">),</span>
            <span class="n">Engineer</span><span class="o">.</span><span class="n">machines</span>
        <span class="p">)</span>
    <span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-230"><strong>&#x65B0;&#x9014;&#x5F84;</strong></span></p><p><span class="yiyi-st" id="yiyi-231">&#x53EA;&#x6709;&#x8DEF;&#x5F84;&#x4E2D;&#x5B9E;&#x9645;&#x9700;&#x8981;<a class="reference internal" href="orm_internals.html#sqlalchemy.orm.interfaces.PropComparator.of_type" title="sqlalchemy.orm.interfaces.PropComparator.of_type"><code class="xref py py-meth docutils literal"><span class="pre">PropComparator.of_type()</span></code></a>&#x7684;&#x5143;&#x7D20;&#x9700;&#x8981;&#x8BBE;&#x7F6E;&#x4E3A;&#x7C7B;&#x7ED1;&#x5B9A;&#x5C5E;&#x6027;&#xFF0C;&#x4E4B;&#x540E;&#x624D;&#x80FD;&#x6062;&#x590D;&#x57FA;&#x4E8E;&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x540D;&#x79F0;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>session.query(Company).\
    options(
        subqueryload(Company.employees.of_type(Engineer)).
        subqueryload(&quot;machines&quot;)
        )
    )</pre></div></div><p><span class="yiyi-st" id="yiyi-232"><strong>&#x65E7;&#x65B9;&#x5F0F;</strong></span></p><p><span class="yiyi-st" id="yiyi-233">&#x5728;&#x957F;&#x8DEF;&#x5F84;&#x4E2D;&#x7684;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x94FE;&#x63A5;&#x4E0A;&#x8BBE;&#x7F6E;&#x52A0;&#x8F7D;&#x5668;&#x9009;&#x9879;&#x4F7F;&#x7528;&#x7684;&#x8BED;&#x6CD5;&#x770B;&#x8D77;&#x6765;&#x5F88;&#x50CF;&#x5B83;&#x5E94;&#x8BE5;&#x4E3A;&#x8DEF;&#x5F84;&#x4E2D;&#x7684;&#x6240;&#x6709;&#x94FE;&#x63A5;&#x8BBE;&#x7F6E;&#x9009;&#x9879;&#xFF0C;&#x5BFC;&#x81F4;&#x6DF7;&#x6DC6;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">subqueryload</span><span class="p">(</span><span class="s2">&quot;orders.items.keywords&quot;</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-234"><strong>&#x65B0;&#x9014;&#x5F84;</strong></span></p><p><span class="yiyi-st" id="yiyi-235">&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<a class="reference internal" href="orm_loading_relationships.html#sqlalchemy.orm.defaultload" title="sqlalchemy.orm.defaultload"><code class="xref py py-func docutils literal"><span class="pre">defaultload()</span></code></a>&#x6765;&#x4E3A;&#x73B0;&#x6709;&#x52A0;&#x8F7D;&#x7A0B;&#x5E8F;&#x6837;&#x5F0F;&#x5E94;&#x8BE5;&#x4FDD;&#x6301;&#x4E0D;&#x53D8;&#x7684;&#x8DEF;&#x5F84;&#x4E2D;&#x7684;&#x6761;&#x76EE;&#x62FC;&#x5199;&#x51FA;&#x8DEF;&#x5F84;&#x3002;</span><span class="yiyi-st" id="yiyi-236">&#x66F4;&#x8BE6;&#x7EC6;&#xFF0C;&#x4F46;&#x610F;&#x56FE;&#x66F4;&#x6E05;&#x6670;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">defaultload</span><span class="p">(</span><span class="s2">&quot;orders&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">defaultload</span><span class="p">(</span><span class="s2">&quot;items&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">subqueryload</span><span class="p">(</span><span class="s2">&quot;keywords&quot;</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-237">&#x865A;&#x7EBF;&#x6837;&#x5F0F;&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x5229;&#x7528;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x5728;&#x8DF3;&#x8FC7;&#x591A;&#x4E2A;&#x8DEF;&#x5F84;&#x5143;&#x7D20;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">defaultload</span><span class="p">(</span><span class="s2">&quot;orders.items&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">subqueryload</span><span class="p">(</span><span class="s2">&quot;keywords&quot;</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-238"><strong>&#x65E7;&#x65B9;&#x5F0F;</strong></span></p><p><span class="yiyi-st" id="yiyi-239">&#x9700;&#x8981;&#x4F7F;&#x7528;&#x6BCF;&#x4E2A;&#x5217;&#x7684;&#x5B8C;&#x6574;&#x8DEF;&#x5F84;&#x62FC;&#x5199;&#x8DEF;&#x5F84;&#x4E0A;&#x7684;<a class="reference internal" href="orm_loading_columns.html#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal"><span class="pre">defer()</span></code></a>&#x9009;&#x9879;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">defer</span><span class="p">(</span><span class="s2">&quot;orders.description&quot;</span><span class="p">),</span> <span class="n">defer</span><span class="p">(</span><span class="s2">&quot;orders.isopen&quot;</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-240"><strong>&#x65B0;&#x9014;&#x5F84;</strong></span></p><p><span class="yiyi-st" id="yiyi-241">&#x5230;&#x8FBE;&#x76EE;&#x6807;&#x8DEF;&#x5F84;&#x7684;&#x5355;&#x4E2A;<a class="reference internal" href="orm_query.html#sqlalchemy.orm.strategy_options.Load" title="sqlalchemy.orm.strategy_options.Load"><code class="xref py py-class docutils literal"><span class="pre">Load</span></code></a>&#x5BF9;&#x8C61;&#x53EF;&#x4EE5;<a class="reference internal" href="orm_query.html#sqlalchemy.orm.strategy_options.Load.defer" title="sqlalchemy.orm.strategy_options.Load.defer"><code class="xref py py-meth docutils literal"><span class="pre">Load.defer()</span></code></a>&#x91CD;&#x590D;&#x8C03;&#x7528;&#x5B83;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">defaultload</span><span class="p">(</span><span class="s2">&quot;orders&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">defer</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">defer</span><span class="p">(</span><span class="s2">&quot;isopen&quot;</span><span class="p">))</span></pre></div></div><div class="section" id="the-load-class"><h4><span class="yiyi-st" id="yiyi-242">&#x52A0;&#x8F7D;&#x7C7B;<a class="headerlink" href="#the-load-class" title="Permalink to this headline">&#xB6;</a></span></h4><p><span class="yiyi-st" id="yiyi-243">&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528;<a class="reference internal" href="orm_query.html#sqlalchemy.orm.strategy_options.Load" title="sqlalchemy.orm.strategy_options.Load"><code class="xref py py-class docutils literal"><span class="pre">Load</span></code></a>&#x7C7B;&#x6765;&#x63D0;&#x4F9B;&#x201C;&#x7ED1;&#x5B9A;&#x201D;&#x76EE;&#x6807;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x5F53;&#x5B58;&#x5728;&#x591A;&#x4E2A;&#x7236;&#x5B9E;&#x4F53;&#x65F6;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">Load</span>

<span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">Address</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">Load</span><span class="p">(</span><span class="n">Address</span><span class="p">)</span><span class="o">.</span><span class="n">joinedload</span><span class="p">(</span><span class="s2">&quot;entries&quot;</span><span class="p">))</span></pre></div></div></div><div class="section" id="load-only"><h4><span class="yiyi-st" id="yiyi-244">&#x4EC5;&#x52A0;&#x8F7D;<a class="headerlink" href="#load-only" title="Permalink to this headline">&#xB6;</a></span></h4><p><span class="yiyi-st" id="yiyi-245">&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x9009;&#x9879;<a class="reference internal" href="orm_loading_columns.html#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal"><span class="pre">load_only()</span></code></a>&#x5B9E;&#x73B0;&#x4E86;&#x201C;&#x63A8;&#x8FDF;&#x4E00;&#x5207;&#xFF0C;&#x4F46;&#x662F;&#x201D;&#x7684;&#x52A0;&#x8F7D;&#x65B9;&#x5F0F;&#xFF0C;&#x53EA;&#x52A0;&#x8F7D;&#x7ED9;&#x5B9A;&#x7684;&#x5217;&#x5E76;&#x63A8;&#x8FDF;&#x5176;&#x4F59;&#x90E8;&#x5206;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">load_only</span>

<span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">load_only</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;fullname&quot;</span><span class="p">))</span>

<span class="c1"># specify explicit parent entity</span>
<span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">Address</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">Load</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">load_only</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;fullname&quot;</span><span class="p">))</span>

<span class="c1"># specify path</span>
<span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">joinedload</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">addresses</span><span class="p">)</span><span class="o">.</span><span class="n">load_only</span><span class="p">(</span><span class="s2">&quot;email_address&quot;</span><span class="p">))</span></pre></div></div></div><div class="section" id="class-specific-wildcards"><h4><span class="yiyi-st" id="yiyi-246">&#x7279;&#x5B9A;&#x4E8E;&#x7C7B;&#x7684;&#x901A;&#x914D;&#x7B26;<a class="headerlink" href="#class-specific-wildcards" title="Permalink to this headline">&#xB6;</a></span></h4><p><span class="yiyi-st" id="yiyi-247">&#x4F7F;&#x7528;<a class="reference internal" href="orm_query.html#sqlalchemy.orm.strategy_options.Load" title="sqlalchemy.orm.strategy_options.Load"><code class="xref py py-class docutils literal"><span class="pre">Load</span></code></a>&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x901A;&#x914D;&#x7B26;&#x4E3A;&#x7ED9;&#x5B9A;&#x5B9E;&#x4F53;&#x4E0A;&#x7684;&#x6240;&#x6709;&#x5173;&#x7CFB;&#xFF08;&#x6216;&#x53EF;&#x80FD;&#x662F;&#x5217;&#xFF09;&#x8BBE;&#x7F6E;&#x52A0;&#x8F7D;&#xFF0C;&#x800C;&#x4E0D;&#x4F1A;&#x5F71;&#x54CD;&#x5176;&#x4ED6;&#x4EFB;&#x4F55;&#x5173;&#x7CFB;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># lazyload all User relationships</span>
<span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">Load</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">lazyload</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">))</span>

<span class="c1"># undefer all User columns</span>
<span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">Load</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">undefer</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">))</span>

<span class="c1"># lazyload all Address relationships</span>
<span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">defaultload</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">addresses</span><span class="p">)</span><span class="o">.</span><span class="n">lazyload</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">))</span>

<span class="c1"># undefer all Address columns</span>
<span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">defaultload</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">addresses</span><span class="p">)</span><span class="o">.</span><span class="n">undefer</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-248"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/1418">&#xFF03;1418  T0&gt;</a></span></p></div></div><div class="section" id="new-text-capabilities"><h3><span class="yiyi-st" id="yiyi-249">&#x65B0;<code class="docutils literal"><span class="pre">text()</span></code>&#x529F;&#x80FD;<a class="headerlink" href="#new-text-capabilities" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-250"><a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.text" title="sqlalchemy.sql.expression.text"><code class="xref py py-func docutils literal"><span class="pre">text()</span></code></a>&#x7ED3;&#x6784;&#x83B7;&#x5F97;&#x65B0;&#x65B9;&#x6CD5;&#xFF1A;</span></p><ul><li><p class="first"><span class="yiyi-st" id="yiyi-251"><a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.TextClause.bindparams" title="sqlalchemy.sql.expression.TextClause.bindparams"><code class="xref py py-meth docutils literal"><span class="pre">TextClause.bindparams()</span></code></a> allows bound parameter types and values to be set flexibly:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span># setup values
stmt = text(&quot;SELECT id, name FROM user &quot;
      &quot;WHERE name=:name AND timestamp=:timestamp&quot;).\
      bindparams(name=&quot;ed&quot;, timestamp=datetime(2012, 11, 10, 15, 12, 35))

# setup types and/or values
stmt = text(&quot;SELECT id, name FROM user &quot;
      &quot;WHERE name=:name AND timestamp=:timestamp&quot;).\
      bindparams(
          bindparam(&quot;name&quot;, value=&quot;ed&quot;),
          bindparam(&quot;timestamp&quot;, type_=DateTime()
      ).bindparam(timestamp=datetime(2012, 11, 10, 15, 12, 35))</pre></div></div></li><li><p class="first"><span class="yiyi-st" id="yiyi-252"><a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.TextClause.columns" title="sqlalchemy.sql.expression.TextClause.columns"><code class="xref py py-meth docutils literal"><span class="pre">TextClause.columns()</span></code></a>&#x53D6;&#x4EE3;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.text" title="sqlalchemy.sql.expression.text"><code class="xref py py-func docutils literal"><span class="pre">text()</span></code></a>&#x7684;<code class="docutils literal"><span class="pre">typemap</span></code>&#x9009;&#x9879;&#xFF0C;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x7ED3;&#x6784;<a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.TextAsFrom" title="sqlalchemy.sql.expression.TextAsFrom"><code class="xref py py-class docutils literal"><span class="pre">TextAsFrom</span></code></a>&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># turn a text() into an alias(), with a .c. collection:</span>
<span class="n">stmt</span> <span class="o">=</span> <span class="n">text</span><span class="p">(</span><span class="s2">&quot;SELECT id, name FROM user&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">Integer</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">String</span><span class="p">)</span>
<span class="n">stmt</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">alias</span><span class="p">()</span>

<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">addresses</span><span class="p">])</span><span class="o">.</span><span class="n">select_from</span><span class="p">(</span>
              <span class="n">addresses</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">stmt</span><span class="p">),</span> <span class="n">addresses</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">user_id</span> <span class="o">==</span> <span class="n">stmt</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>


<span class="c1"># or into a cte():</span>
<span class="n">stmt</span> <span class="o">=</span> <span class="n">text</span><span class="p">(</span><span class="s2">&quot;SELECT id, name FROM user&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">Integer</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">String</span><span class="p">)</span>
<span class="n">stmt</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">cte</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>

<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">addresses</span><span class="p">])</span><span class="o">.</span><span class="n">select_from</span><span class="p">(</span>
              <span class="n">addresses</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">stmt</span><span class="p">),</span> <span class="n">addresses</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">user_id</span> <span class="o">==</span> <span class="n">stmt</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">)</span></pre></div></div></li></ul><p><span class="yiyi-st" id="yiyi-253"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2877">&#xFF03;2877  T0&gt;</a></span></p></div><div class="section" id="insert-from-select"><h3><span class="yiyi-st" id="yiyi-254">&#x4ECE;SELECT <a class="headerlink" href="#insert-from-select" title="Permalink to this headline">&#xB6;</a>&#x63D2;&#x5165;</span></h3><p><span class="yiyi-st" id="yiyi-255">&#x7ECF;&#x8FC7;&#x51E0;&#x5E74;&#x6BEB;&#x65E0;&#x610F;&#x4E49;&#x7684;&#x62D6;&#x5EF6;&#x4E4B;&#x540E;&#xFF0C;&#x8FD9;&#x4E2A;&#x76F8;&#x5BF9;&#x8F83;&#x5C0F;&#x7684;&#x8BED;&#x6CD5;&#x7279;&#x5F81;&#x5DF2;&#x88AB;&#x6DFB;&#x52A0;&#xFF0C;&#x5E76;&#x4E14;&#x4E5F;&#x88AB;&#x652F;&#x6301;&#x5230;0.8.3&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x6280;&#x672F;&#x4E0A;0.9&#x4E0D;&#x662F;&#x201C;&#x65B0;&#x201D;&#x3002;</span><span class="yiyi-st" id="yiyi-256">A <a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal"><span class="pre">select()</span></code></a> construct or other compatible construct can be passed to the new method <a class="reference internal" href="core_dml.html#sqlalchemy.sql.expression.Insert.from_select" title="sqlalchemy.sql.expression.Insert.from_select"><code class="xref py py-meth docutils literal"><span class="pre">Insert.from_select()</span></code></a> where it will be used to render an <code class="docutils literal"><span class="pre">INSERT</span> <span class="pre">..</span> <span class="pre">SELECT</span></code> construct:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy.sql</span> <span class="kn">import</span> <span class="n">table</span><span class="p">,</span> <span class="n">column</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t1</span> <span class="o">=</span> <span class="n">table</span><span class="p">(</span><span class="s1">&apos;t1&apos;</span><span class="p">,</span> <span class="n">column</span><span class="p">(</span><span class="s1">&apos;a&apos;</span><span class="p">),</span> <span class="n">column</span><span class="p">(</span><span class="s1">&apos;b&apos;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t2</span> <span class="o">=</span> <span class="n">table</span><span class="p">(</span><span class="s1">&apos;t2&apos;</span><span class="p">,</span> <span class="n">column</span><span class="p">(</span><span class="s1">&apos;x&apos;</span><span class="p">),</span> <span class="n">column</span><span class="p">(</span><span class="s1">&apos;y&apos;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">t1</span><span class="o">.</span><span class="n">insert</span><span class="p">()</span><span class="o">.</span><span class="n">from_select</span><span class="p">([</span><span class="s1">&apos;a&apos;</span><span class="p">,</span> <span class="s1">&apos;b&apos;</span><span class="p">],</span> <span class="n">t2</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">t2</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)))</span>
<span class="go">INSERT INTO t1 (a, b) SELECT t2.x, t2.y</span>
<span class="go">FROM t2</span>
<span class="go">WHERE t2.y = :y_1</span></pre></div></div><p><span class="yiyi-st" id="yiyi-257">&#x8BE5;&#x6784;&#x9020;&#x8DB3;&#x591F;&#x667A;&#x80FD;&#xFF0C;&#x53EF;&#x4EE5;&#x5BB9;&#x7EB3;&#x8BF8;&#x5982;&#x7C7B;&#x548C;<a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query" title="sqlalchemy.orm.query.Query"><code class="xref py py-class docutils literal"><span class="pre">Query</span></code></a>&#x5BF9;&#x8C61;&#x7684;ORM&#x5BF9;&#x8C61;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">User</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&apos;ed&apos;</span><span class="p">)</span>
<span class="n">ins</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="n">Address</span><span class="p">)</span><span class="o">.</span><span class="n">from_select</span><span class="p">((</span><span class="n">Address</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">Address</span><span class="o">.</span><span class="n">email_address</span><span class="p">),</span> <span class="n">q</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-258">&#x6E32;&#x67D3;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>INSERT INTO addresses (id, email_address)
SELECT users.id AS users_id, users.name AS users_name
FROM users WHERE users.name = :name_1</pre></div></div><p><span class="yiyi-st" id="yiyi-259"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/722">&#xFF03;722  T0&gt;</a></span></p></div><div class="section" id="new-for-update-support-on-select-query"><h3><span class="yiyi-st" id="yiyi-260">&#x65B0;&#x7684;FOR UPDATE&#x652F;&#x6301;&#x5728;<code class="docutils literal"><span class="pre">select()</span></code>&#xFF0C;<code class="docutils literal"><span class="pre">Query()</span></code> <a class="headerlink" href="#new-for-update-support-on-select-query" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-261">An attempt is made to simplify the specification of the <code class="docutils literal"><span class="pre">FOR</span> <span class="pre">UPDATE</span></code> clause on <code class="docutils literal"><span class="pre">SELECT</span></code> statements made within Core and ORM, and support is added for the <code class="docutils literal"><span class="pre">FOR</span> <span class="pre">UPDATE</span> <span class="pre">OF</span></code> SQL supported by Postgresql and Oracle.</span></p><p><span class="yiyi-st" id="yiyi-262">&#x4F7F;&#x7528;&#x6838;&#x5FC3;<a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.GenerativeSelect.with_for_update" title="sqlalchemy.sql.expression.GenerativeSelect.with_for_update"><code class="xref py py-meth docutils literal"><span class="pre">GenerativeSelect.with_for_update()</span></code></a>&#xFF0C;&#x8BF8;&#x5982;<code class="docutils literal"><span class="pre">FOR</span> <span class="pre">SHARE</span></code>&#x548C;<code class="docutils literal"><span class="pre">NOWAIT</span></code>&#x53EF;&#x4EE5;&#x5355;&#x72EC;&#x6307;&#x5B9A;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x94FE;&#x63A5;&#x5230;&#x4EFB;&#x610F;&#x5B57;&#x7B26;&#x4E32;&#x4EE3;&#x7801;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">table</span><span class="p">])</span><span class="o">.</span><span class="n">with_for_update</span><span class="p">(</span><span class="n">read</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nowait</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">of</span><span class="o">=</span><span class="n">table</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-263">&#x5728;Posgtresql&#x4E0A;&#x9762;&#x7684;&#x8BED;&#x53E5;&#x53EF;&#x80FD;&#x5448;&#x73B0;&#x5982;&#x4E0B;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT table.a, table.b FROM table FOR SHARE OF table NOWAIT</pre></div></div><p><span class="yiyi-st" id="yiyi-264"><a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query" title="sqlalchemy.orm.query.Query"><code class="xref py py-class docutils literal"><span class="pre">Query</span></code></a>&#x5BF9;&#x8C61;&#x83B7;&#x5F97;&#x4E86;&#x7C7B;&#x4F3C;&#x7684;&#x65B9;&#x6CD5;<a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query.with_for_update" title="sqlalchemy.orm.query.Query.with_for_update"><code class="xref py py-meth docutils literal"><span class="pre">Query.with_for_update()</span></code></a>&#xFF0C;&#x5176;&#x884C;&#x4E3A;&#x65B9;&#x5F0F;&#x76F8;&#x540C;&#x3002;</span><span class="yiyi-st" id="yiyi-265">&#x6B64;&#x65B9;&#x6CD5;&#x53D6;&#x4EE3;&#x4E86;&#x4F7F;&#x7528;&#x4E0D;&#x540C;&#x7CFB;&#x7EDF;&#x7FFB;&#x8BD1;<code class="docutils literal"><span class="pre">FOR</span> <span class="pre">UPDATE</span></code>&#x5B50;&#x53E5;&#x7684;&#x73B0;&#x6709;<a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query.with_lockmode" title="sqlalchemy.orm.query.Query.with_lockmode"><code class="xref py py-meth docutils literal"><span class="pre">Query.with_lockmode()</span></code></a>&#x65B9;&#x6CD5;&#x3002;</span><span class="yiyi-st" id="yiyi-266">&#x76EE;&#x524D;&#xFF0C;&#x201C;lockmode&#x201D;&#x5B57;&#x7B26;&#x4E32;&#x53C2;&#x6570;&#x4ECD;&#x7136;&#x88AB;<a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session.refresh" title="sqlalchemy.orm.session.Session.refresh"><code class="xref py py-meth docutils literal"><span class="pre">Session.refresh()</span></code></a>&#x65B9;&#x6CD5;&#x63A5;&#x53D7;&#x3002;</span></p></div><div class="section" id="floating-point-string-conversion-precision-configurable-for-native-floating-point-types"><h3><span class="yiyi-st" id="yiyi-267">&#x6D6E;&#x70B9;&#x6570;&#x5B57;&#x7B26;&#x4E32;&#x8F6C;&#x6362;&#x7CBE;&#x5EA6;&#x53EF;&#x914D;&#x7F6E;&#x4E3A;&#x672C;&#x5730;&#x6D6E;&#x70B9;&#x7C7B;&#x578B;<a class="headerlink" href="#floating-point-string-conversion-precision-configurable-for-native-floating-point-types" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-268">&#x65E0;&#x8BBA;&#x4F55;&#x65F6;DBAPI&#x8FD4;&#x56DE;&#x8981;&#x8F6C;&#x6362;&#x4E3A;Python <code class="docutils literal"><span class="pre">Decimal()</span></code>&#x7684;Python&#x6D6E;&#x70B9;&#x7C7B;&#x578B;&#xFF0C;SQLAlchemy&#x90FD;&#x4F1A;&#x6267;&#x884C;&#x7684;&#x8F6C;&#x6362;&#x5FC5;&#x7136;&#x6D89;&#x53CA;&#x5C06;&#x6D6E;&#x70B9;&#x503C;&#x8F6C;&#x6362;&#x4E3A;&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x4E2D;&#x95F4;&#x6B65;&#x9AA4;&#x3002;</span><span class="yiyi-st" id="yiyi-269">&#x7528;&#x4E8E;&#x6B64;&#x5B57;&#x7B26;&#x4E32;&#x8F6C;&#x6362;&#x7684;&#x6BD4;&#x4F8B;&#x5148;&#x524D;&#x5DF2;&#x786C;&#x7F16;&#x7801;&#x4E3A;10&#xFF0C;&#x73B0;&#x5728;&#x53EF;&#x914D;&#x7F6E;&#x3002;</span><span class="yiyi-st" id="yiyi-270">&#x8BE5;&#x8BBE;&#x7F6E;&#x53EF;&#x4EE5;&#x5728;<a class="reference internal" href="core_type_basics.html#sqlalchemy.types.Numeric" title="sqlalchemy.types.Numeric"><code class="xref py py-class docutils literal"><span class="pre">Numeric</span></code></a>&#x4EE5;&#x53CA;<a class="reference internal" href="core_type_basics.html#sqlalchemy.types.Float" title="sqlalchemy.types.Float"><code class="xref py py-class docutils literal"><span class="pre">Float</span></code></a>&#x7C7B;&#x578B;&#x4EE5;&#x53CA;&#x6240;&#x6709;SQL&#x548C;&#x7279;&#x5B9A;&#x4E8E;&#x65B9;&#x8A00;&#x7684;&#x540E;&#x4EE3;&#x7C7B;&#x578B;&#x4E0A;&#x4F7F;&#x7528;&#x53C2;&#x6570;<code class="docutils literal"><span class="pre">decimal_return_scale</span></code></span><span class="yiyi-st" id="yiyi-271">If the type supports a <code class="docutils literal"><span class="pre">.scale</span></code> parameter, as is the case with <a class="reference internal" href="core_type_basics.html#sqlalchemy.types.Numeric" title="sqlalchemy.types.Numeric"><code class="xref py py-class docutils literal"><span class="pre">Numeric</span></code></a> and some float types such as <a class="reference internal" href="dialects_mysql.html#sqlalchemy.dialects.mysql.DOUBLE" title="sqlalchemy.dialects.mysql.DOUBLE"><code class="xref py py-class docutils literal"><span class="pre">mysql.DOUBLE</span></code></a>, the value of <code class="docutils literal"><span class="pre">.scale</span></code> is used as the default for <code class="docutils literal"><span class="pre">.decimal_return_scale</span></code> if it is not otherwise specified. </span><span class="yiyi-st" id="yiyi-272">&#x5982;&#x679C;<code class="docutils literal"><span class="pre">.scale</span></code>&#x548C;<code class="docutils literal"><span class="pre">.decimal_return_scale</span></code>&#x90FD;&#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x5219;&#x9ED8;&#x8BA4;&#x503C;&#x4E3A;10&#x3002;</span><span class="yiyi-st" id="yiyi-273">&#x4F8B;&#x5982;&#x3002;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.dialects.mysql</span> <span class="kn">import</span> <span class="n">DOUBLE</span>
<span class="kn">import</span> <span class="nn">decimal</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&apos;data&apos;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;double_value&apos;</span><span class="p">,</span>
                <span class="n">mysql</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">(</span><span class="n">decimal_return_scale</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">asdecimal</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
<span class="p">)</span>

<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
    <span class="n">data</span><span class="o">.</span><span class="n">insert</span><span class="p">(),</span>
    <span class="n">double_value</span><span class="o">=</span><span class="mf">45.768392065789</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span><span class="n">select</span><span class="p">([</span><span class="n">data</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">double_value</span><span class="p">]))</span>

<span class="c1"># previously, this would typically be Decimal(&quot;45.7683920658&quot;),</span>
<span class="c1"># e.g. trimmed to 10 decimal places</span>

<span class="c1"># now we get 12, as requested, as MySQL can support this</span>
<span class="c1"># much precision for DOUBLE</span>
<span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">(</span><span class="s2">&quot;45.768392065789&quot;</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-274"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2867">&#xFF03;2867  T0&gt;</a></span></p></div><div class="section" id="column-bundles-for-orm-queries"><h3><span class="yiyi-st" id="yiyi-275">&#x7528;&#x4E8E;ORM&#x67E5;&#x8BE2;&#x7684;&#x5217;&#x5305;<a class="headerlink" href="#column-bundles-for-orm-queries" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-276"><a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Bundle" title="sqlalchemy.orm.query.Bundle"><code class="xref py py-class docutils literal"><span class="pre">Bundle</span></code></a>&#x5141;&#x8BB8;&#x67E5;&#x8BE2;&#x4E00;&#x7EC4;&#x5217;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x67E5;&#x8BE2;&#x8FD4;&#x56DE;&#x7684;&#x5143;&#x7EC4;&#x4E0B;&#x9762;&#x5C06;&#x8FD9;&#x4E9B;&#x5217;&#x7EC4;&#x5408;&#x6210;&#x4E00;&#x4E2A;&#x540D;&#x79F0;&#x3002;</span><span class="yiyi-st" id="yiyi-277"><a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Bundle" title="sqlalchemy.orm.query.Bundle"><code class="xref py py-class docutils literal"><span class="pre">Bundle</span></code></a>&#x7684;&#x521D;&#x59CB;&#x76EE;&#x7684;&#x662F;1.&#x5141;&#x8BB8;&#x5C06;&#x201C;&#x5408;&#x6210;&#x201D;ORM&#x5217;&#x4F5C;&#x4E3A;&#x57FA;&#x4E8E;&#x5217;&#x7684;&#x7ED3;&#x679C;&#x96C6;&#x4E2D;&#x7684;&#x5355;&#x4E2A;&#x503C;&#x8FD4;&#x56DE;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5C06;&#x5B83;&#x4EEC;&#x5C55;&#x5F00;&#x5230;&#x5355;&#x4E2A;&#x5217;&#x4E2D;&#xFF0C;&#x5E76;&#x4E14;2.&#x5141;&#x8BB8;&#x5728;ORM&#x4E2D;&#x521B;&#x5EFA;&#x81EA;&#x5B9A;&#x4E49;&#x7ED3;&#x679C;&#x96C6;&#x6784;&#x9020;&#xFF0C;&#x4F7F;&#x7528;&#x4E13;&#x95E8;&#x7684;&#x5217;&#x548C;&#x8FD4;&#x56DE;&#x7C7B;&#x578B;&#xFF0C;&#x800C;&#x4E0D;&#x6D89;&#x53CA;&#x6620;&#x5C04;&#x7C7B;&#x7684;&#x66F4;&#x91CD;&#x91CF;&#x7EA7;&#x7684;&#x673A;&#x5236;&#x3002;</span></p><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-278">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p><span class="yiyi-st" id="yiyi-279"><a class="reference internal" href="#migration-2824"><span>Composite attributes are now returned as their object form when queried on a per-attribute basis</span></a>&#x67E5;&#x8BE2;&#x65F6;&#xFF0C;&#x590D;&#x5408;&#x5C5E;&#x6027;&#x73B0;&#x5728;&#x4EE5;&#x5176;&#x5BF9;&#x8C61;&#x5F62;&#x5F0F;&#x8FD4;&#x56DE;</span></p><p class="last"><span class="yiyi-st" id="yiyi-280"><a class="reference internal" href="orm_loading_columns.html#bundles"><span>Column Bundles</span></a></span></p></div><p><span class="yiyi-st" id="yiyi-281"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2824">&#xFF03;2824  T0&gt;</a></span></p></div><div class="section" id="server-side-version-counting"><h3><span class="yiyi-st" id="yiyi-282">&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x7248;&#x672C;&#x8BA1;&#x6570;<a class="headerlink" href="#server-side-version-counting" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-283">ORM&#x7684;&#x7248;&#x672C;&#x63A7;&#x5236;&#x529F;&#x80FD;&#xFF08;&#x73B0;&#x5728;&#x4E5F;&#x5728;<a class="reference internal" href="orm_versioning.html#mapper-version-counter"><span>Configuring a Version Counter</span></a>&#x4E2D;&#x6709;&#x8BB0;&#x5F55;&#xFF09;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x7248;&#x672C;&#x8BA1;&#x6570;&#x65B9;&#x6848;&#xFF08;&#x4F8B;&#x5982;&#x7531;&#x89E6;&#x53D1;&#x5668;&#x6216;&#x6570;&#x636E;&#x5E93;&#x7CFB;&#x7EDF;&#x5217;&#x751F;&#x6210;&#x7684;&#x7248;&#x672C;&#x8BA1;&#x6570;&#x65B9;&#x6848;&#xFF09;&#x4EE5;&#x53CA;&#x6761;&#x4EF6;&#x7F16;&#x7A0B;&#x65B9;&#x6848;&#x5728;version_id_counter&#x51FD;&#x6570;&#x672C;&#x8EAB;&#x4E4B;&#x5916;&#x3002;</span><span class="yiyi-st" id="yiyi-284">&#x901A;&#x8FC7;&#x4E3A;<code class="docutils literal"><span class="pre">version_id_generator</span></code>&#x53C2;&#x6570;&#x63D0;&#x4F9B;<code class="docutils literal"><span class="pre">False</span></code>&#x503C;&#xFF0C;ORM&#x5C06;&#x4F7F;&#x7528;&#x5DF2;&#x8BBE;&#x7F6E;&#x7684;&#x7248;&#x672C;&#x6807;&#x8BC6;&#x7B26;&#xFF0C;&#x6216;&#x8005;&#x540C;&#x65F6;&#x4ECE;&#x6BCF;&#x884C;&#x4E2D;&#x83B7;&#x53D6;&#x7248;&#x672C;&#x6807;&#x8BC6;&#x7B26;INSERT&#x6216;&#x53D1;&#x5E03;UPDATE&#x3002;</span><span class="yiyi-st" id="yiyi-285">&#x5F53;&#x4F7F;&#x7528;&#x670D;&#x52A1;&#x5668;&#x751F;&#x6210;&#x7684;&#x7248;&#x672C;&#x6807;&#x8BC6;&#x7B26;&#x65F6;&#xFF0C;&#x5F3A;&#x70C8;&#x5EFA;&#x8BAE;&#x4EC5;&#x5728;&#x5177;&#x6709;&#x5F3A;&#x5927;RETURNING&#x652F;&#x6301;&#x7684;&#x540E;&#x7AEF;&#x4F7F;&#x7528;&#x6B64;&#x529F;&#x80FD;&#xFF08;Postgresql&#xFF0C;SQL Server&#xFF1B; Oracle&#x4E5F;&#x652F;&#x6301;RETURNING&#xFF0C;&#x4F46;cx_oracle&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x53EA;&#x6709;&#x6709;&#x9650;&#x7684;&#x652F;&#x6301;&#xFF09;&#xFF0C;&#x5426;&#x5219;&#x989D;&#x5916;&#x7684;SELECT&#x62A5;&#x8868;&#x5C06;&#x4F1A;&#x589E;&#x52A0;&#x663E;&#x7740;&#x7684;&#x6027;&#x80FD;&#x5F00;&#x9500;&#x3002;</span><span class="yiyi-st" id="yiyi-286">&#x5728;<a class="reference internal" href="orm_versioning.html#server-side-version-counter"><span>Server Side Version Counters</span></a>&#x4E2D;&#x63D0;&#x4F9B;&#x7684;&#x793A;&#x4F8B;&#x8BF4;&#x660E;&#x4E86;Postgresql <code class="docutils literal"><span class="pre">xmin</span></code>&#x7CFB;&#x7EDF;&#x5217;&#x7684;&#x4F7F;&#x7528;&#x60C5;&#x51B5;&#xFF0C;&#x4EE5;&#x4FBF;&#x5C06;&#x5176;&#x4E0E;ORM&#x7684;&#x7248;&#x672C;&#x63A7;&#x5236;&#x529F;&#x80FD;&#x96C6;&#x6210;&#x5728;&#x4E00;&#x8D77;&#x3002;</span></p><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-287">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-288"><a class="reference internal" href="orm_versioning.html#server-side-version-counter"><span>Server Side Version Counters</span></a></span></p></div><p><span class="yiyi-st" id="yiyi-289"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2793">&#xFF03;2793  T0&gt;</a></span></p></div><div class="section" id="include-backrefs-false-option-for-validates"><h3><span class="yiyi-st" id="yiyi-290"><code class="docutils literal"><span class="pre">include_backrefs=False</span></code>&#x9009;&#x9879;&#x7528;&#x4E8E;<code class="docutils literal"><span class="pre">@validates</span></code> <a class="headerlink" href="#include-backrefs-false-option-for-validates" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-291"><a class="reference internal" href="orm_mapped_attributes.html#sqlalchemy.orm.validates" title="sqlalchemy.orm.validates"><code class="xref py py-func docutils literal"><span class="pre">validates()</span></code></a>&#x51FD;&#x6570;&#x73B0;&#x5728;&#x63A5;&#x53D7;&#x4E00;&#x4E2A;&#x9009;&#x9879;<code class="docutils literal"><span class="pre">include_backrefs=True</span></code>&#xFF0C;&#x8BE5;&#x9009;&#x9879;&#x5C06;&#x7ED5;&#x8FC7;&#x9488;&#x5BF9;&#x4E8B;&#x4EF6;&#x4ECE;backref&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">relationship</span><span class="p">,</span> <span class="n">validates</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>

<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;a&apos;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">bs</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">)</span>

    <span class="nd">@validates</span><span class="p">(</span><span class="s2">&quot;bs&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">validate_bs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;A.bs validator&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">item</span>

<span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;b&apos;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">a_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;a.id&apos;</span><span class="p">))</span>

    <span class="nd">@validates</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">include_backrefs</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">validate_a</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;B.a validator&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">item</span>

<span class="n">a1</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
<span class="n">a1</span><span class="o">.</span><span class="n">bs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">B</span><span class="p">())</span>  <span class="c1"># prints only &quot;A.bs validator&quot;</span></pre></div></div><p><span class="yiyi-st" id="yiyi-292"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/1535">&#xFF03;1535  T0&gt;</a></span></p></div><div class="section" id="postgresql-json-type"><h3><span class="yiyi-st" id="yiyi-293">Postgresql JSON&#x7C7B;&#x578B;<a class="headerlink" href="#postgresql-json-type" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-294">Postgresql&#x65B9;&#x8A00;&#x73B0;&#x5728;&#x4F7F;&#x7528;<a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.JSON" title="sqlalchemy.dialects.postgresql.JSON"><code class="xref py py-class docutils literal"><span class="pre">postgresql.JSON</span></code></a>&#x7C7B;&#x578B;&#x6765;&#x8865;&#x5145;<a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.HSTORE" title="sqlalchemy.dialects.postgresql.HSTORE"><code class="xref py py-class docutils literal"><span class="pre">postgresql.HSTORE</span></code></a>&#x7C7B;&#x578B;&#x3002;</span></p><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-295">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-296"><a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.JSON" title="sqlalchemy.dialects.postgresql.JSON"><code class="xref py py-class docutils literal"><span class="pre">postgresql.JSON</span></code></a></span></p></div><p><span class="yiyi-st" id="yiyi-297"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2581">&#xFF03;2581  T0&gt;</a></span></p></div><div class="section" id="automap-extension"><h3><span class="yiyi-st" id="yiyi-298">Automap Extension <a class="headerlink" href="#automap-extension" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-299">&#x5728;<strong>0.9.1</strong>&#x4E2D;&#x6DFB;&#x52A0;&#x4E86;&#x4E00;&#x4E2A;&#x65B0;&#x6269;&#x5C55;&#xFF0C;&#x79F0;&#x4E3A;<a class="reference internal" href="orm_extensions_automap.html#module-sqlalchemy.ext.automap" title="sqlalchemy.ext.automap"><code class="xref py py-mod docutils literal"><span class="pre">sqlalchemy.ext.automap</span></code></a>&#x3002;</span><span class="yiyi-st" id="yiyi-300">This is an <strong>experimental</strong> extension which expands upon the functionality of Declarative as well as the <a class="reference internal" href="orm_extensions_declarative_api.html#sqlalchemy.ext.declarative.DeferredReflection" title="sqlalchemy.ext.declarative.DeferredReflection"><code class="xref py py-class docutils literal"><span class="pre">DeferredReflection</span></code></a> class. </span><span class="yiyi-st" id="yiyi-301">Essentially, the extension provides a base class <a class="reference internal" href="orm_extensions_automap.html#sqlalchemy.ext.automap.AutomapBase" title="sqlalchemy.ext.automap.AutomapBase"><code class="xref py py-class docutils literal"><span class="pre">AutomapBase</span></code></a> which automatically generates mapped classes and relationships between them based on given table metadata.</span></p><p><span class="yiyi-st" id="yiyi-302">&#x901A;&#x5E38;&#x4F7F;&#x7528;&#x7684;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.MetaData" title="sqlalchemy.schema.MetaData"><code class="xref py py-class docutils literal"><span class="pre">MetaData</span></code></a>&#x53EF;&#x80FD;&#x901A;&#x8FC7;&#x53CD;&#x5C04;&#x4EA7;&#x751F;&#xFF0C;&#x4F46;&#x4E0D;&#x8981;&#x6C42;&#x4F7F;&#x7528;&#x53CD;&#x5C04;&#x3002;</span><span class="yiyi-st" id="yiyi-303">&#x6700;&#x57FA;&#x672C;&#x7684;&#x7528;&#x6CD5;&#x8BF4;&#x660E;<a class="reference internal" href="orm_extensions_automap.html#module-sqlalchemy.ext.automap" title="sqlalchemy.ext.automap"><code class="xref py py-mod docutils literal"><span class="pre">sqlalchemy.ext.automap</span></code></a>&#x5982;&#x4F55;&#x57FA;&#x4E8E;&#x53CD;&#x5C04;&#x7684;&#x6A21;&#x5F0F;&#x4F20;&#x9012;&#x6620;&#x5C04;&#x7C7B;&#xFF0C;&#x5305;&#x62EC;&#x5173;&#x7CFB;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.ext.automap</span> <span class="kn">import</span> <span class="n">automap_base</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">Session</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>

<span class="n">Base</span> <span class="o">=</span> <span class="n">automap_base</span><span class="p">()</span>

<span class="c1"># engine, suppose it has two tables &apos;user&apos; and &apos;address&apos; set up</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;sqlite:///mydatabase.db&quot;</span><span class="p">)</span>

<span class="c1"># reflect the tables</span>
<span class="n">Base</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="n">reflect</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># mapped classes are now created with names matching that of the table</span>
<span class="c1"># name.</span>
<span class="n">User</span> <span class="o">=</span> <span class="n">Base</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">user</span>
<span class="n">Address</span> <span class="o">=</span> <span class="n">Base</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">address</span>

<span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>

<span class="c1"># rudimentary relationships are produced</span>
<span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Address</span><span class="p">(</span><span class="n">email_address</span><span class="o">=</span><span class="s2">&quot;foo@bar.com&quot;</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">User</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;foo&quot;</span><span class="p">)))</span>
<span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<span class="c1"># collection-based relationships are by default named &quot;&lt;classname&gt;_collection&quot;</span>
<span class="k">print</span><span class="p">(</span><span class="n">u1</span><span class="o">.</span><span class="n">address_collection</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-304">&#x9664;&#x6B64;&#x4E4B;&#x5916;&#xFF0C;<a class="reference internal" href="orm_extensions_automap.html#sqlalchemy.ext.automap.AutomapBase" title="sqlalchemy.ext.automap.AutomapBase"><code class="xref py py-class docutils literal"><span class="pre">AutomapBase</span></code></a>&#x7C7B;&#x662F;&#x58F0;&#x660E;&#x6027;&#x57FA;&#x7840;&#xFF0C;&#x5E76;&#x4E14;&#x652F;&#x6301;&#x6240;&#x6709;&#x58F0;&#x660E;&#x6027;&#x529F;&#x80FD;&#x3002;</span><span class="yiyi-st" id="yiyi-305">&#x201C;&#x81EA;&#x52A8;&#x6620;&#x5C04;&#x201D;&#x529F;&#x80FD;&#x53EF;&#x4EE5;&#x4E0E;&#x73B0;&#x6709;&#x7684;&#x663E;&#x5F0F;&#x58F0;&#x660E;&#x7684;&#x6A21;&#x5F0F;&#x4E00;&#x8D77;&#x4F7F;&#x7528;&#xFF0C;&#x4EE5;&#x4EC5;&#x751F;&#x6210;&#x5173;&#x7CFB;&#x548C;&#x4E22;&#x5931;&#x7684;&#x7C7B;&#x3002;</span><span class="yiyi-st" id="yiyi-306">&#x547D;&#x540D;&#x65B9;&#x6848;&#x548C;&#x5173;&#x7CFB;&#x751F;&#x4EA7;&#x4F8B;&#x7A0B;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x53EF;&#x8C03;&#x7528;&#x51FD;&#x6570;&#x6765;&#x653E;&#x5F03;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-307">It is hoped that the <a class="reference internal" href="orm_extensions_automap.html#sqlalchemy.ext.automap.AutomapBase" title="sqlalchemy.ext.automap.AutomapBase"><code class="xref py py-class docutils literal"><span class="pre">AutomapBase</span></code></a> system provides a quick and modernized solution to the problem that the very famous <a class="reference external" href="https://sqlsoup.readthedocs.io/en/latest/">SQLSoup</a> also tries to solve, that of generating a quick and rudimentary object model from an existing database on the fly. </span><span class="yiyi-st" id="yiyi-308">By addressing the issue strictly at the mapper configuration level, and integrating fully with existing Declarative class techniques, <a class="reference internal" href="orm_extensions_automap.html#sqlalchemy.ext.automap.AutomapBase" title="sqlalchemy.ext.automap.AutomapBase"><code class="xref py py-class docutils literal"><span class="pre">AutomapBase</span></code></a> seeks to provide a well-integrated approach to the issue of expediently auto-generating ad-hoc mappings.</span></p><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-309">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-310"><a class="reference internal" href="orm_extensions_automap.html"><span>Automap</span></a></span></p></div></div></div><div class="section" id="behavioral-improvements"><h2><span class="yiyi-st" id="yiyi-311">&#x884C;&#x4E3A;&#x6539;&#x8FDB;<a class="headerlink" href="#behavioral-improvements" title="Permalink to this headline">&#xB6;</a></span></h2><p><span class="yiyi-st" id="yiyi-312">&#x9664;&#x975E;&#x51FA;&#x73B0;&#x975E;&#x5E38;&#x7F55;&#x89C1;&#x548C;&#x4E0D;&#x5BFB;&#x5E38;&#x7684;&#x5047;&#x8BBE;&#x60C5;&#x51B5;&#xFF0C;&#x5426;&#x5219;&#x5E94;&#x8BE5;&#x4E0D;&#x4F1A;&#x4EA7;&#x751F;&#x517C;&#x5BB9;&#x6027;&#x95EE;&#x9898;&#xFF0C;&#x4F46;&#x5982;&#x679C;&#x51FA;&#x73B0;&#x610F;&#x5916;&#x95EE;&#x9898;&#xFF0C;&#x5219;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x8FD9;&#x4E9B;&#x95EE;&#x9898;&#x3002;</span></p><div class="section" id="many-join-and-left-outer-join-expressions-will-no-longer-be-wrapped-in-select-from-as-anon-1"><h3><span class="yiyi-st" id="yiyi-313">&#x8BB8;&#x591A;JOIN&#x548C;LEFT OUTER JOIN&#x8868;&#x8FBE;&#x5F0F;&#x5C06;&#x4E0D;&#x518D;&#x88AB;&#x5305;&#x542B;&#xFF08;SELECT * FROM ..&#xFF09;AS ANON_1 <a class="headerlink" href="#many-join-and-left-outer-join-expressions-will-no-longer-be-wrapped-in-select-from-as-anon-1" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-314">&#x591A;&#x5E74;&#x4EE5;&#x6765;&#xFF0C;SQLAlchemy ORM&#x4E00;&#x76F4;&#x88AB;&#x963B;&#x6B62;&#x5728;&#x73B0;&#x6709;JOIN&#x7684;&#x53F3;&#x4FA7;&#xFF08;&#x901A;&#x5E38;&#x662F;LEFT OUTER JOIN&#xFF0C;&#x56E0;&#x4E3A;INNER JOIN&#x603B;&#x662F;&#x88AB;&#x538B;&#x5E73;&#xFF09;&#x5D4C;&#x5957;JOIN&#x3002;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT a.*, b.*, c.* FROM a LEFT OUTER JOIN (b JOIN c ON b.id = c.id) ON a.id</pre></div></div><p><span class="yiyi-st" id="yiyi-315">&#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#x76F4;&#x5230;&#x7248;&#x672C;<strong>3.7.16</strong>&#x7684;SQLite&#x65E0;&#x6CD5;&#x89E3;&#x6790;&#x4E0A;&#x8FF0;&#x683C;&#x5F0F;&#x7684;&#x8BED;&#x53E5;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SQLite version 3.7.15.2 2013-01-09 11:53:05
Enter &quot;.help&quot; for instructions
Enter SQL statements terminated with a &quot;;&quot;
sqlite&gt; create table a(id integer);
sqlite&gt; create table b(id integer);
sqlite&gt; create table c(id integer);
sqlite&gt; select a.id, b.id, c.id from a left outer join (b join c on b.id=c.id) on b.id=a.id;
Error: no such column: b.id</pre></div></div><p><span class="yiyi-st" id="yiyi-316">&#x53F3;&#x5916;&#x8FDE;&#x63A5;&#x5F53;&#x7136;&#x662F;&#x89E3;&#x51B3;&#x53F3;&#x62EC;&#x53F7;&#x7684;&#x53E6;&#x4E00;&#x79CD;&#x65B9;&#x6CD5;&#xFF1B;&#x8FD9;&#x5C06;&#x4F1A;&#x975E;&#x5E38;&#x590D;&#x6742;&#x5E76;&#x4E14;&#x5728;&#x89C6;&#x89C9;&#x4E0A;&#x5F88;&#x96BE;&#x5B9E;&#x73B0;&#xFF0C;&#x4F46;&#x5E78;&#x8FD0;&#x7684;&#x662F;SQLite&#x4E0D;&#x652F;&#x6301;RIGHT OUTER JOIN :)&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>sqlite&gt; select a.id, b.id, c.id from b join c on b.id=c.id
   ...&gt; right outer join a on b.id=a.id;
Error: RIGHT and FULL OUTER JOINs are not currently supported</pre></div></div><p><span class="yiyi-st" id="yiyi-317">&#x65E9;&#x5728;2005&#x5E74;&#xFF0C;&#x76EE;&#x524D;&#x8FD8;&#x4E0D;&#x6E05;&#x695A;&#x5176;&#x4ED6;&#x6570;&#x636E;&#x5E93;&#x662F;&#x5426;&#x5B58;&#x5728;&#x8FD9;&#x79CD;&#x5F62;&#x5F0F;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x4F46;&#x4ECA;&#x5929;&#x4F3C;&#x4E4E;&#x5F88;&#x6E05;&#x695A;&#xFF0C;&#x9664;&#x4E86;SQLite&#x4E4B;&#x5916;&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A;&#x6D4B;&#x8BD5;&#x6570;&#x636E;&#x5E93;&#x90FD;&#x80FD;&#x591F;&#x652F;&#x6301;&#x5B83;&#xFF08;Oracle 8&#x662F;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x53E4;&#x8001;&#x7684;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x6839;&#x672C;&#x4E0D;&#x652F;&#x6301;JOIN&#x5173;&#x952E;&#x5B57;&#xFF0C;&#x4F46;&#x5BF9;&#x4E8E;Oracle&#x7684;&#x8BED;&#x6CD5;&#xFF0C;SQLAlchemy&#x603B;&#x662F;&#x6709;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x91CD;&#x5199;&#x65B9;&#x6848;&#xFF09;&#x3002;</span><span class="yiyi-st" id="yiyi-318">&#x66F4;&#x7CDF;&#x7CD5;&#x7684;&#x662F;&#xFF0C;&#x5E94;&#x7528;SELECT&#x7684;SQLAlchemy&#x901A;&#x5E38;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#x901A;&#x5E38;&#x4F1A;&#x964D;&#x4F4E;Postgresql&#x548C;MySQL&#x7B49;&#x5E73;&#x53F0;&#x7684;&#x6027;&#x80FD;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT a.*, anon_1.* FROM a LEFT OUTER JOIN (
                SELECT b.id AS b_id, c.id AS c_id
                FROM b JOIN c ON b.id = c.id
            ) AS anon_1 ON a.id=anon_1.b_id</pre></div></div><p><span class="yiyi-st" id="yiyi-319">&#x4F7F;&#x7528;&#x8FDE;&#x63A5;&#x8868;&#x7EE7;&#x627F;&#x7ED3;&#x6784;&#x65F6;&#xFF0C;&#x50CF;&#x4EE5;&#x4E0A;&#x5F62;&#x5F0F;&#x7684;JOIN&#x5E38;&#x89C1;&#xFF1B;&#x4EFB;&#x4F55;&#x65F6;&#x5019;<a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query.join" title="sqlalchemy.orm.query.Query.join"><code class="xref py py-meth docutils literal"><span class="pre">Query.join()</span></code></a>&#x7528;&#x4E8E;&#x4ECE;&#x67D0;&#x4E2A;&#x7236;&#x8282;&#x70B9;&#x8FDE;&#x63A5;&#x5230;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;&#x8868;&#x5B50;&#x7C7B;&#xFF0C;&#x6216;&#x8005;&#x5F53;&#x7C7B;&#x4F3C;&#x5730;&#x4F7F;&#x7528;<a class="reference internal" href="orm_loading_relationships.html#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal"><span class="pre">joinedload()</span></code></a>&#x65F6;&#xFF0C;SQLAlchemy&#x7684;ORM&#x5C06;&#x59CB;&#x7EC8;&#x786E;&#x4FDD;&#x4E3A;&#x907F;&#x514D;&#x67E5;&#x8BE2;&#x65E0;&#x6CD5;&#x5728;SQLite&#x4E0A;&#x8FD0;&#x884C;&#xFF0C;&#x5D4C;&#x5957;&#x7684;JOIN&#x6C38;&#x8FDC;&#x4E0D;&#x4F1A;&#x5448;&#x73B0;&#x3002;</span><span class="yiyi-st" id="yiyi-320">&#x5C3D;&#x7BA1;Core&#x4E00;&#x76F4;&#x652F;&#x6301;&#x66F4;&#x52A0;&#x7D27;&#x51D1;&#x7684;&#x5F62;&#x5F0F;&#xFF0C;&#x4F46;ORM&#x5FC5;&#x987B;&#x907F;&#x514D;&#x5B83;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-321">&#x5728;ON&#x5B50;&#x53E5;&#x4E2D;&#x5B58;&#x5728;&#x7279;&#x6B8A;&#x6807;&#x51C6;&#x7684;&#x591A;&#x5BF9;&#x591A;&#x5173;&#x7CFB;&#x4E2D;&#x4EA7;&#x751F;&#x8FDE;&#x63A5;&#x65F6;&#xFF0C;&#x4F1A;&#x51FA;&#x73B0;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#x3002;</span><span class="yiyi-st" id="yiyi-322">&#x8003;&#x8651;&#x50CF;&#x4E0B;&#x9762;&#x8FD9;&#x6837;&#x7684;&#x70ED;&#x5207;&#x52A0;&#x8F7D;&#x8FDE;&#x63A5;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Order</span><span class="p">)</span><span class="o">.</span><span class="n">outerjoin</span><span class="p">(</span><span class="n">Order</span><span class="o">.</span><span class="n">items</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-323">&#x5047;&#x8BBE;&#x4ECE;<code class="docutils literal"><span class="pre">Order</span></code>&#x5230;<code class="docutils literal"><span class="pre">Item</span></code>&#x7684;&#x591A;&#x5BF9;&#x591A;&#x5B9E;&#x9645;&#x4E0A;&#x6307;&#x7684;&#x662F;&#x50CF;<code class="docutils literal"><span class="pre">Subitem</span></code>&#x8FD9;&#x6837;&#x7684;&#x5B50;&#x7C7B;&#xFF0C;&#x4E0A;&#x8FF0;&#x7684;SQL&#x5C06;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT order.id, order.name
FROM order LEFT OUTER JOIN order_item ON order.id = order_item.order_id
LEFT OUTER JOIN item ON order_item.item_id = item.id AND item.type = &apos;subitem&apos;</pre></div></div><p><span class="yiyi-st" id="yiyi-324">&#x4E0A;&#x8FF0;&#x67E5;&#x8BE2;&#x6709;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#xFF1F;</span><span class="yiyi-st" id="yiyi-325">&#x57FA;&#x672C;&#x4E0A;&#xFF0C;&#x5B83;&#x4F1A;&#x52A0;&#x8F7D;&#x5F88;&#x591A;<code class="docutils literal"><span class="pre">order</span></code> / <code class="docutils literal"><span class="pre">order_item</span></code>&#x884C;&#xFF0C;&#x5176;&#x4E2D;<code class="docutils literal"><span class="pre">item.type</span> <span class="pre">==  t6 &gt; <span class="pre">&apos;&#x5B50;&#x9879;&apos;</span></span></code>&#x4E0D;&#x6B63;&#x786E;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-326">&#x4ECE;SQLAlchemy 0.9&#x5F00;&#x59CB;&#xFF0C;&#x6211;&#x4EEC;&#x91C7;&#x7528;&#x4E86;&#x4E00;&#x79CD;&#x5168;&#x65B0;&#x7684;&#x65B9;&#x6CD5;&#x3002;</span><span class="yiyi-st" id="yiyi-327">ORM&#x4E0D;&#x518D;&#x62C5;&#x5FC3;&#x5728;&#x5C01;&#x95ED;JOIN&#x7684;&#x53F3;&#x4FA7;&#x5D4C;&#x5957;JOIN&#xFF0C;&#x73B0;&#x5728;&#x5B83;&#x5C06;&#x5C3D;&#x53EF;&#x80FD;&#x7ECF;&#x5E38;&#x5730;&#x6E32;&#x67D3;&#x8FD9;&#x4E9B;&#xFF0C;&#x540C;&#x65F6;&#x4ECD;&#x7136;&#x8FD4;&#x56DE;&#x6B63;&#x786E;&#x7684;&#x7ED3;&#x679C;&#x3002;</span><span class="yiyi-st" id="yiyi-328">&#x5F53;&#x4F20;&#x9012;SQL&#x8BED;&#x53E5;&#x8FDB;&#x884C;&#x7F16;&#x8BD1;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x5DF2;&#x77E5;&#x8BE5;&#x540E;&#x7AEF;&#x4E0D;&#x652F;&#x6301;&#x53F3;&#x5D4C;&#x5957;JOIN&#xFF0C;&#x5219;<strong>dialect&#x7F16;&#x8BD1;&#x5668;</strong>&#x5C06;<strong>&#x91CD;&#x5199;&#x8FDE;&#x63A5;</strong>&#x4EE5;&#x9002;&#x5E94;&#x76EE;&#x6807;&#x540E;&#x7AEF;&#xFF08;&#x76EE;&#x524D;&#x53EA;&#x6709;SQLite  - &#x5982;&#x679C;&#x5176;&#x4ED6;&#x540E;&#x7AEF;&#x6709;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x8BF7;&#x8BA9;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#xFF01;</span><span class="yiyi-st" id="yiyi-329">&#xFF09;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-330">&#x6240;&#x4EE5;&#x4E00;&#x4E2A;&#x666E;&#x901A;&#x7684;<code class="docutils literal"><span class="pre">query(Parent).join(Subclass)</span></code>&#x73B0;&#x5728;&#x901A;&#x5E38;&#x4F1A;&#x4EA7;&#x751F;&#x4E00;&#x4E2A;&#x66F4;&#x7B80;&#x5355;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT parent.id AS parent_id
FROM parent JOIN (
        base_table JOIN subclass_table
        ON base_table.id = subclass_table.id) ON parent.id = base_table.parent_id</pre></div></div><p><span class="yiyi-st" id="yiyi-331">&#x52A0;&#x5165;&#x50CF;<code class="docutils literal"><span class="pre">query(Parent).options(joinedload(Parent.subclasses))</span></code>&#x8FD9;&#x6837;&#x7684;&#x9884;&#x5148;&#x52A0;&#x8F7D;&#x5C06;&#x66FF;&#x6362;&#x4E2A;&#x522B;&#x8868;&#x800C;&#x4E0D;&#x662F;&#x5305;&#x88C5;&#x5728;<code class="docutils literal"><span class="pre">ANON_1</span></code>&#x4E2D;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT parent.*, base_table_1.*, subclass_table_1.* FROM parent
    LEFT OUTER JOIN (
        base_table AS base_table_1 JOIN subclass_table AS subclass_table_1
        ON base_table_1.id = subclass_table_1.id)
        ON parent.id = base_table_1.parent_id</pre></div></div><p><span class="yiyi-st" id="yiyi-332">&#x591A;&#x5BF9;&#x591A;&#x8FDE;&#x63A5;&#x548C;eagerloads&#x5C06;&#x5D4C;&#x5957;&#x201C;&#x6B21;&#x201D;&#x548C;&#x201C;&#x53F3;&#x201D;&#x8868;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT order.id, order.name
FROM order LEFT OUTER JOIN
(order_item JOIN item ON order_item.item_id = item.id AND item.type = &apos;subitem&apos;)
ON order_item.order_id = order.id</pre></div></div><p><span class="yiyi-st" id="yiyi-333">&#x6240;&#x6709;&#x8FD9;&#x4E9B;&#x8FDE;&#x63A5;&#x5728;&#x4F7F;&#x7528;&#x7279;&#x522B;&#x6307;&#x5B9A;<code class="docutils literal"><span class="pre">use_labels=True</span></code>&#x7684;<a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal"><span class="pre">Select</span></code></a>&#x8BED;&#x53E5;&#x8FDB;&#x884C;&#x5448;&#x73B0;&#x65F6;&#xFF08;&#x5BF9;&#x4E8E;ORM&#x53D1;&#x51FA;&#x7684;&#x6240;&#x6709;&#x67E5;&#x8BE2;&#x90FD;&#x662F;&#x5982;&#x6B64;&#xFF09;&#xFF0C;&#x8FD9;&#x4E9B;&#x8FDE;&#x63A5;&#x90FD;&#x662F;&#x201C;&#x8FDE;&#x63A5;&#x91CD;&#x5199;&#x201D; &#xFF0C;&#x8FD9;&#x662F;&#x5C06;&#x6240;&#x6709;&#x8FD9;&#x4E9B;&#x53F3;&#x5D4C;&#x5957;&#x8FDE;&#x63A5;&#x91CD;&#x5199;&#x4E3A;&#x5D4C;&#x5957;SELECT&#x8BED;&#x53E5;&#x7684;&#x8FC7;&#x7A0B;&#xFF0C;&#x540C;&#x65F6;&#x4FDD;&#x6301;&#x7531;<a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal"><span class="pre">Select</span></code></a>&#x4F7F;&#x7528;&#x7684;&#x76F8;&#x540C;&#x6807;&#x7B7E;&#x3002;</span><span class="yiyi-st" id="yiyi-334">&#x56E0;&#x6B64;SQLite&#x5373;&#x4F7F;&#x5728;2013&#x5E74;&#x4E5F;&#x4E0D;&#x652F;&#x6301;&#x8FD9;&#x79CD;&#x975E;&#x5E38;&#x5E38;&#x89C1;&#x7684;SQL&#x8BED;&#x6CD5;&#x7684;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#x672C;&#x8EAB;&#x5C31;&#x5177;&#x6709;&#x989D;&#x5916;&#x7684;&#x590D;&#x6742;&#x6027;&#xFF0C;&#x4E0A;&#x9762;&#x7684;&#x67E5;&#x8BE2;&#x88AB;&#x91CD;&#x5199;&#x4E3A;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>-- sqlite only!
SELECT parent.id AS parent_id
    FROM parent JOIN (
        SELECT base_table.id AS base_table_id,
                base_table.parent_id AS base_table_parent_id,
                subclass_table.id AS subclass_table_id
        FROM base_table JOIN subclass_table ON base_table.id = subclass_table.id
    ) AS anon_1 ON parent.id = anon_1.base_table_parent_id

-- sqlite only!
SELECT parent.id AS parent_id, anon_1.subclass_table_1_id AS subclass_table_1_id,
        anon_1.base_table_1_id AS base_table_1_id,
        anon_1.base_table_1_parent_id AS base_table_1_parent_id
FROM parent LEFT OUTER JOIN (
    SELECT base_table_1.id AS base_table_1_id,
        base_table_1.parent_id AS base_table_1_parent_id,
        subclass_table_1.id AS subclass_table_1_id
    FROM base_table AS base_table_1
    JOIN subclass_table AS subclass_table_1 ON base_table_1.id = subclass_table_1.id
) AS anon_1 ON parent.id = anon_1.base_table_1_parent_id

-- sqlite only!
SELECT &quot;order&quot;.id AS order_id
FROM &quot;order&quot; LEFT OUTER JOIN (
        SELECT order_item_1.order_id AS order_item_1_order_id,
            order_item_1.item_id AS order_item_1_item_id,
            item.id AS item_id, item.type AS item_type
FROM order_item AS order_item_1
    JOIN item ON item.id = order_item_1.item_id AND item.type IN (?)
) AS anon_1 ON &quot;order&quot;.id = anon_1.order_item_1_order_id</pre></div></div><div class="admonition note"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-335">&#x6CE8;&#x610F;</span></p><p class="last"><span class="yiyi-st" id="yiyi-336">&#x4ECE;SQLAlchemy 1.1&#x5F00;&#x59CB;&#xFF0C;&#x5F53;SQLite&#x7248;&#x672C;<strong>3.7.16</strong>&#x6216;&#x66F4;&#x9AD8;&#x7248;&#x672C;&#x88AB;&#x68C0;&#x6D4B;&#x5230;&#x65F6;&#xFF0C;SQLite&#x6B64;&#x529F;&#x80FD;&#x4E2D;&#x7684;&#x53D8;&#x901A;&#x65B9;&#x6CD5;&#x5C06;&#x81EA;&#x52A8;&#x7981;&#x7528;&#xFF0C;&#x56E0;&#x4E3A;SQLite&#x4FEE;&#x590D;&#x4E86;&#x5BF9;&#x53F3;&#x5D4C;&#x5957;&#x8FDE;&#x63A5;&#x7684;&#x652F;&#x6301;&#x3002;</span></p></div><p><span class="yiyi-st" id="yiyi-337">&#x73B0;&#x5728;&#xFF0C;<a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.Join.alias" title="sqlalchemy.sql.expression.Join.alias"><code class="xref py py-meth docutils literal"><span class="pre">Join.alias()</span></code></a>&#xFF0C;<a class="reference internal" href="orm_query.html#sqlalchemy.orm.aliased" title="sqlalchemy.orm.aliased"><code class="xref py py-func docutils literal"><span class="pre">aliased()</span></code></a>&#x548C;<a class="reference internal" href="orm_inheritance.html#sqlalchemy.orm.with_polymorphic" title="sqlalchemy.orm.with_polymorphic"><code class="xref py py-func docutils literal"><span class="pre">with_polymorphic()</span></code></a>&#x51FD;&#x6570;&#x652F;&#x6301;&#x4E00;&#x4E2A;&#x65B0;&#x53C2;&#x6570;<code class="docutils literal"><span class="pre">flat=True</span></code></span><span class="yiyi-st" id="yiyi-338">&#x6B64;&#x6807;&#x5FD7;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#x4E0D;&#x4F1A;&#x542F;&#x7528;&#xFF0C;&#x4EE5;&#x5E2E;&#x52A9;&#x5B9E;&#x73B0;&#x5411;&#x540E;&#x517C;&#x5BB9;&#x6027; - &#x4F46;&#x73B0;&#x5728;&#xFF0C;&#x53EF;&#x9009;&#x62E9;&#x7684;&#x201C;polymorhpic&#x201D;&#x53EF;&#x4F5C;&#x4E3A;&#x76EE;&#x6807;&#x800C;&#x4E0D;&#x751F;&#x6210;&#x4EFB;&#x4F55;&#x5B50;&#x67E5;&#x8BE2;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">employee_alias</span> <span class="o">=</span> <span class="n">with_polymorphic</span><span class="p">(</span><span class="n">Person</span><span class="p">,</span> <span class="p">[</span><span class="n">Engineer</span><span class="p">,</span> <span class="n">Manager</span><span class="p">],</span> <span class="n">flat</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Company</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="n">Company</span><span class="o">.</span><span class="n">employees</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">employee_alias</span><span class="p">)</span>
                <span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                    <span class="n">or_</span><span class="p">(</span>
                        <span class="n">Engineer</span><span class="o">.</span><span class="n">primary_language</span> <span class="o">==</span> <span class="s1">&apos;python&apos;</span><span class="p">,</span>
                        <span class="n">Manager</span><span class="o">.</span><span class="n">manager_name</span> <span class="o">==</span> <span class="s1">&apos;dilbert&apos;</span>
                    <span class="p">)</span>
                <span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-339">&#x751F;&#x6210;&#xFF08;&#x9664;&#x4E86;SQLite&#x4EE5;&#x5916;&#xFF09;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT companies.company_id AS companies_company_id, companies.name AS companies_name
FROM companies JOIN (
    people AS people_1
    LEFT OUTER JOIN engineers AS engineers_1 ON people_1.person_id = engineers_1.person_id
    LEFT OUTER JOIN managers AS managers_1 ON people_1.person_id = managers_1.person_id
) ON companies.company_id = people_1.company_id
WHERE engineers.primary_language = %(primary_language_1)s
    OR managers.manager_name = %(manager_name_1)s</pre></div></div><p><span class="yiyi-st" id="yiyi-340"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2369">&#xFF03;2369</a> <a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2587">&#xFF03;2587</a></span></p></div><div class="section" id="right-nested-inner-joins-available-in-joined-eager-loads"><h3><span class="yiyi-st" id="yiyi-341">&#x53F3;&#x8FDE;&#x63A5;&#x7684;&#x5185;&#x90E8;&#x8FDE;&#x63A5;&#x53EF;&#x7528;&#x4E8E;&#x8FDE;&#x63A5;&#x7684;&#x9884;&#x5148;&#x52A0;&#x8F7D;<a class="headerlink" href="#right-nested-inner-joins-available-in-joined-eager-loads" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-342">&#x4ECE;&#x7248;&#x672C;0.9.4&#x5F00;&#x59CB;&#xFF0C;&#x4E0A;&#x9762;&#x63D0;&#x5230;&#x7684;&#x53F3;&#x5D4C;&#x5957;&#x8FDE;&#x63A5;&#x53EF;&#x4EE5;&#x5728;&#x52A0;&#x5165;&#x7684;&#x70ED;&#x5207;&#x52A0;&#x8F7D;&#x60C5;&#x51B5;&#x4E0B;&#x542F;&#x7528;&#xFF0C;&#x5176;&#x4E2D;&#x201C;&#x5916;&#x90E8;&#x201D;&#x8FDE;&#x63A5;&#x4E0E;&#x53F3;&#x4FA7;&#x7684;&#x201C;&#x5185;&#x90E8;&#x201D;&#x8FDE;&#x63A5;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-343">&#x901A;&#x5E38;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x52A0;&#x5165;&#x4E00;&#x4E2A;&#x50CF;&#x4EE5;&#x4E0B;&#x8FD9;&#x6837;&#x7684;&#x70ED;&#x5207;&#x52A0;&#x8F7D;&#x94FE;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">joinedload</span><span class="p">(</span><span class="s2">&quot;orders&quot;</span><span class="p">,</span> <span class="n">innerjoin</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">joinedload</span><span class="p">(</span><span class="s2">&quot;items&quot;</span><span class="p">,</span> <span class="n">innerjoin</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-344">&#x4E0D;&#x4F1A;&#x4EA7;&#x751F;&#x5185;&#x8FDE;&#x63A5;&#xFF1B;&#x7531;&#x4E8E;&#x6765;&#x81EA;&#x7528;&#x6237; - &gt;&#x8BA2;&#x5355;&#x7684;LEFT OUTER JOIN&#xFF0C;&#x6240;&#x4EE5;&#x52A0;&#x5165;&#x7684;&#x9884;&#x52A0;&#x8F7D;&#x65E0;&#x6CD5;&#x4F7F;&#x7528;&#x6765;&#x81EA;order-&gt; items&#x7684;INNER&#x8FDE;&#x63A5;&#xFF0C;&#x800C;&#x65E0;&#x9700;&#x66F4;&#x6539;&#x8FD4;&#x56DE;&#x7684;&#x7528;&#x6237;&#x884C;&#xFF0C;&#x800C;&#x662F;&#x5FFD;&#x7565;&#x201C;&#x94FE;&#x63A5;&#x201D;<code class="docutils literal"><span class="pre">innerjoin=True</span></code></span><span class="yiyi-st" id="yiyi-345">0.9.0&#x5E94;&#x8BE5;&#x5982;&#x4F55;&#x5B9E;&#x73B0;&#x8FD9;&#x5C06;&#x662F;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>FROM users LEFT OUTER JOIN orders ON &lt;onclause&gt; LEFT OUTER JOIN items ON &lt;onclause&gt;</pre></div></div><p><span class="yiyi-st" id="yiyi-346">&#x65B0;&#x7684;&#x201C;&#x53F3;&#x5D4C;&#x5957;&#x8FDE;&#x63A5;&#x662F;&#x597D;&#x7684;&#x201D;&#x903B;&#x8F91;&#x4F1A;&#x542F;&#x52A8;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x5F97;&#x5230;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>FROM users LEFT OUTER JOIN (orders JOIN items ON &lt;onclause&gt;) ON &lt;onclause&gt;</pre></div></div><p><span class="yiyi-st" id="yiyi-347">&#x7531;&#x4E8E;&#x6211;&#x4EEC;&#x9519;&#x8FC7;&#x4E86;&#x8FD9;&#x4E00;&#x70B9;&#xFF0C;&#x4E3A;&#x4E86;&#x907F;&#x514D;&#x8FDB;&#x4E00;&#x6B65;&#x7684;&#x56DE;&#x5F52;&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x6307;&#x5B9A;&#x5B57;&#x7B26;&#x4E32;<code class="docutils literal"><span class="pre">&quot;nested&quot;</span></code>&#x5230;<a class="reference internal" href="orm_loading_relationships.html#sqlalchemy.orm.joinedload.params.innerjoin" title="sqlalchemy.orm.joinedload"><code class="xref py py-paramref docutils literal"><span class="pre">joinedload.innerjoin</span></code></a>&#x6DFB;&#x52A0;&#x4E86;&#x4E0A;&#x8FF0;&#x529F;&#x80FD;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">joinedload</span><span class="p">(</span><span class="s2">&quot;orders&quot;</span><span class="p">,</span> <span class="n">innerjoin</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">joinedload</span><span class="p">(</span><span class="s2">&quot;items&quot;</span><span class="p">,</span> <span class="n">innerjoin</span><span class="o">=</span><span class="s2">&quot;nested&quot;</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-348">&#x8FD9;&#x4E2A;&#x7279;&#x6027;&#x5728;0.9.4&#x4E2D;&#x662F;&#x65B0;&#x7684;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-349"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2976">&#xFF03;2976  T0&gt;</a></span></p></div><div class="section" id="orm-can-efficiently-fetch-just-generated-insert-update-defaults-using-returning"><h3><span class="yiyi-st" id="yiyi-350">ORM&#x53EF;&#x4EE5;&#x4F7F;&#x7528;RETURNING <a class="headerlink" href="#orm-can-efficiently-fetch-just-generated-insert-update-defaults-using-returning" title="Permalink to this headline">&#xB6;</a>&#x9AD8;&#x6548;&#x5730;&#x83B7;&#x53D6;&#x521A;&#x751F;&#x6210;&#x7684;INSERT / UPDATE&#x9ED8;&#x8BA4;&#x503C;</span></h3><p><span class="yiyi-st" id="yiyi-351"><a class="reference internal" href="orm_mapping_api.html#sqlalchemy.orm.mapper.Mapper" title="sqlalchemy.orm.mapper.Mapper"><code class="xref py py-class docutils literal"><span class="pre">Mapper</span></code></a>&#x957F;&#x671F;&#x4EE5;&#x6765;&#x652F;&#x6301;&#x4E00;&#x4E2A;&#x540D;&#x4E3A;<code class="docutils literal"><span class="pre">eager_defaults=True</span></code>&#x7684;&#x672A;&#x516C;&#x5F00;&#x6807;&#x5FD7;&#x3002;</span><span class="yiyi-st" id="yiyi-352">&#x6B64;&#x6807;&#x5FD7;&#x7684;&#x4F5C;&#x7528;&#x662F;&#xFF0C;&#x5F53;INSERT&#x6216;UPDATE&#x8FDB;&#x884C;&#x65F6;&#xFF0C;&#x5E76;&#x4E14;&#x8BE5;&#x884C;&#x5DF2;&#x77E5;&#x5177;&#x6709;&#x670D;&#x52A1;&#x5668;&#x751F;&#x6210;&#x7684;&#x9ED8;&#x8BA4;&#x503C;&#x65F6;&#xFF0C;SELECT&#x4F1A;&#x7ACB;&#x5373;&#x8DDF;&#x968F;&#x5B83;&#xFF0C;&#x4EE5;&#x4FBF;&#x201C;&#x70ED;&#x5207;&#x201D;&#x5730;&#x52A0;&#x8F7D;&#x8FD9;&#x4E9B;&#x65B0;&#x503C;&#x3002;</span><span class="yiyi-st" id="yiyi-353">&#x901A;&#x5E38;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x751F;&#x6210;&#x7684;&#x5217;&#x5728;&#x5BF9;&#x8C61;&#x4E0A;&#x88AB;&#x6807;&#x8BB0;&#x4E3A;&#x201C;&#x8FC7;&#x671F;&#x201D;&#xFF0C;&#x56E0;&#x6B64;&#x9664;&#x975E;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5728;&#x5237;&#x65B0;&#x540E;&#x5B9E;&#x9645;&#x8BBF;&#x95EE;&#x8FD9;&#x4E9B;&#x5217;&#xFF0C;&#x5426;&#x5219;&#x4E0D;&#x4F1A;&#x4EA7;&#x751F;&#x5F00;&#x9500;&#x3002;</span><span class="yiyi-st" id="yiyi-354">&#x56E0;&#x6B64;&#xFF0C;<code class="docutils literal"><span class="pre">eager_defaults</span></code>&#x6807;&#x5FD7;&#x6CA1;&#x6709;&#x591A;&#x5927;&#x7528;&#x5904;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x53EA;&#x80FD;&#x964D;&#x4F4E;&#x6027;&#x80FD;&#xFF0C;&#x5E76;&#x4E14;&#x4EC5;&#x7528;&#x4E8E;&#x652F;&#x6301;&#x5F02;&#x5E38;&#x4E8B;&#x4EF6;&#x65B9;&#x6848;&#xFF0C;&#x7528;&#x6237;&#x9700;&#x8981;&#x5728;&#x5237;&#x65B0;&#x8FC7;&#x7A0B;&#x4E2D;&#x7ACB;&#x5373;&#x4F7F;&#x7528;&#x9ED8;&#x8BA4;&#x503C;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-355">&#x5728;0.9&#x7248;&#x672C;&#x4E2D;&#xFF0C;&#x7531;&#x4E8E;&#x7248;&#x672C;ID&#x589E;&#x5F3A;&#xFF0C;&#x73B0;&#x5728;<code class="docutils literal"><span class="pre">eager_defaults</span></code>&#x53EF;&#x4EE5;&#x4E3A;&#x8FD9;&#x4E9B;&#x503C;&#x53D1;&#x51FA;RETURNING&#x5B50;&#x53E5;&#xFF0C;&#x56E0;&#x6B64;&#x5728;&#x5177;&#x6709;&#x5F3A;&#x5927;&#x7684;RETURNING&#x652F;&#x6301;&#x7279;&#x522B;&#x662F;Postgresql&#x7684;&#x540E;&#x7AEF;&#x4E0A;&#xFF0C;ORM&#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x65B0;&#x751F;&#x6210;&#x7684;&#x9ED8;&#x8BA4;&#x503C;SQL&#x8868;&#x8FBE;&#x5F0F;&#x503C;&#x4E0E;INSERT&#x6216;UPDATE&#x5185;&#x8054;&#x3002;</span><span class="yiyi-st" id="yiyi-356"><code class="docutils literal"><span class="pre">eager_defaults</span></code>, when enabled, makes use of RETURNING automatically when the target backend and <a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal"><span class="pre">Table</span></code></a> supports &#x201C;implicit returning&#x201D;.</span></p></div><div class="section" id="subquery-eager-loading-will-apply-distinct-to-the-innermost-select-for-some-queries"><h3><span class="yiyi-st" id="yiyi-357">&#x5B50;&#x67E5;&#x8BE2;Eager Loading&#x5C06;&#x5BF9;&#x67D0;&#x4E9B;&#x67E5;&#x8BE2;&#x7684;&#x6700;&#x5185;&#x5C42;SELECT&#x5E94;&#x7528;DISTINCT <a class="headerlink" href="#subquery-eager-loading-will-apply-distinct-to-the-innermost-select-for-some-queries" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-358">&#x4E3A;&#x4E86;&#x51CF;&#x5C11;&#x5728;&#x6D89;&#x53CA;&#x591A;&#x5BF9;&#x4E00;&#x5173;&#x7CFB;&#x65F6;&#x901A;&#x8FC7;&#x5B50;&#x67E5;&#x8BE2;&#x9884;&#x52A0;&#x8F7D;&#x53EF;&#x4EE5;&#x751F;&#x6210;&#x7684;&#x91CD;&#x590D;&#x884C;&#x7684;&#x6570;&#x91CF;&#xFF0C;&#x5F53;&#x8FDE;&#x63A5;&#x5C06;&#x76EE;&#x6807;&#x5217;&#x6307;&#x5B9A;&#x4E3A;&#x4E0D;&#x5305;&#x542B;&#x591A;&#x5BF9;&#x4E00;&#x5173;&#x7CFB;&#x7684;&#x5217;&#x65F6;&#xFF0C;DISTINCT&#x5173;&#x952E;&#x5B57;&#x5C06;&#x5E94;&#x7528;&#x4E8E;&#x6700;&#x5185;&#x5C42;&#x7684;SELECT&#x4E3B;&#x952E;&#xFF0C;&#x5C31;&#x50CF;&#x5728;&#x591A;&#x5BF9;&#x4E00;&#x65F6;&#x52A0;&#x8F7D;&#x4E00;&#x6837;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-359">&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x5F53;&#x4ECE;A-&gt; B&#x8FDB;&#x884C;&#x591A;&#x5BF9;&#x4E00;&#x7684;&#x5B50;&#x67E5;&#x8BE2;&#x52A0;&#x8F7D;&#x65F6;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT b.id AS b_id, b.name AS b_name, anon_1.b_id AS a_b_id
FROM (SELECT DISTINCT a_b_id FROM a) AS anon_1
JOIN b ON b.id = anon_1.a_b_id</pre></div></div><p><span class="yiyi-st" id="yiyi-360">&#x7531;&#x4E8E;<code class="docutils literal"><span class="pre">a.b_id</span></code>&#x662F;&#x975E;&#x4E0D;&#x540C;&#x7684;&#x5916;&#x952E;&#xFF0C;&#x6240;&#x4EE5;&#x5E94;&#x7528;DISTINCT&#x4EE5;&#x6D88;&#x9664;&#x591A;&#x4F59;&#x7684;<code class="docutils literal"><span class="pre">a.b_id</span></code>&#x3002;</span><span class="yiyi-st" id="yiyi-361">&#x53EF;&#x4EE5;&#x4F7F;&#x7528;flag <code class="docutils literal"><span class="pre">distinct_target_key</span></code>&#x4E3A;&#x7279;&#x5B9A;&#x7684;<a class="reference internal" href="orm_relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal"><span class="pre">relationship()</span></code></a>&#x65E0;&#x6761;&#x4EF6;&#x5730;&#x6253;&#x5F00;&#x6216;&#x5173;&#x95ED;&#x884C;&#x4E3A;&#xFF0C;&#x5C06;&#x503C;&#x8BBE;&#x7F6E;&#x4E3A;<code class="docutils literal"><span class="pre">True</span></code>&#x4EE5;&#x65E0;&#x6761;&#x4EF6;&#x5F00;&#x542F;&#xFF0C; <code class="docutils literal"><span class="pre">False</span></code>&#x8868;&#x793A;&#x65E0;&#x6761;&#x4EF6;&#x5173;&#x95ED;&#xFF0C;&#x800C;<code class="docutils literal"><span class="pre">None</span></code>&#x8868;&#x793A;&#x5F53;&#x76EE;&#x6807;SELECT&#x9488;&#x5BF9;&#x4E0D;&#x5305;&#x542B;&#x5B8C;&#x6574;&#x4E3B;&#x952E;&#x7684;&#x5217;&#x65F6;&#xFF0C;&#x6B64;&#x529F;&#x80FD;&#x624D;&#x4F1A;&#x751F;&#x6548;&#x3002;</span><span class="yiyi-st" id="yiyi-362">&#x5728;0.9&#x4E2D;&#xFF0C;<code class="docutils literal"><span class="pre">None</span></code>&#x662F;&#x9ED8;&#x8BA4;&#x503C;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-363">&#x8BE5;&#x9009;&#x9879;&#x4E5F;&#x88AB;&#x53CD;&#x5411;&#x79FB;&#x690D;&#x5230;0.8&#xFF0C;&#x5176;&#x4E2D;<code class="docutils literal"><span class="pre">distinct_target_key</span></code>&#x9009;&#x9879;&#x9ED8;&#x8BA4;&#x4E3A;<code class="docutils literal"><span class="pre">False</span></code>&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-364">&#x867D;&#x7136;&#x6B64;&#x529F;&#x80FD;&#x65E8;&#x5728;&#x901A;&#x8FC7;&#x6D88;&#x9664;&#x91CD;&#x590D;&#x884C;&#x6765;&#x63D0;&#x9AD8;&#x6027;&#x80FD;&#xFF0C;&#x4F46;SQL&#x672C;&#x8EAB;&#x4E2D;&#x7684;<code class="docutils literal"><span class="pre">DISTINCT</span></code>&#x5173;&#x952E;&#x5B57;&#x53EF;&#x80FD;&#x4F1A;&#x5BF9;&#x6027;&#x80FD;&#x4EA7;&#x751F;&#x8D1F;&#x9762;&#x5F71;&#x54CD;&#x3002;</span><span class="yiyi-st" id="yiyi-365">&#x5982;&#x679C;SELECT&#x4E2D;&#x7684;&#x5217;&#x672A;&#x88AB;&#x7D22;&#x5F15;&#xFF0C;&#x90A3;&#x4E48;<code class="docutils literal"><span class="pre">DISTINCT</span></code>&#x53EF;&#x80FD;&#x4F1A;&#x5728;&#x884C;&#x96C6;&#x4E0A;&#x6267;&#x884C;<code class="docutils literal"><span class="pre">ORDER</span> <span class="pre">BY</span></code>&#x6602;&#x8D35;&#x3002;</span><span class="yiyi-st" id="yiyi-366">&#x901A;&#x8FC7;&#x4FDD;&#x6301;&#x529F;&#x80FD;&#x4EC5;&#x9650;&#x4E8E;&#x5E0C;&#x671B;&#x5728;&#x4EFB;&#x4F55;&#x60C5;&#x51B5;&#x4E0B;&#x7D22;&#x5F15;&#x7684;&#x5916;&#x952E;&#xFF0C;&#x9884;&#x8BA1;&#x65B0;&#x7684;&#x9ED8;&#x8BA4;&#x503C;&#x662F;&#x5408;&#x7406;&#x7684;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-367">&#x8BE5;&#x529F;&#x80FD;&#x4E5F;&#x4E0D;&#x80FD;&#x6D88;&#x9664;&#x6BCF;&#x4E00;&#x4E2A;&#x53EF;&#x80FD;&#x7684;&#x91CD;&#x590D;&#x884C;&#x4E3A;&#x60C5;&#x51B5;&#xFF1B;&#x5982;&#x679C;&#x5728;&#x8FDE;&#x63A5;&#x94FE;&#x7684;&#x5176;&#x4ED6;&#x5730;&#x65B9;&#x5B58;&#x5728;&#x591A;&#x5BF9;&#x4E00;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x5219;&#x53EF;&#x80FD;&#x4ECD;&#x4F1A;&#x51FA;&#x73B0;&#x91CD;&#x590D;&#x884C;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-368"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2836">&#xFF03;2836  T0&gt;</a></span></p></div><div class="section" id="backref-handlers-can-now-propagate-more-than-one-level-deep"><h3><span class="yiyi-st" id="yiyi-369">Backref&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x4F20;&#x64AD;&#x591A;&#x4E2A;&#x5C42;&#x6B21;<a class="headerlink" href="#backref-handlers-can-now-propagate-more-than-one-level-deep" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-370">&#x5C5E;&#x6027;&#x4E8B;&#x4EF6;&#x6CBF;&#x5176;&#x201C;&#x53D1;&#x8D77;&#x8005;&#x201D;&#x4F20;&#x9012;&#x7684;&#x673A;&#x5236;&#xFF0C;&#x5373;&#x4E0E;&#x4E8B;&#x4EF6;&#x5F00;&#x59CB;&#x76F8;&#x5173;&#x8054;&#x7684;&#x5BF9;&#x8C61;&#x5DF2;&#x88AB;&#x66F4;&#x6539;&#xFF1B;&#x800C;&#x4E0D;&#x662F;&#x4F20;&#x9012;<code class="xref py py-class docutils literal"><span class="pre">AttributeImpl</span></code>&#xFF0C;&#x800C;&#x662F;&#x4F20;&#x9012;&#x4E00;&#x4E2A;&#x65B0;&#x5BF9;&#x8C61;<a class="reference internal" href="orm_internals.html#sqlalchemy.orm.attributes.Event" title="sqlalchemy.orm.attributes.Event"><code class="xref py py-class docutils literal"><span class="pre">attributes.Event</span></code></a>&#xFF1B;&#x6B64;&#x5BF9;&#x8C61;&#x5F15;&#x7528;<code class="xref py py-class docutils literal"><span class="pre">AttributeImpl</span></code>&#x4EE5;&#x53CA;&#x201C;&#x64CD;&#x4F5C;&#x4EE4;&#x724C;&#x201D;&#xFF0C;&#x8868;&#x793A;&#x64CD;&#x4F5C;&#x662F;&#x9644;&#x52A0;&#xFF0C;&#x5220;&#x9664;&#x6216;&#x66FF;&#x6362;&#x64CD;&#x4F5C;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-371">&#x5C5E;&#x6027;&#x4E8B;&#x4EF6;&#x7CFB;&#x7EDF;&#x4E0D;&#x518D;&#x67E5;&#x770B;&#x6B64;&#x201C;&#x542F;&#x52A8;&#x5668;&#x201D;&#x5BF9;&#x8C61;&#x4EE5;&#x505C;&#x6B62;&#x4E00;&#x7CFB;&#x5217;&#x9012;&#x5F52;&#x5C5E;&#x6027;&#x4E8B;&#x4EF6;&#x3002;</span><span class="yiyi-st" id="yiyi-372">&#x76F8;&#x53CD;&#xFF0C;&#x7531;&#x4E8E;&#x76F8;&#x4E92;&#x4F9D;&#x8D56;&#x7684;backref&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x800C;&#x963B;&#x6B62;&#x65E0;&#x9650;&#x9012;&#x5F52;&#x7684;&#x7CFB;&#x7EDF;&#x5DF2;&#x88AB;&#x79FB;&#x81F3;ORM backref&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#xFF0C;&#x8BE5;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x73B0;&#x5728;&#x63A5;&#x7BA1;&#x786E;&#x4FDD;&#x4E00;&#x7CFB;&#x5217;&#x76F8;&#x4E92;&#x4F9D;&#x8D56;&#x7684;&#x4E8B;&#x4EF6;&#xFF08;&#x4F8B;&#x5982;&#x8FFD;&#x52A0;&#x5230;&#x96C6;&#x5408;A&#x7684;&#x89D2;&#x8272;&#xFF09;&#x7684;&#x89D2;&#x8272;&#x3002; bs&#xFF0C;&#x5728;&#x54CD;&#x5E94;&#x4E2D;&#x8BBE;&#x7F6E;&#x591A;&#x5BF9;&#x4E00;&#x7684;&#x5C5E;&#x6027;Ba&#xFF09;&#x5E76;&#x6CA1;&#x6709;&#x8FDB;&#x5165;&#x65E0;&#x7A77;&#x65E0;&#x5C3D;&#x7684;&#x9012;&#x5F52;&#x6D41;&#x3002;</span><span class="yiyi-st" id="yiyi-373">&#x8FD9;&#x91CC;&#x7684;&#x57FA;&#x672C;&#x539F;&#x7406;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x7ED9;&#x5B9A;&#x66F4;&#x591A;&#x7684;&#x4E8B;&#x4EF6;&#x4F20;&#x64AD;&#x7684;&#x7EC6;&#x8282;&#x548C;&#x63A7;&#x5236;&#x6743;&#xFF0C;backref&#x7CFB;&#x7EDF;&#x6700;&#x7EC8;&#x53EF;&#x4EE5;&#x5141;&#x8BB8;&#x53D1;&#x751F;&#x591A;&#x4E8E;&#x4E00;&#x4E2A;&#x7EA7;&#x522B;&#x7684;&#x64CD;&#x4F5C;&#xFF1B;&#x5178;&#x578B;&#x7684;&#x60C5;&#x51B5;&#x662F;&#x96C6;&#x5408;&#x8FFD;&#x52A0;&#x4F1A;&#x5BFC;&#x81F4;&#x591A;&#x5BF9;&#x4E00;&#x7684;&#x66FF;&#x6362;&#x64CD;&#x4F5C;&#xFF0C;&#x800C;&#x8FD9;&#x53C8;&#x4F1A;&#x5BFC;&#x81F4;&#x5C06;&#x9879;&#x76EE;&#x4ECE;&#x4EE5;&#x524D;&#x7684;&#x96C6;&#x5408;&#x4E2D;&#x5220;&#x9664;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Parent</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;parent&apos;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">children</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Child&quot;</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="s2">&quot;parent&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Child</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;child&apos;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">parent_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;parent.id&apos;</span><span class="p">))</span>

<span class="n">p1</span> <span class="o">=</span> <span class="n">Parent</span><span class="p">()</span>
<span class="n">p2</span> <span class="o">=</span> <span class="n">Parent</span><span class="p">()</span>
<span class="n">c1</span> <span class="o">=</span> <span class="n">Child</span><span class="p">()</span>

<span class="n">p1</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">c1</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="n">p1</span>  <span class="c1"># backref event establishes c1.parent as p1</span>

<span class="n">p2</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">c1</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="n">p2</span>  <span class="c1"># backref event establishes c1.parent as p2</span>
<span class="k">assert</span> <span class="n">c1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p1</span><span class="o">.</span><span class="n">children</span>  <span class="c1"># second backref event removes c1 from p1.children</span></pre></div></div><p><span class="yiyi-st" id="yiyi-374">Above, prior to this change, the <code class="docutils literal"><span class="pre">c1</span></code> object would still have been present in <code class="docutils literal"><span class="pre">p1.children</span></code>, even though it is also present in <code class="docutils literal"><span class="pre">p2.children</span></code> at the same time; the backref handlers would have stopped at replacing <code class="docutils literal"><span class="pre">c1.parent</span></code> with <code class="docutils literal"><span class="pre">p2</span></code> instead of <code class="docutils literal"><span class="pre">p1</span></code>. </span><span class="yiyi-st" id="yiyi-375">In 0.9, using the more detailed <a class="reference internal" href="orm_internals.html#sqlalchemy.orm.attributes.Event" title="sqlalchemy.orm.attributes.Event"><code class="xref py py-class docutils literal"><span class="pre">Event</span></code></a> object as well as letting the backref handlers make more detailed decisions about these objects, the propagation can continue onto removing <code class="docutils literal"><span class="pre">c1</span></code> from <code class="docutils literal"><span class="pre">p1.children</span></code> while maintaining a check against the propagation from going into an endless recursive loop.</span></p><p><span class="yiyi-st" id="yiyi-376">&#x6700;&#x7EC8;&#x7528;&#x6237;&#x4EE3;&#x7801;&#x662F;&#x54EA;&#x4E00;&#x4E2A;&#x3002;&#x4F7F;&#x7528;<a class="reference internal" href="orm_events.html#sqlalchemy.orm.events.AttributeEvents.set" title="sqlalchemy.orm.events.AttributeEvents.set"><code class="xref py py-meth docutils literal"><span class="pre">AttributeEvents.set()</span></code></a>&#xFF0C;<a class="reference internal" href="orm_events.html#sqlalchemy.orm.events.AttributeEvents.append" title="sqlalchemy.orm.events.AttributeEvents.append"><code class="xref py py-meth docutils literal"><span class="pre">AttributeEvents.append()</span></code></a>&#x6216;<a class="reference internal" href="orm_events.html#sqlalchemy.orm.events.AttributeEvents.remove" title="sqlalchemy.orm.events.AttributeEvents.remove"><code class="xref py py-meth docutils literal"><span class="pre">AttributeEvents.remove()</span></code></a>&#x4E8B;&#x4EF6;&#xFF0C;&#x4EE5;&#x53CA;b&#x3002;&#x7531;&#x4E8E;&#x8FD9;&#x4E9B;&#x4E8B;&#x4EF6;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x4FEE;&#x6539;&#x4EE5;&#x9632;&#x6B62;&#x9012;&#x5F52;&#x5FAA;&#x73AF;&#xFF0C;&#x6240;&#x4EE5;&#x542F;&#x52A8;&#x8FDB;&#x4E00;&#x6B65;&#x7684;&#x5C5E;&#x6027;&#x4FEE;&#x6539;&#x64CD;&#x4F5C;&#xFF0C;&#x56E0;&#x4E3A;&#x5C5E;&#x6027;&#x7CFB;&#x7EDF;&#x4E0D;&#x518D;&#x963B;&#x6B62;&#x4E8B;&#x4EF6;&#x94FE;&#x5728;&#x6CA1;&#x6709;backref&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x65E0;&#x9650;&#x4F20;&#x64AD;&#x3002;</span><span class="yiyi-st" id="yiyi-377">&#x6B64;&#x5916;&#xFF0C;&#x53D6;&#x51B3;&#x4E8E;<code class="docutils literal"><span class="pre">initiator</span></code>&#x503C;&#x7684;&#x4EE3;&#x7801;&#x9700;&#x8981;&#x6839;&#x636E;&#x65B0;&#x7684;API&#x8FDB;&#x884C;&#x8C03;&#x6574;&#xFF0C;&#x5E76;&#x4E14;&#x5FC5;&#x987B;&#x51C6;&#x5907;&#x597D;<code class="docutils literal"><span class="pre">initiator</span></code>&#x7684;&#x503C;&#x4EE5;&#x4ECE;&#x5176;&#x539F;&#x59CB;&#x503C;&#x56E0;&#x4E3A;backref&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x4E3A;&#x67D0;&#x4E9B;&#x64CD;&#x4F5C;&#x4EA4;&#x6362;&#x65B0;&#x7684;<code class="docutils literal"><span class="pre">initiator</span></code>&#x503C;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-378"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2789">&#xFF03;2789  T0&gt;</a></span></p></div><div class="section" id="the-typing-system-now-handles-the-task-of-rendering-literal-bind-values"><h3><span class="yiyi-st" id="yiyi-379">&#x8F93;&#x5165;&#x7CFB;&#x7EDF;&#x73B0;&#x5728;&#x5904;&#x7406;&#x5448;&#x73B0;&#x201C;&#x6587;&#x5B57;&#x7ED1;&#x5B9A;&#x201D;&#x503C;&#x7684;&#x4EFB;&#x52A1;<a class="headerlink" href="#the-typing-system-now-handles-the-task-of-rendering-literal-bind-values" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-380">A new method is added to <a class="reference internal" href="core_type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal"><span class="pre">TypeEngine</span></code></a> <a class="reference internal" href="core_type_api.html#sqlalchemy.types.TypeEngine.literal_processor" title="sqlalchemy.types.TypeEngine.literal_processor"><code class="xref py py-meth docutils literal"><span class="pre">TypeEngine.literal_processor()</span></code></a> as well as <a class="reference internal" href="core_custom_types.html#sqlalchemy.types.TypeDecorator.process_literal_param" title="sqlalchemy.types.TypeDecorator.process_literal_param"><code class="xref py py-meth docutils literal"><span class="pre">TypeDecorator.process_literal_param()</span></code></a> for <a class="reference internal" href="core_custom_types.html#sqlalchemy.types.TypeDecorator" title="sqlalchemy.types.TypeDecorator"><code class="xref py py-class docutils literal"><span class="pre">TypeDecorator</span></code></a> which take on the task of rendering so-called &#x201C;inline literal paramters&#x201D; - parameters that normally render as &#x201C;bound&#x201D; values, but are instead being rendered inline into the SQL statement due to the compiler configuration. </span><span class="yiyi-st" id="yiyi-381">&#x5F53;&#x4E3A;&#x8BF8;&#x5982;<a class="reference internal" href="core_constraints.html#sqlalchemy.schema.CheckConstraint" title="sqlalchemy.schema.CheckConstraint"><code class="xref py py-class docutils literal"><span class="pre">CheckConstraint</span></code></a>&#x7684;&#x7ED3;&#x6784;&#x751F;&#x6210;DDL&#x65F6;&#xFF0C;&#x4EE5;&#x53CA;&#x5728;&#x4F7F;&#x7528;&#x8BF8;&#x5982;<code class="docutils literal"><span class="pre">op.inline_literal()</span></code>&#x7684;&#x7ED3;&#x6784;&#x65F6;&#x7531;Alembic&#x4F7F;&#x7528;&#x6B64;&#x529F;&#x80FD;&#x3002;</span><span class="yiyi-st" id="yiyi-382">&#x4E4B;&#x524D;&#xFF0C;&#x68C0;&#x67E5;&#x4E86;&#x4E00;&#x4E9B;&#x7B80;&#x5355;&#x7684;&#x201C;isinstance&#x201D;&#x68C0;&#x67E5;&#x4E86;&#x4E00;&#x4E9B;&#x57FA;&#x672C;&#x7C7B;&#x578B;&#xFF0C;&#x5E76;&#x4E14;&#x65E0;&#x6761;&#x4EF6;&#x5730;&#x4F7F;&#x7528;&#x4E86;&#x201C;&#x7ED1;&#x5B9A;&#x5904;&#x7406;&#x5668;&#x201D;&#xFF0C;&#x4ECE;&#x800C;&#x5BFC;&#x81F4;&#x5B57;&#x7B26;&#x4E32;&#x88AB;&#x8FC7;&#x65E9;&#x7F16;&#x7801;&#x4E3A;utf-8&#x7B49;&#x95EE;&#x9898;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-383">Custom types written with <a class="reference internal" href="core_custom_types.html#sqlalchemy.types.TypeDecorator" title="sqlalchemy.types.TypeDecorator"><code class="xref py py-class docutils literal"><span class="pre">TypeDecorator</span></code></a> should continue to work in &#x201C;inline literal&#x201D; scenarios, as the <a class="reference internal" href="core_custom_types.html#sqlalchemy.types.TypeDecorator.process_literal_param" title="sqlalchemy.types.TypeDecorator.process_literal_param"><code class="xref py py-meth docutils literal"><span class="pre">TypeDecorator.process_literal_param()</span></code></a> falls back to <a class="reference internal" href="core_custom_types.html#sqlalchemy.types.TypeDecorator.process_bind_param" title="sqlalchemy.types.TypeDecorator.process_bind_param"><code class="xref py py-meth docutils literal"><span class="pre">TypeDecorator.process_bind_param()</span></code></a> by default, as these methods usually handle a data manipulation, not as much how the data is presented to the database. </span><span class="yiyi-st" id="yiyi-384"><a class="reference internal" href="core_custom_types.html#sqlalchemy.types.TypeDecorator.process_literal_param" title="sqlalchemy.types.TypeDecorator.process_literal_param"><code class="xref py py-meth docutils literal"><span class="pre">TypeDecorator.process_literal_param()</span></code></a> can be specified to specifically produce a string representing how a value should be rendered into an inline DDL statement.</span></p><p><span class="yiyi-st" id="yiyi-385"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2838">&#xFF03;2838  T0&gt;</a></span></p></div><div class="section" id="schema-identifiers-now-carry-along-their-own-quoting-information"><h3><span class="yiyi-st" id="yiyi-386">&#x6A21;&#x5F0F;&#x6807;&#x8BC6;&#x7B26;&#x73B0;&#x5728;&#x643A;&#x5E26;&#x81EA;&#x5DF1;&#x7684;&#x5F15;&#x7528;&#x4FE1;&#x606F;<a class="headerlink" href="#schema-identifiers-now-carry-along-their-own-quoting-information" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-387">&#x8FD9;&#x79CD;&#x6539;&#x53D8;&#x7B80;&#x5316;&#x4E86;Core&#x5BF9;&#x6240;&#x8C13;&#x201C;quote&#x201D;&#x6807;&#x5FD7;&#x7684;&#x4F7F;&#x7528;&#xFF0C;&#x4F8B;&#x5982;&#x4F20;&#x9012;&#x7ED9;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal"><span class="pre">Table</span></code></a>&#x548C;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a>&#x7684;<code class="docutils literal"><span class="pre">quote</span></code>&#x6807;&#x5FD7;&#x3002;</span><span class="yiyi-st" id="yiyi-388">&#x8BE5;&#x6807;&#x5FD7;&#x73B0;&#x5728;&#x5DF2;&#x5185;&#x5316;&#x5728;&#x5B57;&#x7B26;&#x4E32;&#x540D;&#x79F0;&#x672C;&#x8EAB;&#x5185;&#xFF0C;&#x73B0;&#x5728;&#x5B83;&#x8868;&#x793A;&#x4E3A;&#x5B57;&#x7B26;&#x4E32;&#x5B50;&#x7C7B;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.elements.quoted_name" title="sqlalchemy.sql.elements.quoted_name"><code class="xref py py-class docutils literal"><span class="pre">quoted_name</span></code></a>&#x7684;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;&#x3002;</span><span class="yiyi-st" id="yiyi-389">&#x73B0;&#x5728;&#xFF0C;<a class="reference internal" href="core_internals.html#sqlalchemy.sql.compiler.IdentifierPreparer" title="sqlalchemy.sql.compiler.IdentifierPreparer"><code class="xref py py-class docutils literal"><span class="pre">IdentifierPreparer</span></code></a>&#x5B8C;&#x5168;&#x4F9D;&#x8D56;&#x4E8E;&#x7531;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.elements.quoted_name" title="sqlalchemy.sql.elements.quoted_name"><code class="xref py py-class docutils literal"><span class="pre">quoted_name</span></code></a>&#x5BF9;&#x8C61;&#x62A5;&#x544A;&#x7684;&#x5F15;&#x7528;&#x9996;&#x9009;&#x9879;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5728;&#x5927;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x4E0B;&#x68C0;&#x67E5;&#x4EFB;&#x4F55;&#x663E;&#x5F0F;&#x7684;<code class="docutils literal"><span class="pre">quote</span></code>&#x6807;&#x5FD7;&#x3002;</span><span class="yiyi-st" id="yiyi-390">&#x8FD9;&#x91CC;&#x89E3;&#x51B3;&#x7684;&#x95EE;&#x9898;&#x5305;&#x62EC;&#x5404;&#x79CD;&#x533A;&#x5206;&#x5927;&#x5C0F;&#x5199;&#x7684;&#x65B9;&#x6CD5;&#xFF08;&#x5982;<a class="reference internal" href="core_connections.html#sqlalchemy.engine.Engine.has_table" title="sqlalchemy.engine.Engine.has_table"><code class="xref py py-meth docutils literal"><span class="pre">Engine.has_table()</span></code></a>&#xFF09;&#x4EE5;&#x53CA;&#x65B9;&#x8A00;&#x4E2D;&#x7684;&#x7C7B;&#x4F3C;&#x65B9;&#x6CD5;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x660E;&#x786E;&#x5F15;&#x7528;&#x7684;&#x540D;&#x79F0;&#xFF0C;&#x800C;&#x4E0D;&#x9700;&#x8981;&#x590D;&#x6742;&#x5316;&#x6216;&#x5F15;&#x5165;&#x5411;&#x540E;&#x4E0D;&#x517C;&#x5BB9;&#x7684;&#x66F4;&#x6539;&#x5230;&#x90A3;&#x4E9B;API&#xFF08;&#x5176;&#x4E2D;&#x8BB8;&#x591A;&#x662F;&#x7B2C;&#x4E09;&#x65B9;&#xFF09;&#xFF0C;&#x5E76;&#x5E26;&#x6709;&#x5F15;&#x7528;&#x6807;&#x5FD7;&#x7684;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F; - &#x7279;&#x522B;&#x662F;&#x66F4;&#x5E7F;&#x6CDB;&#x7684;&#x6807;&#x8BC6;&#x7B26;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x4E0E;Oracle&#xFF0C;Firebird&#x548C;DB2&#x7B49;&#x6240;&#x8C13;&#x7684;&#x201C;&#x5927;&#x5199;&#x5B57;&#x6BCD;&#x201D;&#x540E;&#x7AEF;&#x6B63;&#x5E38;&#x5DE5;&#x4F5C;&#xFF08;&#x540E;&#x7AEF;&#x5B58;&#x50A8;&#x548C;&#x6839;&#x636E;&#x4E0D;&#x533A;&#x5206;&#x5927;&#x5C0F;&#x5199;&#x7684;&#x540D;&#x79F0;&#x4F7F;&#x7528;&#x5168;&#x90E8;&#x5927;&#x5199;&#x62A5;&#x544A;&#x8868;&#x548C;&#x5217;&#x540D;&#x79F0;&#xFF09;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-391"><a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.elements.quoted_name" title="sqlalchemy.sql.elements.quoted_name"><code class="xref py py-class docutils literal"><span class="pre">quoted_name</span></code></a>&#x5BF9;&#x8C61;&#x5728;&#x5185;&#x90E8;&#x6839;&#x636E;&#x9700;&#x8981;&#x4F7F;&#x7528;&#xFF1B;&#x4F46;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x5176;&#x4ED6;&#x5173;&#x952E;&#x5B57;&#x9700;&#x8981;&#x56FA;&#x5B9A;&#x7684;&#x5F15;&#x7528;&#x504F;&#x597D;&#xFF0C;&#x5219;&#x8BE5;&#x7C7B;&#x53EF;&#x516C;&#x5F00;&#x4F7F;&#x7528;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-392"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2812">&#xFF03;2812  T0&gt;</a></span></p></div><div class="section" id="improved-rendering-of-boolean-constants-null-constants-conjunctions"><h3><span class="yiyi-st" id="yiyi-393">&#x6539;&#x8FDB;&#x4E86;&#x5E03;&#x5C14;&#x5E38;&#x91CF;&#xFF0C;NULL&#x5E38;&#x91CF;&#xFF0C;&#x8FDE;&#x8BCD;&#x7684;&#x6E32;&#x67D3;<a class="headerlink" href="#improved-rendering-of-boolean-constants-null-constants-conjunctions" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-394">&#x65B0;&#x529F;&#x80FD;&#x5DF2;&#x6DFB;&#x52A0;&#x5230;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.true" title="sqlalchemy.sql.expression.true"><code class="xref py py-func docutils literal"><span class="pre">true()</span></code></a>&#x548C;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.false" title="sqlalchemy.sql.expression.false"><code class="xref py py-func docutils literal"><span class="pre">false()</span></code></a>&#x5E38;&#x91CF;&#x4E2D;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x4E0E;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.and_" title="sqlalchemy.sql.expression.and_"><code class="xref py py-func docutils literal"><span class="pre">and_()</span></code></a>&#x548C;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.or_" title="sqlalchemy.sql.expression.or_"><code class="xref py py-func docutils literal"><span class="pre">or_()</span></code></a>&#x51FD;&#x6570;&#x4EE5;&#x53CA;WHERE / HAVING&#x5B50;&#x53E5;&#x4E0E;&#x8FD9;&#x4E9B;&#x7C7B;&#x578B;&#xFF0C;&#x6574;&#x4F53;&#x5E03;&#x5C14;&#x7C7B;&#x578B;&#x4EE5;&#x53CA;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.null" title="sqlalchemy.sql.expression.null"><code class="xref py py-func docutils literal"><span class="pre">null()</span></code></a>&#x5E38;&#x91CF;&#x7684;&#x884C;&#x4E3A;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-395">&#x4ECE;&#x8FD9;&#x6837;&#x7684;&#x8868;&#x683C;&#x5F00;&#x59CB;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Table</span><span class="p">,</span> <span class="n">Boolean</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">Column</span><span class="p">,</span> <span class="n">MetaData</span>

<span class="n">t1</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&apos;t&apos;</span><span class="p">,</span> <span class="n">MetaData</span><span class="p">(),</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;x&apos;</span><span class="p">,</span> <span class="n">Boolean</span><span class="p">()),</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;y&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-396">select&#x7ED3;&#x6784;&#x73B0;&#x5728;&#x5C06;&#x5E03;&#x5C14;&#x5217;&#x4F5C;&#x4E3A;&#x4E8C;&#x8FDB;&#x5236;&#x8868;&#x8FBE;&#x5F0F;&#x5728;&#x4E0D;&#x5177;&#x6709;<code class="docutils literal"><span class="pre">true</span></code> / <code class="docutils literal"><span class="pre">false</span></code>&#x5E38;&#x91CF;beahvior&#x7684;&#x540E;&#x7AEF;&#x6E32;&#x67D3;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">select</span><span class="p">,</span> <span class="n">and_</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span> <span class="n">true</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy.dialects</span> <span class="kn">import</span> <span class="n">mysql</span><span class="p">,</span> <span class="n">postgresql</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">select</span><span class="p">([</span><span class="n">t1</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">t1</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">dialect</span><span class="o">=</span><span class="n">mysql</span><span class="o">.</span><span class="n">dialect</span><span class="p">()))</span>
<span class="go">SELECT t.x, t.y  FROM t WHERE t.x = 1</span></pre></div></div><p><span class="yiyi-st" id="yiyi-397">The <a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.and_" title="sqlalchemy.sql.expression.and_"><code class="xref py py-func docutils literal"><span class="pre">and_()</span></code></a> and <a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.or_" title="sqlalchemy.sql.expression.or_"><code class="xref py py-func docutils literal"><span class="pre">or_()</span></code></a> constructs will now exhibit quasi &#x201C;short circuit&#x201D; behavior, that is truncating a rendered expression, when a <a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.true" title="sqlalchemy.sql.expression.true"><code class="xref py py-func docutils literal"><span class="pre">true()</span></code></a> or <a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.false" title="sqlalchemy.sql.expression.false"><code class="xref py py-func docutils literal"><span class="pre">false()</span></code></a> constant is present:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">select</span><span class="p">([</span><span class="n">t1</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">and_</span><span class="p">(</span><span class="n">t1</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">,</span> <span class="n">false</span><span class="p">()))</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">dialect</span><span class="o">=</span><span class="n">postgresql</span><span class="o">.</span><span class="n">dialect</span><span class="p">()))</span>
<span class="go">SELECT t.x, t.y FROM t WHERE false</span></pre></div></div><p><span class="yiyi-st" id="yiyi-398"><a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.true" title="sqlalchemy.sql.expression.true"><code class="xref py py-func docutils literal"><span class="pre">true()</span></code></a>&#x53EF;&#x4EE5;&#x7528;&#x4F5C;&#x6784;&#x5EFA;&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x57FA;&#x7840;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">expr</span> <span class="o">=</span> <span class="n">true</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">expr</span> <span class="o">=</span> <span class="n">expr</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">t1</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">select</span><span class="p">([</span><span class="n">t1</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">expr</span><span class="p">))</span>
<span class="go">SELECT t.x, t.y FROM t WHERE t.y &gt; :y_1</span></pre></div></div><p><span class="yiyi-st" id="yiyi-399">The boolean constants <a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.true" title="sqlalchemy.sql.expression.true"><code class="xref py py-func docutils literal"><span class="pre">true()</span></code></a> and <a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.false" title="sqlalchemy.sql.expression.false"><code class="xref py py-func docutils literal"><span class="pre">false()</span></code></a> themselves render as <code class="docutils literal"><span class="pre">0</span> <span class="pre">=</span> <span class="pre">1</span></code> and <code class="docutils literal"><span class="pre">1</span> <span class="pre">=</span> <span class="pre">1</span></code> for a backend with no boolean constants:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">select</span><span class="p">([</span><span class="n">t1</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">and_</span><span class="p">(</span><span class="n">t1</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">,</span> <span class="n">false</span><span class="p">()))</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">dialect</span><span class="o">=</span><span class="n">mysql</span><span class="o">.</span><span class="n">dialect</span><span class="p">()))</span>
<span class="go">SELECT t.x, t.y FROM t WHERE 0 = 1</span></pre></div></div><p><span class="yiyi-st" id="yiyi-400">&#x5BF9;<code class="docutils literal"><span class="pre">None</span></code>&#x7684;&#x89E3;&#x91CA;&#x81F3;&#x5C11;&#x5728;&#x73B0;&#x5728;&#x662F;&#x4E00;&#x81F4;&#x7684;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x7279;&#x522B;&#x6709;&#x6548;&#x7684;SQL&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">select</span><span class="p">([</span><span class="n">t1</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">None</span><span class="p">))</span>
<span class="go">SELECT t.x FROM t WHERE NULL</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">select</span><span class="p">([</span><span class="n">t1</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">None</span><span class="p">))</span>
<span class="go">SELECT t.x FROM t WHERE NULL AND NULL</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">select</span><span class="p">([</span><span class="n">t1</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">and_</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)))</span>
<span class="go">SELECT t.x FROM t WHERE NULL AND NULL</span></pre></div></div><p><span class="yiyi-st" id="yiyi-401"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2804">&#xFF03;2804  T0&gt;</a></span></p></div><div class="section" id="label-constructs-can-now-render-as-their-name-alone-in-an-order-by"><h3><span class="yiyi-st" id="yiyi-402">&#x73B0;&#x5728;&#xFF0C;&#x6807;&#x7B7E;&#x6784;&#x9020;&#x53EF;&#x4EE5;&#x5728;ORDER BY <a class="headerlink" href="#label-constructs-can-now-render-as-their-name-alone-in-an-order-by" title="Permalink to this headline">&#xB6;</a>&#x4E2D;&#x4F5C;&#x4E3A;&#x5176;&#x540D;&#x79F0;&#x5355;&#x72EC;&#x6E32;&#x67D3;</span></h3><p><span class="yiyi-st" id="yiyi-403">&#x5BF9;&#x4E8E;&#x5728;column&#x5B50;&#x53E5;&#x548C;SELECT&#x7684;ORDER BY&#x5B50;&#x53E5;&#x4E2D;&#x90FD;&#x4F7F;&#x7528;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.Label" title="sqlalchemy.sql.expression.Label"><code class="xref py py-class docutils literal"><span class="pre">Label</span></code></a>&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x6807;&#x7B7E;&#x5C06;&#x5728;ORDER BY&#x5B50;&#x53E5;&#x4E2D;&#x5448;&#x73B0;&#x4E3A;&#x5B83;&#x7684;&#x540D;&#x79F0;&#xFF0C;&#x5047;&#x8BBE;&#x5E95;&#x5C42;&#x65B9;&#x8A00;&#x62A5;&#x544A;&#x652F;&#x6301;&#x6B64;&#x529F;&#x80FD;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-404">&#x4F8B;&#x5982;&#x3002;&#x4F8B;&#x5982;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.sql</span> <span class="kn">import</span> <span class="n">table</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">select</span><span class="p">,</span> <span class="n">func</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">table</span><span class="p">(</span><span class="s1">&apos;t&apos;</span><span class="p">,</span> <span class="n">column</span><span class="p">(</span><span class="s1">&apos;c1&apos;</span><span class="p">),</span> <span class="n">column</span><span class="p">(</span><span class="s1">&apos;c2&apos;</span><span class="p">))</span>
<span class="n">expr</span> <span class="o">=</span> <span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">foo</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">c1</span><span class="p">)</span> <span class="o">+</span> <span class="n">t</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">c2</span><span class="p">)</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="s2">&quot;expr&quot;</span><span class="p">)</span>

<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">expr</span><span class="p">])</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-405">0.9&#x4E4B;&#x524D;&#x4F1A;&#x5448;&#x73B0;&#x4E3A;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT foo(t.c1) + t.c2 AS expr
FROM t ORDER BY foo(t.c1) + t.c2</pre></div></div><p><span class="yiyi-st" id="yiyi-406">&#x73B0;&#x5728;&#x5448;&#x73B0;&#x4E3A;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT foo(t.c1) + t.c2 AS expr
FROM t ORDER BY expr</pre></div></div><p><span class="yiyi-st" id="yiyi-407">&#x5982;&#x679C;&#x6807;&#x7B7E;&#x6CA1;&#x6709;&#x8FDB;&#x4E00;&#x6B65;&#x5D4C;&#x5165;&#x5230;ORDER BY&#x4E2D;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#x4E2D;&#xFF0C;ORDER BY&#x53EA;&#x5448;&#x73B0;&#x6807;&#x7B7E;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x7B80;&#x5355;&#x7684;<code class="docutils literal"><span class="pre">ASC</span></code>&#x6216;<code class="docutils literal"><span class="pre">DESC</span></code>&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-408">&#x4E0A;&#x8FF0;&#x683C;&#x5F0F;&#x9002;&#x7528;&#x4E8E;&#x6240;&#x6709;&#x6D4B;&#x8BD5;&#x8FC7;&#x7684;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x4F46;&#x53EF;&#x80FD;&#x4E0E;&#x65E7;&#x6570;&#x636E;&#x5E93;&#x7248;&#x672C;&#xFF08;MySQL 4&#xFF1F;</span><span class="yiyi-st" id="yiyi-409">Oracle 8&#xFF1F;</span><span class="yiyi-st" id="yiyi-410">&#x7B49;&#x7B49;&#x3002;&#xFF09;&#x3002;</span><span class="yiyi-st" id="yiyi-411">&#x6839;&#x636E;&#x7528;&#x6237;&#x62A5;&#x544A;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x5C06;&#x7981;&#x7528;&#x57FA;&#x4E8E;&#x6570;&#x636E;&#x5E93;&#x7248;&#x672C;&#x68C0;&#x6D4B;&#x7684;&#x529F;&#x80FD;&#x7684;&#x89C4;&#x5219;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-412"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/1068">&#xFF03;1068  T0&gt;</a></span></p></div><div class="section" id="rowproxy-now-has-tuple-sorting-behavior"><h3><span class="yiyi-st" id="yiyi-413"><code class="docutils literal"><span class="pre">RowProxy</span></code> now has tuple-sorting behavior<a class="headerlink" href="#rowproxy-now-has-tuple-sorting-behavior" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-414"><a class="reference internal" href="core_connections.html#sqlalchemy.engine.RowProxy" title="sqlalchemy.engine.RowProxy"><code class="xref py py-class docutils literal"><span class="pre">RowProxy</span></code></a>&#x5BF9;&#x8C61;&#x7684;&#x884C;&#x4E3A;&#x5F88;&#x50CF;&#x4E00;&#x4E2A;&#x5143;&#x7EC4;&#xFF0C;&#x4F46;&#x76F4;&#x5230;&#x73B0;&#x5728;&#xFF0C;&#x5982;&#x679C;&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">sorted()</span></code>&#x5BF9;&#x5B83;&#x4EEC;&#x8FDB;&#x884C;&#x6392;&#x5E8F;&#xFF0C;&#x5219;&#x5B83;&#x4EEC;&#x4E0D;&#x4F1A;&#x6392;&#x5E8F;&#x4E3A;&#x5143;&#x7EC4;&#x3002;</span><span class="yiyi-st" id="yiyi-415"><code class="docutils literal"><span class="pre">__eq__()</span></code>&#x65B9;&#x6CD5;&#x73B0;&#x5728;&#x5C06;&#x4E24;&#x8FB9;&#x90FD;&#x4F5C;&#x4E3A;&#x5143;&#x7EC4;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#xFF0C;&#x5E76;&#x4E14;&#x8FD8;&#x6DFB;&#x52A0;&#x4E86;<code class="docutils literal"><span class="pre">__lt__()</span></code>&#x65B9;&#x6CD5;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">users</span><span class="o">.</span><span class="n">insert</span><span class="p">()</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
        <span class="nb">dict</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">user_name</span><span class="o">=</span><span class="s1">&apos;foo&apos;</span><span class="p">),</span>
        <span class="nb">dict</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">user_name</span><span class="o">=</span><span class="s1">&apos;bar&apos;</span><span class="p">),</span>
        <span class="nb">dict</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">user_name</span><span class="o">=</span><span class="s1">&apos;def&apos;</span><span class="p">),</span>
    <span class="p">)</span>

<span class="n">rows</span> <span class="o">=</span> <span class="n">users</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">users</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">user_name</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

<span class="n">eq_</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="p">[(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&apos;bar&apos;</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&apos;def&apos;</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&apos;foo&apos;</span><span class="p">)])</span>

<span class="n">eq_</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">rows</span><span class="p">),</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&apos;foo&apos;</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&apos;bar&apos;</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&apos;def&apos;</span><span class="p">)])</span></pre></div></div><p><span class="yiyi-st" id="yiyi-416"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2848">&#xFF03;2848  T0&gt;</a></span></p></div><div class="section" id="a-bindparam-construct-with-no-type-gets-upgraded-via-copy-when-a-type-is-available"><h3><span class="yiyi-st" id="yiyi-417">&#x5F53;&#x7C7B;&#x578B;&#x53EF;&#x7528;&#x65F6;&#xFF0C;&#x4E0D;&#x5E26;&#x7C7B;&#x578B;&#x7684;bindparam()&#x6784;&#x9020;&#x4F1A;&#x901A;&#x8FC7;&#x590D;&#x5236;&#x8FDB;&#x884C;&#x5347;&#x7EA7;<a class="headerlink" href="#a-bindparam-construct-with-no-type-gets-upgraded-via-copy-when-a-type-is-available" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-418">&#x201C;&#x5347;&#x7EA7;&#x201D;&#x4E00;&#x4E2A;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.bindparam" title="sqlalchemy.sql.expression.bindparam"><code class="xref py py-func docutils literal"><span class="pre">bindparam()</span></code></a>&#x7ED3;&#x6784;&#x4EE5;&#x627F;&#x62C5;&#x5C01;&#x95ED;&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x7C7B;&#x578B;&#x7684;&#x903B;&#x8F91;&#x5DF2;&#x7ECF;&#x901A;&#x8FC7;&#x4E24;&#x79CD;&#x65B9;&#x5F0F;&#x5F97;&#x5230;&#x4E86;&#x6539;&#x8FDB;&#x3002;</span><span class="yiyi-st" id="yiyi-419">First, the <a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.bindparam" title="sqlalchemy.sql.expression.bindparam"><code class="xref py py-func docutils literal"><span class="pre">bindparam()</span></code></a> object is <strong>copied</strong> before the new type is assigned, so that the given <a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.bindparam" title="sqlalchemy.sql.expression.bindparam"><code class="xref py py-func docutils literal"><span class="pre">bindparam()</span></code></a> is not mutated in place. </span><span class="yiyi-st" id="yiyi-420">&#x5176;&#x6B21;&#xFF0C;&#x5728;&#x7F16;&#x8BD1;<a class="reference internal" href="core_dml.html#sqlalchemy.sql.expression.Insert" title="sqlalchemy.sql.expression.Insert"><code class="xref py py-class docutils literal"><span class="pre">Insert</span></code></a>&#x6216;<a class="reference internal" href="core_dml.html#sqlalchemy.sql.expression.Update" title="sqlalchemy.sql.expression.Update"><code class="xref py py-class docutils literal"><span class="pre">Update</span></code></a>&#x7ED3;&#x6784;&#x65F6;&#xFF0C;&#x540C;&#x6837;&#x7684;&#x64CD;&#x4F5C;&#x53D1;&#x751F;&#x5728;&#x5173;&#x4E8E;&#x901A;&#x8FC7;<a class="reference internal" href="core_dml.html#sqlalchemy.sql.expression.ValuesBase.values" title="sqlalchemy.sql.expression.ValuesBase.values"><code class="xref py py-meth docutils literal"><span class="pre">ValuesBase.values()</span></code></a>&#x65B9;&#x6CD5;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-421">&#x5982;&#x679C;&#x7ED9;&#x5B9A;&#x4E00;&#x4E2A;&#x65E0;&#x7C7B;&#x578B;&#x7684;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.bindparam" title="sqlalchemy.sql.expression.bindparam"><code class="xref py py-func docutils literal"><span class="pre">bindparam()</span></code></a>&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">bp</span> <span class="o">=</span> <span class="n">bindparam</span><span class="p">(</span><span class="s2">&quot;some_col&quot;</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-422">&#x5982;&#x679C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x5982;&#x4E0B;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">expr</span> <span class="o">=</span> <span class="n">mytable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">col</span> <span class="o">==</span> <span class="n">bp</span></pre></div></div><p><span class="yiyi-st" id="yiyi-423">The type for <code class="docutils literal"><span class="pre">bp</span></code> remains as <code class="docutils literal"><span class="pre">NullType</span></code>, however if <code class="docutils literal"><span class="pre">mytable.c.col</span></code> is of type <code class="docutils literal"><span class="pre">String</span></code>, then <code class="docutils literal"><span class="pre">expr.right</span></code>, that is the right side of the binary expression, will take on the <code class="docutils literal"><span class="pre">String</span></code> type. </span><span class="yiyi-st" id="yiyi-424">&#x4EE5;&#x524D;&#xFF0C;<code class="docutils literal"><span class="pre">bp</span></code>&#x672C;&#x8EAB;&#x4F1A;&#x88AB;&#x66F4;&#x6539;&#x4E3A;<code class="docutils literal"><span class="pre">String</span></code>&#x4F5C;&#x4E3A;&#x5176;&#x7C7B;&#x578B;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-425">&#x540C;&#x6837;&#xFF0C;&#x6B64;&#x64CD;&#x4F5C;&#x53D1;&#x751F;&#x5728;<a class="reference internal" href="core_dml.html#sqlalchemy.sql.expression.Insert" title="sqlalchemy.sql.expression.Insert"><code class="xref py py-class docutils literal"><span class="pre">Insert</span></code></a>&#x6216;<a class="reference internal" href="core_dml.html#sqlalchemy.sql.expression.Update" title="sqlalchemy.sql.expression.Update"><code class="xref py py-class docutils literal"><span class="pre">Update</span></code></a>&#x4E2D;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">stmt</span> <span class="o">=</span> <span class="n">mytable</span><span class="o">.</span><span class="n">update</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="n">bp</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-426">&#x4E0A;&#x9762;&#xFF0C;<code class="docutils literal"><span class="pre">bp</span></code>&#x4FDD;&#x6301;&#x4E0D;&#x53D8;&#xFF0C;&#x4F46;&#x6267;&#x884C;&#x8BED;&#x53E5;&#x65F6;&#x5C06;&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">String</span></code>&#x7C7B;&#x578B;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x68C0;&#x67E5;<code class="docutils literal"><span class="pre">binds</span></code>&#x5B57;&#x5178;&#x6765;&#x770B;&#x5230;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">compiled</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">compiled</span><span class="o">.</span><span class="n">binds</span><span class="p">[</span><span class="s1">&apos;some_col&apos;</span><span class="p">]</span><span class="o">.</span><span class="n">type</span>
<span class="go">String</span></pre></div></div><p><span class="yiyi-st" id="yiyi-427">&#x8BE5;&#x529F;&#x80FD;&#x5141;&#x8BB8;&#x81EA;&#x5B9A;&#x4E49;&#x7C7B;&#x578B;&#x5728;INSERT / UPDATE&#x8BED;&#x53E5;&#x4E2D;&#x53D1;&#x6325;&#x5176;&#x9884;&#x671F;&#x6548;&#x679C;&#xFF0C;&#x800C;&#x65E0;&#x9700;&#x5728;&#x6BCF;&#x4E2A;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.bindparam" title="sqlalchemy.sql.expression.bindparam"><code class="xref py py-func docutils literal"><span class="pre">bindparam()</span></code></a>&#x8868;&#x8FBE;&#x5F0F;&#x4E2D;&#x660E;&#x786E;&#x6307;&#x5B9A;&#x8FD9;&#x4E9B;&#x7C7B;&#x578B;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-428">&#x6F5C;&#x5728;&#x7684;&#x5411;&#x540E;&#x517C;&#x5BB9;&#x53D8;&#x5316;&#x6D89;&#x53CA;&#x4E24;&#x4E2A;&#x4E0D;&#x592A;&#x53EF;&#x80FD;&#x7684;&#x60C5;&#x51B5;&#x3002;</span><span class="yiyi-st" id="yiyi-429">&#x7531;&#x4E8E;&#x7ED1;&#x5B9A;&#x53C2;&#x6570;&#x662F;<strong>&#x514B;&#x9686;</strong>&#xFF0C;&#x7528;&#x6237;&#x4E0D;&#x5E94;&#x8BE5;&#x4F9D;&#x8D56;&#x4E00;&#x65E6;&#x521B;&#x5EFA;&#x5C31;&#x5BF9;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.bindparam" title="sqlalchemy.sql.expression.bindparam"><code class="xref py py-func docutils literal"><span class="pre">bindparam()</span></code></a>&#x6784;&#x9020;&#x8FDB;&#x884C;&#x5C31;&#x5730;&#x66F4;&#x6539;&#x3002;</span><span class="yiyi-st" id="yiyi-430">&#x53E6;&#x5916;&#xFF0C;&#x5728;<a class="reference internal" href="core_dml.html#sqlalchemy.sql.expression.Insert" title="sqlalchemy.sql.expression.Insert"><code class="xref py py-class docutils literal"><span class="pre">Insert</span></code></a>&#x6216;<a class="reference internal" href="core_dml.html#sqlalchemy.sql.expression.Update" title="sqlalchemy.sql.expression.Update"><code class="xref py py-class docutils literal"><span class="pre">Update</span></code></a>&#x8BED;&#x53E5;&#x4E2D;&#x4F7F;&#x7528;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.bindparam" title="sqlalchemy.sql.expression.bindparam"><code class="xref py py-func docutils literal"><span class="pre">bindparam()</span></code></a>&#x7684;&#x4EE3;&#x7801;&#x4F9D;&#x8D56;&#x4E8E;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.bindparam" title="sqlalchemy.sql.expression.bindparam"><code class="xref py py-func docutils literal"><span class="pre">bindparam()</span></code></a></span></p><p><span class="yiyi-st" id="yiyi-431"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2850">&#xFF03;2850  T0&gt;</a></span></p></div><div class="section" id="columns-can-reliably-get-their-type-from-a-column-referred-to-via-foreignkey"><h3><span class="yiyi-st" id="yiyi-432">&#x5217;&#x53EF;&#x4EE5;&#x53EF;&#x9760;&#x5730;&#x4ECE;&#x901A;&#x8FC7;ForeignKey <a class="headerlink" href="#columns-can-reliably-get-their-type-from-a-column-referred-to-via-foreignkey" title="Permalink to this headline">&#xB6;</a>&#x5F15;&#x7528;&#x7684;&#x5217;&#x4E2D;&#x83B7;&#x53D6;&#x5B83;&#x4EEC;&#x7684;&#x7C7B;&#x578B;</span></h3><p><span class="yiyi-st" id="yiyi-433">&#x6709;&#x4E00;&#x4E2A;&#x957F;&#x671F;&#x4EE5;&#x6765;&#x7684;&#x884C;&#x4E3A;&#xFF0C;&#x8BF4;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a>&#x53EF;&#x4EE5;&#x5728;&#x6CA1;&#x6709;&#x7C7B;&#x578B;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x58F0;&#x660E;&#xFF0C;&#x53EA;&#x8981;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a>&#x7531;<a class="reference internal" href="core_constraints.html#sqlalchemy.schema.ForeignKeyConstraint" title="sqlalchemy.schema.ForeignKeyConstraint"><code class="xref py py-class docutils literal"><span class="pre">ForeignKeyConstraint</span></code></a>&#x5F15;&#x7528;&#xFF0C;&#x5E76;&#x4E14;&#x5F15;&#x7528;&#x5217;&#x4E2D;&#x7684;&#x7C7B;&#x578B;&#x5C06;&#x88AB;&#x590D;&#x5236;&#x5230;&#x8BE5;&#x5217;&#x4E2D;&#x3002;</span><span class="yiyi-st" id="yiyi-434">&#x95EE;&#x9898;&#x662F;&#x8FD9;&#x4E2A;&#x529F;&#x80FD;&#x4ECE;&#x6765;&#x6CA1;&#x6709;&#x5F88;&#x597D;&#x7684;&#x5DE5;&#x4F5C;&#xFF0C;&#x5E76;&#x6CA1;&#x6709;&#x88AB;&#x7EF4;&#x62A4;&#x3002;</span><span class="yiyi-st" id="yiyi-435">The core issue was that the <a class="reference internal" href="core_constraints.html#sqlalchemy.schema.ForeignKey" title="sqlalchemy.schema.ForeignKey"><code class="xref py py-class docutils literal"><span class="pre">ForeignKey</span></code></a> object doesn&#x2019;t know what target <a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a> it refers to until it is asked, typically the first time the foreign key is used to construct a <a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.Join" title="sqlalchemy.sql.expression.Join"><code class="xref py py-class docutils literal"><span class="pre">Join</span></code></a>. </span><span class="yiyi-st" id="yiyi-436">&#x56E0;&#x6B64;&#xFF0C;&#x76F4;&#x5230;&#x90A3;&#x4E2A;&#x65F6;&#x5019;&#xFF0C;&#x7236;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a>&#x4E0D;&#x4F1A;&#x6709;&#x7C7B;&#x578B;&#xFF0C;&#x6216;&#x8005;&#x66F4;&#x5177;&#x4F53;&#x5730;&#x8BF4;&#xFF0C;&#x5B83;&#x5C06;&#x5177;&#x6709;&#x9ED8;&#x8BA4;&#x7C7B;&#x578B;&#x7684;<a class="reference internal" href="core_type_api.html#sqlalchemy.types.NullType" title="sqlalchemy.types.NullType"><code class="xref py py-class docutils literal"><span class="pre">NullType</span></code></a>&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-437">&#x867D;&#x7136;&#x9700;&#x8981;&#x5F88;&#x957F;&#x65F6;&#x95F4;&#xFF0C;&#x4F46;&#x91CD;&#x65B0;&#x7EC4;&#x7EC7;<a class="reference internal" href="core_constraints.html#sqlalchemy.schema.ForeignKey" title="sqlalchemy.schema.ForeignKey"><code class="xref py py-class docutils literal"><span class="pre">ForeignKey</span></code></a>&#x5BF9;&#x8C61;&#x521D;&#x59CB;&#x5316;&#x7684;&#x5DE5;&#x4F5C;&#x5DF2;&#x5B8C;&#x6210;&#xFF0C;&#x56E0;&#x6B64;&#x8BE5;&#x529F;&#x80FD;&#x6700;&#x7EC8;&#x53EF;&#x4EE5;&#x63A5;&#x53D7;&#x3002;</span><span class="yiyi-st" id="yiyi-438">At the core of the change is that the <a class="reference internal" href="core_constraints.html#sqlalchemy.schema.ForeignKey.column" title="sqlalchemy.schema.ForeignKey.column"><code class="xref py py-attr docutils literal"><span class="pre">ForeignKey.column</span></code></a> attribute no longer lazily initializes the location of the target <a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a>; the issue with this system was that the owning <a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a> would be stuck with <a class="reference internal" href="core_type_api.html#sqlalchemy.types.NullType" title="sqlalchemy.types.NullType"><code class="xref py py-class docutils literal"><span class="pre">NullType</span></code></a> as its type until the <a class="reference internal" href="core_constraints.html#sqlalchemy.schema.ForeignKey" title="sqlalchemy.schema.ForeignKey"><code class="xref py py-class docutils literal"><span class="pre">ForeignKey</span></code></a> happened to be used.</span></p><p><span class="yiyi-st" id="yiyi-439">In the new version, the <a class="reference internal" href="core_constraints.html#sqlalchemy.schema.ForeignKey" title="sqlalchemy.schema.ForeignKey"><code class="xref py py-class docutils literal"><span class="pre">ForeignKey</span></code></a> coordinates with the eventual <a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a> it will refer to using internal attachment events, so that the moment the referencing <a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a> is associated with the <a class="reference internal" href="core_metadata.html#sqlalchemy.schema.MetaData" title="sqlalchemy.schema.MetaData"><code class="xref py py-class docutils literal"><span class="pre">MetaData</span></code></a>, all <a class="reference internal" href="core_constraints.html#sqlalchemy.schema.ForeignKey" title="sqlalchemy.schema.ForeignKey"><code class="xref py py-class docutils literal"><span class="pre">ForeignKey</span></code></a> objects that refer to it will be sent a message that they need to initialize their parent column. </span><span class="yiyi-st" id="yiyi-440">&#x8FD9;&#x4E2A;&#x7CFB;&#x7EDF;&#x6BD4;&#x8F83;&#x590D;&#x6742;&#xFF0C;&#x4F46;&#x5DE5;&#x4F5C;&#x66F4;&#x52A0;&#x624E;&#x5B9E;&#xFF1B;&#x4F5C;&#x4E3A;&#x5956;&#x52B1;&#xFF0C;&#x73B0;&#x5728;&#x6709;&#x5404;&#x79CD;&#x5404;&#x6837;&#x7684;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a> / <a class="reference internal" href="core_constraints.html#sqlalchemy.schema.ForeignKey" title="sqlalchemy.schema.ForeignKey"><code class="xref py py-class docutils literal"><span class="pre">ForeignKey</span></code></a>&#x914D;&#x7F6E;&#x573A;&#x666F;&#x7684;&#x6D4B;&#x8BD5;&#xFF0C;&#x5E76;&#x4E14;&#x9519;&#x8BEF;&#x6D88;&#x606F;&#x5DF2;&#x88AB;&#x6539;&#x8FDB;&#x4E3A;&#x975E;&#x5E38;&#x7279;&#x5B9A;&#x4E8E;&#x4E0D;&#x5C11;&#x4E8E;7&#x4E2A;&#x4E0D;&#x540C;&#x7684;&#x9519;&#x8BEF;&#x6761;&#x4EF6;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-441">&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x6B63;&#x5E38;&#x5DE5;&#x4F5C;&#x7684;&#x60C5;&#x666F;&#x5305;&#x62EC;&#xFF1A;</span></p><ol class="arabic"><li><p class="first"><span class="yiyi-st" id="yiyi-442">&#x53EA;&#x8981;&#x76EE;&#x6807;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a>&#x4E0E;&#x76F8;&#x540C;&#x7684;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.MetaData" title="sqlalchemy.schema.MetaData"><code class="xref py py-class docutils literal"><span class="pre">MetaData</span></code></a>&#x5173;&#x8054;&#xFF0C;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a>&#x4E2D;&#x7684;&#x7C7B;&#x578B;&#x7ACB;&#x5373;&#x51FA;&#x73B0;&#x3002;&#x65E0;&#x8BBA;&#x9996;&#x5148;&#x914D;&#x7F6E;&#x54EA;&#x4E00;&#x4FA7;&#xFF0C;&#x8FD9;&#x90FD;&#x53EF;&#x4EE5;&#x5DE5;&#x4F5C;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Table</span><span class="p">,</span> <span class="n">MetaData</span><span class="p">,</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">metadata</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t2</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&apos;t2&apos;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;t1id&apos;</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;t1.id&apos;</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t2</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">t1id</span><span class="o">.</span><span class="n">type</span>
<span class="go">NullType()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t1</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&apos;t1&apos;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;id&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t2</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">t1id</span><span class="o">.</span><span class="n">type</span>
<span class="go">Integer()</span></pre></div></div></li><li><p class="first"><span class="yiyi-st" id="yiyi-443">&#x7CFB;&#x7EDF;&#x73B0;&#x5728;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<a class="reference internal" href="core_constraints.html#sqlalchemy.schema.ForeignKeyConstraint" title="sqlalchemy.schema.ForeignKeyConstraint"><code class="xref py py-class docutils literal"><span class="pre">ForeignKeyConstraint</span></code></a>&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Table</span><span class="p">,</span> <span class="n">MetaData</span><span class="p">,</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKeyConstraint</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">metadata</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t2</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&apos;t2&apos;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;t1a&apos;</span><span class="p">),</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;t1b&apos;</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">ForeignKeyConstraint</span><span class="p">([</span><span class="s1">&apos;t1a&apos;</span><span class="p">,</span> <span class="s1">&apos;t1b&apos;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&apos;t1.a&apos;</span><span class="p">,</span> <span class="s1">&apos;t1.b&apos;</span><span class="p">]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t2</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">t1a</span><span class="o">.</span><span class="n">type</span>
<span class="go">NullType()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t2</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">t1b</span><span class="o">.</span><span class="n">type</span>
<span class="go">NullType()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t1</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&apos;t1&apos;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;a&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;b&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t2</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">t1a</span><span class="o">.</span><span class="n">type</span>
<span class="go">Integer()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t2</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">t1b</span><span class="o">.</span><span class="n">type</span>
<span class="go">Integer()</span></pre></div></div></li><li><p class="first"><span class="yiyi-st" id="yiyi-444">&#x5B83;&#x751A;&#x81F3;&#x9002;&#x7528;&#x4E8E;&#x201C;&#x591A;&#x8DF3;&#x201D; - &#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x5F15;&#x7528;&#x53E6;&#x4E00;&#x4E2A;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a>&#x7684;&#x5F15;&#x7528;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a>&#x7684;<a class="reference internal" href="core_constraints.html#sqlalchemy.schema.ForeignKey" title="sqlalchemy.schema.ForeignKey"><code class="xref py py-class docutils literal"><span class="pre">ForeignKey</span></code></a>&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Table</span><span class="p">,</span> <span class="n">MetaData</span><span class="p">,</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">metadata</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t2</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&apos;t2&apos;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;t1id&apos;</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;t1.id&apos;</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t3</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&apos;t3&apos;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;t2t1id&apos;</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;t2.t1id&apos;</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t2</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">t1id</span><span class="o">.</span><span class="n">type</span>
<span class="go">NullType()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t3</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">t2t1id</span><span class="o">.</span><span class="n">type</span>
<span class="go">NullType()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t1</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&apos;t1&apos;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;id&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t2</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">t1id</span><span class="o">.</span><span class="n">type</span>
<span class="go">Integer()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t3</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">t2t1id</span><span class="o">.</span><span class="n">type</span>
<span class="go">Integer()</span></pre></div></div></li></ol><p><span class="yiyi-st" id="yiyi-445"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/1765">&#xFF03;1765  T0&gt;</a></span></p></div></div><div class="section" id="dialect-changes"><h2><span class="yiyi-st" id="yiyi-446">&#x65B9;&#x8A00;&#x6539;&#x53D8;<a class="headerlink" href="#dialect-changes" title="Permalink to this headline">&#xB6;</a></span></h2><div class="section" id="firebird-fdb-is-now-the-default-firebird-dialect"><h3><span class="yiyi-st" id="yiyi-447">Firebird <code class="docutils literal"><span class="pre">fdb</span></code>&#x73B0;&#x5728;&#x662F;&#x9ED8;&#x8BA4;&#x7684;Firebird&#x65B9;&#x8A00;&#x3002;<a class="headerlink" href="#firebird-fdb-is-now-the-default-firebird-dialect" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-448">&#x5982;&#x679C;&#x521B;&#x5EFA;&#x7684;&#x5F15;&#x64CE;&#x6CA1;&#x6709;&#x65B9;&#x8A00;&#x8BF4;&#x660E;&#x7B26;&#xFF0C;&#x5373;<code class="docutils literal"><span class="pre">firebird://</span></code>&#xFF0C;&#x5219;&#x73B0;&#x5728;&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">fdb</span></code>&#x65B9;&#x8A00;&#x3002;</span><span class="yiyi-st" id="yiyi-449"><code class="docutils literal"><span class="pre">fdb</span></code> is a <code class="docutils literal"><span class="pre">kinterbasdb</span></code> compatible DBAPI which per the Firebird project is now their official Python driver.</span></p><p><span class="yiyi-st" id="yiyi-450"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2504">&#xFF03;2504  T0&gt;</a></span></p></div><div class="section" id="firebird-fdb-and-kinterbasdb-set-retaining-false-by-default"><h3><span class="yiyi-st" id="yiyi-451">Firebird <code class="docutils literal"><span class="pre">fdb</span></code>&#x548C;<code class="docutils literal"><span class="pre">kinterbasdb</span></code> set <code class="docutils literal"><span class="pre">retaining=False</span></code>&#x9ED8;&#x8BA4;<a class="headerlink" href="#firebird-fdb-and-kinterbasdb-set-retaining-false-by-default" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-452">Both the <code class="docutils literal"><span class="pre">fdb</span></code> and <code class="docutils literal"><span class="pre">kinterbasdb</span></code> DBAPIs support a flag <code class="docutils literal"><span class="pre">retaining=True</span></code> which can be passed to the <code class="docutils literal"><span class="pre">commit()</span></code> and <code class="docutils literal"><span class="pre">rollback()</span></code> methods of its connection. </span><span class="yiyi-st" id="yiyi-453">&#x6B64;&#x6807;&#x5FD7;&#x7684;&#x8BB0;&#x5F55;&#x57FA;&#x672C;&#x539F;&#x7406;&#x662F;&#x4E3A;&#x4E86;&#x63D0;&#x9AD8;&#x6027;&#x80FD;&#xFF0C;DBAPI&#x53EF;&#x4EE5;&#x4E3A;&#x540E;&#x7EED;&#x4E8B;&#x52A1;&#x91CD;&#x65B0;&#x4F7F;&#x7528;&#x5185;&#x90E8;&#x4E8B;&#x52A1;&#x72B6;&#x6001;&#x3002;</span><span class="yiyi-st" id="yiyi-454">However, newer documentation refers to analyses of Firebird&#x2019;s &#x201C;garbage collection&#x201D; which expresses that this flag can have a negative effect on the database&#x2019;s ability to process cleanup tasks, and has been reported as <em>lowering</em> performance as a result.</span></p><p><span class="yiyi-st" id="yiyi-455">&#x9274;&#x4E8E;&#x8FD9;&#x4E9B;&#x4FE1;&#x606F;&#xFF0C;&#x8BE5;&#x6807;&#x8BB0;&#x5982;&#x4F55;&#x5B9E;&#x9645;&#x4F7F;&#x7528;&#x5C1A;&#x4E0D;&#x6E05;&#x695A;&#xFF0C;&#x800C;&#x4E14;&#x7531;&#x4E8E;&#x5B83;&#x4F3C;&#x4E4E;&#x53EA;&#x662F;&#x4E00;&#x79CD;&#x6027;&#x80FD;&#x589E;&#x5F3A;&#x529F;&#x80FD;&#xFF0C;&#x73B0;&#x5728;&#x9ED8;&#x8BA4;&#x4E3A;<code class="docutils literal"><span class="pre">False</span></code>&#x3002;</span><span class="yiyi-st" id="yiyi-456">&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5C06;&#x6807;&#x5FD7;<code class="docutils literal"><span class="pre">retaining=True</span></code>&#x4F20;&#x9012;&#x7ED9;<a class="reference internal" href="core_engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal"><span class="pre">create_engine()</span></code></a>&#x8C03;&#x7528;&#x6765;&#x63A7;&#x5236;&#x8BE5;&#x503C;&#x3002;</span><span class="yiyi-st" id="yiyi-457">&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x65B0;&#x6807;&#x5FD7;&#xFF0C;&#x4ECE;0.8.2&#x5F00;&#x59CB;&#x6DFB;&#x52A0;&#xFF0C;&#x56E0;&#x6B64;0.8.2&#x4E0A;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x9700;&#x8981;&#x5F00;&#x59CB;&#x5C06;&#x5176;&#x8BBE;&#x7F6E;&#x4E3A;<code class="docutils literal"><span class="pre">True</span></code>&#x6216;<code class="docutils literal"><span class="pre">False</span></code>&#x3002;</span></p><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-458">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p><span class="yiyi-st" id="yiyi-459"><a class="reference internal" href="dialects_firebird.html#module-sqlalchemy.dialects.firebird.fdb" title="sqlalchemy.dialects.firebird.fdb"><code class="xref py py-mod docutils literal"><span class="pre">sqlalchemy.dialects.firebird.fdb</span></code></a></span></p><p><span class="yiyi-st" id="yiyi-460"><a class="reference internal" href="dialects_firebird.html#module-sqlalchemy.dialects.firebird.kinterbasdb" title="sqlalchemy.dialects.firebird.kinterbasdb"><code class="xref py py-mod docutils literal"><span class="pre">sqlalchemy.dialects.firebird.kinterbasdb</span></code></a></span></p><p class="last"><span class="yiyi-st" id="yiyi-461"><a class="reference external" href="http://pythonhosted.org/fdb/usage-guide.html#retaining-transactions">http://pythonhosted.org/fdb/usage-guide.html#retaining-transactions</a>  - &#x6709;&#x5173;&#x201C;&#x4FDD;&#x7559;&#x201D;&#x6807;&#x5FD7;&#x7684;&#x4FE1;&#x606F;&#x3002;</span></p></div><p><span class="yiyi-st" id="yiyi-462"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2763">&#xFF03;2763  T0&gt;</a></span></p></div></div>