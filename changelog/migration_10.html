<h1><span class="yiyi-st" id="yiyi-130">SQLAlchemy 1.0&#x6709;&#x54EA;&#x4E9B;&#x65B0;&#x7279;&#x6027;&#xFF1F;<a class="headerlink" href="#what-s-new-in-sqlalchemy-1-0" title="Permalink to this headline">&#xB6;</a></span></h1><div class="admonition-about-this-document admonition"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-131">&#x5173;&#x4E8E;&#x672C;&#x6587;&#x6863;</span></p><p><span class="yiyi-st" id="yiyi-132">&#x672C;&#x6587;&#x6863;&#x4ECB;&#x7ECD;&#x4E86;2014&#x5E74;5&#x6708;&#x53D1;&#x5E03;&#x7684;SQLAlchemy 0.9&#x7248;&#x672C;&#xFF0C;&#x4EE5;&#x53CA;2015&#x5E74;4&#x6708;&#x53D1;&#x5E03;&#x7684;SQLAlchemy 1.0&#x7248;&#x672C;&#x4E4B;&#x95F4;&#x7684;&#x53D8;&#x5316;&#x3002;</span></p><p class="last"><span class="yiyi-st" id="yiyi-133">&#x6587;&#x4EF6;&#x6700;&#x540E;&#x66F4;&#x65B0;&#x65E5;&#x671F;&#xFF1A;2015&#x5E74;6&#x6708;9&#x65E5;</span></p></div><div class="section" id="introduction"><h2><span class="yiyi-st" id="yiyi-134">&#x5F15;&#x8A00;<a class="headerlink" href="#introduction" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h2><p><span class="yiyi-st" id="yiyi-135">&#x672C;&#x6307;&#x5357;&#x4ECB;&#x7ECD;&#x4E86;SQLAlchemy 1.0&#x7248;&#x4E2D;&#x7684;&#x65B0;&#x529F;&#x80FD;&#xFF0C;&#x5E76;&#x4ECB;&#x7ECD;&#x4E86;&#x5F71;&#x54CD;&#x7528;&#x6237;&#x5C06;&#x5176;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4ECE;0.9&#x7CFB;&#x5217;SQLAlchemy&#x8FC1;&#x79FB;&#x5230;1.0&#x7684;&#x66F4;&#x6539;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-136">&#x8BF7;&#x4ED4;&#x7EC6;&#x9605;&#x8BFB;&#x5173;&#x4E8E;&#x884C;&#x4E3A;&#x53D8;&#x5316;&#x7684;&#x7AE0;&#x8282;&#xFF0C;&#x4EE5;&#x4E86;&#x89E3;&#x884C;&#x4E3A;&#x4E2D;&#x6F5C;&#x5728;&#x7684;&#x5411;&#x540E;&#x4E0D;&#x517C;&#x5BB9;&#x7684;&#x53D8;&#x5316;&#x3002;</span></p></div><div class="section" id="new-features-and-improvements-orm"><h2><span class="yiyi-st" id="yiyi-137">&#x65B0;&#x529F;&#x80FD;&#x548C;&#x6539;&#x8FDB; -  ORM <a class="headerlink" href="#new-features-and-improvements-orm" title="Permalink to this headline">&#xB6;</a></span></h2><div class="section" id="new-session-bulk-insert-update-api"><h3><span class="yiyi-st" id="yiyi-138">&#x65B0;&#x4F1A;&#x8BDD;&#x6279;&#x91CF;INSERT / UPDATE API <a class="headerlink" href="#new-session-bulk-insert-update-api" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-139">&#x5DF2;&#x7ECF;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x7CFB;&#x5217;&#x65B0;&#x7684;<a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>&#x65B9;&#x6CD5;&#xFF0C;&#x5B83;&#x4EEC;&#x5C06;&#x5DE5;&#x4F5C;&#x5355;&#x5143;&#x76F4;&#x63A5;&#x63D0;&#x4F9B;&#x7ED9;&#x5DE5;&#x4F5C;&#x5355;&#x4F4D;&#x4EE5;&#x53D1;&#x51FA;INSERT&#x548C;UPDATE&#x8BED;&#x53E5;&#x3002;</span><span class="yiyi-st" id="yiyi-140">&#x5982;&#x679C;&#x4F7F;&#x7528;&#x6B63;&#x786E;&#xFF0C;&#x8FD9;&#x4E2A;&#x9762;&#x5411;&#x4E13;&#x5BB6;&#x7684;&#x7CFB;&#x7EDF;&#x53EF;&#x4EE5;&#x5141;&#x8BB8;ORM&#x6620;&#x5C04;&#x7528;&#x4E8E;&#x751F;&#x6210;&#x6279;&#x91CF;&#x63D2;&#x5165;&#x548C;&#x66F4;&#x65B0;&#x8BED;&#x53E5;&#xFF0C;&#x6279;&#x91CF;&#x63D2;&#x5165;&#x5230;executemany&#x7EC4;&#x4E2D;&#xFF0C;&#x4ECE;&#x800C;&#x5141;&#x8BB8;&#x8BED;&#x53E5;&#x4EE5;&#x4E0E;&#x76F4;&#x63A5;&#x4F7F;&#x7528;Core&#x76F8;&#x5AB2;&#x7F8E;&#x7684;&#x901F;&#x5EA6;&#x8FDB;&#x884C;&#x3002;</span></p><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-141">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-142"><a class="reference internal" href="orm_persistence_techniques.html#bulk-operations"><span>Bulk Operations</span></a> - introduction and full documentation</span></p></div><p><span class="yiyi-st" id="yiyi-143"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3100">&#xFF03;3100  T0&gt;</a></span></p></div><div class="section" id="new-performance-example-suite"><h3><span class="yiyi-st" id="yiyi-144">&#x65B0;&#x7684;&#x6027;&#x80FD;&#x793A;&#x4F8B;&#x5957;&#x4EF6;<a class="headerlink" href="#new-performance-example-suite" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-145">&#x53D7;&#x5230;&#x9488;&#x5BF9;<a class="reference internal" href="orm_persistence_techniques.html#bulk-operations"><span>Bulk Operations</span></a>&#x529F;&#x80FD;&#x4EE5;&#x53CA;<a class="reference internal" href="faq_performance.html#faq-how-to-profile"><span>How can I profile a SQLAlchemy powered application?</span></a></span><span class="yiyi-st" id="yiyi-146">&#x5E38;&#x89C1;&#x95EE;&#x9898;&#x89E3;&#x7B54;&#x90E8;&#x5206;&#xFF0C;&#x589E;&#x52A0;&#x4E86;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x793A;&#x4F8B;&#x90E8;&#x5206;&#xFF0C;&#x5176;&#x4E2D;&#x6709;&#x51E0;&#x4E2A;&#x811A;&#x672C;&#xFF0C;&#x65E8;&#x5728;&#x8BF4;&#x660E;&#x5404;&#x79CD;&#x6838;&#x5FC3;&#x548C;ORM&#x6280;&#x672F;&#x7684;&#x76F8;&#x5BF9;&#x6027;&#x80FD;&#x6982;&#x51B5;&#x3002;</span><span class="yiyi-st" id="yiyi-147">&#x8FD9;&#x4E9B;&#x811A;&#x672C;&#x88AB;&#x7EC4;&#x7EC7;&#x5230;&#x7528;&#x4F8B;&#x4E2D;&#xFF0C;&#x5E76;&#x88AB;&#x5C01;&#x88C5;&#x5728;&#x4E00;&#x4E2A;&#x5355;&#x4E00;&#x7684;&#x63A7;&#x5236;&#x53F0;&#x754C;&#x9762;&#x4E0B;&#xFF0C;&#x4ECE;&#x800C;&#x53EF;&#x4EE5;&#x8FD0;&#x884C;&#x6F14;&#x793A;&#x7684;&#x4EFB;&#x610F;&#x7EC4;&#x5408;&#xFF0C;&#x629B;&#x51FA;&#x65F6;&#x95F4;&#xFF0C;Python&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7ED3;&#x679C;&#x548C;/&#x6216;RunSnake&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x663E;&#x793A;&#x3002;</span></p><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-148">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-149"><a class="reference internal" href="orm_examples.html#examples-performance"><span>Performance</span></a></span></p></div></div><div class="section" id="baked-queries"><h3><span class="yiyi-st" id="yiyi-150">&#x201C;&#x70D8;&#x7119;&#x201D;&#x67E5;&#x8BE2;<a class="headerlink" href="#baked-queries" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-151">&#x201C;&#x70D8;&#x7119;&#x201D;&#x67E5;&#x8BE2;&#x529F;&#x80FD;&#x662F;&#x4E00;&#x79CD;&#x4E0D;&#x5BFB;&#x5E38;&#x7684;&#x65B0;&#x65B9;&#x6CD5;&#xFF0C;&#x5B83;&#x5141;&#x8BB8;&#x76F4;&#x63A5;&#x6784;&#x5EFA;&#x4F7F;&#x7528;&#x7F13;&#x5B58;&#x6765;&#x8C03;&#x7528;<a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query" title="sqlalchemy.orm.query.Query"><code class="xref py py-class docutils literal"><span class="pre">Query</span></code></a>&#x5BF9;&#x8C61;&#xFF0C;&#x540E;&#x7EED;&#x8C03;&#x7528;&#x529F;&#x80FD;&#x5927;&#x5927;&#x51CF;&#x5C11;&#x4E86;Python&#x51FD;&#x6570;&#x8C03;&#x7528;&#x5F00;&#x9500;&#xFF08;&#x8D85;&#x8FC7;75&#xFF05;&#xFF09;&#x3002;</span><span class="yiyi-st" id="yiyi-152">&#x901A;&#x8FC7;&#x5C06;&#x4E00;&#x4E2A;<a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query" title="sqlalchemy.orm.query.Query"><code class="xref py py-class docutils literal"><span class="pre">Query</span></code></a>&#x5BF9;&#x8C61;&#x6307;&#x5B9A;&#x4E3A;&#x4E00;&#x7CFB;&#x5217;&#x4EC5;&#x8C03;&#x7528;&#x4E00;&#x6B21;&#x7684;lambda&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x4F5C;&#x4E3A;&#x9884;&#x7F16;&#x8BD1;&#x5355;&#x5143;&#x7684;&#x67E5;&#x8BE2;&#x5F00;&#x59CB;&#x53D8;&#x5F97;&#x53EF;&#x884C;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.ext</span> <span class="kn">import</span> <span class="n">baked</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">bindparam</span>

<span class="n">bakery</span> <span class="o">=</span> <span class="n">baked</span><span class="o">.</span><span class="n">bakery</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">search_for_user</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

    <span class="n">baked_query</span> <span class="o">=</span> <span class="n">bakery</span><span class="p">(</span><span class="k">lambda</span> <span class="n">session</span><span class="p">:</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">))</span>
    <span class="n">baked_query</span> <span class="o">+=</span> <span class="k">lambda</span> <span class="n">q</span><span class="p">:</span> <span class="n">q</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">bindparam</span><span class="p">(</span><span class="s1">&apos;username&apos;</span><span class="p">))</span>

    <span class="n">baked_query</span> <span class="o">+=</span> <span class="k">lambda</span> <span class="n">q</span><span class="p">:</span> <span class="n">q</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">email</span><span class="p">:</span>
        <span class="n">baked_query</span> <span class="o">+=</span> <span class="k">lambda</span> <span class="n">q</span><span class="p">:</span> <span class="n">q</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">email</span> <span class="o">==</span> <span class="n">bindparam</span><span class="p">(</span><span class="s1">&apos;email&apos;</span><span class="p">))</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">baked_query</span><span class="p">(</span><span class="n">session</span><span class="p">)</span><span class="o">.</span><span class="n">params</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">result</span></pre></div></div><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-153">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-154"><a class="reference internal" href="orm_extensions_baked.html"><span>Baked Queries</span></a></span></p></div><p><span class="yiyi-st" id="yiyi-155"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3054">&#xFF03;3054  T0&gt;</a></span></p></div><div class="section" id="improvements-to-declarative-mixins-declared-attr-and-related-features"><h3><span class="yiyi-st" id="yiyi-156">&#x58F0;&#x660E;&#x6027;&#x6DF7;&#x5408;&#xFF0C;<code class="docutils literal"><span class="pre">@declared_attr</span></code>&#x548C;&#x76F8;&#x5173;&#x7279;&#x6027;&#x7684;&#x6539;&#x8FDB;<a class="headerlink" href="#improvements-to-declarative-mixins-declared-attr-and-related-features" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-157">&#x4E0E;<a class="reference internal" href="orm_extensions_declarative_api.html#sqlalchemy.ext.declarative.declared_attr" title="sqlalchemy.ext.declarative.declared_attr"><code class="xref py py-class docutils literal"><span class="pre">declared_attr</span></code></a>&#x7ED3;&#x5408;&#x7684;&#x58F0;&#x660E;&#x6027;&#x7CFB;&#x7EDF;&#x5DF2;&#x7ECF;&#x8FC7;&#x5927;&#x4FEE;&#xFF0C;&#x4EE5;&#x652F;&#x6301;&#x65B0;&#x529F;&#x80FD;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-158">&#x7528;<a class="reference internal" href="orm_extensions_declarative_api.html#sqlalchemy.ext.declarative.declared_attr" title="sqlalchemy.ext.declarative.declared_attr"><code class="xref py py-class docutils literal"><span class="pre">declared_attr</span></code></a>&#x88C5;&#x9970;&#x7684;&#x51FD;&#x6570;&#x73B0;&#x5728;&#x53EA;&#x5728;&#x4E4B;&#x540E;&#x88AB;&#x8C03;&#x7528;<strong>&#x6240;&#x6709;&#x57FA;&#x4E8E;&#x6DF7;&#x8272;&#x7684;&#x5217;&#x526F;&#x672C;&#x751F;&#x6210;&#x3002;</strong></span><span class="yiyi-st" id="yiyi-159">&#x8FD9;&#x610F;&#x5473;&#x7740;&#x8BE5;&#x51FD;&#x6570;&#x53EF;&#x4EE5;&#x8C03;&#x7528;&#x6DF7;&#x5165;&#x5EFA;&#x7ACB;&#x7684;&#x5217;&#xFF0C;&#x5E76;&#x4E14;&#x4F1A;&#x63A5;&#x6536;&#x5230;&#x6B63;&#x786E;&#x7684;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a>&#x5BF9;&#x8C61;&#x7684;&#x5F15;&#x7528;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">HasFooBar</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">foobar</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">)</span>

    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">foobar_prop</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">column_property</span><span class="p">(</span><span class="s1">&apos;foobar: &apos;</span> <span class="o">+</span> <span class="n">cls</span><span class="o">.</span><span class="n">foobar</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">SomeClass</span><span class="p">(</span><span class="n">HasFooBar</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;some_table&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-160">Above, <code class="docutils literal"><span class="pre">SomeClass.foobar_prop</span></code> will be invoked against <code class="docutils literal"><span class="pre">SomeClass</span></code>, and <code class="docutils literal"><span class="pre">SomeClass.foobar</span></code> will be the final <a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a> object that is to be mapped to <code class="docutils literal"><span class="pre">SomeClass</span></code>, as opposed to the non-copied object present directly on <code class="docutils literal"><span class="pre">HasFooBar</span></code>, even though the columns aren&#x2019;t mapped yet.</span></p><p><span class="yiyi-st" id="yiyi-161">The <a class="reference internal" href="orm_extensions_declarative_api.html#sqlalchemy.ext.declarative.declared_attr" title="sqlalchemy.ext.declarative.declared_attr"><code class="xref py py-class docutils literal"><span class="pre">declared_attr</span></code></a> function now <strong>memoizes</strong> the value that&#x2019;s returned on a per-class basis, so that repeated calls to the same attribute will return the same value. </span><span class="yiyi-st" id="yiyi-162">&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6539;&#x53D8;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x6765;&#x8BF4;&#x660E;&#x8FD9;&#x4E00;&#x70B9;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">HasFooBar</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">foobar</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">)</span>

    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">foobar_prop</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">column_property</span><span class="p">(</span><span class="s1">&apos;foobar: &apos;</span> <span class="o">+</span> <span class="n">cls</span><span class="o">.</span><span class="n">foobar</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">SomeClass</span><span class="p">(</span><span class="n">HasFooBar</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;some_table&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-163">&#x4EE5;&#x524D;&#xFF0C;<code class="docutils literal"><span class="pre">SomeClass</span></code>&#x5C06;&#x901A;&#x8FC7;&#x8C03;&#x7528;<code class="docutils literal"><span class="pre">foobar</span></code>&#x6620;&#x5C04;&#x5230;<code class="docutils literal"><span class="pre">foobar</span></code>&#x5217;&#x7684;&#x4E00;&#x4E2A;&#x7279;&#x5B9A;&#x526F;&#x672C;&#xFF0C;&#x4F46;&#x662F;<code class="docutils literal"><span class="pre">foobar_prop</span></code>&#x7B2C;&#x4E8C;&#x6B21;&#x4F1A;&#x4EA7;&#x751F;&#x4E0D;&#x540C;&#x7684;&#x5217;&#x3002;</span><span class="yiyi-st" id="yiyi-164">&#x5728;&#x58F0;&#x660E;&#x6027;&#x8BBE;&#x7F6E;&#x65F6;&#x95F4;&#x5185;&#xFF0C;<code class="docutils literal"><span class="pre">SomeClass.foobar</span></code>&#x7684;&#x503C;&#x73B0;&#x5728;&#x88AB;&#x8BB0;&#x5FC6;&#xFF0C;&#x6240;&#x4EE5;&#x5373;&#x4F7F;&#x5728;&#x6620;&#x5C04;&#x5668;&#x6620;&#x5C04;&#x8BE5;&#x5C5E;&#x6027;&#x4E4B;&#x524D;&#xFF0C;&#x65E0;&#x8BBA;<a class="reference internal" href="orm_extensions_declarative_api.html#sqlalchemy.ext.declarative.declared_attr" title="sqlalchemy.ext.declarative.declared_attr"><code class="xref py py-class docutils literal"><span class="pre">declared_attr</span></code></a>&#x88AB;&#x8C03;&#x7528;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-165">&#x4E0A;&#x9762;&#x7684;&#x4E24;&#x79CD;&#x884C;&#x4E3A;&#x5E94;&#x8BE5;&#x5BF9;&#x8BB8;&#x591A;&#x7C7B;&#x578B;&#x7684;&#x6620;&#x5C04;&#x5668;&#x5C5E;&#x6027;&#x7684;&#x58F0;&#x660E;&#x6027;&#x5B9A;&#x4E49;&#x6709;&#x5F88;&#x5927;&#x7684;&#x5E2E;&#x52A9;&#xFF0C;&#x8FD9;&#x4E9B;&#x5C5E;&#x6027;&#x6D3E;&#x751F;&#x81EA;&#x5176;&#x4ED6;&#x5C5E;&#x6027;&#xFF0C;&#x5176;&#x4E2D;<a class="reference internal" href="orm_extensions_declarative_api.html#sqlalchemy.ext.declarative.declared_attr" title="sqlalchemy.ext.declarative.declared_attr"><code class="xref py py-class docutils literal"><span class="pre">declared_attr</span></code></a>&#x51FD;&#x6570;&#x4ECE;&#x672C;&#x5730;&#x5B58;&#x5728;&#x7684;&#x5176;&#x4ED6;<a class="reference internal" href="orm_extensions_declarative_api.html#sqlalchemy.ext.declarative.declared_attr" title="sqlalchemy.ext.declarative.declared_attr"><code class="xref py py-class docutils literal"><span class="pre">declared_attr</span></code></a>&#x51FD;&#x6570;&#x8BE5;&#x7C7B;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x6620;&#x5C04;&#x7684;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-166">&#x5BF9;&#x4E8E;&#x5E0C;&#x671B;&#x6784;&#x5EFA;&#x4E00;&#x4E2A;&#x4E3A;&#x6BCF;&#x4E2A;&#x5B50;&#x7C7B;&#x521B;&#x5EFA;&#x4E0D;&#x540C;&#x5217;&#x7684;&#x58F0;&#x660E;&#x6027;&#x6DF7;&#x5408;&#x7684;&#x6F02;&#x4EAE;&#x8FB9;&#x7F18;&#x60C5;&#x51B5;&#xFF0C;&#x5C06;&#x6DFB;&#x52A0;&#x65B0;&#x7684;&#x4FEE;&#x9970;&#x7B26;<a class="reference internal" href="orm_extensions_declarative_api.html#sqlalchemy.ext.declarative.declared_attr.cascading" title="sqlalchemy.ext.declarative.declared_attr.cascading"><code class="xref py py-attr docutils literal"><span class="pre">declared_attr.cascading</span></code></a>&#x3002;</span><span class="yiyi-st" id="yiyi-167">&#x4F7F;&#x7528;&#x6B64;&#x4FEE;&#x9970;&#x7B26;&#xFF0C;&#x5C06;&#x4E3A;&#x6620;&#x5C04;&#x7684;&#x7EE7;&#x627F;&#x5C42;&#x6B21;&#x7ED3;&#x6784;&#x4E2D;&#x7684;&#x6BCF;&#x4E2A;&#x7C7B;&#x5355;&#x72EC;&#x8C03;&#x7528;&#x4FEE;&#x9970;&#x7684;&#x51FD;&#x6570;&#x3002;</span><span class="yiyi-st" id="yiyi-168">&#x867D;&#x7136;&#x8FD9;&#x5DF2;&#x7ECF;&#x662F;&#x9488;&#x5BF9;&#x7279;&#x6B8A;&#x5C5E;&#x6027;&#xFF08;&#x5982;<code class="docutils literal"><span class="pre">__table_args__</span></code>&#x548C;<code class="docutils literal"><span class="pre">__mapper_args__</span></code>&#xFF09;&#x7684;&#x884C;&#x4E3A;&#xFF0C;&#x4F46;&#x5BF9;&#x4E8E;&#x5217;&#x548C;&#x5176;&#x4ED6;&#x5C5E;&#x6027;&#xFF0C;&#x7F3A;&#x7701;&#x884C;&#x4E3A;&#x5047;&#x5B9A;&#x8BE5;&#x5C5E;&#x6027;&#x4EC5;&#x9644;&#x52A0;&#x5230;&#x57FA;&#x7C7B;&#xFF0C;&#x5E76;&#x4E14;&#x53EA;&#x662F;&#x4ECE;&#x5B50;&#x7C7B;&#x7EE7;&#x627F;&#x800C;&#x6765;&#x3002;</span><span class="yiyi-st" id="yiyi-169">&#x901A;&#x8FC7;<a class="reference internal" href="orm_extensions_declarative_api.html#sqlalchemy.ext.declarative.declared_attr.cascading" title="sqlalchemy.ext.declarative.declared_attr.cascading"><code class="xref py py-attr docutils literal"><span class="pre">declared_attr.cascading</span></code></a>&#xFF0C;&#x53EF;&#x4EE5;&#x5E94;&#x7528;&#x5355;&#x4E2A;&#x884C;&#x4E3A;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">HasSomeAttribute</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="nd">@declared_attr.cascading</span>
    <span class="k">def</span> <span class="nf">some_id</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">has_inherited_table</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;myclass.id&apos;</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;id&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">MyClass</span><span class="p">(</span><span class="n">HasSomeAttribute</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="s2">&quot;&quot;</span>
    <span class="c1"># ...</span>

<span class="k">class</span> <span class="nc">MySubClass</span><span class="p">(</span><span class="n">MyClass</span><span class="p">):</span>
    <span class="s2">&quot;&quot;</span>
    <span class="c1"># ...</span></pre></div></div><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-170">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-171"><a class="reference internal" href="orm_extensions_declarative_mixins.html#mixin-inheritance-columns"><span>Mixing in Columns in Inheritance Scenarios</span></a></span></p></div><p><span class="yiyi-st" id="yiyi-172">&#x6700;&#x540E;&#xFF0C;<a class="reference internal" href="orm_extensions_declarative_api.html#sqlalchemy.ext.declarative.AbstractConcreteBase" title="sqlalchemy.ext.declarative.AbstractConcreteBase"><code class="xref py py-class docutils literal"><span class="pre">AbstractConcreteBase</span></code></a>&#x7C7B;&#x5DF2;&#x88AB;&#x91CD;&#x5199;&#xFF0C;&#x4EE5;&#x4FBF;&#x53EF;&#x4EE5;&#x5728;&#x62BD;&#x8C61;&#x57FA;&#x7840;&#x4E0A;&#x5185;&#x8054;&#x8BBE;&#x7F6E;&#x5173;&#x7CFB;&#x6216;&#x5176;&#x4ED6;&#x6620;&#x5C04;&#x5668;&#x5C5E;&#x6027;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">relationship</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="p">(</span><span class="n">declarative_base</span><span class="p">,</span> <span class="n">declared_attr</span><span class="p">,</span>
    <span class="n">AbstractConcreteBase</span><span class="p">)</span>

<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Something</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">u&apos;something&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Abstract</span><span class="p">(</span><span class="n">AbstractConcreteBase</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">something_id</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Something</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>

    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">something</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">relationship</span><span class="p">(</span><span class="n">Something</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Concrete</span><span class="p">(</span><span class="n">Abstract</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">u&apos;cca&apos;</span>
    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&apos;polymorphic_identity&apos;</span><span class="p">:</span> <span class="s1">&apos;cca&apos;</span><span class="p">,</span> <span class="s1">&apos;concrete&apos;</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span></pre></div></div><p><span class="yiyi-st" id="yiyi-173">The above mapping will set up a table <code class="docutils literal"><span class="pre">cca</span></code> with both an <code class="docutils literal"><span class="pre">id</span></code> and a <code class="docutils literal"><span class="pre">something_id</span></code> column, and <code class="docutils literal"><span class="pre">Concrete</span></code> will also have a relationship <code class="docutils literal"><span class="pre">something</span></code>. </span><span class="yiyi-st" id="yiyi-174">&#x65B0;&#x529F;&#x80FD;&#x662F;<code class="docutils literal"><span class="pre">Abstract</span></code>&#x4E5F;&#x5C06;&#x5177;&#x6709;&#x4E00;&#x4E2A;&#x72EC;&#x7ACB;&#x914D;&#x7F6E;&#x7684;&#x5173;&#x7CFB;<code class="docutils literal"><span class="pre">something</span></code>&#xFF0C;&#x8BE5;&#x5173;&#x7CFB;&#x9488;&#x5BF9;&#x57FA;&#x7840;&#x7684;&#x591A;&#x6001;&#x8054;&#x5408;&#x8FDB;&#x884C;&#x6784;&#x5EFA;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-175"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3150">&#xFF03;3150</a> <a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2670">&#xFF03;2670</a> <a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3149">&#xFF03;3149</a> <a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2952">&#xFF03;2952</a> <a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3050">&#xFF03;3050</a></span></p></div><div class="section" id="orm-full-object-fetches-25-faster"><h3><span class="yiyi-st" id="yiyi-176">ORM&#x5168;&#x90E8;&#x5BF9;&#x8C61;&#x7684;&#x8BFB;&#x53D6;&#x901F;&#x5EA6;&#x63D0;&#x9AD8;&#x4E86;25&#xFF05;<a class="headerlink" href="#orm-full-object-fetches-25-faster" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-177"><code class="docutils literal"><span class="pre">loading.py</span></code>&#x6A21;&#x5757;&#x7684;&#x673A;&#x5236;&#x4EE5;&#x53CA;&#x6807;&#x8BC6;&#x6620;&#x5C04;&#x7ECF;&#x8FC7;&#x4E86;&#x5185;&#x8054;&#xFF0C;&#x91CD;&#x6784;&#x548C;&#x4FEE;&#x526A;&#x7684;&#x51E0;&#x4E2A;&#x8FC7;&#x7A0B;&#xFF0C;&#x56E0;&#x6B64;&#x73B0;&#x5728;&#x7684;&#x884C;&#x52A0;&#x8F7D;&#x5927;&#x7EA6;&#x6BD4;&#x57FA;&#x4E8E;OR&#x200B;&#x200B;M&#x7684;&#x5BF9;&#x8C61;&#x5FEB;&#x5927;&#x7EA6;25&#xFF05; &#x3002;</span><span class="yiyi-st" id="yiyi-178">&#x5047;&#x8BBE;&#x6709;&#x4E00;&#x4E2A;1M&#x884C;&#x8868;&#xFF0C;&#x7C7B;&#x4F3C;&#x4E0B;&#x9762;&#x7684;&#x811A;&#x672C;&#x8BF4;&#x660E;&#x4E86;&#x6700;&#x53D7;&#x6539;&#x5584;&#x7684;&#x8D1F;&#x8F7D;&#x7C7B;&#x578B;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">Column</span><span class="p">,</span> <span class="n">create_engine</span><span class="p">,</span> <span class="n">Table</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">Session</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>

<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__table__</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
        <span class="s1">&apos;foo&apos;</span><span class="p">,</span> <span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
        <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;id&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;a&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">(),</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;b&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">(),</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;c&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">(),</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
    <span class="p">)</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
    <span class="s1">&apos;mysql+mysqldb://scott:tiger@localhost/test&apos;</span><span class="p">,</span> <span class="n">echo</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">sess</span> <span class="o">=</span> <span class="n">Session</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>

<span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="c1"># avoid using all() so that we don&apos;t have the overhead of building</span>
<span class="c1"># a large list of full objects in memory</span>
<span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">sess</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Foo</span><span class="p">)</span><span class="o">.</span><span class="n">yield_per</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">1000000</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Total time: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">now</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-179">&#x672C;&#x5730;MacBookPro&#x7684;&#x7ED3;&#x679C;&#x4ECE;0.9&#x79D2;&#x7684;19&#x79D2;&#x964D;&#x81F3;1.0&#x7684;14&#x79D2;&#x3002;</span><span class="yiyi-st" id="yiyi-180">&#x5728;&#x6279;&#x91CF;&#x5904;&#x7406;&#x5927;&#x91CF;&#x884C;&#x65F6;&#xFF0C;<a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query.yield_per" title="sqlalchemy.orm.query.Query.yield_per"><code class="xref py py-meth docutils literal"><span class="pre">Query.yield_per()</span></code></a>&#x8C03;&#x7528;&#x603B;&#x662F;&#x4E00;&#x4E2A;&#x597D;&#x4E3B;&#x610F;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x53EF;&#x4EE5;&#x9632;&#x6B62;Python&#x89E3;&#x91CA;&#x5668;&#x4E0D;&#x5F97;&#x4E0D;&#x4E00;&#x6B21;&#x4E3A;&#x6240;&#x6709;&#x5BF9;&#x8C61;&#x53CA;&#x5176;&#x5DE5;&#x5177;&#x5206;&#x914D;&#x5927;&#x91CF;&#x5185;&#x5B58;&#x3002;</span><span class="yiyi-st" id="yiyi-181">&#x5982;&#x679C;&#x6CA1;&#x6709;<a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query.yield_per" title="sqlalchemy.orm.query.Query.yield_per"><code class="xref py py-meth docutils literal"><span class="pre">Query.yield_per()</span></code></a>&#xFF0C;MacBookPro&#x4E0A;&#x9762;&#x7684;&#x811A;&#x672C;&#x5728;0.9&#x4E0A;&#x662F;31&#x79D2;&#xFF0C;&#x5728;1.0&#x4E0A;&#x662F;26&#x79D2;&#xFF0C;&#x56E0;&#x6B64;&#x9700;&#x8981;&#x82B1;&#x8D39;&#x989D;&#x5916;&#x7684;&#x65F6;&#x95F4;&#x6765;&#x8BBE;&#x7F6E;&#x975E;&#x5E38;&#x5927;&#x7684;&#x5185;&#x5B58;&#x7F13;&#x51B2;&#x533A;&#x3002;</span></p></div><div class="section" id="new-keyedtuple-implementation-dramatically-faster"><h3><span class="yiyi-st" id="yiyi-182">New KeyedTuple&#x5B9E;&#x73B0;&#x663E;&#x7740;&#x52A0;&#x5FEB;<a class="headerlink" href="#new-keyedtuple-implementation-dramatically-faster" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-183">&#x6211;&#x4EEC;&#x770B;&#x4E86;&#x4E00;&#x4E0B;<a class="reference internal" href="orm_query.html#sqlalchemy.util.KeyedTuple" title="sqlalchemy.util.KeyedTuple"><code class="xref py py-class docutils literal"><span class="pre">KeyedTuple</span></code></a>&#x5B9E;&#x73B0;&#xFF0C;&#x5E0C;&#x671B;&#x6539;&#x8FDB;&#x50CF;&#x8FD9;&#x6837;&#x7684;&#x67E5;&#x8BE2;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">rows</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">Foo</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">Foo</span><span class="o">.</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></pre></div></div><p><span class="yiyi-st" id="yiyi-184">&#x4F7F;&#x7528;<a class="reference internal" href="orm_query.html#sqlalchemy.util.KeyedTuple" title="sqlalchemy.util.KeyedTuple"><code class="xref py py-class docutils literal"><span class="pre">KeyedTuple</span></code></a>&#x7C7B;&#x800C;&#x4E0D;&#x662F;Python&#x7684;<code class="docutils literal"><span class="pre">collections.namedtuple()</span></code>&#xFF0C;&#x56E0;&#x4E3A;&#x540E;&#x8005;&#x6709;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x590D;&#x6742;&#x7684;&#x7C7B;&#x578B;&#x521B;&#x5EFA;&#x4F8B;&#x7A0B;&#xFF0C;&#x5176;&#x57FA;&#x51C6;&#x6D4B;&#x8BD5;&#x6BD4;<a class="reference internal" href="orm_query.html#sqlalchemy.util.KeyedTuple" title="sqlalchemy.util.KeyedTuple"><code class="xref py py-class docutils literal"><span class="pre">KeyedTuple</span></code></a></span><span class="yiyi-st" id="yiyi-185">&#x4F46;&#x662F;&#xFF0C;&#x5F53;&#x83B7;&#x53D6;&#x6210;&#x5343;&#x4E0A;&#x4E07;&#x884C;&#x65F6;&#xFF0C;<code class="docutils literal"><span class="pre">collections.namedtuple()</span></code>&#x5FEB;&#x901F;&#x8D85;&#x8FC7;<a class="reference internal" href="orm_query.html#sqlalchemy.util.KeyedTuple" title="sqlalchemy.util.KeyedTuple"><code class="xref py py-class docutils literal"><span class="pre">KeyedTuple</span></code></a>&#xFF0C;&#x968F;&#x7740;&#x5B9E;&#x4F8B;&#x8C03;&#x7528;&#x7684;&#x589E;&#x52A0;&#xFF0C;&#x5B83;&#x53D8;&#x5F97;&#x975E;&#x5E38;&#x6162;&#x3002;</span><span class="yiyi-st" id="yiyi-186">&#x8BE5;&#x600E;&#x4E48;&#x529E;&#xFF1F;</span><span class="yiyi-st" id="yiyi-187">&#x4E24;&#x79CD;&#x65B9;&#x6CD5;&#x4E4B;&#x95F4;&#x8FDB;&#x884C;&#x5BF9;&#x51B2;&#x7684;&#x65B0;&#x7C7B;&#x578B;&#x3002;</span><span class="yiyi-st" id="yiyi-188">&#x57FA;&#x4E8E;&#x54EA;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x65B0;&#x7684;&#x201C;&#x8F7B;&#x91CF;&#x7EA7;&#x952E;&#x63A7;&#x5143;&#x7EC4;&#x201D;&#x8981;&#x4E48;&#x9488;&#x5BF9;&#x201C;&#x5927;&#x5C0F;&#x201D;&#xFF08;&#x8FD4;&#x56DE;&#x7684;&#x884C;&#x6570;&#xFF09;&#x548C;&#x201C;num&#x201D;&#xFF08;&#x9488;&#x5BF9;&#x4E0D;&#x540C;&#x67E5;&#x8BE2;&#x7684;&#x6570;&#x91CF;&#xFF09;&#xFF0C;&#x8981;&#x4E48;&#x4F18;&#x4E8E;&#x4E24;&#x8005;&#xFF0C;&#x8981;&#x4E48;&#x6EDE;&#x540E;&#x4E8E;&#x8F83;&#x5FEB;&#x7684;&#x5BF9;&#x8C61;&#x3002;</span><span class="yiyi-st" id="yiyi-189">&#x5728;&#x201C;&#x751C;&#x871C;&#x70B9;&#x201D;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x65E2;&#x521B;&#x5EFA;&#x4E86;&#x5927;&#x91CF;&#x65B0;&#x7C7B;&#x578B;&#xFF0C;&#x53C8;&#x83B7;&#x53D6;&#x4E86;&#x5F88;&#x591A;&#x884C;&#xFF0C;&#x8F7B;&#x91CF;&#x7EA7;&#x5BF9;&#x8C61;&#x5B8C;&#x5168;&#x5438;&#x5F15;&#x4E86;&#x540D;&#x4E3A;tuple&#x548C;KeyedTuple&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>-----------------
size=10 num=10000                 # few rows, lots of queries
namedtuple: 3.60302400589         # namedtuple falls over
keyedtuple: 0.255059957504        # KeyedTuple very fast
lw keyed tuple: 0.582715034485    # lw keyed trails right on KeyedTuple
-----------------
size=100 num=1000                 # &lt;--- sweet spot
namedtuple: 0.365247011185
keyedtuple: 0.24896979332
lw keyed tuple: 0.0889317989349   # lw keyed blows both away!
-----------------
size=10000 num=100
namedtuple: 0.572599887848
keyedtuple: 2.54251694679
lw keyed tuple: 0.613876104355
-----------------
size=1000000 num=10               # few queries, lots of rows
namedtuple: 5.79669594765         # namedtuple very fast
keyedtuple: 28.856498003          # KeyedTuple falls over
lw keyed tuple: 6.74346804619     # lw keyed trails right on namedtuple</pre></div></div><p><span class="yiyi-st" id="yiyi-190"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3176">&#xFF03;3176  T0&gt;</a></span></p></div><div class="section" id="significant-improvements-in-structural-memory-use"><h3><span class="yiyi-st" id="yiyi-191">&#x7ED3;&#x6784;&#x6027;&#x5185;&#x5B58;&#x4F7F;&#x7528;&#x7684;&#x91CD;&#x5927;&#x6539;&#x8FDB;<a class="headerlink" href="#significant-improvements-in-structural-memory-use" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-192">&#x901A;&#x8FC7;&#x5BF9;&#x8BB8;&#x591A;&#x5185;&#x90E8;&#x5BF9;&#x8C61;&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">__slots__</span></code>&#xFF0C;&#x7ED3;&#x6784;&#x6027;&#x5185;&#x5B58;&#x7684;&#x4F7F;&#x7528;&#x5F97;&#x5230;&#x4E86;&#x6539;&#x8FDB;&#x3002;</span><span class="yiyi-st" id="yiyi-193">&#x6B64;&#x4F18;&#x5316;&#x7279;&#x522B;&#x9002;&#x7528;&#x4E8E;&#x5177;&#x6709;&#x5927;&#x91CF;&#x8868;&#x548C;&#x5217;&#x7684;&#x5927;&#x578B;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x57FA;&#x672C;&#x5185;&#x5B58;&#x5927;&#x5C0F;&#xFF0C;&#x5E76;&#x53EF;&#x51CF;&#x5C11;&#x5404;&#x79CD;&#x9AD8;&#x5BB9;&#x91CF;&#x5BF9;&#x8C61;&#xFF08;&#x5305;&#x62EC;&#x4E8B;&#x4EF6;&#x76D1;&#x542C;&#x5185;&#x90E8;&#x4EF6;&#xFF0C;&#x6BD4;&#x8F83;&#x5BF9;&#x8C61;&#x4EE5;&#x53CA;ORM&#x5C5E;&#x6027;&#x548C;&#x52A0;&#x8F7D;&#x5668;&#x7B56;&#x7565;&#x7CFB;&#x7EDF;&#x7684;&#x67D0;&#x4E9B;&#x90E8;&#x5206;&#xFF09;&#x7684;&#x5185;&#x5B58;&#x5927;&#x5C0F;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-194">&#x5229;&#x7528;heapy&#x6D4B;&#x91CF;Nova&#x7684;&#x542F;&#x52A8;&#x5927;&#x5C0F;&#x7684;&#x4E00;&#x4E2A;&#x5DE5;&#x4F5C;&#x53F0;&#x8BF4;&#x660E;&#x4E86;&#x5728;&#x57FA;&#x672C;&#x5BFC;&#x5165;&#x201C;nova.db.&#x201D;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;SQLAlchemy&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x76F8;&#x5173;&#x5B57;&#x5178;&#x4EE5;&#x53CA;&#x5F31;&#x5F15;&#x7528;&#x5360;&#x7528;&#x4E86;&#x5927;&#x7EA6;3.7&#x4E2A;megs&#x6216;46&#xFF05;&#x7684;&#x5DEE;&#x5F02;&#xFF0C;&#x5373;46&#xFF05;&#x3002; sqlalchemy.models&#x201D;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span># reported by heapy, summation of SQLAlchemy objects +
# associated dicts + weakref-related objects with core of Nova imported:

    Before: total count 26477 total bytes 7975712
    After: total count 18181 total bytes 4236456

# reported for the Python module space overall with the
# core of Nova imported:

    Before: Partition of a set of 355558 objects. Total size = 61661760 bytes.
    After: Partition of a set of 346034 objects. Total size = 57808016 bytes.</pre></div></div></div><div class="section" id="update-statements-are-now-batched-with-executemany-in-a-flush"><h3><span class="yiyi-st" id="yiyi-195">UPDATE&#x8BED;&#x53E5;&#x73B0;&#x5728;&#x5728;flush <a class="headerlink" href="#update-statements-are-now-batched-with-executemany-in-a-flush" title="Permalink to this headline">&#xB6;</a>&#x4E2D;&#x4E0E;executemany()&#x4E00;&#x8D77;&#x8FDB;&#x884C;&#x6279;&#x5904;&#x7406;</span></h3><p><span class="yiyi-st" id="yiyi-196">UPDATE&#x8BED;&#x53E5;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x5728;&#x4E00;&#x4E2A;ORM flush&#x5185;&#x6279;&#x5904;&#x7406;&#x4E3A;&#x66F4;&#x9AD8;&#x6027;&#x80FD;&#x7684;executemany()&#x8C03;&#x7528;&#xFF0C;&#x7C7B;&#x4F3C;&#x4E8E;INSERT&#x8BED;&#x53E5;&#x53EF;&#x4EE5;&#x6279;&#x5904;&#x7406;&#x7684;&#x65B9;&#x5F0F;&#xFF1B;&#x8FD9;&#x5C06;&#x5728;&#x57FA;&#x4E8E;&#x4EE5;&#x4E0B;&#x6807;&#x51C6;&#x7684;flush&#x5185;&#x88AB;&#x8C03;&#x7528;&#xFF1A;</span></p><ul class="simple"><li><span class="yiyi-st" id="yiyi-197">&#x6309;&#x987A;&#x5E8F;&#x7684;&#x4E24;&#x4E2A;&#x6216;&#x591A;&#x4E2A;UPDATE&#x8BED;&#x53E5;&#x6D89;&#x53CA;&#x8981;&#x4FEE;&#x6539;&#x7684;&#x76F8;&#x540C;&#x7684;&#x4E00;&#x7EC4;&#x5217;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-198">&#x8BE5;&#x8BED;&#x53E5;&#x5728;SET&#x5B50;&#x53E5;&#x4E2D;&#x6CA1;&#x6709;&#x5D4C;&#x5165;&#x5F0F;SQL&#x8868;&#x8FBE;&#x5F0F;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-199">&#x6620;&#x5C04;&#x4E0D;&#x4F7F;&#x7528;<a class="reference internal" href="orm_mapping_api.html#sqlalchemy.orm.mapper.params.version_id_col" title="sqlalchemy.orm.mapper"><code class="xref py py-paramref docutils literal"><span class="pre">version_id_col</span></code></a>&#xFF0C;&#x6216;&#x8005;&#x540E;&#x7AEF;dialect&#x652F;&#x6301;executemany()&#x64CD;&#x4F5C;&#x7684;&#x201C;&#x7406;&#x667A;&#x201D;&#x884C;&#x8BA1;&#x6570;&#xFF1B;&#x5927;&#x591A;&#x6570;DBAPI&#x73B0;&#x5728;&#x90FD;&#x80FD;&#x6B63;&#x786E;&#x652F;&#x6301;&#x8FD9;&#x4E00;&#x70B9;&#x3002;</span></li></ul></div><div class="section" id="session-get-bind-handles-a-wider-variety-of-inheritance-scenarios"><h3><span class="yiyi-st" id="yiyi-200">Session.get_bind()&#x5904;&#x7406;&#x66F4;&#x5E7F;&#x6CDB;&#x7684;&#x7EE7;&#x627F;&#x573A;&#x666F;<a class="headerlink" href="#session-get-bind-handles-a-wider-variety-of-inheritance-scenarios" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-201">&#x53EA;&#x8981;&#x67E5;&#x8BE2;&#x6216;&#x5DE5;&#x4F5C;&#x5355;&#x5143;&#x6E05;&#x7406;&#x8FC7;&#x7A0B;&#x8BD5;&#x56FE;&#x627E;&#x5230;&#x4E0E;&#x7279;&#x5B9A;&#x7C7B;&#x76F8;&#x5BF9;&#x5E94;&#x7684;&#x6570;&#x636E;&#x5E93;&#x5F15;&#x64CE;&#xFF0C;&#x5C31;&#x4F1A;&#x8C03;&#x7528;<a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session.get_bind" title="sqlalchemy.orm.session.Session.get_bind"><code class="xref py py-meth docutils literal"><span class="pre">Session.get_bind()</span></code></a>&#x65B9;&#x6CD5;&#x3002;</span><span class="yiyi-st" id="yiyi-202">&#x8BE5;&#x65B9;&#x6CD5;&#x5DF2;&#x5F97;&#x5230;&#x6539;&#x8FDB;&#xFF0C;&#x53EF;&#x5904;&#x7406;&#x5404;&#x79CD;&#x9762;&#x5411;&#x7EE7;&#x627F;&#x7684;&#x573A;&#x666F;&#xFF0C;&#x5176;&#x4E2D;&#x5305;&#x62EC;&#xFF1A;</span></p><ul><li><p class="first"><span class="yiyi-st" id="yiyi-203">&#x7ED1;&#x5B9A;&#x5230;Mixin&#x6216;&#x62BD;&#x8C61;&#x7C7B;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyClass</span><span class="p">(</span><span class="n">SomeMixin</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;my_table&apos;</span>
    <span class="c1"># ...</span>

<span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">(</span><span class="n">binds</span><span class="o">=</span><span class="p">{</span><span class="n">SomeMixin</span><span class="p">:</span> <span class="n">some_engine</span><span class="p">})</span></pre></div></div></li><li><p class="first"><span class="yiyi-st" id="yiyi-204">&#x57FA;&#x4E8E;&#x8868;&#x5355;&#x72EC;&#x7ED1;&#x5B9A;&#x5230;&#x7EE7;&#x627F;&#x7684;&#x5177;&#x4F53;&#x5B50;&#x7C7B;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BaseClass</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;base&apos;</span>

    <span class="c1"># ...</span>

<span class="k">class</span> <span class="nc">ConcreteSubClass</span><span class="p">(</span><span class="n">BaseClass</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;concrete&apos;</span>

    <span class="c1"># ...</span>

    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&apos;concrete&apos;</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>


<span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">(</span><span class="n">binds</span><span class="o">=</span><span class="p">{</span>
    <span class="n">base_table</span><span class="p">:</span> <span class="n">some_engine</span><span class="p">,</span>
    <span class="n">concrete_table</span><span class="p">:</span> <span class="n">some_other_engine</span>
<span class="p">})</span></pre></div></div></li></ul><p><span class="yiyi-st" id="yiyi-205"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3035">&#xFF03;3035  T0&gt;</a></span></p></div><div class="section" id="session-get-bind-will-receive-the-mapper-in-all-relevant-query-cases"><h3><span class="yiyi-st" id="yiyi-206">Session.get_bind()&#x5C06;&#x5728;&#x6240;&#x6709;&#x76F8;&#x5173;&#x7684;&#x67E5;&#x8BE2;&#x6848;&#x4F8B;&#x4E2D;&#x63A5;&#x6536;&#x6620;&#x5C04;&#x5668;<a class="headerlink" href="#session-get-bind-will-receive-the-mapper-in-all-relevant-query-cases" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-207">A series of issues were repaired where the <a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session.get_bind" title="sqlalchemy.orm.session.Session.get_bind"><code class="xref py py-meth docutils literal"><span class="pre">Session.get_bind()</span></code></a> would not receive the primary <a class="reference internal" href="orm_mapping_api.html#sqlalchemy.orm.mapper.Mapper" title="sqlalchemy.orm.mapper.Mapper"><code class="xref py py-class docutils literal"><span class="pre">Mapper</span></code></a> of the <a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query" title="sqlalchemy.orm.query.Query"><code class="xref py py-class docutils literal"><span class="pre">Query</span></code></a>, even though this mapper was readily available (the primary mapper is the single mapper, or alternatively the first mapper, that is associated with a <a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query" title="sqlalchemy.orm.query.Query"><code class="xref py py-class docutils literal"><span class="pre">Query</span></code></a> object).</span></p><p><span class="yiyi-st" id="yiyi-208">The <a class="reference internal" href="orm_mapping_api.html#sqlalchemy.orm.mapper.Mapper" title="sqlalchemy.orm.mapper.Mapper"><code class="xref py py-class docutils literal"><span class="pre">Mapper</span></code></a> object, when passed to <a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session.get_bind" title="sqlalchemy.orm.session.Session.get_bind"><code class="xref py py-meth docutils literal"><span class="pre">Session.get_bind()</span></code></a>, is typically used by sessions that make use of the <a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session.params.binds" title="sqlalchemy.orm.session.Session"><code class="xref py py-paramref docutils literal"><span class="pre">Session.binds</span></code></a> parameter to associate mappers with a series of engines (although in this use case, things frequently &#x201C;worked&#x201D; in most cases anyway as the bind would be located via the mapped table object), or more specifically implement a user-defined <a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session.get_bind" title="sqlalchemy.orm.session.Session.get_bind"><code class="xref py py-meth docutils literal"><span class="pre">Session.get_bind()</span></code></a> method that provies some pattern of selecting engines based on mappers, such as horizontal sharding or a so-called &#x201C;routing&#x201D; session that routes queries to different backends.</span></p><p><span class="yiyi-st" id="yiyi-209">&#x8FD9;&#x4E9B;&#x60C5;&#x666F;&#x5305;&#x62EC;&#xFF1A;</span></p><ul><li><p class="first"><span class="yiyi-st" id="yiyi-210"><a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query.count" title="sqlalchemy.orm.query.Query.count"><code class="xref py py-meth docutils literal"><span class="pre">Query.count()</span></code></a></span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span></pre></div></div></li><li><p class="first"><span class="yiyi-st" id="yiyi-211"><a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query.update" title="sqlalchemy.orm.query.Query.update"><code class="xref py py-meth docutils literal"><span class="pre">Query.update()</span></code></a>&#x548C;<a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query.delete" title="sqlalchemy.orm.query.Query.delete"><code class="xref py py-meth docutils literal"><span class="pre">Query.delete()</span></code></a>&#xFF0C;&#x7528;&#x4E8E;UPDATE / DELETE&#x8BED;&#x53E5;&#x4EE5;&#x53CA;&#x201C;fetch&#x201D;&#x7B56;&#x7565;&#x4F7F;&#x7528;&#x7684;SELECT&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;foob&quot;</span><span class="p">},</span> <span class="n">synchronize_session</span><span class="o">=</span><span class="s1">&apos;fetch&apos;</span><span class="p">)</span>

<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
        <span class="n">synchronize_session</span><span class="o">=</span><span class="s1">&apos;fetch&apos;</span><span class="p">)</span></pre></div></div></li><li><p class="first"><span class="yiyi-st" id="yiyi-212">&#x9488;&#x5BF9;&#x5355;&#x4E2A;&#x5217;&#x7684;&#x67E5;&#x8BE2;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">User</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></pre></div></div></li><li><p class="first"><span class="yiyi-st" id="yiyi-213">SQL&#x51FD;&#x6570;&#x548C;&#x5176;&#x4ED6;&#x9488;&#x5BF9;&#x95F4;&#x63A5;&#x6620;&#x5C04;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x5982;<a class="reference internal" href="orm_mapping_columns.html#sqlalchemy.orm.column_property" title="sqlalchemy.orm.column_property"><code class="xref py py-obj docutils literal"><span class="pre">column_property</span></code></a>&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>class User(Base):
    # ...

    score = column_property(func.coalesce(self.tables.users.c.name, None)))

session.query(func.max(User.score)).scalar()</pre></div></div></li></ul><p><span class="yiyi-st" id="yiyi-214"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3227">&#xFF03;3227</a> <a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3242">&#xFF03;3242</a> <a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/1326">&#xFF03;1326</a></span></p></div><div class="section" id="info-dictionary-improvements"><h3><span class="yiyi-st" id="yiyi-215">.info&#x5B57;&#x5178;&#x6539;&#x8FDB;<a class="headerlink" href="#info-dictionary-improvements" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-216"><code class="xref py py-attr docutils literal"><span class="pre">InspectionAttr.info</span></code>&#x96C6;&#x5408;&#x73B0;&#x5728;&#x53EF;&#x7528;&#x4E8E;&#x4ECE;<a class="reference internal" href="orm_mapping_api.html#sqlalchemy.orm.mapper.Mapper.all_orm_descriptors" title="sqlalchemy.orm.mapper.Mapper.all_orm_descriptors"><code class="xref py py-attr docutils literal"><span class="pre">Mapper.all_orm_descriptors</span></code></a>&#x96C6;&#x5408;&#x4E2D;&#x68C0;&#x7D22;&#x7684;&#x6BCF;&#x79CD;&#x5BF9;&#x8C61;&#x3002;</span><span class="yiyi-st" id="yiyi-217">&#x8FD9;&#x5305;&#x62EC;<a class="reference internal" href="orm_extensions_hybrid.html#sqlalchemy.ext.hybrid.hybrid_property" title="sqlalchemy.ext.hybrid.hybrid_property"><code class="xref py py-class docutils literal"><span class="pre">hybrid_property</span></code></a>&#x548C;<a class="reference internal" href="orm_extensions_associationproxy.html#sqlalchemy.ext.associationproxy.association_proxy" title="sqlalchemy.ext.associationproxy.association_proxy"><code class="xref py py-func docutils literal"><span class="pre">association_proxy()</span></code></a>&#x3002;</span><span class="yiyi-st" id="yiyi-218">&#x4F46;&#x662F;&#xFF0C;&#x7531;&#x4E8E;&#x8FD9;&#x4E9B;&#x5BF9;&#x8C61;&#x662F;&#x7C7B;&#x7ED1;&#x5B9A;&#x63CF;&#x8FF0;&#x7B26;&#xFF0C;&#x56E0;&#x6B64;&#x5FC5;&#x987B;&#x4ECE;&#x5B83;&#x4EEC;&#x6240;&#x8FDE;&#x63A5;&#x7684;&#x7C7B;&#x4E2D;&#x5206;&#x522B;&#x8BBF;&#x95EE;<strong>&#xFF0C;&#x4EE5;&#x4FBF;&#x83B7;&#x53D6;&#x8BE5;&#x5C5E;&#x6027;&#x3002;</strong></span><span class="yiyi-st" id="yiyi-219">&#x4E0B;&#x9762;&#x662F;&#x4F7F;&#x7528;<a class="reference internal" href="orm_mapping_api.html#sqlalchemy.orm.mapper.Mapper.all_orm_descriptors" title="sqlalchemy.orm.mapper.Mapper.all_orm_descriptors"><code class="xref py py-attr docutils literal"><span class="pre">Mapper.all_orm_descriptors</span></code></a>&#x540D;&#x79F0;&#x7A7A;&#x95F4;&#x7684;&#x793A;&#x4F8B;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SomeObject</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="c1"># ...</span>

    <span class="nd">@hybrid_property</span>
    <span class="k">def</span> <span class="nf">some_prop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="mi">5</span>


<span class="n">inspect</span><span class="p">(</span><span class="n">SomeObject</span><span class="p">)</span><span class="o">.</span><span class="n">all_orm_descriptors</span><span class="o">.</span><span class="n">some_prop</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&apos;foo&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&apos;bar&apos;</span></pre></div></div><p><span class="yiyi-st" id="yiyi-220">&#x5B83;&#x4E5F;&#x53EF;&#x4F5C;&#x4E3A;&#x6240;&#x6709;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.SchemaItem" title="sqlalchemy.schema.SchemaItem"><code class="xref py py-class docutils literal"><span class="pre">SchemaItem</span></code></a>&#x5BF9;&#x8C61;&#xFF08;&#x4F8B;&#x5982;<a class="reference internal" href="core_constraints.html#sqlalchemy.schema.ForeignKey" title="sqlalchemy.schema.ForeignKey"><code class="xref py py-class docutils literal"><span class="pre">ForeignKey</span></code></a>&#xFF0C;<a class="reference internal" href="core_constraints.html#sqlalchemy.schema.UniqueConstraint" title="sqlalchemy.schema.UniqueConstraint"><code class="xref py py-class docutils literal"><span class="pre">UniqueConstraint</span></code></a>&#x7B49;&#xFF09;&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;&#x53C2;&#x6570;&#x4F7F;&#x7528;&#x3002;</span><span class="yiyi-st" id="yiyi-221">&#x4EE5;&#x53CA;&#x5176;&#x4F59;&#x7684;ORM&#x7ED3;&#x6784;&#xFF0C;&#x5982;<a class="reference internal" href="orm_mapped_attributes.html#sqlalchemy.orm.synonym" title="sqlalchemy.orm.synonym"><code class="xref py py-func docutils literal"><span class="pre">orm.synonym()</span></code></a>&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-222"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2971">&#xFF03;2971  T0&gt;</a></span></p><p><span class="yiyi-st" id="yiyi-223"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2963">&#xFF03;2963  T0&gt;</a></span></p></div><div class="section" id="columnproperty-constructs-work-a-lot-better-with-aliases-order-by"><h3><span class="yiyi-st" id="yiyi-224">&#x4F7F;&#x7528;&#x522B;&#x540D;order_by <a class="headerlink" href="#columnproperty-constructs-work-a-lot-better-with-aliases-order-by" title="Permalink to this headline">&#xB6;</a>&#xFF0C;ColumnProperty&#x6784;&#x9020;&#x53EF;&#x4EE5;&#x66F4;&#x597D;&#x5730;&#x5DE5;&#x4F5C;</span></h3><p><span class="yiyi-st" id="yiyi-225">&#x6709;&#x5173;<a class="reference internal" href="orm_mapping_columns.html#sqlalchemy.orm.column_property" title="sqlalchemy.orm.column_property"><code class="xref py py-func docutils literal"><span class="pre">column_property()</span></code></a>&#x7684;&#x5404;&#x79CD;&#x95EE;&#x9898;&#x5DF2;&#x5F97;&#x5230;&#x4FEE;&#x590D;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x9488;&#x5BF9;<a class="reference internal" href="orm_query.html#sqlalchemy.orm.aliased" title="sqlalchemy.orm.aliased"><code class="xref py py-func docutils literal"><span class="pre">aliased()</span></code></a>&#x6784;&#x9020;&#x4EE5;&#x53CA;0.9&#x4E2D;&#x5F15;&#x5165;&#x7684;&#x201C;&#x6309;&#x6807;&#x53F7;&#x6392;&#x5E8F;&#x201D;&#x903B;&#x8F91;&#x8BF7;&#x53C2;&#x9605;<a class="reference internal" href="migration_09.html#migration-1068"><span>Label constructs can now render as their name alone in an ORDER BY</span></a>&#x4E2D;&#x5355;&#x72EC;&#x5448;&#x73B0;&#x5176;&#x540D;&#x79F0;&#xFF09;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-226">&#x7ED9;&#x5B9A;&#x5982;&#x4E0B;&#x6620;&#x5C04;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;a&apos;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;b&apos;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">a_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;a.id&apos;</span><span class="p">))</span>


<span class="n">A</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">column_property</span><span class="p">(</span>
        <span class="n">select</span><span class="p">([</span><span class="n">func</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">id</span><span class="p">)])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">a_id</span> <span class="o">==</span> <span class="n">A</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-227">&#x5305;&#x542B;&#x201C;A.b&#x201D;&#x4E24;&#x6B21;&#x7684;&#x7B80;&#x5355;&#x573A;&#x666F;&#x5C06;&#x65E0;&#x6CD5;&#x6B63;&#x786E;&#x5448;&#x73B0;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">sess</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">a1</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">a1</span><span class="o">.</span><span class="n">b</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-228">&#x8FD9;&#x5C06;&#x6309;&#x9519;&#x8BEF;&#x7684;&#x5217;&#x6392;&#x5E8F;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT a.id AS a_id, (SELECT max(b.id) AS max_1 FROM b
WHERE b.a_id = a.id) AS anon_1, a_1.id AS a_1_id,
(SELECT max(b.id) AS max_2
FROM b WHERE b.a_id = a_1.id) AS anon_2
FROM a, a AS a_1 ORDER BY anon_1</pre></div></div><p><span class="yiyi-st" id="yiyi-229">&#x65B0;&#x4EA7;&#x51FA;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT a.id AS a_id, (SELECT max(b.id) AS max_1
FROM b WHERE b.a_id = a.id) AS anon_1, a_1.id AS a_1_id,
(SELECT max(b.id) AS max_2
FROM b WHERE b.a_id = a_1.id) AS anon_2
FROM a, a AS a_1 ORDER BY anon_2</pre></div></div><p><span class="yiyi-st" id="yiyi-230">&#x4E5F;&#x6709;&#x8BB8;&#x591A;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x201C;&#x6309;&#x987A;&#x5E8F;&#x6392;&#x5217;&#x201D;&#x903B;&#x8F91;&#x5C06;&#x65E0;&#x6CD5;&#x6309;&#x6807;&#x7B7E;&#x6392;&#x5E8F;&#xFF0C;&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x6620;&#x5C04;&#x662F;&#x201C;&#x591A;&#x6001;&#x201D;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;a&apos;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>

    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&apos;polymorphic_on&apos;</span><span class="p">:</span> <span class="nb">type</span><span class="p">,</span> <span class="s1">&apos;with_polymorphic&apos;</span><span class="p">:</span> <span class="s1">&apos;*&apos;</span><span class="p">}</span></pre></div></div><p><span class="yiyi-st" id="yiyi-231">order_by&#x5C06;&#x65E0;&#x6CD5;&#x4F7F;&#x7528;&#x6807;&#x7B7E;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4F1A;&#x56E0;&#x591A;&#x6001;&#x52A0;&#x8F7D;&#x800C;&#x88AB;&#x533F;&#x540D;&#x5316;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT a.id AS a_id, a.type AS a_type, (SELECT max(b.id) AS max_1
FROM b WHERE b.a_id = a.id) AS anon_1
FROM a ORDER BY (SELECT max(b.id) AS max_2
FROM b WHERE b.a_id = a.id)</pre></div></div><p><span class="yiyi-st" id="yiyi-232">&#x73B0;&#x5728;&#x6807;&#x7B7E;&#x7684;&#x987A;&#x5E8F;&#x8DDF;&#x8E2A;&#x533F;&#x540D;&#x6807;&#x7B7E;&#xFF0C;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT a.id AS a_id, a.type AS a_type, (SELECT max(b.id) AS max_1
FROM b WHERE b.a_id = a.id) AS anon_1
FROM a ORDER BY anon_1</pre></div></div><p><span class="yiyi-st" id="yiyi-233">&#x8FD9;&#x4E9B;&#x4FEE;&#x590D;&#x5305;&#x62EC;&#x5404;&#x79CD;&#x53EF;&#x80FD;&#x7834;&#x574F;<code class="docutils literal"><span class="pre">aliased()</span></code>&#x7ED3;&#x6784;&#x72B6;&#x6001;&#x7684;heisenbugs&#xFF0C;&#x8FD9;&#x6837;&#x6807;&#x7B7E;&#x903B;&#x8F91;&#x5C06;&#x518D;&#x6B21;&#x5931;&#x8D25;&#xFF1B;&#x8FD9;&#x4E9B;&#x4E5F;&#x5DF2;&#x88AB;&#x4FEE;&#x590D;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-234"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3148">&#xFF03;3148</a> <a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3188">&#xFF03;3188</a></span></p></div></div><div class="section" id="new-features-and-improvements-core"><h2><span class="yiyi-st" id="yiyi-235">&#x65B0;&#x529F;&#x80FD;&#x548C;&#x6539;&#x8FDB; - &#x6838;&#x5FC3;<a class="headerlink" href="#new-features-and-improvements-core" title="Permalink to this headline">&#xB6;</a></span></h2><div class="section" id="select-query-limit-offset-may-be-specified-as-an-arbitrary-sql-expression"><h3><span class="yiyi-st" id="yiyi-236">&#x9009;&#x62E9;/&#x67E5;&#x8BE2;LIMIT / OFFSET&#x53EF;&#x4EE5;&#x88AB;&#x6307;&#x5B9A;&#x4E3A;&#x4EFB;&#x610F;&#x7684;SQL&#x8868;&#x8FBE;&#x5F0F;<a class="headerlink" href="#select-query-limit-offset-may-be-specified-as-an-arbitrary-sql-expression" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-237">&#x9664;&#x4E86;&#x6574;&#x6570;&#x503C;&#x4E4B;&#x5916;&#xFF0C;<a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.Select.limit" title="sqlalchemy.sql.expression.Select.limit"><code class="xref py py-meth docutils literal"><span class="pre">Select.limit()</span></code></a>&#x548C;<a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.Select.offset" title="sqlalchemy.sql.expression.Select.offset"><code class="xref py py-meth docutils literal"><span class="pre">Select.offset()</span></code></a>&#x65B9;&#x6CD5;&#x73B0;&#x5728;&#x63A5;&#x53D7;&#x4EFB;&#x4F55;SQL&#x8868;&#x8FBE;&#x5F0F;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x3002;</span><span class="yiyi-st" id="yiyi-238">ORM <a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query" title="sqlalchemy.orm.query.Query"><code class="xref py py-class docutils literal"><span class="pre">Query</span></code></a>&#x5BF9;&#x8C61;&#x4E5F;&#x4F1A;&#x5C06;&#x4EFB;&#x4F55;&#x8868;&#x8FBE;&#x5F0F;&#x4F20;&#x9012;&#x7ED9;&#x5E95;&#x5C42;&#x7684;<a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal"><span class="pre">Select</span></code></a>&#x5BF9;&#x8C61;&#x3002;</span><span class="yiyi-st" id="yiyi-239">&#x901A;&#x5E38;&#xFF0C;&#x8FD9;&#x7528;&#x4E8E;&#x5141;&#x8BB8;&#x4F20;&#x9012;&#x4E00;&#x4E2A;&#x7ED1;&#x5B9A;&#x53C2;&#x6570;&#xFF0C;&#x4EE5;&#x540E;&#x53EF;&#x4EE5;&#x7528;&#x4E00;&#x4E2A;&#x503C;&#x66FF;&#x6362;&#x5B83;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">sel</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">table</span><span class="p">])</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="n">bindparam</span><span class="p">(</span><span class="s1">&apos;mylimit&apos;</span><span class="p">))</span><span class="o">.</span><span class="n">offset</span><span class="p">(</span><span class="n">bindparam</span><span class="p">(</span><span class="s1">&apos;myoffset&apos;</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-240">&#x4E0D;&#x652F;&#x6301;&#x975E;&#x6574;&#x6570;LIMIT&#x6216;OFFSET&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x65B9;&#x8A00;&#x53EF;&#x80FD;&#x4F1A;&#x7EE7;&#x7EED;&#x4E0D;&#x652F;&#x6301;&#x6B64;&#x884C;&#x4E3A;&#xFF1B;&#x7B2C;&#x4E09;&#x65B9;&#x65B9;&#x8A00;&#x4E5F;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x4FEE;&#x6539;&#x624D;&#x80FD;&#x5229;&#x7528;&#x65B0;&#x7684;&#x884C;&#x4E3A;&#x3002;</span><span class="yiyi-st" id="yiyi-241">&#x5F53;&#x524D;&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">._limit</span></code>&#x6216;<code class="docutils literal"><span class="pre">._offset</span></code>&#x5C5E;&#x6027;&#x7684;&#x65B9;&#x8A00;&#x5C06;&#x7EE7;&#x7EED;&#x9002;&#x7528;&#x4E8E;&#x6781;&#x9650;/&#x504F;&#x79FB;&#x88AB;&#x6307;&#x5B9A;&#x4E3A;&#x7B80;&#x5355;&#x6574;&#x6570;&#x503C;&#x7684;&#x60C5;&#x51B5;&#x3002;</span><span class="yiyi-st" id="yiyi-242">&#x4F46;&#x662F;&#xFF0C;&#x5F53;&#x6307;&#x5B9A;SQL&#x8868;&#x8FBE;&#x5F0F;&#x65F6;&#xFF0C;&#x8FD9;&#x4E24;&#x4E2A;&#x5C5E;&#x6027;&#x5C06;&#x5728;&#x8BBF;&#x95EE;&#x65F6;&#x5F15;&#x53D1;<a class="reference internal" href="core_exceptions.html#sqlalchemy.exc.CompileError" title="sqlalchemy.exc.CompileError"><code class="xref py py-class docutils literal"><span class="pre">CompileError</span></code></a>&#x3002;</span><span class="yiyi-st" id="yiyi-243">&#x5E0C;&#x671B;&#x652F;&#x6301;&#x65B0;&#x529F;&#x80FD;&#x7684;&#x7B2C;&#x4E09;&#x65B9;&#x65B9;&#x8A00;&#x73B0;&#x5728;&#x5E94;&#x8BE5;&#x8C03;&#x7528;<code class="docutils literal"><span class="pre">._limit_clause</span></code>&#x548C;<code class="docutils literal"><span class="pre">._offset_clause</span></code>&#x5C5E;&#x6027;&#x6765;&#x63A5;&#x6536;&#x5B8C;&#x6574;&#x7684;SQL&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x6574;&#x6570;&#x503C;&#x3002;</span></p></div><div class="section" id="the-use-alter-flag-on-foreignkeyconstraint-is-usually-no-longer-needed"><h3><span class="yiyi-st" id="yiyi-244"><code class="docutils literal"><span class="pre">ForeignKeyConstraint</span></code>&#x4E0A;&#x7684;<code class="docutils literal"><span class="pre">use_alter</span></code>&#x6807;&#x5FD7;&#xFF08;&#x901A;&#x5E38;&#xFF09;&#x4E0D;&#x518D;&#x9700;&#x8981;<a class="headerlink" href="#the-use-alter-flag-on-foreignkeyconstraint-is-usually-no-longer-needed" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-245">The <a class="reference internal" href="core_metadata.html#sqlalchemy.schema.MetaData.create_all" title="sqlalchemy.schema.MetaData.create_all"><code class="xref py py-meth docutils literal"><span class="pre">MetaData.create_all()</span></code></a> and <a class="reference internal" href="core_metadata.html#sqlalchemy.schema.MetaData.drop_all" title="sqlalchemy.schema.MetaData.drop_all"><code class="xref py py-meth docutils literal"><span class="pre">MetaData.drop_all()</span></code></a> methods will now make use of a system that automatically renders an ALTER statement for foreign key constraints that are involved in mutually-dependent cycles between tables, without the need to specify <a class="reference internal" href="core_constraints.html#sqlalchemy.schema.ForeignKeyConstraint.params.use_alter" title="sqlalchemy.schema.ForeignKeyConstraint"><code class="xref py py-paramref docutils literal"><span class="pre">ForeignKeyConstraint.use_alter</span></code></a>. </span><span class="yiyi-st" id="yiyi-246">&#x6B64;&#x5916;&#xFF0C;&#x5916;&#x952E;&#x7EA6;&#x675F;&#x4E0D;&#x518D;&#x9700;&#x8981;&#x6709;&#x4E00;&#x4E2A;&#x540D;&#x79F0;&#x624D;&#x80FD;&#x901A;&#x8FC7;ALTER&#x521B;&#x5EFA;&#xFF1B;&#x53EA;&#x6709;DROP&#x64CD;&#x4F5C;&#x9700;&#x8981;&#x540D;&#x79F0;&#x3002;</span><span class="yiyi-st" id="yiyi-247">&#x5728;DROP&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8BE5;&#x529F;&#x80FD;&#x5C06;&#x786E;&#x4FDD;&#x53EA;&#x6709;&#x5177;&#x6709;&#x660E;&#x786E;&#x540D;&#x79F0;&#x7684;&#x7EA6;&#x675F;&#x5B9E;&#x9645;&#x4E0A;&#x5305;&#x542B;&#x5728;ALTER&#x8BED;&#x53E5;&#x4E2D;&#x3002;</span><span class="yiyi-st" id="yiyi-248">&#x5982;&#x679C;DROP&#x65E0;&#x6CD5;&#x89E3;&#x51B3;&#xFF0C;&#x5219;&#x7CFB;&#x7EDF;&#x73B0;&#x5728;&#x53D1;&#x51FA;&#x4E00;&#x4E2A;&#x7B80;&#x6D01;&#x660E;&#x4E86;&#x7684;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#xFF0C;&#x5982;&#x679C;DROP&#x65E0;&#x6CD5;&#x7EE7;&#x7EED;&#x8FDB;&#x884C;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-249"><a class="reference internal" href="core_constraints.html#sqlalchemy.schema.ForeignKeyConstraint.params.use_alter" title="sqlalchemy.schema.ForeignKeyConstraint"><code class="xref py py-paramref docutils literal"><span class="pre">ForeignKeyConstraint.use_alter</span></code></a>&#x548C;<a class="reference internal" href="core_constraints.html#sqlalchemy.schema.ForeignKey.params.use_alter" title="sqlalchemy.schema.ForeignKey"><code class="xref py py-paramref docutils literal"><span class="pre">ForeignKey.use_alter</span></code></a>&#x6807;&#x5FD7;&#x4FDD;&#x6301;&#x4E0D;&#x53D8;&#xFF0C;&#x5E76;&#x4E14;&#x5728;CREATE / DROP&#x573A;&#x666F;&#x4E2D;&#x7EE7;&#x7EED;&#x5177;&#x6709;&#x5EFA;&#x7ACB;&#x90A3;&#x4E9B;&#x9700;&#x8981;ALTER&#x7684;&#x7EA6;&#x675F;&#x7684;&#x6548;&#x679C;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-250">&#x4ECE;&#x7248;&#x672C;1.0.1&#x5F00;&#x59CB;&#xFF0C;&#x5982;&#x679C;SQLite&#x4E0D;&#x652F;&#x6301;ALTER&#xFF0C;&#x90A3;&#x4E48;&#x5728;DROP&#x671F;&#x95F4;&#xFF0C;&#x7ED9;&#x5B9A;&#x7684;&#x8868;&#x6709;&#x4E00;&#x4E2A;&#x65E0;&#x6CD5;&#x89E3;&#x6790;&#x7684;&#x5468;&#x671F;&#xFF1B;&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#x4F1A;&#x53D1;&#x51FA;&#x8B66;&#x544A;&#xFF0C;&#x5E76;&#x4E14;&#x6309;&#x7167;<strong>no</strong>&#x987A;&#x5E8F;&#x5220;&#x9664;&#x8FD9;&#x4E9B;&#x8868;&#xFF0C;&#x9664;&#x975E;&#x542F;&#x7528;&#x7EA6;&#x675F;&#xFF0C;&#x5426;&#x5219;&#x8FD9;&#x901A;&#x5E38;&#x5728;SQLite&#x4E0A;&#x53EF;&#x4EE5;&#x6B63;&#x5E38;&#x5DE5;&#x4F5C;&#x3002;</span><span class="yiyi-st" id="yiyi-251">&#x8981;&#x89E3;&#x51B3;&#x8B66;&#x544A;&#x5E76;&#x7EE7;&#x7EED;&#x81F3;&#x5C11;&#x5BF9;SQLite&#x6570;&#x636E;&#x5E93;&#x8FDB;&#x884C;&#x90E8;&#x5206;&#x6392;&#x5E8F;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x5728;&#x542F;&#x7528;&#x4E86;&#x7EA6;&#x675F;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5C06;&#x201C;use_alter&#x201D;&#x6807;&#x5FD7;&#x91CD;&#x65B0;&#x5E94;&#x7528;&#x4E8E;&#x8FD9;&#x4E9B;<a class="reference internal" href="core_constraints.html#sqlalchemy.schema.ForeignKey" title="sqlalchemy.schema.ForeignKey"><code class="xref py py-class docutils literal"><span class="pre">ForeignKey</span></code></a>&#x548C;<a class="reference internal" href="core_constraints.html#sqlalchemy.schema.ForeignKeyConstraint" title="sqlalchemy.schema.ForeignKeyConstraint"><code class="xref py py-class docutils literal"><span class="pre">ForeignKeyConstraint</span></code></a>&#x5E94;&#x8BE5;&#x660E;&#x786E;&#x5730;&#x4ECE;&#x8FD9;&#x79CD;&#x6392;&#x5E8F;&#x4E2D;&#x5220;&#x9664;&#x7684;&#x5BF9;&#x8C61;&#x3002;</span></p><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-252">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-253"><a class="reference internal" href="core_constraints.html#use-alter"><span>Creating/Dropping Foreign Key Constraints via ALTER</span></a>  - &#x65B0;&#x884C;&#x4E3A;&#x7684;&#x5B8C;&#x6574;&#x63CF;&#x8FF0;&#x3002;</span></p></div><p><span class="yiyi-st" id="yiyi-254"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3282">&#xFF03;3282  T0&gt;</a></span></p></div><div class="section" id="resultproxy-auto-close-is-now-a-soft-close"><h3><span class="yiyi-st" id="yiyi-255">ResultProxy&#x201C;&#x81EA;&#x52A8;&#x5173;&#x95ED;&#x201D;&#x73B0;&#x5728;&#x662F;&#x4E00;&#x4E2A;&#x201C;&#x8F6F;&#x201D;&#x5173;&#x95ED;<a class="headerlink" href="#resultproxy-auto-close-is-now-a-soft-close" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-256">&#x5BF9;&#x4E8E;&#x8BB8;&#x591A;&#x53D1;&#x884C;&#x7248;&#x672C;&#xFF0C;<a class="reference internal" href="core_connections.html#sqlalchemy.engine.ResultProxy" title="sqlalchemy.engine.ResultProxy"><code class="xref py py-class docutils literal"><span class="pre">ResultProxy</span></code></a>&#x5BF9;&#x8C61;&#x603B;&#x662F;&#x5728;&#x6240;&#x6709;&#x7ED3;&#x679C;&#x884C;&#x88AB;&#x63D0;&#x53D6;&#x7684;&#x5730;&#x65B9;&#x81EA;&#x52A8;&#x5173;&#x95ED;&#x3002;</span><span class="yiyi-st" id="yiyi-257">&#x8FD9;&#x662F;&#x4E3A;&#x4E86;&#x5141;&#x8BB8;&#x4F7F;&#x7528;&#x8BE5;&#x5BF9;&#x8C61;&#x800C;&#x4E0D;&#x9700;&#x8981;&#x660E;&#x786E;&#x5730;&#x8C03;&#x7528;<a class="reference internal" href="core_connections.html#sqlalchemy.engine.ResultProxy.close" title="sqlalchemy.engine.ResultProxy.close"><code class="xref py py-meth docutils literal"><span class="pre">ResultProxy.close()</span></code></a>&#xFF1B;&#x7531;&#x4E8E;&#x6240;&#x6709;DBAPI&#x8D44;&#x6E90;&#x90FD;&#x5DF2;&#x88AB;&#x91CA;&#x653E;&#xFF0C;&#x56E0;&#x6B64;&#x8BE5;&#x5BF9;&#x8C61;&#x53EF;&#x4EE5;&#x653E;&#x5F03;&#x3002;</span><span class="yiyi-st" id="yiyi-258">&#x4F46;&#x662F;&#xFF0C;&#x8BE5;&#x5BF9;&#x8C61;&#x4FDD;&#x6301;&#x4E25;&#x683C;&#x7684;&#x201C;&#x5173;&#x95ED;&#x201D;&#x884C;&#x4E3A;&#xFF0C;&#x8FD9;&#x610F;&#x5473;&#x7740;&#x540E;&#x7EED;&#x5BF9;<a class="reference internal" href="core_connections.html#sqlalchemy.engine.ResultProxy.fetchone" title="sqlalchemy.engine.ResultProxy.fetchone"><code class="xref py py-meth docutils literal"><span class="pre">ResultProxy.fetchone()</span></code></a>&#xFF0C;<a class="reference internal" href="core_connections.html#sqlalchemy.engine.ResultProxy.fetchmany" title="sqlalchemy.engine.ResultProxy.fetchmany"><code class="xref py py-meth docutils literal"><span class="pre">ResultProxy.fetchmany()</span></code></a>&#x6216;<a class="reference internal" href="core_connections.html#sqlalchemy.engine.ResultProxy.fetchall" title="sqlalchemy.engine.ResultProxy.fetchall"><code class="xref py py-meth docutils literal"><span class="pre">ResultProxy.fetchall()</span></code></a>&#x73B0;&#x5728;&#x4F1A;&#x5F15;&#x53D1;&#x4E00;&#x4E2A;<a class="reference internal" href="core_exceptions.html#sqlalchemy.exc.ResourceClosedError" title="sqlalchemy.exc.ResourceClosedError"><code class="xref py py-class docutils literal"><span class="pre">ResourceClosedError</span></code></a>&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<span class="go">(1, &apos;x&apos;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<span class="go">None  # indicates no more rows</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<span class="go">exception: ResourceClosedError</span></pre></div></div><p><span class="yiyi-st" id="yiyi-259">&#x8FD9;&#x79CD;&#x884C;&#x4E3A;&#x4E0E;pep-249&#x7684;&#x72B6;&#x6001;&#x4E0D;&#x4E00;&#x81F4;&#xFF0C;&#x5373;&#x5728;&#x7ED3;&#x679C;&#x8017;&#x5C3D;&#x540E;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x91CD;&#x590D;&#x8C03;&#x7528;fetch&#x65B9;&#x6CD5;&#x3002;</span><span class="yiyi-st" id="yiyi-260">&#x5B83;&#x8FD8;&#x4F1A;&#x5E72;&#x6270;&#x7ED3;&#x679C;&#x4EE3;&#x7406;&#x7684;&#x67D0;&#x4E9B;&#x5B9E;&#x73B0;&#x7684;&#x884C;&#x4E3A;&#xFF0C;&#x4F8B;&#x5982;cx_oracle&#x65B9;&#x8A00;&#x5BF9;&#x67D0;&#x4E9B;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x4F7F;&#x7528;&#x7684;<code class="xref py py-class docutils literal"><span class="pre">BufferedColumnResultProxy</span></code>&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-261">To solve this, the &#x201C;closed&#x201D; state of the <a class="reference internal" href="core_connections.html#sqlalchemy.engine.ResultProxy" title="sqlalchemy.engine.ResultProxy"><code class="xref py py-class docutils literal"><span class="pre">ResultProxy</span></code></a> has been broken into two states; a &#x201C;soft close&#x201D; which does the majority of what &#x201C;close&#x201D; does, in that it releases the DBAPI cursor and in the case of a &#x201C;close with result&#x201D; object will also release the connection, and a &#x201C;closed&#x201D; state which is everything included by &#x201C;soft close&#x201D; as well as establishing the fetch methods as &#x201C;closed&#x201D;. </span><span class="yiyi-st" id="yiyi-262"><a class="reference internal" href="core_connections.html#sqlalchemy.engine.ResultProxy.close" title="sqlalchemy.engine.ResultProxy.close"><code class="xref py py-meth docutils literal"><span class="pre">ResultProxy.close()</span></code></a>&#x65B9;&#x6CD5;&#x73B0;&#x5728;&#x4ECE;&#x4E0D;&#x9690;&#x5F0F;&#x8C03;&#x7528;&#xFF0C;&#x53EA;&#x6709;<a class="reference internal" href="core_connections.html#sqlalchemy.engine.ResultProxy._soft_close" title="sqlalchemy.engine.ResultProxy._soft_close"><code class="xref py py-meth docutils literal"><span class="pre">ResultProxy._soft_close()</span></code></a>&#x65B9;&#x6CD5;&#x975E;&#x516C;&#x5F00;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<span class="go">(1, &apos;x&apos;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<span class="go">None  # indicates no more rows</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<span class="go">None  # still None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<span class="go">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<span class="go">exception: ResourceClosedError  # *now* it raises</span></pre></div></div><p><span class="yiyi-st" id="yiyi-263"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3330">&#xFF03;3330</a> <a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3329">&#xFF03;3329</a></span></p></div><div class="section" id="check-constraints-now-support-the-column-0-name-s-token-in-naming-conventions"><h3><span class="yiyi-st" id="yiyi-264">CHECK Constraints&#x73B0;&#x5728;&#x652F;&#x6301;&#x547D;&#x540D;&#x7EA6;&#x5B9A;&#x4E2D;&#x7684;<code class="docutils literal"><span class="pre">%(column_0_name)s</span></code>&#x6807;&#x8BB0;<a class="headerlink" href="#check-constraints-now-support-the-column-0-name-s-token-in-naming-conventions" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-265"><code class="docutils literal"><span class="pre">%(column_0_name)s</span></code>&#x5C06;&#x4ECE;&#x5728;<a class="reference internal" href="core_constraints.html#sqlalchemy.schema.CheckConstraint" title="sqlalchemy.schema.CheckConstraint"><code class="xref py py-class docutils literal"><span class="pre">CheckConstraint</span></code></a>&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#x4E2D;&#x627E;&#x5230;&#x7684;&#x7B2C;&#x4E00;&#x5217;&#x6D3E;&#x751F;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">metadata</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">(</span>
    <span class="n">naming_convention</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;ck&quot;</span><span class="p">:</span> <span class="s2">&quot;ck_</span><span class="si">%(table_name)s</span><span class="s2">_</span><span class="si">%(column_0_name)s</span><span class="s2">&quot;</span><span class="p">}</span>
<span class="p">)</span>

<span class="n">foo</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&apos;foo&apos;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;value&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">CheckConstraint</span><span class="p">(</span><span class="n">foo</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">value</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-266">&#x5C06;&#x5448;&#x73B0;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>CREATE TABLE foo (
    value INTEGER,
    CONSTRAINT ck_foo_value CHECK (value &gt; 5)
)</pre></div></div><p><span class="yiyi-st" id="yiyi-267">&#x547D;&#x540D;&#x7EA6;&#x5B9A;&#x4E0E;&#x7531;<a class="reference internal" href="core_type_basics.html#sqlalchemy.types.SchemaType" title="sqlalchemy.types.SchemaType"><code class="xref py py-class docutils literal"><span class="pre">SchemaType</span></code></a>&#xFF08;&#x5982;<a class="reference internal" href="core_type_basics.html#sqlalchemy.types.Boolean" title="sqlalchemy.types.Boolean"><code class="xref py py-class docutils literal"><span class="pre">Boolean</span></code></a>&#x6216;<a class="reference internal" href="core_type_basics.html#sqlalchemy.types.Enum" title="sqlalchemy.types.Enum"><code class="xref py py-class docutils literal"><span class="pre">Enum</span></code></a>&#xFF09;&#x751F;&#x6210;&#x7684;&#x7EA6;&#x675F;&#x7684;&#x7EC4;&#x5408;&#x73B0;&#x5728;&#x4E5F;&#x5C06;&#x4F7F;&#x7528;&#x6240;&#x6709;CHECK&#x7EA6;&#x675F;&#x7EA6;&#x5B9A;&#x3002;</span></p><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-268">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p><span class="yiyi-st" id="yiyi-269"><a class="reference internal" href="core_constraints.html#naming-check-constraints"><span>Naming CHECK Constraints</span></a></span></p><p class="last"><span class="yiyi-st" id="yiyi-270"><a class="reference internal" href="core_constraints.html#naming-schematypes"><span>Configuring Naming for Boolean, Enum, and other schema types</span></a>&#x914D;&#x7F6E;&#x547D;&#x540D;</span></p></div><p><span class="yiyi-st" id="yiyi-271"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3299">&#xFF03;3299  T0&gt;</a></span></p></div><div class="section" id="constraints-referring-to-unattached-columns-can-auto-attach-to-the-table-when-their-referred-columns-are-attached"><h3><span class="yiyi-st" id="yiyi-272">&#x5F15;&#x7528;&#x672A;&#x9644;&#x52A0;&#x5217;&#x7684;&#x7EA6;&#x675F;&#x53EF;&#x4EE5;&#x5728;&#x8FDE;&#x63A5;&#x5176;&#x5F15;&#x7528;&#x5217;&#x65F6;&#x81EA;&#x52A8;&#x9644;&#x52A0;&#x5230;&#x8868;&#x4E0A;<a class="headerlink" href="#constraints-referring-to-unattached-columns-can-auto-attach-to-the-table-when-their-referred-columns-are-attached" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-273">&#x7531;&#x4E8E;&#x81F3;&#x5C11;&#x6709;0.8&#x7248;&#x672C;&#xFF0C;&#x4E00;&#x4E2A;<a class="reference internal" href="core_constraints.html#sqlalchemy.schema.Constraint" title="sqlalchemy.schema.Constraint"><code class="xref py py-class docutils literal"><span class="pre">Constraint</span></code></a>&#x6709;&#x80FD;&#x529B;&#x6839;&#x636E;&#x4F20;&#x9012;&#x7684;&#x8868;&#x683C;&#x9644;&#x52A0;&#x5217;&#x81EA;&#x52A8;&#x9644;&#x52A0;&#x5230;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal"><span class="pre">Table</span></code></a>&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Table</span><span class="p">,</span> <span class="n">Column</span><span class="p">,</span> <span class="n">MetaData</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">UniqueConstraint</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">()</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&apos;t&apos;</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;a&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;b&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">uq</span> <span class="o">=</span> <span class="n">UniqueConstraint</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>  <span class="c1"># will auto-attach to Table</span>

<span class="k">assert</span> <span class="n">uq</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">constraints</span></pre></div></div><p><span class="yiyi-st" id="yiyi-274">&#x4E3A;&#x4E86;&#x534F;&#x52A9;&#x67D0;&#x4E9B;&#x503E;&#x5411;&#x4E8E;&#x4F7F;&#x7528;&#x58F0;&#x660E;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x5373;&#x4F7F;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a>&#x5BF9;&#x8C61;&#x5C1A;&#x672A;&#x4E0E;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal"><span class="pre">Table</span></code></a>&#x5173;&#x8054;&#xFF0C;&#x6B64;&#x76F8;&#x540C;&#x7684;&#x81EA;&#x52A8;&#x9644;&#x4EF6;&#x903B;&#x8F91;&#x73B0;&#x5728;&#x4E5F;&#x53EF;&#x4EE5;&#x8FD0;&#x884C;&#xFF1B;&#x989D;&#x5916;&#x7684;&#x4E8B;&#x4EF6;&#x88AB;&#x5EFA;&#x7ACB;&#xFF0C;&#x5F53;&#x90A3;&#x4E9B;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a>&#x5BF9;&#x8C61;&#x5173;&#x8054;&#x65F6;&#xFF0C;<a class="reference internal" href="core_constraints.html#sqlalchemy.schema.Constraint" title="sqlalchemy.schema.Constraint"><code class="xref py py-class docutils literal"><span class="pre">Constraint</span></code></a>&#x4E5F;&#x88AB;&#x6DFB;&#x52A0;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Table</span><span class="p">,</span> <span class="n">Column</span><span class="p">,</span> <span class="n">MetaData</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">UniqueConstraint</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">()</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;a&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;b&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">)</span>

<span class="n">uq</span> <span class="o">=</span> <span class="n">UniqueConstraint</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&apos;t&apos;</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">uq</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">constraints</span>  <span class="c1"># constraint auto-attached</span></pre></div></div><p><span class="yiyi-st" id="yiyi-275">&#x4E0A;&#x8FF0;&#x529F;&#x80FD;&#x662F;&#x7248;&#x672C;1.0.0b3&#x540E;&#x671F;&#x6DFB;&#x52A0;&#x7684;&#x3002;</span><span class="yiyi-st" id="yiyi-276">&#x5BF9;&#x4E8E;<a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3411">&#xFF03;3411</a>&#xFF0C;&#x7248;&#x672C;1.0.4&#x7684;&#x4FEE;&#x8BA2;&#x786E;&#x4FDD;&#x4E86;&#x5982;&#x679C;<a class="reference internal" href="core_constraints.html#sqlalchemy.schema.Constraint" title="sqlalchemy.schema.Constraint"><code class="xref py py-class docutils literal"><span class="pre">Constraint</span></code></a>&#x5F15;&#x7528;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a>&#x5BF9;&#x8C61;&#x7684;&#x6DF7;&#x5408;&#x5E76;&#x4E14;&#x5B57;&#x7B26;&#x4E32;&#x5217;&#x540D;&#x79F0;&#xFF1B;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x8FD8;&#x6CA1;&#x6709;&#x8DDF;&#x8E2A;&#x540D;&#x79F0;&#x6DFB;&#x52A0;&#x5230;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal"><span class="pre">Table</span></code></a>&#x7684;&#x60C5;&#x51B5;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Table</span><span class="p">,</span> <span class="n">Column</span><span class="p">,</span> <span class="n">MetaData</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">UniqueConstraint</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">()</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;a&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;b&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">)</span>

<span class="n">uq</span> <span class="o">=</span> <span class="n">UniqueConstraint</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">&apos;b&apos;</span><span class="p">)</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&apos;t&apos;</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

<span class="c1"># constraint *not* auto-attached, as we do not have tracking</span>
<span class="c1"># to locate when a name &apos;b&apos; becomes available on the table</span>
<span class="k">assert</span> <span class="n">uq</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">constraints</span></pre></div></div><p><span class="yiyi-st" id="yiyi-277">&#x4EE5;&#x4E0A;&#xFF0C;&#x5217;&#x201C;a&#x201D;&#x5230;&#x8868;&#x201C;t&#x201D;&#x7684;&#x9644;&#x4EF6;&#x4E8B;&#x4EF6;&#x5C06;&#x5728;&#x9644;&#x52A0;&#x5217;&#x201C;b&#x201D;&#x4E4B;&#x524D;&#x89E6;&#x53D1;&#xFF08;&#x56E0;&#x4E3A;&#x201C;a&#x201D;&#x5728;&#x201C;b&#x201D;&#x4E4B;&#x524D;&#x7684;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal"><span class="pre">Table</span></code></a>&#x6784;&#x9020;&#x51FD;&#x6570;&#x4E2D;&#x58F0;&#x660E;&#xFF09;&#xFF0C;&#x5E76;&#x4E14;&#x5982;&#x679C;&#x8981;&#x5C1D;&#x8BD5;&#x9644;&#x4EF6;&#xFF0C;&#x7EA6;&#x675F;&#x5C06;&#x65E0;&#x6CD5;&#x627E;&#x5230;&#x201C;b&#x201D;&#x3002;</span><span class="yiyi-st" id="yiyi-278">&#x4E3A;&#x4E86;&#x4E00;&#x81F4;&#x6027;&#xFF0C;&#x5982;&#x679C;&#x7EA6;&#x675F;&#x5F15;&#x7528;&#x4EFB;&#x4F55;&#x5B57;&#x7B26;&#x4E32;&#x540D;&#x79F0;&#xFF0C;&#x5219;&#x4F1A;&#x8DF3;&#x8FC7;&#x81EA;&#x52A8;&#x9644;&#x52A0;&#x5217;&#x8FDE;&#x63A5;&#x903B;&#x8F91;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-279">&#x5F53;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal"><span class="pre">Table</span></code></a>&#x5DF2;&#x7ECF;&#x5305;&#x542B;&#x6784;&#x9020;<a class="reference internal" href="core_constraints.html#sqlalchemy.schema.Constraint" title="sqlalchemy.schema.Constraint"><code class="xref py py-class docutils literal"><span class="pre">Constraint</span></code></a>&#x65F6;&#x7684;&#x6240;&#x6709;&#x76EE;&#x6807;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a>&#x5BF9;&#x8C61;&#x65F6;&#xFF0C;&#x539F;&#x59CB;&#x81EA;&#x52A8;&#x9644;&#x52A0;&#x903B;&#x8F91;&#x5F53;&#x7136;&#x4F1A;&#x4FDD;&#x6301;&#x539F;&#x4F4D;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Table</span><span class="p">,</span> <span class="n">Column</span><span class="p">,</span> <span class="n">MetaData</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">UniqueConstraint</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">()</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;a&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;b&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">)</span>


<span class="n">t</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&apos;t&apos;</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

<span class="n">uq</span> <span class="o">=</span> <span class="n">UniqueConstraint</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">&apos;b&apos;</span><span class="p">)</span>

<span class="c1"># constraint auto-attached normally as in older versions</span>
<span class="k">assert</span> <span class="n">uq</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">constraints</span></pre></div></div><p><span class="yiyi-st" id="yiyi-280"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3341">&#xFF03;3341</a> <a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3411">&#xFF03;3411</a></span></p></div><div class="section" id="insert-from-select-now-includes-python-and-sql-expression-defaults"><h3><span class="yiyi-st" id="yiyi-281">INSERT FROM SELECT&#x73B0;&#x5728;&#x5305;&#x542B;Python&#x548C;SQL&#x8868;&#x8FBE;&#x5F0F;&#x9ED8;&#x8BA4;&#x503C;<a class="headerlink" href="#insert-from-select-now-includes-python-and-sql-expression-defaults" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-282"><a class="reference internal" href="core_dml.html#sqlalchemy.sql.expression.Insert.from_select" title="sqlalchemy.sql.expression.Insert.from_select"><code class="xref py py-meth docutils literal"><span class="pre">Insert.from_select()</span></code></a> now includes Python and SQL-expression defaults if otherwise unspecified; the limitation where non-server column defaults aren&#x2019;t included in an INSERT FROM SELECT is now lifted and these expressions are rendered as constants into the SELECT statement:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Table</span><span class="p">,</span> <span class="n">Column</span><span class="p">,</span> <span class="n">MetaData</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">select</span><span class="p">,</span> <span class="n">func</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">()</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s1">&apos;t&apos;</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;x&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;y&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">func</span><span class="o">.</span><span class="n">somefunction</span><span class="p">()))</span>

<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">t</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">insert</span><span class="p">()</span><span class="o">.</span><span class="n">from_select</span><span class="p">([</span><span class="s1">&apos;x&apos;</span><span class="p">],</span> <span class="n">stmt</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-283">&#x5C06;&#x5448;&#x73B0;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>INSERT INTO t (x, y) SELECT t.x, somefunction() AS somefunction_1
FROM t</pre></div></div><p><span class="yiyi-st" id="yiyi-284">&#x8BE5;&#x529F;&#x80FD;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<a class="reference internal" href="core_dml.html#sqlalchemy.sql.expression.Insert.from_select.params.include_defaults" title="sqlalchemy.sql.expression.Insert.from_select"><code class="xref py py-paramref docutils literal"><span class="pre">Insert.from_select.include_defaults</span></code></a>&#x7981;&#x7528;&#x3002;</span></p></div><div class="section" id="column-server-defaults-now-render-literal-values"><h3><span class="yiyi-st" id="yiyi-285">&#x5217;&#x670D;&#x52A1;&#x5668;&#x9ED8;&#x8BA4;&#x503C;&#x73B0;&#x5728;&#x5448;&#x73B0;&#x6587;&#x5B57;&#x503C;<a class="headerlink" href="#column-server-defaults-now-render-literal-values" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-286">&#x5F53;&#x7531;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column.params.server_default" title="sqlalchemy.schema.Column"><code class="xref py py-paramref docutils literal"><span class="pre">Column.server_default</span></code></a>&#x8BBE;&#x7F6E;&#x7684;<a class="reference internal" href="core_defaults.html#sqlalchemy.schema.DefaultClause" title="sqlalchemy.schema.DefaultClause"><code class="xref py py-class docutils literal"><span class="pre">DefaultClause</span></code></a>&#x4F5C;&#x4E3A;&#x8981;&#x7F16;&#x8BD1;&#x7684;SQL&#x8868;&#x8FBE;&#x5F0F;&#x5B58;&#x5728;&#x65F6;&#xFF0C;&#x201C;literal bindings&#x201D;&#x7F16;&#x8BD1;&#x5668;&#x6807;&#x5FD7;&#x5C06;&#x6253;&#x5F00;&#x3002;</span><span class="yiyi-st" id="yiyi-287">&#x8FD9;&#x5141;&#x8BB8;&#x5D4C;&#x5165;&#x5728;SQL&#x4E2D;&#x7684;&#x6587;&#x5B57;&#x6B63;&#x786E;&#x5448;&#x73B0;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Table</span><span class="p">,</span> <span class="n">Column</span><span class="p">,</span> <span class="n">MetaData</span><span class="p">,</span> <span class="n">Text</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.schema</span> <span class="kn">import</span> <span class="n">CreateTable</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.dialects.postgresql</span> <span class="kn">import</span> <span class="n">ARRAY</span><span class="p">,</span> <span class="n">array</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.dialects</span> <span class="kn">import</span> <span class="n">postgresql</span>

<span class="n">metadata</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">()</span>

<span class="n">tbl</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s2">&quot;derp&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;arr&quot;</span><span class="p">,</span> <span class="n">ARRAY</span><span class="p">(</span><span class="n">Text</span><span class="p">),</span>
                <span class="n">server_default</span><span class="o">=</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span> <span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="s2">&quot;baz&quot;</span><span class="p">])),</span>
<span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">CreateTable</span><span class="p">(</span><span class="n">tbl</span><span class="p">)</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">dialect</span><span class="o">=</span><span class="n">postgresql</span><span class="o">.</span><span class="n">dialect</span><span class="p">()))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-288">&#x73B0;&#x5728;&#x5448;&#x73B0;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>CREATE TABLE derp (
    arr TEXT[] DEFAULT ARRAY[&apos;foo&apos;, &apos;bar&apos;, &apos;baz&apos;]
)</pre></div></div><p><span class="yiyi-st" id="yiyi-289">&#x5728;&#x6B64;&#x4E4B;&#x524D;&#xFF0C;&#x6587;&#x5B57;&#x503C;<code class="docutils literal"><span class="pre">&#x201C;foo&#x201D;&#xFF0C;</span> <span class="pre">&#x201C;bar&#x201D;&#xFF0C;</span> <span class="pre">&#x201C;baz&#x201D;</span></code>&#x8FD9;&#x5728;DDL&#x4E2D;&#x662F;&#x65E0;&#x7528;&#x7684;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-290"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3087">&#xFF03;3087  T0&gt;</a></span></p></div><div class="section" id="uniqueconstraint-is-now-part-of-the-table-reflection-process"><h3><span class="yiyi-st" id="yiyi-291">UniqueConstraint&#x73B0;&#x5728;&#x662F;&#x8868;&#x53CD;&#x5C04;&#x8FC7;&#x7A0B;&#x7684;&#x4E00;&#x90E8;&#x5206;<a class="headerlink" href="#uniqueconstraint-is-now-part-of-the-table-reflection-process" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-292">&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">autoload=True</span></code>&#x586B;&#x5145;&#x7684;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal"><span class="pre">Table</span></code></a>&#x5BF9;&#x8C61;&#x73B0;&#x5728;&#x5C06;&#x5305;&#x542B;<a class="reference internal" href="core_constraints.html#sqlalchemy.schema.UniqueConstraint" title="sqlalchemy.schema.UniqueConstraint"><code class="xref py py-class docutils literal"><span class="pre">UniqueConstraint</span></code></a>&#x7ED3;&#x6784;&#x4EE5;&#x53CA;<a class="reference internal" href="core_constraints.html#sqlalchemy.schema.Index" title="sqlalchemy.schema.Index"><code class="xref py py-class docutils literal"><span class="pre">Index</span></code></a>&#x7ED3;&#x6784;&#x3002;</span><span class="yiyi-st" id="yiyi-293">&#x8FD9;&#x4E2A;&#x903B;&#x8F91;&#x5BF9;&#x4E8E;Postgresql&#x548C;Mysql&#x6709;&#x4E00;&#x4E9B;&#x6CE8;&#x610F;&#x4E8B;&#x9879;&#xFF1A;</span></p><div class="section" id="postgresql"><h4><span class="yiyi-st" id="yiyi-294">&#x7684;PostgreSQL <a class="headerlink" href="#postgresql" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h4><p><span class="yiyi-st" id="yiyi-295">Postgresql&#x5177;&#x6709;&#x8FD9;&#x6837;&#x7684;&#x884C;&#x4E3A;&#xFF0C;&#x5F53;&#x521B;&#x5EFA;UNIQUE&#x7EA6;&#x675F;&#x65F6;&#xFF0C;&#x5B83;&#x9690;&#x5F0F;&#x5730;&#x521B;&#x5EFA;&#x4E0E;&#x8BE5;&#x7EA6;&#x675F;&#x76F8;&#x5BF9;&#x5E94;&#x7684;UNIQUE INDEX&#x3002;</span><span class="yiyi-st" id="yiyi-296"><a class="reference internal" href="core_reflection.html#sqlalchemy.engine.reflection.Inspector.get_indexes" title="sqlalchemy.engine.reflection.Inspector.get_indexes"><code class="xref py py-meth docutils literal"><span class="pre">Inspector.get_indexes()</span></code></a>&#x548C;<a class="reference internal" href="core_reflection.html#sqlalchemy.engine.reflection.Inspector.get_unique_constraints" title="sqlalchemy.engine.reflection.Inspector.get_unique_constraints"><code class="xref py py-meth docutils literal"><span class="pre">Inspector.get_unique_constraints()</span></code></a>&#x65B9;&#x6CD5;&#x5C06;&#x7EE7;&#x7EED;<strong>&#x8FD9;&#x4E24;&#x4E2A;</strong>&#x6E05;&#x695A;&#x5730;&#x8FD4;&#x56DE;&#x8FD9;&#x4E9B;&#x6761;&#x76EE;&#xFF0C;&#x5176;&#x4E2D;<a class="reference internal" href="core_reflection.html#sqlalchemy.engine.reflection.Inspector.get_indexes" title="sqlalchemy.engine.reflection.Inspector.get_indexes"><code class="xref py py-meth docutils literal"><span class="pre">Inspector.get_indexes()</span></code></a>&#x5728;&#x7D22;&#x5F15;&#x6761;&#x76EE;&#x4E2D;&#x5305;&#x542B;&#x4E00;&#x4E2A;&#x6807;&#x8BB0;<code class="docutils literal"><span class="pre">duplicates_constraint</span></code>&#xFF0C;&#x7528;&#x4E8E;&#x6307;&#x793A;&#x68C0;&#x6D4B;&#x5230;&#x7684;&#x76F8;&#x5E94;&#x7EA6;&#x675F;&#x3002;</span><span class="yiyi-st" id="yiyi-297">However, when performing full table reflection using <code class="docutils literal"><span class="pre">Table(...,</span> <span class="pre">autoload=True)</span></code>, the <a class="reference internal" href="core_constraints.html#sqlalchemy.schema.Index" title="sqlalchemy.schema.Index"><code class="xref py py-class docutils literal"><span class="pre">Index</span></code></a> construct is detected as being linked to the <a class="reference internal" href="core_constraints.html#sqlalchemy.schema.UniqueConstraint" title="sqlalchemy.schema.UniqueConstraint"><code class="xref py py-class docutils literal"><span class="pre">UniqueConstraint</span></code></a>, and is <strong>not</strong> present within the <code class="xref py py-attr docutils literal"><span class="pre">Table.indexes</span></code> collection; only the <a class="reference internal" href="core_constraints.html#sqlalchemy.schema.UniqueConstraint" title="sqlalchemy.schema.UniqueConstraint"><code class="xref py py-class docutils literal"><span class="pre">UniqueConstraint</span></code></a> will be present in the <code class="xref py py-attr docutils literal"><span class="pre">Table.constraints</span></code> collection. </span><span class="yiyi-st" id="yiyi-298">&#x91CD;&#x590D;&#x6570;&#x636E;&#x5220;&#x9664;&#x903B;&#x8F91;&#x901A;&#x8FC7;&#x5728;&#x67E5;&#x8BE2;<code class="docutils literal"><span class="pre">pg_index</span></code>&#x65F6;&#x52A0;&#x5165;&#x5230;<code class="docutils literal"><span class="pre">pg_constraint</span></code>&#x8868;&#x6765;&#x67E5;&#x770B;&#x4E24;&#x4E2A;&#x7ED3;&#x6784;&#x662F;&#x5426;&#x5DF2;&#x94FE;&#x63A5;&#x3002;</span></p></div><div class="section" id="mysql"><h4><span class="yiyi-st" id="yiyi-299">MySQL&#x7684;<a class="headerlink" href="#mysql" title="Permalink to this headline">&#xB6; T0&gt;</a></span></h4><p><span class="yiyi-st" id="yiyi-300">MySQL&#x5BF9;&#x4E8E;UNIQUE INDEX&#x548C;UNIQUE&#x7EA6;&#x675F;&#x6CA1;&#x6709;&#x5355;&#x72EC;&#x7684;&#x6982;&#x5FF5;&#x3002;</span><span class="yiyi-st" id="yiyi-301">&#x867D;&#x7136;&#x5B83;&#x5728;&#x521B;&#x5EFA;&#x8868;&#x548C;&#x7D22;&#x5F15;&#x65F6;&#x652F;&#x6301;&#x4E24;&#x79CD;&#x8BED;&#x6CD5;&#xFF0C;&#x4F46;&#x5B83;&#x4EEC;&#x4E0D;&#x4F1A;&#x4EE5;&#x4EFB;&#x4F55;&#x4E0D;&#x540C;&#x7684;&#x65B9;&#x5F0F;&#x5B58;&#x50A8;&#x5B83;&#x4EEC;&#x3002;</span><span class="yiyi-st" id="yiyi-302">The <a class="reference internal" href="core_reflection.html#sqlalchemy.engine.reflection.Inspector.get_indexes" title="sqlalchemy.engine.reflection.Inspector.get_indexes"><code class="xref py py-meth docutils literal"><span class="pre">Inspector.get_indexes()</span></code></a> and the <a class="reference internal" href="core_reflection.html#sqlalchemy.engine.reflection.Inspector.get_unique_constraints" title="sqlalchemy.engine.reflection.Inspector.get_unique_constraints"><code class="xref py py-meth docutils literal"><span class="pre">Inspector.get_unique_constraints()</span></code></a> methods will continue to <strong>both</strong> return an entry for a UNIQUE index in MySQL, where <a class="reference internal" href="core_reflection.html#sqlalchemy.engine.reflection.Inspector.get_unique_constraints" title="sqlalchemy.engine.reflection.Inspector.get_unique_constraints"><code class="xref py py-meth docutils literal"><span class="pre">Inspector.get_unique_constraints()</span></code></a> features a new token <code class="docutils literal"><span class="pre">duplicates_index</span></code> within the constraint entry indicating that this is a dupe entry corresponding to that index. </span><span class="yiyi-st" id="yiyi-303">However, when performing full table reflection using <code class="docutils literal"><span class="pre">Table(...,</span> <span class="pre">autoload=True)</span></code>, the <a class="reference internal" href="core_constraints.html#sqlalchemy.schema.UniqueConstraint" title="sqlalchemy.schema.UniqueConstraint"><code class="xref py py-class docutils literal"><span class="pre">UniqueConstraint</span></code></a> construct is <strong>not</strong> part of the fully reflected <a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal"><span class="pre">Table</span></code></a> construct under any circumstances; this construct is always represented by a <a class="reference internal" href="core_constraints.html#sqlalchemy.schema.Index" title="sqlalchemy.schema.Index"><code class="xref py py-class docutils literal"><span class="pre">Index</span></code></a> with the <code class="docutils literal"><span class="pre">unique=True</span></code> setting present in the <code class="xref py py-attr docutils literal"><span class="pre">Table.indexes</span></code> collection.</span></p><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-304">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p><span class="yiyi-st" id="yiyi-305"><a class="reference internal" href="dialects_postgresql.html#postgresql-index-reflection"><span>Postgresql Index Reflection</span></a></span></p><p class="last"><span class="yiyi-st" id="yiyi-306"><a class="reference internal" href="dialects_mysql.html#mysql-unique-constraints"><span>MySQL Unique Constraints and Reflection</span></a></span></p></div><p><span class="yiyi-st" id="yiyi-307"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3184">&#xFF03;3184  T0&gt;</a></span></p></div></div><div class="section" id="new-systems-to-safely-emit-parameterized-warnings"><h3><span class="yiyi-st" id="yiyi-308">&#x65B0;&#x7CFB;&#x7EDF;&#x5B89;&#x5168;&#x5730;&#x53D1;&#x51FA;&#x53C2;&#x6570;&#x5316;&#x8B66;&#x544A;<a class="headerlink" href="#new-systems-to-safely-emit-parameterized-warnings" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-309">&#x5F88;&#x957F;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#xFF0C;&#x8B66;&#x544A;&#x6D88;&#x606F;&#x4E0D;&#x80FD;&#x5F15;&#x7528;&#x6570;&#x636E;&#x5143;&#x7D20;&#xFF0C;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x7279;&#x5B9A;&#x7684;&#x51FD;&#x6570;&#x53EF;&#x80FD;&#x4F1A;&#x53D1;&#x51FA;&#x65E0;&#x6570;&#x4E2A;&#x72EC;&#x7279;&#x7684;&#x8B66;&#x544A;&#x3002;</span><span class="yiyi-st" id="yiyi-310">&#x53D1;&#x751F;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x7684;&#x5173;&#x952E;&#x5728;&#x4E8E;<code class="docutils literal"><span class="pre">Unicode</span> <span class="pre">&#x7C7B;&#x578B;</span> <span class="pre">&#x6536;&#x5230; tt&gt; <span class="pre">&#x975E;unicode</span> <span class="pre">/ t5&gt; <span class="pre">&#x53C2;&#x6570;</span> <span class="pre">&#x503C;</span></span></span></code>&#x8B66;&#x544A;&#x3002;</span><span class="yiyi-st" id="yiyi-311">&#x5728;&#x8FD9;&#x4E2A;&#x6D88;&#x606F;&#x4E2D;&#x653E;&#x7F6E;&#x6570;&#x636E;&#x503C;&#x5C06;&#x610F;&#x5473;&#x7740;&#x8BE5;&#x6A21;&#x5757;&#x7684;Python <code class="docutils literal"><span class="pre">__warningregistry__</span></code>&#xFF0C;&#x6216;&#x8005;&#x5728;&#x67D0;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;Python&#x5168;&#x5C40;<code class="docutils literal"><span class="pre">warnings.onceregistry</span></code>&#x5C06;&#x53D8;&#x5F97;&#x65E0;&#x754C;&#x9650;&#xFF0C;&#x5982;&#x540C;&#x5927;&#x591A;&#x6570;&#x8B66;&#x544A;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8FD9;&#x4E24;&#x4E2A;&#x96C6;&#x5408;&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x4F1A;&#x586B;&#x5145;&#x6BCF;&#x6761;&#x4E0D;&#x540C;&#x7684;&#x8B66;&#x544A;&#x6D88;&#x606F;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-312">The change here is that by using a special <code class="docutils literal"><span class="pre">string</span></code> type that purposely changes how the string is hashed, we can control that a large number of parameterized messages are hashed only on a small set of possible hash values, such that a warning such as <code class="docutils literal"><span class="pre">Unicode</span> <span class="pre">type</span> <span class="pre">received</span> <span class="pre">non-unicode</span> <span class="pre">bind</span> <span class="pre">param</span> <span class="pre">value</span></code> can be tailored to be emitted only a specific number of times; beyond that, the Python warnings registry will begin recording them as duplicates.</span></p><p><span class="yiyi-st" id="yiyi-313">&#x4E3A;&#x4E86;&#x8BF4;&#x660E;&#xFF0C;&#x4EE5;&#x4E0B;&#x6D4B;&#x8BD5;&#x811A;&#x672C;&#x5C06;&#x53EA;&#x663E;&#x793A;10&#x4E2A;&#x53C2;&#x6570;&#x96C6;&#x4E2D;&#x7684;10&#x4E2A;&#x8B66;&#x544A;&#xFF0C;&#x603B;&#x6570;&#x4E3A;1000&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span><span class="p">,</span> <span class="n">Unicode</span><span class="p">,</span> <span class="n">select</span><span class="p">,</span> <span class="n">cast</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;sqlite://&quot;</span><span class="p">)</span>

<span class="c1"># Use the &quot;once&quot; filter (which is also the default for Python</span>
<span class="c1"># warnings).  Exactly ten of these warnings will</span>
<span class="c1"># be emitted; beyond that, the Python warnings registry will accumulate</span>
<span class="c1"># new values as dupes of one of the ten existing.</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;once&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
    <span class="n">e</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">select</span><span class="p">([</span><span class="n">cast</span><span class="p">(</span>
        <span class="p">(</span><span class="s1">&apos;foo_</span><span class="si">%d</span><span class="s1">&apos;</span> <span class="o">%</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000000</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&apos;ascii&apos;</span><span class="p">),</span> <span class="n">Unicode</span><span class="p">)]))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-314">&#x8FD9;&#x91CC;&#x7684;&#x8B66;&#x544A;&#x683C;&#x5F0F;&#x662F;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>/path/lib/sqlalchemy/sql/sqltypes.py:186: SAWarning: Unicode type received
  non-unicode bind param value &apos;foo_4852&apos;. (this warning may be
  suppressed after 10 occurrences)</pre></div></div><p><span class="yiyi-st" id="yiyi-315"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3178">&#xFF03;3178  T0&gt;</a></span></p></div></div><div class="section" id="key-behavioral-changes-orm"><h2><span class="yiyi-st" id="yiyi-316">&#x5173;&#x952E;&#x884C;&#x4E3A;&#x6539;&#x53D8; -  ORM <a class="headerlink" href="#key-behavioral-changes-orm" title="Permalink to this headline">&#xB6;</a></span></h2><div class="section" id="query-update-now-resolves-string-names-into-mapped-attribute-names"><h3><span class="yiyi-st" id="yiyi-317">query.update()&#x73B0;&#x5728;&#x5C06;&#x5B57;&#x7B26;&#x4E32;&#x540D;&#x79F0;&#x89E3;&#x6790;&#x4E3A;&#x6620;&#x5C04;&#x7684;&#x5C5E;&#x6027;&#x540D;&#x79F0;<a class="headerlink" href="#query-update-now-resolves-string-names-into-mapped-attribute-names" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-318"><a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query.update" title="sqlalchemy.orm.query.Query.update"><code class="xref py py-meth docutils literal"><span class="pre">Query.update()</span></code></a>&#x7684;&#x6587;&#x6863;&#x58F0;&#x660E;&#x7ED9;&#x5B9A;&#x7684;<code class="docutils literal"><span class="pre">values</span></code>&#x5B57;&#x5178;&#x662F;&#x201C;&#x5C5E;&#x6027;&#x540D;&#x79F0;&#x4E3A;&#x952E;&#x7684;&#x5B57;&#x5178;&#x201D;&#xFF0C;&#x6697;&#x793A;&#x8FD9;&#x4E9B;&#x662F;&#x6620;&#x5C04;&#x7684;&#x5C5E;&#x6027;&#x540D;&#x79F0;&#x3002;</span><span class="yiyi-st" id="yiyi-319">&#x4E0D;&#x5E78;&#x7684;&#x662F;&#xFF0C;&#x8BE5;&#x51FD;&#x6570;&#x8BBE;&#x8BA1;&#x5F97;&#x66F4;&#x52A0;&#x6CE8;&#x91CD;&#x63A5;&#x6536;&#x5C5E;&#x6027;&#x548C;SQL&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x592A;&#x591A;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#xFF1B;&#x5F53;&#x5B57;&#x7B26;&#x4E32;&#x88AB;&#x4F20;&#x9012;&#x65F6;&#xFF0C;&#x8FD9;&#x4E9B;&#x5B57;&#x7B26;&#x4E32;&#x5C06;&#x76F4;&#x63A5;&#x4F20;&#x9012;&#x5230;&#x6838;&#x5FC3;&#x66F4;&#x65B0;&#x8BED;&#x53E5;&#x800C;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF0C;&#x5C31;&#x8FD9;&#x4E9B;&#x540D;&#x79F0;&#x5728;&#x6620;&#x5C04;&#x7C7B;&#x4E2D;&#x7684;&#x8868;&#x793A;&#x65B9;&#x5F0F;&#x800C;&#x8A00;&#xFF0C;&#x8FD9;&#x610F;&#x5473;&#x7740;&#x540D;&#x79F0;&#x5FC5;&#x987B;&#x5B8C;&#x5168;&#x4E0E;&#x8868;&#x5217;&#x5339;&#x914D;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5982;&#x4F55;&#x8BE5;&#x540D;&#x79F0;&#x7684;&#x5C5E;&#x6027;&#x88AB;&#x6620;&#x5C04;&#x5230;&#x7C7B;&#x4E0A;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-320">&#x5B57;&#x7B26;&#x4E32;&#x540D;&#x79F0;&#x73B0;&#x5728;&#x88AB;&#x8BA4;&#x771F;&#x89E3;&#x6790;&#x4E3A;&#x5C5E;&#x6027;&#x540D;&#x79F0;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;user&apos;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;user_name&apos;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-321">&#x5728;&#x4E0A;&#x9762;&#xFF0C;&#x5217;<code class="docutils literal"><span class="pre">user_name</span></code>&#x88AB;&#x6620;&#x5C04;&#x4E3A;<code class="docutils literal"><span class="pre">name</span></code>&#x3002;</span><span class="yiyi-st" id="yiyi-322">&#x4E4B;&#x524D;&#xFF0C;&#x8C03;&#x7528;&#x4F20;&#x9012;&#x5B57;&#x7B26;&#x4E32;&#x7684;<a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query.update" title="sqlalchemy.orm.query.Query.update"><code class="xref py py-meth docutils literal"><span class="pre">Query.update()</span></code></a>&#x5C06;&#x4E0D;&#x5F97;&#x4E0D;&#x6309;&#x5982;&#x4E0B;&#x65B9;&#x5F0F;&#x8C03;&#x7528;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&apos;user_name&apos;</span><span class="p">:</span> <span class="s1">&apos;moonbeam&apos;</span><span class="p">})</span></pre></div></div><p><span class="yiyi-st" id="yiyi-323">&#x7ED9;&#x5B9A;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x73B0;&#x5728;&#x662F;&#x9488;&#x5BF9;&#x5B9E;&#x4F53;&#x89E3;&#x6790;&#x7684;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&apos;name&apos;</span><span class="p">:</span> <span class="s1">&apos;moonbeam&apos;</span><span class="p">})</span></pre></div></div><p><span class="yiyi-st" id="yiyi-324">&#x901A;&#x5E38;&#x6700;&#x597D;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x8BE5;&#x5C5E;&#x6027;&#xFF0C;&#x4EE5;&#x907F;&#x514D;&#x4EFB;&#x4F55;&#x542B;&#x7CCA;&#x4E4B;&#x5904;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">User</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="s1">&apos;moonbeam&apos;</span><span class="p">})</span></pre></div></div><p><span class="yiyi-st" id="yiyi-325">&#x8BE5;&#x66F4;&#x6539;&#x8FD8;&#x8868;&#x793A;&#x540C;&#x4E49;&#x8BCD;&#x548C;&#x6DF7;&#x5408;&#x5C5E;&#x6027;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5B57;&#x7B26;&#x4E32;&#x540D;&#x79F0;&#x5F15;&#x7528;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;user&apos;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;user_name&apos;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>

    <span class="nd">@hybrid_property</span>
    <span class="k">def</span> <span class="nf">fullname</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&apos;fullname&apos;</span><span class="p">:</span> <span class="s1">&apos;moonbeam&apos;</span><span class="p">})</span></pre></div></div><p><span class="yiyi-st" id="yiyi-326"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3228">&#xFF03;3228  T0&gt;</a></span></p></div><div class="section" id="warnings-emitted-when-comparing-objects-with-none-values-to-relationships"><h3><span class="yiyi-st" id="yiyi-327">&#x5C06;&#x5BF9;&#x8C61;&#x4E0E;&#x65E0;&#x503C;&#x4E0E;<a class="headerlink" href="#warnings-emitted-when-comparing-objects-with-none-values-to-relationships" title="Permalink to this headline">&#xB6;</a>&#x5173;&#x7CFB;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#x65F6;&#x53D1;&#x51FA;&#x8B66;&#x544A;</span></h3><p><span class="yiyi-st" id="yiyi-328">&#x8FD9;&#x4E2A;&#x53D8;&#x5316;&#x5728;1.0.1&#x4E2D;&#x662F;&#x65B0;&#x7684;&#x3002;</span><span class="yiyi-st" id="yiyi-329">&#x4E00;&#x4E9B;&#x7528;&#x6237;&#x6B63;&#x5728;&#x6267;&#x884C;&#x57FA;&#x672C;&#x4E0A;&#x662F;&#x8FD9;&#x79CD;&#x5F62;&#x5F0F;&#x7684;&#x67E5;&#x8BE2;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Address</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Address</span><span class="o">.</span><span class="n">user</span> <span class="o">==</span> <span class="n">User</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="bp">None</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-330">SQLAlchemy&#x76EE;&#x524D;&#x4E0D;&#x652F;&#x6301;&#x6B64;&#x6A21;&#x5F0F;&#x3002;</span><span class="yiyi-st" id="yiyi-331">&#x5BF9;&#x4E8E;&#x6240;&#x6709;&#x7248;&#x672C;&#xFF0C;&#x5B83;&#x53D1;&#x51FA;&#x7684;SQL&#x7C7B;&#x4F3C;&#x4E8E;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT address.id AS address_id, address.user_id AS address_user_id,
address.email_address AS address_email_address
FROM address WHERE ? = address.user_id
(None,)</pre></div></div><p><span class="yiyi-st" id="yiyi-332">&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x6709;&#x4E00;&#x4E2A;&#x6BD4;&#x8F83;<code class="docutils literal"><span class="pre">WHERE</span> <span class="pre">&#xFF1F;</span> <span class="pre">=</span> <span class="pre">address.user_id</span></code>&#x7ED1;&#x5B9A;&#x503C;<code class="docutils literal"><span class="pre">?</span></code></span><span class="yiyi-st" id="yiyi-333">&#x5728;SQL&#x4E2D;&#x63A5;&#x6536;<code class="docutils literal"><span class="pre">None</span></code>&#x6216;<code class="docutils literal"><span class="pre">NULL</span></code>&#x3002;</span><span class="yiyi-st" id="yiyi-334"><strong>&#x8FD9;&#x603B;&#x662F;&#x4F1A;&#x5728;SQL&#x4E2D;&#x8FD4;&#x56DE;False</strong>&#x3002;</span><span class="yiyi-st" id="yiyi-335">&#x8FD9;&#x91CC;&#x7684;&#x6BD4;&#x8F83;&#x7406;&#x8BBA;&#x4E0A;&#x4F1A;&#x751F;&#x6210;SQL&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT address.id AS address_id, address.user_id AS address_user_id,
address.email_address AS address_email_address
FROM address WHERE address.user_id IS NULL</pre></div></div><p><span class="yiyi-st" id="yiyi-336">&#x4F46;&#x73B0;&#x5728;&#xFF0C;<strong>&#x5B83;&#x6CA1;&#x6709;</strong>&#x3002;</span><span class="yiyi-st" id="yiyi-337">&#x4F9D;&#x9760;&#x201C;NULL = NULL&#x201D;&#x5728;&#x6240;&#x6709;&#x60C5;&#x51B5;&#x4E0B;&#x90FD;&#x4F1A;&#x4EA7;&#x751F;False&#x8FD9;&#x4E00;&#x4E8B;&#x5B9E;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6709;&#x53EF;&#x80FD;&#x4F1A;&#x5192;&#x7740;&#x67D0;&#x79CD;&#x7A0B;&#x5EA6;&#x4E0A;&#x7684;&#x98CE;&#x9669;&#xFF0C;SQLAlchemy&#x53EF;&#x80FD;&#x4F1A;&#x89E3;&#x51B3;&#x6B64;&#x95EE;&#x9898;&#x4EE5;&#x751F;&#x6210;&#x201C;IS NULL&#x201D;&#xFF0C;&#x7136;&#x540E;&#x67E5;&#x8BE2;&#x4F1A;&#x4EA7;&#x751F;&#x4E0D;&#x540C;&#x7684;&#x7ED3;&#x679C;&#x3002;</span><span class="yiyi-st" id="yiyi-338">&#x56E0;&#x6B64;&#xFF0C;&#x901A;&#x8FC7;&#x8FD9;&#x79CD;&#x64CD;&#x4F5C;&#xFF0C;&#x60A8;&#x5C06;&#x770B;&#x5230;&#x4E00;&#x4E2A;&#x8B66;&#x544A;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SAWarning: Got None for value of column user.id; this is unsupported
for a relationship comparison and will not currently produce an
IS comparison (but may in a future release)</pre></div></div><p><span class="yiyi-st" id="yiyi-339">&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x8FD9;&#x79CD;&#x6A21;&#x5F0F;&#x5728;&#x5927;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x4E0B;&#x5728;1.0.0&#x7248;&#x672C;&#x4E2D;&#x88AB;&#x6253;&#x7834;&#xFF0C;&#x5305;&#x62EC;&#x6240;&#x6709;&#x7684;beta&#xFF1B;&#x4F1A;&#x4EA7;&#x751F;&#x50CF;<code class="docutils literal"><span class="pre">SYMBOL(&apos;NEVER_SET&apos;)</span></code>&#x8FD9;&#x6837;&#x7684;&#x503C;&#x3002;</span><span class="yiyi-st" id="yiyi-340">&#x6B64;&#x95EE;&#x9898;&#x5DF2;&#x5F97;&#x5230;&#x89E3;&#x51B3;&#xFF0C;&#x4F46;&#x901A;&#x8FC7;&#x8BC6;&#x522B;&#x6B64;&#x6A21;&#x5F0F;&#xFF0C;&#x73B0;&#x5728;&#x53D1;&#x51FA;&#x4E86;&#x8B66;&#x544A;&#xFF0C;&#x4EE5;&#x4FBF;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;&#x5C06;&#x6765;&#x7684;&#x7248;&#x672C;&#x4E2D;&#x66F4;&#x5B89;&#x5168;&#x5730;&#x4FEE;&#x590D;&#x6B64;&#x635F;&#x574F;&#x7684;&#x884C;&#x4E3A;&#xFF08;&#x73B0;&#x5728;&#x5728;<a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3373">&#xFF03;3373</a>&#x4E2D;&#x6355;&#x83B7;&#xFF09;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-341"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3371">&#xFF03;3371  T0&gt;</a></span></p></div><div class="section" id="a-negated-contains-or-equals-relationship-comparison-will-use-the-current-value-of-attributes-not-the-database-value"><h3><span class="yiyi-st" id="yiyi-342">&#x201C;&#x5426;&#x5B9A;&#x5305;&#x542B;&#x6216;&#x7B49;&#x4E8E;&#x201D;&#x5173;&#x7CFB;&#x6BD4;&#x8F83;&#x5C06;&#x4F7F;&#x7528;&#x5C5E;&#x6027;&#x7684;&#x5F53;&#x524D;&#x503C;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x6570;&#x636E;&#x5E93;&#x503C;<a class="headerlink" href="#a-negated-contains-or-equals-relationship-comparison-will-use-the-current-value-of-attributes-not-the-database-value" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-343">&#x8FD9;&#x4E2A;&#x53D8;&#x5316;&#x5728;1.0.1&#x662F;&#x65B0;&#x7684;&#xFF1B;&#x867D;&#x7136;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x8FD9;&#x662F;1.0.0&#xFF0C;&#x4F46;&#x5B83;&#x53EA;&#x662F;&#x7531;&#x4E8E;<a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3371">&#xFF03;3371</a>&#x800C;&#x53D8;&#x5F97;&#x660E;&#x663E;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-344">&#x7ED9;&#x5B9A;&#x6620;&#x5C04;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;a&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;b&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">a_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;a.id&apos;</span><span class="p">))</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-345">&#x7ED9;&#x5B9A;<code class="docutils literal"><span class="pre">A</span></code>&#xFF0C;&#x4E3B;&#x952E;&#x4E3A;7&#xFF0C;&#x4F46;&#x6211;&#x4EEC;&#x66F4;&#x6539;&#x4E3A;10&#x800C;&#x65E0;&#x9700;&#x5237;&#x65B0;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">Session</span><span class="p">(</span><span class="n">autoflush</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">a1</span> <span class="o">=</span> <span class="n">A</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<span class="n">a1</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">10</span></pre></div></div><p><span class="yiyi-st" id="yiyi-346">&#x9488;&#x5BF9;&#x4E0E;&#x6B64;&#x5BF9;&#x8C61;&#x4F5C;&#x4E3A;&#x76EE;&#x6807;&#x7684;&#x591A;&#x5BF9;&#x4E00;&#x5173;&#x7CFB;&#x7684;&#x67E5;&#x8BE2;&#x5C06;&#x5728;&#x7ED1;&#x5B9A;&#x53C2;&#x6570;&#x4E2D;&#x4F7F;&#x7528;&#x503C;10&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">B</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">a</span> <span class="o">==</span> <span class="n">a1</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-347">&#x751F;&#x4EA7;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT b.id AS b_id, b.a_id AS b_a_id
FROM b
WHERE ? = b.a_id
(10,)</pre></div></div><p><span class="yiyi-st" id="yiyi-348">However, before this change, the negation of this criteria would <strong>not</strong> use 10, it would use 7, unless the object were flushed first:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">B</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">a</span> <span class="o">!=</span> <span class="n">a1</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-349">&#x4EA7;&#x751F;&#xFF08;0.9&#x4EE5;&#x53CA;1.0.1&#x4E4B;&#x524D;&#x7684;&#x6240;&#x6709;&#x7248;&#x672C;&#xFF09;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT b.id AS b_id, b.a_id AS b_a_id
FROM b
WHERE b.a_id != ? OR b.a_id IS NULL
(7,)</pre></div></div><p><span class="yiyi-st" id="yiyi-350">&#x5BF9;&#x4E8E;&#x77AC;&#x6001;&#x5BF9;&#x8C61;&#xFF0C;&#x5B83;&#x4F1A;&#x4EA7;&#x751F;&#x4E00;&#x4E2A;&#x7834;&#x574F;&#x7684;&#x67E5;&#x8BE2;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT b.id, b.a_id
FROM b
WHERE b.a_id != :a_id_1 OR b.a_id IS NULL
{u&apos;a_id_1&apos;: symbol(&apos;NEVER_SET&apos;)}</pre></div></div><p><span class="yiyi-st" id="yiyi-351">&#x8FD9;&#x79CD;&#x4E0D;&#x4E00;&#x81F4;&#x6027;&#x5DF2;&#x88AB;&#x4FEE;&#x590D;&#xFF0C;&#x5E76;&#x4E14;&#x5728;&#x6240;&#x6709;&#x67E5;&#x8BE2;&#x4E2D;&#xFF0C;&#x73B0;&#x5728;&#x5C06;&#x4F7F;&#x7528;&#x5F53;&#x524D;&#x5C5E;&#x6027;&#x503C;&#xFF0C;&#x5728;&#x672C;&#x4F8B;&#x4E2D;<code class="docutils literal"><span class="pre">10</span></code>&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-352"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3374">&#xFF03;3374  T0&gt;</a></span></p></div><div class="section" id="changes-to-attribute-events-and-other-operations-regarding-attributes-that-have-no-pre-existing-value"><h3><span class="yiyi-st" id="yiyi-353">&#x5C5E;&#x6027;&#x4E8B;&#x4EF6;&#x548C;&#x5176;&#x4ED6;&#x4E0E;&#x6CA1;&#x6709;&#x9884;&#x5148;&#x5B58;&#x5728;&#x7684;&#x503C;&#x7684;&#x5C5E;&#x6027;&#x6709;&#x5173;&#x7684;&#x64CD;&#x4F5C;&#x7684;&#x53D8;&#x5316;<a class="headerlink" href="#changes-to-attribute-events-and-other-operations-regarding-attributes-that-have-no-pre-existing-value" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-354">&#x5728;&#x6B64;&#x66F4;&#x6539;&#x4E2D;&#xFF0C;&#x8BBF;&#x95EE;&#x5BF9;&#x8C61;&#x65F6;&#x7684;&#x9ED8;&#x8BA4;&#x8FD4;&#x56DE;&#x503C;<code class="docutils literal"><span class="pre">None</span></code>&#x73B0;&#x5728;&#x5728;&#x6BCF;&#x6B21;&#x8BBF;&#x95EE;&#x65F6;&#x52A8;&#x6001;&#x8FD4;&#x56DE;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5728;&#x7B2C;&#x4E00;&#x6B21;&#x8BBF;&#x95EE;&#x65F6;&#x7528;&#x7279;&#x6B8A;&#x7684;&#x201C;set&#x201D;&#x64CD;&#x4F5C;&#x9690;&#x5F0F;&#x8BBE;&#x7F6E;&#x8BE5;&#x5C5E;&#x6027;&#x7684;&#x72B6;&#x6001;&#x3002;</span><span class="yiyi-st" id="yiyi-355">The visible result of this change is that <code class="docutils literal"><span class="pre">obj.__dict__</span></code> is not implicitly modified on get, and there are also some minor behavioral changes for <a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.attributes.get_history" title="sqlalchemy.orm.attributes.get_history"><code class="xref py py-func docutils literal"><span class="pre">attributes.get_history()</span></code></a> and related functions.</span></p><p><span class="yiyi-st" id="yiyi-356">&#x7ED9;&#x5B9A;&#x4E00;&#x4E2A;&#x6CA1;&#x6709;&#x72B6;&#x6001;&#x7684;&#x5BF9;&#x8C61;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">obj</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">()</span></pre></div></div><p><span class="yiyi-st" id="yiyi-357">&#x5B83;&#x603B;&#x662F;SQLAlchemy&#x7684;&#x884C;&#x4E3A;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x8BBF;&#x95EE;&#x4E00;&#x4E2A;&#x4ECE;&#x672A;&#x8BBE;&#x7F6E;&#x8FC7;&#x7684;&#x6807;&#x91CF;&#x5C5E;&#x6027;&#x6216;&#x591A;&#x5BF9;&#x4E00;&#x5C5E;&#x6027;&#xFF0C;&#x5B83;&#x5C06;&#x8FD4;&#x56DE;&#x4E3A;<code class="docutils literal"><span class="pre">None</span></code>&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">obj</span><span class="o">.</span><span class="n">someattr</span>
<span class="go">None</span></pre></div></div><p><span class="yiyi-st" id="yiyi-358">&#x8FD9;&#x4E2A;<code class="docutils literal"><span class="pre">None</span></code>&#x7684;&#x503C;&#x5B9E;&#x9645;&#x4E0A;&#x73B0;&#x5728;&#x662F;<code class="docutils literal"><span class="pre">obj</span></code>&#x72B6;&#x6001;&#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x5E76;&#x4E14;&#x4E0E;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x660E;&#x786E;&#x8BBE;&#x7F6E;&#x4E86;&#x8BE5;&#x5C5E;&#x6027;&#x7684;&#x60C5;&#x51B5;&#x4E0D;&#x540C;&#x3002; <code class="docutils literal"><span class="pre">obj.someattr</span> <span class="pre">=</span> <span class="pre">&#x65E0;</span></code>&#x3002;</span><span class="yiyi-st" id="yiyi-359">&#x7136;&#x800C;&#xFF0C;&#x8FD9;&#x91CC;&#x7684;&#x201C;set on get&#x201D;&#x5728;&#x5386;&#x53F2;&#x548C;&#x4E8B;&#x4EF6;&#x65B9;&#x9762;&#x4F1A;&#x6709;&#x4E0D;&#x540C;&#x7684;&#x8868;&#x73B0;&#x3002;</span><span class="yiyi-st" id="yiyi-360">&#x5B83;&#x4E0D;&#x4F1A;&#x53D1;&#x5C04;&#x4EFB;&#x4F55;&#x5C5E;&#x6027;&#x4E8B;&#x4EF6;&#xFF0C;&#x800C;&#x4E14;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x67E5;&#x770B;&#x5386;&#x53F2;&#x8BB0;&#x5F55;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">inspect</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">someattr</span><span class="o">.</span><span class="n">history</span>
<span class="go">History(added=(), unchanged=[None], deleted=())   # 0.9 and below</span></pre></div></div><p><span class="yiyi-st" id="yiyi-361">&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x5C31;&#x597D;&#x50CF;&#x8BE5;&#x5C5E;&#x6027;&#x59CB;&#x7EC8;&#x662F;<code class="docutils literal"><span class="pre">None</span></code>&#xFF0C;&#x5E76;&#x4E14;&#x4ECE;&#x672A;&#x66F4;&#x6539;&#x8FC7;&#x3002;</span><span class="yiyi-st" id="yiyi-362">&#x8FD9;&#x4E0E;&#x6211;&#x4EEC;&#x5148;&#x8BBE;&#x7F6E;&#x5C5E;&#x6027;&#x7684;&#x60C5;&#x51B5;&#x660E;&#x663E;&#x4E0D;&#x540C;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">obj</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">obj</span><span class="o">.</span><span class="n">someattr</span> <span class="o">=</span> <span class="bp">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inspect</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">someattr</span><span class="o">.</span><span class="n">history</span>
<span class="go">History(added=[None], unchanged=(), deleted=())  # all versions</span></pre></div></div><p><span class="yiyi-st" id="yiyi-363">&#x4EE5;&#x4E0A;&#x610F;&#x5473;&#x7740;&#x6211;&#x4EEC;&#x7684;&#x201C;&#x8BBE;&#x7F6E;&#x201D;&#x64CD;&#x4F5C;&#x7684;&#x884C;&#x4E3A;&#x53EF;&#x80FD;&#x4F1A;&#x88AB;&#x4E4B;&#x524D;&#x901A;&#x8FC7;&#x201C;get&#x201D;&#x8BBF;&#x95EE;&#x7684;&#x503C;&#x6240;&#x7834;&#x574F;&#x3002;</span><span class="yiyi-st" id="yiyi-364">&#x5728;1.0&#x4E2D;&#xFF0C;&#x8FD9;&#x79CD;&#x4E0D;&#x4E00;&#x81F4;&#x6027;&#x5DF2;&#x7ECF;&#x89E3;&#x51B3;&#x4E86;&#xFF0C;&#x5F53;&#x4F7F;&#x7528;&#x9ED8;&#x8BA4;&#x7684;&#x201C;getter&#x201D;&#x65F6;&#xFF0C;&#x4E0D;&#x518D;&#x5B9E;&#x9645;&#x8BBE;&#x7F6E;&#x4EFB;&#x4F55;&#x4E1C;&#x897F;&#x3002;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">obj</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">obj</span><span class="o">.</span><span class="n">someattr</span>
<span class="go">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inspect</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">someattr</span><span class="o">.</span><span class="n">history</span>
<span class="go">History(added=(), unchanged=(), deleted=())  # 1.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">obj</span><span class="o">.</span><span class="n">someattr</span> <span class="o">=</span> <span class="bp">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inspect</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">someattr</span><span class="o">.</span><span class="n">history</span>
<span class="go">History(added=[None], unchanged=(), deleted=())</span></pre></div></div><p><span class="yiyi-st" id="yiyi-365">&#x4E0A;&#x8FF0;&#x884C;&#x4E3A;&#x6CA1;&#x6709;&#x592A;&#x5927;&#x5F71;&#x54CD;&#x7684;&#x539F;&#x56E0;&#x662F;&#x56E0;&#x4E3A;&#x5173;&#x7CFB;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x7684;INSERT&#x8BED;&#x53E5;&#x5728;&#x5927;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x4E0B;&#x8BA4;&#x4E3A;&#x7F3A;&#x5931;&#x503C;&#x4E0E;NULL&#x76F8;&#x540C;&#x3002;</span><span class="yiyi-st" id="yiyi-366">SQLAlchemy&#x662F;&#x5426;&#x6536;&#x5230;&#x4E00;&#x4E2A;&#x8BBE;&#x7F6E;&#x4E3A;None&#x7684;&#x7279;&#x5B9A;&#x5C5E;&#x6027;&#x7684;&#x5386;&#x53F2;&#x4E8B;&#x4EF6;&#x901A;&#x5E38;&#x65E0;&#x5173;&#x7D27;&#x8981;&#xFF1B;&#x56E0;&#x4E3A;&#x53D1;&#x9001;None / NULL&#x4E0E;&#x5426;&#x4E4B;&#x95F4;&#x7684;&#x5DEE;&#x5F02;&#x4E0D;&#x4F1A;&#x4EA7;&#x751F;&#x5F71;&#x54CD;&#x3002;</span><span class="yiyi-st" id="yiyi-367">&#x7136;&#x800C;&#xFF0C;&#x6B63;&#x5982;<a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3060">&#xFF03;3060</a>&#xFF08;&#x5728;<a class="reference internal" href="#migration-3060"><span>Priority of attribute changes on relationship-bound attributes vs. FK-bound may appear to change</span></a>&#xFF09;&#x8BF4;&#x660E;&#x4E86;&#x4E00;&#x4E9B;&#x5F88;&#x5C11;&#x7684;&#x8FB9;&#x7F18;&#x60C5;&#x51B5;&#x5B9E;&#x9645;&#x4E0A;&#x6211;&#x4EEC;&#x786E;&#x5B9E;&#x5E0C;&#x671B;&#x8BBE;&#x7F6E;<code class="docutils literal"><span class="pre">None</span></code>&#x3002;</span><span class="yiyi-st" id="yiyi-368">&#x6B64;&#x5916;&#xFF0C;&#x5728;&#x8FD9;&#x91CC;&#x5141;&#x8BB8;&#x5C5E;&#x6027;&#x4E8B;&#x4EF6;&#x610F;&#x5473;&#x7740;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x4E3A;ORM&#x6620;&#x5C04;&#x5C5E;&#x6027;&#x521B;&#x5EFA;&#x201C;&#x9ED8;&#x8BA4;&#x503C;&#x201D;&#x51FD;&#x6570;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-369">&#x4F5C;&#x4E3A;&#x8FD9;&#x79CD;&#x53D8;&#x5316;&#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x9690;&#x542B;&#x7684;&#x201C;&#x65E0;&#x201D;&#x7684;&#x751F;&#x6210;&#x73B0;&#x5728;&#x5728;&#x8FC7;&#x53BB;&#x53D1;&#x751F;&#x7684;&#x5176;&#x4ED6;&#x60C5;&#x51B5;&#x4E0B;&#x88AB;&#x7981;&#x7528;&#xFF1B;&#x8FD9;&#x5305;&#x62EC;&#x4F55;&#x65F6;&#x6536;&#x5230;&#x591A;&#x5BF9;&#x4E00;&#x7684;&#x5C5E;&#x6027;&#x96C6;&#x64CD;&#x4F5C;&#xFF1B;&#x4EE5;&#x524D;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x8BBE;&#x7F6E;&#x5176;&#x4ED6;&#x503C;&#xFF0C;&#x201C;&#x65E7;&#x201D;&#x503C;&#x5C06;&#x4E3A;&#x201C;&#x65E0;&#x201D;&#xFF1B;&#x5B83;&#x73B0;&#x5728;&#x5C06;&#x53D1;&#x9001;<code class="xref py py-data docutils literal"><span class="pre">orm.attributes.NEVER_SET</span></code>&#x503C;&#xFF0C;&#x8BE5;&#x503C;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x53D1;&#x9001;&#x7ED9;&#x5C5E;&#x6027;&#x4FA6;&#x542C;&#x5668;&#x3002;</span><span class="yiyi-st" id="yiyi-370">&#x8C03;&#x7528;Mapper&#x5B9E;&#x7528;&#x7A0B;&#x5E8F;&#x51FD;&#x6570;&#xFF08;&#x5982;<a class="reference internal" href="orm_mapping_api.html#sqlalchemy.orm.mapper.Mapper.primary_key_from_instance" title="sqlalchemy.orm.mapper.Mapper.primary_key_from_instance"><code class="xref py py-meth docutils literal"><span class="pre">Mapper.primary_key_from_instance()</span></code></a>&#xFF1B;&#xFF09;&#x65F6;&#x4E5F;&#x53EF;&#x80FD;&#x4F1A;&#x6536;&#x5230;&#x6B64;&#x7B26;&#x53F7;&#x3002;&#x5982;&#x679C;&#x4E3B;&#x952E;&#x5C5E;&#x6027;&#x6839;&#x672C;&#x6CA1;&#x6709;&#x8BBE;&#x7F6E;&#xFF0C;&#x800C;&#x4E4B;&#x524D;&#x7684;&#x503C;&#x4E3A;<code class="docutils literal"><span class="pre">None</span></code>&#xFF0C;&#x5B83;&#x73B0;&#x5728;&#x5C06;&#x6210;&#x4E3A;<code class="xref py py-data docutils literal"><span class="pre">orm.attributes.NEVER_SET</span></code>&#x7B26;&#x53F7;&#xFF0C;&#x5E76;&#x4E14;&#x4E0D;&#x4F1A;&#x66F4;&#x6539;&#x5BF9;&#x8C61;&#x7684;&#x72B6;&#x6001;&#x53D1;&#x751F;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-371"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3061">&#xFF03;3061  T0&gt;</a></span></p></div><div class="section" id="priority-of-attribute-changes-on-relationship-bound-attributes-vs-fk-bound-may-appear-to-change"><h3><span class="yiyi-st" id="yiyi-372">&#x5173;&#x7CFB;&#x7ED1;&#x5B9A;&#x5C5E;&#x6027;&#x4E0E;FK&#x7ED1;&#x5B9A;&#x5C5E;&#x6027;&#x53D8;&#x5316;&#x7684;&#x4F18;&#x5148;&#x7EA7;&#x53EF;&#x80FD;&#x4F1A;&#x6539;&#x53D8;<a class="headerlink" href="#priority-of-attribute-changes-on-relationship-bound-attributes-vs-fk-bound-may-appear-to-change" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-373">&#x4F5C;&#x4E3A;<a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3060">&#xFF03;3060</a>&#x7684;&#x4E00;&#x4E2A;&#x526F;&#x4F5C;&#x7528;&#xFF0C;&#x5C06;&#x5173;&#x7CFB;&#x7ED1;&#x5B9A;&#x5C5E;&#x6027;&#x8BBE;&#x7F6E;&#x4E3A;<code class="docutils literal"><span class="pre">None</span></code>&#x73B0;&#x5728;&#x662F;&#x4E00;&#x4E2A;&#x8DDF;&#x8E2A;&#x7684;&#x5386;&#x53F2;&#x4E8B;&#x4EF6;&#xFF0C;&#x5B83;&#x6D89;&#x53CA;&#x6301;&#x7EED;&#x5B58;&#x5728;&#x7684;&#x610F;&#x56FE;<code class="docutils literal"><span class="pre">None</span></code></span><span class="yiyi-st" id="yiyi-374">&#x56E0;&#x4E3A;&#x8BBE;&#x7F6E;&#x5173;&#x7CFB;&#x7ED1;&#x5B9A;&#x5C5E;&#x6027;&#x7684;&#x60C5;&#x51B5;&#x603B;&#x662F;&#x4F1A;&#x76F4;&#x63A5;&#x5206;&#x914D;&#x7ED9;&#x5916;&#x952E;&#x5C5E;&#x6027;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x5206;&#x914D;None&#x65F6;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x884C;&#x4E3A;&#x66F4;&#x6539;&#x3002;</span><span class="yiyi-st" id="yiyi-375">&#x7ED9;&#x5B9A;&#x6620;&#x5C04;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;table_a&apos;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;table_b&apos;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">a_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;table_a.id&apos;</span><span class="p">))</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="n">A</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-376">&#x5728;1.0&#x4E2D;&#xFF0C;&#x5728;&#x6240;&#x6709;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5173;&#x7CFB;&#x7ED1;&#x5B9A;&#x5C5E;&#x6027;&#x4F18;&#x5148;&#x4E8E;FK&#x7ED1;&#x5B9A;&#x5C5E;&#x6027;&#xFF0C;&#x65E0;&#x8BBA;&#x6211;&#x4EEC;&#x5206;&#x914D;&#x7684;&#x503C;&#x662F;&#x5BF9;<code class="docutils literal"><span class="pre">A</span></code>&#x5BF9;&#x8C61;&#x7684;&#x5F15;&#x7528;&#x8FD8;&#x662F;<code class="docutils literal"><span class="pre">None</span></code></span><span class="yiyi-st" id="yiyi-377">&#x5728;0.9&#x4E2D;&#xFF0C;&#x884C;&#x4E3A;&#x662F;&#x4E0D;&#x4E00;&#x81F4;&#x7684;&#xFF0C;&#x53EA;&#x6709;&#x8D4B;&#x503C;&#x65F6;&#x624D;&#x4F1A;&#x751F;&#x6548;&#xFF1B;&#x4E0D;&#x8003;&#x8651;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">a1</span> <span class="o">=</span> <span class="n">A</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">a2</span> <span class="o">=</span> <span class="n">A</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">add_all</span><span class="p">([</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">])</span>
<span class="n">session</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

<span class="n">b1</span> <span class="o">=</span> <span class="n">B</span><span class="p">()</span>
<span class="n">b1</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">a1</span>   <span class="c1"># we expect a_id to be &apos;1&apos;; takes precedence in 0.9 and 1.0</span>

<span class="n">b2</span> <span class="o">=</span> <span class="n">B</span><span class="p">()</span>
<span class="n">b2</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c1"># we expect a_id to be None; takes precedence only in 1.0</span>

<span class="n">b1</span><span class="o">.</span><span class="n">a_id</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">b2</span><span class="o">.</span><span class="n">a_id</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">session</span><span class="o">.</span><span class="n">add_all</span><span class="p">([</span><span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">])</span>
<span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<span class="k">assert</span> <span class="n">b1</span><span class="o">.</span><span class="n">a</span> <span class="ow">is</span> <span class="n">a1</span>  <span class="c1"># passes in both 0.9 and 1.0</span>
<span class="k">assert</span> <span class="n">b2</span><span class="o">.</span><span class="n">a</span> <span class="ow">is</span> <span class="bp">None</span>  <span class="c1"># passes in 1.0, in 0.9 it&apos;s a2</span></pre></div></div><p><span class="yiyi-st" id="yiyi-378"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3060">&#xFF03;3060  T0&gt;</a></span></p></div><div class="section" id="session-expunge-will-fully-detach-an-object-that-s-been-deleted"><h3><span class="yiyi-st" id="yiyi-379">session.expunge()&#x5C06;&#x5B8C;&#x5168;&#x5206;&#x79BB;&#x5DF2;&#x88AB;&#x5220;&#x9664;&#x7684;&#x5BF9;&#x8C61;<a class="headerlink" href="#session-expunge-will-fully-detach-an-object-that-s-been-deleted" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-380"><a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session.expunge" title="sqlalchemy.orm.session.Session.expunge"><code class="xref py py-meth docutils literal"><span class="pre">Session.expunge()</span></code></a>&#x7684;&#x884C;&#x4E3A;&#x5B58;&#x5728;&#x5BFC;&#x81F4;&#x5173;&#x4E8E;&#x5DF2;&#x5220;&#x9664;&#x5BF9;&#x8C61;&#x7684;&#x884C;&#x4E3A;&#x4E0D;&#x4E00;&#x81F4;&#x7684;&#x9519;&#x8BEF;&#x3002;</span><span class="yiyi-st" id="yiyi-381">&#x5728;&#x6E05;&#x9664;&#x4E4B;&#x540E;&#xFF0C;<a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.object_session" title="sqlalchemy.orm.session.object_session"><code class="xref py py-func docutils literal"><span class="pre">object_session()</span></code></a>&#x51FD;&#x6570;&#x4EE5;&#x53CA;<a class="reference internal" href="orm_internals.html#sqlalchemy.orm.state.InstanceState.session" title="sqlalchemy.orm.state.InstanceState.session"><code class="xref py py-attr docutils literal"><span class="pre">InstanceState.session</span></code></a>&#x5C5E;&#x6027;&#x4ECD;&#x7136;&#x4F1A;&#x5C06;&#x5BF9;&#x8C61;&#x62A5;&#x544A;&#x4E3A;&#x5C5E;&#x4E8E;<a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a></span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">u1</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<span class="n">sess</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span>

<span class="n">sess</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

<span class="k">assert</span> <span class="n">u1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sess</span>
<span class="k">assert</span> <span class="n">inspect</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span><span class="o">.</span><span class="n">session</span> <span class="ow">is</span> <span class="n">sess</span>  <span class="c1"># this is normal before commit</span>

<span class="n">sess</span><span class="o">.</span><span class="n">expunge</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">u1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sess</span>
<span class="k">assert</span> <span class="n">inspect</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span><span class="o">.</span><span class="n">session</span> <span class="ow">is</span> <span class="bp">None</span>  <span class="c1"># would fail</span></pre></div></div><p><span class="yiyi-st" id="yiyi-382">Note that it is normal for <code class="docutils literal"><span class="pre">u1</span> <span class="pre">not</span> <span class="pre">in</span> <span class="pre">sess</span></code> to be True while <code class="docutils literal"><span class="pre">inspect(u1).session</span></code> still refers to the session, while the transaction is ongoing subsequent to the delete operation and <a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session.expunge" title="sqlalchemy.orm.session.Session.expunge"><code class="xref py py-meth docutils literal"><span class="pre">Session.expunge()</span></code></a> has not been called; the full detachment normally completes once the transaction is committed. </span><span class="yiyi-st" id="yiyi-383">&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x4E5F;&#x4F1A;&#x5F71;&#x54CD;&#x4F9D;&#x8D56;&#x4E8E;<a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.Session.expunge" title="sqlalchemy.orm.session.Session.expunge"><code class="xref py py-meth docutils literal"><span class="pre">Session.expunge()</span></code></a>&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x6BD4;&#x5982;<a class="reference internal" href="orm_session_api.html#sqlalchemy.orm.session.make_transient" title="sqlalchemy.orm.session.make_transient"><code class="xref py py-func docutils literal"><span class="pre">make_transient()</span></code></a>&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-384"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3139">&#xFF03;3139  T0&gt;</a></span></p></div><div class="section" id="joined-subquery-eager-loading-explicitly-disallowed-with-yield-per"><h3><span class="yiyi-st" id="yiyi-385">&#x901A;&#x8FC7;yield_per <a class="headerlink" href="#joined-subquery-eager-loading-explicitly-disallowed-with-yield-per" title="Permalink to this headline">&#xB6;</a>&#x663E;&#x5F0F;&#x7981;&#x6B62;&#x52A0;&#x5165;/&#x5B50;&#x67E5;&#x8BE2;&#x52A0;&#x8F7D;&#x52A0;&#x8F7D;</span></h3><p><span class="yiyi-st" id="yiyi-386">&#x4E3A;&#x4E86;&#x4F7F;<a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query.yield_per" title="sqlalchemy.orm.query.Query.yield_per"><code class="xref py py-meth docutils literal"><span class="pre">Query.yield_per()</span></code></a>&#x65B9;&#x6CD5;&#x66F4;&#x6613;&#x4E8E;&#x4F7F;&#x7528;&#xFF0C;&#x5F53;&#x4F7F;&#x7528;yield_per&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x4EFB;&#x4F55;&#x5B50;&#x67E5;&#x8BE2;&#x6E34;&#x671B;&#x52A0;&#x8F7D;&#x5668;&#x6216;&#x52A0;&#x5165;&#x7684;&#x5C06;&#x4F7F;&#x7528;&#x96C6;&#x5408;&#x7684;&#x6E34;&#x671B;&#x52A0;&#x8F7D;&#x5668;&#x90FD;&#x8981;&#x751F;&#x6548;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x76EE;&#x524D;&#x4E0E;yield-per&#x4E0D;&#x517C;&#x5BB9;&#xFF08;&#x7136;&#x800C;&#xFF0C;&#x7406;&#x8BBA;&#x4E0A;&#x5B50;&#x67E5;&#x8BE2;&#x52A0;&#x8F7D;&#x53EF;&#x80FD;&#xFF09;&#x3002;</span><span class="yiyi-st" id="yiyi-387">&#x53D1;&#x751F;&#x6B64;&#x9519;&#x8BEF;&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x661F;&#x53F7;&#x53D1;&#x9001;<a class="reference internal" href="orm_loading_relationships.html#sqlalchemy.orm.lazyload" title="sqlalchemy.orm.lazyload"><code class="xref py py-func docutils literal"><span class="pre">lazyload()</span></code></a>&#x9009;&#x9879;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">q</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Object</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">lazyload</span><span class="p">(</span><span class="s1">&apos;*&apos;</span><span class="p">))</span><span class="o">.</span><span class="n">yield_per</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-388">&#x6216;&#x4F7F;&#x7528;<a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query.enable_eagerloads" title="sqlalchemy.orm.query.Query.enable_eagerloads"><code class="xref py py-meth docutils literal"><span class="pre">Query.enable_eagerloads()</span></code></a>&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">q</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Object</span><span class="p">)</span><span class="o">.</span><span class="n">enable_eagerloads</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">yield_per</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-389"><a class="reference internal" href="orm_loading_relationships.html#sqlalchemy.orm.lazyload" title="sqlalchemy.orm.lazyload"><code class="xref py py-func docutils literal"><span class="pre">lazyload()</span></code></a>&#x9009;&#x9879;&#x7684;&#x4F18;&#x70B9;&#x662F;&#xFF0C;&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x989D;&#x5916;&#x7684;&#x591A;&#x5BF9;&#x4E00;&#x8FDE;&#x63A5;&#x7684;&#x52A0;&#x8F7D;&#x5668;&#x9009;&#x9879;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">q</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Object</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span>
    <span class="n">lazyload</span><span class="p">(</span><span class="s1">&apos;*&apos;</span><span class="p">),</span> <span class="n">joinedload</span><span class="p">(</span><span class="s2">&quot;some_manytoone&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">yield_per</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span></pre></div></div></div><div class="section" id="changes-and-fixes-in-handling-of-duplicate-join-targets"><h3><span class="yiyi-st" id="yiyi-390">&#x5904;&#x7406;&#x91CD;&#x590D;&#x8FDE;&#x63A5;&#x76EE;&#x6807;<a class="headerlink" href="#changes-and-fixes-in-handling-of-duplicate-join-targets" title="Permalink to this headline">&#xB6;</a>&#x65F6;&#x7684;&#x66F4;&#x6539;&#x548C;&#x4FEE;&#x590D;</span></h3><p><span class="yiyi-st" id="yiyi-391">&#x6B64;&#x5904;&#x7684;&#x66F4;&#x6539;&#x5305;&#x62EC;&#x5728;&#x67D0;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#x53D1;&#x751F;&#x610F;&#x5916;&#x548C;&#x4E0D;&#x4E00;&#x81F4;&#x884C;&#x4E3A;&#x65F6;&#x53D1;&#x751F;&#x7684;&#x9519;&#x8BEF;&#xFF0C;&#x8FD9;&#x4E9B;&#x9519;&#x8BEF;&#x5305;&#x62EC;&#x4E24;&#x6B21;&#x8FDE;&#x63A5;&#x5230;&#x5B9E;&#x4F53;&#x6216;&#x591A;&#x4E2A;&#x5355;&#x8868;&#x5B9E;&#x4F53;&#x9488;&#x5BF9;&#x540C;&#x4E00;&#x4E2A;&#x8868;&#xFF0C;&#x800C;&#x4E0D;&#x4F7F;&#x7528;&#x57FA;&#x4E8E;&#x5173;&#x7CFB;&#x7684;ON&#x5B50;&#x53E5;&#x4EE5;&#x53CA;&#x8FDE;&#x63A5;&#x591A;&#x6B21;&#x4EE5;&#x76F8;&#x540C;&#x7684;&#x76EE;&#x6807;&#x5173;&#x7CFB;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-392">&#x4EE5;&#x6620;&#x5C04;&#x5F00;&#x59CB;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">Column</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">ForeignKey</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">Session</span><span class="p">,</span> <span class="n">relationship</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>

<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;a&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">bs</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;b&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">a_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;a.id&apos;</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-393">&#x8FDE;&#x63A5;&#x5230;<code class="docutils literal"><span class="pre">A.bs</span></code>&#x4E24;&#x6B21;&#x7684;&#x67E5;&#x8BE2;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">bs</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">bs</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-394">&#x5C06;&#x5448;&#x73B0;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT a.id AS a_id
FROM a JOIN b ON a.id = b.a_id</pre></div></div><p><span class="yiyi-st" id="yiyi-395">&#x8BE5;&#x67E5;&#x8BE2;&#x4F1A;&#x91CD;&#x590D;&#x5220;&#x9664;&#x591A;&#x4F59;&#x7684;<code class="docutils literal"><span class="pre">A.bs</span></code>&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x8BD5;&#x56FE;&#x652F;&#x6301;&#x5982;&#x4E0B;&#x6240;&#x793A;&#x7684;&#x60C5;&#x51B5;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">bs</span><span class="p">)</span><span class="o">.</span>\
    <span class="nb">filter</span><span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">foo</span> <span class="o">==</span> <span class="s1">&apos;bar&apos;</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">reset_joinpoint</span><span class="p">()</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">bs</span><span class="p">,</span> <span class="n">B</span><span class="o">.</span><span class="n">cs</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">bar</span> <span class="o">==</span> <span class="s1">&apos;bat&apos;</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-396">That is, the <code class="docutils literal"><span class="pre">A.bs</span></code> is part of a &#x201C;path&#x201D;. </span><span class="yiyi-st" id="yiyi-397">&#x4F5C;&#x4E3A;<a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3367">&#xFF03;3367</a>&#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x4E24;&#x6B21;&#x5230;&#x8FBE;&#x76F8;&#x540C;&#x7684;&#x7AEF;&#x70B9;&#x800C;&#x4E0D;&#x662F;&#x5927;&#x8DEF;&#x5F84;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x73B0;&#x5728;&#x5C06;&#x53D1;&#x51FA;&#x8B66;&#x544A;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SAWarning: Pathed join target A.bs has already been joined to; skipping</pre></div></div><p><span class="yiyi-st" id="yiyi-398">&#x5F53;&#x52A0;&#x5165;&#x5B9E;&#x4F53;&#x800C;&#x4E0D;&#x4F7F;&#x7528;&#x5173;&#x7CFB;&#x8DEF;&#x5F84;&#x65F6;&#xFF0C;&#x66F4;&#x5927;&#x7684;&#x53D8;&#x5316;&#x6D89;&#x53CA;&#x5230;&#x3002;</span><span class="yiyi-st" id="yiyi-399">&#x5982;&#x679C;&#x6211;&#x4EEC;&#x52A0;&#x5165;<code class="docutils literal"><span class="pre">B</span></code>&#x4E24;&#x6B21;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">B</span><span class="o">.</span><span class="n">a_id</span> <span class="o">==</span> <span class="n">A</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">B</span><span class="o">.</span><span class="n">a_id</span> <span class="o">==</span> <span class="n">A</span><span class="o">.</span><span class="n">id</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-400">&#x5728;0.9&#x4E2D;&#xFF0C;&#x8FD9;&#x5C06;&#x5448;&#x73B0;&#x5982;&#x4E0B;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT a.id AS a_id
FROM a JOIN b ON b.a_id = a.id JOIN b AS b_1 ON b_1.a_id = a.id</pre></div></div><p><span class="yiyi-st" id="yiyi-401">&#x8FD9;&#x662F;&#x6709;&#x95EE;&#x9898;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x522B;&#x540D;&#x662F;&#x9690;&#x542B;&#x7684;&#xFF0C;&#x5E76;&#x4E14;&#x5728;&#x4E0D;&#x540C;&#x7684;ON&#x5B50;&#x53E5;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x4F1A;&#x5BFC;&#x81F4;&#x4E0D;&#x53EF;&#x9884;&#x77E5;&#x7684;&#x7ED3;&#x679C;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-402">&#x5728;1.0&#x4E2D;&#xFF0C;&#x6CA1;&#x6709;&#x5E94;&#x7528;&#x81EA;&#x52A8;&#x522B;&#x540D;&#xFF0C;&#x6211;&#x4EEC;&#x5F97;&#x5230;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT a.id AS a_id
FROM a JOIN b ON b.a_id = a.id JOIN b ON b.a_id = a.id</pre></div></div><p><span class="yiyi-st" id="yiyi-403">&#x8FD9;&#x4F1A;&#x5F15;&#x53D1;&#x6570;&#x636E;&#x5E93;&#x9519;&#x8BEF;&#x3002;</span><span class="yiyi-st" id="yiyi-404">&#x867D;&#x7136;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x52A0;&#x5165;&#x5197;&#x4F59;&#x5173;&#x7CFB;&#x548C;&#x57FA;&#x4E8E;&#x5197;&#x4F59;&#x975E;&#x5173;&#x7CFB;&#x7684;&#x76EE;&#x6807;&#xFF0C;&#x5982;&#x679C;&#x201C;&#x91CD;&#x590D;&#x8FDE;&#x63A5;&#x76EE;&#x6807;&#x201D;&#x7684;&#x884C;&#x4E3A;&#x76F8;&#x540C;&#xFF0C;&#x90A3;&#x4E48;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x53EA;&#x662F;&#x5728;&#x66F4;&#x4E25;&#x91CD;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x6539;&#x53D8;&#x884C;&#x4E3A;&#xFF0C;&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5148;&#x524D;&#x4F1A;&#x51FA;&#x73B0;&#x9690;&#x5F0F;&#x952F;&#x9F7F;&#xFF0C;&#x5E76;&#x4E14;&#x53EA;&#x4F1A;&#x5728;&#x5173;&#x7CFB;&#x6848;&#x4F8B;&#x4E2D;&#x53D1;&#x51FA;&#x8B66;&#x544A;&#x3002;</span><span class="yiyi-st" id="yiyi-405">&#x6700;&#x7EC8;&#xFF0C;&#x4E24;&#x6B21;&#x52A0;&#x5165;&#x76F8;&#x540C;&#x7684;&#x4E8B;&#x7269;&#x800C;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x6DF7;&#x6DC6;&#x6D88;&#x9664;&#x6B67;&#x4E49;&#x7684;&#x884C;&#x4E3A;&#x4F1A;&#x5728;&#x6240;&#x6709;&#x60C5;&#x51B5;&#x4E0B;&#x4EA7;&#x751F;&#x9519;&#x8BEF;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-406">&#x6B64;&#x66F4;&#x6539;&#x8FD8;&#x4F1A;&#x5F71;&#x54CD;&#x5355;&#x8868;&#x7EE7;&#x627F;&#x76EE;&#x6807;&#x3002;</span><span class="yiyi-st" id="yiyi-407">&#x4F7F;&#x7528;&#x5982;&#x4E0B;&#x6620;&#x5C04;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">Column</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">ForeignKey</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">Session</span><span class="p">,</span> <span class="n">relationship</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>

<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>

    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&apos;polymorphic_on&apos;</span><span class="p">:</span> <span class="nb">type</span><span class="p">,</span> <span class="s1">&apos;polymorphic_identity&apos;</span><span class="p">:</span> <span class="s1">&apos;a&apos;</span><span class="p">}</span>


<span class="k">class</span> <span class="nc">ASub1</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&apos;polymorphic_identity&apos;</span><span class="p">:</span> <span class="s1">&apos;asub1&apos;</span><span class="p">}</span>


<span class="k">class</span> <span class="nc">ASub2</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&apos;polymorphic_identity&apos;</span><span class="p">:</span> <span class="s1">&apos;asub2&apos;</span><span class="p">}</span>


<span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;b&apos;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">a_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;a.id&quot;</span><span class="p">))</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="n">primaryjoin</span><span class="o">=</span><span class="s2">&quot;B.a_id == A.id&quot;</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="s1">&apos;b&apos;</span><span class="p">)</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">ASub1</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">ASub1</span><span class="o">.</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ASub2</span><span class="p">,</span> <span class="n">B</span><span class="o">.</span><span class="n">a</span><span class="p">))</span>

<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">ASub1</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">ASub1</span><span class="o">.</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ASub2</span><span class="p">,</span> <span class="n">ASub2</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">B</span><span class="o">.</span><span class="n">a_id</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-408">&#x5E95;&#x90E8;&#x7684;&#x4E24;&#x4E2A;&#x67E5;&#x8BE2;&#x662F;&#x7B49;&#x4EF7;&#x7684;&#xFF0C;&#x5E76;&#x4E14;&#x90FD;&#x5E94;&#x8BE5;&#x5448;&#x73B0;&#x76F8;&#x540C;&#x7684;SQL&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT a.id AS a_id, a.type AS a_type
FROM a JOIN b ON b.a_id = a.id JOIN a ON b.a_id = a.id AND a.type IN (:type_1)
WHERE a.type IN (:type_2)</pre></div></div><p><span class="yiyi-st" id="yiyi-409">&#x4E0A;&#x9762;&#x7684;SQL&#x662F;&#x65E0;&#x6548;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x5728;FROM&#x5217;&#x8868;&#x4E2D;&#x5448;&#x73B0;&#x4E24;&#x6B21;&#x201C;a&#x201D;&#x3002;</span><span class="yiyi-st" id="yiyi-410">&#x4F46;&#x662F;&#xFF0C;&#x53EA;&#x6709;&#x7B2C;&#x4E8C;&#x4E2A;&#x67E5;&#x8BE2;&#x4F1A;&#x51FA;&#x73B0;&#x9690;&#x5F0F;&#x522B;&#x540D;&#x9519;&#x8BEF;&#xFF0C;&#x5E76;&#x5C06;&#x5176;&#x6E32;&#x67D3;&#x4E3A;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT a.id AS a_id, a.type AS a_type
FROM a JOIN b ON b.a_id = a.id JOIN a AS a_1
ON a_1.id = b.a_id AND a_1.type IN (:type_1)
WHERE a_1.type IN (:type_2)</pre></div></div><p><span class="yiyi-st" id="yiyi-411">&#x5728;&#x4E0A;&#x9762;&#xFF0C;&#x7B2C;&#x4E8C;&#x6B21;&#x52A0;&#x5165;&#x201C;a&#x201D;&#x662F;&#x522B;&#x540D;&#x3002;</span><span class="yiyi-st" id="yiyi-412">&#x867D;&#x7136;&#x8FD9;&#x770B;&#x8D77;&#x6765;&#x5F88;&#x65B9;&#x4FBF;&#xFF0C;&#x4F46;&#x5B83;&#x5E76;&#x4E0D;&#x662F;&#x5355;&#x4E00;&#x7EE7;&#x627F;&#x67E5;&#x8BE2;&#x7684;&#x4E00;&#x822C;&#x5DE5;&#x4F5C;&#x65B9;&#x5F0F;&#xFF0C;&#x800C;&#x4E14;&#x5177;&#x6709;&#x8BEF;&#x5BFC;&#x6027;&#x548C;&#x4E0D;&#x4E00;&#x81F4;&#x6027;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-413">&#x6700;&#x7EC8;&#x7ED3;&#x679C;&#x662F;&#x4F9D;&#x8D56;&#x4E8E;&#x8FD9;&#x4E2A;&#x9519;&#x8BEF;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x73B0;&#x5728;&#x4F1A;&#x6709;&#x6570;&#x636E;&#x5E93;&#x5F15;&#x53D1;&#x7684;&#x9519;&#x8BEF;&#x3002;</span><span class="yiyi-st" id="yiyi-414">&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x662F;&#x4F7F;&#x7528;&#x9884;&#x671F;&#x7684;&#x5F62;&#x5F0F;&#x3002;</span><span class="yiyi-st" id="yiyi-415">&#x5728;&#x67E5;&#x8BE2;&#x4E2D;&#x5F15;&#x7528;&#x5355;&#x4E00;&#x7EE7;&#x627F;&#x5B9E;&#x4F53;&#x7684;&#x591A;&#x4E2A;&#x5B50;&#x7C7B;&#x65F6;&#xFF0C;&#x5FC5;&#x987B;&#x624B;&#x52A8;&#x4F7F;&#x7528;&#x522B;&#x540D;&#x6765;&#x6D88;&#x9664;&#x8868;&#x7684;&#x6B67;&#x4E49;&#xFF0C;&#x56E0;&#x4E3A;&#x6240;&#x6709;&#x5B50;&#x7C7B;&#x901A;&#x5E38;&#x5F15;&#x7528;&#x540C;&#x4E00;&#x4E2A;&#x8868;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">asub2_alias</span> <span class="o">=</span> <span class="n">aliased</span><span class="p">(</span><span class="n">ASub2</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">ASub1</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">ASub1</span><span class="o">.</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">asub2_alias</span><span class="p">,</span> <span class="n">B</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">asub2_alias</span><span class="p">)))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-416"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3233">&#xFF03;3233</a> <a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3367">&#xFF03;3367</a></span></p></div><div class="section" id="deferred-columns-no-longer-implicitly-undefer"><h3><span class="yiyi-st" id="yiyi-417">&#x5EF6;&#x8FDF;&#x5217;&#x4E0D;&#x518D;&#x9690;&#x5F0F;&#x4E0D;&#x5EF6;&#x8FDF;<a class="headerlink" href="#deferred-columns-no-longer-implicitly-undefer" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-418">&#x6807;&#x8BB0;&#x4E3A;&#x5EF6;&#x8FDF;&#x4F46;&#x6CA1;&#x6709;&#x663E;&#x5F0F;&#x672A;&#x5EF6;&#x8FDF;&#x7684;&#x6620;&#x5C04;&#x5C5E;&#x6027;&#x73B0;&#x5728;&#x5C06;&#x4FDD;&#x6301;&#x201C;&#x5EF6;&#x8FDF;&#x201D;&#x72B6;&#x6001;&#xFF0C;&#x5373;&#x4F7F;&#x5B83;&#x4EEC;&#x7684;&#x5217;&#x4EE5;&#x67D0;&#x79CD;&#x65B9;&#x5F0F;&#x5B58;&#x5728;&#x4E8E;&#x7ED3;&#x679C;&#x96C6;&#x4E2D;&#x3002;</span><span class="yiyi-st" id="yiyi-419">&#x8FD9;&#x662F;&#x4E00;&#x79CD;&#x6027;&#x80FD;&#x589E;&#x5F3A;&#xFF0C;&#x56E0;&#x4E3A;&#x5F53;&#x83B7;&#x5F97;&#x7ED3;&#x679C;&#x96C6;&#x65F6;&#xFF0C;ORM&#x52A0;&#x8F7D;&#x4E0D;&#x518D;&#x82B1;&#x8D39;&#x65F6;&#x95F4;&#x641C;&#x7D22;&#x6BCF;&#x4E2A;&#x5EF6;&#x8FDF;&#x5217;&#x3002;</span><span class="yiyi-st" id="yiyi-420">&#x4F46;&#x662F;&#xFF0C;&#x5BF9;&#x4E8E;&#x4F9D;&#x8D56;&#x4E8E;&#x6B64;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x73B0;&#x5728;&#x5E94;&#x8BE5;&#x4F7F;&#x7528;&#x660E;&#x786E;&#x7684;<a class="reference internal" href="orm_loading_columns.html#sqlalchemy.orm.undefer" title="sqlalchemy.orm.undefer"><code class="xref py py-func docutils literal"><span class="pre">undefer()</span></code></a>&#x6216;&#x7C7B;&#x4F3C;&#x9009;&#x9879;&#xFF0C;&#x4EE5;&#x9632;&#x6B62;&#x5728;&#x8BBF;&#x95EE;&#x5C5E;&#x6027;&#x65F6;&#x53D1;&#x51FA;SELECT&#x3002;</span></p></div><div class="section" id="deprecated-orm-event-hooks-removed"><h3><span class="yiyi-st" id="yiyi-421">&#x5DF2;&#x5F03;&#x7528;&#x7684;ORM&#x4E8B;&#x4EF6;&#x6302;&#x94A9;&#x5DF2;&#x5220;&#x9664;<a class="headerlink" href="#deprecated-orm-event-hooks-removed" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-422">&#x4EE5;&#x4E0B;ORM&#x4E8B;&#x4EF6;&#x6302;&#x94A9;&#xFF08;&#x5176;&#x4E2D;&#x4E00;&#x4E9B;&#x5DF2;&#x4ECE;0.5&#x5F00;&#x59CB;&#x5DF2;&#x5F03;&#x7528;&#xFF09;&#x5DF2;&#x88AB;&#x5220;&#x9664;&#xFF1A;<code class="docutils literal"><span class="pre">translate_row</span></code>&#xFF0C;<code class="docutils literal"><span class="pre">populate_instance</span></code>&#xFF0C;<code class="docutils literal"><span class="pre">append_result</span></code>&#xFF0C;<code class="docutils literal"><span class="pre">create_instance</span></code></span><span class="yiyi-st" id="yiyi-423">&#x8FD9;&#x4E9B;&#x94A9;&#x5B50;&#x7684;&#x7528;&#x4F8B;&#x8D77;&#x6E90;&#x4E8E;&#x65E9;&#x671F;&#x7684;0.1 / 0.2&#x7CFB;&#x5217;SQLAlchemy&#xFF0C;&#x5E76;&#x4E14;&#x65E9;&#x5DF2;&#x4E0D;&#x5FC5;&#x8981;&#x4E86;&#x3002;</span><span class="yiyi-st" id="yiyi-424">&#x7279;&#x522B;&#x662F;&#x94A9;&#x5B50;&#x5728;&#x5F88;&#x5927;&#x7A0B;&#x5EA6;&#x4E0A;&#x65E0;&#x6CD5;&#x4F7F;&#x7528;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x4E9B;&#x4E8B;&#x4EF6;&#x4E2D;&#x7684;&#x884C;&#x4E3A;&#x5951;&#x7EA6;&#x4E0E;&#x5468;&#x56F4;&#x7684;&#x5185;&#x90E8;&#x7EC4;&#x4EF6;&#x7D27;&#x5BC6;&#x76F8;&#x5173;&#xFF0C;&#x4F8B;&#x5982;&#x9700;&#x8981;&#x5982;&#x4F55;&#x521B;&#x5EFA;&#x548C;&#x521D;&#x59CB;&#x5316;&#x5B9E;&#x4F8B;&#x4EE5;&#x53CA;&#x5982;&#x4F55;&#x5728;ORM&#x751F;&#x6210;&#x7684;&#x884C;&#x5185;&#x5B9A;&#x4F4D;&#x5217;&#x3002;</span><span class="yiyi-st" id="yiyi-425">&#x5220;&#x9664;&#x8FD9;&#x4E9B;&#x94A9;&#x5B50;&#x5927;&#x5927;&#x7B80;&#x5316;&#x4E86;ORM&#x5BF9;&#x8C61;&#x52A0;&#x8F7D;&#x7684;&#x673A;&#x5236;&#x3002;</span></p></div><div class="section" id="api-change-for-new-bundle-feature-when-custom-row-loaders-are-used"><h3><span class="yiyi-st" id="yiyi-426">&#x4F7F;&#x7528;&#x81EA;&#x5B9A;&#x4E49;&#x884C;&#x52A0;&#x8F7D;&#x7A0B;&#x5E8F;&#x65F6;&#x5BF9;&#x65B0;Bundle&#x529F;&#x80FD;&#x7684;API&#x66F4;&#x6539;<a class="headerlink" href="#api-change-for-new-bundle-feature-when-custom-row-loaders-are-used" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-427">&#x5F53;<code class="docutils literal"><span class="pre">create_row_processor()</span></code>&#x65B9;&#x6CD5;&#x5728;&#x81EA;&#x5B9A;&#x4E49;&#x7C7B;&#x4E0A;&#x88AB;&#x8986;&#x76D6;&#x65F6;&#xFF0C;0.9&#x7684;&#x65B0;<a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Bundle" title="sqlalchemy.orm.query.Bundle"><code class="xref py py-class docutils literal"><span class="pre">Bundle</span></code></a>&#x5BF9;&#x8C61;&#x5728;API&#x4E2D;&#x6709;&#x4E00;&#x4E2A;&#x5C0F;&#x7684;&#x6539;&#x53D8;&#x3002;</span><span class="yiyi-st" id="yiyi-428">&#x4EE5;&#x524D;&#xFF0C;&#x793A;&#x4F8B;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">Bundle</span>

<span class="k">class</span> <span class="nc">DictBundle</span><span class="p">(</span><span class="n">Bundle</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">create_row_processor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">procs</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Override create_row_processor to return values as dictionaries&quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">proc</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
                        <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="p">(</span><span class="n">proc</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span> <span class="k">for</span> <span class="n">proc</span> <span class="ow">in</span> <span class="n">procs</span><span class="p">))</span>
                    <span class="p">)</span>
        <span class="k">return</span> <span class="n">proc</span></pre></div></div><p><span class="yiyi-st" id="yiyi-429">&#x672A;&#x4F7F;&#x7528;&#x7684;<code class="docutils literal"><span class="pre">result</span></code>&#x6210;&#x5458;&#x73B0;&#x5728;&#x88AB;&#x5220;&#x9664;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">Bundle</span>

<span class="k">class</span> <span class="nc">DictBundle</span><span class="p">(</span><span class="n">Bundle</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">create_row_processor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">procs</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Override create_row_processor to return values as dictionaries&quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">proc</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
                        <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="p">(</span><span class="n">proc</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">proc</span> <span class="ow">in</span> <span class="n">procs</span><span class="p">))</span>
                    <span class="p">)</span>
        <span class="k">return</span> <span class="n">proc</span></pre></div></div><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-430">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-431"><a class="reference internal" href="orm_loading_columns.html#bundles"><span>Column Bundles</span></a></span></p></div></div><div class="section" id="right-inner-join-nesting-now-the-default-for-joinedload-with-innerjoin-true"><h3><span class="yiyi-st" id="yiyi-432">&#x53F3;&#x5185;&#x90E8;&#x8FDE;&#x63A5;&#x5D4C;&#x5957;&#x73B0;&#x5728;&#x662F;innerjoin = True <a class="headerlink" href="#right-inner-join-nesting-now-the-default-for-joinedload-with-innerjoin-true" title="Permalink to this headline">&#xB6;</a>&#x7684;&#x5DF2;&#x52A0;&#x5165;&#x8FDE;&#x63A5;&#x7684;&#x9ED8;&#x8BA4;&#x503C;</span></h3><p><span class="yiyi-st" id="yiyi-433"><a class="reference internal" href="orm_loading_relationships.html#sqlalchemy.orm.joinedload.params.innerjoin" title="sqlalchemy.orm.joinedload"><code class="xref py py-paramref docutils literal"><span class="pre">joinedload.innerjoin</span></code></a>&#x4EE5;&#x53CA;<a class="reference internal" href="orm_relationship_api.html#sqlalchemy.orm.relationship.params.innerjoin" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal"><span class="pre">relationship.innerjoin</span></code></a>&#x7684;&#x884C;&#x4E3A;&#x73B0;&#x5728;&#x4F7F;&#x7528;&#x201C;&#x5D4C;&#x5957;&#x201D;&#x5185;&#x90E8;&#x8054;&#x63A5;&#xFF0C;&#x5373;&#x53F3;&#x5D4C;&#x5957;&#xFF0C;&#x4F5C;&#x4E3A;&#x5185;&#x90E8;&#x8054;&#x63A5;&#x52A0;&#x5165;&#x52A0;&#x5165;&#x7684;&#x6025;&#x5207;&#x52A0;&#x8F7D;&#x88AB;&#x94FE;&#x63A5;&#x5230;&#x5916;&#x90E8;&#x52A0;&#x5165;&#x6025;&#x5207;&#x52A0;&#x8F7D;&#x3002;</span><span class="yiyi-st" id="yiyi-434">&#x4E3A;&#x4E86;&#x83B7;&#x5F97;&#x5C06;&#x5916;&#x90E8;&#x8FDE;&#x63A5;&#x5B58;&#x5728;&#x65F6;&#x5C06;&#x6240;&#x6709;&#x8FDE;&#x63A5;&#x7684;&#x7D27;&#x6025;&#x52A0;&#x8F7D;&#x94FE;&#x63A5;&#x4E3A;&#x5916;&#x90E8;&#x8FDE;&#x63A5;&#x7684;&#x65E7;&#x884C;&#x4E3A;&#xFF0C;&#x8BF7;&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">innerjoin=&quot;unnested&quot;</span></code>&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-435">As introduced in <a class="reference internal" href="migration_09.html#feature-2976"><span>Right-nested inner joins available in joined eager loads</span></a> from version 0.9, the behavior of <code class="docutils literal"><span class="pre">innerjoin=&quot;nested&quot;</span></code> is that an inner join eager load chained to an outer join eager load will use a right-nested join. </span><span class="yiyi-st" id="yiyi-436"><code class="docutils literal"><span class="pre">&quot;nested&quot;</span></code> is now implied when using <code class="docutils literal"><span class="pre">innerjoin=True</span></code>:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span>
    <span class="n">joinedload</span><span class="p">(</span><span class="s2">&quot;orders&quot;</span><span class="p">,</span> <span class="n">innerjoin</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">joinedload</span><span class="p">(</span><span class="s2">&quot;items&quot;</span><span class="p">,</span> <span class="n">innerjoin</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-437">&#x4F7F;&#x7528;&#x65B0;&#x7684;&#x9ED8;&#x8BA4;&#x503C;&#xFF0C;&#x8FD9;&#x5C06;&#x4EE5;&#x4E0B;&#x9762;&#x7684;&#x5F62;&#x5F0F;&#x5448;&#x73B0;FROM&#x5B50;&#x53E5;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>FROM users LEFT OUTER JOIN (orders JOIN items ON &lt;onclause&gt;) ON &lt;onclause&gt;</pre></div></div><p><span class="yiyi-st" id="yiyi-438">&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x5BF9;INNER&#x8FDE;&#x63A5;&#x4F7F;&#x7528;&#x53F3;&#x5D4C;&#x5957;&#x8FDE;&#x63A5;&#xFF0C;&#x4EE5;&#x4FBF;&#x53EF;&#x4EE5;&#x8FD4;&#x56DE;<code class="docutils literal"><span class="pre">users</span></code>&#x7684;&#x5B8C;&#x6574;&#x7ED3;&#x679C;&#x3002;</span><span class="yiyi-st" id="yiyi-439">INNER&#x8FDE;&#x63A5;&#x7684;&#x4F7F;&#x7528;&#x6BD4;&#x4F7F;&#x7528;OUTER&#x8FDE;&#x63A5;&#x66F4;&#x6709;&#x6548;&#xFF0C;&#x5E76;&#x5141;&#x8BB8;<a class="reference internal" href="orm_loading_relationships.html#sqlalchemy.orm.joinedload.params.innerjoin" title="sqlalchemy.orm.joinedload"><code class="xref py py-paramref docutils literal"><span class="pre">joinedload.innerjoin</span></code></a>&#x4F18;&#x5316;&#x53C2;&#x6570;&#x5728;&#x6240;&#x6709;&#x60C5;&#x51B5;&#x4E0B;&#x90FD;&#x751F;&#x6548;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-440">&#x8981;&#x83B7;&#x5F97;&#x8F83;&#x65E7;&#x7684;&#x884C;&#x4E3A;&#xFF0C;&#x8BF7;&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">innerjoin=&quot;unnested&quot;</span></code>&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span>
    <span class="n">joinedload</span><span class="p">(</span><span class="s2">&quot;orders&quot;</span><span class="p">,</span> <span class="n">innerjoin</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">joinedload</span><span class="p">(</span><span class="s2">&quot;items&quot;</span><span class="p">,</span> <span class="n">innerjoin</span><span class="o">=</span><span class="s2">&quot;unnested&quot;</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-441">&#x8FD9;&#x5C06;&#x907F;&#x514D;&#x53F3;&#x5D4C;&#x5957;&#x8FDE;&#x63A5;&#xFF0C;&#x5E76;&#x5C3D;&#x7BA1;&#x4F7F;&#x7528;innerjoin&#x6307;&#x4EE4;&#x4F7F;&#x7528;&#x6240;&#x6709;OUTER&#x8FDE;&#x63A5;&#x5C06;&#x8FDE;&#x63A5;&#x94FE;&#x63A5;&#x5728;&#x4E00;&#x8D77;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>FROM users LEFT OUTER JOIN orders ON &lt;onclause&gt; LEFT OUTER JOIN items ON &lt;onclause&gt;</pre></div></div><p><span class="yiyi-st" id="yiyi-442">&#x6B63;&#x5982;0.9&#x6CE8;&#x91CA;&#x4E2D;&#x6307;&#x51FA;&#x7684;&#x90A3;&#x6837;&#xFF0C;&#x53F3;&#x5D4C;&#x5957;&#x8FDE;&#x63A5;&#x6709;&#x56F0;&#x96BE;&#x7684;&#x552F;&#x4E00;&#x6570;&#x636E;&#x5E93;&#x540E;&#x7AEF;&#x662F;SQLite&#xFF1B;&#x4ECE;0.9&#x7248;&#x5F00;&#x59CB;&#xFF0C;SQLAlchemy&#x5C06;&#x53F3;&#x5D4C;&#x5957;&#x8FDE;&#x63A5;&#x8F6C;&#x6362;&#x4E3A;&#x5B50;&#x67E5;&#x8BE2;&#xFF0C;&#x4F5C;&#x4E3A;SQLite&#x4E0A;&#x7684;&#x8FDE;&#x63A5;&#x76EE;&#x6807;&#x3002;</span></p><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-443">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-444"><a class="reference internal" href="migration_09.html#feature-2976"><span>Right-nested inner joins available in joined eager loads</span></a>  -  0.9.4&#x4E2D;&#x4ECB;&#x7ECD;&#x7684;&#x7279;&#x5F81;&#x63CF;&#x8FF0;&#x3002;</span></p></div><p><span class="yiyi-st" id="yiyi-445"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3008">&#xFF03;3008  T0&gt;</a></span></p></div><div class="section" id="subqueries-no-longer-applied-to-uselist-false-joined-eager-loads"><h3><span class="yiyi-st" id="yiyi-446">&#x5B50;&#x67E5;&#x8BE2;&#x4E0D;&#x518D;&#x5E94;&#x7528;&#x4E8E;&#x4F7F;&#x7528;list = False&#x52A0;&#x5165;&#x7684;&#x9884;&#x8F7D;<a class="headerlink" href="#subqueries-no-longer-applied-to-uselist-false-joined-eager-loads" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-447">&#x7ED9;&#x5B9A;&#x5982;&#x4E0B;&#x6240;&#x793A;&#x7684;&#x52A0;&#x5165;&#x7684;&#x70ED;&#x5207;&#x52A0;&#x8F7D;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;a&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="n">uselist</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;b&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">a_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;a.id&apos;</span><span class="p">))</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">joinedload</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">b</span><span class="p">))</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-448">SQLAlchemy considers the relationship <code class="docutils literal"><span class="pre">A.b</span></code> to be a &#x201C;one to many, loaded as a single value&#x201D;, which is essentially a &#x201C;one to one&#x201D; relationship. </span><span class="yiyi-st" id="yiyi-449">&#x4F46;&#x662F;&#xFF0C;&#x52A0;&#x5165;&#x7684;&#x9884;&#x52A0;&#x8F7D;&#x4E00;&#x76F4;&#x5C06;&#x4E0A;&#x8FF0;&#x60C5;&#x51B5;&#x89C6;&#x4E3A;&#x4E3B;&#x67E5;&#x8BE2;&#x9700;&#x8981;&#x4F4D;&#x4E8E;&#x5B50;&#x67E5;&#x8BE2;&#x4E2D;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x6B63;&#x5982;&#x901A;&#x5E38;&#x5728;&#x4E3B;&#x67E5;&#x8BE2;&#x5E94;&#x7528;LIMIT&#x65F6;&#x6536;&#x96C6;B&#x5BF9;&#x8C61;&#x6240;&#x9700;&#x7684;&#x60C5;&#x51B5;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT anon_1.a_id AS anon_1_a_id, b_1.id AS b_1_id, b_1.a_id AS b_1_a_id
FROM (SELECT a.id AS a_id
FROM a LIMIT :param_1) AS anon_1
LEFT OUTER JOIN b AS b_1 ON anon_1.a_id = b_1.a_id</pre></div></div><p><span class="yiyi-st" id="yiyi-450">&#x7136;&#x800C;&#xFF0C;&#x7531;&#x4E8E;&#x5185;&#x90E8;&#x67E5;&#x8BE2;&#x7684;&#x5230;&#x5916;&#x5C42;&#x4E00;&#x4E2A;&#x4E0A;&#x7684;&#x5173;&#x7CFB;&#x662F;&#x81F3;&#x591A;&#x53EA;&#x6709;&#x4E00;&#x6392;&#x5728;<code class="docutils literal"><span class="pre">uselist=False</span></code></span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT a.id AS a_id, b_1.id AS b_1_id, b_1.a_id AS b_1_a_id
FROM a LEFT OUTER JOIN b AS b_1 ON a.id = b_1.a_id
LIMIT :param_1</pre></div></div><p><span class="yiyi-st" id="yiyi-451">&#x5728;LEFT OUTER JOIN&#x8FD4;&#x56DE;&#x591A;&#x4E8E;&#x4E00;&#x884C;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;ORM&#x603B;&#x662F;&#x5728;&#x8FD9;&#x91CC;&#x53D1;&#x51FA;&#x8B66;&#x544A;&#x5E76;&#x5FFD;&#x7565;<code class="docutils literal"><span class="pre">uselist=False</span></code>&#x7684;&#x9644;&#x52A0;&#x7ED3;&#x679C;&#xFF0C;&#x56E0;&#x6B64;&#x5728;&#x8BE5;&#x9519;&#x8BEF;&#x60C5;&#x51B5;&#x4E0B;&#x7684;&#x7ED3;&#x679C;&#x4E0D;&#x5E94;&#x6539;&#x53D8;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-452"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3249">&#xFF03;3249  T0&gt;</a></span></p></div><div class="section" id="query-update-query-delete-raises-if-used-with-join-select-from-from-self"><h3><span class="yiyi-st" id="yiyi-453">&#x5982;&#x679C;&#x4E0E;join()&#xFF0C;select_from()&#xFF0C;from_self()&#x4E00;&#x8D77;&#x4F7F;&#x7528;&#xFF0C;query.update()/ query.delete()&#x4F1A;&#x5F15;&#x53D1;<a class="headerlink" href="#query-update-query-delete-raises-if-used-with-join-select-from-from-self" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-454">A warning is emitted in SQLAlchemy 0.9.10 (not yet released as of June 9, 2015) when the <a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query.update" title="sqlalchemy.orm.query.Query.update"><code class="xref py py-meth docutils literal"><span class="pre">Query.update()</span></code></a> or <a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query.delete" title="sqlalchemy.orm.query.Query.delete"><code class="xref py py-meth docutils literal"><span class="pre">Query.delete()</span></code></a> methods are invoked against a query which has also called upon <a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query.join" title="sqlalchemy.orm.query.Query.join"><code class="xref py py-meth docutils literal"><span class="pre">Query.join()</span></code></a>, <a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query.outerjoin" title="sqlalchemy.orm.query.Query.outerjoin"><code class="xref py py-meth docutils literal"><span class="pre">Query.outerjoin()</span></code></a>, <a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query.select_from" title="sqlalchemy.orm.query.Query.select_from"><code class="xref py py-meth docutils literal"><span class="pre">Query.select_from()</span></code></a> or <a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query.from_self" title="sqlalchemy.orm.query.Query.from_self"><code class="xref py py-meth docutils literal"><span class="pre">Query.from_self()</span></code></a>. </span><span class="yiyi-st" id="yiyi-455">&#x8FD9;&#x4E9B;&#x4E0D;&#x652F;&#x6301;&#x7684;&#x7528;&#x4F8B;&#x5728;0.9&#x7CFB;&#x5217;&#x4E2D;&#x9ED8;&#x9ED8;&#x65E0;&#x6548;&#xFF0C;&#x76F4;&#x5230;&#x53D1;&#x51FA;&#x8B66;&#x544A;&#x4E3A;&#x6B62;&#x3002;</span><span class="yiyi-st" id="yiyi-456">&#x5728;1.0&#x4E2D;&#xFF0C;&#x8FD9;&#x4E9B;&#x60C5;&#x51B5;&#x5F15;&#x53D1;&#x4E86;&#x4E00;&#x4E2A;&#x4F8B;&#x5916;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-457"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3349">&#xFF03;3349  T0&gt;</a></span></p></div><div class="section" id="query-update-with-synchronize-session-evaluate-raises-on-multi-table-update"><h3><span class="yiyi-st" id="yiyi-458">query.update()with <code class="docutils literal"><span class="pre">synchronize_session=&apos;evaluate&apos;</span></code>&#x5F15;&#x53D1;&#x591A;&#x8868;&#x66F4;&#x65B0;<a class="headerlink" href="#query-update-with-synchronize-session-evaluate-raises-on-multi-table-update" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-459"><a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query.update" title="sqlalchemy.orm.query.Query.update"><code class="xref py py-meth docutils literal"><span class="pre">Query.update()</span></code></a>&#x7684;&#x201C;&#x8BC4;&#x4F30;&#x7A0B;&#x5E8F;&#x201D;&#x4E0D;&#x9002;&#x7528;&#x4E8E;&#x591A;&#x8868;&#x66F4;&#x65B0;&#xFF0C;&#x9700;&#x8981;&#x8BBE;&#x7F6E;&#x4E3A;<code class="docutils literal"><span class="pre">synchronize_session=False</span></code>&#x6216;<code class="docutils literal"><span class="pre">synchronize_session=&apos;fetch&apos;</span></code>&#x3002;</span><span class="yiyi-st" id="yiyi-460">&#x65B0;&#x7684;&#x884C;&#x4E3A;&#x662F;&#xFF0C;&#x73B0;&#x5728;&#x5F15;&#x53D1;&#x4E86;&#x4E00;&#x4E2A;&#x660E;&#x786E;&#x7684;&#x5F02;&#x5E38;&#xFF0C;&#x5E76;&#x5E26;&#x6709;&#x4E00;&#x6761;&#x6D88;&#x606F;&#x6765;&#x66F4;&#x6539;&#x540C;&#x6B65;&#x8BBE;&#x7F6E;&#x3002;</span><span class="yiyi-st" id="yiyi-461">&#x8FD9;&#x662F;&#x4ECE;0.9.7&#x53D1;&#x51FA;&#x7684;&#x8B66;&#x544A;&#x5347;&#x7EA7;&#x800C;&#x6765;&#x7684;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-462"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3117">&#xFF03;3117  T0&gt;</a></span></p></div><div class="section" id="resurrect-event-has-been-removed"><h3><span class="yiyi-st" id="yiyi-463">&#x590D;&#x6D3B;&#x4E8B;&#x4EF6;&#x5DF2;&#x88AB;&#x5220;&#x9664;<a class="headerlink" href="#resurrect-event-has-been-removed" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-464">&#x201C;&#x590D;&#x6D3B;&#x201D;ORM&#x4E8B;&#x4EF6;&#x5DF2;&#x88AB;&#x5B8C;&#x5168;&#x5220;&#x9664;&#x3002;</span><span class="yiyi-st" id="yiyi-465">&#x4ECE;0.8&#x7248;&#x672C;&#x5F00;&#x59CB;&#xFF0C;&#x8BE5;&#x4E8B;&#x4EF6;&#x4E0D;&#x518D;&#x5177;&#x6709;&#x4EFB;&#x4F55;&#x529F;&#x80FD;&#xFF0C;&#x4ECE;&#x5DE5;&#x4F5C;&#x5355;&#x5143;&#x4E2D;&#x5220;&#x9664;&#x65E7;&#x7684;&#x201C;&#x53EF;&#x53D8;&#x201D;&#x7CFB;&#x7EDF;&#x3002;</span></p></div><div class="section" id="change-to-single-table-inheritance-criteria-when-using-from-self-count"><h3><span class="yiyi-st" id="yiyi-466">&#x4F7F;&#x7528;from_self()&#xFF0C;count()<a class="headerlink" href="#change-to-single-table-inheritance-criteria-when-using-from-self-count" title="Permalink to this headline">&#x65F6;&#xFF0C;&#x66F4;&#x6539;&#x4E3A;&#x5355;&#x8868;&#x7EE7;&#x627F;&#x6761;&#x4EF6;</a></span></h3><p><span class="yiyi-st" id="yiyi-467">&#x7ED9;&#x5B9A;&#x4E00;&#x4E2A;&#x5355;&#x8868;&#x7EE7;&#x627F;&#x6620;&#x5C04;&#xFF0C;&#x5982;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Widget</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__table__</span> <span class="o">=</span> <span class="s1">&apos;widget_table&apos;</span>

<span class="k">class</span> <span class="nc">FooWidget</span><span class="p">(</span><span class="n">Widget</span><span class="p">):</span>
    <span class="k">pass</span></pre></div></div><p><span class="yiyi-st" id="yiyi-468">&#x5BF9;&#x5B50;&#x7C7B;&#x4F7F;&#x7528;<a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query.from_self" title="sqlalchemy.orm.query.Query.from_self"><code class="xref py py-meth docutils literal"><span class="pre">Query.from_self()</span></code></a>&#x6216;<a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query.count" title="sqlalchemy.orm.query.Query.count"><code class="xref py py-meth docutils literal"><span class="pre">Query.count()</span></code></a>&#x4F1A;&#x4EA7;&#x751F;&#x5B50;&#x67E5;&#x8BE2;&#xFF0C;&#x4F46;&#x662F;&#x5C06;&#x5B50;&#x7C7B;&#x578B;&#x7684;&#x201C;WHERE&#x201D;&#x6807;&#x51C6;&#x6DFB;&#x52A0;&#x5230;&#x5916;&#x90E8;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">sess</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">FooWidget</span><span class="p">)</span><span class="o">.</span><span class="n">from_self</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></pre></div></div><p><span class="yiyi-st" id="yiyi-469">&#x6E32;&#x67D3;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT
    anon_1.widgets_id AS anon_1_widgets_id,
    anon_1.widgets_type AS anon_1_widgets_type
FROM (SELECT widgets.id AS widgets_id, widgets.type AS widgets_type,
FROM widgets) AS anon_1
WHERE anon_1.widgets_type IN (?)</pre></div></div><p><span class="yiyi-st" id="yiyi-470">&#x95EE;&#x9898;&#x5728;&#x4E8E;&#xFF0C;&#x5982;&#x679C;&#x5185;&#x90E8;&#x67E5;&#x8BE2;&#x6CA1;&#x6709;&#x6307;&#x5B9A;&#x6240;&#x6709;&#x5217;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x4E0D;&#x80FD;&#x5728;&#x5916;&#x90E8;&#x6DFB;&#x52A0;WHERE&#x5B50;&#x53E5;&#xFF08;&#x5B83;&#x5B9E;&#x9645;&#x4E0A;&#x4F1A;&#x5C1D;&#x8BD5;&#x5E76;&#x4EA7;&#x751F;&#x9519;&#x8BEF;&#x7684;&#x67E5;&#x8BE2;&#xFF09;&#x3002;</span><span class="yiyi-st" id="yiyi-471">&#x8FD9;&#x4E2A;&#x51B3;&#x5B9A;&#x663E;&#x7136;&#x56DE;&#x5230;&#x4E86;0.6.5&#xFF0C;&#x6CE8;&#x91CA;&#x201C;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x5BF9;&#x6B64;&#x505A;&#x51FA;&#x66F4;&#x591A;&#x8C03;&#x6574;&#x201D;&#x3002;</span><span class="yiyi-st" id="yiyi-472">&#x90A3;&#x4E48;&#xFF0C;&#x8FD9;&#x4E9B;&#x8C03;&#x6574;&#x5DF2;&#x7ECF;&#x5230;&#x6765;&#xFF01;</span><span class="yiyi-st" id="yiyi-473">&#x6240;&#x4EE5;&#x73B0;&#x5728;&#x4E0A;&#x9762;&#x7684;&#x67E5;&#x8BE2;&#x4F1A;&#x5448;&#x73B0;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT
    anon_1.widgets_id AS anon_1_widgets_id,
    anon_1.widgets_type AS anon_1_widgets_type
FROM (SELECT widgets.id AS widgets_id, widgets.type AS widgets_type,
FROM widgets
WHERE widgets.type IN (?)) AS anon_1</pre></div></div><p><span class="yiyi-st" id="yiyi-474">&#x6240;&#x4EE5;&#x90A3;&#x4E9B;&#x4E0D;&#x5305;&#x542B;&#x201C;type&#x201D;&#x7684;&#x67E5;&#x8BE2;&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x5DE5;&#x4F5C;&#xFF01;</span><span class="yiyi-st" id="yiyi-475">:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">sess</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">FooWidget</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span></pre></div></div><p><span class="yiyi-st" id="yiyi-476">&#x5448;&#x73B0;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT count(*) AS count_1
FROM (SELECT widgets.id AS widgets_id
FROM widgets
WHERE widgets.type IN (?)) AS anon_1</pre></div></div><p><span class="yiyi-st" id="yiyi-477"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3177">&#xFF03;3177  T0&gt;</a></span></p></div><div class="section" id="single-table-inheritance-criteria-added-to-all-on-clauses-unconditionally"><h3><span class="yiyi-st" id="yiyi-478">&#x5355;&#x8868;&#x7EE7;&#x627F;&#x6761;&#x4EF6;&#x65E0;&#x6761;&#x4EF6;&#x5730;&#x6DFB;&#x52A0;&#x5230;&#x6240;&#x6709;ON&#x5B50;&#x53E5;<a class="headerlink" href="#single-table-inheritance-criteria-added-to-all-on-clauses-unconditionally" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-479">&#x5F53;&#x8FDE;&#x63A5;&#x5230;&#x5355;&#x8868;&#x7EE7;&#x627F;&#x5B50;&#x7C7B;&#x76EE;&#x6807;&#x65F6;&#xFF0C;ORM&#x5728;&#x52A0;&#x5165;&#x5173;&#x7CFB;&#x65F6;&#x603B;&#x662F;&#x6DFB;&#x52A0;&#x201C;&#x5355;&#x8868;&#x6807;&#x51C6;&#x201D;&#x3002;</span><span class="yiyi-st" id="yiyi-480">&#x7ED9;&#x5B9A;&#x6620;&#x5C04;&#x4E3A;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Widget</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;widget&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>
    <span class="n">related_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&apos;related.id&apos;</span><span class="p">))</span>
    <span class="n">related</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Related&quot;</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="s2">&quot;widget&quot;</span><span class="p">)</span>
    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&apos;polymorphic_on&apos;</span><span class="p">:</span> <span class="nb">type</span><span class="p">}</span>


<span class="k">class</span> <span class="nc">FooWidget</span><span class="p">(</span><span class="n">Widget</span><span class="p">):</span>
    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&apos;polymorphic_identity&apos;</span><span class="p">:</span> <span class="s1">&apos;foo&apos;</span><span class="p">}</span>


<span class="k">class</span> <span class="nc">Related</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&apos;related&apos;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-481">&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x4EE5;&#x6765;&#xFF0C;&#x5173;&#x7CFB;&#x7684;&#x52A0;&#x5165;&#x4F1A;&#x4E3A;&#x8BE5;&#x7C7B;&#x578B;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x201C;&#x5355;&#x4E00;&#x7EE7;&#x627F;&#x201D;&#x5B50;&#x53E5;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Related</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">FooWidget</span><span class="p">,</span> <span class="n">Related</span><span class="o">.</span><span class="n">widget</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></pre></div></div><p><span class="yiyi-st" id="yiyi-482">SQL&#x8F93;&#x51FA;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT related.id AS related_id
FROM related JOIN widget ON related.id = widget.related_id AND widget.type IN (:type_1)</pre></div></div><p><span class="yiyi-st" id="yiyi-483">Above, because we joined to a subclass <code class="docutils literal"><span class="pre">FooWidget</span></code>, <a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query.join" title="sqlalchemy.orm.query.Query.join"><code class="xref py py-meth docutils literal"><span class="pre">Query.join()</span></code></a> knew to add the <code class="docutils literal"><span class="pre">AND</span> <span class="pre">widget.type</span> <span class="pre">IN</span> <span class="pre">(&apos;foo&apos;)</span></code> criteria to the ON clause.</span></p><p><span class="yiyi-st" id="yiyi-484">&#x8FD9;&#x91CC;&#x7684;&#x53D8;&#x5316;&#x662F;&#xFF0C;<code class="docutils literal"><span class="pre">AND</span> <span class="pre">widget.type</span> <span class="pre">IN()</span></code>&#x6761;&#x4EF6;&#x73B0;&#x5728;&#x9644;&#x52A0;&#x5230;<em>&#x4EFB;&#x4F55;</em> ON&#x5B50;&#x53E5;&#xFF0C;&#x4E0D;&#x53EA;&#x662F;&#x4ECE;&#x5173;&#x7CFB;&#x4E2D;&#x4EA7;&#x751F;&#x7684;&#x90A3;&#x4E9B;&#xFF0C;&#x5305;&#x62EC;&#x4E00;&#x4E2A;&#x660E;&#x786E;&#x8BF4;&#x660E;&#x7684;&#x5173;&#x7CFB;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># ON clause will now render as</span>
<span class="c1"># related.id = widget.related_id AND widget.type IN (:type_1)</span>
<span class="n">s</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Related</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">FooWidget</span><span class="p">,</span> <span class="n">FooWidget</span><span class="o">.</span><span class="n">related_id</span> <span class="o">==</span> <span class="n">Related</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></pre></div></div><p><span class="yiyi-st" id="yiyi-485">&#x5F53;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x7C7B;&#x578B;&#x7684;ON&#x5B50;&#x53E5;&#x88AB;&#x58F0;&#x660E;&#x65F6;&#xFF0C;&#x4EE5;&#x53CA;&#x201C;&#x9690;&#x5F0F;&#x201D;&#x8FDE;&#x63A5;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># ON clause will now render as</span>
<span class="c1"># related.id = widget.related_id AND widget.type IN (:type_1)</span>
<span class="n">s</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Related</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">FooWidget</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></pre></div></div><p><span class="yiyi-st" id="yiyi-486">&#x4EE5;&#x524D;&#xFF0C;&#x8FD9;&#x4E9B;ON&#x5B50;&#x53E5;&#x4E0D;&#x5305;&#x542B;&#x5355;&#x7EE7;&#x627F;&#x6761;&#x4EF6;&#x3002;</span><span class="yiyi-st" id="yiyi-487">&#x5DF2;&#x7ECF;&#x6DFB;&#x52A0;&#x6B64;&#x6807;&#x51C6;&#x4EE5;&#x89E3;&#x51B3;&#x6B64;&#x95EE;&#x9898;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5C06;&#x5E0C;&#x671B;&#x5220;&#x9664;&#x5176;&#x663E;&#x5F0F;&#x4F7F;&#x7528;&#xFF0C;&#x4F46;&#x5982;&#x679C;&#x6807;&#x51C6;&#x5728;&#x6B64;&#x671F;&#x95F4;&#x53D1;&#x751F;&#x4E24;&#x6B21;&#xFF0C;&#x5B83;&#x5E94;&#x8BE5;&#x7EE7;&#x7EED;&#x6B63;&#x5E38;&#x5DE5;&#x4F5C;&#x3002;</span></p><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-488">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-489"><a class="reference internal" href="#bug-3233"><span>Changes and fixes in handling of duplicate join targets</span></a></span></p></div><p><span class="yiyi-st" id="yiyi-490"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3222">&#xFF03;3222  T0&gt;</a></span></p></div></div><div class="section" id="key-behavioral-changes-core"><h2><span class="yiyi-st" id="yiyi-491">&#x5173;&#x952E;&#x884C;&#x4E3A;&#x6539;&#x53D8; - &#x6838;&#x5FC3;<a class="headerlink" href="#key-behavioral-changes-core" title="Permalink to this headline">&#xB6;</a></span></h2><div class="section" id="warnings-emitted-when-coercing-full-sql-fragments-into-text"><h3><span class="yiyi-st" id="yiyi-492">&#x5C06;&#x5B8C;&#x6574;&#x7684;SQL&#x7247;&#x6BB5;&#x5F3A;&#x5236;&#x8F6C;&#x6362;&#x4E3A;text()<a class="headerlink" href="#warnings-emitted-when-coercing-full-sql-fragments-into-text" title="Permalink to this headline">&#xB6;</a>&#x65F6;&#x53D1;&#x51FA;&#x8B66;&#x544A;</span></h3><p><span class="yiyi-st" id="yiyi-493">&#x81EA;&#x4ECE;SQLAlchemy&#x5F00;&#x59CB;&#x4EE5;&#x6765;&#xFF0C;&#x4E00;&#x76F4;&#x5F3A;&#x8C03;&#x4E0D;&#x59A8;&#x788D;&#x7EAF;&#x6587;&#x672C;&#x7684;&#x4F7F;&#x7528;&#x3002;</span><span class="yiyi-st" id="yiyi-494">The Core and ORM expression systems were intended to allow any number of points at which the user can just use plain text SQL expressions, not just in the sense that you can send a full SQL string to <a class="reference internal" href="core_connections.html#sqlalchemy.engine.Connection.execute" title="sqlalchemy.engine.Connection.execute"><code class="xref py py-meth docutils literal"><span class="pre">Connection.execute()</span></code></a>, but that you can send strings with SQL expressions into many functions, such as <a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.Select.where" title="sqlalchemy.sql.expression.Select.where"><code class="xref py py-meth docutils literal"><span class="pre">Select.where()</span></code></a>, <a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query.filter" title="sqlalchemy.orm.query.Query.filter"><code class="xref py py-meth docutils literal"><span class="pre">Query.filter()</span></code></a>, and <a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.Select.order_by" title="sqlalchemy.sql.expression.Select.order_by"><code class="xref py py-meth docutils literal"><span class="pre">Select.order_by()</span></code></a>.</span></p><p><span class="yiyi-st" id="yiyi-495">Note that by &#x201C;SQL expressions&#x201D; we mean a <strong>full fragment of a SQL string</strong>, such as:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># the argument sent to where() is a full SQL expression</span>
<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">sometable</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;somecolumn = &apos;value&apos;&quot;</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-496">and we are <strong>not talking about string arguments</strong>, that is, the normal behavior of passing string values that become parameterized:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># This is a normal Core expression with a string argument -</span>
<span class="c1"># we aren&apos;t talking about this!!</span>
<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">sometable</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">sometable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">somecolumn</span> <span class="o">==</span> <span class="s1">&apos;value&apos;</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-497">Core&#x6559;&#x7A0B;&#x4E00;&#x76F4;&#x4EE5;&#x6765;&#x90FD;&#x4F7F;&#x7528;&#x8FD9;&#x79CD;&#x6280;&#x672F;&#xFF0C;&#x4F7F;&#x7528;<a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal"><span class="pre">select()</span></code></a>&#x6784;&#x9020;&#xFF0C;&#x5176;&#x4E2D;&#x51E0;&#x4E4E;&#x6240;&#x6709;&#x7EC4;&#x4EF6;&#x90FD;&#x88AB;&#x6307;&#x5B9A;&#x4E3A;&#x76F4;&#x7EBF;&#x3002;</span><span class="yiyi-st" id="yiyi-498">&#x7136;&#x800C;&#xFF0C;&#x5C3D;&#x7BA1;&#x8FD9;&#x79CD;&#x957F;&#x671F;&#x5B58;&#x5728;&#x7684;&#x884C;&#x4E3A;&#x548C;&#x793A;&#x4F8B;&#xFF0C;&#x7528;&#x6237;&#x663E;&#x7136;&#x5BF9;&#x8FD9;&#x79CD;&#x884C;&#x4E3A;&#x5B58;&#x5728;&#x611F;&#x5230;&#x60CA;&#x8BB6;&#xFF0C;&#x5E76;&#x4E14;&#x5728;&#x8BE2;&#x95EE;&#x793E;&#x533A;&#x65F6;&#xFF0C;&#x6211;&#x65E0;&#x6CD5;&#x627E;&#x5230;&#x4EFB;&#x4F55;&#x5B9E;&#x9645;&#x4E0A;<em>&#x6CA1;&#x6709;&#x611F;&#x5230;&#x60CA;&#x8BB6;&#x7684;&#x7528;&#x6237;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x5C06;&#x5B8C;&#x6574;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x53D1;&#x9001;&#x5230;&#x50CF;<a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query.filter" title="sqlalchemy.orm.query.Query.filter"><code class="xref py py-meth docutils literal"><span class="pre">Query.filter()</span></code></a>&#x8FD9;&#x6837;&#x7684;&#x65B9;&#x6CD5;&#x4E2D;&#x3002;</em></span></p><p><span class="yiyi-st" id="yiyi-499">&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x7684;&#x6539;&#x53D8;&#x662F;&#x9F13;&#x52B1;&#x7528;&#x6237;&#x5728;&#x7F16;&#x5199;&#x90E8;&#x5206;&#x6216;&#x5168;&#x90E8;&#x7531;&#x6587;&#x672C;&#x7247;&#x6BB5;&#x7EC4;&#x6210;&#x7684;SQL&#x65F6;&#x9650;&#x5B9A;&#x6587;&#x672C;&#x5B57;&#x7B26;&#x4E32;&#x3002;</span><span class="yiyi-st" id="yiyi-500">&#x5728;&#x64B0;&#x5199;&#x9009;&#x62E9;&#x65F6;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;a = b&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">select_from</span><span class="p">(</span><span class="s2">&quot;sometable&quot;</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-501">&#x58F0;&#x660E;&#x662F;&#x6B63;&#x5E38;&#x5EFA;&#x7ACB;&#x7684;&#xFF0C;&#x4E0E;&#x4EE5;&#x524D;&#x4E00;&#x6837;&#x5F3A;&#x5236;&#x6267;&#x884C;&#x3002;</span><span class="yiyi-st" id="yiyi-502">&#x4F46;&#x662F;&#xFF0C;&#x60A8;&#x4F1A;&#x770B;&#x5230;&#x4EE5;&#x4E0B;&#x8B66;&#x544A;&#x6D88;&#x606F;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SAWarning: Textual column expression &apos;a&apos; should be explicitly declared
with text(&apos;a&apos;), or use column(&apos;a&apos;) for more specificity
(this warning may be suppressed after 10 occurrences)

SAWarning: Textual column expression &apos;b&apos; should be explicitly declared
with text(&apos;b&apos;), or use column(&apos;b&apos;) for more specificity
(this warning may be suppressed after 10 occurrences)

SAWarning: Textual SQL expression &apos;a = b&apos; should be explicitly declared
as text(&apos;a = b&apos;) (this warning may be suppressed after 10 occurrences)

SAWarning: Textual SQL FROM expression &apos;sometable&apos; should be explicitly
declared as text(&apos;sometable&apos;), or use table(&apos;sometable&apos;) for more
specificity (this warning may be suppressed after 10 occurrences)</pre></div></div><p><span class="yiyi-st" id="yiyi-503">&#x8FD9;&#x4E9B;&#x8B66;&#x544A;&#x8BD5;&#x56FE;&#x901A;&#x8FC7;&#x663E;&#x793A;&#x53C2;&#x6570;&#x4EE5;&#x53CA;&#x63A5;&#x6536;&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x4F4D;&#x7F6E;&#x6765;&#x51C6;&#x786E;&#x663E;&#x793A;&#x95EE;&#x9898;&#x7684;&#x51FA;&#x5904;&#x3002;</span><span class="yiyi-st" id="yiyi-504">&#x8B66;&#x544A;&#x4F7F;&#x7528;<a class="reference internal" href="#feature-3178"><span>Session.get_bind() handles a wider variety of inheritance scenarios</span></a>&#xFF0C;&#x4EE5;&#x4FBF;&#x53EF;&#x4EE5;&#x5B89;&#x5168;&#x5730;&#x53D1;&#x51FA;&#x53C2;&#x6570;&#x5316;&#x8B66;&#x544A;&#x800C;&#x4E0D;&#x4F1A;&#x8017;&#x5C3D;&#x5185;&#x5B58;&#xFF0C;&#x5E76;&#x4E14;&#x5982;&#x679C;&#x5E0C;&#x671B;&#x8B66;&#x544A;&#x662F;&#x4F8B;&#x5916;&#x60C5;&#x51B5;&#xFF0C;&#x5E94;&#x8BE5;&#x4F7F;&#x7528;<a class="reference external" href="https://docs.python.org/2/library/warnings.html">Python Warnings Filter</a>&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>   <span class="c1"># all warnings raise an exception</span></pre></div></div><p><span class="yiyi-st" id="yiyi-505">&#x9274;&#x4E8E;&#x4E0A;&#x8FF0;&#x8B66;&#x544A;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x58F0;&#x660E;&#x5DE5;&#x4F5C;&#x5F97;&#x5F88;&#x597D;&#xFF0C;&#x4F46;&#x4E3A;&#x4E86;&#x6446;&#x8131;&#x8B66;&#x544A;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x91CD;&#x5199;&#x6211;&#x4EEC;&#x7684;&#x58F0;&#x660E;&#x5982;&#x4E0B;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">select</span><span class="p">,</span> <span class="n">text</span>
<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span>
        <span class="n">text</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">),</span>
        <span class="n">text</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">)</span>
    <span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">text</span><span class="p">(</span><span class="s2">&quot;a = b&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">select_from</span><span class="p">(</span><span class="n">text</span><span class="p">(</span><span class="s2">&quot;sometable&quot;</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-506">&#x6B63;&#x5982;&#x8B66;&#x544A;&#x6240;&#x6697;&#x793A;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.column" title="sqlalchemy.sql.expression.column"><code class="xref py py-func docutils literal"><span class="pre">column()</span></code></a>&#x548C;<a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.table" title="sqlalchemy.sql.expression.table"><code class="xref py py-func docutils literal"><span class="pre">table()</span></code></a>&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x66F4;&#x5177;&#x4F53;&#x5730;&#x8BF4;&#x660E;&#x6587;&#x672C;&#x3002;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">select</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">table</span>

<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">column</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">),</span> <span class="n">column</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">)])</span><span class="o">.</span>\
    <span class="n">where</span><span class="p">(</span><span class="n">text</span><span class="p">(</span><span class="s2">&quot;a = b&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">select_from</span><span class="p">(</span><span class="n">table</span><span class="p">(</span><span class="s2">&quot;sometable&quot;</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-507">&#x8FD8;&#x8981;&#x6CE8;&#x610F;&#xFF0C;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x4ECE;&#x201C;sqlalchemy&#x201D;&#x4E2D;&#x5BFC;&#x5165;<a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.table" title="sqlalchemy.sql.expression.table"><code class="xref py py-func docutils literal"><span class="pre">table()</span></code></a>&#x548C;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.column" title="sqlalchemy.sql.expression.column"><code class="xref py py-func docutils literal"><span class="pre">column()</span></code></a>&#xFF0C;&#x800C;&#x4E0D;&#x4F7F;&#x7528;&#x201C;sql&#x201D;&#x90E8;&#x5206;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-508">The behavior here applies to <a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal"><span class="pre">select()</span></code></a> as well as to key methods on <a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query" title="sqlalchemy.orm.query.Query"><code class="xref py py-class docutils literal"><span class="pre">Query</span></code></a>, including <a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query.filter" title="sqlalchemy.orm.query.Query.filter"><code class="xref py py-meth docutils literal"><span class="pre">Query.filter()</span></code></a>, <a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query.from_statement" title="sqlalchemy.orm.query.Query.from_statement"><code class="xref py py-meth docutils literal"><span class="pre">Query.from_statement()</span></code></a> and <a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query.having" title="sqlalchemy.orm.query.Query.having"><code class="xref py py-meth docutils literal"><span class="pre">Query.having()</span></code></a>.</span></p><div class="section" id="order-by-and-group-by-are-special-cases"><h4><span class="yiyi-st" id="yiyi-509">ORDER BY&#x548C;GROUP BY&#x662F;&#x7279;&#x6B8A;&#x60C5;&#x51B5;<a class="headerlink" href="#order-by-and-group-by-are-special-cases" title="Permalink to this headline">&#xB6;</a></span></h4><p><span class="yiyi-st" id="yiyi-510">&#x6709;&#x4E00;&#x79CD;&#x60C5;&#x51B5;&#x4F7F;&#x7528;&#x5B57;&#x7B26;&#x4E32;&#x5177;&#x6709;&#x7279;&#x6B8A;&#x542B;&#x4E49;&#xFF0C;&#x5E76;&#x4E14;&#x4F5C;&#x4E3A;&#x6B64;&#x66F4;&#x6539;&#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x6211;&#x4EEC;&#x5DF2;&#x589E;&#x5F3A;&#x5176;&#x529F;&#x80FD;&#x3002;</span><span class="yiyi-st" id="yiyi-511">&#x5F53;&#x6211;&#x4EEC;&#x6709;&#x4E00;&#x4E2A;&#x5F15;&#x7528;&#x67D0;&#x4E2A;&#x5217;&#x540D;&#x6216;&#x547D;&#x540D;&#x6807;&#x7B7E;&#x7684;<a class="reference internal" href="core_selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal"><span class="pre">select()</span></code></a>&#x6216;<a class="reference internal" href="orm_query.html#sqlalchemy.orm.query.Query" title="sqlalchemy.orm.query.Query"><code class="xref py py-class docutils literal"><span class="pre">Query</span></code></a>&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x80FD;&#x60F3;&#x8981;GROUP BY&#x548C;/&#x6216;ORDER BY&#x5DF2;&#x77E5;&#x5217;&#x6216;&#x6807;&#x7B7E;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span>
    <span class="n">user</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
    <span class="n">func</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="s2">&quot;id_count&quot;</span><span class="p">)</span>
<span class="p">])</span><span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;id_count&quot;</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-512">&#x5728;&#x4E0A;&#x9762;&#x7684;&#x8BED;&#x53E5;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x770B;&#x5230;&#x201C;ORDER BY id_count&#x201D;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x51FD;&#x6570;&#x7684;&#x91CD;&#x65B0;&#x58F0;&#x660E;&#x3002;</span><span class="yiyi-st" id="yiyi-513">The string argument given is actively matched to an entry in the columns clause during compilation, so the above statement would produce as we expect, without warnings (though note that the <code class="docutils literal"><span class="pre">&quot;name&quot;</span></code> expression has been resolved to <code class="docutils literal"><span class="pre">users.name</span></code>! </span><span class="yiyi-st" id="yiyi-514">&#xFF09;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SELECT users.name, count(users.id) AS id_count
FROM users GROUP BY users.name ORDER BY id_count</pre></div></div><p><span class="yiyi-st" id="yiyi-515">&#x4F46;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x5F15;&#x7528;&#x65E0;&#x6CD5;&#x627E;&#x5230;&#x7684;&#x540D;&#x79F0;&#xFF0C;&#x5219;&#x6211;&#x4EEC;&#x518D;&#x6B21;&#x6536;&#x5230;&#x8B66;&#x544A;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span>
        <span class="n">user</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="n">func</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="s2">&quot;id_count&quot;</span><span class="p">)</span>
    <span class="p">])</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;some_label&quot;</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-516">&#x8F93;&#x51FA;&#x7B26;&#x5408;&#x6211;&#x4EEC;&#x7684;&#x8BF4;&#x6CD5;&#xFF0C;&#x4F46;&#x5B83;&#x53C8;&#x4E00;&#x6B21;&#x8B66;&#x544A;&#x6211;&#x4EEC;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>SAWarning: Can&apos;t resolve label reference &apos;some_label&apos;; converting to
text() (this warning may be suppressed after 10 occurrences)

SELECT users.name, count(users.id) AS id_count
FROM users ORDER BY some_label</pre></div></div><p><span class="yiyi-st" id="yiyi-517">&#x4E0A;&#x8FF0;&#x884C;&#x4E3A;&#x9002;&#x7528;&#x4E8E;&#x6211;&#x4EEC;&#x53EF;&#x80FD;&#x60F3;&#x8981;&#x53C2;&#x8003;&#x6240;&#x8C13;&#x7684;&#x201C;&#x6807;&#x7B7E;&#x53C2;&#x8003;&#x201D;&#x7684;&#x6240;&#x6709;&#x5730;&#x65B9;&#xFF1B; ORDER BY&#x548C;GROUP BY&#xFF0C;&#x4F46;&#x4E5F;&#x5305;&#x542B;&#x5728;OVER&#x5B50;&#x53E5;&#x4E2D;&#xFF0C;&#x4EE5;&#x53CA;&#x5F15;&#x7528;&#x5217;&#x7684;DISTINCT ON&#x5B50;&#x53E5;&#xFF08;&#x4F8B;&#x5982;Postgresql&#x8BED;&#x6CD5;&#xFF09;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-518">&#x6211;&#x4EEC;&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.text" title="sqlalchemy.sql.expression.text"><code class="xref py py-func docutils literal"><span class="pre">text()</span></code></a>&#x4E3A;ORDER BY&#x6216;&#x5176;&#x4ED6;&#x8868;&#x8FBE;&#x5F0F;&#x6307;&#x5B9A;&#x4EFB;&#x610F;&#x8868;&#x8FBE;&#x5F0F;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">users</span><span class="p">])</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">text</span><span class="p">(</span><span class="s2">&quot;some special expression&quot;</span><span class="p">))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-519">&#x6574;&#x4E2A;&#x53D8;&#x5316;&#x7684;&#x7ED3;&#x679C;&#x662F;SQLAlchemy&#x73B0;&#x5728;&#x5E0C;&#x671B;&#x6211;&#x4EEC;&#x5728;&#x53D1;&#x9001;&#x5B57;&#x7B26;&#x4E32;&#x65F6;&#x544A;&#x8BC9;&#x5B83;&#x8BE5;&#x5B57;&#x7B26;&#x4E32;&#x663E;&#x5F0F;&#x4E3A;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.text" title="sqlalchemy.sql.expression.text"><code class="xref py py-func docutils literal"><span class="pre">text()</span></code></a>&#x6784;&#x9020;&#xFF0C;&#x6216;&#x8005;&#x5217;&#xFF0C;&#x8868;&#x7B49;&#xFF0C;&#x5E76;&#x4E14;if&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x5B83;&#x4F5C;&#x4E3A;&#x6807;&#x7B7E;&#x540D;&#x79F0;&#xFF0C;&#x6309;&#x7167;group by&#x6216;&#x5176;&#x4ED6;&#x8868;&#x8FBE;&#x5F0F;&#x8FDB;&#x884C;&#x6392;&#x5E8F;&#xFF0C;SQLAlchemy&#x9884;&#x671F;&#x5B57;&#x7B26;&#x4E32;&#x4F1A;&#x89E3;&#x6790;&#x4E3A;&#x5DF2;&#x77E5;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x5426;&#x5219;&#x5E94;&#x8BE5;&#x518D;&#x6B21;&#x4F7F;&#x7528;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.text" title="sqlalchemy.sql.expression.text"><code class="xref py py-func docutils literal"><span class="pre">text()</span></code></a>&#x6216;&#x7C7B;&#x4F3C;&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x9650;&#x5B9A;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-520"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2992">&#xFF03;2992  T0&gt;</a></span></p></div></div><div class="section" id="python-side-defaults-invoked-for-each-row-invidually-when-using-a-multivalued-insert"><h3><span class="yiyi-st" id="yiyi-521">&#x5728;&#x4F7F;&#x7528;&#x591A;&#x503C;&#x63D2;&#x5165;&#x65F6;&#xFF0C;&#x4E3A;&#x6BCF;&#x884C;&#x8C03;&#x7528;Python&#x65B9;&#x9ED8;&#x8BA4;&#x503C;<a class="headerlink" href="#python-side-defaults-invoked-for-each-row-invidually-when-using-a-multivalued-insert" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-522">&#x5F53;&#x4F7F;&#x7528;&#x591A;&#x503C;&#x7248;&#x672C;&#x7684;<a class="reference internal" href="core_dml.html#sqlalchemy.sql.expression.Insert.values" title="sqlalchemy.sql.expression.Insert.values"><code class="xref py py-meth docutils literal"><span class="pre">Insert.values()</span></code></a>&#x65F6;&#xFF0C;&#x652F;&#x6301;Python&#x7AEF;&#x5217;&#x7684;&#x9ED8;&#x8BA4;&#x8BBE;&#x7F6E;&#x57FA;&#x672C;&#x4E0A;&#x672A;&#x5B9E;&#x73B0;&#xFF0C;&#x5E76;&#x4E14;&#x53EA;&#x80FD;&#x5728;&#x7279;&#x5B9A;&#x60C5;&#x51B5;&#x4E0B;&#x201C;&#x5076;&#x7136;&#x201D;&#x5DE5;&#x4F5C;&#xFF0C;&#x5F53;&#x4F7F;&#x7528;&#x7684;&#x65B9;&#x8A00;&#x662F;&#x4F7F;&#x7528;&#x975E;&#x5B9A;&#x4F4D;&#xFF08;&#x4F8B;&#x5982;&#x547D;&#x540D;&#xFF09;&#x98CE;&#x683C;&#x7684;&#x7ED1;&#x5B9A;&#x53C2;&#x6570;&#xFF0C;&#x4EE5;&#x53CA;&#x4F55;&#x65F6;&#x4E0D;&#x9700;&#x8981;&#x4E3A;&#x6BCF;&#x4E00;&#x884C;&#x8C03;&#x7528;Python&#x7AEF;&#x53EF;&#x8C03;&#x7528;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-523">&#x8BE5;&#x529F;&#x80FD;&#x5DF2;&#x7ECF;&#x8FC7;&#x5927;&#x4FEE;&#xFF0C;&#x56E0;&#x6B64;&#x5176;&#x529F;&#x80FD;&#x4E0E;&#x201C;executemany&#x201D;&#x98CE;&#x683C;&#x7684;&#x8C03;&#x7528;&#x7C7B;&#x4F3C;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">itertools</span>

<span class="n">counter</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s1">&apos;my_table&apos;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;id&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">next</span><span class="p">(</span><span class="n">counter</span><span class="p">)),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;data&apos;</span><span class="p">,</span> <span class="n">String</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">insert</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">([</span>
    <span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="s2">&quot;d1&quot;</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="s2">&quot;d2&quot;</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="s2">&quot;d3&quot;</span><span class="p">},</span>
<span class="p">]))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-524">&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x5C06;&#x4F1A;&#x50CF;&#x9884;&#x671F;&#x7684;&#x90A3;&#x6837;&#x5206;&#x522B;&#x4E3A;&#x6BCF;&#x4E00;&#x884C;&#x8C03;&#x7528;<code class="docutils literal"><span class="pre">next(counter)</span></code>&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>INSERT INTO my_table (id, data) VALUES (?, ?), (?, ?), (?, ?)
(1, &apos;d1&apos;, 2, &apos;d2&apos;, 3, &apos;d3&apos;)</pre></div></div><p><span class="yiyi-st" id="yiyi-525">&#x4EE5;&#x524D;&#xFF0C;&#x4F4D;&#x7F6E;&#x65B9;&#x8A00;&#x4F1A;&#x5931;&#x8D25;&#xFF0C;&#x56E0;&#x4E3A;&#x4E0D;&#x4F1A;&#x4E3A;&#x5176;&#x4ED6;&#x4F4D;&#x7F6E;&#x751F;&#x6210;&#x7ED1;&#x5B9A;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>Incorrect number of bindings supplied. The current statement uses 6,
and there are 4 supplied.
[SQL: u&apos;INSERT INTO my_table (id, data) VALUES (?, ?), (?, ?), (?, ?)&apos;]
[parameters: (1, &apos;d1&apos;, &apos;d2&apos;, &apos;d3&apos;)]</pre></div></div><p><span class="yiyi-st" id="yiyi-526">&#x5E76;&#x4E14;&#x4F7F;&#x7528;&#x201C;named&#x201D;&#x65B9;&#x8A00;&#xFF0C;&#x201C;id&#x201D;&#x7684;&#x76F8;&#x540C;&#x503C;&#x5C06;&#x5728;&#x6BCF;&#x4E00;&#x884C;&#x4E2D;&#x91CD;&#x590D;&#x4F7F;&#x7528;&#xFF08;&#x56E0;&#x6B64;&#xFF0C;&#x6B64;&#x66F4;&#x6539;&#x4E0E;&#x4F9D;&#x8D56;&#x6B64;&#x7684;&#x7CFB;&#x7EDF;&#x53CD;&#x5411;&#x4E0D;&#x517C;&#x5BB9;&#xFF09;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>INSERT INTO my_table (id, data) VALUES (:id, :data_0), (:id, :data_1), (:id, :data_2)
{u&apos;data_2&apos;: &apos;d3&apos;, u&apos;data_1&apos;: &apos;d2&apos;, u&apos;data_0&apos;: &apos;d1&apos;, &apos;id&apos;: 1}</pre></div></div><p><span class="yiyi-st" id="yiyi-527">&#x7CFB;&#x7EDF;&#x4E5F;&#x4F1A;&#x62D2;&#x7EDD;&#x5C06;&#x201C;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x201D;&#x9ED8;&#x8BA4;&#x503C;&#x4F5C;&#x4E3A;&#x5185;&#x8054;&#x5448;&#x73B0;&#x7684;SQL&#x8C03;&#x7528;&#xFF0C;&#x56E0;&#x4E3A;&#x65E0;&#x6CD5;&#x4FDD;&#x8BC1;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x9ED8;&#x8BA4;&#x503C;&#x4E0E;&#x6B64;&#x517C;&#x5BB9;&#x3002;</span><span class="yiyi-st" id="yiyi-528">&#x5982;&#x679C;VALUES&#x5B50;&#x53E5;&#x4E3A;&#x7279;&#x5B9A;&#x5217;&#x5448;&#x73B0;&#xFF0C;&#x5219;&#x9700;&#x8981;Python&#x7AEF;&#x503C;&#xFF1B;&#x5982;&#x679C;&#x7701;&#x7565;&#x7684;&#x503C;&#x4EC5;&#x6307;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x7684;&#x9ED8;&#x8BA4;&#x503C;&#xFF0C;&#x5219;&#x4F1A;&#x5F15;&#x53D1;&#x5F02;&#x5E38;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s1">&apos;my_table&apos;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;id&apos;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;data&apos;</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">server_default</span><span class="o">=</span><span class="s1">&apos;some default&apos;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">insert</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">([</span>
    <span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="s2">&quot;d1&quot;</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="s2">&quot;d2&quot;</span><span class="p">},</span>
    <span class="p">{},</span>
<span class="p">]))</span></pre></div></div><p><span class="yiyi-st" id="yiyi-529">&#x4F1A;&#x63D0;&#x9AD8;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>sqlalchemy.exc.CompileError: INSERT value for column my_table.data is
explicitly rendered as a boundparameter in the VALUES clause; a
Python-side value or SQL expression is required</pre></div></div><p><span class="yiyi-st" id="yiyi-530">&#x4EE5;&#x524D;&#xFF0C;&#x503C;&#x201C;d1&#x201D;&#x5C06;&#x88AB;&#x590D;&#x5236;&#x5230;&#x7B2C;&#x4E09;&#x884C;&#x7684;&#x503C;&#xFF08;&#x4F46;&#x662F;&#x53EA;&#x80FD;&#x4F7F;&#x7528;&#x547D;&#x540D;&#x683C;&#x5F0F;&#xFF01;</span><span class="yiyi-st" id="yiyi-531">&#xFF09;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span>INSERT INTO my_table (data) VALUES (:data_0), (:data_1), (:data_0)
{u&apos;data_1&apos;: &apos;d2&apos;, u&apos;data_0&apos;: &apos;d1&apos;}</pre></div></div><p><span class="yiyi-st" id="yiyi-532"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3288">&#xFF03;3288  T0&gt;</a></span></p></div><div class="section" id="event-listeners-can-not-be-added-or-removed-from-within-that-event-s-runner"><h3><span class="yiyi-st" id="yiyi-533">&#x4E8B;&#x4EF6;&#x4FA6;&#x542C;&#x5668;&#x4E0D;&#x80FD;&#x5728;&#x8BE5;&#x4E8B;&#x4EF6;&#x7684;&#x8FD0;&#x884C;&#x5668;<a class="headerlink" href="#event-listeners-can-not-be-added-or-removed-from-within-that-event-s-runner" title="Permalink to this headline">&#xB6;</a>&#x4E2D;&#x6DFB;&#x52A0;&#x6216;&#x5220;&#x9664;</span></h3><p><span class="yiyi-st" id="yiyi-534">&#x4ECE;&#x540C;&#x4E00;&#x4E8B;&#x4EF6;&#x672C;&#x8EAB;&#x4E2D;&#x5220;&#x9664;&#x4E8B;&#x4EF6;&#x4FA6;&#x542C;&#x5668;&#x4F1A;&#x5728;&#x8FED;&#x4EE3;&#x8FC7;&#x7A0B;&#x4E2D;&#x4FEE;&#x6539;&#x5217;&#x8868;&#x7684;&#x5143;&#x7D20;&#xFF0C;&#x8FD9;&#x5C06;&#x5BFC;&#x81F4;&#x9759;&#x6001;&#x8FDE;&#x63A5;&#x7684;&#x4E8B;&#x4EF6;&#x4FA6;&#x542C;&#x5668;&#x65E0;&#x6CD5;&#x542F;&#x52A8;&#x3002;</span><span class="yiyi-st" id="yiyi-535">&#x4E3A;&#x4E86;&#x5728;&#x4FDD;&#x6301;&#x6027;&#x80FD;&#x7684;&#x540C;&#x65F6;&#x907F;&#x514D;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x53D1;&#x751F;&#xFF0C;&#x5217;&#x8868;&#x5DF2;&#x88AB;&#x66FF;&#x6362;&#x4E3A;<code class="docutils literal"><span class="pre">collections.deque()</span></code>&#xFF0C;&#x5B83;&#x4E0D;&#x5141;&#x8BB8;&#x5728;&#x8FED;&#x4EE3;&#x8FC7;&#x7A0B;&#x4E2D;&#x8FDB;&#x884C;&#x4EFB;&#x4F55;&#x6DFB;&#x52A0;&#x6216;&#x5220;&#x9664;&#x64CD;&#x4F5C;&#xFF0C;&#x800C;&#x662F;&#x5F15;&#x53D1;<code class="docutils literal"><span class="pre">RuntimeError</span></code>&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-536"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3163">&#xFF03;3163  T0&gt;</a></span></p></div><div class="section" id="the-insert-from-select-construct-now-implies-inline-true"><h3><span class="yiyi-st" id="yiyi-537">INSERT ... FROM SELECT&#x7ED3;&#x6784;&#x73B0;&#x5728;&#x610F;&#x5473;&#x7740;<code class="docutils literal"><span class="pre">inline=True</span></code> <a class="headerlink" href="#the-insert-from-select-construct-now-implies-inline-true" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-538">&#x73B0;&#x5728;&#x4F7F;&#x7528;<a class="reference internal" href="core_dml.html#sqlalchemy.sql.expression.Insert.from_select" title="sqlalchemy.sql.expression.Insert.from_select"><code class="xref py py-meth docutils literal"><span class="pre">Insert.from_select()</span></code></a>&#x610F;&#x5473;&#x7740;<code class="docutils literal"><span class="pre">inline=True</span></code>&#x5728;<a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.dml.insert" title="sqlalchemy.dialects.postgresql.dml.insert"><code class="xref py py-func docutils literal"><span class="pre">insert()</span></code></a>&#x4E0A;&#x3002;</span><span class="yiyi-st" id="yiyi-539">&#x8FD9;&#x6709;&#x52A9;&#x4E8E;&#x4FEE;&#x590D;INSERT ... FROM SELECT&#x6784;&#x9020;&#x65E0;&#x610F;&#x4E2D;&#x7F16;&#x8BD1;&#x4E3A;&#x652F;&#x6301;&#x540E;&#x7AEF;&#x7684;&#x201C;&#x9690;&#x5F0F;&#x8FD4;&#x56DE;&#x201D;&#x7684;&#x9519;&#x8BEF;&#xFF0C;&#x8FD9;&#x4F1A;&#x5728;&#x63D2;&#x5165;&#x96F6;&#x884C;&#x7684;INSERT&#x60C5;&#x51B5;&#x4E0B;&#x5BFC;&#x81F4;&#x7834;&#x574F;&#xFF08;&#x56E0;&#x4E3A;&#x9690;&#x5F0F;&#x8FD4;&#x56DE;&#x671F;&#x671B;&#x884C;&#xFF09; &#xFF0C;&#x4EE5;&#x53CA;&#x5728;&#x63D2;&#x5165;&#x591A;&#x884C;&#x7684;INSERT&#x60C5;&#x51B5;&#x4E0B;&#x7684;&#x4EFB;&#x610F;&#x8FD4;&#x56DE;&#x6570;&#x636E;&#xFF08;&#x4F8B;&#x5982;&#xFF0C;&#x53EA;&#x6709;&#x5F88;&#x591A;&#x884C;&#x7684;&#x7B2C;&#x4E00;&#x884C;&#xFF09;&#x3002;</span><span class="yiyi-st" id="yiyi-540">&#x4E00;&#x4E2A;&#x7C7B;&#x4F3C;&#x7684;&#x66F4;&#x6539;&#x4E5F;&#x9002;&#x7528;&#x4E8E;&#x5177;&#x6709;&#x591A;&#x4E2A;&#x53C2;&#x6570;&#x96C6;&#x7684;INSERT..VALUES&#xFF1B;&#x9690;&#x542B;&#x7684;RETURNING&#x5C06;&#x4E0D;&#x518D;&#x4E3A;&#x6B64;&#x8BED;&#x53E5;&#x53D1;&#x51FA;&#x3002;</span><span class="yiyi-st" id="yiyi-541">&#x7531;&#x4E8E;&#x8FD9;&#x4E24;&#x4E2A;&#x6784;&#x9020;&#x90FD;&#x5904;&#x7406;&#x53EF;&#x53D8;&#x6570;&#x91CF;&#x7684;&#x884C;&#xFF0C;&#x6240;&#x4EE5;<a class="reference internal" href="core_connections.html#sqlalchemy.engine.ResultProxy.inserted_primary_key" title="sqlalchemy.engine.ResultProxy.inserted_primary_key"><code class="xref py py-attr docutils literal"><span class="pre">ResultProxy.inserted_primary_key</span></code></a>&#x8BBF;&#x95EE;&#x5668;&#x4E0D;&#x9002;&#x7528;&#x3002;</span><span class="yiyi-st" id="yiyi-542">&#x4EE5;&#x524D;&#xFF0C;&#x6709;&#x4E00;&#x4E2A;&#x6587;&#x6863;&#x8BF4;&#x660E;&#xFF0C;&#x6709;&#x4EBA;&#x53EF;&#x80FD;&#x66F4;&#x559C;&#x6B22;&#x5E26;&#x6709;INSERT..FROM SELECT&#x7684;<code class="docutils literal"><span class="pre">inline=True</span></code>&#xFF0C;&#x56E0;&#x4E3A;&#x6709;&#x4E9B;&#x6570;&#x636E;&#x5E93;&#x4E0D;&#x652F;&#x6301;&#x8FD4;&#x56DE;&#xFF0C;&#x56E0;&#x6B64;&#x4E0D;&#x80FD;&#x505A;&#x201C;&#x9690;&#x5F0F;&#x201D;&#x8FD4;&#x56DE;&#xFF0C;&#x4F46;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x7406;&#x7531;INSERT ... FROM SELECT&#x9700;&#x8981;&#x5728;&#x4EFB;&#x4F55;&#x60C5;&#x51B5;&#x4E0B;&#x9690;&#x5F0F;&#x8FD4;&#x56DE;&#x3002;</span><span class="yiyi-st" id="yiyi-543">&#x5982;&#x679C;&#x9700;&#x8981;&#x63D2;&#x5165;&#x6570;&#x636E;&#xFF0C;&#x5219;&#x5E94;&#x4F7F;&#x7528;&#x5E38;&#x89C4;&#x663E;&#x5F0F;<a class="reference internal" href="core_dml.html#sqlalchemy.sql.expression.Insert.returning" title="sqlalchemy.sql.expression.Insert.returning"><code class="xref py py-meth docutils literal"><span class="pre">Insert.returning()</span></code></a>&#x8FD4;&#x56DE;&#x53EF;&#x53D8;&#x6570;&#x76EE;&#x7684;&#x7ED3;&#x679C;&#x884C;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-544"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3169">&#xFF03;3169  T0&gt;</a></span></p></div><div class="section" id="autoload-with-now-implies-autoload-true"><h3><span class="yiyi-st" id="yiyi-545"><code class="docutils literal"><span class="pre">autoload_with</span></code>&#x73B0;&#x5728;&#x610F;&#x5473;&#x7740;<code class="docutils literal"><span class="pre">autoload=True</span></code> <a class="headerlink" href="#autoload-with-now-implies-autoload-true" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-546">&#x901A;&#x8FC7;&#x5355;&#x72EC;&#x4F20;&#x9012;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Table.params.autoload_with" title="sqlalchemy.schema.Table"><code class="xref py py-paramref docutils literal"><span class="pre">Table.autoload_with</span></code></a>&#xFF0C;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal"><span class="pre">Table</span></code></a>&#x8FDB;&#x884C;&#x53CD;&#x5C04;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">my_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&apos;my_table&apos;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">autoload_with</span><span class="o">=</span><span class="n">some_engine</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-547"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3027">&#xFF03;3027  T0&gt;</a></span></p></div><div class="section" id="dbapi-exception-wrapping-and-handle-error-event-improvements"><h3><span class="yiyi-st" id="yiyi-548">DBAPI&#x5F02;&#x5E38;&#x5305;&#x88C5;&#x548C;handle_error()&#x4E8B;&#x4EF6;&#x6539;&#x8FDB;<a class="headerlink" href="#dbapi-exception-wrapping-and-handle-error-event-improvements" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-549">&#x5728;<a class="reference internal" href="core_connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal"><span class="pre">Connection</span></code></a>&#x5BF9;&#x8C61;&#x5931;&#x6548;&#xFF0C;&#x7136;&#x540E;&#x5C1D;&#x8BD5;&#x91CD;&#x65B0;&#x8FDE;&#x63A5;&#x5E76;&#x9047;&#x5230;&#x9519;&#x8BEF;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;SQLAlchemy&#x7684;&#x5305;&#x88C5;DBAPI&#x5F02;&#x5E38;&#x4E0D;&#x4F1A;&#x53D1;&#x751F;&#xFF1B;&#x8FD9;&#x5DF2;&#x7ECF;&#x89E3;&#x51B3;&#x4E86;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-550">&#x6B64;&#x5916;&#xFF0C;&#x6700;&#x8FD1;&#x6DFB;&#x52A0;&#x7684;<a class="reference internal" href="core_events.html#sqlalchemy.events.ConnectionEvents.handle_error" title="sqlalchemy.events.ConnectionEvents.handle_error"><code class="xref py py-meth docutils literal"><span class="pre">ConnectionEvents.handle_error()</span></code></a>&#x4E8B;&#x4EF6;&#x73B0;&#x5728;&#x5C06;&#x9488;&#x5BF9;&#x521D;&#x59CB;&#x8FDE;&#x63A5;&#x65F6;&#x53D1;&#x751F;&#x7684;&#x9519;&#x8BEF;&#xFF0C;&#x91CD;&#x65B0;&#x8FDE;&#x63A5;&#x65F6;&#x4EE5;&#x53CA;&#x5728;&#x4F7F;&#x7528;<a class="reference internal" href="core_engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal"><span class="pre">create_engine()</span></code></a>&#x65F6;&#x7ED9;&#x5B9A;&#x81EA;&#x5B9A;&#x4E49;&#x8FDE;&#x63A5;&#x901A;&#x8FC7;<a class="reference internal" href="core_engines.html#sqlalchemy.create_engine.params.creator" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal"><span class="pre">create_engine.creator</span></code></a>&#x6267;&#x884C;&#x529F;&#x80FD;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-551">The <a class="reference internal" href="core_connections.html#sqlalchemy.engine.ExceptionContext" title="sqlalchemy.engine.ExceptionContext"><code class="xref py py-class docutils literal"><span class="pre">ExceptionContext</span></code></a> object has a new datamember <a class="reference internal" href="core_connections.html#sqlalchemy.engine.ExceptionContext.engine" title="sqlalchemy.engine.ExceptionContext.engine"><code class="xref py py-attr docutils literal"><span class="pre">ExceptionContext.engine</span></code></a> that will always refer to the <a class="reference internal" href="core_connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal"><span class="pre">Engine</span></code></a> in use, in those cases when the <a class="reference internal" href="core_connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal"><span class="pre">Connection</span></code></a> object is not available (e.g. on initial connect).</span></p><p><span class="yiyi-st" id="yiyi-552"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3266">&#xFF03;3266  T0&gt;</a></span></p></div><div class="section" id="foreignkeyconstraint-columns-is-now-a-columncollection"><h3><span class="yiyi-st" id="yiyi-553">ForeignKeyConstraint.columns&#x73B0;&#x5728;&#x662F;&#x4E00;&#x4E2A;ColumnCollection <a class="headerlink" href="#foreignkeyconstraint-columns-is-now-a-columncollection" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-554"><code class="xref py py-attr docutils literal"><span class="pre">ForeignKeyConstraint.columns</span></code> was previously a plain list containing either strings or <a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal"><span class="pre">Column</span></code></a> objects, depending on how the <a class="reference internal" href="core_constraints.html#sqlalchemy.schema.ForeignKeyConstraint" title="sqlalchemy.schema.ForeignKeyConstraint"><code class="xref py py-class docutils literal"><span class="pre">ForeignKeyConstraint</span></code></a> was constructed and whether it was associated with a table. </span><span class="yiyi-st" id="yiyi-555">&#x8BE5;&#x96C6;&#x5408;&#x73B0;&#x5728;&#x662F;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.ColumnCollection" title="sqlalchemy.sql.expression.ColumnCollection"><code class="xref py py-class docutils literal"><span class="pre">ColumnCollection</span></code></a>&#xFF0C;&#x5E76;&#x4E14;&#x4EC5;&#x5728;<a class="reference internal" href="core_constraints.html#sqlalchemy.schema.ForeignKeyConstraint" title="sqlalchemy.schema.ForeignKeyConstraint"><code class="xref py py-class docutils literal"><span class="pre">ForeignKeyConstraint</span></code></a>&#x4E0E;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal"><span class="pre">Table</span></code></a>&#x5173;&#x8054;&#x540E;&#x624D;&#x88AB;&#x521D;&#x59CB;&#x5316;&#x3002;</span><span class="yiyi-st" id="yiyi-556">A new accessor <a class="reference internal" href="core_constraints.html#sqlalchemy.schema.ForeignKeyConstraint.column_keys" title="sqlalchemy.schema.ForeignKeyConstraint.column_keys"><code class="xref py py-attr docutils literal"><span class="pre">ForeignKeyConstraint.column_keys</span></code></a> is added to unconditionally return string keys for the local set of columns regardless of how the object was constructed or its current state.</span></p></div><div class="section" id="metadata-sorted-tables-accessor-is-deterministic"><h3><span class="yiyi-st" id="yiyi-557">MetaData.sorted_tables&#x8BBF;&#x95EE;&#x5668;&#x662F;&#x201C;&#x786E;&#x5B9A;&#x6027;&#x7684;&#x201D;<a class="headerlink" href="#metadata-sorted-tables-accessor-is-deterministic" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-558">The sorting of tables resulting from the <a class="reference internal" href="core_metadata.html#sqlalchemy.schema.MetaData.sorted_tables" title="sqlalchemy.schema.MetaData.sorted_tables"><code class="xref py py-attr docutils literal"><span class="pre">MetaData.sorted_tables</span></code></a> accessor is &#x201C;deterministic&#x201D;; the ordering should be the same in all cases regardless of Python hashing. </span><span class="yiyi-st" id="yiyi-559">&#x8FD9;&#x662F;&#x901A;&#x8FC7;&#x9996;&#x5148;&#x6309;&#x540D;&#x79F0;&#x5BF9;&#x8868;&#x683C;&#x8FDB;&#x884C;&#x6392;&#x5E8F;&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x5B83;&#x4EEC;&#x4F20;&#x9012;&#x7ED9;&#x62D3;&#x6251;&#x7B97;&#x6CD5;&#xFF0C;&#x8BE5;&#x62D3;&#x6251;&#x7B97;&#x6CD5;&#x5728;&#x8FED;&#x4EE3;&#x65F6;&#x4FDD;&#x6301;&#x6392;&#x5E8F;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-560">Note that this change does <strong>not</strong> yet apply to the ordering applied when emitting <a class="reference internal" href="core_metadata.html#sqlalchemy.schema.MetaData.create_all" title="sqlalchemy.schema.MetaData.create_all"><code class="xref py py-meth docutils literal"><span class="pre">MetaData.create_all()</span></code></a> or <a class="reference internal" href="core_metadata.html#sqlalchemy.schema.MetaData.drop_all" title="sqlalchemy.schema.MetaData.drop_all"><code class="xref py py-meth docutils literal"><span class="pre">MetaData.drop_all()</span></code></a>.</span></p><p><span class="yiyi-st" id="yiyi-561"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3084">&#xFF03;3084  T0&gt;</a></span></p></div><div class="section" id="null-false-and-true-constants-are-no-longer-singletons"><h3><span class="yiyi-st" id="yiyi-562">null()&#xFF0C;false()&#x548C;true()&#x5E38;&#x91CF;&#x4E0D;&#x518D;&#x662F;&#x5355;&#x8EAB;&#x4EBA;&#x58EB;<a class="headerlink" href="#null-false-and-true-constants-are-no-longer-singletons" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-563">&#x8FD9;&#x4E09;&#x4E2A;&#x5E38;&#x91CF;&#x88AB;&#x66F4;&#x6539;&#x4E3A;&#x8FD4;&#x56DE;0.9&#x4E2D;&#x7684;&#x201C;&#x5355;&#x4F8B;&#x201D;&#x503C;&#xFF1B;&#x4E0D;&#x5E78;&#x7684;&#x662F;&#xFF0C;&#x8FD9;&#x4F1A;&#x5BFC;&#x81F4;&#x50CF;&#x4E0B;&#x9762;&#x8FD9;&#x6837;&#x7684;&#x67E5;&#x8BE2;&#x4E0D;&#x80FD;&#x6309;&#x9884;&#x671F;&#x5448;&#x73B0;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">select</span><span class="p">([</span><span class="n">null</span><span class="p">(),</span> <span class="n">null</span><span class="p">()])</span></pre></div></div><p><span class="yiyi-st" id="yiyi-564">rendering only <code class="docutils literal"><span class="pre">SELECT</span> <span class="pre">NULL</span> <span class="pre">AS</span> <span class="pre">anon_1</span></code>, because the two <a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.null" title="sqlalchemy.sql.expression.null"><code class="xref py py-func docutils literal"><span class="pre">null()</span></code></a> constructs would come out as the same <code class="docutils literal"><span class="pre">NULL</span></code> object, and SQLAlchemy&#x2019;s Core model is based on object identity in order to determine lexical significance. </span><span class="yiyi-st" id="yiyi-565">&#x9664;&#x4E86;&#x5E0C;&#x671B;&#x8282;&#x7701;&#x7269;&#x4F53;&#x5F00;&#x9500;&#x4E4B;&#x5916;&#xFF0C;0.9&#x4E2D;&#x7684;&#x53D8;&#x5316;&#x5E76;&#x4E0D;&#x91CD;&#x8981;&#xFF1B;&#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;&#x4E00;&#x4E2A;&#x672A;&#x547D;&#x540D;&#x7684;&#x6784;&#x9020;&#x9700;&#x8981;&#x4FDD;&#x6301;&#x8BCD;&#x6C47;&#x4E0A;&#x7684;&#x72EC;&#x7279;&#x6027;&#xFF0C;&#x4EE5;&#x4FBF;&#x5F97;&#x5230;&#x552F;&#x4E00;&#x7684;&#x6807;&#x8BB0;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-566"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3170">&#xFF03;3170  T0&gt;</a></span></p></div><div class="section" id="sqlite-oracle-have-distinct-methods-for-temporary-table-view-name-reporting"><h3><span class="yiyi-st" id="yiyi-567">SQLite / Oracle&#x5177;&#x6709;&#x4E0D;&#x540C;&#x7684;&#x4E34;&#x65F6;&#x8868;/&#x89C6;&#x56FE;&#x540D;&#x79F0;&#x62A5;&#x544A;&#x65B9;&#x6CD5;<a class="headerlink" href="#sqlite-oracle-have-distinct-methods-for-temporary-table-view-name-reporting" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-568">&#x5728;SQLite / Oracle&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;<a class="reference internal" href="core_reflection.html#sqlalchemy.engine.reflection.Inspector.get_table_names" title="sqlalchemy.engine.reflection.Inspector.get_table_names"><code class="xref py py-meth docutils literal"><span class="pre">Inspector.get_table_names()</span></code></a>&#x548C;<a class="reference internal" href="core_reflection.html#sqlalchemy.engine.reflection.Inspector.get_view_names" title="sqlalchemy.engine.reflection.Inspector.get_view_names"><code class="xref py py-meth docutils literal"><span class="pre">Inspector.get_view_names()</span></code></a>&#x65B9;&#x6CD5;&#x4E5F;&#x4F1A;&#x8FD4;&#x56DE;&#x4E34;&#x65F6;&#x8868;&#x548C;&#x89C6;&#x56FE;&#x7684;&#x540D;&#x79F0;&#xFF0C;&#x4EFB;&#x4F55;&#x5176;&#x4ED6;&#x65B9;&#x8A00;&#xFF08;&#x5728;MySQL&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x81F3;&#x5C11;&#x5B83;&#x662F;&#x4E0D;&#x53EF;&#x80FD;&#x7684;&#xFF09;&#x3002;</span><span class="yiyi-st" id="yiyi-569">This logic has been moved out to two new methods <a class="reference internal" href="core_reflection.html#sqlalchemy.engine.reflection.Inspector.get_temp_table_names" title="sqlalchemy.engine.reflection.Inspector.get_temp_table_names"><code class="xref py py-meth docutils literal"><span class="pre">Inspector.get_temp_table_names()</span></code></a> and <a class="reference internal" href="core_reflection.html#sqlalchemy.engine.reflection.Inspector.get_temp_view_names" title="sqlalchemy.engine.reflection.Inspector.get_temp_view_names"><code class="xref py py-meth docutils literal"><span class="pre">Inspector.get_temp_view_names()</span></code></a>.</span></p><p><span class="yiyi-st" id="yiyi-570">Note that reflection of a specific named temporary table or temporary view, either by <code class="docutils literal"><span class="pre">Table(&apos;name&apos;,</span> <span class="pre">autoload=True)</span></code> or via methods like <a class="reference internal" href="core_reflection.html#sqlalchemy.engine.reflection.Inspector.get_columns" title="sqlalchemy.engine.reflection.Inspector.get_columns"><code class="xref py py-meth docutils literal"><span class="pre">Inspector.get_columns()</span></code></a> continues to function for most if not all dialects. </span><span class="yiyi-st" id="yiyi-571">&#x7279;&#x522B;&#x662F;&#x5BF9;&#x4E8E;SQLite&#xFF0C;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x9488;&#x5BF9;&#x4E34;&#x65F6;&#x8868;&#x7684;UNIQUE&#x7EA6;&#x675F;&#x53CD;&#x5C04;&#x7684;&#x9519;&#x8BEF;&#x4FEE;&#x590D;&#xFF0C;&#x5B83;&#x662F;<a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3203">&#xFF03;3203</a>&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-572"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3204">&#xFF03;3204  T0&gt;</a></span></p></div></div><div class="section" id="dialect-improvements-and-changes-postgresql"><h2><span class="yiyi-st" id="yiyi-573">&#x65B9;&#x8A00;&#x7684;&#x6539;&#x8FDB;&#x548C;&#x53D8;&#x5316; -  Postgresql <a class="headerlink" href="#dialect-improvements-and-changes-postgresql" title="Permalink to this headline">&#xB6;</a></span></h2><div class="section" id="overhaul-of-enum-type-create-drop-rules"><h3><span class="yiyi-st" id="yiyi-574">ENUM&#x7C7B;&#x578B;&#x521B;&#x5EFA;/&#x5220;&#x9664;&#x89C4;&#x5219;&#x7684;&#x5927;&#x4FEE;<a class="headerlink" href="#overhaul-of-enum-type-create-drop-rules" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-575">&#x5BF9;&#x4E8E;&#x521B;&#x5EFA;&#x548C;&#x5220;&#x9664;TYPE&#xFF0C;Postgresql <a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.ENUM" title="sqlalchemy.dialects.postgresql.ENUM"><code class="xref py py-class docutils literal"><span class="pre">postgresql.ENUM</span></code></a>&#x7684;&#x89C4;&#x5219;&#x66F4;&#x4E3A;&#x4E25;&#x683C;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-576">An <a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.ENUM" title="sqlalchemy.dialects.postgresql.ENUM"><code class="xref py py-class docutils literal"><span class="pre">postgresql.ENUM</span></code></a> that is created <strong>without</strong> being explicitly associated with a <a class="reference internal" href="core_metadata.html#sqlalchemy.schema.MetaData" title="sqlalchemy.schema.MetaData"><code class="xref py py-class docutils literal"><span class="pre">MetaData</span></code></a> object will be created <em>and</em> dropped corresponding to <a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Table.create" title="sqlalchemy.schema.Table.create"><code class="xref py py-meth docutils literal"><span class="pre">Table.create()</span></code></a> and <a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Table.drop" title="sqlalchemy.schema.Table.drop"><code class="xref py py-meth docutils literal"><span class="pre">Table.drop()</span></code></a>:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&apos;sometable&apos;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;some_enum&apos;</span><span class="p">,</span> <span class="n">ENUM</span><span class="p">(</span><span class="s1">&apos;a&apos;</span><span class="p">,</span> <span class="s1">&apos;b&apos;</span><span class="p">,</span> <span class="s1">&apos;c&apos;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&apos;myenum&apos;</span><span class="p">))</span>
<span class="p">)</span>

<span class="n">table</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>  <span class="c1"># will emit CREATE TYPE and CREATE TABLE</span>
<span class="n">table</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>  <span class="c1"># will emit DROP TABLE and DROP TYPE - new for 1.0</span></pre></div></div><p><span class="yiyi-st" id="yiyi-577">&#x8FD9;&#x610F;&#x5473;&#x7740;&#x5982;&#x679C;&#x7B2C;&#x4E8C;&#x4E2A;&#x8868;&#x4E5F;&#x6709;&#x4E00;&#x4E2A;&#x540D;&#x4E3A;&apos;myenum&apos;&#x7684;&#x679A;&#x4E3E;&#xFF0C;&#x90A3;&#x4E48;&#x4E0A;&#x9762;&#x7684;DROP&#x64CD;&#x4F5C;&#x73B0;&#x5728;&#x5C06;&#x5931;&#x8D25;&#x3002;</span><span class="yiyi-st" id="yiyi-578">&#x4E3A;&#x4E86;&#x9002;&#x5E94;&#x666E;&#x901A;&#x5171;&#x4EAB;&#x679A;&#x4E3E;&#x7C7B;&#x578B;&#x7684;&#x7528;&#x4F8B;&#xFF0C;&#x5143;&#x6570;&#x636E;&#x5173;&#x8054;&#x679A;&#x4E3E;&#x7684;&#x884C;&#x4E3A;&#x5DF2;&#x5F97;&#x5230;&#x589E;&#x5F3A;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-579">An <a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.ENUM" title="sqlalchemy.dialects.postgresql.ENUM"><code class="xref py py-class docutils literal"><span class="pre">postgresql.ENUM</span></code></a> that is created <strong>with</strong> being explicitly associated with a <a class="reference internal" href="core_metadata.html#sqlalchemy.schema.MetaData" title="sqlalchemy.schema.MetaData"><code class="xref py py-class docutils literal"><span class="pre">MetaData</span></code></a> object will <em>not</em> be created <em>or</em> dropped corresponding to <a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Table.create" title="sqlalchemy.schema.Table.create"><code class="xref py py-meth docutils literal"><span class="pre">Table.create()</span></code></a> and <a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Table.drop" title="sqlalchemy.schema.Table.drop"><code class="xref py py-meth docutils literal"><span class="pre">Table.drop()</span></code></a>, with the exception of <a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Table.create" title="sqlalchemy.schema.Table.create"><code class="xref py py-meth docutils literal"><span class="pre">Table.create()</span></code></a> called with the <code class="docutils literal"><span class="pre">checkfirst=True</span></code> flag:</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">my_enum</span> <span class="o">=</span> <span class="n">ENUM</span><span class="p">(</span><span class="s1">&apos;a&apos;</span><span class="p">,</span> <span class="s1">&apos;b&apos;</span><span class="p">,</span> <span class="s1">&apos;c&apos;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&apos;myenum&apos;</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>

<span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&apos;sometable&apos;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;some_enum&apos;</span><span class="p">,</span> <span class="n">my_enum</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># will fail: ENUM &apos;my_enum&apos; does not exist</span>
<span class="n">table</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>

<span class="c1"># will check for enum and emit CREATE TYPE</span>
<span class="n">table</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="n">checkfirst</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">table</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>  <span class="c1"># will emit DROP TABLE, *not* DROP TYPE</span>

<span class="n">metadata</span><span class="o">.</span><span class="n">drop_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span> <span class="c1"># will emit DROP TYPE</span>

<span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span> <span class="c1"># will emit CREATE TYPE</span></pre></div></div><p><span class="yiyi-st" id="yiyi-580"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3319">&#xFF03;3319  T0&gt;</a></span></p></div><div class="section" id="new-postgresql-table-options"><h3><span class="yiyi-st" id="yiyi-581">&#x65B0;&#x7684;Postgresql&#x8868;&#x9009;&#x9879;<a class="headerlink" href="#new-postgresql-table-options" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-582">&#x5F53;&#x901A;&#x8FC7;<a class="reference internal" href="core_metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal"><span class="pre">Table</span></code></a>&#x6784;&#x9020;&#x6E32;&#x67D3;DDL&#x65F6;&#xFF0C;&#x589E;&#x52A0;&#x4E86;&#x5BF9;PG&#x8868;&#x683C;&#x9009;&#x9879;TABLESPACE&#xFF0C;ON COMMIT&#xFF0C;WITH&#xFF08;OUT&#xFF09;OIDS&#x548C;INHERITS&#x7684;&#x652F;&#x6301;&#x3002;</span></p><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-583">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-584"><a class="reference internal" href="dialects_postgresql.html#postgresql-table-options"><span>PostgreSQL Table Options</span></a></span></p></div><p><span class="yiyi-st" id="yiyi-585"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2051">&#xFF03;2051  T0&gt;</a></span></p></div><div class="section" id="new-get-enums-method-with-postgresql-dialect"><h3><span class="yiyi-st" id="yiyi-586">&#x4F7F;&#x7528;Postgresql Dialect <a class="headerlink" href="#new-get-enums-method-with-postgresql-dialect" title="Permalink to this headline">&#xB6;</a>&#x7684;&#x65B0;get_enums()&#x65B9;&#x6CD5;</span></h3><p><span class="yiyi-st" id="yiyi-587">&#x5728;Postgresql&#x4E2D;&#xFF0C;<a class="reference internal" href="core_inspection.html#sqlalchemy.inspection.inspect" title="sqlalchemy.inspection.inspect"><code class="xref py py-func docutils literal"><span class="pre">inspect()</span></code></a>&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;<a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.base.PGInspector" title="sqlalchemy.dialects.postgresql.base.PGInspector"><code class="xref py py-class docutils literal"><span class="pre">PGInspector</span></code></a>&#x5BF9;&#x8C61;&#xFF0C;&#x5176;&#x4E2D;&#x5305;&#x542B;&#x4E00;&#x4E2A;&#x65B0;&#x7684;<a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.base.PGInspector.get_enums" title="sqlalchemy.dialects.postgresql.base.PGInspector.get_enums"><code class="xref py py-meth docutils literal"><span class="pre">PGInspector.get_enums()</span></code></a>&#x65B9;&#x6CD5;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#x6240;&#x6709;&#x53EF;&#x7528;&#x7684;<code class="docutils literal"><span class="pre">ENUM</span></code>&#x7C7B;&#x578B;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">inspect</span><span class="p">,</span> <span class="n">create_engine</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;postgresql+psycopg2://host/dbname&quot;</span><span class="p">)</span>
<span class="n">insp</span> <span class="o">=</span> <span class="n">inspect</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">insp</span><span class="o">.</span><span class="n">get_enums</span><span class="p">())</span></pre></div></div><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-588">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-589"><a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.base.PGInspector.get_enums" title="sqlalchemy.dialects.postgresql.base.PGInspector.get_enums"><code class="xref py py-meth docutils literal"><span class="pre">PGInspector.get_enums()</span></code></a></span></p></div></div><div class="section" id="postgresql-dialect-reflects-materialized-views-foreign-tables"><h3><span class="yiyi-st" id="yiyi-590">Postgresql Dialect&#x53CD;&#x6620;&#x4E86;&#x7269;&#x5316;&#x89C6;&#x56FE;&#xFF0C;&#x5916;&#x90E8;&#x8868;<a class="headerlink" href="#postgresql-dialect-reflects-materialized-views-foreign-tables" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-591">&#x53D8;&#x5316;&#x5982;&#x4E0B;&#xFF1A;</span></p><ul class="simple"><li><span class="yiyi-st" id="yiyi-592">&#x5E26;&#x6709;<code class="docutils literal"><span class="pre">autoload=True</span></code>&#x7684;<code class="xref py py-class docutils literal"><span class="pre">Table</span></code>&#x7ED3;&#x6784;&#x73B0;&#x5728;&#x5C06;&#x5339;&#x914D;&#x5B58;&#x5728;&#x4E8E;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x7684;&#x540D;&#x79F0;&#x4F5C;&#x4E3A;&#x7269;&#x5316;&#x89C6;&#x56FE;&#x6216;&#x5916;&#x90E8;&#x8868;&#x3002;</span></li><li><span class="yiyi-st" id="yiyi-593"><a class="reference internal" href="core_reflection.html#sqlalchemy.engine.reflection.Inspector.get_view_names" title="sqlalchemy.engine.reflection.Inspector.get_view_names"><code class="xref py py-meth docutils literal"><span class="pre">Inspector.get_view_names()</span></code></a> will return plain and materialized view names.</span></li><li><span class="yiyi-st" id="yiyi-594"><a class="reference internal" href="core_reflection.html#sqlalchemy.engine.reflection.Inspector.get_table_names" title="sqlalchemy.engine.reflection.Inspector.get_table_names"><code class="xref py py-meth docutils literal"><span class="pre">Inspector.get_table_names()</span></code></a> does <strong>not</strong> change for Postgresql, it continues to return only the names of plain tables.</span></li><li><span class="yiyi-st" id="yiyi-595">&#x6DFB;&#x52A0;&#x4E86;&#x4E00;&#x4E2A;&#x65B0;&#x65B9;&#x6CD5;<a class="reference internal" href="dialects_postgresql.html#sqlalchemy.dialects.postgresql.base.PGInspector.get_foreign_table_names" title="sqlalchemy.dialects.postgresql.base.PGInspector.get_foreign_table_names"><code class="xref py py-meth docutils literal"><span class="pre">PGInspector.get_foreign_table_names()</span></code></a>&#xFF0C;&#x5B83;&#x5C06;&#x8FD4;&#x56DE;Postgresql&#x6A21;&#x5F0F;&#x8868;&#x4E2D;&#x660E;&#x786E;&#x6807;&#x8BB0;&#x4E3A;&#x201C;&#x5916;&#x90E8;&#x201D;&#x7684;&#x8868;&#x7684;&#x540D;&#x79F0;&#x3002;</span></li></ul><p><span class="yiyi-st" id="yiyi-596">&#x5BF9;&#x53CD;&#x5C04;&#x7684;&#x6539;&#x53D8;&#x5305;&#x62EC;&#x5C06;<code class="docutils literal"><span class="pre">&apos;m&apos;</span></code>&#x548C;<code class="docutils literal"><span class="pre">&apos;f&apos;</span></code>&#x6DFB;&#x52A0;&#x5230;&#x6211;&#x4EEC;&#x5728;&#x67E5;&#x8BE2;<code class="docutils literal"><span class="pre">pg_class.relkind</span></code>&#x65F6;&#x4F7F;&#x7528;&#x7684;&#x9650;&#x5B9A;&#x7B26;&#x5217;&#x8868;&#x4E2D;&#xFF0C;&#x4F46;&#x662F;&#x6B64;&#x66F4;&#x6539;&#x5728;1.0.0&#x4E2D;&#x662F;&#x65B0;&#x7684;&#xFF0C;&#x4EE5;&#x907F;&#x514D;&#x90A3;&#x4E9B;&#x5728;&#x751F;&#x4EA7;&#x4E2D;&#x8FD0;&#x884C;0.9&#x7684;&#x4EBA;&#x51FA;&#x73B0;&#x4EFB;&#x4F55;&#x5411;&#x540E;&#x4E0D;&#x517C;&#x5BB9;&#x7684;&#x610F;&#x5916;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-597"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2891">&#xFF03;2891  T0&gt;</a></span></p></div><div class="section" id="postgresql-has-table-now-works-for-temporary-tables"><h3><span class="yiyi-st" id="yiyi-598">Postgresql <code class="docutils literal"><span class="pre">has_table()</span></code>&#x73B0;&#x5728;&#x53EF;&#x7528;&#x4E8E;&#x4E34;&#x65F6;&#x8868;<a class="headerlink" href="#postgresql-has-table-now-works-for-temporary-tables" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-599">&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x4FEE;&#x590D;&#xFF0C;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4E34;&#x65F6;&#x8868;&#x7684;&#x201C;&#x6709;&#x8868;&#x201D;&#xFF0C;&#x4EE5;&#x4FBF;&#x53EF;&#x4EE5;&#x7EE7;&#x7EED;&#x6267;&#x884C;&#x4EE5;&#x4E0B;&#x4EE3;&#x7801;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">metadata</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">()</span>
<span class="n">user_tmp</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s2">&quot;user_tmp&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">INT</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;name&apos;</span><span class="p">,</span> <span class="n">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)),</span>
    <span class="n">prefixes</span><span class="o">=</span><span class="p">[</span><span class="s1">&apos;TEMPORARY&apos;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;postgresql://scott:tiger@localhost/test&quot;</span><span class="p">,</span> <span class="n">echo</span><span class="o">=</span><span class="s1">&apos;debug&apos;</span><span class="p">)</span>
<span class="k">with</span> <span class="n">e</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">user_tmp</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">checkfirst</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="c1"># checkfirst will succeed</span>
    <span class="n">user_tmp</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">checkfirst</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-600">&#x8FD9;&#x79CD;&#x884C;&#x4E3A;&#x4F1A;&#x5BFC;&#x81F4;&#x975E;&#x5931;&#x8D25;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x884C;&#x4E3A;&#x4E0D;&#x540C;&#xFF0C;&#x8FD9;&#x662F;&#x975E;&#x5E38;&#x4E0D;&#x53EF;&#x80FD;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;Postgresql&#x5141;&#x8BB8;&#x975E;&#x4E34;&#x65F6;&#x8868;&#x4EE5;&#x9759;&#x9ED8;&#x65B9;&#x5F0F;&#x8986;&#x76D6;&#x4E34;&#x65F6;&#x8868;&#x3002;</span><span class="yiyi-st" id="yiyi-601">&#x56E0;&#x6B64;&#xFF0C;&#x50CF;&#x4E0B;&#x9762;&#x8FD9;&#x6837;&#x7684;&#x4EE3;&#x7801;&#x73B0;&#x5728;&#x5C06;&#x5B8C;&#x5168;&#x4E0D;&#x540C;&#xFF0C;&#x4E0D;&#x518D;&#x5728;&#x4E34;&#x65F6;&#x8868;&#x4E4B;&#x540E;&#x521B;&#x5EFA;&#x771F;&#x5B9E;&#x8868;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">metadata</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">()</span>
<span class="n">user_tmp</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s2">&quot;user_tmp&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">INT</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;name&apos;</span><span class="p">,</span> <span class="n">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)),</span>
    <span class="n">prefixes</span><span class="o">=</span><span class="p">[</span><span class="s1">&apos;TEMPORARY&apos;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;postgresql://scott:tiger@localhost/test&quot;</span><span class="p">,</span> <span class="n">echo</span><span class="o">=</span><span class="s1">&apos;debug&apos;</span><span class="p">)</span>
<span class="k">with</span> <span class="n">e</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">user_tmp</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">checkfirst</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">m2</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">()</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
        <span class="s2">&quot;user_tmp&quot;</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span>
        <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">INT</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s1">&apos;name&apos;</span><span class="p">,</span> <span class="n">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)),</span>
    <span class="p">)</span>

    <span class="c1"># in 0.9, *will create* the new table, overwriting the old one.</span>
    <span class="c1"># in 1.0, *will not create* the new table</span>
    <span class="n">user</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">checkfirst</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-602"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3264">&#xFF03;3264  T0&gt;</a></span></p></div><div class="section" id="postgresql-filter-keyword"><h3><span class="yiyi-st" id="yiyi-603">Postgresql FILTER&#x5173;&#x952E;&#x5B57;<a class="headerlink" href="#postgresql-filter-keyword" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-604">Postgresql&#x73B0;&#x5728;&#x652F;&#x6301;9.4&#x7684;&#x96C6;&#x5408;&#x51FD;&#x6570;&#x7684;SQL&#x6807;&#x51C6;FILTER&#x5173;&#x952E;&#x5B57;&#x3002;</span><span class="yiyi-st" id="yiyi-605">SQLAlchemy&#x5141;&#x8BB8;&#x4F7F;&#x7528;<a class="reference internal" href="core_functions.html#sqlalchemy.sql.functions.FunctionElement.filter" title="sqlalchemy.sql.functions.FunctionElement.filter"><code class="xref py py-meth docutils literal"><span class="pre">FunctionElement.filter()</span></code></a>&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">func</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre></div></div><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-606">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p><span class="yiyi-st" id="yiyi-607"><a class="reference internal" href="core_functions.html#sqlalchemy.sql.functions.FunctionElement.filter" title="sqlalchemy.sql.functions.FunctionElement.filter"><code class="xref py py-meth docutils literal"><span class="pre">FunctionElement.filter()</span></code></a></span></p><p class="last"><span class="yiyi-st" id="yiyi-608"><a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.FunctionFilter" title="sqlalchemy.sql.expression.FunctionFilter"><code class="xref py py-class docutils literal"><span class="pre">FunctionFilter</span></code></a></span></p></div></div><div class="section" id="pg8000-dialect-supports-client-side-encoding"><h3><span class="yiyi-st" id="yiyi-609">PG8000&#x65B9;&#x8A00;&#x652F;&#x6301;&#x5BA2;&#x6237;&#x7AEF;&#x7F16;&#x7801;<a class="headerlink" href="#pg8000-dialect-supports-client-side-encoding" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-610"><a class="reference internal" href="core_engines.html#sqlalchemy.create_engine.params.encoding" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal"><span class="pre">create_engine.encoding</span></code></a>&#x53C2;&#x6570;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;pg8000&#x65B9;&#x8A00;&#x4F7F;&#x7528;&#x8FDE;&#x63A5;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x53D1;&#x51FA;<code class="docutils literal"><span class="pre">SET</span> <span class="pre">CLIENT_ENCODING</span></code>&#x5339;&#x914D;&#x6240;&#x9009;&#x7684;&#x7F16;&#x7801;&#x3002;</span></p></div><div class="section" id="pg8000-native-jsonb-support"><h3><span class="yiyi-st" id="yiyi-611">PG8000&#x672C;&#x673A;JSONB&#x652F;&#x6301;<a class="headerlink" href="#pg8000-native-jsonb-support" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-612">&#x5DF2;&#x7ECF;&#x6DFB;&#x52A0;&#x4E86;&#x5BF9;PG8000&#x7248;&#x672C;&#x5927;&#x4E8E;1.10.1&#x7684;&#x652F;&#x6301;&#xFF0C;&#x5176;&#x4E2D;&#x539F;&#x751F;&#x652F;&#x6301;JSONB&#x3002;</span></p></div><div class="section" id="support-for-psycopg2cffi-dialect-on-pypy"><h3><span class="yiyi-st" id="yiyi-613">&#x652F;&#x6301;pypy <a class="headerlink" href="#support-for-psycopg2cffi-dialect-on-pypy" title="Permalink to this headline">&#xB6;</a>&#x4E0A;&#x7684;psycopg2cffi Dialect</span></h3><p><span class="yiyi-st" id="yiyi-614">&#x589E;&#x52A0;&#x4E86;&#x5BF9;pypy psycopg2cffi&#x65B9;&#x8A00;&#x7684;&#x652F;&#x6301;&#x3002;</span></p><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-615">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-616"><a class="reference internal" href="dialects_postgresql.html#module-sqlalchemy.dialects.postgresql.psycopg2cffi" title="sqlalchemy.dialects.postgresql.psycopg2cffi"><code class="xref py py-mod docutils literal"><span class="pre">sqlalchemy.dialects.postgresql.psycopg2cffi</span></code></a></span></p></div></div></div><div class="section" id="dialect-improvements-and-changes-mysql"><h2><span class="yiyi-st" id="yiyi-617">&#x65B9;&#x8A00;&#x7684;&#x6539;&#x8FDB;&#x548C;&#x6539;&#x53D8; -  MySQL <a class="headerlink" href="#dialect-improvements-and-changes-mysql" title="Permalink to this headline">&#xB6;</a></span></h2><div class="section" id="mysql-timestamp-type-now-renders-null-not-null-in-all-cases"><h3><span class="yiyi-st" id="yiyi-618">&#x5728;&#x6240;&#x6709;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;MySQL TIMESTAMP&#x7C7B;&#x578B;&#x73B0;&#x5728;&#x90FD;&#x4F1A;&#x5448;&#x73B0;NULL / NOT NULL <a class="headerlink" href="#mysql-timestamp-type-now-renders-null-not-null-in-all-cases" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-619">&#x5982;&#x679C;&#x4F7F;&#x7528;<code class="docutils literal"><span class="pre">nullable=True</span></code>&#x8BBE;&#x7F6E;&#x5217;&#xFF0C;&#x5219;MySQL&#x65B9;&#x8A00;&#x4E00;&#x76F4;&#x901A;&#x8FC7;&#x4E3A;&#x8FD9;&#x79CD;&#x7C7B;&#x578B;&#x53D1;&#x9001;NULL&#x6765;&#x89E3;&#x51B3;MySQL&#x7684;&#x4E0E;TIMESTAMP&#x5217;&#x76F8;&#x5173;&#x7684;&#x9690;&#x5F0F;NOT NULL&#x9ED8;&#x8BA4;&#x503C;&#x3002;</span><span class="yiyi-st" id="yiyi-620">&#x4F46;&#x662F;&#xFF0C;MySQL 5.6.6&#x53CA;&#x66F4;&#x9AD8;&#x7248;&#x672C;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x65B0;&#x6807;&#x8BB0;<a class="reference external" href="http://dev.mysql.com/doc/refman/5.6/en/server-system-variables.html#sysvar_explicit_defaults_for_timestamp">explicit_defaults_for_timestamp</a>&#xFF0C;&#x5B83;&#x4FEE;&#x590D;&#x4E86;MySQL&#x7684;&#x975E;&#x6807;&#x51C6;&#x884C;&#x4E3A;&#xFF0C;&#x4F7F;&#x5176;&#x8868;&#x73B0;&#x5F97;&#x50CF;&#x5176;&#x4ED6;&#x7C7B;&#x578B;&#x4E00;&#x6837;&#xFF1B;&#x4E3A;&#x4E86;&#x9002;&#x5E94;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;SQLAlchemy&#x73B0;&#x5728;&#x65E0;&#x6761;&#x4EF6;&#x5730;&#x4E3A;&#x6240;&#x6709;TIMESTAMP&#x5217;&#x53D1;&#x51FA;NULL / NOT NULL&#x3002;</span></p><div class="admonition seealso"><p class="first admonition-title"><span class="yiyi-st" id="yiyi-621">&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x770B;</span></p><p class="last"><span class="yiyi-st" id="yiyi-622"><a class="reference internal" href="dialects_mysql.html#mysql-timestamp-null"><span>TIMESTAMP Columns and NULL</span></a></span></p></div><p><span class="yiyi-st" id="yiyi-623"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3155">&#xFF03;3155  T0&gt;</a></span></p></div><div class="section" id="mysql-set-type-overhauled-to-support-empty-sets-unicode-blank-value-handling"><h3><span class="yiyi-st" id="yiyi-624">MySQL SET Type&#x5927;&#x5199;&#xFF0C;&#x652F;&#x6301;&#x7A7A;&#x96C6;&#xFF0C;unicode&#xFF0C;&#x7A7A;&#x503C;&#x5904;&#x7406;<a class="headerlink" href="#mysql-set-type-overhauled-to-support-empty-sets-unicode-blank-value-handling" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-625"><a class="reference internal" href="dialects_mysql.html#sqlalchemy.dialects.mysql.SET" title="sqlalchemy.dialects.mysql.SET"><code class="xref py py-class docutils literal"><span class="pre">mysql.SET</span></code></a>&#x7C7B;&#x578B;&#x5386;&#x53F2;&#x4E0A;&#x4E0D;&#x5305;&#x62EC;&#x5206;&#x522B;&#x5904;&#x7406;&#x7A7A;&#x767D;&#x96C6;&#x548C;&#x7A7A;&#x503C;&#x7684;&#x7CFB;&#x7EDF;&#xFF1B;&#x56E0;&#x4E3A;&#x4E0D;&#x540C;&#x7684;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x5728;&#x5904;&#x7406;&#x7A7A;&#x5B57;&#x7B26;&#x4E32;&#x548C;&#x7A7A;&#x5B57;&#x7B26;&#x96C6;&#x8868;&#x793A;&#x65B9;&#x9762;&#x6709;&#x4E0D;&#x540C;&#x7684;&#x884C;&#x4E3A;&#xFF0C;&#x6240;&#x4EE5;SET&#x7C7B;&#x578B;&#x53EA;&#x8BD5;&#x56FE;&#x5728;&#x8FD9;&#x4E9B;&#x884C;&#x4E3A;&#x4E4B;&#x95F4;&#x8FDB;&#x884C;&#x5BF9;&#x51B2;&#xFF0C;&#x9009;&#x62E9;&#x5C06;&#x7A7A;&#x96C6;&#x4F5C;&#x4E3A;<code class="docutils literal"><span class="pre">set([&apos;&apos;])</span></code></span><span class="yiyi-st" id="yiyi-626">&#x8FD9;&#x91CC;&#x7684;&#x90E8;&#x5206;&#x539F;&#x56E0;&#x662F;&#xFF0C;&#x5426;&#x5219;&#x5B9E;&#x9645;&#x4E0A;&#x4E0D;&#x53EF;&#x80FD;&#x5728;MySQL SET&#x4E2D;&#x5B58;&#x50A8;&#x4E00;&#x4E2A;&#x7A7A;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x56E0;&#x4E3A;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x7ED9;&#x6211;&#x4EEC;&#x8FD4;&#x56DE;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x65E0;&#x6CD5;&#x533A;&#x5206;<code class="docutils literal"><span class="pre">set([&apos;&apos;])</span></code>&#x548C;<code class="docutils literal"><span class="pre">set()</span></code></span><span class="yiyi-st" id="yiyi-627">&#x7528;&#x6237;&#x786E;&#x5B9A;&#x662F;&#x5426;<code class="docutils literal"><span class="pre">set([&apos;&apos;])</span></code>&#x5B9E;&#x9645;&#x4E0A;&#x8868;&#x793A;&#x201C;&#x7A7A;&#x96C6;&#x201D;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-628">&#x65B0;&#x884C;&#x4E3A;&#x5C06;&#x7A7A;&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x7528;&#x4F8B;&#xFF08;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x751A;&#x81F3;&#x5728;MySQL&#x6587;&#x6863;&#x4E2D;&#x6CA1;&#x6709;&#x8BB0;&#x5F55;&#x7684;&#x5F02;&#x5E38;&#x60C5;&#x51B5;&#xFF09;&#x79FB;&#x52A8;&#x5230;&#x4E00;&#x4E2A;&#x7279;&#x6B8A;&#x60C5;&#x51B5;&#xFF0C;&#x73B0;&#x5728;<a class="reference internal" href="dialects_mysql.html#sqlalchemy.dialects.mysql.SET" title="sqlalchemy.dialects.mysql.SET"><code class="xref py py-class docutils literal"><span class="pre">mysql.SET</span></code></a>&#x7684;&#x9ED8;&#x8BA4;&#x884C;&#x4E3A;&#x662F;&#xFF1A;</span></p><ul class="simple"><li><span class="yiyi-st" id="yiyi-629">&#x5C06;MySQL-python&#x8FD4;&#x56DE;&#x7684;&#x7A7A;&#x5B57;&#x7B26;&#x4E32;<code class="docutils literal"><span class="pre">&apos;&apos;</span></code>&#x5904;&#x7406;&#x4E3A;&#x7A7A;set <code class="docutils literal"><span class="pre">set()</span></code>&#xFF1B;</span></li><li><span class="yiyi-st" id="yiyi-630">&#x5C06;MySQL-Connector-Python&#x8FD4;&#x56DE;&#x7684;&#x5355;&#x7A7A;&#x503C;&#x96C6;&#x5408;<code class="docutils literal"><span class="pre">set([&apos;&apos;])</span></code>&#x8F6C;&#x6362;&#x4E3A;&#x7A7A;set <code class="docutils literal"><span class="pre">set()</span></code>&#xFF1B;</span></li><li><span class="yiyi-st" id="yiyi-631">&#x4E3A;&#x4E86;&#x5904;&#x7406;&#x5B9E;&#x9645;&#x5E0C;&#x671B;&#x5728;&#x5176;&#x53EF;&#x80FD;&#x503C;&#x5217;&#x8868;&#x4E2D;&#x5305;&#x542B;&#x7A7A;&#x503C;<code class="docutils literal"><span class="pre">&apos;&apos;</span></code>&#x7684;&#x96C6;&#x5408;&#x7C7B;&#x578B;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x5B9E;&#x73B0;&#x4E86;&#x4E00;&#x4E2A;&#x65B0;&#x7279;&#x6027;&#xFF08;&#x5728;&#x8FD9;&#x4E2A;&#x7528;&#x4F8B;&#x4E2D;&#x662F;&#x5FC5;&#x9700;&#x7684;&#xFF09;&#xFF0C;&#x4ECE;&#x800C;&#x8BBE;&#x7F6E;&#x503C;&#x88AB;&#x6301;&#x4E45;&#x5316;&#x5E76;&#x4E14;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x6309;&#x4F4D;&#x6574;&#x6570;&#x503C;&#x52A0;&#x8F7D;&#xFF1B;&#x6DFB;&#x52A0;&#x6807;&#x5FD7;<a class="reference internal" href="dialects_mysql.html#sqlalchemy.dialects.mysql.SET.params.retrieve_as_bitwise" title="sqlalchemy.dialects.mysql.SET"><code class="xref py py-paramref docutils literal"><span class="pre">mysql.SET.retrieve_as_bitwise</span></code></a>&#x4EE5;&#x542F;&#x7528;&#x6B64;&#x529F;&#x80FD;&#x3002;</span></li></ul><p><span class="yiyi-st" id="yiyi-632">&#x901A;&#x8FC7;&#x4F7F;&#x7528;<a class="reference internal" href="dialects_mysql.html#sqlalchemy.dialects.mysql.SET.params.retrieve_as_bitwise" title="sqlalchemy.dialects.mysql.SET"><code class="xref py py-paramref docutils literal"><span class="pre">mysql.SET.retrieve_as_bitwise</span></code></a>&#x6807;&#x5FD7;&#xFF0C;&#x53EF;&#x4EE5;&#x4FDD;&#x6301;&#x96C6;&#x5408;&#x7684;&#x6301;&#x4E45;&#x6027;&#xFF0C;&#x5E76;&#x4E14;&#x68C0;&#x7D22;&#x65F6;&#x4E0D;&#x4F1A;&#x51FA;&#x73B0;&#x4EFB;&#x4F55;&#x542B;&#x7CCA;&#x4E0D;&#x6E05;&#x7684;&#x503C;&#x3002;</span><span class="yiyi-st" id="yiyi-633">&#x7406;&#x8BBA;&#x4E0A;&#x8FD9;&#x4E2A;&#x6807;&#x5FD7;&#x53EF;&#x4EE5;&#x5728;&#x4EFB;&#x4F55;&#x60C5;&#x51B5;&#x4E0B;&#x88AB;&#x6253;&#x5F00;&#xFF0C;&#x53EA;&#x8981;&#x8BE5;&#x7C7B;&#x578B;&#x7684;&#x7ED9;&#x5B9A;&#x503C;&#x5217;&#x8868;&#x4E0E;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x58F0;&#x660E;&#x7684;&#x987A;&#x5E8F;&#x5B8C;&#x5168;&#x5339;&#x914D;&#x5373;&#x53EF;&#x3002;&#x5B83;&#x53EA;&#x4F1A;&#x4F7F;SQL echo&#x8F93;&#x51FA;&#x66F4;&#x52A0;&#x4E0D;&#x5BFB;&#x5E38;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-634"><a class="reference internal" href="dialects_mysql.html#sqlalchemy.dialects.mysql.SET" title="sqlalchemy.dialects.mysql.SET"><code class="xref py py-class docutils literal"><span class="pre">mysql.SET</span></code></a>&#x7684;&#x9ED8;&#x8BA4;&#x884C;&#x4E3A;&#x4FDD;&#x6301;&#x4E0D;&#x53D8;&#xFF0C;&#x4F7F;&#x7528;&#x5B57;&#x7B26;&#x4E32;&#x5F80;&#x8FD4;&#x4F20;&#x503C;&#x3002;</span><span class="yiyi-st" id="yiyi-635">&#x57FA;&#x4E8E;&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x884C;&#x4E3A;&#x73B0;&#x5728;&#x652F;&#x6301;unicode&#x5B8C;&#x5168;&#x5305;&#x542B;use_unicode = 0&#x7684;MySQL-python&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-636"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3283">&#xFF03;3283  T0&gt;</a></span></p></div><div class="section" id="mysql-internal-no-such-table-exceptions-not-passed-to-event-handlers"><h3><span class="yiyi-st" id="yiyi-637">MySQL&#x5185;&#x90E8;&#x201C;&#x6CA1;&#x6709;&#x8FD9;&#x6837;&#x7684;&#x8868;&#x201D;&#x5F02;&#x5E38;&#x4E0D;&#x4F1A;&#x4F20;&#x9012;&#x7ED9;&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x7A0B;&#x5E8F;<a class="headerlink" href="#mysql-internal-no-such-table-exceptions-not-passed-to-event-handlers" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-638">&#x73B0;&#x5728;&#xFF0C;MySQL&#x65B9;&#x8A00;&#x5C06;&#x7981;&#x6B62;<a class="reference internal" href="core_events.html#sqlalchemy.events.ConnectionEvents.handle_error" title="sqlalchemy.events.ConnectionEvents.handle_error"><code class="xref py py-meth docutils literal"><span class="pre">ConnectionEvents.handle_error()</span></code></a>&#x4E8B;&#x4EF6;&#x89E6;&#x53D1;&#x5B83;&#x5728;&#x5185;&#x90E8;&#x4F7F;&#x7528;&#x7684;&#x7528;&#x4E8E;&#x68C0;&#x6D4B;&#x8868;&#x662F;&#x5426;&#x5B58;&#x5728;&#x7684;&#x8BED;&#x53E5;&#x3002;</span><span class="yiyi-st" id="yiyi-639">&#x8FD9;&#x662F;&#x901A;&#x8FC7;&#x4F7F;&#x7528;&#x6267;&#x884C;&#x9009;&#x9879;<code class="docutils literal"><span class="pre">skip_user_error_events</span></code>&#x6765;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x8BE5;&#x9009;&#x9879;&#x4E3A;&#x8BE5;&#x6267;&#x884C;&#x7684;&#x8303;&#x56F4;&#x7981;&#x7528;&#x53E5;&#x67C4;&#x9519;&#x8BEF;&#x4E8B;&#x4EF6;&#x3002;</span><span class="yiyi-st" id="yiyi-640">&#x901A;&#x8FC7;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#xFF0C;&#x91CD;&#x5199;&#x5F02;&#x5E38;&#x7684;&#x7528;&#x6237;&#x4EE3;&#x7801;&#x4E0D;&#x9700;&#x8981;&#x62C5;&#x5FC3;&#x5076;&#x5C14;&#x9700;&#x8981;&#x6355;&#x83B7;SQLAlchemy&#x7279;&#x5B9A;&#x5F02;&#x5E38;&#x7684;MySQL&#x65B9;&#x8A00;&#x6216;&#x5176;&#x4ED6;&#x65B9;&#x8A00;&#x3002;</span></p></div><div class="section" id="changed-the-default-value-of-raise-on-warnings-for-mysql-connector"><h3><span class="yiyi-st" id="yiyi-641">&#x4E3A;MySQL&#x8FDE;&#x63A5;&#x5668;&#x66F4;&#x6539;&#x4E86;<code class="docutils literal"><span class="pre">raise_on_warnings</span></code>&#x7684;&#x9ED8;&#x8BA4;&#x503C;<a class="headerlink" href="#changed-the-default-value-of-raise-on-warnings-for-mysql-connector" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-642">MySQL-Connector&#x5C06;&#x201C;raise_on_warnings&#x201D;&#x7684;&#x9ED8;&#x8BA4;&#x503C;&#x66F4;&#x6539;&#x4E3A;False&#x3002;</span><span class="yiyi-st" id="yiyi-643">&#x7531;&#x4E8E;&#x67D0;&#x79CD;&#x539F;&#x56E0;&#xFF0C;&#x8FD9;&#x88AB;&#x8BBE;&#x7F6E;&#x4E3A;True&#x3002;</span><span class="yiyi-st" id="yiyi-644">&#x4E0D;&#x5E78;&#x7684;&#x662F;&#xFF0C;&#x201C;&#x7F13;&#x51B2;&#x201D;&#x6807;&#x5FD7;&#x5FC5;&#x987B;&#x4FDD;&#x6301;&#x4E3A;True&#xFF0C;&#x56E0;&#x4E3A;MySQL&#x8FDE;&#x63A5;&#x5668;&#x4E0D;&#x5141;&#x8BB8;&#x6E38;&#x6807;&#x5173;&#x95ED;&#xFF0C;&#x9664;&#x975E;&#x6240;&#x6709;&#x7ED3;&#x679C;&#x90FD;&#x88AB;&#x5B8C;&#x5168;&#x83B7;&#x53D6;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-645"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2515">&#xFF03;2515  T0&gt;</a></span></p></div><div class="section" id="mysql-boolean-symbols-true-false-work-again"><h3><span class="yiyi-st" id="yiyi-646">MySQL&#x5E03;&#x5C14;&#x7B26;&#x53F7;&#x201C;true&#x201D;&#xFF0C;&#x201C;false&#x201D;&#x518D;&#x6B21;&#x5DE5;&#x4F5C;<a class="headerlink" href="#mysql-boolean-symbols-true-false-work-again" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-647">&#x5BF9;IS / IS NOT&#x8FD0;&#x7B97;&#x7B26;&#x8FDB;&#x884C;0.9&#x7248;&#x672C;&#x7684;&#x4FEE;&#x6539;&#x4EE5;&#x53CA;<a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2682">&#xFF03;2682</a>&#x4E2D;&#x7684;&#x5E03;&#x5C14;&#x7C7B;&#x578B;&#x4E0D;&#x5141;&#x8BB8;MySQL&#x65B9;&#x8A00;&#x5728;&#x201C;IS&#x201D;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x4F7F;&#x7528;&#x201C;true&#x201D;&#x548C;&#x201C;false&#x201D; / &#x201C;&#x4E0D;&#x662F;&#x201D;&#x3002;</span><span class="yiyi-st" id="yiyi-648">&#x663E;&#x7136;&#xFF0C;&#x5373;&#x4F7F;MySQL&#x6CA1;&#x6709;&#x201C;boolean&#x201D;&#x7C7B;&#x578B;&#xFF0C;&#x5373;&#x4F7F;&#x8FD9;&#x4E9B;&#x7B26;&#x53F7;&#x4E0E;&#x201C;1&#x201D;&#x548C;&#x201C;0&#x201D;&#xFF08;&#x548C;IS / IS&#xFF09;&#x662F;&#x540C;&#x4E49;&#x7684;&#xFF0C;&#x5B83;&#x4ECD;&#x7136;&#x652F;&#x6301;IS / IS NOT&#x3002;&#x4E0D;&#x662F;&#x4E0D;&#x9002;&#x7528;&#x4E8E;&#x6570;&#x5B57;&#xFF09;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-649">&#x56E0;&#x6B64;&#xFF0C;&#x8FD9;&#x91CC;&#x7684;&#x53D8;&#x5316;&#x662F;MySQL&#x65B9;&#x8A00;&#x4ECD;&#x7136;&#x662F;&#x201C;&#x975E;&#x672C;&#x5730;&#x5E03;&#x5C14;&#x201D;&#xFF0C;&#x4F46;&#x662F;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.true" title="sqlalchemy.sql.expression.true"><code class="xref py py-func docutils literal"><span class="pre">true()</span></code></a>&#x548C;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.expression.false" title="sqlalchemy.sql.expression.false"><code class="xref py py-func docutils literal"><span class="pre">false()</span></code></a>&#x7B26;&#x53F7;&#x518D;&#x6B21;&#x4EA7;&#x751F;&#x5173;&#x952E;&#x5B57;&#x201C;true&#x201D;&#x548C;&#x201C;false &#x201C;&#xFF0C;&#x8FD9;&#x6837;&#x50CF;<code class="docutils literal"><span class="pre">column.is_(true())</span></code>&#x8FD9;&#x6837;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#x518D;&#x6B21;&#x9002;&#x7528;&#x4E8E;MySQL&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-650"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3186">&#xFF03;3186  T0&gt;</a></span></p></div><div class="section" id="the-match-operator-now-returns-an-agnostic-matchtype-compatible-with-mysql-s-floating-point-return-value"><h3><span class="yiyi-st" id="yiyi-651">match()&#x8FD0;&#x7B97;&#x7B26;&#x73B0;&#x5728;&#x8FD4;&#x56DE;&#x4E0E;MySQL&#x7684;&#x6D6E;&#x70B9;&#x8FD4;&#x56DE;&#x503C;&#x517C;&#x5BB9;&#x7684;&#x4E0D;&#x53EF;&#x77E5;&#x7684;MatchType <a class="headerlink" href="#the-match-operator-now-returns-an-agnostic-matchtype-compatible-with-mysql-s-floating-point-return-value" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-652">&#x4E00;&#x4E2A;<a class="reference internal" href="core_sqlelement.html#sqlalchemy.sql.operators.ColumnOperators.match" title="sqlalchemy.sql.operators.ColumnOperators.match"><code class="xref py py-meth docutils literal"><span class="pre">ColumnOperators.match()</span></code></a>&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x8FD4;&#x56DE;&#x7C7B;&#x578B;&#x73B0;&#x5728;&#x662F;&#x4E00;&#x4E2A;&#x540D;&#x4E3A;<a class="reference internal" href="core_type_basics.html#sqlalchemy.types.MatchType" title="sqlalchemy.types.MatchType"><code class="xref py py-class docutils literal"><span class="pre">MatchType</span></code></a>&#x7684;&#x65B0;&#x7C7B;&#x578B;&#x3002;</span><span class="yiyi-st" id="yiyi-653">&#x8FD9;&#x662F;<a class="reference internal" href="core_type_basics.html#sqlalchemy.types.Boolean" title="sqlalchemy.types.Boolean"><code class="xref py py-class docutils literal"><span class="pre">Boolean</span></code></a>&#x7684;&#x4E00;&#x4E2A;&#x5B50;&#x7C7B;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x65B9;&#x8A00;&#x62E6;&#x622A;&#xFF0C;&#x4EE5;&#x4FBF;&#x5728;SQL&#x6267;&#x884C;&#x65F6;&#x4EA7;&#x751F;&#x4E0D;&#x540C;&#x7684;&#x7ED3;&#x679C;&#x7C7B;&#x578B;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-654">&#x50CF;&#x4E0B;&#x9762;&#x8FD9;&#x6837;&#x7684;&#x4EE3;&#x7801;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x6B63;&#x5E38;&#x5DE5;&#x4F5C;&#x5E76;&#x8FD4;&#x56DE;MySQL&#x4E0A;&#x7684;&#x6D6E;&#x70B9;&#x6570;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<span class="gp">... </span>   <span class="n">select</span><span class="p">([</span>
<span class="gp">... </span>       <span class="n">matchtable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&apos;Agile Ruby Programming&apos;</span><span class="p">)</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="s1">&apos;ruby&apos;</span><span class="p">),</span>
<span class="gp">... </span>       <span class="n">matchtable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&apos;Dive Python&apos;</span><span class="p">)</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="s1">&apos;python&apos;</span><span class="p">),</span>
<span class="gp">... </span>       <span class="n">matchtable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">title</span>
<span class="gp">... </span>   <span class="p">])</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">matchtable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="gp">... </span><span class="p">)</span>
<span class="go">[</span>
<span class="go">    (2.0, 0.0, &apos;Agile Web Development with Ruby On Rails&apos;),</span>
<span class="go">    (0.0, 2.0, &apos;Dive Into Python&apos;),</span>
<span class="go">    (2.0, 0.0, &quot;Programming Matz&apos;s Ruby&quot;),</span>
<span class="go">    (0.0, 0.0, &apos;The Definitive Guide to Django&apos;),</span>
<span class="go">    (0.0, 1.0, &apos;Python in a Nutshell&apos;)</span>
<span class="go">]</span></pre></div></div><p><span class="yiyi-st" id="yiyi-655"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3263">&#xFF03;3263  T0&gt;</a></span></p></div><div class="section" id="drizzle-dialect-is-now-an-external-dialect"><h3><span class="yiyi-st" id="yiyi-656">&#x7EC6;&#x96E8;&#x65B9;&#x8A00;&#x73B0;&#x5728;&#x662F;&#x4E00;&#x79CD;&#x5916;&#x8BED;<a class="headerlink" href="#drizzle-dialect-is-now-an-external-dialect" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-657">The dialect for <a class="reference external" href="http://www.drizzle.org/">Drizzle</a> is now an external dialect, available at <a class="reference external" href="https://bitbucket.org/zzzeek/sqlalchemy-drizzle">https://bitbucket.org/zzzeek/sqlalchemy-drizzle</a>. </span><span class="yiyi-st" id="yiyi-658">&#x5728;SQLAlchemy&#x80FD;&#x591F;&#x9002;&#x5E94;&#x7B2C;&#x4E09;&#x65B9;&#x65B9;&#x8A00;&#x4E4B;&#x524D;&#xFF0C;&#x8FD9;&#x79CD;&#x65B9;&#x8A00;&#x88AB;&#x6DFB;&#x52A0;&#x5230;&#x4E86;SQLAlchemy&#x4E2D;&#xFF1B;&#x672A;&#x6765;&#xFF0C;&#x6240;&#x6709;&#x4E0D;&#x5C5E;&#x4E8E;&#x201C;&#x65E0;&#x6240;&#x4E0D;&#x5728;&#x201D;&#x7C7B;&#x522B;&#x7684;&#x6570;&#x636E;&#x5E93;&#x90FD;&#x662F;&#x7B2C;&#x4E09;&#x65B9;&#x65B9;&#x8A00;&#x3002;</span><span class="yiyi-st" id="yiyi-659">&#x65B9;&#x8A00;&#x7684;&#x5B9E;&#x73B0;&#x6CA1;&#x6709;&#x6539;&#x53D8;&#xFF0C;&#x4ECD;&#x7136;&#x57FA;&#x4E8E;SQLAlchemy&#x4E2D;&#x7684;MySQL + MySQLdb&#x65B9;&#x8A00;&#x3002;</span><span class="yiyi-st" id="yiyi-660">&#x65B9;&#x8A00;&#x5C1A;&#x672A;&#x53D1;&#x5E03;&#xFF0C;&#x5904;&#x4E8E;&#x201C;&#x9601;&#x697C;&#x201D;&#x5730;&#x4F4D;&#xFF1B;&#x4F46;&#x662F;&#x5B83;&#x901A;&#x8FC7;&#x4E86;&#x5927;&#x90E8;&#x5206;&#x6D4B;&#x8BD5;&#xFF0C;&#x5E76;&#x4E14;&#x4E00;&#x822C;&#x90FD;&#x5904;&#x4E8E;&#x4F53;&#x9762;&#x7684;&#x5DE5;&#x4F5C;&#x72B6;&#x6001;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x4EBA;&#x60F3;&#x8981;&#x63A5;&#x53D7;&#x629B;&#x5149;&#x3002;</span></p></div></div><div class="section" id="dialect-improvements-and-changes-sqlite"><h2><span class="yiyi-st" id="yiyi-661">&#x65B9;&#x8A00;&#x7684;&#x6539;&#x8FDB;&#x548C;&#x6539;&#x53D8; -  SQLite <a class="headerlink" href="#dialect-improvements-and-changes-sqlite" title="Permalink to this headline">&#xB6;</a></span></h2><div class="section" id="sqlite-named-and-unnamed-unique-and-foreign-key-constraints-will-inspect-and-reflect"><h3><span class="yiyi-st" id="yiyi-662">SQLite&#x547D;&#x540D;&#x548C;&#x672A;&#x547D;&#x540D;&#x7684;UNIQUE&#x548C;FOREIGN KEY&#x7EA6;&#x675F;&#x5C06;&#x68C0;&#x67E5;&#x548C;&#x53CD;&#x6620;<a class="headerlink" href="#sqlite-named-and-unnamed-unique-and-foreign-key-constraints-will-inspect-and-reflect" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-663">UNIQUE&#x548C;FOREIGN KEY&#x7EA6;&#x675F;&#x73B0;&#x5728;&#x5B8C;&#x5168;&#x53CD;&#x6620;&#x5728;SQLite&#x4E2D;&#xFF0C;&#x65E0;&#x8BBA;&#x662F;&#x5426;&#x5E26;&#x6709;&#x540D;&#x79F0;&#x3002;</span><span class="yiyi-st" id="yiyi-664">&#x4EE5;&#x524D;&#xFF0C;&#x5916;&#x952E;&#x540D;&#x79F0;&#x88AB;&#x5FFD;&#x7565;&#xFF0C;&#x672A;&#x547D;&#x540D;&#x7684;&#x552F;&#x4E00;&#x7EA6;&#x675F;&#x88AB;&#x5FFD;&#x7565;&#x3002;</span><span class="yiyi-st" id="yiyi-665">&#x7279;&#x522B;&#x662F;&#x8FD9;&#x5C06;&#x6709;&#x52A9;&#x4E8E;Alembic&#x7684;&#x65B0;SQLite&#x8FC1;&#x79FB;&#x529F;&#x80FD;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-666">&#x4E3A;&#x4E86;&#x5B9E;&#x73B0;&#x8FD9;&#x4E00;&#x70B9;&#xFF0C;&#x5BF9;&#x4E8E;&#x5916;&#x952E;&#x548C;&#x552F;&#x4E00;&#x7EA6;&#x675F;&#xFF0C;PRAGMA foreign_keys&#xFF0C;index_list&#x548C;index_info&#x7684;&#x7ED3;&#x679C;&#x4E0E;CREATE TABLE&#x8BED;&#x53E5;&#x7684;&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;&#x89E3;&#x6790;&#x76F8;&#x7ED3;&#x5408;&#xFF0C;&#x4EE5;&#x5F62;&#x6210;&#x7EA6;&#x675F;&#x540D;&#x79F0;&#x7684;&#x5B8C;&#x6574;&#x56FE;&#x7247;&#xFF0C;&#x4EE5;&#x53CA;&#x533A;&#x5206;UNIQUE&#x4F5C;&#x4E3A;UNIQUE&#x4E0E;&#x672A;&#x547D;&#x540D;&#x7684;INDEX&#x521B;&#x5EFA;&#x7684;&#x7EA6;&#x675F;&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-667"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3244">&#xFF03;3244  T0&gt;</a></span></p><p><span class="yiyi-st" id="yiyi-668"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3261">&#xFF03;3261  T0&gt;</a></span></p></div></div><div class="section" id="dialect-improvements-and-changes-sql-server"><h2><span class="yiyi-st" id="yiyi-669">&#x65B9;&#x8A00;&#x7684;&#x6539;&#x8FDB;&#x548C;&#x6539;&#x53D8; -  SQL Server <a class="headerlink" href="#dialect-improvements-and-changes-sql-server" title="Permalink to this headline">&#xB6;</a></span></h2><div class="section" id="pyodbc-driver-name-is-required-with-hostname-based-sql-server-connections"><h3><span class="yiyi-st" id="yiyi-670">&#x57FA;&#x4E8E;&#x4E3B;&#x673A;&#x540D;&#x7684;SQL Server&#x8FDE;&#x63A5;&#x9700;&#x8981;PyODBC&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x540D;&#x79F0;<a class="headerlink" href="#pyodbc-driver-name-is-required-with-hostname-based-sql-server-connections" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-671">&#x4F7F;&#x7528;&#x65E0;DSN&#x8FDE;&#x63A5;&#x7684;PyODBC&#x8FDE;&#x63A5;&#x5230;SQL Server&#xFF0C;&#x4F8B;&#x5982;&#x4F7F;&#x7528;&#x660E;&#x786E;&#x7684;&#x4E3B;&#x673A;&#x540D;&#xFF0C;&#x73B0;&#x5728;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x540D; -  SQLAlchemy&#x5C06;&#x4E0D;&#x518D;&#x5C1D;&#x8BD5;&#x731C;&#x6D4B;&#x9ED8;&#x8BA4;&#x503C;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;mssql+pyodbc://scott:tiger@myhost:port/databasename?driver=SQL+Server+Native+Client+10.0&quot;</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-672">SQLAlchemy&#x4EE5;&#x524D;&#x786C;&#x7F16;&#x7801;&#x7684;&#x9ED8;&#x8BA4;&#x201C;SQL Server&#x201D;&#x5728;Windows&#x4E0A;&#x5DF2;&#x8FC7;&#x65F6;&#xFF0C;&#x5E76;&#x4E14;SQLAlchemy&#x4E0D;&#x80FD;&#x6839;&#x636E;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;/&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x68C0;&#x6D4B;&#x731C;&#x6D4B;&#x6700;&#x4F73;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x3002;</span><span class="yiyi-st" id="yiyi-673">&#x4F7F;&#x7528;ODBC&#x5B8C;&#x5168;&#x907F;&#x514D;&#x6B64;&#x95EE;&#x9898;&#x65F6;&#xFF0C;&#x59CB;&#x7EC8;&#x9996;&#x9009;&#x4F7F;&#x7528;DSN&#x3002;</span></p><p><span class="yiyi-st" id="yiyi-674"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3182">&#xFF03;3182  T0&gt;</a></span></p></div><div class="section" id="sql-server-2012-large-text-binary-types-render-as-varchar-nvarchar-varbinary"><h3><span class="yiyi-st" id="yiyi-675">SQL Server 2012&#x5927;&#x578B;&#x6587;&#x672C;/&#x4E8C;&#x8FDB;&#x5236;&#x7C7B;&#x578B;&#x5448;&#x73B0;&#x4E3A;VARCHAR&#xFF0C;NVARCHAR&#xFF0C;VARBINARY <a class="headerlink" href="#sql-server-2012-large-text-binary-types-render-as-varchar-nvarchar-varbinary" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-676">&#x5BF9;&#x4E8E;SQL Server 2012&#x53CA;&#x66F4;&#x9AD8;&#x7248;&#x672C;&#xFF0C;<a class="reference internal" href="core_type_basics.html#sqlalchemy.types.Text" title="sqlalchemy.types.Text"><code class="xref py py-class docutils literal"><span class="pre">Text</span></code></a>&#xFF0C;<a class="reference internal" href="core_type_basics.html#sqlalchemy.types.UnicodeText" title="sqlalchemy.types.UnicodeText"><code class="xref py py-class docutils literal"><span class="pre">UnicodeText</span></code></a>&#x548C;<a class="reference internal" href="core_type_basics.html#sqlalchemy.types.LargeBinary" title="sqlalchemy.types.LargeBinary"><code class="xref py py-class docutils literal"><span class="pre">LargeBinary</span></code></a>&#x7C7B;&#x578B;&#x7684;&#x5448;&#x73B0;&#x5DF2;&#x66F4;&#x6539;&#xFF0C;&#x5E76;&#x5177;&#x6709;&#x5B8C;&#x5168;&#x63A7;&#x5236;&#x884C;&#x4E3A;&#x7684;&#x9009;&#x9879;&#xFF0C;&#x57FA;&#x4E8E;&#x5FAE;&#x8F6F;&#x7684;&#x5F03;&#x7528;&#x51C6;&#x5219;&#x3002;</span><span class="yiyi-st" id="yiyi-677">&#x6709;&#x5173;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a class="reference internal" href="dialects_mssql.html#mssql-large-type-deprecation"><span>Large Text/Binary Type Deprecation</span></a>&#x3002;</span></p></div></div><div class="section" id="dialect-improvements-and-changes-oracle"><h2><span class="yiyi-st" id="yiyi-678">&#x65B9;&#x8A00;&#x7684;&#x6539;&#x8FDB;&#x548C;&#x6539;&#x53D8; -  Oracle <a class="headerlink" href="#dialect-improvements-and-changes-oracle" title="Permalink to this headline">&#xB6;</a></span></h2><div class="section" id="improved-support-for-ctes-in-oracle"><h3><span class="yiyi-st" id="yiyi-679">&#x5728;Oracle <a class="headerlink" href="#improved-support-for-ctes-in-oracle" title="Permalink to this headline">&#xB6;</a>&#x4E2D;&#x6539;&#x8FDB;&#x4E86;&#x5BF9;CTE&#x7684;&#x652F;&#x6301;</span></h3><p><span class="yiyi-st" id="yiyi-680">CTE&#x5BF9;Oracle&#x7684;&#x652F;&#x6301;&#x5DF2;&#x7ECF;&#x5F97;&#x5230;&#x4E86;&#x4FEE;&#x590D;&#xFF0C;&#x5E76;&#x4E14;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x65B0;&#x7279;&#x6027;<code class="xref py py-meth docutils literal"><span class="pre">CTE.with_suffixes()</span></code>&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;Oracle&#x7684;&#x7279;&#x6B8A;&#x6307;&#x4EE4;&#xFF1A;</span></p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">included_parts</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span>
    <span class="n">part</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">sub_part</span><span class="p">,</span> <span class="n">part</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">part</span><span class="p">,</span> <span class="n">part</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">quantity</span>
<span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">part</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">part</span> <span class="o">==</span> <span class="s2">&quot;p1&quot;</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">cte</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;included_parts&quot;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">suffix_with</span><span class="p">(</span>
        <span class="s2">&quot;search depth first by part set ord1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;cycle part set y_cycle to 1 default 0&quot;</span><span class="p">,</span> <span class="n">dialect</span><span class="o">=</span><span class="s1">&apos;oracle&apos;</span><span class="p">)</span></pre></div></div><p><span class="yiyi-st" id="yiyi-681"><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/3220">&#xFF03;3220  T0&gt;</a></span></p></div><div class="section" id="new-oracle-keywords-for-ddl"><h3><span class="yiyi-st" id="yiyi-682">DDL&#x7684;&#x65B0;Oracle&#x5173;&#x952E;&#x5B57;<a class="headerlink" href="#new-oracle-keywords-for-ddl" title="Permalink to this headline">&#xB6;</a></span></h3><p><span class="yiyi-st" id="yiyi-683">&#x5173;&#x952E;&#x5B57;&#x5982;COMPRESS&#xFF0C;ON COMMIT&#xFF0C;BITMAP&#xFF1A;</span></p><p><span class="yiyi-st" id="yiyi-684"><a class="reference internal" href="dialects_oracle.html#oracle-table-options"><span>Oracle Table Options</span></a></span></p><p><span class="yiyi-st" id="yiyi-685"><a class="reference internal" href="dialects_oracle.html#oracle-index-options"><span>Oracle Specific Index Options</span></a></span></p></div></div>